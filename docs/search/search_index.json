{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"m\u00f3dulo Desarrollo Web en Entorno Servidor (DWES) \u00cdndice de unidades unidad UD 00 UD 01 UD 02 UD 03 UD 04 UD 05 UD 06 UD 07 UD 08 Licencia Este material est\u00e1 bajo una Licencia Creative Commons Atribuci\u00f3n-Compartir-Igual 4.0 Internacional. Derivado a partir de material de ----- (----).","title":"Inicio"},{"location":"#modulo-desarrollo-web-en-entorno-servidor-dwes","text":"","title":"m\u00f3dulo Desarrollo Web en Entorno Servidor (DWES)"},{"location":"#indice-de-unidades","text":"unidad UD 00 UD 01 UD 02 UD 03 UD 04 UD 05 UD 06 UD 07 UD 08 Licencia Este material est\u00e1 bajo una Licencia Creative Commons Atribuci\u00f3n-Compartir-Igual 4.0 Internacional. Derivado a partir de material de ----- (----).","title":"\u00cdndice de unidades"},{"location":"default/","text":"... p\u00e1gina en construcci\u00f3n ...","title":"UD 8 Laravel avanzado"},{"location":"ud01/ud0101/","text":"Instalar Docker Introducci\u00f3n Docker es una aplicaci\u00f3n que simplifica el proceso de administraci\u00f3n de procesos de aplicaci\u00f3n en contenedores . Los contenedores le permiten ejecutar sus aplicaciones en procesos con aislamiento de recursos. Son similares a las m\u00e1quinas virtuales, pero los contenedores son m\u00e1s port\u00e1tiles, m\u00e1s flexibles con los recursos y m\u00e1s dependientes del sistema operativo host. Para hallar una introducci\u00f3n detallada a los distintos componentes de un contenedor de Docker, consulte El ecosistema de Docker: Introducci\u00f3n a los componentes comunes . En este tutorial, instalar\u00e1 y usar\u00e1 Docker Community Edition (CE) en Ubuntu 20.04. Instalar\u00e1 Docker, trabajar\u00e1 con contenedores e im\u00e1genes e introducir\u00e1 una imagen en un repositorio de Docker. paso 1: Instalar Docker Es posible que la versi\u00f3n del paquete de instalaci\u00f3n de Docker disponible en el repositorio oficial de Ubuntu no sea la m\u00e1s reciente. Para asegurarnos de contar con la versi\u00f3n m\u00e1s reciente, instalaremos Docker desde el repositorio oficial de Docker. Para hacerlo, agregaremos una nueva fuente de paquetes y la clave GPG de Docker para garantizar que las descargas sean v\u00e1lidas, y luego instalaremos el paquete. Primero, actualiza tu lista de paquetes existente: Bash 1 $ sudo apt update A continuaci\u00f3n, instala algunos paquetes de requisitos previos que permitan a apt usar paquetes a trav\u00e9s de HTTPS: Bash 1 $ sudo apt install apt-transport-https ca-certificates curl software-properties-common Luego, a\u00f1ade la clave de GPG para el repositorio oficial de Docker en su sistema: Bash 1 $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - Agrega el repositorio de Docker a las fuentes de APT: Bash 1 $ sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable\" A continuaci\u00f3n, actualiza el paquete de base de datos con los paquetes de Docker del repositorio reci\u00e9n agregado: Bash 1 $ sudo apt update Aseg\u00farate de estar a punto de realizar la instalaci\u00f3n desde el repositorio de Docker en lugar del repositorio predeterminado de Ubuntu: Bash 1 $ apt-cache policy docker-ce \u200b Si bien el n\u00famero de versi\u00f3n de Docker puede ser distinto, ver\u00e1s un resultado como el siguiente: \u200b Output of apt-cache policy docker-ce Text Only 1 2 3 4 5 6 docker-ce: Installed: (none) Candidate: 5:19.03.9~3-0~ubuntu-focal Version table: 5:19.03.9~3-0~ubuntu-focal 500 500 https://download.docker.com/linux/ubuntu focal/stable amd64 Packages Observa que docker-ce no est\u00e1 instalado, pero la opci\u00f3n m\u00e1s viable para la instalaci\u00f3n es del repositorio de Docker para Ubuntu 20.04 ( focal ). Por \u00faltimo, instala Docker: Bash 1 sudo apt install docker-ce Con esto, Docker quedar\u00e1 instalado, el demonio se iniciar\u00e1 y el proceso se habilitar\u00e1 para ejecutarse en el inicio. Comprueba que funcione: Bash 1 sudo systemctl status docker \u200b El resultado debe ser similar al siguiente, y mostrar que el servicio est\u00e1 activo y en ejecuci\u00f3n: Text Only 1 2 3 4 5 6 7 8 9 10 11 Output \u25cf docker.service - Docker Application Container Engine Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled) Active: active (running) since Tue 2020-05-19 17:00:41 UTC; 17s ago TriggeredBy: \u25cf docker.socket Docs: https://docs.docker.com Main PID: 24321 (dockerd) Tasks: 8 Memory: 46.4M CGroup: /system.slice/docker.service \u2514\u250024321 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock La instalaci\u00f3n de Docker ahora te proporcionar\u00e1 no solo el servicio de Docker (demonio) sino tambi\u00e9n la utilidad de l\u00ednea de comandos docker o el cliente de Docker. paso 2: Instalar Docker Compose instalar Docker Compose Para asegurarnos de que obtenemos la versi\u00f3n estable m\u00e1s reciente de Docker Compose, descargaremos este software de su repositorio oficial de Github . Primero, confirmamos la versi\u00f3n m\u00e1s reciente disponible en su p\u00e1gina de versiones . \u200b El siguiente comando descargar\u00e1 la \u00faltima versi\u00f3n y guardar\u00e1 el archivo ejecutable en /usr/local/bin/docker-compose , que har\u00e1 que este software est\u00e9 globalmente accesible como docker-compose : Bash 1 sudo curl -L \"https://github.com/docker/compose/releases/download/1.26.0/docker-compose- $( uname -s ) - $( uname -m ) \" -o /usr/local/bin/docker-compose A continuaci\u00f3n, estableceremos los permisos correctos para que el comando docker-compose sea ejecutable: Bash 1 sudo chmod +x /usr/local/bin/docker-compose Para verificar que la instalaci\u00f3n se realiz\u00f3 correctamente, puedes ejecutar: Bash 1 docker-compose --version \u200b Visualizar\u00e1s un resultado similar a esto: Bash 1 2 Output docker-compose version 1 .26.0, build 8a1c60f6 Docker Compose se ha instalado correctamente en tu sistema. A continuaci\u00f3n, veremos c\u00f3mo configurar un archivo docker-compose.yml y obtener un entorno en contenedor listo para usarse con esta herramienta. configurar un archivo docker-compose.yml Para demostrar c\u00f3mo configurar un archivo docker-compose-yml y trabajar con Docker Compose, crearemos un entorno de servidor web Apache, PHP, MySQL y PHPMyAdmin (LAMP). Este entorno en contenedor servir\u00e1 como web din\u00e1mica; lo que nos servir\u00e1 en un futuro para acceder a bases de datos en este m\u00f3dulo. Comienza creando un nuevo directorio en tu carpeta de inicio, y luego mu\u00e9velo a \u00e9l: Bash 1 2 mkdir ~/pruNombreEstudiante cd ~/pruNombreEstudiante En este directorio, configura una carpeta de aplicaciones que servir\u00e1 como la ra\u00edz del documento para tu entorno: Bash 1 mkdir miProyecto Copia el sistema de carpetas (ofrecido por el profesor) dentro de la carpeta anterior: A continuaci\u00f3n, abre el proyecto con Visual Studio Code: Bash 1 code . Abre el archivo docker-compose.yml : Bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 version: \"3.1\" services: db: image: mysql ports: - \"3306:3306\" command: --default-authentication-plugin = mysql_native_password environment: MYSQL_DATABASE: pruDB MYSQL_PASSWORD: dwes MYSQL_ROOT_PASSWORD: dwes volumes: - ./dump:/docker-entrypoint-initdb.d - ./conf:/etc/mysql/conf.d - persistent:/var/lib/mysql networks: - default www: build: . ports: - \"80:80\" volumes: - ./www:/var/www/html links: - db networks: - default phpmyadmin: image: phpmyadmin/phpmyadmin links: - db:db ports: - 8000 :80 environment: MYSQL_USER: root MYSQL_PASSWORD: dwes MYSQL_ROOT_PASSWORD: dwes volumes: persistent: El archivo docker-compose.yml normalmente comienza con la definici\u00f3n de la versi\u00f3n . Esto indicar\u00e1 a Docker Compose qu\u00e9 versi\u00f3n de la configuraci\u00f3n estamos usando. Luego tenemos el bloque services , donde configuramos los servicios que son parte de este entorno. En nuestro caso, tenemos un servicio llamado www , otro db y otro phpmyadmin . El servicio www utiliza la imagen . y establece una redirecci\u00f3n de puerto con la directiva ports . Todas las solicitudes en el puerto 8000 del equipo host (el sistema desde el cual est\u00e1 ejecutando Docker Compose) ser\u00e1n redirigidas al contenedor www en el puerto 80 . La directiva volumes crear\u00e1 un volumen compartido entre el equipo host y el contenedor. Esto compartir\u00e1 la carpeta www local con el contenedor, y el volumen se ubicar\u00e1 en /var/www/html dentro del contenedor, que luego sobreescribir\u00e1 la ra\u00edz predeterminada del documento para Apache. Hemos creado una p\u00e1gina demo index.php y un archivo docker-compose.yml para crear un entorno de servidor web en el contenedor que lo presentar\u00e1. En el siguiente paso, abriremos este entorno con Docker Compose. ejecutar Docker Compose Con el archivo docker-compose.yml implementado, podemos ejecutar Docker Compose para mostrar nuestro entorno. El siguiente comando descargar\u00e1 las im\u00e1genes Docker necesarias, crear\u00e1 un contenedor para el servicio web y ejecutar\u00e1 el entorno en contenedor en modo segundo plano: Bash 1 docker-compose up -d Docker Compose primero buscar\u00e1 la imagen definida en su sistema local, y si no puede encontrar la imagen, descargar\u00e1 la imagen desde Docker Hub. Ver\u00e1s un resultado como este: Bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 Output Creating network \"docker-lamp-main2_default\" with the default driver Creating volume \"docker-lamp-main2_persistent\" with default driver Building www [ + ] Building 2 .4s ( 11 /11 ) FINISHED ocker:default = > [ internal ] load build definition from Dockerfile 0 .0s = > = > transferring dockerfile: 611B 0 .0s = > [ internal ] load .dockerignore 0 .0s = > = > transferring context: 2B 0 .0s = > [ internal ] load metadata for docker.io/library/php:8.0.0-apache 2 .3s = > [ 1 /7 ] FROM docker.io/library/php:8.0.0-apache@sha256:d99ca98b9fe768 0 .0s = > CACHED [ 2 /7 ] RUN docker-php-ext-install mysqli 0 .0s = > CACHED [ 3 /7 ] RUN apt-get update && apt-get install -y sendmail libpng-dev && apt-get install -y libzip-dev && apt-get install -y zlib1g-dev && apt-get install -y 0 .0s = > CACHED [ 4 /7 ] RUN docker-php-ext-install mbstring 0 .0s = > CACHED [ 5 /7 ] RUN docker-php-ext-install zip 0 .0s = > CACHED [ 6 /7 ] RUN docker-php-ext-install gd 0 .0s = > CACHED [ 7 /7 ] RUN a2enmod rewrite 0 .0s = > exporting to image 0 .0s = > = > exporting layers 0 .0s = > = > writing image sha256:a35d05b133deb154d2188bf33e3 0 .0s = > = > naming to docker.io/library/docker-lamp-main2_www 0 .0s WARNING: Image for service www was built because it did not already exist. To rebuild this image you must use ` docker-compose build ` or ` docker-compose up --build ` . Creating docker-lamp-main2_db_1 ... done Creating docker-lamp-main2_www_1 ... done Creating docker-lamp-main2_phpmyadmin_1 ... done Tu entorno ahora est\u00e1 funcionando en segundo plano. Para verificar que el contenedor est\u00e1 activo, puede ejecutar: Bash 1 docker-compose ps Este comando le mostrar\u00e1 informaci\u00f3n sobre los contenedores en ejecuci\u00f3n y su estado, adem\u00e1s de cualquier redireccionamiento de puertos en vigor actualmente: Bash 1 2 3 4 5 6 Output Name Command State Ports --------------------------------------------------------------------------------------- docker-lamp-main2_db_1 docker-entrypoint.sh --def ... Exit 1 docker-lamp-main2_phpmyadmin_1 /docker-entrypoint.sh apac ... Up 0 .0.0.0:8000->80/tcp,:::8000->80/tcp docker-lamp-main2_www_1 docker-php-entrypoint apac ... Up 0 .0.0.0:80->80/tcp,:::80->80/tcp Ahora puedes acceder a la aplicaci\u00f3n demo apuntando tu servidor web a localhost:80 si est\u00e1s ejecutando esta demo en tu equipo local, o a :8000 si est\u00e1s ejecutando esta demo en un servidor remoto. Ver\u00e1s una p\u00e1gina como la siguiente: El volumen compartido que ha configurado en el archivo docker-compose.yml mantiene los archivos de tu carpeta www sincronizados con la ra\u00edz del documento del contenedor. Si realizas alg\u00fan cambio al archivo index.php , ser\u00e1n recogidos autom\u00e1icamente por el contenedor y se reflejar\u00e1n en tu navegador cuando vuelva a cargar la p\u00e1gina. En el siguiente paso, ver\u00e1s c\u00f3mo gestionar tu entorno en contenedor con los comandos de Docker Compose. parar y Eliminar imagen base Cuando tienes contenedores Docker ejecut\u00e1ndose, primero necesitas detenerlos antes de borrarlos. Det\u00e9n todos los contenedores ejecut\u00e1ndose: Bash 1 $ sudo docker stop $( docker ps -a -q ) Elimina todos los contenedores detenidos: Bash 1 $ sudo docker rm $( docker ps -a -q ) limpieza del entorno Docker: \u00a1prune! Este comando nos ahorra la eliminaci\u00f3n manual de cada recurso permiti\u00e9ndonos hacer una limpieza general del entorno r\u00e1pidamente. Lo podemos utilizar de varias maneras: Elimina todos los contenedores frenados y redes no utilizadas. Tambi\u00e9n elimina las im\u00e1genes temporales. Bash 1 $ sudo docker system prune Elimina todas las im\u00e1genes no utilizadas por alg\u00fan contenedor . Bash 1 $ sudo docker system prune -a paso 3. Instalar Docker Desktop Con esta aplicaci\u00f3n ser\u00e1 la forma m\u00e1s sencilla de ejecutar, compilar, depurar y probar las aplicaciones Dockerized. El escritorio Docker consta de herramientas para desarrolladores , Aplicaci\u00f3n Docker , Kubernetes y sincronizaci\u00f3n de versiones. Nos permite crear im\u00e1genes y plantillas certificadas de nuestra elecci\u00f3n de idiomas y herramientas. paso 4. Instalar Docker Portainer ortainer es una forma c\u00f3moda de gestionar entornos de contenedores distribuidos . El software se instala como un contenedor Docker y, por tanto, se ejecuta pr\u00e1cticamente en cualquier lugar. Mostramos la rutina de instalaci\u00f3n y aportamos \u00fatiles consejos. instalar Bash 1 2 $ sudo docker volume create portainer_data $ sudo docker run -d -p 9000 :9000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer lanzar Como otro contenedor, podremos acceder a \u00e9l mediante un navegador (Firefox, Chrome, ...) introduciendo la URL: localhost:9000 Si muestra el siguiente texto, debemos reiniciar el contenedor del Docker Portainer: Volvemos a acceder v\u00eda localhost:9000 : funciona como un docker Para ver el ID de contenedor podemos listar los contenedores: Bash 1 $ sudo docker ps -a Para parar el contenedor: Bash 1 $ sudo docker stop [ ID ] Para volver a lanzar el contenedor: Bash 1 $ sudo docker start [ ID ] bibliograf\u00eda web digitalocean . canal Youtube DevOpsea . apuntes profesor Aitor Medrano https://aitor-medrano.github.io","title":"UD 1 Arquitectura Web"},{"location":"ud01/ud0101/#instalar-docker","text":"","title":"Instalar Docker"},{"location":"ud01/ud0101/#introduccion","text":"Docker es una aplicaci\u00f3n que simplifica el proceso de administraci\u00f3n de procesos de aplicaci\u00f3n en contenedores . Los contenedores le permiten ejecutar sus aplicaciones en procesos con aislamiento de recursos. Son similares a las m\u00e1quinas virtuales, pero los contenedores son m\u00e1s port\u00e1tiles, m\u00e1s flexibles con los recursos y m\u00e1s dependientes del sistema operativo host. Para hallar una introducci\u00f3n detallada a los distintos componentes de un contenedor de Docker, consulte El ecosistema de Docker: Introducci\u00f3n a los componentes comunes . En este tutorial, instalar\u00e1 y usar\u00e1 Docker Community Edition (CE) en Ubuntu 20.04. Instalar\u00e1 Docker, trabajar\u00e1 con contenedores e im\u00e1genes e introducir\u00e1 una imagen en un repositorio de Docker.","title":"Introducci\u00f3n"},{"location":"ud01/ud0101/#paso-1-instalar-docker","text":"Es posible que la versi\u00f3n del paquete de instalaci\u00f3n de Docker disponible en el repositorio oficial de Ubuntu no sea la m\u00e1s reciente. Para asegurarnos de contar con la versi\u00f3n m\u00e1s reciente, instalaremos Docker desde el repositorio oficial de Docker. Para hacerlo, agregaremos una nueva fuente de paquetes y la clave GPG de Docker para garantizar que las descargas sean v\u00e1lidas, y luego instalaremos el paquete. Primero, actualiza tu lista de paquetes existente: Bash 1 $ sudo apt update A continuaci\u00f3n, instala algunos paquetes de requisitos previos que permitan a apt usar paquetes a trav\u00e9s de HTTPS: Bash 1 $ sudo apt install apt-transport-https ca-certificates curl software-properties-common Luego, a\u00f1ade la clave de GPG para el repositorio oficial de Docker en su sistema: Bash 1 $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - Agrega el repositorio de Docker a las fuentes de APT: Bash 1 $ sudo add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable\" A continuaci\u00f3n, actualiza el paquete de base de datos con los paquetes de Docker del repositorio reci\u00e9n agregado: Bash 1 $ sudo apt update Aseg\u00farate de estar a punto de realizar la instalaci\u00f3n desde el repositorio de Docker en lugar del repositorio predeterminado de Ubuntu: Bash 1 $ apt-cache policy docker-ce \u200b Si bien el n\u00famero de versi\u00f3n de Docker puede ser distinto, ver\u00e1s un resultado como el siguiente: \u200b Output of apt-cache policy docker-ce Text Only 1 2 3 4 5 6 docker-ce: Installed: (none) Candidate: 5:19.03.9~3-0~ubuntu-focal Version table: 5:19.03.9~3-0~ubuntu-focal 500 500 https://download.docker.com/linux/ubuntu focal/stable amd64 Packages Observa que docker-ce no est\u00e1 instalado, pero la opci\u00f3n m\u00e1s viable para la instalaci\u00f3n es del repositorio de Docker para Ubuntu 20.04 ( focal ). Por \u00faltimo, instala Docker: Bash 1 sudo apt install docker-ce Con esto, Docker quedar\u00e1 instalado, el demonio se iniciar\u00e1 y el proceso se habilitar\u00e1 para ejecutarse en el inicio. Comprueba que funcione: Bash 1 sudo systemctl status docker \u200b El resultado debe ser similar al siguiente, y mostrar que el servicio est\u00e1 activo y en ejecuci\u00f3n: Text Only 1 2 3 4 5 6 7 8 9 10 11 Output \u25cf docker.service - Docker Application Container Engine Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled) Active: active (running) since Tue 2020-05-19 17:00:41 UTC; 17s ago TriggeredBy: \u25cf docker.socket Docs: https://docs.docker.com Main PID: 24321 (dockerd) Tasks: 8 Memory: 46.4M CGroup: /system.slice/docker.service \u2514\u250024321 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock La instalaci\u00f3n de Docker ahora te proporcionar\u00e1 no solo el servicio de Docker (demonio) sino tambi\u00e9n la utilidad de l\u00ednea de comandos docker o el cliente de Docker.","title":"paso 1: Instalar Docker"},{"location":"ud01/ud0101/#paso-2-instalar-docker-compose","text":"","title":"paso 2: Instalar Docker Compose"},{"location":"ud01/ud0101/#instalar-docker-compose","text":"Para asegurarnos de que obtenemos la versi\u00f3n estable m\u00e1s reciente de Docker Compose, descargaremos este software de su repositorio oficial de Github . Primero, confirmamos la versi\u00f3n m\u00e1s reciente disponible en su p\u00e1gina de versiones . \u200b El siguiente comando descargar\u00e1 la \u00faltima versi\u00f3n y guardar\u00e1 el archivo ejecutable en /usr/local/bin/docker-compose , que har\u00e1 que este software est\u00e9 globalmente accesible como docker-compose : Bash 1 sudo curl -L \"https://github.com/docker/compose/releases/download/1.26.0/docker-compose- $( uname -s ) - $( uname -m ) \" -o /usr/local/bin/docker-compose A continuaci\u00f3n, estableceremos los permisos correctos para que el comando docker-compose sea ejecutable: Bash 1 sudo chmod +x /usr/local/bin/docker-compose Para verificar que la instalaci\u00f3n se realiz\u00f3 correctamente, puedes ejecutar: Bash 1 docker-compose --version \u200b Visualizar\u00e1s un resultado similar a esto: Bash 1 2 Output docker-compose version 1 .26.0, build 8a1c60f6 Docker Compose se ha instalado correctamente en tu sistema. A continuaci\u00f3n, veremos c\u00f3mo configurar un archivo docker-compose.yml y obtener un entorno en contenedor listo para usarse con esta herramienta.","title":"instalar Docker Compose"},{"location":"ud01/ud0101/#configurar-un-archivo-docker-composeyml","text":"Para demostrar c\u00f3mo configurar un archivo docker-compose-yml y trabajar con Docker Compose, crearemos un entorno de servidor web Apache, PHP, MySQL y PHPMyAdmin (LAMP). Este entorno en contenedor servir\u00e1 como web din\u00e1mica; lo que nos servir\u00e1 en un futuro para acceder a bases de datos en este m\u00f3dulo. Comienza creando un nuevo directorio en tu carpeta de inicio, y luego mu\u00e9velo a \u00e9l: Bash 1 2 mkdir ~/pruNombreEstudiante cd ~/pruNombreEstudiante En este directorio, configura una carpeta de aplicaciones que servir\u00e1 como la ra\u00edz del documento para tu entorno: Bash 1 mkdir miProyecto Copia el sistema de carpetas (ofrecido por el profesor) dentro de la carpeta anterior: A continuaci\u00f3n, abre el proyecto con Visual Studio Code: Bash 1 code . Abre el archivo docker-compose.yml : Bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 version: \"3.1\" services: db: image: mysql ports: - \"3306:3306\" command: --default-authentication-plugin = mysql_native_password environment: MYSQL_DATABASE: pruDB MYSQL_PASSWORD: dwes MYSQL_ROOT_PASSWORD: dwes volumes: - ./dump:/docker-entrypoint-initdb.d - ./conf:/etc/mysql/conf.d - persistent:/var/lib/mysql networks: - default www: build: . ports: - \"80:80\" volumes: - ./www:/var/www/html links: - db networks: - default phpmyadmin: image: phpmyadmin/phpmyadmin links: - db:db ports: - 8000 :80 environment: MYSQL_USER: root MYSQL_PASSWORD: dwes MYSQL_ROOT_PASSWORD: dwes volumes: persistent: El archivo docker-compose.yml normalmente comienza con la definici\u00f3n de la versi\u00f3n . Esto indicar\u00e1 a Docker Compose qu\u00e9 versi\u00f3n de la configuraci\u00f3n estamos usando. Luego tenemos el bloque services , donde configuramos los servicios que son parte de este entorno. En nuestro caso, tenemos un servicio llamado www , otro db y otro phpmyadmin . El servicio www utiliza la imagen . y establece una redirecci\u00f3n de puerto con la directiva ports . Todas las solicitudes en el puerto 8000 del equipo host (el sistema desde el cual est\u00e1 ejecutando Docker Compose) ser\u00e1n redirigidas al contenedor www en el puerto 80 . La directiva volumes crear\u00e1 un volumen compartido entre el equipo host y el contenedor. Esto compartir\u00e1 la carpeta www local con el contenedor, y el volumen se ubicar\u00e1 en /var/www/html dentro del contenedor, que luego sobreescribir\u00e1 la ra\u00edz predeterminada del documento para Apache. Hemos creado una p\u00e1gina demo index.php y un archivo docker-compose.yml para crear un entorno de servidor web en el contenedor que lo presentar\u00e1. En el siguiente paso, abriremos este entorno con Docker Compose.","title":"configurar un archivo docker-compose.yml"},{"location":"ud01/ud0101/#ejecutar-docker-compose","text":"Con el archivo docker-compose.yml implementado, podemos ejecutar Docker Compose para mostrar nuestro entorno. El siguiente comando descargar\u00e1 las im\u00e1genes Docker necesarias, crear\u00e1 un contenedor para el servicio web y ejecutar\u00e1 el entorno en contenedor en modo segundo plano: Bash 1 docker-compose up -d Docker Compose primero buscar\u00e1 la imagen definida en su sistema local, y si no puede encontrar la imagen, descargar\u00e1 la imagen desde Docker Hub. Ver\u00e1s un resultado como este: Bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 Output Creating network \"docker-lamp-main2_default\" with the default driver Creating volume \"docker-lamp-main2_persistent\" with default driver Building www [ + ] Building 2 .4s ( 11 /11 ) FINISHED ocker:default = > [ internal ] load build definition from Dockerfile 0 .0s = > = > transferring dockerfile: 611B 0 .0s = > [ internal ] load .dockerignore 0 .0s = > = > transferring context: 2B 0 .0s = > [ internal ] load metadata for docker.io/library/php:8.0.0-apache 2 .3s = > [ 1 /7 ] FROM docker.io/library/php:8.0.0-apache@sha256:d99ca98b9fe768 0 .0s = > CACHED [ 2 /7 ] RUN docker-php-ext-install mysqli 0 .0s = > CACHED [ 3 /7 ] RUN apt-get update && apt-get install -y sendmail libpng-dev && apt-get install -y libzip-dev && apt-get install -y zlib1g-dev && apt-get install -y 0 .0s = > CACHED [ 4 /7 ] RUN docker-php-ext-install mbstring 0 .0s = > CACHED [ 5 /7 ] RUN docker-php-ext-install zip 0 .0s = > CACHED [ 6 /7 ] RUN docker-php-ext-install gd 0 .0s = > CACHED [ 7 /7 ] RUN a2enmod rewrite 0 .0s = > exporting to image 0 .0s = > = > exporting layers 0 .0s = > = > writing image sha256:a35d05b133deb154d2188bf33e3 0 .0s = > = > naming to docker.io/library/docker-lamp-main2_www 0 .0s WARNING: Image for service www was built because it did not already exist. To rebuild this image you must use ` docker-compose build ` or ` docker-compose up --build ` . Creating docker-lamp-main2_db_1 ... done Creating docker-lamp-main2_www_1 ... done Creating docker-lamp-main2_phpmyadmin_1 ... done Tu entorno ahora est\u00e1 funcionando en segundo plano. Para verificar que el contenedor est\u00e1 activo, puede ejecutar: Bash 1 docker-compose ps Este comando le mostrar\u00e1 informaci\u00f3n sobre los contenedores en ejecuci\u00f3n y su estado, adem\u00e1s de cualquier redireccionamiento de puertos en vigor actualmente: Bash 1 2 3 4 5 6 Output Name Command State Ports --------------------------------------------------------------------------------------- docker-lamp-main2_db_1 docker-entrypoint.sh --def ... Exit 1 docker-lamp-main2_phpmyadmin_1 /docker-entrypoint.sh apac ... Up 0 .0.0.0:8000->80/tcp,:::8000->80/tcp docker-lamp-main2_www_1 docker-php-entrypoint apac ... Up 0 .0.0.0:80->80/tcp,:::80->80/tcp Ahora puedes acceder a la aplicaci\u00f3n demo apuntando tu servidor web a localhost:80 si est\u00e1s ejecutando esta demo en tu equipo local, o a :8000 si est\u00e1s ejecutando esta demo en un servidor remoto. Ver\u00e1s una p\u00e1gina como la siguiente: El volumen compartido que ha configurado en el archivo docker-compose.yml mantiene los archivos de tu carpeta www sincronizados con la ra\u00edz del documento del contenedor. Si realizas alg\u00fan cambio al archivo index.php , ser\u00e1n recogidos autom\u00e1icamente por el contenedor y se reflejar\u00e1n en tu navegador cuando vuelva a cargar la p\u00e1gina. En el siguiente paso, ver\u00e1s c\u00f3mo gestionar tu entorno en contenedor con los comandos de Docker Compose.","title":"ejecutar Docker Compose"},{"location":"ud01/ud0101/#parar-y-eliminar-imagen-base","text":"Cuando tienes contenedores Docker ejecut\u00e1ndose, primero necesitas detenerlos antes de borrarlos. Det\u00e9n todos los contenedores ejecut\u00e1ndose: Bash 1 $ sudo docker stop $( docker ps -a -q ) Elimina todos los contenedores detenidos: Bash 1 $ sudo docker rm $( docker ps -a -q )","title":"parar y Eliminar imagen base"},{"location":"ud01/ud0101/#limpieza-del-entorno-docker-prune","text":"Este comando nos ahorra la eliminaci\u00f3n manual de cada recurso permiti\u00e9ndonos hacer una limpieza general del entorno r\u00e1pidamente. Lo podemos utilizar de varias maneras: Elimina todos los contenedores frenados y redes no utilizadas. Tambi\u00e9n elimina las im\u00e1genes temporales. Bash 1 $ sudo docker system prune Elimina todas las im\u00e1genes no utilizadas por alg\u00fan contenedor . Bash 1 $ sudo docker system prune -a","title":"limpieza del entorno Docker: \u00a1prune!"},{"location":"ud01/ud0101/#paso-3-instalar-docker-desktop","text":"Con esta aplicaci\u00f3n ser\u00e1 la forma m\u00e1s sencilla de ejecutar, compilar, depurar y probar las aplicaciones Dockerized. El escritorio Docker consta de herramientas para desarrolladores , Aplicaci\u00f3n Docker , Kubernetes y sincronizaci\u00f3n de versiones. Nos permite crear im\u00e1genes y plantillas certificadas de nuestra elecci\u00f3n de idiomas y herramientas.","title":"paso 3. Instalar Docker Desktop"},{"location":"ud01/ud0101/#paso-4-instalar-docker-portainer","text":"ortainer es una forma c\u00f3moda de gestionar entornos de contenedores distribuidos . El software se instala como un contenedor Docker y, por tanto, se ejecuta pr\u00e1cticamente en cualquier lugar. Mostramos la rutina de instalaci\u00f3n y aportamos \u00fatiles consejos.","title":"paso 4. Instalar Docker Portainer"},{"location":"ud01/ud0101/#instalar","text":"Bash 1 2 $ sudo docker volume create portainer_data $ sudo docker run -d -p 9000 :9000 -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer","title":"instalar"},{"location":"ud01/ud0101/#lanzar","text":"Como otro contenedor, podremos acceder a \u00e9l mediante un navegador (Firefox, Chrome, ...) introduciendo la URL: localhost:9000 Si muestra el siguiente texto, debemos reiniciar el contenedor del Docker Portainer: Volvemos a acceder v\u00eda localhost:9000 :","title":"lanzar"},{"location":"ud01/ud0101/#funciona-como-un-docker","text":"Para ver el ID de contenedor podemos listar los contenedores: Bash 1 $ sudo docker ps -a Para parar el contenedor: Bash 1 $ sudo docker stop [ ID ] Para volver a lanzar el contenedor: Bash 1 $ sudo docker start [ ID ]","title":"funciona como un docker"},{"location":"ud01/ud0101/#bibliografia","text":"web digitalocean . canal Youtube DevOpsea . apuntes profesor Aitor Medrano https://aitor-medrano.github.io","title":"bibliograf\u00eda"},{"location":"ud02/ud02_ElLenguajePHP/","text":"Text Only 1 2 3 4 5 6 7 8 9 10 11 unit: unidad did\u00e1ctica 2 title: El lenguaje PHP language: ES author: Arturo Blasco subject: Desarrollo Web en Entornos Servidor keywords: [2023-2024, DWES, PHP] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${title} - ${subject} (ver: ${today}) footer:${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}/${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets \u00cdndice duraci\u00f3n y criterios de evaluaci\u00f3n PHP c\u00f3digo embebido Generando c\u00f3digo comentarios errores variables constantes operadores trabajando con formularios condiciones if switch operador ternario bucles while do-while for arrays arrays asociativos arrays bidimensionales funciones par\u00e1metros por referencia par\u00e1metros por defecto / opcionales par\u00e1metros variables argumentos con nombre funciones tipadas alcance alcance local alcance global funciones variable biblioteca de funciones plantillas mediante include funciones predefinidas cadenas operaciones b\u00e1sicas comparando y buscando Trabajando con subcadenas matem\u00e1ticas tipos de datos uso de regexp referencias duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada : 24 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Escribe sentencias ejecutables por un servidor Web reconociendo y aplicando procedimientos de integraci\u00f3n del c\u00f3digo en lenguajes de marcas. a) Se han reconocido los mecanismos de generaci\u00f3n de p\u00e1ginas Web a partir de lenguajes de marcas con c\u00f3digo embebido. b) Se han identificado las principales tecnolog\u00edas asociadas. c) Se han utilizado etiquetas para la inclusi\u00f3n de c\u00f3digo en el lenguaje de marcas. d) Se ha reconocido la sintaxis del lenguaje de programaci\u00f3n que se ha de utilizar. e) Se han escrito sentencias simples y se han comprobado sus efectos en el documento resultante. f) Se han utilizado directivas para modificar el comportamiento predeterminado. g) Se han utilizado los distintos tipos de variables y operadores disponibles en el lenguaje. h) Se han identificado los \u00e1mbitos de utilizaci\u00f3n de las variables. Escribe bloques de sentencias embebidos en lenguajes de marcas, seleccionando y utilizando las estructuras de programaci\u00f3n. a) Se han utilizado mecanismos de decisi\u00f3n en la creaci\u00f3n de bloques de sentencias. b) Se han utilizado bucles y se ha verificado su funcionamiento. c) Se han utilizado \u201carrays\u201d para almacenar y recuperar conjuntos de datos. d) Se han creado y utilizado funciones. e) Se han utilizado formularios web para interactuar con el usuario del navegador Web. f) Se han empleado m\u00e9todos para recuperar la informaci\u00f3n introducida en el formulario. g) Se han a\u00f1adido comentarios al c\u00f3digo. PHP Acr\u00f3nimo de P ersonal H ome P age. Lenguaje de prop\u00f3sito general, aunque su fuerte es el desarollo web. Sintaxis similar a C / Java. El c\u00f3digo se ejecuta en el servidor (en Apache mediante mod_php) El cliente recibe el resultado generado tras interpretar el c\u00f3digo en el servidor. El c\u00f3digo se almacena en archivo con extensi\u00f3n .php . La \u00faltima versi\u00f3n es la 8.2.8, de Julio de 2023. Adem\u00e1s de numerosas nuevas funcionalidades que iremos viendo durante el curso, tiene m\u00e1s de dos veces mejor rendimiento que PHP5. Su documentaci\u00f3n es extensa y est\u00e1 traducida: https://www.php.net/manual/es/. c\u00f3digo embebido Los bloques de c\u00f3digo se escriben entre <?php y ?> . Las sentencias se separan mediante ; . Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 <!DOCTYPE html> <html lang=\"es\"> <head> <meta charset=\"UTF-8\"> <title>PHP f\u00e1cil</title> </head> <body> <!-- Muestra una frase con HTML --> Hola mundo<br> <!-- Muestra una frase con PHP --> <?php echo \"Es muy f\u00e1cil programar en PHP.\"; ?> </body> </html> s\u00f3lo etiquetas de apertura: Si nuestro c\u00f3digo s\u00f3lo va a contener c\u00f3digo PHP y nada de html, como por ejemplo, cuando codifiquemos clases o interfaces , s\u00f3lo pondremos la etiqueta de apertura, para as\u00ed indicar que es una archivo de php puro. Generando c\u00f3digo Tenemos tres posibilidades a la hora de generar contenido en nuestros documentos PHP: echo expresi\u00f3n; <?= expresi\u00f3n ?> print (expresi\u00f3n); Las que vamos a utilizar son: echo cuando lo hagamos dentro de un bloque de instrucciones y <?= cuando s\u00f3lo vayamos a mostrar el valor de una variable dentro de un fragmento HTML. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 <!DOCTYPE html> <html lang=\"es\"> <head> <meta charset=\"UTF-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> <title>Echo y print</title> </head> <body> <p><?php echo \"Este texto se mostrar\u00e1 en la p\u00e1gina web.\"; ?></p> <p><?= \"Este texto se mostrar\u00e1 en la p\u00e1gina web.\" ?></p><br> <p><?php print(\"Este texto se mostrar\u00e1 en la p\u00e1gina web.\"); ?></p> </body> </html> comentarios Podemos utilizar comentarios de una l\u00ednea o de bloque: PHP 1 2 3 4 5 6 7 8 9 10 <?php // Este es un comentario de una sola l\u00ednea<br> /* Este es un comentario que ocupa varias l\u00edneas */ ?> Teclas r\u00e1pidas en VS Code: Ctrl + Shift + 7 . errores Si hay un error de ejecuci\u00f3n, se produce un Fatal Error . Bash 1 2 3 4 Fatal error: Uncaught Error: Call to undefined function plint () in C: \\x ampp \\h tdocs \\2 02echo.php:11 Stack trace: #0 {main} thrown in C: \\x ampp \\h tdocs \\2 02echo.php on line 11 Desde PHP 5 se lanzan como una excepci\u00f3n. M\u00e1s adelante veremos el uso de try / catch . variables No es necesario declararlas previamente. Comienzan por $ , por ejemplo $nombre , seguido de un caracter en letra min\u00fascula ( recomendaci\u00f3n ) o gui\u00f3n bajo _ . Luego ya se pueden poner n\u00fameros. Son case sensitive : $var != $vAR . No se declara su tipo, el tipado es din\u00e1mico. Se asigna en tiempo de ejecuci\u00f3n dependiendo del valor asignado. Conveniente: hay que inicializarlas, sino dan error. PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php $nombre = \"Marta\" ; $nombreCompleto = \"Marta L\u00f3pez\" ; $numero = 123 ; $numero2 = 456 ; $pi = 3.14 ; $suerte = true ; $sinValor ; $_1 = \"el primero\" ; echo $sinValor ; ?> tipos: Aunque a priori no hay tipos de datos, internamente PHP trabaja con: cuatro tipos escalares: boolean , integer , float y string, y cuatro tipos compuestos: array , object , callable e iterable . Existe un tipo especial para null (m\u00e1s informaci\u00f3n en http://php.net/manual/es/language.types.null.php). constantes Son variables cuyo valor no var\u00edan. Existen dos posibilidades: define(NOMBRE, valor); const NOMBRE; // PHP > 5.3 PHP 1 2 3 4 5 6 <?php define ( \"PI\" , 3.1416 ); const IVA = 0.21 ; echo PI , \" \" , IVA ; // No se pone el s\u00edmbolo dolar ?> Se declaran siempre en MAY\u00daSCULAS. Hay un conjunto de constantes ya predefinidas, tambi\u00e9n conocidas como magic constants : https://www.php.net/manual/es/language.constants.predefined.php. operadores trabajando con formularios Los datos se env\u00edan v\u00eda URL con el formato var1=valor1&var2=valor2\u2026 . Por ejemplo: ejemplo.php?nombre=Bruce&apellido1=Wayne Se divide en dos pasos: Generar un formulario con action='archivo.php' method='GET' En el archivo .php leer los datos con $_GET['nombreVar'] Vamos a separar siempre que podamos el c\u00f3digo HTML del de PHP. Por ejemplo, el formulario lo colocamos en saluda.html : Text Only 1 2 3 4 5 6 7 <form action=\"saluda.php\" method=\"get\"> <p><label for=\"nombre\">Nombre: </label> <input type=\"text\" name=\"nombre\" id=\"nombre\"></p> <p><label for=\"apellido1\">Primer apellido:</label> <input type=\"text\" name=\"apellido1\" id=\"apellido1\"></p> <p><input type=\"submit\" value=\"enviar\"></p> </form> Y recogemos los datos en saluda.php : PHP 1 2 3 4 5 6 <?php $nombre = $_GET [ \"nombre\" ]; $apellido1 = $_GET [ \"apellido1\" ]; echo \"Hola $nombre $apellido1 \" ; ?> Si lo quisi\u00e9ramos realizar todo en un \u00fanico archivo (lo cual no es recomendable), podemos hacerlo as\u00ed: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <form action=\"\" method=\"get\"> <p><label for=\"nombre\">Nombre: </label> <input type=\"text\" name=\"nombre\" id=\"nombre\"></p> <p><label for=\"apellido1\">Primer apellido:</label> <input type=\"text\" name=\"apellido1\" id=\"apellido1\"></p> <input type=\"submit\" value=\"enviar\"> </form> <p> <?php if(isset($_GET['nombre'])) { $nombre = $_GET[\"nombre\"]; $apellido1 = $_GET[\"apellido1\"]; echo \"Hola $nombre $apellido1\"; } ?> </p> El trabajo con formularios lo estudiaremos en profundidad en la unidad 4, y veremos que adem\u00e1s de GET , podemos enviar los datos con POST . condiciones if La condici\u00f3n simple se realiza mediante la instrucci\u00f3n if . Entre par\u00e9ntesis se pone la condici\u00f3n que se evalua a true o false. Si no se ponen llaves, en vez de abrir un bloque, se ejecutar\u00e1 s\u00f3lo la siguiente instrucci\u00f3n. siempre llaves Es recomendable poner llaves siempre aunque en el momento de codificar s\u00f3lo haya una \u00fanica instrucci\u00f3n. De este modo, se queda preparado para a\u00f1adir m\u00e1s contenido en el futuro sin provocar bugs . PHP 1 2 3 4 5 6 7 8 9 <?php $hora = 8 ; // La hora en formato de 24 horas if ( $hora === 8 ) { echo \"Suena el despertador.\" ; } echo \"<br>\" ; if ( $hora === 8 ) echo \"Suena el despertador.\" ; ?> Las condiciones compuestas mediante if-else : PHP 1 2 3 4 5 6 7 8 <?php $hora = 17 ; // La hora en formato de 24 horas if ( $hora <= 12 ) { echo \"Son las \" . $hora . \" de la ma\u00f1ana\" ; } else { echo \"Son las \" . ( $hora - 12 ) . \" de la tarde\" ; } ?> Las condiciones anidadas mediante if-else if-else : PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php $hora = 14 ; // La hora en formato de 24 horas if ( $hora === 8 ) { echo \"Es la hora de desayunar.\" ; } else if ( $hora === 14 ) { echo \"Es la hora de la comida.\" ; } else if ( $hora === 21 ) { echo \"Es la hora de la cena.\" ; } else { echo \"Ahora no toca comer.\" ; } ?> switch La sentencia switch tambi\u00e9n permite trabajar con condiciones m\u00faltiples: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php $hora = 14 ; // La hora en formato de 24 horas switch ( $hora ) { case 9 : echo \"Es la hora de desayunar.\" ; break ; case 14 : echo \"Es la hora de la comida.\" ; break ; case 21 : echo \"Es la hora de la cena.\" ; break ; default : echo \"Ahora no toca comer\" ; } ?> no olvides el break Un error muy com\u00fan es olvidar la instrucci\u00f3n break tras cada caso. Si no lo ponemos, ejecutar\u00e1 el siguiente caso autom\u00e1ticamente. operador ternario Finalmente, tambi\u00e9n tenemos el operador ternario condici\u00f3n ? valorTrue : valorFalse : PHP 1 2 3 4 5 <?php $hora = 14 ; $formato = ( $hora > 12 ) ? 24 : 12 ; echo \"El formato es de $formato horas\" ?> Si queremos comprobar si una variable tiene valor y si no darle un valor determinado, usaremos el operador ?: (se conoce como el operador Elvis - https://en.wikipedia.org/wiki/Elvis_operator) con la sint\u00e1xis expresi\u00f3n ?: valorSiVacio . PHP 1 2 3 4 5 6 7 8 <?php $nombre = \"\" ; echo \"Nombre: \" . ( $nombre ?: \"desconocido\" ) . PHP_EOL ; // se env\u00eda a trav\u00e9s de un formulario: // $nombre = \"\"; // $nombre = $_GET['nombre'] ?: \"desconocido\"; ?> bucles while Mediante la instrucci\u00f3n while : PHP 1 2 3 4 5 6 7 8 <?php $i = 1 ; while ( $i <= 10 ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; $i ++ ; } ?> do-while Mediante la instrucci\u00f3n do-while : PHP 1 2 3 4 5 6 7 8 9 10 <?php do { $dado = rand ( 1 , 6 ); // rand() devuelve un valor aleatorio echo \"Tirando el dado... \" ; echo \"ha salido un \" . $dado . \".\" ; echo \"<br>\" ; } while ( $dado != 5 ); echo \"\u00a1Bien! Saco una ficha de casa.\" ; ?> for Mediante la instrucci\u00f3n for : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php // Bucle ascendente for ( $i = 1 ; $i <= 10 ; $i ++ ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; } // Bucle descendente for ( $i = 10 ; $i >= 0 ; $i -- ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; } ?> M\u00e1s adelante estudiaremos el bucle foreach para recorrer arrays. PHP, del mismo modo que Java y C, permite romper los bucles mediante la instrucci\u00f3n break . A su vez, continue permite saltar a la siguiente iteraci\u00f3n. si puedes, evita break y continue Personalmente, no me gusta su uso. Prefiero el uso de variables flag para controlar la salida de los bucles. Por ejemplo: PHP 1 2 3 4 5 6 7 8 9 <?php $salir = false ; for ( $i = 1 ; $i <= 10 && ! $salir ; $i ++ ) { if ( $i === 5 ) { echo \"Salgo cuando i=5\" ; $salir = true ; } } ?> arrays Para almacenar datos compuestos, podemos utilizar tanto arrays sencillos como arrays asociativos (similares a un mapa ). En realidad todos los arrays son mapas ordenados compuestos de pares clave-valor . cuidado con mezclar tipos Como el tipado es din\u00e1mico, nuestros arrays pueden contener datos de diferentes tipos. No se recomienda mezclar los tipos. Del mismo modo que Java, se definen mediante corchetes, son 0-index , y se puede asignar un valor a un posici\u00f3n determinada: PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php // opci\u00f3n 1 $frutas = array ( \"naranja\" , \"pera\" , \"manzana\" ); // opci\u00f3n 2 $frutas2 = [ \"naranja\" , \"pera\" , \"manzana\" ]; // opci\u00f3n 3 $frutas3 = []; $frutas3 [ 0 ] = \"naranja\" ; $frutas3 [ 1 ] = \"pera\" ; $frutas3 [] = \"manzana\" ; // lo a\u00f1ade al final Podemos obtener el tama\u00f1o del array mediante la funci\u00f3n count(array) . Para recorrer el array haremos uso de un bucle for : PHP 1 2 3 4 5 6 <?php $tam = count ( $frutas ); // tama\u00f1o del array for ( $i = 0 ; $i < count ( $frutas ); $i ++ ) { echo \"Elemento $i : $frutas[$i] <br />\" ; } Otra forma de recorrer los arrays, incluso m\u00e1s elegante, es hacer uso de foreach . Su sintaxis es foreach (array as elemento) : PHP 1 2 3 4 5 <?php // mediante foreach no necesitamos saber el tama\u00f1o del array foreach ( $frutas as $elemento ) { echo \" $elemento <br />\" ; } arrays asociativos Cada elemento es un par clave-valor . En vez de acceder por la posici\u00f3n, lo hacemos mediante una clave. As\u00ed pues, para cada clave se almacena un valor. Se asigna de la siguiente forma dentro de los corchetes: clave => valor . A la hora de recorrer este tipo de arrays, mediante foreach separamos cada elemento en una pareja clave => valor: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 <?php $capitales = [ \"Italia\" => \"Roma\" , \"Francia\" => \"Paris\" , \"Portugal\" => \"Lisboa\" ]; $capitalFrancia = $capitales [ \"Francia\" ]; // se accede al elemento por la clave, no la posici\u00f3n $capitales [ \"Alemania\" ] = \"Berl\u00edn\" ; // a\u00f1adimos un elemento echo \"La capital de Francia es $capitalFrancia <br />\" ; echo \"La capital de Francia es { $capitales [ \"Francia\" ] } <br />\" ; $capitales [] = \"Madrid\" ; // se a\u00f1ade con la clave 0 !!! \u00a1\u00a1\u00a1NO ASIGNAR VALORES SIN CLAVE!!! foreach ( $capitales as $valor ) { // si recorremos un array asociativo, mostraremos los valores echo \" $valor <br />\" ; } foreach ( $capitales as $pais => $ciudad ) { // separamos cada elemento en clave => valor echo \" $pais : $ciudad <br />\" ; } arrays bidimensionales Consiste en un array de arrays, ya sean arrays secuenciales o asociativos. Puede haber N dimensiones. PHP 1 2 3 4 5 6 <?php $persona [ \"nombre\" ] = \"Bruce Wayne\" ; $persona [ \"telefonos\" ] = [ \"966 123 456\" , \"636 636 636\" ]; // array de arrays ordinarios $persona [ \"profesion\" ] = [ \"dia\" => \"fil\u00e1ntropo\" , \"noche\" => \"caballero oscuro\" ]; // array de arrays asociativos echo $persona [ 'nombre' ] . \" por la noche trabaja de \" . $persona [ 'profesion' ][ 'noche' ]; Combinando los arrays asociativos en varias dimensiones podemos almacenar la informaci\u00f3n como si fuera una tabla: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php $menu1 = [ \"Plato1\" => \"Macarrones con queso\" , \"Plato2\" => \"Pescado asado\" , \"Bebida\" => \"Coca-Cola\" , \"Postre\" => \"Helado de vainilla\" ]; $menu2 = [ \"Plato1\" => \"Sopa\" , \"Plato2\" => \"Lomo con patatas\" , \"Bebida\" => \"Agua\" , \"Postre\" => \"Arroz con leche\" ]; $menus = [ $menu1 , $menu2 ]; // creamos un array a partir de arrays asociativos echo \"Men\u00fa del d\u00eda<br/>\" ; $cont = 0 ; foreach ( $menus as $menudeldia ) { echo \"<br />Men\u00fa \" .++ $cont . \"<br />\" ; foreach ( $menudeldia as $platos => $comida ) { echo \" $platos : $comida <br/>\" ; } } // Para acceder a un elemento concreto se anidan los corchetes $postre0 = $menus [ 0 ][ \"Postre\" ]; Aunque pueda parecer una buena idea crear este tipo de estructuras, es mejor utilizar objetos conjuntamente con arrays (posiblemente arrays de otros objetos) para crear estructuras complejas que permitan modelar mejor los problemas. funciones Al no declararse los tipos de datos, los par\u00e1metros de las funciones no tienen tipo ni se indica el tipo de dato que devuelven. El paso de par\u00e1metros se realiza por valor , es decir, se realiza una copia de la variable. PHP 1 2 3 4 5 6 7 8 <?php function nombreFuncion ( $par1 , $par2 , ... ) { // c\u00f3digo return $valor ; } $resultado = nombreFuncion ( $arg1 , $arg2 , \u2026 ); ?> Por ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 <?php function diaSemana () { $semana = [ \"lunes\" , \"martes\" , \"mi\u00e9rcoles\" , \"jueves\" , \"viernes\" , \"s\u00e1bado\" , \"domingo\" ]; $dia = $semana [ rand ( 0 , 6 )]; return $dia ; } $diaCine = diaSemana (); echo \"El pr\u00f3ximo $diaCine voy al cine.\" ; ?> par\u00e1metros por referencia Si queremos pasar un par\u00e1metro por referencia, en la declaraci\u00f3n de la funci\u00f3n, indicaremos los par\u00e1metros mediante el operador & para indicar la direcci\u00f3n de memoria de la variable. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php function duplicarPorValor ( $argumento ) { $argumento = $argumento * 2 ; echo \"Dentro de la funci\u00f3n: $argumento .<br>\" ; } function duplicarPorReferencia ( & $argumento ) { $argumento = $argumento * 2 ; echo \"Dentro de la funci\u00f3n: $argumento .<br>\" ; } $numero1 = 5 ; echo \"Paso de par\u00e1metros por valor:<br/>\" ; echo \"Antes de llamar: $numero1 .<br>\" ; duplicarPorValor ( $numero1 ); echo \"Despu\u00e9s de llamar: $numero1 .<br>\" ; echo \"<br>\" ; $numero2 = 7 ; echo \"Paso de par\u00e1metros por referencia:<br/>\" ; echo \"Antes de llamar: $numero2 .<br>\" ; duplicarPorReferencia ( $numero2 ); echo \"Despu\u00e9s de llamar: $numero2 .<br>\" ; ?> par\u00e1metros por defecto / opcionales Permiten asignar valores en la declaraci\u00f3n, y posteriormente, dejar el argumento en blanco. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php function obtenerCapital ( $pais = \"todos\" ) { $capitales = array ( \"Italia\" => \"Roma\" , \"Francia\" => \"Paris\" , \"Portugal\" => \"Lisboa\" ); if ( $pais == \"todos\" ) { return array_values ( $capitales ); } else { return $capitales [ $pais ]; } } print_r ( obtenerCapital ()); echo \"<br/>\" ; echo obtenerCapital ( \"Francia\" ); En el caso de convivir con otro tipo de par\u00e1metros, los par\u00e1metros que tienen el valor asignado por defecto siempre se colocan al final. PHP 1 2 3 4 5 6 7 8 <?php function saluda ( $nombre , $prefijo = \"Sr\" ) { echo \"Hola \" . $prefijo . \" \" . $nombre ; } saluda ( \"Aitor\" , \"Mr\" ); saluda ( \"Aitor\" ); saluda ( \"Marina\" , \"Srta\" ); par\u00e1metros variables Podemos tener funciones donde en la declaraci\u00f3n no indiquemos la cantidad de datos de entrada. $arrayArgs = func_get_args(); \u2192 Obtiene un array con los par\u00e1metros. $cantidad = func_num_args(); \u2192 Obtiene la cantidad de par\u00e1metros recibidos. $valor = func_get_arg(numArgumento); \u2192 Obtiene el par\u00e1metro que ocupa la posici\u00f3n numArgumento . Estas funciones no se pueden pasar como par\u00e1metro a otra funci\u00f3n (como funciones variable, que veremos m\u00e1s adelante). Para ello, debemos guardar previamente la funci\u00f3n en una variable. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php function sumaParametros () { if ( func_num_args () == 0 ) { return false ; } else { $suma = 0 ; for ( $i = 0 ; $i < func_num_args (); $i ++ ) { $suma += func_get_arg ( $i ); } return $suma ; } } echo sumaParametros ( 1 , 5 , 9 ); // 15 ?> Desde PHP 5.6, se puede utilizar el operador ... ( variadics ) el cual \"disfraza\" los par\u00e1metros como un array: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php function sumaParametrosMejor ( ... $numeros ) { if ( count ( $numeros ) == 0 ) { return false ; } else { $suma = 0 ; foreach ( $numeros as $num ) { $suma += $num ; } return $suma ; } } echo sumaParametrosMejor ( 1 , 5 , 9 ); // 15 ?> m\u00e1s usos de ... Tambi\u00e9n se puede utilizar para dividir un array en variables separadas para proporcionar argumentos: PHP 1 2 3 4 5 6 7 8 9 10 <?php function suma ( $a , $b ) { return $a + $b ; } echo suma ( ... [ 1 , 5 ]) . \"<br />\" ; $a = [ 1 , 5 ]; echo suma ( ... $a ); ?> argumentos con nombre Desde PHP 8.0 podemos pasar los argumentos con el nombre (adem\u00e1s de por posici\u00f3n, como hemos hecho hasta ahora). Los argumentos con nombre se pasan poniendo el nombre como prefijo del par\u00e1metro separado por dos puntos: $resultado = funcion( arg1 : valor1, arg2 : valor2 ); Esta caracter\u00edstica complementa los par\u00e1metros opcionales permiti\u00e9ndonos saltar su valor: PHP 1 2 3 4 5 <?php function funcionArgumentosNombre ( $a , $b = 2 , $c = 4 ) { echo \" $a $b $c \" ; } funcionArgumentosNombre ( c : 3 , a : 1 ); // \"1 2 3\" Tanto los par\u00e1metros opcionales como los obligatorios pueden tener nombre, pero los argumentos con nombre se tienen que poner despu\u00e9s de los que no lo tienen. PHP 1 2 <?php funcionArgumentosNombre ( 1 , c : 3 ); // \"1 2 3\" funciones tipadas Desde PHP7 en las funciones, tanto los par\u00e1metros como su devoluci\u00f3n, permiten la definici\u00f3n de tipos. Esto se conoce como strict_types (tipificaci\u00f3n estricta) y hay que definirlo en la primera l\u00ednea de cada archivo .php para que el propio interprete PHP compruebe los tipos y lance errores si los tipos son incorrectos, mediante la sentencia: PHP 1 2 <?php declare ( strict_types = 1 ); As\u00ed pues, vamos a definir los tipos de los par\u00e1metros y de los valores devueltos mediante los tipos: int , float , string , bool , object y array . Si una funci\u00f3n no devuelve nada se indica mediante el tipo void . PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php declare ( strict_types = 1 ); function suma ( int $a , int $b ) : int { return $a + $b ; } $num = 33 ; echo suma ( 10 , 30 ); echo suma ( 10 , $num ); echo suma ( \"10\" , 30 ); // error por tipificaci\u00f3n estricta, sino dar\u00eda 40 ?> alcance Las variables definidas fuera de las funciones tienen alcance global : accesibles desde cualquier funci\u00f3n. Los par\u00e1metros de una funci\u00f3n y las variables declaradas dentro de una funci\u00f3n (se conocen como variables locales ) s\u00f3lo son accesibles desde dentro de la misma funci\u00f3n \u2192 alcance de funci\u00f3n . En caso de conflicto, tienen prioridad las variables locales. Para evitar el conflicto, dentro de la funci\u00f3n, podemos declarar la variable como global . alcance local PHP 1 2 3 4 5 6 7 8 9 10 11 <?php function miCiudad () { $ciudad = \"Elche\" ; echo \"Dentro de la funci\u00f3n: $ciudad .<br>\" ; } $ciudad = \"Alicante\" ; echo \"Antes de la funci\u00f3n: $ciudad .<br>\" ; miCiudad (); echo \"Despu\u00e9s de la funci\u00f3n: $ciudad .<br>\" ?> alcance global PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php function miCiudad () { global $ciudad ; $ciudad = \"Elche\" ; echo \"Dentro de la funci\u00f3n: $ciudad .<br>\" ; } $ciudad = \"Alicante\" ; echo \"Antes de llamar: $ciudad .<br>\" ; miCiudad (); echo \"Despu\u00e9s de llamar: $ciudad .<br>\" ?> no globales Hay que evitar el uso de variables globales dentro de las funciones. En el caso de necesitarlas, es mejor pasarlas como par\u00e1metro a las funciones. funciones variable Permite asignar una funci\u00f3n a una variable. Nombre de la funci\u00f3n entre comillas. Si una variable va seguida de par\u00e9ntesis, PHP buscar\u00e1 una funci\u00f3n con su valor. PHP 1 2 3 4 <?php $miFuncionSuma = \"suma\" ; echo $miFuncionSuma ( 3 , 4 ); // invoca a la funci\u00f3n suma ?> funciones an\u00f3nimas PHP permite la definici\u00f3n y uso de funciones an\u00f3nimas, es decir, funciones que no tienen nombre, y se utilizan principalmente para gestionar los callbacks . Este tipo de funciones se utiliza mucho en Javascript para gestionar los eventos y promesas. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php $anonima = function () { echo \"Hola\" ; }; $anonima (); $anonimaConParametro = function ( $nombre ) { echo \"Hola \" . $nombre ; }; $anonimaConParametro ( \"Aitor\" ); // Uso de variables externas a la funci\u00f3n an\u00f3nima --> `use` $mensaje = \"Hola\" ; $miClosure = function () use ( $mensaje ) { echo $mensaje ; }; $miClosure (); // Uso de par\u00e1metros $holaPHP = function ( $arg ) use ( $mensaje ) { echo $mensaje . \" \" . $arg ; }; $holaPHP ( \"PHP\" ); ?> Desde PHP 7.4 se han introducido las funciones flecha ( arrow functions ) para simplificar su definici\u00f3n y uso. Ten\u00e9is m\u00e1s informaci\u00f3n sobre funciones an\u00f3nimas y flecha en el siguiente art\u00edculo (en ingl\u00e9s): Funciones an\u00f3nimas y flecha en PHP . biblioteca de funciones Podemos agrupar un conjunto de funciones en un archivo, para permitir su reutilizaci\u00f3n. Posteriormente, se incluye con: include(archivo); / include_once(archivo); require(archivo); / require_once(archivo); Si no encuentra el archivo, require lanza un error fatal, include lo ignora. Las funciones _once s\u00f3lo se cargan una vez, si ya ha sido incluida previamente, no lo vuelve a hacer, evitando bucles. Por ejemplo, colocamos las funciones en el archivo biblioteca.php : PHP 1 2 3 4 5 6 7 8 9 <?php function suma ( int $a , int $b ) : int { return $a + $b ; } function resta ( int $a , int $b ) : int { return $a - $b ; } ? Y posteriormente en otro archivo: PHP 1 2 3 4 5 <?php include_once ( \"biblioteca.php\" ); echo suma ( 10 , 20 ); echo resta ( 40 , 20 ); ?> plantillas mediante include Mediante el uso de la instrucci\u00f3n include tambi\u00e9n podemos separar fragmentos de c\u00f3digo PHP/HTML que queramos reutilizar en nuestros sitios web y crear un sistema muy sencillo de plantillas. Por ejemplo, vamos a separar una p\u00e1gina en tres partes, primero la parte superior en encabezado.php : PHP 1 2 3 4 5 6 7 8 <!DOCTYPE html> <html lang=\"es\"> <head> <meta charset=\"UTF-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> <title> <? = $titulo ?> </title> </head> <body> La parte de abajo, por ejemplo, solo va a contener HTML y la colocamos en pie.html : PHP 1 2 3 <footer>Profesor/a X</footer> </body> </html> Y luego nos centramos \u00fanicamente en el contenido que cambia en pagina.php : PHP 1 2 3 4 5 6 7 8 9 10 <?php $titulo = \"P\u00e1gina con includes\" ; include ( \"encabezado.php\" ); ?> <h1> <? = $titulo ?> </h1> <?php include ( \"pie.html\" ); ?> funciones predefinidas El lenguaje ofrece un abanico de funciones ya definidas, agrupadas por su funcionalidad: https://www.php.net/manual/es/funcref.php. cadenas Ya hemos visto que se pueden crear con comillas simples ( '' , sin interpretaci\u00f3n) o comillas dobles ( \"\" , interpretan el contenido y las secuencias de escape \\n , \\t , \\$ , { , \u2026 - magic quotes ): PHP 1 2 3 4 <?php \"Me llamo $nombre \" \"Son 30 { $moneda } s\" ?> Se acceden a los caracteres como si fuera un array. PHP 1 2 3 4 <?php $cadena = \u201cYo soy Batman\u201d ; $ygriega = $cadena [ 0 ]; ?> Adem\u00e1s de echo, podemos mostrar las cadenas mediante la funci\u00f3n printf . Esta funci\u00f3n viene heredada del lenguaje C, y en la cadena se indica el tipo de dato a formatear y genera una salida formateada. Si queremos guardar el resultado en una variable, podemos utilizar sprintf . PHP 1 2 3 4 5 6 7 <?php $num = 33 ; $nombre = \"Larry Bird\" ; printf ( \"%s llevaba el n\u00famero %d\" , $nombre , $num ); // %d -> n\u00famero decimal, %s -> string $frase = sprintf ( \"%s llevaba el n\u00famero %d\" , $nombre , $num ); echo $frase ; ?> Tenemos muchos m\u00e1s ejemplos en https://www.w3schools.com/php/func_string_printf.asp operaciones b\u00e1sicas Todas las funciones se pueden consultar en https://www.php.net/manual/es/ref.strings.php Las m\u00e1s importantes son: strlen : obtiene la longitud de una cadena y devuelve un n\u00famero entero. substr : devuelve una subcadena de la cadena original. str_replace : reemplaza caracteres en una cadena. strtolower y strtoupper : Transforman una cadena de caracteres en la misma cadena en min\u00fasculas o may\u00fasculas respectivamente. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php $cadena = \"El caballero oscuro\" ; $tam = strlen ( $cadena ); echo \"La longitud de ' $cadena ' es: $tam <br />\" ; $oscuro = substr ( $cadena , 13 ); // desde 13 al final $caba = substr ( $cadena , 3 , 4 ); // desde 3, 4 letras $katman = str_replace ( \"c\" , \"k\" , $cadena ); echo \" $oscuro $caba ahora es $katman \" ; echo \"Grande \" . strtoupper ( $cadena ); ?> Si queremos trabajar con caracteres ASCII de forma individual, son \u00fatiles las funciones: chr : obtiene el car\u00e1cter a partir de un ASCII. ord : obtiene el ASCII de un car\u00e1cter. PHP 1 2 3 4 5 6 7 8 <?php function despues ( string $letra ) : string { $asciiLetra = ord ( $letra ); return chr ( $asciiLetra + 1 ); } echo despues ( \"B\" ); ?> Si queremos limpiar cadenas, tenemos las funciones: trim : elimina los espacios al principio y al final. ltrim / rtrim o chop : Elimina los espacios iniciales / finales de una cadena. str_pad : rellena la cadenas hasta una longitud especificada y con el car\u00e1cter o caracteres especificados. PHP 1 2 3 4 5 6 <?php $cadena = \" Programando en PHP \" ; $limpia = trim ( $cadena ); // \"Programando en PHP\" $sucia = str_pad ( $limpia , 23 , \".\" ); // \"Programando en PHP.....\" ?> comparando y buscando La comparaci\u00f3n de cadenas puede ser con conversi\u00f3n de tipos mediante == o estricta con === . Tambi\u00e9n funcionan los operadores < y > si ambas son cadenas. Al comparar cadenas con valores num\u00e9ricos podemos utilizar: strcmp : 0 iguales, <0 si a<b o >0 si a>b . strcasecmp : las pasa a min\u00fasculas y compara. strncmp / strncasecmp : compara los N primeros caracteres. strnatcmp : comparaciones naturales. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php $frase1 = \"Alfa\" ; $frase2 = \"Alfa\" ; $frase3 = \"Beta\" ; $frase4 = \"Alfa5\" ; $frase5 = \"Alfa10\" ; var_dump ( $frase1 == $frase2 ); // true var_dump ( $frase1 === $frase2 ); // true var_dump ( strcmp ( $frase1 , $frase2 ) ); // 0 var_dump ( strncmp ( $frase1 , $frase5 , 3 ) ); // 0 var_dump ( $frase2 < $frase3 ); // true var_dump ( strcmp ( $frase2 , $frase3 ) ); // -1 var_dump ( $frase4 < $frase5 ); // false var_dump ( strcmp ( $frase4 , $frase5 ) ); // 4 \u2192 f4 > f5 var_dump ( strnatcmp ( $frase4 , $frase5 ) ); // -1 \u2192 f4 < f5 ?> Si lo que queremos es buscar dentro de una cadena, tenemos: strpos / strrpos : busca en una cadena y devuelve la posici\u00f3n de la primera/\u00faltima ocurrencia. strstr / strchr (alias) : busca una cadena y devuelve la subcadena a partir de donde la ha encontrado. stristr : ignora las may\u00fasculas. PHP 1 2 3 4 5 6 <?php $frase = \"Quien busca encuentra, eso dicen, a veces\" ; $pos1 = strpos ( $frase , \",\" ); // encuentra la primera coma $pos2 = strrpos ( $frase , \",\" ); // encuentra la \u00faltima coma $trasComa = strstr ( $frase , \",\" ); // \", eso dicen, a veces\" ?> Si queremos averiguar qu\u00e9 contienen las cadenas, tenemos un conjunto de funciones de comprobaciones de tipo, se conocen como las funciones ctype que devuelven un booleano : ctype_alpha \u2192 letras ctype_alnum \u2192 alfanum\u00e9ricos ctype_digit \u2192 d\u00edgitos ctype_punct \u2192 caracteres de puntuaci\u00f3n, sin espacios ctype_space \u2192 son espacios, tabulador, salto de l\u00ednea PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php $prueba1 = \"hola\" ; $prueba2 = \"hola33\" ; $prueba3 = \"33\" ; $prueba4 = \",.()[]\" ; $prueba5 = \" ,.()[]\" ; echo ctype_alpha ( $prueba1 ) . \"<br>\" ; // true echo ctype_alnum ( $prueba2 ) . \"<br>\" ; // true echo ctype_digit ( $prueba3 ) . \"<br>\" ; // true echo ctype_punct ( $prueba4 ) . \"<br>\" ; // true echo ctype_space ( $prueba5 ) . \"<br>\" ; // false echo ctype_space ( $prueba5 [ 0 ]) . \"<br>\" ; // true ?> Trabajando con subcadenas Si queremos romper las cadenas en trozos, tenemos: explode : convierte en array la cadena mediante un separador. implode / join : pasa un array a cadena con un separador. str_split / chunk_split : pasa una cadena a una array/cadena cada X caracteres. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php $frase = \"Quien busca encuentra, eso dicen, a veces\" ; $partes = explode ( \",\" , $frase ); // SALIDA: [\"Quien busca encuentra\",\"eso dicen\",\"a veces\"] $ciudades = [ \"Elche\" , \"Aspe\" , \"Alicante\" ]; $cadenaCiudades = implode ( \">\" , $ciudades ); // SALIDA: \"Elche>Aspe>Alicante\"; $partes3cadena = chunk_split ( $frase , 3 ); // SALIDA: un string // \"Qui en bus ca enc uen tra , e so dic en, a vec es \" $partes3array = str_split ( $frase , 3 ); // SALIDA: un array // [\"Qui\", \"en \", \"bus\", \"ca \", \"enc\", \u2026] ?> Si queremos trabajar con tokens: strtok(cadena, separador) . y dentro del bucle: strtok(separador) . Finalmente, para separarla en base al formato: sscanf : al rev\u00e9s que sprintf , crea un array a partir de la cadena y el patr\u00f3n. Finalmente, otras operaciones que podemos realizar para trabajar con subcadenas son: substr_count : n\u00famero de veces que aparece la subcadena dentro de la cadena. substr_replace : reemplaza parte de la cadena a partir de su posici\u00f3n, y opcionalmente, longitud. PHP 1 2 3 4 5 6 7 8 9 10 <?php $batman = \"Bruce Wayne es Batman\" ; $empresa = substr ( $batman , 6 , 5 ); // Wayne $bes = substr_count ( $batman , \"B\" ); // 2 // Bruce Wayne es camarero $camarero1 = substr_replace ( $batman , \"camarero\" , 15 ); $camarero2 = substr_replace ( $batman , \"camarero\" , - 6 ); // quita 6 desde el final // Bruno es Batman $bruno = substr_replace ( $batman , \"Bruno\" , 0 , 11 ); ?> Tambi\u00e9n disponemos de una serie de funciones que facilitan las codificaciones desde y hacia HTML: htmlentities : convierte a entidades HTML, por ejemplo, \u00e1 por &aacute; , \u00f1 por &ntilde; , < por &lt; , etc.. htmlspecialchars : idem pero solo con los caracteres especiales ( & , \" , ' , < , > , ...) striptags : elimina etiquetas HTML. nl2br : cambia saltos de l\u00ednea por <br /> . rawurlencode / rawurldecode : codifica/decodifica una URL (espacios, ...). Estas funciones las utilizaremos en la unidad 4.- Programaci\u00f3n Web. matem\u00e1ticas Disponemos tanto de constantes como funciones ya definidas para trabajar con operaciones matem\u00e1ticas: https://www.php.net/manual/es/ref.math.php Constantes ya definidas: M_PI , M_E , M_EULER , M_LN2 , M_LOG2E PHP_INT_MAX , PHP_FLOAT_MAX Funciones de c\u00e1lculo: pow , sqrt , log , decbin , bindec , decoct , dechex , base_convert , max , min Funciones trigonom\u00e9tricas: sin , cos , tan , deg2rad , rad2deg Funciones para trabajar con n\u00fameros aleatorios: rand , mt_rand (m\u00e1s r\u00e1pida). Aunque la mayor\u00eda de ellas son muy espec\u00edficas de problemas matem\u00e1ticos / estad\u00edsticos, es muy com\u00fan que tengamos que redondear y/o formatear los c\u00e1lculos antes de mostrarlos al usuario. Mediante la funci\u00f3n number_format(numero, cantidadDecimales, separadorDecimales, separadorMiles) podemos pasar n\u00fameros a cadena con decimales y/o separadores de decimales y/o de miles. PHP 1 2 3 4 5 <?php $nf = 1234.5678 ; echo number_format ( $nf , 2 ); // 1,234.57 echo number_format ( $nf , 2 , \"M\" , \"#\" ); // 1#234M57 ?> Para redondear, tenemos abs para el valor absoluto y round para redondear, ceil para aproximaci\u00f3n por exceso y floor por defecto. PHP 1 2 3 4 5 6 7 8 9 10 <?php $num = 7.7 ; $siete = floor ( $num ); // SALIDA: 7 $ocho = ceil ( $num ); // SALIDA: 8 $otro = 4.49 ; $cuatro = round ( $otro ); // SALIDA: 4 $cuatrocinco = round ( $otro , 1 ); // SALIDA: 4.5 $cinco = round ( $cuatrocinco ); // SALIDA: 5 ?> tipos de datos Finalmente, para realizar conversiones de datos o si queremos trabajar con tipos de datos, tenemos las siguientes funciones: floatval , intval , strval : devuelve una variable del tipo de la funci\u00f3n indicada. settype : fuerza la conversi\u00f3n. gettype : obtiene el tipo. is_int , is_float , is_string , is_array , is_object : devuelve un booleano a partir del tipo recibido. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php $uno = 1 ; var_dump ( is_int ( $uno )); // true $unofloat = floatval ( $uno ); settype ( $uno , \"string\" ); var_dump ( is_int ( $uno )); // false var_dump ( is_string ( $uno )); // true settype ( $uno , \"float\" ); var_dump ( is_int ( $uno )); // false var_dump ( is_float ( $uno )); // true var_dump ( is_int ( intval ( $uno ))); // true ?> uso de regexp Regexp ( Expresiones regulares ) son una secuencia de caracteres que define un patr\u00f3n de b\u00fasqueda -> regex Muy \u00fatil tanto para buscar como para reemplazar texto (que es el tipo de datos m\u00e1s com\u00fan en la web). Algunos caracteres tienen un comportamiento especial (por ejemplo el punto), el resto se comportan como lo que son (por ejemplo una a). Toda expresi\u00f3n regular se comporta como un aut\u00f3mata finito, es decir, tiene un flujo de an\u00e1lisis de izquierda a derecha. Caracteres Especiales Cualquier caracter ( . ) vs un caracter concreto (por ejemplo la a ) vs un caracter de un rango (por ejemplo [abc] ). Los corchetes [] tambi\u00e9n sirven para que busque el caracter literal o usar rangos con el s\u00edmbolo - . P.ej [a.] , que buscar\u00eda el caracter . o [a-d] que buscar\u00eda a, b,c o d . Los caracteres cuantificadores ( ? , + , * ) se usan para expresar la cantidad de caracteres que pueden aparecer. Se puede hasta especificar la cantidad m\u00ednima y m\u00e1xima concreta con caracter llave. P.ej. {3,10}. La alternancia se puede usar con corchete con el car\u00e1cter / . Pero / es m\u00e1s \u00fatil porque sirve para expresiones concretas, p.ej ( hola/adios ). Se pueden definir principio ( ^ ) y fin ( $ ) de l\u00ednea. ^ tiene un comportamiento especial dentro de corchetes (es el operador not ). Para agrupar se usan par\u00e9ntesis () . Cada grupo a veces se puede numerar o ponerle un nombre (depende de la aplicaci\u00f3n). Algunos tutoriales muy buenos: Uno completo en v\u00eddeo (pero mejor no usar agrupaciones de caracteres): Uno para leer Uno del soporte de ayuda de Google Dise\u00f1ar y usar regexp: Hay muchos ejemplos muy \u00fatiles ( por ejemplo aqu\u00ed ). Si ya te quieres poner a profundizar, puedes revisar REGEX101 . En PHP se puede usar de diferentes maneras ( puedes probar ). Ojo que hay ligeras variaciones entre el uso de regexp en diferentes aplicaciones sobre todo con la agrupaci\u00f3n de caracteres gen\u00e9ricos (d\u00edgitos, palabras, l\u00edneas, etc). aprender expresiones regulares Hay millones de ejemplos, pero en esto 10 ejercicios. \u00bfQu\u00e9 cadenas de texto encontrar\u00edan las siguientes regexp? 1) hola 2) h.?a 3) h+b. 4) [2-4]?[3-9ag] 5) aju{2,8}m[-.]z 6) (ad)+juju.[0-9]?- 7) (ho|la)?[4-7zu] 8) [([0-4][0-9]|5[0-2])[0-9]{3} . C\u00f3digos Postales Espa\u00f1a 9) ^.{3,32}#[0-9]{4}$ . Usuario Discord 10) (b25[0-5]|b2[0-4][0-9]|b[01]?[0-9][0-9]?)(.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3} . Direcci\u00f3n ipv4. b es un delimitador de palabra \u00abboundary\u00bb. referencias Manual de PHP PHP en 2020 , por Jes\u00fas Amieiro Apuntes de PHP de Bartolom\u00e9 Sintes, profesor del IES Abastos de Valencia Gu\u00eda de Estilo - PSR PHP - La manera correcta","title":"ud02 ElLenguajePHP"},{"location":"ud02/ud02_ElLenguajePHP/#duracion-y-criterios-de-evaluacion","text":"Duraci\u00f3n estimada : 24 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Escribe sentencias ejecutables por un servidor Web reconociendo y aplicando procedimientos de integraci\u00f3n del c\u00f3digo en lenguajes de marcas. a) Se han reconocido los mecanismos de generaci\u00f3n de p\u00e1ginas Web a partir de lenguajes de marcas con c\u00f3digo embebido. b) Se han identificado las principales tecnolog\u00edas asociadas. c) Se han utilizado etiquetas para la inclusi\u00f3n de c\u00f3digo en el lenguaje de marcas. d) Se ha reconocido la sintaxis del lenguaje de programaci\u00f3n que se ha de utilizar. e) Se han escrito sentencias simples y se han comprobado sus efectos en el documento resultante. f) Se han utilizado directivas para modificar el comportamiento predeterminado. g) Se han utilizado los distintos tipos de variables y operadores disponibles en el lenguaje. h) Se han identificado los \u00e1mbitos de utilizaci\u00f3n de las variables. Escribe bloques de sentencias embebidos en lenguajes de marcas, seleccionando y utilizando las estructuras de programaci\u00f3n. a) Se han utilizado mecanismos de decisi\u00f3n en la creaci\u00f3n de bloques de sentencias. b) Se han utilizado bucles y se ha verificado su funcionamiento. c) Se han utilizado \u201carrays\u201d para almacenar y recuperar conjuntos de datos. d) Se han creado y utilizado funciones. e) Se han utilizado formularios web para interactuar con el usuario del navegador Web. f) Se han empleado m\u00e9todos para recuperar la informaci\u00f3n introducida en el formulario. g) Se han a\u00f1adido comentarios al c\u00f3digo.","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud02/ud02_ElLenguajePHP/#php","text":"Acr\u00f3nimo de P ersonal H ome P age. Lenguaje de prop\u00f3sito general, aunque su fuerte es el desarollo web. Sintaxis similar a C / Java. El c\u00f3digo se ejecuta en el servidor (en Apache mediante mod_php) El cliente recibe el resultado generado tras interpretar el c\u00f3digo en el servidor. El c\u00f3digo se almacena en archivo con extensi\u00f3n .php . La \u00faltima versi\u00f3n es la 8.2.8, de Julio de 2023. Adem\u00e1s de numerosas nuevas funcionalidades que iremos viendo durante el curso, tiene m\u00e1s de dos veces mejor rendimiento que PHP5. Su documentaci\u00f3n es extensa y est\u00e1 traducida: https://www.php.net/manual/es/.","title":"PHP"},{"location":"ud02/ud02_ElLenguajePHP/#codigo-embebido","text":"Los bloques de c\u00f3digo se escriben entre <?php y ?> . Las sentencias se separan mediante ; . Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 <!DOCTYPE html> <html lang=\"es\"> <head> <meta charset=\"UTF-8\"> <title>PHP f\u00e1cil</title> </head> <body> <!-- Muestra una frase con HTML --> Hola mundo<br> <!-- Muestra una frase con PHP --> <?php echo \"Es muy f\u00e1cil programar en PHP.\"; ?> </body> </html> s\u00f3lo etiquetas de apertura: Si nuestro c\u00f3digo s\u00f3lo va a contener c\u00f3digo PHP y nada de html, como por ejemplo, cuando codifiquemos clases o interfaces , s\u00f3lo pondremos la etiqueta de apertura, para as\u00ed indicar que es una archivo de php puro.","title":"c\u00f3digo embebido"},{"location":"ud02/ud02_ElLenguajePHP/#generando-codigo","text":"Tenemos tres posibilidades a la hora de generar contenido en nuestros documentos PHP: echo expresi\u00f3n; <?= expresi\u00f3n ?> print (expresi\u00f3n); Las que vamos a utilizar son: echo cuando lo hagamos dentro de un bloque de instrucciones y <?= cuando s\u00f3lo vayamos a mostrar el valor de una variable dentro de un fragmento HTML. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 <!DOCTYPE html> <html lang=\"es\"> <head> <meta charset=\"UTF-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> <title>Echo y print</title> </head> <body> <p><?php echo \"Este texto se mostrar\u00e1 en la p\u00e1gina web.\"; ?></p> <p><?= \"Este texto se mostrar\u00e1 en la p\u00e1gina web.\" ?></p><br> <p><?php print(\"Este texto se mostrar\u00e1 en la p\u00e1gina web.\"); ?></p> </body> </html>","title":"Generando c\u00f3digo"},{"location":"ud02/ud02_ElLenguajePHP/#comentarios","text":"Podemos utilizar comentarios de una l\u00ednea o de bloque: PHP 1 2 3 4 5 6 7 8 9 10 <?php // Este es un comentario de una sola l\u00ednea<br> /* Este es un comentario que ocupa varias l\u00edneas */ ?> Teclas r\u00e1pidas en VS Code: Ctrl + Shift + 7 .","title":"comentarios"},{"location":"ud02/ud02_ElLenguajePHP/#errores","text":"Si hay un error de ejecuci\u00f3n, se produce un Fatal Error . Bash 1 2 3 4 Fatal error: Uncaught Error: Call to undefined function plint () in C: \\x ampp \\h tdocs \\2 02echo.php:11 Stack trace: #0 {main} thrown in C: \\x ampp \\h tdocs \\2 02echo.php on line 11 Desde PHP 5 se lanzan como una excepci\u00f3n. M\u00e1s adelante veremos el uso de try / catch .","title":"errores"},{"location":"ud02/ud02_ElLenguajePHP/#variables","text":"No es necesario declararlas previamente. Comienzan por $ , por ejemplo $nombre , seguido de un caracter en letra min\u00fascula ( recomendaci\u00f3n ) o gui\u00f3n bajo _ . Luego ya se pueden poner n\u00fameros. Son case sensitive : $var != $vAR . No se declara su tipo, el tipado es din\u00e1mico. Se asigna en tiempo de ejecuci\u00f3n dependiendo del valor asignado. Conveniente: hay que inicializarlas, sino dan error. PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php $nombre = \"Marta\" ; $nombreCompleto = \"Marta L\u00f3pez\" ; $numero = 123 ; $numero2 = 456 ; $pi = 3.14 ; $suerte = true ; $sinValor ; $_1 = \"el primero\" ; echo $sinValor ; ?> tipos: Aunque a priori no hay tipos de datos, internamente PHP trabaja con: cuatro tipos escalares: boolean , integer , float y string, y cuatro tipos compuestos: array , object , callable e iterable . Existe un tipo especial para null (m\u00e1s informaci\u00f3n en http://php.net/manual/es/language.types.null.php).","title":"variables"},{"location":"ud02/ud02_ElLenguajePHP/#constantes","text":"Son variables cuyo valor no var\u00edan. Existen dos posibilidades: define(NOMBRE, valor); const NOMBRE; // PHP > 5.3 PHP 1 2 3 4 5 6 <?php define ( \"PI\" , 3.1416 ); const IVA = 0.21 ; echo PI , \" \" , IVA ; // No se pone el s\u00edmbolo dolar ?> Se declaran siempre en MAY\u00daSCULAS. Hay un conjunto de constantes ya predefinidas, tambi\u00e9n conocidas como magic constants : https://www.php.net/manual/es/language.constants.predefined.php.","title":"constantes"},{"location":"ud02/ud02_ElLenguajePHP/#operadores","text":"","title":"operadores"},{"location":"ud02/ud02_ElLenguajePHP/#trabajando-con-formularios","text":"Los datos se env\u00edan v\u00eda URL con el formato var1=valor1&var2=valor2\u2026 . Por ejemplo: ejemplo.php?nombre=Bruce&apellido1=Wayne Se divide en dos pasos: Generar un formulario con action='archivo.php' method='GET' En el archivo .php leer los datos con $_GET['nombreVar'] Vamos a separar siempre que podamos el c\u00f3digo HTML del de PHP. Por ejemplo, el formulario lo colocamos en saluda.html : Text Only 1 2 3 4 5 6 7 <form action=\"saluda.php\" method=\"get\"> <p><label for=\"nombre\">Nombre: </label> <input type=\"text\" name=\"nombre\" id=\"nombre\"></p> <p><label for=\"apellido1\">Primer apellido:</label> <input type=\"text\" name=\"apellido1\" id=\"apellido1\"></p> <p><input type=\"submit\" value=\"enviar\"></p> </form> Y recogemos los datos en saluda.php : PHP 1 2 3 4 5 6 <?php $nombre = $_GET [ \"nombre\" ]; $apellido1 = $_GET [ \"apellido1\" ]; echo \"Hola $nombre $apellido1 \" ; ?> Si lo quisi\u00e9ramos realizar todo en un \u00fanico archivo (lo cual no es recomendable), podemos hacerlo as\u00ed: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <form action=\"\" method=\"get\"> <p><label for=\"nombre\">Nombre: </label> <input type=\"text\" name=\"nombre\" id=\"nombre\"></p> <p><label for=\"apellido1\">Primer apellido:</label> <input type=\"text\" name=\"apellido1\" id=\"apellido1\"></p> <input type=\"submit\" value=\"enviar\"> </form> <p> <?php if(isset($_GET['nombre'])) { $nombre = $_GET[\"nombre\"]; $apellido1 = $_GET[\"apellido1\"]; echo \"Hola $nombre $apellido1\"; } ?> </p> El trabajo con formularios lo estudiaremos en profundidad en la unidad 4, y veremos que adem\u00e1s de GET , podemos enviar los datos con POST .","title":"trabajando con formularios"},{"location":"ud02/ud02_ElLenguajePHP/#condiciones","text":"","title":"condiciones"},{"location":"ud02/ud02_ElLenguajePHP/#if","text":"La condici\u00f3n simple se realiza mediante la instrucci\u00f3n if . Entre par\u00e9ntesis se pone la condici\u00f3n que se evalua a true o false. Si no se ponen llaves, en vez de abrir un bloque, se ejecutar\u00e1 s\u00f3lo la siguiente instrucci\u00f3n. siempre llaves Es recomendable poner llaves siempre aunque en el momento de codificar s\u00f3lo haya una \u00fanica instrucci\u00f3n. De este modo, se queda preparado para a\u00f1adir m\u00e1s contenido en el futuro sin provocar bugs . PHP 1 2 3 4 5 6 7 8 9 <?php $hora = 8 ; // La hora en formato de 24 horas if ( $hora === 8 ) { echo \"Suena el despertador.\" ; } echo \"<br>\" ; if ( $hora === 8 ) echo \"Suena el despertador.\" ; ?> Las condiciones compuestas mediante if-else : PHP 1 2 3 4 5 6 7 8 <?php $hora = 17 ; // La hora en formato de 24 horas if ( $hora <= 12 ) { echo \"Son las \" . $hora . \" de la ma\u00f1ana\" ; } else { echo \"Son las \" . ( $hora - 12 ) . \" de la tarde\" ; } ?> Las condiciones anidadas mediante if-else if-else : PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php $hora = 14 ; // La hora en formato de 24 horas if ( $hora === 8 ) { echo \"Es la hora de desayunar.\" ; } else if ( $hora === 14 ) { echo \"Es la hora de la comida.\" ; } else if ( $hora === 21 ) { echo \"Es la hora de la cena.\" ; } else { echo \"Ahora no toca comer.\" ; } ?>","title":"if"},{"location":"ud02/ud02_ElLenguajePHP/#switch","text":"La sentencia switch tambi\u00e9n permite trabajar con condiciones m\u00faltiples: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php $hora = 14 ; // La hora en formato de 24 horas switch ( $hora ) { case 9 : echo \"Es la hora de desayunar.\" ; break ; case 14 : echo \"Es la hora de la comida.\" ; break ; case 21 : echo \"Es la hora de la cena.\" ; break ; default : echo \"Ahora no toca comer\" ; } ?> no olvides el break Un error muy com\u00fan es olvidar la instrucci\u00f3n break tras cada caso. Si no lo ponemos, ejecutar\u00e1 el siguiente caso autom\u00e1ticamente.","title":"switch"},{"location":"ud02/ud02_ElLenguajePHP/#operador-ternario","text":"Finalmente, tambi\u00e9n tenemos el operador ternario condici\u00f3n ? valorTrue : valorFalse : PHP 1 2 3 4 5 <?php $hora = 14 ; $formato = ( $hora > 12 ) ? 24 : 12 ; echo \"El formato es de $formato horas\" ?> Si queremos comprobar si una variable tiene valor y si no darle un valor determinado, usaremos el operador ?: (se conoce como el operador Elvis - https://en.wikipedia.org/wiki/Elvis_operator) con la sint\u00e1xis expresi\u00f3n ?: valorSiVacio . PHP 1 2 3 4 5 6 7 8 <?php $nombre = \"\" ; echo \"Nombre: \" . ( $nombre ?: \"desconocido\" ) . PHP_EOL ; // se env\u00eda a trav\u00e9s de un formulario: // $nombre = \"\"; // $nombre = $_GET['nombre'] ?: \"desconocido\"; ?>","title":"operador ternario"},{"location":"ud02/ud02_ElLenguajePHP/#bucles","text":"","title":"bucles"},{"location":"ud02/ud02_ElLenguajePHP/#while","text":"Mediante la instrucci\u00f3n while : PHP 1 2 3 4 5 6 7 8 <?php $i = 1 ; while ( $i <= 10 ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; $i ++ ; } ?>","title":"while"},{"location":"ud02/ud02_ElLenguajePHP/#do-while","text":"Mediante la instrucci\u00f3n do-while : PHP 1 2 3 4 5 6 7 8 9 10 <?php do { $dado = rand ( 1 , 6 ); // rand() devuelve un valor aleatorio echo \"Tirando el dado... \" ; echo \"ha salido un \" . $dado . \".\" ; echo \"<br>\" ; } while ( $dado != 5 ); echo \"\u00a1Bien! Saco una ficha de casa.\" ; ?>","title":"do-while"},{"location":"ud02/ud02_ElLenguajePHP/#for","text":"Mediante la instrucci\u00f3n for : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php // Bucle ascendente for ( $i = 1 ; $i <= 10 ; $i ++ ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; } // Bucle descendente for ( $i = 10 ; $i >= 0 ; $i -- ) { echo \"L\u00ednea \" . $i ; echo \"<br>\" ; } ?> M\u00e1s adelante estudiaremos el bucle foreach para recorrer arrays. PHP, del mismo modo que Java y C, permite romper los bucles mediante la instrucci\u00f3n break . A su vez, continue permite saltar a la siguiente iteraci\u00f3n. si puedes, evita break y continue Personalmente, no me gusta su uso. Prefiero el uso de variables flag para controlar la salida de los bucles. Por ejemplo: PHP 1 2 3 4 5 6 7 8 9 <?php $salir = false ; for ( $i = 1 ; $i <= 10 && ! $salir ; $i ++ ) { if ( $i === 5 ) { echo \"Salgo cuando i=5\" ; $salir = true ; } } ?>","title":"for"},{"location":"ud02/ud02_ElLenguajePHP/#arrays","text":"Para almacenar datos compuestos, podemos utilizar tanto arrays sencillos como arrays asociativos (similares a un mapa ). En realidad todos los arrays son mapas ordenados compuestos de pares clave-valor . cuidado con mezclar tipos Como el tipado es din\u00e1mico, nuestros arrays pueden contener datos de diferentes tipos. No se recomienda mezclar los tipos. Del mismo modo que Java, se definen mediante corchetes, son 0-index , y se puede asignar un valor a un posici\u00f3n determinada: PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php // opci\u00f3n 1 $frutas = array ( \"naranja\" , \"pera\" , \"manzana\" ); // opci\u00f3n 2 $frutas2 = [ \"naranja\" , \"pera\" , \"manzana\" ]; // opci\u00f3n 3 $frutas3 = []; $frutas3 [ 0 ] = \"naranja\" ; $frutas3 [ 1 ] = \"pera\" ; $frutas3 [] = \"manzana\" ; // lo a\u00f1ade al final Podemos obtener el tama\u00f1o del array mediante la funci\u00f3n count(array) . Para recorrer el array haremos uso de un bucle for : PHP 1 2 3 4 5 6 <?php $tam = count ( $frutas ); // tama\u00f1o del array for ( $i = 0 ; $i < count ( $frutas ); $i ++ ) { echo \"Elemento $i : $frutas[$i] <br />\" ; } Otra forma de recorrer los arrays, incluso m\u00e1s elegante, es hacer uso de foreach . Su sintaxis es foreach (array as elemento) : PHP 1 2 3 4 5 <?php // mediante foreach no necesitamos saber el tama\u00f1o del array foreach ( $frutas as $elemento ) { echo \" $elemento <br />\" ; }","title":"arrays"},{"location":"ud02/ud02_ElLenguajePHP/#arrays-asociativos","text":"Cada elemento es un par clave-valor . En vez de acceder por la posici\u00f3n, lo hacemos mediante una clave. As\u00ed pues, para cada clave se almacena un valor. Se asigna de la siguiente forma dentro de los corchetes: clave => valor . A la hora de recorrer este tipo de arrays, mediante foreach separamos cada elemento en una pareja clave => valor: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 <?php $capitales = [ \"Italia\" => \"Roma\" , \"Francia\" => \"Paris\" , \"Portugal\" => \"Lisboa\" ]; $capitalFrancia = $capitales [ \"Francia\" ]; // se accede al elemento por la clave, no la posici\u00f3n $capitales [ \"Alemania\" ] = \"Berl\u00edn\" ; // a\u00f1adimos un elemento echo \"La capital de Francia es $capitalFrancia <br />\" ; echo \"La capital de Francia es { $capitales [ \"Francia\" ] } <br />\" ; $capitales [] = \"Madrid\" ; // se a\u00f1ade con la clave 0 !!! \u00a1\u00a1\u00a1NO ASIGNAR VALORES SIN CLAVE!!! foreach ( $capitales as $valor ) { // si recorremos un array asociativo, mostraremos los valores echo \" $valor <br />\" ; } foreach ( $capitales as $pais => $ciudad ) { // separamos cada elemento en clave => valor echo \" $pais : $ciudad <br />\" ; }","title":"arrays asociativos"},{"location":"ud02/ud02_ElLenguajePHP/#arrays-bidimensionales","text":"Consiste en un array de arrays, ya sean arrays secuenciales o asociativos. Puede haber N dimensiones. PHP 1 2 3 4 5 6 <?php $persona [ \"nombre\" ] = \"Bruce Wayne\" ; $persona [ \"telefonos\" ] = [ \"966 123 456\" , \"636 636 636\" ]; // array de arrays ordinarios $persona [ \"profesion\" ] = [ \"dia\" => \"fil\u00e1ntropo\" , \"noche\" => \"caballero oscuro\" ]; // array de arrays asociativos echo $persona [ 'nombre' ] . \" por la noche trabaja de \" . $persona [ 'profesion' ][ 'noche' ]; Combinando los arrays asociativos en varias dimensiones podemos almacenar la informaci\u00f3n como si fuera una tabla: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php $menu1 = [ \"Plato1\" => \"Macarrones con queso\" , \"Plato2\" => \"Pescado asado\" , \"Bebida\" => \"Coca-Cola\" , \"Postre\" => \"Helado de vainilla\" ]; $menu2 = [ \"Plato1\" => \"Sopa\" , \"Plato2\" => \"Lomo con patatas\" , \"Bebida\" => \"Agua\" , \"Postre\" => \"Arroz con leche\" ]; $menus = [ $menu1 , $menu2 ]; // creamos un array a partir de arrays asociativos echo \"Men\u00fa del d\u00eda<br/>\" ; $cont = 0 ; foreach ( $menus as $menudeldia ) { echo \"<br />Men\u00fa \" .++ $cont . \"<br />\" ; foreach ( $menudeldia as $platos => $comida ) { echo \" $platos : $comida <br/>\" ; } } // Para acceder a un elemento concreto se anidan los corchetes $postre0 = $menus [ 0 ][ \"Postre\" ]; Aunque pueda parecer una buena idea crear este tipo de estructuras, es mejor utilizar objetos conjuntamente con arrays (posiblemente arrays de otros objetos) para crear estructuras complejas que permitan modelar mejor los problemas.","title":"arrays bidimensionales"},{"location":"ud02/ud02_ElLenguajePHP/#funciones","text":"Al no declararse los tipos de datos, los par\u00e1metros de las funciones no tienen tipo ni se indica el tipo de dato que devuelven. El paso de par\u00e1metros se realiza por valor , es decir, se realiza una copia de la variable. PHP 1 2 3 4 5 6 7 8 <?php function nombreFuncion ( $par1 , $par2 , ... ) { // c\u00f3digo return $valor ; } $resultado = nombreFuncion ( $arg1 , $arg2 , \u2026 ); ?> Por ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 <?php function diaSemana () { $semana = [ \"lunes\" , \"martes\" , \"mi\u00e9rcoles\" , \"jueves\" , \"viernes\" , \"s\u00e1bado\" , \"domingo\" ]; $dia = $semana [ rand ( 0 , 6 )]; return $dia ; } $diaCine = diaSemana (); echo \"El pr\u00f3ximo $diaCine voy al cine.\" ; ?>","title":"funciones"},{"location":"ud02/ud02_ElLenguajePHP/#parametros-por-referencia","text":"Si queremos pasar un par\u00e1metro por referencia, en la declaraci\u00f3n de la funci\u00f3n, indicaremos los par\u00e1metros mediante el operador & para indicar la direcci\u00f3n de memoria de la variable. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php function duplicarPorValor ( $argumento ) { $argumento = $argumento * 2 ; echo \"Dentro de la funci\u00f3n: $argumento .<br>\" ; } function duplicarPorReferencia ( & $argumento ) { $argumento = $argumento * 2 ; echo \"Dentro de la funci\u00f3n: $argumento .<br>\" ; } $numero1 = 5 ; echo \"Paso de par\u00e1metros por valor:<br/>\" ; echo \"Antes de llamar: $numero1 .<br>\" ; duplicarPorValor ( $numero1 ); echo \"Despu\u00e9s de llamar: $numero1 .<br>\" ; echo \"<br>\" ; $numero2 = 7 ; echo \"Paso de par\u00e1metros por referencia:<br/>\" ; echo \"Antes de llamar: $numero2 .<br>\" ; duplicarPorReferencia ( $numero2 ); echo \"Despu\u00e9s de llamar: $numero2 .<br>\" ; ?>","title":"par\u00e1metros por referencia"},{"location":"ud02/ud02_ElLenguajePHP/#parametros-por-defecto-opcionales","text":"Permiten asignar valores en la declaraci\u00f3n, y posteriormente, dejar el argumento en blanco. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php function obtenerCapital ( $pais = \"todos\" ) { $capitales = array ( \"Italia\" => \"Roma\" , \"Francia\" => \"Paris\" , \"Portugal\" => \"Lisboa\" ); if ( $pais == \"todos\" ) { return array_values ( $capitales ); } else { return $capitales [ $pais ]; } } print_r ( obtenerCapital ()); echo \"<br/>\" ; echo obtenerCapital ( \"Francia\" ); En el caso de convivir con otro tipo de par\u00e1metros, los par\u00e1metros que tienen el valor asignado por defecto siempre se colocan al final. PHP 1 2 3 4 5 6 7 8 <?php function saluda ( $nombre , $prefijo = \"Sr\" ) { echo \"Hola \" . $prefijo . \" \" . $nombre ; } saluda ( \"Aitor\" , \"Mr\" ); saluda ( \"Aitor\" ); saluda ( \"Marina\" , \"Srta\" );","title":"par\u00e1metros por defecto / opcionales"},{"location":"ud02/ud02_ElLenguajePHP/#parametros-variables","text":"Podemos tener funciones donde en la declaraci\u00f3n no indiquemos la cantidad de datos de entrada. $arrayArgs = func_get_args(); \u2192 Obtiene un array con los par\u00e1metros. $cantidad = func_num_args(); \u2192 Obtiene la cantidad de par\u00e1metros recibidos. $valor = func_get_arg(numArgumento); \u2192 Obtiene el par\u00e1metro que ocupa la posici\u00f3n numArgumento . Estas funciones no se pueden pasar como par\u00e1metro a otra funci\u00f3n (como funciones variable, que veremos m\u00e1s adelante). Para ello, debemos guardar previamente la funci\u00f3n en una variable. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php function sumaParametros () { if ( func_num_args () == 0 ) { return false ; } else { $suma = 0 ; for ( $i = 0 ; $i < func_num_args (); $i ++ ) { $suma += func_get_arg ( $i ); } return $suma ; } } echo sumaParametros ( 1 , 5 , 9 ); // 15 ?> Desde PHP 5.6, se puede utilizar el operador ... ( variadics ) el cual \"disfraza\" los par\u00e1metros como un array: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php function sumaParametrosMejor ( ... $numeros ) { if ( count ( $numeros ) == 0 ) { return false ; } else { $suma = 0 ; foreach ( $numeros as $num ) { $suma += $num ; } return $suma ; } } echo sumaParametrosMejor ( 1 , 5 , 9 ); // 15 ?> m\u00e1s usos de ... Tambi\u00e9n se puede utilizar para dividir un array en variables separadas para proporcionar argumentos: PHP 1 2 3 4 5 6 7 8 9 10 <?php function suma ( $a , $b ) { return $a + $b ; } echo suma ( ... [ 1 , 5 ]) . \"<br />\" ; $a = [ 1 , 5 ]; echo suma ( ... $a ); ?>","title":"par\u00e1metros variables"},{"location":"ud02/ud02_ElLenguajePHP/#argumentos-con-nombre","text":"Desde PHP 8.0 podemos pasar los argumentos con el nombre (adem\u00e1s de por posici\u00f3n, como hemos hecho hasta ahora). Los argumentos con nombre se pasan poniendo el nombre como prefijo del par\u00e1metro separado por dos puntos: $resultado = funcion( arg1 : valor1, arg2 : valor2 ); Esta caracter\u00edstica complementa los par\u00e1metros opcionales permiti\u00e9ndonos saltar su valor: PHP 1 2 3 4 5 <?php function funcionArgumentosNombre ( $a , $b = 2 , $c = 4 ) { echo \" $a $b $c \" ; } funcionArgumentosNombre ( c : 3 , a : 1 ); // \"1 2 3\" Tanto los par\u00e1metros opcionales como los obligatorios pueden tener nombre, pero los argumentos con nombre se tienen que poner despu\u00e9s de los que no lo tienen. PHP 1 2 <?php funcionArgumentosNombre ( 1 , c : 3 ); // \"1 2 3\"","title":"argumentos con nombre"},{"location":"ud02/ud02_ElLenguajePHP/#funciones-tipadas","text":"Desde PHP7 en las funciones, tanto los par\u00e1metros como su devoluci\u00f3n, permiten la definici\u00f3n de tipos. Esto se conoce como strict_types (tipificaci\u00f3n estricta) y hay que definirlo en la primera l\u00ednea de cada archivo .php para que el propio interprete PHP compruebe los tipos y lance errores si los tipos son incorrectos, mediante la sentencia: PHP 1 2 <?php declare ( strict_types = 1 ); As\u00ed pues, vamos a definir los tipos de los par\u00e1metros y de los valores devueltos mediante los tipos: int , float , string , bool , object y array . Si una funci\u00f3n no devuelve nada se indica mediante el tipo void . PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php declare ( strict_types = 1 ); function suma ( int $a , int $b ) : int { return $a + $b ; } $num = 33 ; echo suma ( 10 , 30 ); echo suma ( 10 , $num ); echo suma ( \"10\" , 30 ); // error por tipificaci\u00f3n estricta, sino dar\u00eda 40 ?>","title":"funciones tipadas"},{"location":"ud02/ud02_ElLenguajePHP/#alcance","text":"Las variables definidas fuera de las funciones tienen alcance global : accesibles desde cualquier funci\u00f3n. Los par\u00e1metros de una funci\u00f3n y las variables declaradas dentro de una funci\u00f3n (se conocen como variables locales ) s\u00f3lo son accesibles desde dentro de la misma funci\u00f3n \u2192 alcance de funci\u00f3n . En caso de conflicto, tienen prioridad las variables locales. Para evitar el conflicto, dentro de la funci\u00f3n, podemos declarar la variable como global .","title":"alcance"},{"location":"ud02/ud02_ElLenguajePHP/#alcance-local","text":"PHP 1 2 3 4 5 6 7 8 9 10 11 <?php function miCiudad () { $ciudad = \"Elche\" ; echo \"Dentro de la funci\u00f3n: $ciudad .<br>\" ; } $ciudad = \"Alicante\" ; echo \"Antes de la funci\u00f3n: $ciudad .<br>\" ; miCiudad (); echo \"Despu\u00e9s de la funci\u00f3n: $ciudad .<br>\" ?>","title":"alcance local"},{"location":"ud02/ud02_ElLenguajePHP/#alcance-global","text":"PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php function miCiudad () { global $ciudad ; $ciudad = \"Elche\" ; echo \"Dentro de la funci\u00f3n: $ciudad .<br>\" ; } $ciudad = \"Alicante\" ; echo \"Antes de llamar: $ciudad .<br>\" ; miCiudad (); echo \"Despu\u00e9s de llamar: $ciudad .<br>\" ?> no globales Hay que evitar el uso de variables globales dentro de las funciones. En el caso de necesitarlas, es mejor pasarlas como par\u00e1metro a las funciones.","title":"alcance global"},{"location":"ud02/ud02_ElLenguajePHP/#funciones-variable","text":"Permite asignar una funci\u00f3n a una variable. Nombre de la funci\u00f3n entre comillas. Si una variable va seguida de par\u00e9ntesis, PHP buscar\u00e1 una funci\u00f3n con su valor. PHP 1 2 3 4 <?php $miFuncionSuma = \"suma\" ; echo $miFuncionSuma ( 3 , 4 ); // invoca a la funci\u00f3n suma ?> funciones an\u00f3nimas PHP permite la definici\u00f3n y uso de funciones an\u00f3nimas, es decir, funciones que no tienen nombre, y se utilizan principalmente para gestionar los callbacks . Este tipo de funciones se utiliza mucho en Javascript para gestionar los eventos y promesas. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php $anonima = function () { echo \"Hola\" ; }; $anonima (); $anonimaConParametro = function ( $nombre ) { echo \"Hola \" . $nombre ; }; $anonimaConParametro ( \"Aitor\" ); // Uso de variables externas a la funci\u00f3n an\u00f3nima --> `use` $mensaje = \"Hola\" ; $miClosure = function () use ( $mensaje ) { echo $mensaje ; }; $miClosure (); // Uso de par\u00e1metros $holaPHP = function ( $arg ) use ( $mensaje ) { echo $mensaje . \" \" . $arg ; }; $holaPHP ( \"PHP\" ); ?> Desde PHP 7.4 se han introducido las funciones flecha ( arrow functions ) para simplificar su definici\u00f3n y uso. Ten\u00e9is m\u00e1s informaci\u00f3n sobre funciones an\u00f3nimas y flecha en el siguiente art\u00edculo (en ingl\u00e9s): Funciones an\u00f3nimas y flecha en PHP .","title":"funciones variable"},{"location":"ud02/ud02_ElLenguajePHP/#biblioteca-de-funciones","text":"Podemos agrupar un conjunto de funciones en un archivo, para permitir su reutilizaci\u00f3n. Posteriormente, se incluye con: include(archivo); / include_once(archivo); require(archivo); / require_once(archivo); Si no encuentra el archivo, require lanza un error fatal, include lo ignora. Las funciones _once s\u00f3lo se cargan una vez, si ya ha sido incluida previamente, no lo vuelve a hacer, evitando bucles. Por ejemplo, colocamos las funciones en el archivo biblioteca.php : PHP 1 2 3 4 5 6 7 8 9 <?php function suma ( int $a , int $b ) : int { return $a + $b ; } function resta ( int $a , int $b ) : int { return $a - $b ; } ? Y posteriormente en otro archivo: PHP 1 2 3 4 5 <?php include_once ( \"biblioteca.php\" ); echo suma ( 10 , 20 ); echo resta ( 40 , 20 ); ?>","title":"biblioteca de funciones"},{"location":"ud02/ud02_ElLenguajePHP/#plantillas-mediante-include","text":"Mediante el uso de la instrucci\u00f3n include tambi\u00e9n podemos separar fragmentos de c\u00f3digo PHP/HTML que queramos reutilizar en nuestros sitios web y crear un sistema muy sencillo de plantillas. Por ejemplo, vamos a separar una p\u00e1gina en tres partes, primero la parte superior en encabezado.php : PHP 1 2 3 4 5 6 7 8 <!DOCTYPE html> <html lang=\"es\"> <head> <meta charset=\"UTF-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> <title> <? = $titulo ?> </title> </head> <body> La parte de abajo, por ejemplo, solo va a contener HTML y la colocamos en pie.html : PHP 1 2 3 <footer>Profesor/a X</footer> </body> </html> Y luego nos centramos \u00fanicamente en el contenido que cambia en pagina.php : PHP 1 2 3 4 5 6 7 8 9 10 <?php $titulo = \"P\u00e1gina con includes\" ; include ( \"encabezado.php\" ); ?> <h1> <? = $titulo ?> </h1> <?php include ( \"pie.html\" ); ?>","title":"plantillas mediante include"},{"location":"ud02/ud02_ElLenguajePHP/#funciones-predefinidas","text":"El lenguaje ofrece un abanico de funciones ya definidas, agrupadas por su funcionalidad: https://www.php.net/manual/es/funcref.php.","title":"funciones predefinidas"},{"location":"ud02/ud02_ElLenguajePHP/#cadenas","text":"Ya hemos visto que se pueden crear con comillas simples ( '' , sin interpretaci\u00f3n) o comillas dobles ( \"\" , interpretan el contenido y las secuencias de escape \\n , \\t , \\$ , { , \u2026 - magic quotes ): PHP 1 2 3 4 <?php \"Me llamo $nombre \" \"Son 30 { $moneda } s\" ?> Se acceden a los caracteres como si fuera un array. PHP 1 2 3 4 <?php $cadena = \u201cYo soy Batman\u201d ; $ygriega = $cadena [ 0 ]; ?> Adem\u00e1s de echo, podemos mostrar las cadenas mediante la funci\u00f3n printf . Esta funci\u00f3n viene heredada del lenguaje C, y en la cadena se indica el tipo de dato a formatear y genera una salida formateada. Si queremos guardar el resultado en una variable, podemos utilizar sprintf . PHP 1 2 3 4 5 6 7 <?php $num = 33 ; $nombre = \"Larry Bird\" ; printf ( \"%s llevaba el n\u00famero %d\" , $nombre , $num ); // %d -> n\u00famero decimal, %s -> string $frase = sprintf ( \"%s llevaba el n\u00famero %d\" , $nombre , $num ); echo $frase ; ?> Tenemos muchos m\u00e1s ejemplos en https://www.w3schools.com/php/func_string_printf.asp","title":"cadenas"},{"location":"ud02/ud02_ElLenguajePHP/#operaciones-basicas","text":"Todas las funciones se pueden consultar en https://www.php.net/manual/es/ref.strings.php Las m\u00e1s importantes son: strlen : obtiene la longitud de una cadena y devuelve un n\u00famero entero. substr : devuelve una subcadena de la cadena original. str_replace : reemplaza caracteres en una cadena. strtolower y strtoupper : Transforman una cadena de caracteres en la misma cadena en min\u00fasculas o may\u00fasculas respectivamente. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php $cadena = \"El caballero oscuro\" ; $tam = strlen ( $cadena ); echo \"La longitud de ' $cadena ' es: $tam <br />\" ; $oscuro = substr ( $cadena , 13 ); // desde 13 al final $caba = substr ( $cadena , 3 , 4 ); // desde 3, 4 letras $katman = str_replace ( \"c\" , \"k\" , $cadena ); echo \" $oscuro $caba ahora es $katman \" ; echo \"Grande \" . strtoupper ( $cadena ); ?> Si queremos trabajar con caracteres ASCII de forma individual, son \u00fatiles las funciones: chr : obtiene el car\u00e1cter a partir de un ASCII. ord : obtiene el ASCII de un car\u00e1cter. PHP 1 2 3 4 5 6 7 8 <?php function despues ( string $letra ) : string { $asciiLetra = ord ( $letra ); return chr ( $asciiLetra + 1 ); } echo despues ( \"B\" ); ?> Si queremos limpiar cadenas, tenemos las funciones: trim : elimina los espacios al principio y al final. ltrim / rtrim o chop : Elimina los espacios iniciales / finales de una cadena. str_pad : rellena la cadenas hasta una longitud especificada y con el car\u00e1cter o caracteres especificados. PHP 1 2 3 4 5 6 <?php $cadena = \" Programando en PHP \" ; $limpia = trim ( $cadena ); // \"Programando en PHP\" $sucia = str_pad ( $limpia , 23 , \".\" ); // \"Programando en PHP.....\" ?>","title":"operaciones b\u00e1sicas"},{"location":"ud02/ud02_ElLenguajePHP/#comparando-y-buscando","text":"La comparaci\u00f3n de cadenas puede ser con conversi\u00f3n de tipos mediante == o estricta con === . Tambi\u00e9n funcionan los operadores < y > si ambas son cadenas. Al comparar cadenas con valores num\u00e9ricos podemos utilizar: strcmp : 0 iguales, <0 si a<b o >0 si a>b . strcasecmp : las pasa a min\u00fasculas y compara. strncmp / strncasecmp : compara los N primeros caracteres. strnatcmp : comparaciones naturales. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php $frase1 = \"Alfa\" ; $frase2 = \"Alfa\" ; $frase3 = \"Beta\" ; $frase4 = \"Alfa5\" ; $frase5 = \"Alfa10\" ; var_dump ( $frase1 == $frase2 ); // true var_dump ( $frase1 === $frase2 ); // true var_dump ( strcmp ( $frase1 , $frase2 ) ); // 0 var_dump ( strncmp ( $frase1 , $frase5 , 3 ) ); // 0 var_dump ( $frase2 < $frase3 ); // true var_dump ( strcmp ( $frase2 , $frase3 ) ); // -1 var_dump ( $frase4 < $frase5 ); // false var_dump ( strcmp ( $frase4 , $frase5 ) ); // 4 \u2192 f4 > f5 var_dump ( strnatcmp ( $frase4 , $frase5 ) ); // -1 \u2192 f4 < f5 ?> Si lo que queremos es buscar dentro de una cadena, tenemos: strpos / strrpos : busca en una cadena y devuelve la posici\u00f3n de la primera/\u00faltima ocurrencia. strstr / strchr (alias) : busca una cadena y devuelve la subcadena a partir de donde la ha encontrado. stristr : ignora las may\u00fasculas. PHP 1 2 3 4 5 6 <?php $frase = \"Quien busca encuentra, eso dicen, a veces\" ; $pos1 = strpos ( $frase , \",\" ); // encuentra la primera coma $pos2 = strrpos ( $frase , \",\" ); // encuentra la \u00faltima coma $trasComa = strstr ( $frase , \",\" ); // \", eso dicen, a veces\" ?> Si queremos averiguar qu\u00e9 contienen las cadenas, tenemos un conjunto de funciones de comprobaciones de tipo, se conocen como las funciones ctype que devuelven un booleano : ctype_alpha \u2192 letras ctype_alnum \u2192 alfanum\u00e9ricos ctype_digit \u2192 d\u00edgitos ctype_punct \u2192 caracteres de puntuaci\u00f3n, sin espacios ctype_space \u2192 son espacios, tabulador, salto de l\u00ednea PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php $prueba1 = \"hola\" ; $prueba2 = \"hola33\" ; $prueba3 = \"33\" ; $prueba4 = \",.()[]\" ; $prueba5 = \" ,.()[]\" ; echo ctype_alpha ( $prueba1 ) . \"<br>\" ; // true echo ctype_alnum ( $prueba2 ) . \"<br>\" ; // true echo ctype_digit ( $prueba3 ) . \"<br>\" ; // true echo ctype_punct ( $prueba4 ) . \"<br>\" ; // true echo ctype_space ( $prueba5 ) . \"<br>\" ; // false echo ctype_space ( $prueba5 [ 0 ]) . \"<br>\" ; // true ?>","title":"comparando y buscando"},{"location":"ud02/ud02_ElLenguajePHP/#trabajando-con-subcadenas","text":"Si queremos romper las cadenas en trozos, tenemos: explode : convierte en array la cadena mediante un separador. implode / join : pasa un array a cadena con un separador. str_split / chunk_split : pasa una cadena a una array/cadena cada X caracteres. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php $frase = \"Quien busca encuentra, eso dicen, a veces\" ; $partes = explode ( \",\" , $frase ); // SALIDA: [\"Quien busca encuentra\",\"eso dicen\",\"a veces\"] $ciudades = [ \"Elche\" , \"Aspe\" , \"Alicante\" ]; $cadenaCiudades = implode ( \">\" , $ciudades ); // SALIDA: \"Elche>Aspe>Alicante\"; $partes3cadena = chunk_split ( $frase , 3 ); // SALIDA: un string // \"Qui en bus ca enc uen tra , e so dic en, a vec es \" $partes3array = str_split ( $frase , 3 ); // SALIDA: un array // [\"Qui\", \"en \", \"bus\", \"ca \", \"enc\", \u2026] ?> Si queremos trabajar con tokens: strtok(cadena, separador) . y dentro del bucle: strtok(separador) . Finalmente, para separarla en base al formato: sscanf : al rev\u00e9s que sprintf , crea un array a partir de la cadena y el patr\u00f3n. Finalmente, otras operaciones que podemos realizar para trabajar con subcadenas son: substr_count : n\u00famero de veces que aparece la subcadena dentro de la cadena. substr_replace : reemplaza parte de la cadena a partir de su posici\u00f3n, y opcionalmente, longitud. PHP 1 2 3 4 5 6 7 8 9 10 <?php $batman = \"Bruce Wayne es Batman\" ; $empresa = substr ( $batman , 6 , 5 ); // Wayne $bes = substr_count ( $batman , \"B\" ); // 2 // Bruce Wayne es camarero $camarero1 = substr_replace ( $batman , \"camarero\" , 15 ); $camarero2 = substr_replace ( $batman , \"camarero\" , - 6 ); // quita 6 desde el final // Bruno es Batman $bruno = substr_replace ( $batman , \"Bruno\" , 0 , 11 ); ?> Tambi\u00e9n disponemos de una serie de funciones que facilitan las codificaciones desde y hacia HTML: htmlentities : convierte a entidades HTML, por ejemplo, \u00e1 por &aacute; , \u00f1 por &ntilde; , < por &lt; , etc.. htmlspecialchars : idem pero solo con los caracteres especiales ( & , \" , ' , < , > , ...) striptags : elimina etiquetas HTML. nl2br : cambia saltos de l\u00ednea por <br /> . rawurlencode / rawurldecode : codifica/decodifica una URL (espacios, ...). Estas funciones las utilizaremos en la unidad 4.- Programaci\u00f3n Web.","title":"Trabajando con subcadenas"},{"location":"ud02/ud02_ElLenguajePHP/#matematicas","text":"Disponemos tanto de constantes como funciones ya definidas para trabajar con operaciones matem\u00e1ticas: https://www.php.net/manual/es/ref.math.php Constantes ya definidas: M_PI , M_E , M_EULER , M_LN2 , M_LOG2E PHP_INT_MAX , PHP_FLOAT_MAX Funciones de c\u00e1lculo: pow , sqrt , log , decbin , bindec , decoct , dechex , base_convert , max , min Funciones trigonom\u00e9tricas: sin , cos , tan , deg2rad , rad2deg Funciones para trabajar con n\u00fameros aleatorios: rand , mt_rand (m\u00e1s r\u00e1pida). Aunque la mayor\u00eda de ellas son muy espec\u00edficas de problemas matem\u00e1ticos / estad\u00edsticos, es muy com\u00fan que tengamos que redondear y/o formatear los c\u00e1lculos antes de mostrarlos al usuario. Mediante la funci\u00f3n number_format(numero, cantidadDecimales, separadorDecimales, separadorMiles) podemos pasar n\u00fameros a cadena con decimales y/o separadores de decimales y/o de miles. PHP 1 2 3 4 5 <?php $nf = 1234.5678 ; echo number_format ( $nf , 2 ); // 1,234.57 echo number_format ( $nf , 2 , \"M\" , \"#\" ); // 1#234M57 ?> Para redondear, tenemos abs para el valor absoluto y round para redondear, ceil para aproximaci\u00f3n por exceso y floor por defecto. PHP 1 2 3 4 5 6 7 8 9 10 <?php $num = 7.7 ; $siete = floor ( $num ); // SALIDA: 7 $ocho = ceil ( $num ); // SALIDA: 8 $otro = 4.49 ; $cuatro = round ( $otro ); // SALIDA: 4 $cuatrocinco = round ( $otro , 1 ); // SALIDA: 4.5 $cinco = round ( $cuatrocinco ); // SALIDA: 5 ?>","title":"matem\u00e1ticas"},{"location":"ud02/ud02_ElLenguajePHP/#tipos-de-datos","text":"Finalmente, para realizar conversiones de datos o si queremos trabajar con tipos de datos, tenemos las siguientes funciones: floatval , intval , strval : devuelve una variable del tipo de la funci\u00f3n indicada. settype : fuerza la conversi\u00f3n. gettype : obtiene el tipo. is_int , is_float , is_string , is_array , is_object : devuelve un booleano a partir del tipo recibido. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php $uno = 1 ; var_dump ( is_int ( $uno )); // true $unofloat = floatval ( $uno ); settype ( $uno , \"string\" ); var_dump ( is_int ( $uno )); // false var_dump ( is_string ( $uno )); // true settype ( $uno , \"float\" ); var_dump ( is_int ( $uno )); // false var_dump ( is_float ( $uno )); // true var_dump ( is_int ( intval ( $uno ))); // true ?>","title":"tipos de datos"},{"location":"ud02/ud02_ElLenguajePHP/#uso-de-regexp","text":"Regexp ( Expresiones regulares ) son una secuencia de caracteres que define un patr\u00f3n de b\u00fasqueda -> regex Muy \u00fatil tanto para buscar como para reemplazar texto (que es el tipo de datos m\u00e1s com\u00fan en la web). Algunos caracteres tienen un comportamiento especial (por ejemplo el punto), el resto se comportan como lo que son (por ejemplo una a). Toda expresi\u00f3n regular se comporta como un aut\u00f3mata finito, es decir, tiene un flujo de an\u00e1lisis de izquierda a derecha. Caracteres Especiales Cualquier caracter ( . ) vs un caracter concreto (por ejemplo la a ) vs un caracter de un rango (por ejemplo [abc] ). Los corchetes [] tambi\u00e9n sirven para que busque el caracter literal o usar rangos con el s\u00edmbolo - . P.ej [a.] , que buscar\u00eda el caracter . o [a-d] que buscar\u00eda a, b,c o d . Los caracteres cuantificadores ( ? , + , * ) se usan para expresar la cantidad de caracteres que pueden aparecer. Se puede hasta especificar la cantidad m\u00ednima y m\u00e1xima concreta con caracter llave. P.ej. {3,10}. La alternancia se puede usar con corchete con el car\u00e1cter / . Pero / es m\u00e1s \u00fatil porque sirve para expresiones concretas, p.ej ( hola/adios ). Se pueden definir principio ( ^ ) y fin ( $ ) de l\u00ednea. ^ tiene un comportamiento especial dentro de corchetes (es el operador not ). Para agrupar se usan par\u00e9ntesis () . Cada grupo a veces se puede numerar o ponerle un nombre (depende de la aplicaci\u00f3n). Algunos tutoriales muy buenos: Uno completo en v\u00eddeo (pero mejor no usar agrupaciones de caracteres): Uno para leer Uno del soporte de ayuda de Google Dise\u00f1ar y usar regexp: Hay muchos ejemplos muy \u00fatiles ( por ejemplo aqu\u00ed ). Si ya te quieres poner a profundizar, puedes revisar REGEX101 . En PHP se puede usar de diferentes maneras ( puedes probar ). Ojo que hay ligeras variaciones entre el uso de regexp en diferentes aplicaciones sobre todo con la agrupaci\u00f3n de caracteres gen\u00e9ricos (d\u00edgitos, palabras, l\u00edneas, etc). aprender expresiones regulares Hay millones de ejemplos, pero en esto 10 ejercicios. \u00bfQu\u00e9 cadenas de texto encontrar\u00edan las siguientes regexp? 1) hola 2) h.?a 3) h+b. 4) [2-4]?[3-9ag] 5) aju{2,8}m[-.]z 6) (ad)+juju.[0-9]?- 7) (ho|la)?[4-7zu] 8) [([0-4][0-9]|5[0-2])[0-9]{3} . C\u00f3digos Postales Espa\u00f1a 9) ^.{3,32}#[0-9]{4}$ . Usuario Discord 10) (b25[0-5]|b2[0-4][0-9]|b[01]?[0-9][0-9]?)(.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3} . Direcci\u00f3n ipv4. b es un delimitador de palabra \u00abboundary\u00bb.","title":"uso de regexp"},{"location":"ud02/ud02_ElLenguajePHP/#referencias","text":"Manual de PHP PHP en 2020 , por Jes\u00fas Amieiro Apuntes de PHP de Bartolom\u00e9 Sintes, profesor del IES Abastos de Valencia Gu\u00eda de Estilo - PSR PHP - La manera correcta","title":"referencias"},{"location":"ud02/ud02_ElLenguajePHP_actividades/","text":"Text Only 1 2 3 4 5 6 7 8 9 10 11 unit: unidad did\u00e1ctica 2 title: Actividades language: ES author: Arturo Blasco subject: Desarrollo Web en Entornos Servidor keywords: [2023-2024, DWES, PHP] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${title} - ${subject} (ver: ${today}) footer:${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}/${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets \u00cdndice Php b\u00e1sico bucles arrays funciones funciones predefinidas otros ejercicios ejercicios del concurso ACEPTA EL RETO Php b\u00e1sico Actividad 201 Visualiza el v\u00eddeo de Jes\u00fas Amieiro sobre PHP en 2020 a partir del minuto 3:32 (son 40 minutos aproximadamente). \u00bfQu\u00e9 relaci\u00f3n existe entre PHP y Facebook? Respecto al rendimiento, \u00bfqu\u00e9 versi\u00f3n m\u00ednima deber\u00edamos utilizar? \u00bfPor qu\u00e9 PHP tiene mala fama? Actividad 202 202tresfrases.php : Muestra 3 frases, cada una en un p\u00e1rrafo utilizando las tres posibilidades que existen de mostrar contenido. Tras ello, introduce dos comentarios, uno de bloque y otro de una l\u00ednea. Actividad 203 203calculos.php : Escribe un programa que utilice las variables $x y $y . As\u00edgnales los valores 166 y 999 respectivamente. A continuaci\u00f3n, muestra por pantalla el valor de cada variable, la suma, la resta, la divisi\u00f3n y la multiplicaci\u00f3n. Actividad 204 204datosPersonales.php : Escribe un programa que almacene en variables tu nombre, primer apellido, segundo apellido, email, a\u00f1o de nacimiento y tel\u00e9fono. Luego mu\u00e9stralos por pantalla dentro de una tabla. \u200b Actividad 205 205datosPersonales.html y 205datosPersonales.php : Es el mismo ejercicio que el anterior, pero separando la l\u00f3gica. En el primer archivo crearemos el formulario para introducir los datos, y luego recogemos los datos y generamos la tabla en el segundo archivo. Actividad 206 206madlib.html y 206madlib.php : A partir de un nombre, un verbo, un adjetivo y un adverbio, crea una historia que contenga dichos elementos. Por ejemplo: Entrada: perro / caminar / azul / r\u00e1pidamente Salida: \u00bf Te gusta caminar con tu perro azul r\u00e1pidamente ? 206madlib2.html y 206madlib2.php Crea un madlib m\u00e1s extenso, leyendo m\u00e1s datos de entrada. Actividad 207 207anyos.php : Tras leer la edad de una persona, mostrar la edad que tendr\u00e1 dentro de 10 a\u00f1os y hace 10 a\u00f1os. Adem\u00e1s, muestra qu\u00e9 a\u00f1o ser\u00e1 en cada uno de los casos. Finalmente, muestra el a\u00f1o de jubilaci\u00f3n suponiendo que trabajar\u00e1s hasta los 67 a\u00f1os. En este caso, no hace falta que previamente crees un formulario, puedes probar el ejercicio via URL: 207anyos.php?edad=33 . Nota : $anyoActual = date(\"Y\"); Actividad 208 208dinero.php : A partir de una cantidad de dinero, mostrar su descomposici\u00f3n en billetes (500, 200, 100, 50, 20, 10, 5) y monedas (2, 1), para que el n\u00famero de elementos sea m\u00ednimo. No se utilizar ninguna instrucci\u00f3n condicional. Por ejemplo, al introducir 139 debe mostrar: PHP 1 2 3 4 5 6 1 billete de 100 0 billete de 50 1 billete de 20 1 billete de 10 1 billete de 5 2 moneda de 2 Nota: Puedes forzar a realizar la divisi\u00f3n entera mediante la funci\u00f3n intdiv($dividendo, $divisor) o pasar un n\u00famero flotante a entero puedes usar la funci\u00f3n intval() . Actividad 209 209posnegcero.php : A partir de un numero, muestra por pantalla si el n\u00famero es positivo , negativo o cero . Actividad 210 210mayor3.php : Sin hacer uso de condiciones que utilicen dentro la condici\u00f3n los operadores l\u00f3gicos, muestra el mayor de tres n\u00fameros (a, b y c). 210mayor3c.php : Utiliza en las condiciones los operadores l\u00f3gicos. Actividad 211 211nombreEdad.php : A partir de una edad muestra por pantalla: beb\u00e9 si tiene menos de 3 a\u00f1os ni\u00f1o si tiene entre 3 y 12 a\u00f1os adolescente entre 13 y 17 a\u00f1os adulto entre 18 y 66 jubilado a partir de 67 Actividad 212 212reloj.php : Escribe un programa que funcione similar a un reloj, de manera que a partir de los valores de hora , minuto y segundo muestre la hora dentro de un segundo. Tras las 23:59:59 ser\u00e1n las 0:0:0 . Actividad 213 213calendario.php : Escribe un programa similar a un calendario de manera que a partir de dia , mes y anyo muestre la fecha dentro de un d\u00eda. Debes tener en cuenta que no todos los meses tienen 30 d\u00edas. En este caso, no vamos a tener en cuenta los a\u00f1os bisiestos. Actividad 214 214ecuacion2g.php : Crea un programa que resuelva una ecuaci\u00f3n de 2\u00ba grado del tipo ax\u00b2 + bx + c = 0 . Ten en cuenta que puede tener 2, 1 o no tener soluci\u00f3n dependiendo del valor del discriminante b\u00b2-4ac . Nota : Para calcular la ra\u00edz cuadrada deber\u00e1s utilizar la funci\u00f3n sqrt() . Actividad 215 Investiga para qu\u00e9 sirve el operador nave espacial, disponible desde PHP7 (https://www.php.net/manual/es/migration70.new-features.php). Explica con un par de l\u00edneas su prop\u00f3sito y mediante c\u00f3digo demuestra su uso. Actividad 216 Investiga para qu\u00e9 sirve la instrucci\u00f3n match() , disponible desde PHP8 (https://www.php.net/manual/es/control-structures.match.php). Explica con un par de lineas su prop\u00f3sito y mediante c\u00f3digo demuestra su uso. bucles Actividad 221 221pares050.php : Escribe un programa que muestre los n\u00fameros pares del 0 al 50 (dentro de una lista desordenada). 221paresAB.php : A partir del anterior, refactorizar para que funcione con inicio y fin . Actividad 222 222suma110.php : Escribe un programa que sume los n\u00fameros del 1 al 10. 222sumaAB.php : A partir del anterior, refactorizar para que funcione con inicio y fin . Actividad 223 223potencia.php : A partir de una base y exponente, mediante la acumulaci\u00f3n de productos, calcula la potencia utilizando la instrucci\u00f3n for . 223potenciaWhile.php : Reescribe el ejercicio anterior haciendo uso s\u00f3lo de while . 223potenciaDoWhile.php : Reescribe el ejercicio anterior haciendo uso s\u00f3lo de do-while . Actividad 224 224tablaMultiplicar.php : Muestra dentro de una tabla HTML la tabla de multiplicar del numero que reciba como par\u00e1metro. Utiliza <thead> con sus respectivos <th> y <tbody> para dibujar la tabla. Por ejemplo: a * b = a*b 7 * 1 = 7 7 * 2 = 14 ... 7 * 10 = 70 Actividad 225 225formulario.html : Crea un formulario que permita leer una cantidad. 225leerDatos.php : a partir de cantidad, prepara un formulario con tantas cajas de datos como su valor. Finalmente, en 225sumarDatos.php : a partir de los datos de todas las cajas de la p\u00e1gina anterior, s\u00famalos y muestra el total. A tener el cuenta : Para guardar un dato oculto puedes utilizar un campo de formulario de tipo oculto: <input type=\"hidden\" name=\"cantidad\" value=\"33\" /> . Actividad 226 226formulario.html y 226tabla.php : A partir de un n\u00famero de filas y columnas , crear una tabla con ese tama\u00f1o. Las celdas deben estar rellenadas con los valores de las coordenadas de cada celda. Actividad 227 227formulario.html y 227cuadrado.php : Bas\u00e1ndote en el ejercicio anterior, rellena la tabla de manera que solo los bordes tengan contenido, qued\u00e1ndose el resto de celdas en blanco. Actividad 228 228formulario.html y 228equis.php : Bas\u00e1ndote en el ejercicio anterior, ahora s\u00f3lo debe aparecer el contenido de los dos diagonales. Actividad 229 229cuadradoMultiplicar.php : Crea un programa que muestre por pantalla un cuadrado exactamente igual (f\u00edjate bien en los encabezados, tanto de las filas como de las columnas) al de la imagen con las tablas de multiplicar. arrays Actividad 231 231aleatorios50.php : Rellena un array con 50 n\u00fameros aleatorios comprendidos entre el 0 y el 99, y luego mu\u00e9stralo en una lista desordenada. Para crear un n\u00famero aleatorio, utiliza la funci\u00f3n rand(inicio, fin) . Por ejemplo: PHP 1 $num = rand(0, 99) Actividad 232 232bola8.html : Prepara un formulario con un caja de texto que realice a una pregunta al usuario. 232bola8.php : A partir del anterior, crea un programa que muestre la pregunta recibida y genere una respuesta de manera aleatoria entre un conjunto de respuestas predefinidas, almacenadas en un array: Si, no, quiz\u00e1s, claro que s\u00ed, por supuesto que no, no lo tengo claro, seguro, yo dir\u00eda que s\u00ed, ni de co\u00f1a, etc... Este ejercicio se basa en el juego de la Bola 8 m\u00e1gica . Actividad 233 233mates.php : A partir del ejercicio 230, genera un array aleatorio de 33 elementos con n\u00fameros comprendidos entre el 0 y 100 y calcula: El mayor El menor La media Actividad 234 234sexos.php : Rellena un array de 100 elementos de manera aleatoria con valores M o F (por ejemplo [\"M\", \"M\", \"F\", \"M\", ...] ). Una vez completado, vuelve a recorrerlo y calcula cuantos elementos hay de cada uno de los valores almacenando el resultado en un array asociativo ['M' => 44, 'F' => 66] (no utilices variables para contar las M o las F ). Finalmente, muestra el resultado por pantalla Actividad 235 235monedas.php : Vuelve a realizar el ejercicio 207, el de las monedas (500, 200, 100, 50, 20, 10, 5, 2, 1), pero haciendo uso de arrays y un bucle. Almacena el resultado en un array asociativo. Muestra el resultado en una lista desordenada \u00fanicamente con las cantidades que tienen alg\u00fan valor. Actividad 236 236alturas.php : Mediante un array asociativo, almacena el nombre y la altura de 5 personas ( nombre => altura ). Posteriormente, recorre el array y mu\u00e9stralo en una tabla HTML. Finalmente a\u00f1ade una \u00faltima fila a la tabla con la altura media. Actividad 237 237personas.php : Mediante un array bidimensional, almacena el nombre, altura y email de 5 personas. Para ello, crea un array de personas, siendo cada persona un array asociativo: [ ['nombre'=>'Aitor', 'altura'=>182, 'email'=>'aitor@correo.com'],[\u2026],\u2026 ] Posteriormente, recorre el array y mu\u00e9stralo en una tabla HTML. Actividad 238 238leerCantidad.html y 237leerPersonas.php : a partir de un formulario con un campo de cantidad de personas, generar un nuevo formulario para leer el nombre, altura y email de cantidad personas. 238gestionarPersonas.php : A partir de las personas introducidas, mostrar sus datos en una tabla, y posteriormente, destacar los datos del m\u00e1s alto y el del m\u00e1s bajo. Actividad 239 239tablaDistintos.php : Rellena un array bidimensional de 6 filas por 9 columnas con n\u00fameros aleatorios comprendidos entre 100 y 999 (ambos incluidos). Todos los n\u00fameros deben ser distintos, es decir, no se puede repetir ninguno. Muestra a continuaci\u00f3n por pantalla el contenido del array de tal forma que: La columna del m\u00e1ximo debe aparecer en azul. La fila del m\u00ednimo debe aparecer en verde El resto de nu\u0301meros deben aparecer en negro. funciones Actividad 241 241arrayPar.php : Crea las siguientes funciones: Una funci\u00f3n que averig\u00fce si un n\u00famero es par: esPar(int $num): bool Una funci\u00f3n que devuelva un array de tama\u00f1o $tam con n\u00fameros aleatorios comprendido entre $min y $max : arrayAleatorio(int $tam, int $min, int $max) : array Una funci\u00f3n que reciba un $array por referencia y devuelva la cantidad de n\u00fameros pares que hay almacenados: arrayPares(array &$array): int Actividad 242 242parametrosVariables.php : Crea las siguientes funciones: Una funci\u00f3n que devuelva el mayor de todos los n\u00fameros recibidos como par\u00e1metros: function mayor(): int . Utiliza las funciones func_get_args() , etc... No puedes usar la funci\u00f3n max() . Una funci\u00f3n que concatene todos los par\u00e1metros recibidos separ\u00e1ndolos con un espacio: function concatenar(...$palabras) : string . Utiliza el operador .... Actividad 243 243matematicas.php : A\u00f1ade las siguientes funciones: digitos(int $num): int \u2192 devuelve la cantidad de d\u00edgitos de un n\u00famero. digitoN(int $num, int $pos): int \u2192 devuelve el d\u00edgito que ocupa, empezando por la izquierda, la posici\u00f3n $pos . quitaPorDetras(int $num, int $cant): int \u2192 le quita por detr\u00e1s (derecha) $cant d\u00edgitos. quitaPorDelante(int $num, int $cant): int \u2192 le quita por delante (izquierda) $cant d\u00edgitos. Para probar las funciones, haz uso tanto de paso de argumentos posicionales como argumentos con nombre. Actividad 244 244biblioteca.php : crea un archivo con funciones para sumar, restar, multiplicar y dividir dos n\u00fameros. 244arrayFunciones.php : haciendo uso de un array que almacene el nombre de las funciones del archivo anterior, a partir de dos n\u00fameros recibidos por URL, recorre el array e invoca a las funciones de manera din\u00e1mica haciendo uso de funciones variable. Actividad 245 245euros.php : Crea una biblioteca con dos funciones: peseta2euros: pasa de pesetas a euros euros2pesetas: pasa de euros a pesetas Cada funci\u00f3n debe recibir dos par\u00e1metros: La cantidad a transformar La cotizaci\u00f3n, con un par\u00e1metro por defecto con el factor de transformaci\u00f3n. 245calculadoraEuros.php : utiliza 244euros.php y prueba las funciones pasando tanto cantidades con la cotizaci\u00f3n por defecto, como con nuevas cotizaciones. Recuerda que 1 euro son/eran 166.36 pesetas. Actividad 246 246preparaTiquetCompra.php : A partir de una cantidad de productos, leer el nombre y coste de la cantidad de productos indicados (similar al ejercicio 237, pero esta vez no hace falta crear el formulario con la cantidad, se recibe mediante un par\u00e1metro GET via URL). 246imprimeTiquetCompra.php : Tras leer los datos del tiquet de compra, enumera en una tabla los productos, con su precio en euros y pesetas, y finalmente, en una \u00faltima fila, totalizar en ambas monedas. Actividad 247 A partir de los archivos creados en el ejercicio anterior, crea una plantilla mediante includes: 247preparaCompra.php : similar a 246preparaTiquetCompra.php , pero separando el encabezado (Supermercado Severo en h1 ) y el pie (Tu supermercado de confianza) en ficheros externos y referenciando a ellos mediante include . 247listaCompra.php : recibe los datos del anterior, y reutiliza parte de 246imprimeTiquetCompra.php cambiando la tabla por una lista desordenada de los productos junto a su precio. Actividad 248 Vamos a simular un formulario de acceso: 248login.php : el formulario de entrada, que solicita el usuario y contrase\u00f1a. 248compruebaLogin.php : recibe los datos y comprueba si son correctos (los usuarios se guardan en un array asociativo) pasando el control mediante el uso de include a: 248ok.php : El usuario introducido es correcto 248ko.php : El usuario es incorrecto. Informar si ambos est\u00e1n mal o solo la contrase\u00f1a. Volver a mostrar el formulario de acceso. funciones predefinidas Todos los ejercicios se deben realizar creando nuevas funciones para encapsular el c\u00f3digo. Adem\u00e1s de la propia funci\u00f3n, el ejercicio debe contener c\u00f3digo para poder probarlo. Actividad 251 251fraseImpares.php : Lee una frase y devuelve una nueva con solo los caracteres de las posiciones impares. Actividad 252 252vocales.php : A partir de una frase, devuelve la cantidad de cada una de las vocales, y el total de ellas. Actividad 253 253analizador.php : A partir de una frase con palabras s\u00f3lo separadas por espacios, devolver Letras totales y cantidad de palabras Una l\u00ednea por cada palabra indicando su tama\u00f1o Nota : no se puede usar str_word_count 253analizadorWC.php : Investiga que hace la funci\u00f3n str_word_count , y vuelve a hacer el ejercicio. Actividad 254 254cani.php : EsCrIbE uNa FuNcI\u00f3N qUe TrAnSfOrMe UnA cAdEnA eN cAnI. Actividad 255 255palindromo.php : Escribe una funci\u00f3n que devuelva un booleano indicando si una palabra es pal\u00edndroma (se lee igual de izquierda a derecha que de derecha a izquierda, por ejemplo, \u201cligar es ser agil\u201d). Actividad 256 256codificar.php : Utilizando las funciones para trabajar con caracteres, a partir de una cadena y un desplazamiento: Si el desplazamiento es 1, sustituye la A por B, la B por C, etc. El desplazamiento no puede ser negativo Si se sale del abecedario, debe volver a empezar Hay que respetar los espacios, puntos y comas. Actividad 257 257filtrado.html : Crea un programa que permita al usuario leer un conjunto de n\u00fameros separados por espacios. 257filtrado.php : El programa filtrar\u00e1 los n\u00fameros le\u00eddos para volver a mostrar \u00fanicamente los n\u00fameros pares e indicar\u00e1 la cantidad existente. Text Only 1 2 Dame n\u00fameros: 1 4 7 9 23 10 8 Los 3 n\u00fameros pares son: 4 10 8 Actividad 258 258investiga.php : Investiga las siguientes funciones de cadena (explica para qu\u00e9 sirven mediante comentarios, y programa un peque\u00f1o ejemplo de cada una de ellas): ucwords , strrev , str_repeat y md5 . Los siguientes ejercicios se basan en la generaci\u00f3n de n\u00fameros aleatorios. Actividad 259 259generador.php : Crea una funci\u00f3n que permite generar una letra aleatoria, may\u00fascula o min\u00fascula. Actividad 260 260generaContrasenya.php : Crea una funci\u00f3n que a partir de un tama\u00f1o, genera una contrase\u00f1a aleatoria compuesta de letras y d\u00edgitos de manera aleatoria. Actividad 261 261quinielas.php : Crea las siguientes funciones: quinigol() : array \u2192 Genera un array multidimensional con 6 resultados aleatorios con combinaciones [012M, 012M]. quiniela() : array \u2192 Genera un array con una combinaci\u00f3n de quiniela generada de manera aleatoria: 14 resultados con 1X2 y el pleno al quince con [012M, 012M]. tabla(array $quiniela) : string \u2192 transforma un array de una quiniela en una tabla HTML. otros ejercicios Aqu\u00ed entontrar\u00e1s ejercicios gen\u00e9ricos de programaci\u00f3n para usar con cualquier lenguaje. Son gen\u00e9ricos porque te pueden servir con cualquier lenguaje que quieras aprender. Ejercicios PHP de W3Schools Ejercicios PHP de JavaTpoint ejercicios del concurso ACEPTA EL RETO Estos son 10 ejercicios para resolver de la excelente propuesta Acepta el Reto . Deber\u00edan resolverse en menos de 2h cada uno (como mucho). 1) C\u00f3digos de Barras 2) Encriptaci\u00f3n de Mensajes 3) \u00bfCu\u00e1ntos n\u00fameros capic\u00faa? 4) Feliz No Cumplea\u00f1os 5) Acepta la Suma 6) Sudokus Correctos 7) Liga de P\u00e1del 8) Escudos del ej\u00e9rcito romano 9) Las Cartas del Abuelo 10) Man\u00edas tenemos todos","title":"ud02 ElLenguajePHP actividades"},{"location":"ud02/ud02_ElLenguajePHP_actividades/#php-basico","text":"Actividad 201 Visualiza el v\u00eddeo de Jes\u00fas Amieiro sobre PHP en 2020 a partir del minuto 3:32 (son 40 minutos aproximadamente). \u00bfQu\u00e9 relaci\u00f3n existe entre PHP y Facebook? Respecto al rendimiento, \u00bfqu\u00e9 versi\u00f3n m\u00ednima deber\u00edamos utilizar? \u00bfPor qu\u00e9 PHP tiene mala fama? Actividad 202 202tresfrases.php : Muestra 3 frases, cada una en un p\u00e1rrafo utilizando las tres posibilidades que existen de mostrar contenido. Tras ello, introduce dos comentarios, uno de bloque y otro de una l\u00ednea. Actividad 203 203calculos.php : Escribe un programa que utilice las variables $x y $y . As\u00edgnales los valores 166 y 999 respectivamente. A continuaci\u00f3n, muestra por pantalla el valor de cada variable, la suma, la resta, la divisi\u00f3n y la multiplicaci\u00f3n. Actividad 204 204datosPersonales.php : Escribe un programa que almacene en variables tu nombre, primer apellido, segundo apellido, email, a\u00f1o de nacimiento y tel\u00e9fono. Luego mu\u00e9stralos por pantalla dentro de una tabla. \u200b Actividad 205 205datosPersonales.html y 205datosPersonales.php : Es el mismo ejercicio que el anterior, pero separando la l\u00f3gica. En el primer archivo crearemos el formulario para introducir los datos, y luego recogemos los datos y generamos la tabla en el segundo archivo. Actividad 206 206madlib.html y 206madlib.php : A partir de un nombre, un verbo, un adjetivo y un adverbio, crea una historia que contenga dichos elementos. Por ejemplo: Entrada: perro / caminar / azul / r\u00e1pidamente Salida: \u00bf Te gusta caminar con tu perro azul r\u00e1pidamente ? 206madlib2.html y 206madlib2.php Crea un madlib m\u00e1s extenso, leyendo m\u00e1s datos de entrada. Actividad 207 207anyos.php : Tras leer la edad de una persona, mostrar la edad que tendr\u00e1 dentro de 10 a\u00f1os y hace 10 a\u00f1os. Adem\u00e1s, muestra qu\u00e9 a\u00f1o ser\u00e1 en cada uno de los casos. Finalmente, muestra el a\u00f1o de jubilaci\u00f3n suponiendo que trabajar\u00e1s hasta los 67 a\u00f1os. En este caso, no hace falta que previamente crees un formulario, puedes probar el ejercicio via URL: 207anyos.php?edad=33 . Nota : $anyoActual = date(\"Y\"); Actividad 208 208dinero.php : A partir de una cantidad de dinero, mostrar su descomposici\u00f3n en billetes (500, 200, 100, 50, 20, 10, 5) y monedas (2, 1), para que el n\u00famero de elementos sea m\u00ednimo. No se utilizar ninguna instrucci\u00f3n condicional. Por ejemplo, al introducir 139 debe mostrar: PHP 1 2 3 4 5 6 1 billete de 100 0 billete de 50 1 billete de 20 1 billete de 10 1 billete de 5 2 moneda de 2 Nota: Puedes forzar a realizar la divisi\u00f3n entera mediante la funci\u00f3n intdiv($dividendo, $divisor) o pasar un n\u00famero flotante a entero puedes usar la funci\u00f3n intval() . Actividad 209 209posnegcero.php : A partir de un numero, muestra por pantalla si el n\u00famero es positivo , negativo o cero . Actividad 210 210mayor3.php : Sin hacer uso de condiciones que utilicen dentro la condici\u00f3n los operadores l\u00f3gicos, muestra el mayor de tres n\u00fameros (a, b y c). 210mayor3c.php : Utiliza en las condiciones los operadores l\u00f3gicos. Actividad 211 211nombreEdad.php : A partir de una edad muestra por pantalla: beb\u00e9 si tiene menos de 3 a\u00f1os ni\u00f1o si tiene entre 3 y 12 a\u00f1os adolescente entre 13 y 17 a\u00f1os adulto entre 18 y 66 jubilado a partir de 67 Actividad 212 212reloj.php : Escribe un programa que funcione similar a un reloj, de manera que a partir de los valores de hora , minuto y segundo muestre la hora dentro de un segundo. Tras las 23:59:59 ser\u00e1n las 0:0:0 . Actividad 213 213calendario.php : Escribe un programa similar a un calendario de manera que a partir de dia , mes y anyo muestre la fecha dentro de un d\u00eda. Debes tener en cuenta que no todos los meses tienen 30 d\u00edas. En este caso, no vamos a tener en cuenta los a\u00f1os bisiestos. Actividad 214 214ecuacion2g.php : Crea un programa que resuelva una ecuaci\u00f3n de 2\u00ba grado del tipo ax\u00b2 + bx + c = 0 . Ten en cuenta que puede tener 2, 1 o no tener soluci\u00f3n dependiendo del valor del discriminante b\u00b2-4ac . Nota : Para calcular la ra\u00edz cuadrada deber\u00e1s utilizar la funci\u00f3n sqrt() . Actividad 215 Investiga para qu\u00e9 sirve el operador nave espacial, disponible desde PHP7 (https://www.php.net/manual/es/migration70.new-features.php). Explica con un par de l\u00edneas su prop\u00f3sito y mediante c\u00f3digo demuestra su uso. Actividad 216 Investiga para qu\u00e9 sirve la instrucci\u00f3n match() , disponible desde PHP8 (https://www.php.net/manual/es/control-structures.match.php). Explica con un par de lineas su prop\u00f3sito y mediante c\u00f3digo demuestra su uso.","title":"Php b\u00e1sico"},{"location":"ud02/ud02_ElLenguajePHP_actividades/#bucles","text":"Actividad 221 221pares050.php : Escribe un programa que muestre los n\u00fameros pares del 0 al 50 (dentro de una lista desordenada). 221paresAB.php : A partir del anterior, refactorizar para que funcione con inicio y fin . Actividad 222 222suma110.php : Escribe un programa que sume los n\u00fameros del 1 al 10. 222sumaAB.php : A partir del anterior, refactorizar para que funcione con inicio y fin . Actividad 223 223potencia.php : A partir de una base y exponente, mediante la acumulaci\u00f3n de productos, calcula la potencia utilizando la instrucci\u00f3n for . 223potenciaWhile.php : Reescribe el ejercicio anterior haciendo uso s\u00f3lo de while . 223potenciaDoWhile.php : Reescribe el ejercicio anterior haciendo uso s\u00f3lo de do-while . Actividad 224 224tablaMultiplicar.php : Muestra dentro de una tabla HTML la tabla de multiplicar del numero que reciba como par\u00e1metro. Utiliza <thead> con sus respectivos <th> y <tbody> para dibujar la tabla. Por ejemplo: a * b = a*b 7 * 1 = 7 7 * 2 = 14 ... 7 * 10 = 70 Actividad 225 225formulario.html : Crea un formulario que permita leer una cantidad. 225leerDatos.php : a partir de cantidad, prepara un formulario con tantas cajas de datos como su valor. Finalmente, en 225sumarDatos.php : a partir de los datos de todas las cajas de la p\u00e1gina anterior, s\u00famalos y muestra el total. A tener el cuenta : Para guardar un dato oculto puedes utilizar un campo de formulario de tipo oculto: <input type=\"hidden\" name=\"cantidad\" value=\"33\" /> . Actividad 226 226formulario.html y 226tabla.php : A partir de un n\u00famero de filas y columnas , crear una tabla con ese tama\u00f1o. Las celdas deben estar rellenadas con los valores de las coordenadas de cada celda. Actividad 227 227formulario.html y 227cuadrado.php : Bas\u00e1ndote en el ejercicio anterior, rellena la tabla de manera que solo los bordes tengan contenido, qued\u00e1ndose el resto de celdas en blanco. Actividad 228 228formulario.html y 228equis.php : Bas\u00e1ndote en el ejercicio anterior, ahora s\u00f3lo debe aparecer el contenido de los dos diagonales. Actividad 229 229cuadradoMultiplicar.php : Crea un programa que muestre por pantalla un cuadrado exactamente igual (f\u00edjate bien en los encabezados, tanto de las filas como de las columnas) al de la imagen con las tablas de multiplicar.","title":"bucles"},{"location":"ud02/ud02_ElLenguajePHP_actividades/#arrays","text":"Actividad 231 231aleatorios50.php : Rellena un array con 50 n\u00fameros aleatorios comprendidos entre el 0 y el 99, y luego mu\u00e9stralo en una lista desordenada. Para crear un n\u00famero aleatorio, utiliza la funci\u00f3n rand(inicio, fin) . Por ejemplo: PHP 1 $num = rand(0, 99) Actividad 232 232bola8.html : Prepara un formulario con un caja de texto que realice a una pregunta al usuario. 232bola8.php : A partir del anterior, crea un programa que muestre la pregunta recibida y genere una respuesta de manera aleatoria entre un conjunto de respuestas predefinidas, almacenadas en un array: Si, no, quiz\u00e1s, claro que s\u00ed, por supuesto que no, no lo tengo claro, seguro, yo dir\u00eda que s\u00ed, ni de co\u00f1a, etc... Este ejercicio se basa en el juego de la Bola 8 m\u00e1gica . Actividad 233 233mates.php : A partir del ejercicio 230, genera un array aleatorio de 33 elementos con n\u00fameros comprendidos entre el 0 y 100 y calcula: El mayor El menor La media Actividad 234 234sexos.php : Rellena un array de 100 elementos de manera aleatoria con valores M o F (por ejemplo [\"M\", \"M\", \"F\", \"M\", ...] ). Una vez completado, vuelve a recorrerlo y calcula cuantos elementos hay de cada uno de los valores almacenando el resultado en un array asociativo ['M' => 44, 'F' => 66] (no utilices variables para contar las M o las F ). Finalmente, muestra el resultado por pantalla Actividad 235 235monedas.php : Vuelve a realizar el ejercicio 207, el de las monedas (500, 200, 100, 50, 20, 10, 5, 2, 1), pero haciendo uso de arrays y un bucle. Almacena el resultado en un array asociativo. Muestra el resultado en una lista desordenada \u00fanicamente con las cantidades que tienen alg\u00fan valor. Actividad 236 236alturas.php : Mediante un array asociativo, almacena el nombre y la altura de 5 personas ( nombre => altura ). Posteriormente, recorre el array y mu\u00e9stralo en una tabla HTML. Finalmente a\u00f1ade una \u00faltima fila a la tabla con la altura media. Actividad 237 237personas.php : Mediante un array bidimensional, almacena el nombre, altura y email de 5 personas. Para ello, crea un array de personas, siendo cada persona un array asociativo: [ ['nombre'=>'Aitor', 'altura'=>182, 'email'=>'aitor@correo.com'],[\u2026],\u2026 ] Posteriormente, recorre el array y mu\u00e9stralo en una tabla HTML. Actividad 238 238leerCantidad.html y 237leerPersonas.php : a partir de un formulario con un campo de cantidad de personas, generar un nuevo formulario para leer el nombre, altura y email de cantidad personas. 238gestionarPersonas.php : A partir de las personas introducidas, mostrar sus datos en una tabla, y posteriormente, destacar los datos del m\u00e1s alto y el del m\u00e1s bajo. Actividad 239 239tablaDistintos.php : Rellena un array bidimensional de 6 filas por 9 columnas con n\u00fameros aleatorios comprendidos entre 100 y 999 (ambos incluidos). Todos los n\u00fameros deben ser distintos, es decir, no se puede repetir ninguno. Muestra a continuaci\u00f3n por pantalla el contenido del array de tal forma que: La columna del m\u00e1ximo debe aparecer en azul. La fila del m\u00ednimo debe aparecer en verde El resto de nu\u0301meros deben aparecer en negro.","title":"arrays"},{"location":"ud02/ud02_ElLenguajePHP_actividades/#funciones","text":"Actividad 241 241arrayPar.php : Crea las siguientes funciones: Una funci\u00f3n que averig\u00fce si un n\u00famero es par: esPar(int $num): bool Una funci\u00f3n que devuelva un array de tama\u00f1o $tam con n\u00fameros aleatorios comprendido entre $min y $max : arrayAleatorio(int $tam, int $min, int $max) : array Una funci\u00f3n que reciba un $array por referencia y devuelva la cantidad de n\u00fameros pares que hay almacenados: arrayPares(array &$array): int Actividad 242 242parametrosVariables.php : Crea las siguientes funciones: Una funci\u00f3n que devuelva el mayor de todos los n\u00fameros recibidos como par\u00e1metros: function mayor(): int . Utiliza las funciones func_get_args() , etc... No puedes usar la funci\u00f3n max() . Una funci\u00f3n que concatene todos los par\u00e1metros recibidos separ\u00e1ndolos con un espacio: function concatenar(...$palabras) : string . Utiliza el operador .... Actividad 243 243matematicas.php : A\u00f1ade las siguientes funciones: digitos(int $num): int \u2192 devuelve la cantidad de d\u00edgitos de un n\u00famero. digitoN(int $num, int $pos): int \u2192 devuelve el d\u00edgito que ocupa, empezando por la izquierda, la posici\u00f3n $pos . quitaPorDetras(int $num, int $cant): int \u2192 le quita por detr\u00e1s (derecha) $cant d\u00edgitos. quitaPorDelante(int $num, int $cant): int \u2192 le quita por delante (izquierda) $cant d\u00edgitos. Para probar las funciones, haz uso tanto de paso de argumentos posicionales como argumentos con nombre. Actividad 244 244biblioteca.php : crea un archivo con funciones para sumar, restar, multiplicar y dividir dos n\u00fameros. 244arrayFunciones.php : haciendo uso de un array que almacene el nombre de las funciones del archivo anterior, a partir de dos n\u00fameros recibidos por URL, recorre el array e invoca a las funciones de manera din\u00e1mica haciendo uso de funciones variable. Actividad 245 245euros.php : Crea una biblioteca con dos funciones: peseta2euros: pasa de pesetas a euros euros2pesetas: pasa de euros a pesetas Cada funci\u00f3n debe recibir dos par\u00e1metros: La cantidad a transformar La cotizaci\u00f3n, con un par\u00e1metro por defecto con el factor de transformaci\u00f3n. 245calculadoraEuros.php : utiliza 244euros.php y prueba las funciones pasando tanto cantidades con la cotizaci\u00f3n por defecto, como con nuevas cotizaciones. Recuerda que 1 euro son/eran 166.36 pesetas. Actividad 246 246preparaTiquetCompra.php : A partir de una cantidad de productos, leer el nombre y coste de la cantidad de productos indicados (similar al ejercicio 237, pero esta vez no hace falta crear el formulario con la cantidad, se recibe mediante un par\u00e1metro GET via URL). 246imprimeTiquetCompra.php : Tras leer los datos del tiquet de compra, enumera en una tabla los productos, con su precio en euros y pesetas, y finalmente, en una \u00faltima fila, totalizar en ambas monedas. Actividad 247 A partir de los archivos creados en el ejercicio anterior, crea una plantilla mediante includes: 247preparaCompra.php : similar a 246preparaTiquetCompra.php , pero separando el encabezado (Supermercado Severo en h1 ) y el pie (Tu supermercado de confianza) en ficheros externos y referenciando a ellos mediante include . 247listaCompra.php : recibe los datos del anterior, y reutiliza parte de 246imprimeTiquetCompra.php cambiando la tabla por una lista desordenada de los productos junto a su precio. Actividad 248 Vamos a simular un formulario de acceso: 248login.php : el formulario de entrada, que solicita el usuario y contrase\u00f1a. 248compruebaLogin.php : recibe los datos y comprueba si son correctos (los usuarios se guardan en un array asociativo) pasando el control mediante el uso de include a: 248ok.php : El usuario introducido es correcto 248ko.php : El usuario es incorrecto. Informar si ambos est\u00e1n mal o solo la contrase\u00f1a. Volver a mostrar el formulario de acceso.","title":"funciones"},{"location":"ud02/ud02_ElLenguajePHP_actividades/#funciones-predefinidas","text":"Todos los ejercicios se deben realizar creando nuevas funciones para encapsular el c\u00f3digo. Adem\u00e1s de la propia funci\u00f3n, el ejercicio debe contener c\u00f3digo para poder probarlo. Actividad 251 251fraseImpares.php : Lee una frase y devuelve una nueva con solo los caracteres de las posiciones impares. Actividad 252 252vocales.php : A partir de una frase, devuelve la cantidad de cada una de las vocales, y el total de ellas. Actividad 253 253analizador.php : A partir de una frase con palabras s\u00f3lo separadas por espacios, devolver Letras totales y cantidad de palabras Una l\u00ednea por cada palabra indicando su tama\u00f1o Nota : no se puede usar str_word_count 253analizadorWC.php : Investiga que hace la funci\u00f3n str_word_count , y vuelve a hacer el ejercicio. Actividad 254 254cani.php : EsCrIbE uNa FuNcI\u00f3N qUe TrAnSfOrMe UnA cAdEnA eN cAnI. Actividad 255 255palindromo.php : Escribe una funci\u00f3n que devuelva un booleano indicando si una palabra es pal\u00edndroma (se lee igual de izquierda a derecha que de derecha a izquierda, por ejemplo, \u201cligar es ser agil\u201d). Actividad 256 256codificar.php : Utilizando las funciones para trabajar con caracteres, a partir de una cadena y un desplazamiento: Si el desplazamiento es 1, sustituye la A por B, la B por C, etc. El desplazamiento no puede ser negativo Si se sale del abecedario, debe volver a empezar Hay que respetar los espacios, puntos y comas. Actividad 257 257filtrado.html : Crea un programa que permita al usuario leer un conjunto de n\u00fameros separados por espacios. 257filtrado.php : El programa filtrar\u00e1 los n\u00fameros le\u00eddos para volver a mostrar \u00fanicamente los n\u00fameros pares e indicar\u00e1 la cantidad existente. Text Only 1 2 Dame n\u00fameros: 1 4 7 9 23 10 8 Los 3 n\u00fameros pares son: 4 10 8 Actividad 258 258investiga.php : Investiga las siguientes funciones de cadena (explica para qu\u00e9 sirven mediante comentarios, y programa un peque\u00f1o ejemplo de cada una de ellas): ucwords , strrev , str_repeat y md5 . Los siguientes ejercicios se basan en la generaci\u00f3n de n\u00fameros aleatorios. Actividad 259 259generador.php : Crea una funci\u00f3n que permite generar una letra aleatoria, may\u00fascula o min\u00fascula. Actividad 260 260generaContrasenya.php : Crea una funci\u00f3n que a partir de un tama\u00f1o, genera una contrase\u00f1a aleatoria compuesta de letras y d\u00edgitos de manera aleatoria. Actividad 261 261quinielas.php : Crea las siguientes funciones: quinigol() : array \u2192 Genera un array multidimensional con 6 resultados aleatorios con combinaciones [012M, 012M]. quiniela() : array \u2192 Genera un array con una combinaci\u00f3n de quiniela generada de manera aleatoria: 14 resultados con 1X2 y el pleno al quince con [012M, 012M]. tabla(array $quiniela) : string \u2192 transforma un array de una quiniela en una tabla HTML.","title":"funciones predefinidas"},{"location":"ud02/ud02_ElLenguajePHP_actividades/#otros-ejercicios","text":"Aqu\u00ed entontrar\u00e1s ejercicios gen\u00e9ricos de programaci\u00f3n para usar con cualquier lenguaje. Son gen\u00e9ricos porque te pueden servir con cualquier lenguaje que quieras aprender. Ejercicios PHP de W3Schools Ejercicios PHP de JavaTpoint","title":"otros ejercicios"},{"location":"ud02/ud02_ElLenguajePHP_actividades/#ejercicios-del-concurso-acepta-el-reto","text":"Estos son 10 ejercicios para resolver de la excelente propuesta Acepta el Reto . Deber\u00edan resolverse en menos de 2h cada uno (como mucho). 1) C\u00f3digos de Barras 2) Encriptaci\u00f3n de Mensajes 3) \u00bfCu\u00e1ntos n\u00fameros capic\u00faa? 4) Feliz No Cumplea\u00f1os 5) Acepta la Suma 6) Sudokus Correctos 7) Liga de P\u00e1del 8) Escudos del ej\u00e9rcito romano 9) Las Cartas del Abuelo 10) Man\u00edas tenemos todos","title":"ejercicios del concurso ACEPTA EL RETO"},{"location":"ud03/ud0301/","text":"duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada : 18 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio. a) Se han identificado las ventajas de separar la l\u00f3gica de negocio de los aspectos de presentaci\u00f3n de la aplicaci\u00f3n. b) Se han analizado tecnolog\u00edas y mecanismos que permiten realizar esta separaci\u00f3n y sus caracter\u00edsticas principales. c) Se han utilizado objetos y controles en el servidor para generar el aspecto visual de la aplicaci\u00f3n web en el cliente. d) Se han utilizado formularios generados de forma din\u00e1mica para responder a los eventos de la aplicaci\u00f3n Web. e) Se han escrito aplicaciones Web con mantenimiento de estado y separaci\u00f3n de la l\u00f3gica de negocio. f) Se han aplicado los principios de la programaci\u00f3n orientada a objetos. g) Se ha probado y documentado el c\u00f3digo. clases y objetos PHP sigue un paradigma de programaci\u00f3n orientada a objetos (POO) basada en clases. Una clase es una plantilla que define las atributos y m\u00e9todos para poder crear objetos. De este manera, un objeto es una instancia de una clase . Tanto los atributos como los m\u00e9todos se definen con una visibilidad (qui\u00e9n puede acceder): Privado - private : S\u00f3lo puede acceder la propia clase. Protegido - protected : S\u00f3lo puede acceder la propia clase o sus descendientes. P\u00fablico - public : Puede acceder cualquier otra clase. Para declarar una clase, se utiliza la palabra clave class seguido del nombre de la clase. Para instanciar un objeto a partir de la clase, se utiliza new : PHP 1 2 3 4 5 6 7 <?php class NombreClase { // atributos // y m\u00e9todos } $ob = new NombreClase (); clases con may\u00fascula : Todas las clases empiezan por letra may\u00fascula. Cuando un proyecto crece, es normal modelar las clases mediante UML (\u00bfrecord\u00e1is Entornos de Desarrollo ?). La clases se representan mediante un cuadrado, separando el nombre, de los atributos y los m\u00e9todos: Una vez que hemos creado un objeto, se utiliza el operador -> para acceder a un atributo o un m\u00e9todo del objeto: PHP 1 2 $objeto->atributo; $objeto->m\u00e9todo(par\u00e1metros); Si desde, dentro de la clase, queremos acceder a un atributo o m\u00e9todo de la misma clase, utilizaremos la referencia $this ; PHP 1 2 $this->atributo; $this->m\u00e9todo(par\u00e1metros); As\u00ed pues, como ejemplo, codificar\u00edamos una persona en el fichero Persona.php como: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php class Persona { private string $nombre ; public function setNombre ( string $nombre ) { $this -> nombre = $nombre ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona (); // creamos un objeto $bruno -> setNombre ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Aunque se pueden declarar varias clases en el mismo archivo, es una mala pr\u00e1ctica. As\u00ed pues, cada fichero : contedr\u00e1 una sola clase , y se nombrar\u00e1 con el nombre de la clase .","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud03/ud0301/#duracion-y-criterios-de-evaluacion","text":"Duraci\u00f3n estimada : 18 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio. a) Se han identificado las ventajas de separar la l\u00f3gica de negocio de los aspectos de presentaci\u00f3n de la aplicaci\u00f3n. b) Se han analizado tecnolog\u00edas y mecanismos que permiten realizar esta separaci\u00f3n y sus caracter\u00edsticas principales. c) Se han utilizado objetos y controles en el servidor para generar el aspecto visual de la aplicaci\u00f3n web en el cliente. d) Se han utilizado formularios generados de forma din\u00e1mica para responder a los eventos de la aplicaci\u00f3n Web. e) Se han escrito aplicaciones Web con mantenimiento de estado y separaci\u00f3n de la l\u00f3gica de negocio. f) Se han aplicado los principios de la programaci\u00f3n orientada a objetos. g) Se ha probado y documentado el c\u00f3digo.","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud03/ud0301/#clases-y-objetos","text":"PHP sigue un paradigma de programaci\u00f3n orientada a objetos (POO) basada en clases. Una clase es una plantilla que define las atributos y m\u00e9todos para poder crear objetos. De este manera, un objeto es una instancia de una clase . Tanto los atributos como los m\u00e9todos se definen con una visibilidad (qui\u00e9n puede acceder): Privado - private : S\u00f3lo puede acceder la propia clase. Protegido - protected : S\u00f3lo puede acceder la propia clase o sus descendientes. P\u00fablico - public : Puede acceder cualquier otra clase. Para declarar una clase, se utiliza la palabra clave class seguido del nombre de la clase. Para instanciar un objeto a partir de la clase, se utiliza new : PHP 1 2 3 4 5 6 7 <?php class NombreClase { // atributos // y m\u00e9todos } $ob = new NombreClase (); clases con may\u00fascula : Todas las clases empiezan por letra may\u00fascula. Cuando un proyecto crece, es normal modelar las clases mediante UML (\u00bfrecord\u00e1is Entornos de Desarrollo ?). La clases se representan mediante un cuadrado, separando el nombre, de los atributos y los m\u00e9todos: Una vez que hemos creado un objeto, se utiliza el operador -> para acceder a un atributo o un m\u00e9todo del objeto: PHP 1 2 $objeto->atributo; $objeto->m\u00e9todo(par\u00e1metros); Si desde, dentro de la clase, queremos acceder a un atributo o m\u00e9todo de la misma clase, utilizaremos la referencia $this ; PHP 1 2 $this->atributo; $this->m\u00e9todo(par\u00e1metros); As\u00ed pues, como ejemplo, codificar\u00edamos una persona en el fichero Persona.php como: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php class Persona { private string $nombre ; public function setNombre ( string $nombre ) { $this -> nombre = $nombre ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona (); // creamos un objeto $bruno -> setNombre ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Aunque se pueden declarar varias clases en el mismo archivo, es una mala pr\u00e1ctica. As\u00ed pues, cada fichero : contedr\u00e1 una sola clase , y se nombrar\u00e1 con el nombre de la clase .","title":"clases y objetos"},{"location":"ud03/ud0302/","text":"duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada : 18 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio. a) Se han identificado las ventajas de separar la l\u00f3gica de negocio de los aspectos de presentaci\u00f3n de la aplicaci\u00f3n. b) Se han analizado tecnolog\u00edas y mecanismos que permiten realizar esta separaci\u00f3n y sus caracter\u00edsticas principales. c) Se han utilizado objetos y controles en el servidor para generar el aspecto visual de la aplicaci\u00f3n web en el cliente. d) Se han utilizado formularios generados de forma din\u00e1mica para responder a los eventos de la aplicaci\u00f3n Web. e) Se han escrito aplicaciones Web con mantenimiento de estado y separaci\u00f3n de la l\u00f3gica de negocio. f) Se han aplicado los principios de la programaci\u00f3n orientada a objetos. g) Se ha probado y documentado el c\u00f3digo. clases y objetos PHP sigue un paradigma de programaci\u00f3n orientada a objetos (POO) basada en clases. Una clase es una plantilla que define las atributos y m\u00e9todos para poder crear objetos. De este manera, un objeto es una instancia de una clase . Tanto los atributos como los m\u00e9todos se definen con una visibilidad (qui\u00e9n puede acceder): Privado - private : S\u00f3lo puede acceder la propia clase. Protegido - protected : S\u00f3lo puede acceder la propia clase o sus descendientes. P\u00fablico - public : Puede acceder cualquier otra clase. Para declarar una clase, se utiliza la palabra clave class seguido del nombre de la clase. Para instanciar un objeto a partir de la clase, se utiliza new : PHP 1 2 3 4 5 6 7 <?php class NombreClase { // atributos // y m\u00e9todos } $ob = new NombreClase (); clases con may\u00fascula : Todas las clases empiezan por letra may\u00fascula. Cuando un proyecto crece, es normal modelar las clases mediante UML (\u00bfrecord\u00e1is Entornos de Desarrollo ?). La clases se representan mediante un cuadrado, separando el nombre, de los atributos y los m\u00e9todos: Una vez que hemos creado un objeto, se utiliza el operador -> para acceder a un atributo o un m\u00e9todo del objeto: PHP 1 2 $objeto->atributo; $objeto->m\u00e9todo(par\u00e1metros); Si desde, dentro de la clase, queremos acceder a un atributo o m\u00e9todo de la misma clase, utilizaremos la referencia $this ; PHP 1 2 $this->atributo; $this->m\u00e9todo(par\u00e1metros); As\u00ed pues, como ejemplo, codificar\u00edamos una persona en el fichero Persona.php como: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php class Persona { private string $nombre ; public function setNombre ( string $nombre ) { $this -> nombre = $nombre ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona (); // creamos un objeto $bruno -> setNombre ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Aunque se pueden declarar varias clases en el mismo archivo, es una mala pr\u00e1ctica. As\u00ed pues, cada fichero : contedr\u00e1 una sola clase , y se nombrar\u00e1 con el nombre de la clase . encapsulaci\u00f3n Los atributos se definen privados o protegidos (si queremos que las clases heredadas puedan acceder). Para cada atributo, se a\u00f1aden m\u00e9todos p\u00fablicos ( getter / setter ): PHP 1 2 3 public function setAtributo (tipo $param); public function getAtributo () : tipo; Las constantes se definen p\u00fablicas para que sean accesibles por todos los recursos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 <?php class MayorMenor { private int $mayor ; private int $menor ; public function setMayor ( int $may ) { $this -> mayor = $may ; } public function setMenor ( int $men ) { $this -> menor = $men ; } public function getMayor () : int { return $this -> mayor ; } public function getMenor () : int { return $this -> menor ; } } Recibiendo y enviando objetos Es recomendable indicarlo en el tipo de par\u00e1metros. Si el objeto puede devolver nulos se pone ? delante del nombre de la clase. objetos por referencia : Los objetos que se env\u00edan y reciben como par\u00e1metros siempre se pasan por referencia. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php function maymen ( array $numeros ) : ? MayorMenor { $a = max ( $numeros ); $b = min ( $numeros ); $result = new MayorMenor (); $result -> setMayor ( $a ); $result -> setMenor ( $b ); return $result ; } $resultado = maymen ( [ 1 , 76 , 9 , 388 , 41 , 39 , 25 , 97 , 22 ] ); echo \"<br>Mayor: \" . $resultado -> getMayor (); echo \"<br>Menor: \" . $resultado -> getMenor (); constructor El constructor de los objetos se define mediante el m\u00e9todo m\u00e1gico __construct . Puede o no tener par\u00e1metros, pero s\u00f3lo puede haber un \u00fanico constructor . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Persona { private string $nombre ; public function __construct ( string $nom ) { $this -> nombre = $nom ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); constructores en PHP8 Una de las grandes novedades que ofrece PHP 8 es la simplificaci\u00f3n de los constructores con par\u00e1metros, lo que se conoce como promoci\u00f3n de los atributos del constructor . Para ello, en vez de tener que declarar los atributos como privados o protegidos, y luego dentro del constructor tener que asignar los par\u00e1metros a estos atributos, el propio constructor promociona los atributos. Ve\u00e1moslo mejor con un ejemplo. Imaginemos una clase Punto donde queramos almacenar sus coordenadas. As\u00ed quedar\u00eda en PHP7 o anteriores: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Punto { protected float $x ; protected float $y ; protected float $z ; public function __construct ( float $x = 0.0 , float $y = 0.0 , float $z = 0.0 ) { $this -> x = $x ; $this -> y = $y ; $this -> z = $z ; } } En PHP8 , quedar\u00eda del siguiente modo (mucho m\u00e1s corto, lo que facilita su legibilidad): PHP 1 2 3 4 5 6 7 8 <?php class Punto { public function __construct ( protected float $x = 0.0 , protected float $y = 0.0 , protected float $z = 0.0 , ) {} } el orden importa: A la hora de codificar el orden de los elementos debe ser: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php declare ( strict_types = 1 ); class NombreClase { // atributos // constructor // getters - setters // resto de m\u00e9todos } ?> clases est\u00e1ticas Son aquellas que tienen atributos ( o propiedades ) y/o m\u00e9todos est\u00e1ticos (tambi\u00e9n se conocen como de clase , porque su valor se comparte entre todas las instancias de la misma clase). Se declaran con static y se referencian con :: . Si queremos acceder a un m\u00e9todo est\u00e1tico , se antepone el nombre de la clase como sigue: Producto::nuevoProducto() . Si desde un m\u00e9todo queremos acceder a un atributo est\u00e1tico de la misma clase, se utiliza la referencia self como sigue: self::$numProductos . PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; public static function nuevoProducto () { self :: $numProductos ++ ; } } Producto :: nuevoProducto (); $impuesto = Producto :: IVA ; Tambi\u00e9n podemos tener clases normales que tengan algun atributo est\u00e1tico: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; private $codigo ; public function __construct ( string $cod ) { self :: $numProductos ++ ; $this -> codigo = $cod ; } public function mostrarResumen () : string { return \"El producto \" . $this -> codigo . \" es el n\u00famero \" . self :: $numProductos ; } } $prod1 = new Producto ( \"PS5\" ); $prod2 = new Producto ( \"XBOX Series X\" ); $prod3 = new Producto ( \"Nintendo Switch\" ); echo $prod3 -> mostrarResumen (); Bash 1 El producto Nintendo Switch es el n\u00famero 3 introspecci\u00f3n Al trabajar con clases y objetos, existen un conjunto de funciones ya definidas por el lenguaje que permiten obtener informaci\u00f3n sobre los objetos: instanceof : permite comprobar si un objeto es de una determinada clase. get_class : devuelve el nombre de la clase. get_declared_class : devuelve un array con los nombres de las clases definidas. class_alias : crea un alias. class_exists / method_exists / property_exists : devuelve true si la clase/m\u00e9todo/atributo est\u00e1 definida. get_class_methods / get_class_vars / get_object_vars : devuelve un array con los nombres de los m\u00e9todos/atributos de una clase / atributos de un objeto que son accesibles desde d\u00f3nde se hace la llamada. Un ejemplo de estas funciones puede ser el siguiente: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php $p = new Producto ( \"PS5\" ); if ( $p instanceof Producto ) { echo \"Es un producto.<br/>\" ; echo \"La clase es \" . get_class ( $p ) . \"<br/>\" ; class_alias ( \"Producto\" , \"Articulo\" ); $c = new Articulo ( \"Nintendo Switch\" ); echo \"Un articulo es un \" . get_class ( $c ) . \"<br/>\" ; print_r ( get_class_methods ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_class_vars ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_object_vars ( $p )); echo \"<br/>\" ; if ( method_exists ( $p , \"mostrarResumen\" )) { echo $p -> mostrarResumen (); } } clonado : Al asignar dos objetos no se copian, se crea una nueva referencia. Si queremos una copia, hay que clonarlo mediante el m\u00e9todo clone(object) : object . PHP nos permite crear un m\u00e9todo que se llamar\u00e1 cuando ejecutemos el operador clone. Este m\u00e9todo puede entre otras cosas inicializar algunos atributos. Si no se define el m\u00e9todo __clone() se har\u00e1 una copia id\u00e9ntica del objeto que le pasamos como par\u00e1metro al operador clone. Veamos un ejemplo: Crearemos una clase Persona que tenga como atributos su nombre y edad, definiremos los m\u00e9todos para cargar y retornar los valores de sus atributos. Haremos que cuando clonemos un objeto de dicha clase la edad de la persona se fije con cero. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php class Persona { private $nombre ; private $edad ; public function fijarNombreEdad ( $nom , $ed ) { $this -> nombre = $nom ; $this -> edad = $ed ; } public function getNombre () { return $this -> nombre ; } public function getEdad () { return $this -> edad ; } public function __clone () { $this -> edad = 0 ; } } $persona1 = new Persona (); $persona1 -> fijarNombreEdad ( 'Juan' , 20 ); echo 'Datos de $persona1:' ; echo $persona1 -> retornarNombre () . ' - ' . $persona1 -> retornarEdad () . '<br>' ; $persona2 = clone ( $persona1 ); echo 'Datos de $persona2:' ; echo $persona2 -> retornarNombre () . ' - ' . $persona2 -> retornarEdad () . '<br>' ; ?> El m\u00e9todo __clone se ejecutar\u00e1 cuando llamemos al operador clone para esta clase: PHP 1 2 3 public function __clone() { $this->edad=0; } Es decir cuando realicemos la asignaci\u00f3n: PHP 1 $persona2 = clone($persona1); inicialmente se hace una copia id\u00e9ntica de $persona1 pero luego se ejecuta el m\u00e9todo __clone con lo que el atributo $edad se modifica. Si queremos que una clase no pueda clonarse simplemente podemos implementar el siguiente c\u00f3digo en el m\u00e9todo __clone(): PHP 1 2 3 public function __clone() { die('No esta permitido clonar objetos de esta clase'); } M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/language.oop5.cloning.php herencia PHP soporta herencia simple, de manera que una clase solo puede heredar de otra clase , no de dos o m\u00e1s clases a la vez. Para ello se utiliza la palabra clave extends . Si queremos que la clase A hereda de la clase B haremos: PHP 1 class A extends B La clase hija hereda los atributos y m\u00e9todos p\u00fablicos y protegidos de la clase madre. cada clase en un archivo : Como ya hemos comentado, deber\u00edamos colocar cada clase en un archivo diferente para posteriormente utilizarlo mediante include . En los siguientes ejemplos los hemos colocado juntos para facilitar su legibilidad. Por ejemplo, tenemos una clase Producto y una Tv que hereda de Producto : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Producto { protected $codigo ; protected $nombre ; protected $nombreCorto ; protected $PVP ; public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { protected $pulgadas ; protected $tecnologia ; } Podemos utilizar las siguientes funciones para averiguar si hay relaci\u00f3n entre dos clases: get_parent_class(object): string is_subclass_of(object, string): bool PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php $t = new Tv (); $t -> codigo = 33 ; if ( $t instanceof Producto ) { echo $t -> mostrarResumen (); } $madre = get_parent_class ( $t ); echo \"<br>La clase madre es: \" . $madre ; $objetoMadre = new $madre ; echo $objetoMadre -> mostrarResumen (); if ( is_subclass_of ( $t , 'Producto' )) { echo \"<br>Soy una hija de Producto\" ; } sobreescribir m\u00e9todos Podemos crear m\u00e9todos en las clase hijas con el mismo nombre que la clase madre, cambiando su comportamiento. Para invocar a los m\u00e9todos de la clase madre: parent::nombreMetodo() . PHP 1 2 3 4 5 6 7 8 9 10 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } constructor en clases hijas En cambio, si lo definimos en la clase hija, hemos de invocar al de la clase madre de manera expl\u00edcita. PHP 7 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 <?php class Producto { public string $codigo ; public function __construct ( string $codigo ) { $this -> codigo = $codigo ; } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function __construct ( string $codigo , int $pulgadas , string $tecnologia ) { parent :: __construct ( $codigo ); $this -> pulgadas = $pulgadas ; $this -> tecnologia = $tecnologia ; } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } PHP 8 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php class Producto { public function __construct ( private string $codigo ) { } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public function __construct ( string $codigo , private int $pulgadas , private string $tecnologia ) { parent :: __construct ( $codigo ); } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } clases abstractas Las clases abstractas obligan a heredar de estas clases, ya que no se permite su instanciaci\u00f3n; s\u00ed se permite a las clases heredadas (siempre que no est\u00e9n tambi\u00e9n definidas como abstractas). Se define mediante abstract class NombreClase { . Una clase abstracta puede contener atributos y m\u00e9todos no-abstractos, y/o m\u00e9todos abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php // Clase abstracta abstract class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } // M\u00e9todo abstracto abstract public function mostrarResumen (); } Cuando una clase hereda de una clase abstracta, obligat\u00f3riamente debe implementar los m\u00e9todos que tiene la clase madre marcados como abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { //obligado a implementarlo echo \"<p>C\u00f3digo \" . $this -> getCodigo () . \"</p>\" ; echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } $t = new Tv (); echo $t -> getCodigo (); clases finales Son clases opuestas a abstractas, ya que evitan que se pueda heredar una clase o m\u00e9todo para sobreescribirlo. Se define mediante final class NombreClase { . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } final public function mostrarResumen () : string { return \"Producto \" . $this -> codigo ; } } // No podremos heredar de Microondas final class Microondas extends Producto { private $potencia ; public function getPotencia () : int { return $this -> potencia ; } // No podemos implementar mostrarResumen() } interfaces Permite definir un contrato con las firmas de los m\u00e9todos a cumplir. As\u00ed pues, s\u00f3lo contiene declaraciones de funciones y todas deben ser p\u00fablicas. Se declaran con la palabra clave interface y luego las clases que cumplan el contrato lo realizan mediante la palabra clave implements . PHP 1 2 3 4 5 6 <?php interface Nombreable { // declaraci\u00f3n de funciones } class NombreClase implements NombreInterfaz { // c\u00f3digo de la clase Se permite la herencia de interfaces. Adem\u00e1s, una clase puede implementar varios interfaces (en este caso, s\u00ed soporta la herecia m\u00faltiple, pero s\u00f3lo de interfaces). PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php interface Mostrable { public function mostrarResumen () : string ; } interface MostrableTodo extends Mostrable { public function mostrarTodo () : string ; } interface Facturable { public function generarFactura () : string ; } class Producto implements MostrableTodo , Facturable { // Implementaciones de los m\u00e9todos // Obligatoriamente deber\u00e1 implementar: // - public function mostrarResumen, // - public function mostrarTodo y // - public function generarFactura } m\u00e9todos encadenados Sigue el planteamiento de la programaci\u00f3n funcional, y tambi\u00e9n se conoce como method chaining . Plantea que sobre un objeto se realizan varias llamadas; o sea, consiste en llamar varios m\u00e9todos de un objeto en una misma l\u00ednea, basta con a\u00f1adir al final de cada m\u00e9todo: return $this; Con el siguiente ejemplo se entiende f\u00e1cilmente. Para facilitarlo, vamos a modificar todos sus m\u00e9todos mutadores (que modifican datos , setters , ...) para que devuelvan una referencia a $this : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Coche { public function lavar (){ echo \"Coche lavado. \\n \" ; return $this ; } public function encerar (){ echo \"Coche encerado. \\n \" ; return $this ; } } // ejemplo llamada a los m\u00e9todos encadenados $coche = new Coche ; $coche -> lavar () -> encerar (); Bash 1 2 3 // mostrar\u00e1 Coche lavado. Coche encerado. Otro ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php class Libro { private string $nombre ; private string $autor ; public function getNombre () : string { return $this -> nombre ; } public function setNombre ( string $nombre ) : Libro { $this -> nombre = $nombre ; return $this ; } public function getAutor () : string { return $this -> autor ; } public function setAutor ( string $autor ) : Libro { $this -> autor = $autor ; return $this ; } public function __toString () : string { return $this -> nombre . \" de \" . $this -> autor ; } } m\u00e9todos m\u00e1gicos Todas las clases PHP ofrecen un conjunto de m\u00e9todos, tambi\u00e9n conocidos como magic methods que se pueden sobreescribir para sustituir su comportamiento. Algunos de ellos ya los hemos utilizado. Ante cualquier duda, es conveniente consultar la documentaci\u00f3n oficial . Los m\u00e1s destacables son: __construct() __destruct() \u2192 se invoca al perder la referencia. Se utiliza para cerrar una conexi\u00f3n a la BD, cerrar un fichero, ... __toString() \u2192 representaci\u00f3n del objeto como cadena. Es decir, cuando hacemos echo $objeto se ejecuta autom\u00e1ticamente este m\u00e9todo. get(atributo) , set(atributo, valor) \u2192 Permitir\u00eda acceder a los atributos privados, aunque siempre es m\u00e1s legible/mantenible codificar los getter/setter. __isset(atributo) , __unset(atributo) \u2192 Permite averiguar o quitar el valor a un atributo. sleep() , wakeup() \u2192 Se ejecutan al recuperar ( unserialize^ ) o almacenar un objeto que se serializa ( serialize ), y se utilizan para permite definir qu\u00e9 atributos se serializan. call() , callStatic() \u2192 Se ejecutan al llamar a un m\u00e9todo que no es p\u00fablico. Permiten sobrecargar m\u00e9todos. espacio de nombres Desde PHP 5.3 y tambi\u00e9n conocidos como Namespaces , permiten organizar las clases/interfaces, funciones y/o constantes (de forma similar a los paquetes en Java) en un \u00e1mbito restringido; evitando colisiones o conflictos de nombre con otros elementos que se pueden crear m\u00e1s adelante (o con algunas librer\u00edas que utilices). recomendaci\u00f3n : Un s\u00f3lo namespace por archivo y crear una estructura de carpetas respectando los niveles/subniveles (igual que se hace en Java). Se declaran en la primera l\u00ednea mediante la palabra clave namespace seguida del nombre del espacio de nombres asignado (cada subnivel se separa con la barra invertida \\ ): Por ejemplo, para colocar la clase Producto dentro del namespace Dwes\\Ejemplos lo har\u00edamos as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace Dwes\\Ejemplos ; const IVA = 0.21 ; class Producto { public $nombre ; public function muestra () : void { echo \"<p>Prod:\" . $this -> nombre . \"</p>\" ; } } acceso Para referenciar a un recurso que contiene un namespace, primero hemos de tenerlo disponible haciendo uso de include o require . Si el recurso est\u00e1 en el mismo namespace, se realiza un acceso directo (se conoce como acceso sin cualificar ). Realmente hay tres tipos de acceso: sin cualificar: recurso cualificado: rutaRelativa\\recurso \u2192 no hace falta poner el namespace completo. totalmente cualificado: \\rutaAbsoluta\\recurso PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php namespace Dwes\\Ejemplos ; include_once ( \"Producto.php\" ); // sin cualificar echo IVA ; // acceso cualificado. // Dar\u00eda error, no existe \\Dwes\\Ejemplos\\Utilidades\\IVA echo Utilidades\\IVA ; // totalmente cualificado echo \\Dwes\\Ejemplos\\IVA ; $p1 = new Producto (); // lo busca en el mismo namespace y // encuentra \\Dwes\\Ejemplos\\Producto $p2 = new Model\\Producto (); // dar\u00eda error, no existe el namespace Model. // Est\u00e1 buscando \\Dwes\\Ejemplos\\Model\\Producto $p3 = new \\Dwes\\Ejemplos\\Producto (); // \\Dwes\\Ejemplos\\Producto video use Para evitar la referencia cualificada podemos declarar el uso mediante use (similar a hacer import en Java). Se hace en la cabecera, tras el namespace: Los tipos posibles son: use const nombreCualificadoConstante use function nombreCualificadoFuncion use nombreCualificadoClase use nombreCualificadoClase as NuevoNombre // para renombrar elementos Por ejemplo, si queremos utilizar la clase \\Dwes\\Ejemplos\\Producto desde un recurso que se encuentra en la ra\u00edz, por ejemplo en inicio.php , har\u00edamos: PHP 1 2 3 4 5 6 7 8 <?php include_once ( \"Dwes\\Ejemplo\\Producto.php\" ); use const Dwes\\Ejemplos\\IVA ; use \\Dwes\\Ejemplos\\Producto ; echo IVA ; $p1 = new Producto (); to use or not to use En resumen, use permite acceder sin cualificar a recursos que est\u00e1n en otro namespace . Si estamos en el mismo espacio de nombre, no necesitamos use . video organizaci\u00f3n Todo proyecto, conforme crece, necesita organizar su c\u00f3digo fuente. Se plantea una organizaci\u00f3n en la que los archivos que interactuan con el navegador se colocan en el ra\u00edz, y las clases que definamos van dentro de un namespace (y dentro de su propia carpeta src o app). organizaci\u00f3n, includes y usos : Colocaremos cada recurso en un fichero aparte. En la primera l\u00ednea indicaremos su namespace (si no est\u00e1 en el ra\u00edz). Si utilizamos otros recursos, haremos un include_once de esos recursos (clases, interfaces, etc...). Cada recurso debe incluir todos los otros recursos que referencie: la clase de la que hereda, interfaces que implementa, clases utilizadas/recibidas como par\u00e1metros, etc... Si los recursos est\u00e1n en un espacio de nombres diferente al que estamos, emplearemos use con la ruta completa para luego utilizar referencias sin cualificar. autoload \u00bfNo es tedioso tener que hacer el include de las clases? El autoload viene al rescate. As\u00ed pues, permite cargar las clases (no las constantes ni las funciones) que se van a utilizar y evitar tener que hacer el include_once de cada una de ellas. Para ello, se utiliza la funci\u00f3n spl_autoload_register . PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once $nombreClase . '.php' ; } ); ?> por qu\u00e9 se llama autoload : Porque antes se realizaba mediante el m\u00e9todo m\u00e1gico __autoload() , el cual est\u00e1 deprecated desde PHP 7.2. Y \u00bfc\u00f3mo organizamos ahora nuestro c\u00f3digo aprovechando el autoload? Para facilitar la b\u00fasqueda de los recursos a incluir, es recomendable colocar todas las clases dentro de una misma carpeta. Nosotros la vamos a colocar dentro de app (m\u00e1s adelante, cuando estudiemos Laravel veremos el motivo de esta decisi\u00f3n). Otras carpetas que podemos crear son test para colocar las pruebas PhpUnit que luego realizaremos, o la carpeta vendor donde se almacenar\u00e1n las librer\u00edas del proyecto (esta carpeta es un est\u00e1ndard dentro de PHP, ya que Composer la crea autom\u00e1ticamente). Como hemos colocado todos nuestros recursos dentro de app , ahora nuestro autoload.php (el cual colocamos en la carpeta ra\u00edz) s\u00f3lo va a buscar dentro de esa carpeta: PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once \"app/\" . $nombreClase . '.php' ; } ); ?> autoload y rutas err\u00f3neas : En Ubuntu al hacer el include de la clase que recibe como par\u00e1metro, las barras de los namespace ( \\ ) son diferentes a las de las rutas ( / ). Por ello, es mejor que utilicemos el fichero autoload: PHP 1 2 3 4 5 6 7 <?php spl_autoload_register ( function ( $nombreClase ) { $ruta = \"app \\\\ \" . $nombreClase . '.php' ; $ruta = str_replace ( \" \\\\ \" , \"/\" , $ruta ); // Sustituimos las barras include_once $ruta ' ; } ); ?> video Aqu\u00ed encontramos un peque\u00f1o video en el que https://www.youtube.com/watch?v=lP1hbkNA2uc gesti\u00f3n de errores PHP clasifica los errores que ocurren en diferentes niveles. Cada nivel se identifica con una constante. Por ejemplo: E_ERROR : errores fatales, no recuperables. Se interrumpe el script. E_WARNING : advertencias en tiempo de ejecuci\u00f3n. El script no se interrumpe. E_NOTICE : avisos en tiempo de ejecuci\u00f3n. Pod\u00e9is comprobar el listado completo de constantes de https://www.php.net/manual/es/errorfunc.constants.php Para la configuraci\u00f3n de los errores podemos hacerlo de dos formas: A nivel de php.ini : error_reporting : indica los niveles de errores a notificar. rerror_reporting = E_ALL & ~E_NOTICE -> Todos los errores menos los avisos en tiempo de ejecuci\u00f3n. display_errors : indica si mostrar o no los errores por pantalla. En entornos de producci\u00f3n es com\u00fan ponerlo a off. mediante c\u00f3digo con las siguientes funciones: error_reporting(codigo) -> Controla qu\u00e9 errores notificar. set_error_handler(nombreManejador) -> Indica qu\u00e9 funci\u00f3n se invocar\u00e1 cada vez que se encuentre un error. El manejador recibe como par\u00e1metros el nivel del error y el mensaje. A continuaci\u00f3n tenemos un ejemplo mediante c\u00f3digo: Funciones para la gesti\u00f3n de errores : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php error_reporting ( E_ALL & ~ E_NOTICE & ~ E_WARNING ); $resultado = $dividendo / $divisor ; error_reporting ( E_ALL & ~ E_NOTICE ); set_error_handler ( \"miManejadorErrores\" ); $resultado = $dividendo / $divisor ; restore_error_handler (); // vuelve al anterior function miManejadorErrores ( $nivel , $mensaje ) { switch ( $nivel ) { case E_WARNING : echo \"<strong>Warning</strong>: $mensaje .<br/>\" ; break ; default : echo \"Error de tipo no especificado: $mensaje .<br/>\" ; } } Consola : Text Only 1 2 3 Error de tipo no especificado: Undefined variable: dividendo. Error de tipo no especificado: Undefined variable: divisor. Error de tipo Warning: Division by zero. excepciones La gesti\u00f3n de excepciones forma parte desde PHP 5. Su funcionamiento es similar a Java, haciendo uso de un bloque try / catch / finally . Si detectamos una situaci\u00f3n an\u00f3mala y queremos lanzar una excepci\u00f3n, deberemos realizar throw new Exception (adjuntando el mensaje que lo ha provocado). PHP 1 2 3 4 5 6 7 8 9 <?php try { if ( $divisor == 0 ) { throw new Exception ( \"Divisi\u00f3n por cero.\" ); } $resultado = $dividendo / $divisor ; } catch ( Exception $e ) { echo \"Se ha producido el siguiente error: \" . $e -> getMessage (); } La clase Exception es la clase madre de todas las excepciones. Su constructor recibe mensaje [, codigoError][, excepcionPrevia] . A partir de un objeto Exception , podemos acceder a los m\u00e9todos getMessage() y getCode() para obtener el mensaje y el c\u00f3digo de error de la excepci\u00f3n capturada. El propio lenguaje ofrece un conjunto de excepciones ya definidas, las cuales podemos capturar (y lanzar desde PHP 7). Se recomienda su consulta en la documentaci\u00f3n oficial . creando excepciones Para crear una excepci\u00f3n, la forma m\u00e1s corta es crear una clase que \u00fanicamente herede de Exception . PHP 1 2 <?php class HolaExcepcion extends Exception {} Si queremos, y es recomendable dependiendo de los requisitos, podemos sobrecargar los m\u00e9todos m\u00e1gicos, por ejemplo, sobrecargando el constructor y llamando al constructor de la clase madre, o rescribir el m\u00e9todo __toString para cambiar su mensaje: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MiExcepcion extends Exception { public function __construct ( $msj , $codigo = 0 , Exception $previa = null ) { // c\u00f3digo propio parent :: __construct ( $msj , $codigo , $previa ); } public function __toString () { return __CLASS__ . \": [ { $this -> code } ]: { $this -> message } \\n \" ; } public function miFuncion () { echo \"Una funci\u00f3n personalizada para este tipo de excepci\u00f3n \\n \" ; } } Si definimos una excepci\u00f3n de aplicaci\u00f3n dentro de un namespace , cuando referenciemos a Exception , deberemos referenciarla mediante su nombre totalmente cualificado ( \\Exception ), o utilizando use : Mediante nombre totalmente cualificado PHP 1 2 3 4 <?php namespace \\Dwes\\Ejemplos ; class AppExcepcion extends \\Exception {} Mediante use PHP 1 2 3 4 5 6 <?php namespace \\Dwes\\Ejemplos ; use Exception ; class AppExcepcion extends Exception {} excepciones m\u00faltiples Se pueden usar excepciones m\u00faltiples para comprobar diferentes condiciones. A la hora de capturarlas, se hace de m\u00e1s espec\u00edfica a m\u00e1s general. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php $email = \"ejemplo@ejemplo.com\" ; try { // Comprueba si el email es v\u00e1lido if ( filter_var ( $email , FILTER_VALIDATE_EMAIL ) === FALSE ) { throw new MiExcepcion ( $email ); } // Comprueba la palabra ejemplo en la direcci\u00f3n email if ( strpos ( $email , \"ejemplo\" ) !== FALSE ) { throw new Exception ( \" $email es un email de ejemplo no v\u00e1lido\" ); } } catch ( MiExcepcion $e ) { echo $e -> miFuncion (); } catch ( Exception $e ) { echo $e -> getMessage (); } autoevaluaci\u00f3n : \u00bfQu\u00e9 pasar\u00eda al ejecutar el siguiente c\u00f3digo? PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException $e ) { echo \"Capturada MainException \" . $e -> getMessage (); } catch ( SubException $e ) { echo \"Capturada SubException \" . $e -> getMessage (); } catch ( Exception $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Si en el mismo catch queremos capturar varias excepciones, hemos de utilizar el operador | : PHP 1 2 3 4 5 6 7 8 9 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException | SubException $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Desde PHP 7, existe el tipo Throwable , el cual es un interfaz que implementan tanto los errores como las excepciones, y nos permite capturar los dos tipos a la vez: PHP 1 2 3 4 5 6 <?php try { // tu codigo } catch ( Throwable $e ) { echo 'Forma de capturar errores y excepciones a la vez' ; } Si s\u00f3lo queremos capturar los errores fatales, podemos hacer uso de la clase Error : PHP 1 2 3 4 5 6 7 8 9 <?php try { // Genera una notificaci\u00f3n que no se captura echo $variableNoAsignada ; // Error fatal que se captura funcionQueNoExiste (); } catch ( Error $e ) { echo \"Error capturado: \" . $e -> getMessage (); } relanzar excepciones En las aplicaciones reales, es muy com\u00fan capturar una excepci\u00f3n de sistema y lanzar una de aplicaci\u00f3n que hemos definido nosotros. Tambi\u00e9n podemos lanzar las excepciones sin necesidad de estar dentro de un try / catch . PHP 1 2 3 4 5 6 7 8 <?php class AppException extends Exception {} try { // C\u00f3digo de negocio que falla } catch ( Exception $e ) { throw new AppException ( \"AppException: \" . $e -> getMessage (), $e -> getCode (), $e ); } SPL Standard PHP Library es el conjunto de funciones y utilidades que ofrece PHP, como: Estructuras de datos: pila, cola, cola de prioridad, lista doblemente enlazada, etc... Conjunto de iteradores dise\u00f1ados para recorrer estructuras agregadas: arrays, resultados de bases de datos, \u00e1rboles XML, listados de directorios, etc. Pod\u00e9is consultar la documentaci\u00f3n en https://www.php.net/manual/es/book.spl.php o ver algunos ejemplos en https://diego.com.es/tutorial-de-la-libreria-spl-de-php Tambi\u00e9n define un conjunto de excepciones que podemos utilizar para que las lancen nuestras aplicaciones: LogicException (extends Exception) BadFunctionCallException BadMethodCallException DomainException InvalidArgumentException LengthException OutOfRangeException RuntimeException (extends Exception) OutOfBoundsException OverflowException RangeException UnderflowException UnexpectedValueException Tambi\u00e9n pod\u00e9is consultar la documentaci\u00f3n de estas excepciones en https://www.php.net/manual/es/spl.exceptions.php. referencias Manual de PHP Manual de OO en PHP - www.desarrolloweb.com videos Curso PHP 8 desde cero (Actulizado) :","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud03/ud0302/#duracion-y-criterios-de-evaluacion","text":"Duraci\u00f3n estimada : 18 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio. a) Se han identificado las ventajas de separar la l\u00f3gica de negocio de los aspectos de presentaci\u00f3n de la aplicaci\u00f3n. b) Se han analizado tecnolog\u00edas y mecanismos que permiten realizar esta separaci\u00f3n y sus caracter\u00edsticas principales. c) Se han utilizado objetos y controles en el servidor para generar el aspecto visual de la aplicaci\u00f3n web en el cliente. d) Se han utilizado formularios generados de forma din\u00e1mica para responder a los eventos de la aplicaci\u00f3n Web. e) Se han escrito aplicaciones Web con mantenimiento de estado y separaci\u00f3n de la l\u00f3gica de negocio. f) Se han aplicado los principios de la programaci\u00f3n orientada a objetos. g) Se ha probado y documentado el c\u00f3digo.","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud03/ud0302/#clases-y-objetos","text":"PHP sigue un paradigma de programaci\u00f3n orientada a objetos (POO) basada en clases. Una clase es una plantilla que define las atributos y m\u00e9todos para poder crear objetos. De este manera, un objeto es una instancia de una clase . Tanto los atributos como los m\u00e9todos se definen con una visibilidad (qui\u00e9n puede acceder): Privado - private : S\u00f3lo puede acceder la propia clase. Protegido - protected : S\u00f3lo puede acceder la propia clase o sus descendientes. P\u00fablico - public : Puede acceder cualquier otra clase. Para declarar una clase, se utiliza la palabra clave class seguido del nombre de la clase. Para instanciar un objeto a partir de la clase, se utiliza new : PHP 1 2 3 4 5 6 7 <?php class NombreClase { // atributos // y m\u00e9todos } $ob = new NombreClase (); clases con may\u00fascula : Todas las clases empiezan por letra may\u00fascula. Cuando un proyecto crece, es normal modelar las clases mediante UML (\u00bfrecord\u00e1is Entornos de Desarrollo ?). La clases se representan mediante un cuadrado, separando el nombre, de los atributos y los m\u00e9todos: Una vez que hemos creado un objeto, se utiliza el operador -> para acceder a un atributo o un m\u00e9todo del objeto: PHP 1 2 $objeto->atributo; $objeto->m\u00e9todo(par\u00e1metros); Si desde, dentro de la clase, queremos acceder a un atributo o m\u00e9todo de la misma clase, utilizaremos la referencia $this ; PHP 1 2 $this->atributo; $this->m\u00e9todo(par\u00e1metros); As\u00ed pues, como ejemplo, codificar\u00edamos una persona en el fichero Persona.php como: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php class Persona { private string $nombre ; public function setNombre ( string $nombre ) { $this -> nombre = $nombre ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona (); // creamos un objeto $bruno -> setNombre ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Aunque se pueden declarar varias clases en el mismo archivo, es una mala pr\u00e1ctica. As\u00ed pues, cada fichero : contedr\u00e1 una sola clase , y se nombrar\u00e1 con el nombre de la clase .","title":"clases y objetos"},{"location":"ud03/ud0302/#encapsulacion","text":"Los atributos se definen privados o protegidos (si queremos que las clases heredadas puedan acceder). Para cada atributo, se a\u00f1aden m\u00e9todos p\u00fablicos ( getter / setter ): PHP 1 2 3 public function setAtributo (tipo $param); public function getAtributo () : tipo; Las constantes se definen p\u00fablicas para que sean accesibles por todos los recursos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 <?php class MayorMenor { private int $mayor ; private int $menor ; public function setMayor ( int $may ) { $this -> mayor = $may ; } public function setMenor ( int $men ) { $this -> menor = $men ; } public function getMayor () : int { return $this -> mayor ; } public function getMenor () : int { return $this -> menor ; } }","title":"encapsulaci\u00f3n"},{"location":"ud03/ud0302/#recibiendo-y-enviando-objetos","text":"Es recomendable indicarlo en el tipo de par\u00e1metros. Si el objeto puede devolver nulos se pone ? delante del nombre de la clase. objetos por referencia : Los objetos que se env\u00edan y reciben como par\u00e1metros siempre se pasan por referencia. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php function maymen ( array $numeros ) : ? MayorMenor { $a = max ( $numeros ); $b = min ( $numeros ); $result = new MayorMenor (); $result -> setMayor ( $a ); $result -> setMenor ( $b ); return $result ; } $resultado = maymen ( [ 1 , 76 , 9 , 388 , 41 , 39 , 25 , 97 , 22 ] ); echo \"<br>Mayor: \" . $resultado -> getMayor (); echo \"<br>Menor: \" . $resultado -> getMenor ();","title":"Recibiendo y enviando objetos"},{"location":"ud03/ud0302/#constructor","text":"El constructor de los objetos se define mediante el m\u00e9todo m\u00e1gico __construct . Puede o no tener par\u00e1metros, pero s\u00f3lo puede haber un \u00fanico constructor . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Persona { private string $nombre ; public function __construct ( string $nom ) { $this -> nombre = $nom ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona ( \"Bruno D\u00edaz\" ); $bruno -> imprimir ();","title":"constructor"},{"location":"ud03/ud0302/#constructores-en-php8","text":"Una de las grandes novedades que ofrece PHP 8 es la simplificaci\u00f3n de los constructores con par\u00e1metros, lo que se conoce como promoci\u00f3n de los atributos del constructor . Para ello, en vez de tener que declarar los atributos como privados o protegidos, y luego dentro del constructor tener que asignar los par\u00e1metros a estos atributos, el propio constructor promociona los atributos. Ve\u00e1moslo mejor con un ejemplo. Imaginemos una clase Punto donde queramos almacenar sus coordenadas. As\u00ed quedar\u00eda en PHP7 o anteriores: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Punto { protected float $x ; protected float $y ; protected float $z ; public function __construct ( float $x = 0.0 , float $y = 0.0 , float $z = 0.0 ) { $this -> x = $x ; $this -> y = $y ; $this -> z = $z ; } } En PHP8 , quedar\u00eda del siguiente modo (mucho m\u00e1s corto, lo que facilita su legibilidad): PHP 1 2 3 4 5 6 7 8 <?php class Punto { public function __construct ( protected float $x = 0.0 , protected float $y = 0.0 , protected float $z = 0.0 , ) {} } el orden importa: A la hora de codificar el orden de los elementos debe ser: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php declare ( strict_types = 1 ); class NombreClase { // atributos // constructor // getters - setters // resto de m\u00e9todos } ?>","title":"constructores en PHP8"},{"location":"ud03/ud0302/#clases-estaticas","text":"Son aquellas que tienen atributos ( o propiedades ) y/o m\u00e9todos est\u00e1ticos (tambi\u00e9n se conocen como de clase , porque su valor se comparte entre todas las instancias de la misma clase). Se declaran con static y se referencian con :: . Si queremos acceder a un m\u00e9todo est\u00e1tico , se antepone el nombre de la clase como sigue: Producto::nuevoProducto() . Si desde un m\u00e9todo queremos acceder a un atributo est\u00e1tico de la misma clase, se utiliza la referencia self como sigue: self::$numProductos . PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; public static function nuevoProducto () { self :: $numProductos ++ ; } } Producto :: nuevoProducto (); $impuesto = Producto :: IVA ; Tambi\u00e9n podemos tener clases normales que tengan algun atributo est\u00e1tico: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; private $codigo ; public function __construct ( string $cod ) { self :: $numProductos ++ ; $this -> codigo = $cod ; } public function mostrarResumen () : string { return \"El producto \" . $this -> codigo . \" es el n\u00famero \" . self :: $numProductos ; } } $prod1 = new Producto ( \"PS5\" ); $prod2 = new Producto ( \"XBOX Series X\" ); $prod3 = new Producto ( \"Nintendo Switch\" ); echo $prod3 -> mostrarResumen (); Bash 1 El producto Nintendo Switch es el n\u00famero 3","title":"clases est\u00e1ticas"},{"location":"ud03/ud0302/#introspeccion","text":"Al trabajar con clases y objetos, existen un conjunto de funciones ya definidas por el lenguaje que permiten obtener informaci\u00f3n sobre los objetos: instanceof : permite comprobar si un objeto es de una determinada clase. get_class : devuelve el nombre de la clase. get_declared_class : devuelve un array con los nombres de las clases definidas. class_alias : crea un alias. class_exists / method_exists / property_exists : devuelve true si la clase/m\u00e9todo/atributo est\u00e1 definida. get_class_methods / get_class_vars / get_object_vars : devuelve un array con los nombres de los m\u00e9todos/atributos de una clase / atributos de un objeto que son accesibles desde d\u00f3nde se hace la llamada. Un ejemplo de estas funciones puede ser el siguiente: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php $p = new Producto ( \"PS5\" ); if ( $p instanceof Producto ) { echo \"Es un producto.<br/>\" ; echo \"La clase es \" . get_class ( $p ) . \"<br/>\" ; class_alias ( \"Producto\" , \"Articulo\" ); $c = new Articulo ( \"Nintendo Switch\" ); echo \"Un articulo es un \" . get_class ( $c ) . \"<br/>\" ; print_r ( get_class_methods ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_class_vars ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_object_vars ( $p )); echo \"<br/>\" ; if ( method_exists ( $p , \"mostrarResumen\" )) { echo $p -> mostrarResumen (); } } clonado : Al asignar dos objetos no se copian, se crea una nueva referencia. Si queremos una copia, hay que clonarlo mediante el m\u00e9todo clone(object) : object . PHP nos permite crear un m\u00e9todo que se llamar\u00e1 cuando ejecutemos el operador clone. Este m\u00e9todo puede entre otras cosas inicializar algunos atributos. Si no se define el m\u00e9todo __clone() se har\u00e1 una copia id\u00e9ntica del objeto que le pasamos como par\u00e1metro al operador clone. Veamos un ejemplo: Crearemos una clase Persona que tenga como atributos su nombre y edad, definiremos los m\u00e9todos para cargar y retornar los valores de sus atributos. Haremos que cuando clonemos un objeto de dicha clase la edad de la persona se fije con cero. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php class Persona { private $nombre ; private $edad ; public function fijarNombreEdad ( $nom , $ed ) { $this -> nombre = $nom ; $this -> edad = $ed ; } public function getNombre () { return $this -> nombre ; } public function getEdad () { return $this -> edad ; } public function __clone () { $this -> edad = 0 ; } } $persona1 = new Persona (); $persona1 -> fijarNombreEdad ( 'Juan' , 20 ); echo 'Datos de $persona1:' ; echo $persona1 -> retornarNombre () . ' - ' . $persona1 -> retornarEdad () . '<br>' ; $persona2 = clone ( $persona1 ); echo 'Datos de $persona2:' ; echo $persona2 -> retornarNombre () . ' - ' . $persona2 -> retornarEdad () . '<br>' ; ?> El m\u00e9todo __clone se ejecutar\u00e1 cuando llamemos al operador clone para esta clase: PHP 1 2 3 public function __clone() { $this->edad=0; } Es decir cuando realicemos la asignaci\u00f3n: PHP 1 $persona2 = clone($persona1); inicialmente se hace una copia id\u00e9ntica de $persona1 pero luego se ejecuta el m\u00e9todo __clone con lo que el atributo $edad se modifica. Si queremos que una clase no pueda clonarse simplemente podemos implementar el siguiente c\u00f3digo en el m\u00e9todo __clone(): PHP 1 2 3 public function __clone() { die('No esta permitido clonar objetos de esta clase'); } M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/language.oop5.cloning.php","title":"introspecci\u00f3n"},{"location":"ud03/ud0302/#herencia","text":"PHP soporta herencia simple, de manera que una clase solo puede heredar de otra clase , no de dos o m\u00e1s clases a la vez. Para ello se utiliza la palabra clave extends . Si queremos que la clase A hereda de la clase B haremos: PHP 1 class A extends B La clase hija hereda los atributos y m\u00e9todos p\u00fablicos y protegidos de la clase madre. cada clase en un archivo : Como ya hemos comentado, deber\u00edamos colocar cada clase en un archivo diferente para posteriormente utilizarlo mediante include . En los siguientes ejemplos los hemos colocado juntos para facilitar su legibilidad. Por ejemplo, tenemos una clase Producto y una Tv que hereda de Producto : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Producto { protected $codigo ; protected $nombre ; protected $nombreCorto ; protected $PVP ; public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { protected $pulgadas ; protected $tecnologia ; } Podemos utilizar las siguientes funciones para averiguar si hay relaci\u00f3n entre dos clases: get_parent_class(object): string is_subclass_of(object, string): bool PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php $t = new Tv (); $t -> codigo = 33 ; if ( $t instanceof Producto ) { echo $t -> mostrarResumen (); } $madre = get_parent_class ( $t ); echo \"<br>La clase madre es: \" . $madre ; $objetoMadre = new $madre ; echo $objetoMadre -> mostrarResumen (); if ( is_subclass_of ( $t , 'Producto' )) { echo \"<br>Soy una hija de Producto\" ; }","title":"herencia"},{"location":"ud03/ud0302/#sobreescribir-metodos","text":"Podemos crear m\u00e9todos en las clase hijas con el mismo nombre que la clase madre, cambiando su comportamiento. Para invocar a los m\u00e9todos de la clase madre: parent::nombreMetodo() . PHP 1 2 3 4 5 6 7 8 9 10 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } }","title":"sobreescribir m\u00e9todos"},{"location":"ud03/ud0302/#constructor-en-clases-hijas","text":"En cambio, si lo definimos en la clase hija, hemos de invocar al de la clase madre de manera expl\u00edcita. PHP 7 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 <?php class Producto { public string $codigo ; public function __construct ( string $codigo ) { $this -> codigo = $codigo ; } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function __construct ( string $codigo , int $pulgadas , string $tecnologia ) { parent :: __construct ( $codigo ); $this -> pulgadas = $pulgadas ; $this -> tecnologia = $tecnologia ; } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } PHP 8 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php class Producto { public function __construct ( private string $codigo ) { } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public function __construct ( string $codigo , private int $pulgadas , private string $tecnologia ) { parent :: __construct ( $codigo ); } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } }","title":"constructor en clases hijas"},{"location":"ud03/ud0302/#clases-abstractas","text":"Las clases abstractas obligan a heredar de estas clases, ya que no se permite su instanciaci\u00f3n; s\u00ed se permite a las clases heredadas (siempre que no est\u00e9n tambi\u00e9n definidas como abstractas). Se define mediante abstract class NombreClase { . Una clase abstracta puede contener atributos y m\u00e9todos no-abstractos, y/o m\u00e9todos abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php // Clase abstracta abstract class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } // M\u00e9todo abstracto abstract public function mostrarResumen (); } Cuando una clase hereda de una clase abstracta, obligat\u00f3riamente debe implementar los m\u00e9todos que tiene la clase madre marcados como abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { //obligado a implementarlo echo \"<p>C\u00f3digo \" . $this -> getCodigo () . \"</p>\" ; echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } $t = new Tv (); echo $t -> getCodigo ();","title":"clases abstractas"},{"location":"ud03/ud0302/#clases-finales","text":"Son clases opuestas a abstractas, ya que evitan que se pueda heredar una clase o m\u00e9todo para sobreescribirlo. Se define mediante final class NombreClase { . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } final public function mostrarResumen () : string { return \"Producto \" . $this -> codigo ; } } // No podremos heredar de Microondas final class Microondas extends Producto { private $potencia ; public function getPotencia () : int { return $this -> potencia ; } // No podemos implementar mostrarResumen() }","title":"clases finales"},{"location":"ud03/ud0302/#interfaces","text":"Permite definir un contrato con las firmas de los m\u00e9todos a cumplir. As\u00ed pues, s\u00f3lo contiene declaraciones de funciones y todas deben ser p\u00fablicas. Se declaran con la palabra clave interface y luego las clases que cumplan el contrato lo realizan mediante la palabra clave implements . PHP 1 2 3 4 5 6 <?php interface Nombreable { // declaraci\u00f3n de funciones } class NombreClase implements NombreInterfaz { // c\u00f3digo de la clase Se permite la herencia de interfaces. Adem\u00e1s, una clase puede implementar varios interfaces (en este caso, s\u00ed soporta la herecia m\u00faltiple, pero s\u00f3lo de interfaces). PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php interface Mostrable { public function mostrarResumen () : string ; } interface MostrableTodo extends Mostrable { public function mostrarTodo () : string ; } interface Facturable { public function generarFactura () : string ; } class Producto implements MostrableTodo , Facturable { // Implementaciones de los m\u00e9todos // Obligatoriamente deber\u00e1 implementar: // - public function mostrarResumen, // - public function mostrarTodo y // - public function generarFactura }","title":"interfaces"},{"location":"ud03/ud0302/#metodos-encadenados","text":"Sigue el planteamiento de la programaci\u00f3n funcional, y tambi\u00e9n se conoce como method chaining . Plantea que sobre un objeto se realizan varias llamadas; o sea, consiste en llamar varios m\u00e9todos de un objeto en una misma l\u00ednea, basta con a\u00f1adir al final de cada m\u00e9todo: return $this; Con el siguiente ejemplo se entiende f\u00e1cilmente. Para facilitarlo, vamos a modificar todos sus m\u00e9todos mutadores (que modifican datos , setters , ...) para que devuelvan una referencia a $this : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Coche { public function lavar (){ echo \"Coche lavado. \\n \" ; return $this ; } public function encerar (){ echo \"Coche encerado. \\n \" ; return $this ; } } // ejemplo llamada a los m\u00e9todos encadenados $coche = new Coche ; $coche -> lavar () -> encerar (); Bash 1 2 3 // mostrar\u00e1 Coche lavado. Coche encerado. Otro ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php class Libro { private string $nombre ; private string $autor ; public function getNombre () : string { return $this -> nombre ; } public function setNombre ( string $nombre ) : Libro { $this -> nombre = $nombre ; return $this ; } public function getAutor () : string { return $this -> autor ; } public function setAutor ( string $autor ) : Libro { $this -> autor = $autor ; return $this ; } public function __toString () : string { return $this -> nombre . \" de \" . $this -> autor ; } }","title":"m\u00e9todos encadenados"},{"location":"ud03/ud0302/#metodos-magicos","text":"Todas las clases PHP ofrecen un conjunto de m\u00e9todos, tambi\u00e9n conocidos como magic methods que se pueden sobreescribir para sustituir su comportamiento. Algunos de ellos ya los hemos utilizado. Ante cualquier duda, es conveniente consultar la documentaci\u00f3n oficial . Los m\u00e1s destacables son: __construct() __destruct() \u2192 se invoca al perder la referencia. Se utiliza para cerrar una conexi\u00f3n a la BD, cerrar un fichero, ... __toString() \u2192 representaci\u00f3n del objeto como cadena. Es decir, cuando hacemos echo $objeto se ejecuta autom\u00e1ticamente este m\u00e9todo. get(atributo) , set(atributo, valor) \u2192 Permitir\u00eda acceder a los atributos privados, aunque siempre es m\u00e1s legible/mantenible codificar los getter/setter. __isset(atributo) , __unset(atributo) \u2192 Permite averiguar o quitar el valor a un atributo. sleep() , wakeup() \u2192 Se ejecutan al recuperar ( unserialize^ ) o almacenar un objeto que se serializa ( serialize ), y se utilizan para permite definir qu\u00e9 atributos se serializan. call() , callStatic() \u2192 Se ejecutan al llamar a un m\u00e9todo que no es p\u00fablico. Permiten sobrecargar m\u00e9todos.","title":"m\u00e9todos m\u00e1gicos"},{"location":"ud03/ud0302/#espacio-de-nombres","text":"Desde PHP 5.3 y tambi\u00e9n conocidos como Namespaces , permiten organizar las clases/interfaces, funciones y/o constantes (de forma similar a los paquetes en Java) en un \u00e1mbito restringido; evitando colisiones o conflictos de nombre con otros elementos que se pueden crear m\u00e1s adelante (o con algunas librer\u00edas que utilices). recomendaci\u00f3n : Un s\u00f3lo namespace por archivo y crear una estructura de carpetas respectando los niveles/subniveles (igual que se hace en Java). Se declaran en la primera l\u00ednea mediante la palabra clave namespace seguida del nombre del espacio de nombres asignado (cada subnivel se separa con la barra invertida \\ ): Por ejemplo, para colocar la clase Producto dentro del namespace Dwes\\Ejemplos lo har\u00edamos as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace Dwes\\Ejemplos ; const IVA = 0.21 ; class Producto { public $nombre ; public function muestra () : void { echo \"<p>Prod:\" . $this -> nombre . \"</p>\" ; } }","title":"espacio de nombres"},{"location":"ud03/ud0302/#acceso","text":"Para referenciar a un recurso que contiene un namespace, primero hemos de tenerlo disponible haciendo uso de include o require . Si el recurso est\u00e1 en el mismo namespace, se realiza un acceso directo (se conoce como acceso sin cualificar ). Realmente hay tres tipos de acceso: sin cualificar: recurso cualificado: rutaRelativa\\recurso \u2192 no hace falta poner el namespace completo. totalmente cualificado: \\rutaAbsoluta\\recurso PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php namespace Dwes\\Ejemplos ; include_once ( \"Producto.php\" ); // sin cualificar echo IVA ; // acceso cualificado. // Dar\u00eda error, no existe \\Dwes\\Ejemplos\\Utilidades\\IVA echo Utilidades\\IVA ; // totalmente cualificado echo \\Dwes\\Ejemplos\\IVA ; $p1 = new Producto (); // lo busca en el mismo namespace y // encuentra \\Dwes\\Ejemplos\\Producto $p2 = new Model\\Producto (); // dar\u00eda error, no existe el namespace Model. // Est\u00e1 buscando \\Dwes\\Ejemplos\\Model\\Producto $p3 = new \\Dwes\\Ejemplos\\Producto (); // \\Dwes\\Ejemplos\\Producto video","title":"acceso"},{"location":"ud03/ud0302/#use","text":"Para evitar la referencia cualificada podemos declarar el uso mediante use (similar a hacer import en Java). Se hace en la cabecera, tras el namespace: Los tipos posibles son: use const nombreCualificadoConstante use function nombreCualificadoFuncion use nombreCualificadoClase use nombreCualificadoClase as NuevoNombre // para renombrar elementos Por ejemplo, si queremos utilizar la clase \\Dwes\\Ejemplos\\Producto desde un recurso que se encuentra en la ra\u00edz, por ejemplo en inicio.php , har\u00edamos: PHP 1 2 3 4 5 6 7 8 <?php include_once ( \"Dwes\\Ejemplo\\Producto.php\" ); use const Dwes\\Ejemplos\\IVA ; use \\Dwes\\Ejemplos\\Producto ; echo IVA ; $p1 = new Producto (); to use or not to use En resumen, use permite acceder sin cualificar a recursos que est\u00e1n en otro namespace . Si estamos en el mismo espacio de nombre, no necesitamos use . video","title":"use"},{"location":"ud03/ud0302/#organizacion","text":"Todo proyecto, conforme crece, necesita organizar su c\u00f3digo fuente. Se plantea una organizaci\u00f3n en la que los archivos que interactuan con el navegador se colocan en el ra\u00edz, y las clases que definamos van dentro de un namespace (y dentro de su propia carpeta src o app). organizaci\u00f3n, includes y usos : Colocaremos cada recurso en un fichero aparte. En la primera l\u00ednea indicaremos su namespace (si no est\u00e1 en el ra\u00edz). Si utilizamos otros recursos, haremos un include_once de esos recursos (clases, interfaces, etc...). Cada recurso debe incluir todos los otros recursos que referencie: la clase de la que hereda, interfaces que implementa, clases utilizadas/recibidas como par\u00e1metros, etc... Si los recursos est\u00e1n en un espacio de nombres diferente al que estamos, emplearemos use con la ruta completa para luego utilizar referencias sin cualificar.","title":"organizaci\u00f3n"},{"location":"ud03/ud0302/#autoload","text":"\u00bfNo es tedioso tener que hacer el include de las clases? El autoload viene al rescate. As\u00ed pues, permite cargar las clases (no las constantes ni las funciones) que se van a utilizar y evitar tener que hacer el include_once de cada una de ellas. Para ello, se utiliza la funci\u00f3n spl_autoload_register . PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once $nombreClase . '.php' ; } ); ?> por qu\u00e9 se llama autoload : Porque antes se realizaba mediante el m\u00e9todo m\u00e1gico __autoload() , el cual est\u00e1 deprecated desde PHP 7.2. Y \u00bfc\u00f3mo organizamos ahora nuestro c\u00f3digo aprovechando el autoload? Para facilitar la b\u00fasqueda de los recursos a incluir, es recomendable colocar todas las clases dentro de una misma carpeta. Nosotros la vamos a colocar dentro de app (m\u00e1s adelante, cuando estudiemos Laravel veremos el motivo de esta decisi\u00f3n). Otras carpetas que podemos crear son test para colocar las pruebas PhpUnit que luego realizaremos, o la carpeta vendor donde se almacenar\u00e1n las librer\u00edas del proyecto (esta carpeta es un est\u00e1ndard dentro de PHP, ya que Composer la crea autom\u00e1ticamente). Como hemos colocado todos nuestros recursos dentro de app , ahora nuestro autoload.php (el cual colocamos en la carpeta ra\u00edz) s\u00f3lo va a buscar dentro de esa carpeta: PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once \"app/\" . $nombreClase . '.php' ; } ); ?> autoload y rutas err\u00f3neas : En Ubuntu al hacer el include de la clase que recibe como par\u00e1metro, las barras de los namespace ( \\ ) son diferentes a las de las rutas ( / ). Por ello, es mejor que utilicemos el fichero autoload: PHP 1 2 3 4 5 6 7 <?php spl_autoload_register ( function ( $nombreClase ) { $ruta = \"app \\\\ \" . $nombreClase . '.php' ; $ruta = str_replace ( \" \\\\ \" , \"/\" , $ruta ); // Sustituimos las barras include_once $ruta ' ; } ); ?> video Aqu\u00ed encontramos un peque\u00f1o video en el que https://www.youtube.com/watch?v=lP1hbkNA2uc","title":"autoload"},{"location":"ud03/ud0302/#gestion-de-errores","text":"PHP clasifica los errores que ocurren en diferentes niveles. Cada nivel se identifica con una constante. Por ejemplo: E_ERROR : errores fatales, no recuperables. Se interrumpe el script. E_WARNING : advertencias en tiempo de ejecuci\u00f3n. El script no se interrumpe. E_NOTICE : avisos en tiempo de ejecuci\u00f3n. Pod\u00e9is comprobar el listado completo de constantes de https://www.php.net/manual/es/errorfunc.constants.php Para la configuraci\u00f3n de los errores podemos hacerlo de dos formas: A nivel de php.ini : error_reporting : indica los niveles de errores a notificar. rerror_reporting = E_ALL & ~E_NOTICE -> Todos los errores menos los avisos en tiempo de ejecuci\u00f3n. display_errors : indica si mostrar o no los errores por pantalla. En entornos de producci\u00f3n es com\u00fan ponerlo a off. mediante c\u00f3digo con las siguientes funciones: error_reporting(codigo) -> Controla qu\u00e9 errores notificar. set_error_handler(nombreManejador) -> Indica qu\u00e9 funci\u00f3n se invocar\u00e1 cada vez que se encuentre un error. El manejador recibe como par\u00e1metros el nivel del error y el mensaje. A continuaci\u00f3n tenemos un ejemplo mediante c\u00f3digo: Funciones para la gesti\u00f3n de errores : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php error_reporting ( E_ALL & ~ E_NOTICE & ~ E_WARNING ); $resultado = $dividendo / $divisor ; error_reporting ( E_ALL & ~ E_NOTICE ); set_error_handler ( \"miManejadorErrores\" ); $resultado = $dividendo / $divisor ; restore_error_handler (); // vuelve al anterior function miManejadorErrores ( $nivel , $mensaje ) { switch ( $nivel ) { case E_WARNING : echo \"<strong>Warning</strong>: $mensaje .<br/>\" ; break ; default : echo \"Error de tipo no especificado: $mensaje .<br/>\" ; } } Consola : Text Only 1 2 3 Error de tipo no especificado: Undefined variable: dividendo. Error de tipo no especificado: Undefined variable: divisor. Error de tipo Warning: Division by zero.","title":"gesti\u00f3n de errores"},{"location":"ud03/ud0302/#excepciones","text":"La gesti\u00f3n de excepciones forma parte desde PHP 5. Su funcionamiento es similar a Java, haciendo uso de un bloque try / catch / finally . Si detectamos una situaci\u00f3n an\u00f3mala y queremos lanzar una excepci\u00f3n, deberemos realizar throw new Exception (adjuntando el mensaje que lo ha provocado). PHP 1 2 3 4 5 6 7 8 9 <?php try { if ( $divisor == 0 ) { throw new Exception ( \"Divisi\u00f3n por cero.\" ); } $resultado = $dividendo / $divisor ; } catch ( Exception $e ) { echo \"Se ha producido el siguiente error: \" . $e -> getMessage (); } La clase Exception es la clase madre de todas las excepciones. Su constructor recibe mensaje [, codigoError][, excepcionPrevia] . A partir de un objeto Exception , podemos acceder a los m\u00e9todos getMessage() y getCode() para obtener el mensaje y el c\u00f3digo de error de la excepci\u00f3n capturada. El propio lenguaje ofrece un conjunto de excepciones ya definidas, las cuales podemos capturar (y lanzar desde PHP 7). Se recomienda su consulta en la documentaci\u00f3n oficial .","title":"excepciones"},{"location":"ud03/ud0302/#creando-excepciones","text":"Para crear una excepci\u00f3n, la forma m\u00e1s corta es crear una clase que \u00fanicamente herede de Exception . PHP 1 2 <?php class HolaExcepcion extends Exception {} Si queremos, y es recomendable dependiendo de los requisitos, podemos sobrecargar los m\u00e9todos m\u00e1gicos, por ejemplo, sobrecargando el constructor y llamando al constructor de la clase madre, o rescribir el m\u00e9todo __toString para cambiar su mensaje: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MiExcepcion extends Exception { public function __construct ( $msj , $codigo = 0 , Exception $previa = null ) { // c\u00f3digo propio parent :: __construct ( $msj , $codigo , $previa ); } public function __toString () { return __CLASS__ . \": [ { $this -> code } ]: { $this -> message } \\n \" ; } public function miFuncion () { echo \"Una funci\u00f3n personalizada para este tipo de excepci\u00f3n \\n \" ; } } Si definimos una excepci\u00f3n de aplicaci\u00f3n dentro de un namespace , cuando referenciemos a Exception , deberemos referenciarla mediante su nombre totalmente cualificado ( \\Exception ), o utilizando use : Mediante nombre totalmente cualificado PHP 1 2 3 4 <?php namespace \\Dwes\\Ejemplos ; class AppExcepcion extends \\Exception {} Mediante use PHP 1 2 3 4 5 6 <?php namespace \\Dwes\\Ejemplos ; use Exception ; class AppExcepcion extends Exception {}","title":"creando excepciones"},{"location":"ud03/ud0302/#excepciones-multiples","text":"Se pueden usar excepciones m\u00faltiples para comprobar diferentes condiciones. A la hora de capturarlas, se hace de m\u00e1s espec\u00edfica a m\u00e1s general. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php $email = \"ejemplo@ejemplo.com\" ; try { // Comprueba si el email es v\u00e1lido if ( filter_var ( $email , FILTER_VALIDATE_EMAIL ) === FALSE ) { throw new MiExcepcion ( $email ); } // Comprueba la palabra ejemplo en la direcci\u00f3n email if ( strpos ( $email , \"ejemplo\" ) !== FALSE ) { throw new Exception ( \" $email es un email de ejemplo no v\u00e1lido\" ); } } catch ( MiExcepcion $e ) { echo $e -> miFuncion (); } catch ( Exception $e ) { echo $e -> getMessage (); } autoevaluaci\u00f3n : \u00bfQu\u00e9 pasar\u00eda al ejecutar el siguiente c\u00f3digo? PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException $e ) { echo \"Capturada MainException \" . $e -> getMessage (); } catch ( SubException $e ) { echo \"Capturada SubException \" . $e -> getMessage (); } catch ( Exception $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Si en el mismo catch queremos capturar varias excepciones, hemos de utilizar el operador | : PHP 1 2 3 4 5 6 7 8 9 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException | SubException $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Desde PHP 7, existe el tipo Throwable , el cual es un interfaz que implementan tanto los errores como las excepciones, y nos permite capturar los dos tipos a la vez: PHP 1 2 3 4 5 6 <?php try { // tu codigo } catch ( Throwable $e ) { echo 'Forma de capturar errores y excepciones a la vez' ; } Si s\u00f3lo queremos capturar los errores fatales, podemos hacer uso de la clase Error : PHP 1 2 3 4 5 6 7 8 9 <?php try { // Genera una notificaci\u00f3n que no se captura echo $variableNoAsignada ; // Error fatal que se captura funcionQueNoExiste (); } catch ( Error $e ) { echo \"Error capturado: \" . $e -> getMessage (); }","title":"excepciones m\u00faltiples"},{"location":"ud03/ud0302/#relanzar-excepciones","text":"En las aplicaciones reales, es muy com\u00fan capturar una excepci\u00f3n de sistema y lanzar una de aplicaci\u00f3n que hemos definido nosotros. Tambi\u00e9n podemos lanzar las excepciones sin necesidad de estar dentro de un try / catch . PHP 1 2 3 4 5 6 7 8 <?php class AppException extends Exception {} try { // C\u00f3digo de negocio que falla } catch ( Exception $e ) { throw new AppException ( \"AppException: \" . $e -> getMessage (), $e -> getCode (), $e ); }","title":"relanzar excepciones"},{"location":"ud03/ud0302/#spl","text":"Standard PHP Library es el conjunto de funciones y utilidades que ofrece PHP, como: Estructuras de datos: pila, cola, cola de prioridad, lista doblemente enlazada, etc... Conjunto de iteradores dise\u00f1ados para recorrer estructuras agregadas: arrays, resultados de bases de datos, \u00e1rboles XML, listados de directorios, etc. Pod\u00e9is consultar la documentaci\u00f3n en https://www.php.net/manual/es/book.spl.php o ver algunos ejemplos en https://diego.com.es/tutorial-de-la-libreria-spl-de-php Tambi\u00e9n define un conjunto de excepciones que podemos utilizar para que las lancen nuestras aplicaciones: LogicException (extends Exception) BadFunctionCallException BadMethodCallException DomainException InvalidArgumentException LengthException OutOfRangeException RuntimeException (extends Exception) OutOfBoundsException OverflowException RangeException UnderflowException UnexpectedValueException Tambi\u00e9n pod\u00e9is consultar la documentaci\u00f3n de estas excepciones en https://www.php.net/manual/es/spl.exceptions.php.","title":"SPL"},{"location":"ud03/ud0302/#referencias","text":"Manual de PHP Manual de OO en PHP - www.desarrolloweb.com videos Curso PHP 8 desde cero (Actulizado) :","title":"referencias"},{"location":"ud03/ud0303/","text":"duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada : 18 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio. a) Se han identificado las ventajas de separar la l\u00f3gica de negocio de los aspectos de presentaci\u00f3n de la aplicaci\u00f3n. b) Se han analizado tecnolog\u00edas y mecanismos que permiten realizar esta separaci\u00f3n y sus caracter\u00edsticas principales. c) Se han utilizado objetos y controles en el servidor para generar el aspecto visual de la aplicaci\u00f3n web en el cliente. d) Se han utilizado formularios generados de forma din\u00e1mica para responder a los eventos de la aplicaci\u00f3n Web. e) Se han escrito aplicaciones Web con mantenimiento de estado y separaci\u00f3n de la l\u00f3gica de negocio. f) Se han aplicado los principios de la programaci\u00f3n orientada a objetos. g) Se ha probado y documentado el c\u00f3digo. clases y objetos PHP sigue un paradigma de programaci\u00f3n orientada a objetos (POO) basada en clases. Una clase es una plantilla que define las atributos y m\u00e9todos para poder crear objetos. De este manera, un objeto es una instancia de una clase . Tanto los atributos como los m\u00e9todos se definen con una visibilidad (qui\u00e9n puede acceder): Privado - private : S\u00f3lo puede acceder la propia clase. Protegido - protected : S\u00f3lo puede acceder la propia clase o sus descendientes. P\u00fablico - public : Puede acceder cualquier otra clase. Para declarar una clase, se utiliza la palabra clave class seguido del nombre de la clase. Para instanciar un objeto a partir de la clase, se utiliza new : PHP 1 2 3 4 5 6 7 <?php class NombreClase { // atributos // y m\u00e9todos } $ob = new NombreClase (); clases con may\u00fascula : Todas las clases empiezan por letra may\u00fascula. Cuando un proyecto crece, es normal modelar las clases mediante UML (\u00bfrecord\u00e1is Entornos de Desarrollo ?). La clases se representan mediante un cuadrado, separando el nombre, de los atributos y los m\u00e9todos: Una vez que hemos creado un objeto, se utiliza el operador -> para acceder a un atributo o un m\u00e9todo del objeto: PHP 1 2 $objeto->atributo; $objeto->m\u00e9todo(par\u00e1metros); Si desde, dentro de la clase, queremos acceder a un atributo o m\u00e9todo de la misma clase, utilizaremos la referencia $this ; PHP 1 2 $this->atributo; $this->m\u00e9todo(par\u00e1metros); As\u00ed pues, como ejemplo, codificar\u00edamos una persona en el fichero Persona.php como: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php class Persona { private string $nombre ; public function setNombre ( string $nombre ) { $this -> nombre = $nombre ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona (); // creamos un objeto $bruno -> setNombre ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Aunque se pueden declarar varias clases en el mismo archivo, es una mala pr\u00e1ctica. As\u00ed pues, cada fichero : contedr\u00e1 una sola clase , y se nombrar\u00e1 con el nombre de la clase . encapsulaci\u00f3n Los atributos se definen privados o protegidos (si queremos que las clases heredadas puedan acceder). Para cada atributo, se a\u00f1aden m\u00e9todos p\u00fablicos ( getter / setter ): PHP 1 2 3 public function setAtributo (tipo $param); public function getAtributo () : tipo; Las constantes se definen p\u00fablicas para que sean accesibles por todos los recursos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 <?php class MayorMenor { private int $mayor ; private int $menor ; public function setMayor ( int $may ) { $this -> mayor = $may ; } public function setMenor ( int $men ) { $this -> menor = $men ; } public function getMayor () : int { return $this -> mayor ; } public function getMenor () : int { return $this -> menor ; } } Recibiendo y enviando objetos Es recomendable indicarlo en el tipo de par\u00e1metros. Si el objeto puede devolver nulos se pone ? delante del nombre de la clase. objetos por referencia : Los objetos que se env\u00edan y reciben como par\u00e1metros siempre se pasan por referencia. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php function maymen ( array $numeros ) : ? MayorMenor { $a = max ( $numeros ); $b = min ( $numeros ); $result = new MayorMenor (); $result -> setMayor ( $a ); $result -> setMenor ( $b ); return $result ; } $resultado = maymen ( [ 1 , 76 , 9 , 388 , 41 , 39 , 25 , 97 , 22 ] ); echo \"<br>Mayor: \" . $resultado -> getMayor (); echo \"<br>Menor: \" . $resultado -> getMenor (); constructor El constructor de los objetos se define mediante el m\u00e9todo m\u00e1gico __construct . Puede o no tener par\u00e1metros, pero s\u00f3lo puede haber un \u00fanico constructor . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Persona { private string $nombre ; public function __construct ( string $nom ) { $this -> nombre = $nom ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); constructores en PHP8 Una de las grandes novedades que ofrece PHP 8 es la simplificaci\u00f3n de los constructores con par\u00e1metros, lo que se conoce como promoci\u00f3n de los atributos del constructor . Para ello, en vez de tener que declarar los atributos como privados o protegidos, y luego dentro del constructor tener que asignar los par\u00e1metros a estos atributos, el propio constructor promociona los atributos. Ve\u00e1moslo mejor con un ejemplo. Imaginemos una clase Punto donde queramos almacenar sus coordenadas. As\u00ed quedar\u00eda en PHP7 o anteriores: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Punto { protected float $x ; protected float $y ; protected float $z ; public function __construct ( float $x = 0.0 , float $y = 0.0 , float $z = 0.0 ) { $this -> x = $x ; $this -> y = $y ; $this -> z = $z ; } } En PHP8 , quedar\u00eda del siguiente modo (mucho m\u00e1s corto, lo que facilita su legibilidad): PHP 1 2 3 4 5 6 7 8 <?php class Punto { public function __construct ( protected float $x = 0.0 , protected float $y = 0.0 , protected float $z = 0.0 , ) {} } el orden importa: A la hora de codificar el orden de los elementos debe ser: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php declare ( strict_types = 1 ); class NombreClase { // atributos // constructor // getters - setters // resto de m\u00e9todos } ?> clases est\u00e1ticas Son aquellas que tienen atributos ( o propiedades ) y/o m\u00e9todos est\u00e1ticos (tambi\u00e9n se conocen como de clase , porque su valor se comparte entre todas las instancias de la misma clase). Se declaran con static y se referencian con :: . Si queremos acceder a un m\u00e9todo est\u00e1tico , se antepone el nombre de la clase como sigue: Producto::nuevoProducto() . Si desde un m\u00e9todo queremos acceder a un atributo est\u00e1tico de la misma clase, se utiliza la referencia self como sigue: self::$numProductos . PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; public static function nuevoProducto () { self :: $numProductos ++ ; } } Producto :: nuevoProducto (); $impuesto = Producto :: IVA ; Tambi\u00e9n podemos tener clases normales que tengan algun atributo est\u00e1tico: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; private $codigo ; public function __construct ( string $cod ) { self :: $numProductos ++ ; $this -> codigo = $cod ; } public function mostrarResumen () : string { return \"El producto \" . $this -> codigo . \" es el n\u00famero \" . self :: $numProductos ; } } $prod1 = new Producto ( \"PS5\" ); $prod2 = new Producto ( \"XBOX Series X\" ); $prod3 = new Producto ( \"Nintendo Switch\" ); echo $prod3 -> mostrarResumen (); Bash 1 El producto Nintendo Switch es el n\u00famero 3 introspecci\u00f3n Al trabajar con clases y objetos, existen un conjunto de funciones ya definidas por el lenguaje que permiten obtener informaci\u00f3n sobre los objetos: instanceof : permite comprobar si un objeto es de una determinada clase. get_class : devuelve el nombre de la clase. get_declared_class : devuelve un array con los nombres de las clases definidas. class_alias : crea un alias. class_exists / method_exists / property_exists : devuelve true si la clase/m\u00e9todo/atributo est\u00e1 definida. get_class_methods / get_class_vars / get_object_vars : devuelve un array con los nombres de los m\u00e9todos/atributos de una clase / atributos de un objeto que son accesibles desde d\u00f3nde se hace la llamada. Un ejemplo de estas funciones puede ser el siguiente: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php $p = new Producto ( \"PS5\" ); if ( $p instanceof Producto ) { echo \"Es un producto.<br/>\" ; echo \"La clase es \" . get_class ( $p ) . \"<br/>\" ; class_alias ( \"Producto\" , \"Articulo\" ); $c = new Articulo ( \"Nintendo Switch\" ); echo \"Un articulo es un \" . get_class ( $c ) . \"<br/>\" ; print_r ( get_class_methods ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_class_vars ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_object_vars ( $p )); echo \"<br/>\" ; if ( method_exists ( $p , \"mostrarResumen\" )) { echo $p -> mostrarResumen (); } } clonado : Al asignar dos objetos no se copian, se crea una nueva referencia. Si queremos una copia, hay que clonarlo mediante el m\u00e9todo clone(object) : object . PHP nos permite crear un m\u00e9todo que se llamar\u00e1 cuando ejecutemos el operador clone. Este m\u00e9todo puede entre otras cosas inicializar algunos atributos. Si no se define el m\u00e9todo __clone() se har\u00e1 una copia id\u00e9ntica del objeto que le pasamos como par\u00e1metro al operador clone. Veamos un ejemplo: Crearemos una clase Persona que tenga como atributos su nombre y edad, definiremos los m\u00e9todos para cargar y retornar los valores de sus atributos. Haremos que cuando clonemos un objeto de dicha clase la edad de la persona se fije con cero. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php class Persona { private $nombre ; private $edad ; public function fijarNombreEdad ( $nom , $ed ) { $this -> nombre = $nom ; $this -> edad = $ed ; } public function getNombre () { return $this -> nombre ; } public function getEdad () { return $this -> edad ; } public function __clone () { $this -> edad = 0 ; } } $persona1 = new Persona (); $persona1 -> fijarNombreEdad ( 'Juan' , 20 ); echo 'Datos de $persona1:' ; echo $persona1 -> retornarNombre () . ' - ' . $persona1 -> retornarEdad () . '<br>' ; $persona2 = clone ( $persona1 ); echo 'Datos de $persona2:' ; echo $persona2 -> retornarNombre () . ' - ' . $persona2 -> retornarEdad () . '<br>' ; ?> El m\u00e9todo __clone se ejecutar\u00e1 cuando llamemos al operador clone para esta clase: PHP 1 2 3 public function __clone() { $this->edad=0; } Es decir cuando realicemos la asignaci\u00f3n: PHP 1 $persona2 = clone($persona1); inicialmente se hace una copia id\u00e9ntica de $persona1 pero luego se ejecuta el m\u00e9todo __clone con lo que el atributo $edad se modifica. Si queremos que una clase no pueda clonarse simplemente podemos implementar el siguiente c\u00f3digo en el m\u00e9todo __clone(): PHP 1 2 3 public function __clone() { die('No esta permitido clonar objetos de esta clase'); } M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/language.oop5.cloning.php herencia PHP soporta herencia simple, de manera que una clase solo puede heredar de otra clase , no de dos o m\u00e1s clases a la vez. Para ello se utiliza la palabra clave extends . Si queremos que la clase A hereda de la clase B haremos: PHP 1 class A extends B La clase hija hereda los atributos y m\u00e9todos p\u00fablicos y protegidos de la clase madre. cada clase en un archivo : Como ya hemos comentado, deber\u00edamos colocar cada clase en un archivo diferente para posteriormente utilizarlo mediante include . En los siguientes ejemplos los hemos colocado juntos para facilitar su legibilidad. Por ejemplo, tenemos una clase Producto y una Tv que hereda de Producto : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Producto { protected $codigo ; protected $nombre ; protected $nombreCorto ; protected $PVP ; public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { protected $pulgadas ; protected $tecnologia ; } Podemos utilizar las siguientes funciones para averiguar si hay relaci\u00f3n entre dos clases: get_parent_class(object): string is_subclass_of(object, string): bool PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php $t = new Tv (); $t -> codigo = 33 ; if ( $t instanceof Producto ) { echo $t -> mostrarResumen (); } $madre = get_parent_class ( $t ); echo \"<br>La clase madre es: \" . $madre ; $objetoMadre = new $madre ; echo $objetoMadre -> mostrarResumen (); if ( is_subclass_of ( $t , 'Producto' )) { echo \"<br>Soy una hija de Producto\" ; } sobreescribir m\u00e9todos Podemos crear m\u00e9todos en las clase hijas con el mismo nombre que la clase madre, cambiando su comportamiento. Para invocar a los m\u00e9todos de la clase madre: parent::nombreMetodo() . PHP 1 2 3 4 5 6 7 8 9 10 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } constructor en clases hijas En cambio, si lo definimos en la clase hija, hemos de invocar al de la clase madre de manera expl\u00edcita. PHP 7 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 <?php class Producto { public string $codigo ; public function __construct ( string $codigo ) { $this -> codigo = $codigo ; } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function __construct ( string $codigo , int $pulgadas , string $tecnologia ) { parent :: __construct ( $codigo ); $this -> pulgadas = $pulgadas ; $this -> tecnologia = $tecnologia ; } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } PHP 8 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php class Producto { public function __construct ( private string $codigo ) { } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public function __construct ( string $codigo , private int $pulgadas , private string $tecnologia ) { parent :: __construct ( $codigo ); } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } clases abstractas Las clases abstractas obligan a heredar de estas clases, ya que no se permite su instanciaci\u00f3n; s\u00ed se permite a las clases heredadas (siempre que no est\u00e9n tambi\u00e9n definidas como abstractas). Se define mediante abstract class NombreClase { . Una clase abstracta puede contener atributos y m\u00e9todos no-abstractos, y/o m\u00e9todos abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php // Clase abstracta abstract class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } // M\u00e9todo abstracto abstract public function mostrarResumen (); } Cuando una clase hereda de una clase abstracta, obligat\u00f3riamente debe implementar los m\u00e9todos que tiene la clase madre marcados como abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { //obligado a implementarlo echo \"<p>C\u00f3digo \" . $this -> getCodigo () . \"</p>\" ; echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } $t = new Tv (); echo $t -> getCodigo (); clases finales Son clases opuestas a abstractas, ya que evitan que se pueda heredar una clase o m\u00e9todo para sobreescribirlo. Se define mediante final class NombreClase { . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } final public function mostrarResumen () : string { return \"Producto \" . $this -> codigo ; } } // No podremos heredar de Microondas final class Microondas extends Producto { private $potencia ; public function getPotencia () : int { return $this -> potencia ; } // No podemos implementar mostrarResumen() } interfaces Permite definir un contrato con las firmas de los m\u00e9todos a cumplir. As\u00ed pues, s\u00f3lo contiene declaraciones de funciones y todas deben ser p\u00fablicas. Se declaran con la palabra clave interface y luego las clases que cumplan el contrato lo realizan mediante la palabra clave implements . PHP 1 2 3 4 5 6 <?php interface Nombreable { // declaraci\u00f3n de funciones } class NombreClase implements NombreInterfaz { // c\u00f3digo de la clase Se permite la herencia de interfaces. Adem\u00e1s, una clase puede implementar varios interfaces (en este caso, s\u00ed soporta la herecia m\u00faltiple, pero s\u00f3lo de interfaces). PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php interface Mostrable { public function mostrarResumen () : string ; } interface MostrableTodo extends Mostrable { public function mostrarTodo () : string ; } interface Facturable { public function generarFactura () : string ; } class Producto implements MostrableTodo , Facturable { // Implementaciones de los m\u00e9todos // Obligatoriamente deber\u00e1 implementar: // - public function mostrarResumen, // - public function mostrarTodo y // - public function generarFactura } m\u00e9todos encadenados Sigue el planteamiento de la programaci\u00f3n funcional, y tambi\u00e9n se conoce como method chaining . Plantea que sobre un objeto se realizan varias llamadas; o sea, consiste en llamar varios m\u00e9todos de un objeto en una misma l\u00ednea, basta con a\u00f1adir al final de cada m\u00e9todo: return $this; Con el siguiente ejemplo se entiende f\u00e1cilmente. Para facilitarlo, vamos a modificar todos sus m\u00e9todos mutadores (que modifican datos , setters , ...) para que devuelvan una referencia a $this : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Coche { public function lavar (){ echo \"Coche lavado. \\n \" ; return $this ; } public function encerar (){ echo \"Coche encerado. \\n \" ; return $this ; } } // ejemplo llamada a los m\u00e9todos encadenados $coche = new Coche ; $coche -> lavar () -> encerar (); Bash 1 2 3 // mostrar\u00e1 Coche lavado. Coche encerado. Otro ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php class Libro { private string $nombre ; private string $autor ; public function getNombre () : string { return $this -> nombre ; } public function setNombre ( string $nombre ) : Libro { $this -> nombre = $nombre ; return $this ; } public function getAutor () : string { return $this -> autor ; } public function setAutor ( string $autor ) : Libro { $this -> autor = $autor ; return $this ; } public function __toString () : string { return $this -> nombre . \" de \" . $this -> autor ; } } m\u00e9todos m\u00e1gicos Todas las clases PHP ofrecen un conjunto de m\u00e9todos, tambi\u00e9n conocidos como magic methods que se pueden sobreescribir para sustituir su comportamiento. Algunos de ellos ya los hemos utilizado. Ante cualquier duda, es conveniente consultar la documentaci\u00f3n oficial . Los m\u00e1s destacables son: __construct() __destruct() \u2192 se invoca al perder la referencia. Se utiliza para cerrar una conexi\u00f3n a la BD, cerrar un fichero, ... __toString() \u2192 representaci\u00f3n del objeto como cadena. Es decir, cuando hacemos echo $objeto se ejecuta autom\u00e1ticamente este m\u00e9todo. get(atributo) , set(atributo, valor) \u2192 Permitir\u00eda acceder a los atributos privados, aunque siempre es m\u00e1s legible/mantenible codificar los getter/setter. __isset(atributo) , __unset(atributo) \u2192 Permite averiguar o quitar el valor a un atributo. sleep() , wakeup() \u2192 Se ejecutan al recuperar ( unserialize^ ) o almacenar un objeto que se serializa ( serialize ), y se utilizan para permite definir qu\u00e9 atributos se serializan. call() , callStatic() \u2192 Se ejecutan al llamar a un m\u00e9todo que no es p\u00fablico. Permiten sobrecargar m\u00e9todos. espacio de nombres Desde PHP 5.3 y tambi\u00e9n conocidos como Namespaces , permiten organizar las clases/interfaces, funciones y/o constantes (de forma similar a los paquetes en Java) en un \u00e1mbito restringido; evitando colisiones o conflictos de nombre con otros elementos que se pueden crear m\u00e1s adelante (o con algunas librer\u00edas que utilices). recomendaci\u00f3n : Un s\u00f3lo namespace por archivo y crear una estructura de carpetas respectando los niveles/subniveles (igual que se hace en Java). Se declaran en la primera l\u00ednea mediante la palabra clave namespace seguida del nombre del espacio de nombres asignado (cada subnivel se separa con la barra invertida \\ ): Por ejemplo, para colocar la clase Producto dentro del namespace Dwes\\Ejemplos lo har\u00edamos as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace Dwes\\Ejemplos ; const IVA = 0.21 ; class Producto { public $nombre ; public function muestra () : void { echo \"<p>Prod:\" . $this -> nombre . \"</p>\" ; } } acceso Para referenciar a un recurso que contiene un namespace, primero hemos de tenerlo disponible haciendo uso de include o require . Si el recurso est\u00e1 en el mismo namespace, se realiza un acceso directo (se conoce como acceso sin cualificar ). Realmente hay tres tipos de acceso: sin cualificar: recurso cualificado: rutaRelativa\\recurso \u2192 no hace falta poner el namespace completo. totalmente cualificado: \\rutaAbsoluta\\recurso PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php namespace Dwes\\Ejemplos ; include_once ( \"Producto.php\" ); // sin cualificar echo IVA ; // acceso cualificado. // Dar\u00eda error, no existe \\Dwes\\Ejemplos\\Utilidades\\IVA echo Utilidades\\IVA ; // totalmente cualificado echo \\Dwes\\Ejemplos\\IVA ; $p1 = new Producto (); // lo busca en el mismo namespace y // encuentra \\Dwes\\Ejemplos\\Producto $p2 = new Model\\Producto (); // dar\u00eda error, no existe el namespace Model. // Est\u00e1 buscando \\Dwes\\Ejemplos\\Model\\Producto $p3 = new \\Dwes\\Ejemplos\\Producto (); // \\Dwes\\Ejemplos\\Producto video use Para evitar la referencia cualificada podemos declarar el uso mediante use (similar a hacer import en Java). Se hace en la cabecera, tras el namespace: Los tipos posibles son: use const nombreCualificadoConstante use function nombreCualificadoFuncion use nombreCualificadoClase use nombreCualificadoClase as NuevoNombre // para renombrar elementos Por ejemplo, si queremos utilizar la clase \\Dwes\\Ejemplos\\Producto desde un recurso que se encuentra en la ra\u00edz, por ejemplo en inicio.php , har\u00edamos: PHP 1 2 3 4 5 6 7 8 <?php include_once ( \"Dwes\\Ejemplo\\Producto.php\" ); use const Dwes\\Ejemplos\\IVA ; use \\Dwes\\Ejemplos\\Producto ; echo IVA ; $p1 = new Producto (); to use or not to use En resumen, use permite acceder sin cualificar a recursos que est\u00e1n en otro namespace . Si estamos en el mismo espacio de nombre, no necesitamos use . video organizaci\u00f3n Todo proyecto, conforme crece, necesita organizar su c\u00f3digo fuente. Se plantea una organizaci\u00f3n en la que los archivos que interactuan con el navegador se colocan en el ra\u00edz, y las clases que definamos van dentro de un namespace (y dentro de su propia carpeta src o app). organizaci\u00f3n, includes y usos : Colocaremos cada recurso en un fichero aparte. En la primera l\u00ednea indicaremos su namespace (si no est\u00e1 en el ra\u00edz). Si utilizamos otros recursos, haremos un include_once de esos recursos (clases, interfaces, etc...). Cada recurso debe incluir todos los otros recursos que referencie: la clase de la que hereda, interfaces que implementa, clases utilizadas/recibidas como par\u00e1metros, etc... Si los recursos est\u00e1n en un espacio de nombres diferente al que estamos, emplearemos use con la ruta completa para luego utilizar referencias sin cualificar. autoload \u00bfNo es tedioso tener que hacer el include de las clases? El autoload viene al rescate. As\u00ed pues, permite cargar las clases (no las constantes ni las funciones) que se van a utilizar y evitar tener que hacer el include_once de cada una de ellas. Para ello, se utiliza la funci\u00f3n spl_autoload_register . PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once $nombreClase . '.php' ; } ); ?> por qu\u00e9 se llama autoload : Porque antes se realizaba mediante el m\u00e9todo m\u00e1gico __autoload() , el cual est\u00e1 deprecated desde PHP 7.2. Y \u00bfc\u00f3mo organizamos ahora nuestro c\u00f3digo aprovechando el autoload? Para facilitar la b\u00fasqueda de los recursos a incluir, es recomendable colocar todas las clases dentro de una misma carpeta. Nosotros la vamos a colocar dentro de app (m\u00e1s adelante, cuando estudiemos Laravel veremos el motivo de esta decisi\u00f3n). Otras carpetas que podemos crear son test para colocar las pruebas PhpUnit que luego realizaremos, o la carpeta vendor donde se almacenar\u00e1n las librer\u00edas del proyecto (esta carpeta es un est\u00e1ndard dentro de PHP, ya que Composer la crea autom\u00e1ticamente). Como hemos colocado todos nuestros recursos dentro de app , ahora nuestro autoload.php (el cual colocamos en la carpeta ra\u00edz) s\u00f3lo va a buscar dentro de esa carpeta: PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once \"app/\" . $nombreClase . '.php' ; } ); ?> autoload y rutas err\u00f3neas : En Ubuntu al hacer el include de la clase que recibe como par\u00e1metro, las barras de los namespace ( \\ ) son diferentes a las de las rutas ( / ). Por ello, es mejor que utilicemos el fichero autoload: PHP 1 2 3 4 5 6 7 <?php spl_autoload_register ( function ( $nombreClase ) { $ruta = \"app \\\\ \" . $nombreClase . '.php' ; $ruta = str_replace ( \" \\\\ \" , \"/\" , $ruta ); // Sustituimos las barras include_once $ruta ' ; } ); ?> video Aqu\u00ed encontramos un peque\u00f1o video en el que https://www.youtube.com/watch?v=lP1hbkNA2uc gesti\u00f3n de errores PHP clasifica los errores que ocurren en diferentes niveles. Cada nivel se identifica con una constante. Por ejemplo: E_ERROR : errores fatales, no recuperables. Se interrumpe el script. E_WARNING : advertencias en tiempo de ejecuci\u00f3n. El script no se interrumpe. E_NOTICE : avisos en tiempo de ejecuci\u00f3n. Pod\u00e9is comprobar el listado completo de constantes de https://www.php.net/manual/es/errorfunc.constants.php Para la configuraci\u00f3n de los errores podemos hacerlo de dos formas: A nivel de php.ini : error_reporting : indica los niveles de errores a notificar. rerror_reporting = E_ALL & ~E_NOTICE -> Todos los errores menos los avisos en tiempo de ejecuci\u00f3n. display_errors : indica si mostrar o no los errores por pantalla. En entornos de producci\u00f3n es com\u00fan ponerlo a off. mediante c\u00f3digo con las siguientes funciones: error_reporting(codigo) -> Controla qu\u00e9 errores notificar. set_error_handler(nombreManejador) -> Indica qu\u00e9 funci\u00f3n se invocar\u00e1 cada vez que se encuentre un error. El manejador recibe como par\u00e1metros el nivel del error y el mensaje. A continuaci\u00f3n tenemos un ejemplo mediante c\u00f3digo: Funciones para la gesti\u00f3n de errores : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php error_reporting ( E_ALL & ~ E_NOTICE & ~ E_WARNING ); $resultado = $dividendo / $divisor ; error_reporting ( E_ALL & ~ E_NOTICE ); set_error_handler ( \"miManejadorErrores\" ); $resultado = $dividendo / $divisor ; restore_error_handler (); // vuelve al anterior function miManejadorErrores ( $nivel , $mensaje ) { switch ( $nivel ) { case E_WARNING : echo \"<strong>Warning</strong>: $mensaje .<br/>\" ; break ; default : echo \"Error de tipo no especificado: $mensaje .<br/>\" ; } } Consola : Text Only 1 2 3 Error de tipo no especificado: Undefined variable: dividendo. Error de tipo no especificado: Undefined variable: divisor. Error de tipo Warning: Division by zero. excepciones La gesti\u00f3n de excepciones forma parte desde PHP 5. Su funcionamiento es similar a Java, haciendo uso de un bloque try / catch / finally . Si detectamos una situaci\u00f3n an\u00f3mala y queremos lanzar una excepci\u00f3n, deberemos realizar throw new Exception (adjuntando el mensaje que lo ha provocado). PHP 1 2 3 4 5 6 7 8 9 <?php try { if ( $divisor == 0 ) { throw new Exception ( \"Divisi\u00f3n por cero.\" ); } $resultado = $dividendo / $divisor ; } catch ( Exception $e ) { echo \"Se ha producido el siguiente error: \" . $e -> getMessage (); } La clase Exception es la clase madre de todas las excepciones. Su constructor recibe mensaje [, codigoError][, excepcionPrevia] . A partir de un objeto Exception , podemos acceder a los m\u00e9todos getMessage() y getCode() para obtener el mensaje y el c\u00f3digo de error de la excepci\u00f3n capturada. El propio lenguaje ofrece un conjunto de excepciones ya definidas, las cuales podemos capturar (y lanzar desde PHP 7). Se recomienda su consulta en la documentaci\u00f3n oficial . creando excepciones Para crear una excepci\u00f3n, la forma m\u00e1s corta es crear una clase que \u00fanicamente herede de Exception . PHP 1 2 <?php class HolaExcepcion extends Exception {} Si queremos, y es recomendable dependiendo de los requisitos, podemos sobrecargar los m\u00e9todos m\u00e1gicos, por ejemplo, sobrecargando el constructor y llamando al constructor de la clase madre, o rescribir el m\u00e9todo __toString para cambiar su mensaje: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MiExcepcion extends Exception { public function __construct ( $msj , $codigo = 0 , Exception $previa = null ) { // c\u00f3digo propio parent :: __construct ( $msj , $codigo , $previa ); } public function __toString () { return __CLASS__ . \": [ { $this -> code } ]: { $this -> message } \\n \" ; } public function miFuncion () { echo \"Una funci\u00f3n personalizada para este tipo de excepci\u00f3n \\n \" ; } } Si definimos una excepci\u00f3n de aplicaci\u00f3n dentro de un namespace , cuando referenciemos a Exception , deberemos referenciarla mediante su nombre totalmente cualificado ( \\Exception ), o utilizando use : Mediante nombre totalmente cualificado PHP 1 2 3 4 <?php namespace \\Dwes\\Ejemplos ; class AppExcepcion extends \\Exception {} Mediante use PHP 1 2 3 4 5 6 <?php namespace \\Dwes\\Ejemplos ; use Exception ; class AppExcepcion extends Exception {} excepciones m\u00faltiples Se pueden usar excepciones m\u00faltiples para comprobar diferentes condiciones. A la hora de capturarlas, se hace de m\u00e1s espec\u00edfica a m\u00e1s general. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php $email = \"ejemplo@ejemplo.com\" ; try { // Comprueba si el email es v\u00e1lido if ( filter_var ( $email , FILTER_VALIDATE_EMAIL ) === FALSE ) { throw new MiExcepcion ( $email ); } // Comprueba la palabra ejemplo en la direcci\u00f3n email if ( strpos ( $email , \"ejemplo\" ) !== FALSE ) { throw new Exception ( \" $email es un email de ejemplo no v\u00e1lido\" ); } } catch ( MiExcepcion $e ) { echo $e -> miFuncion (); } catch ( Exception $e ) { echo $e -> getMessage (); } autoevaluaci\u00f3n : \u00bfQu\u00e9 pasar\u00eda al ejecutar el siguiente c\u00f3digo? PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException $e ) { echo \"Capturada MainException \" . $e -> getMessage (); } catch ( SubException $e ) { echo \"Capturada SubException \" . $e -> getMessage (); } catch ( Exception $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Si en el mismo catch queremos capturar varias excepciones, hemos de utilizar el operador | : PHP 1 2 3 4 5 6 7 8 9 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException | SubException $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Desde PHP 7, existe el tipo Throwable , el cual es un interfaz que implementan tanto los errores como las excepciones, y nos permite capturar los dos tipos a la vez: PHP 1 2 3 4 5 6 <?php try { // tu codigo } catch ( Throwable $e ) { echo 'Forma de capturar errores y excepciones a la vez' ; } Si s\u00f3lo queremos capturar los errores fatales, podemos hacer uso de la clase Error : PHP 1 2 3 4 5 6 7 8 9 <?php try { // Genera una notificaci\u00f3n que no se captura echo $variableNoAsignada ; // Error fatal que se captura funcionQueNoExiste (); } catch ( Error $e ) { echo \"Error capturado: \" . $e -> getMessage (); } relanzar excepciones En las aplicaciones reales, es muy com\u00fan capturar una excepci\u00f3n de sistema y lanzar una de aplicaci\u00f3n que hemos definido nosotros. Tambi\u00e9n podemos lanzar las excepciones sin necesidad de estar dentro de un try / catch . PHP 1 2 3 4 5 6 7 8 <?php class AppException extends Exception {} try { // C\u00f3digo de negocio que falla } catch ( Exception $e ) { throw new AppException ( \"AppException: \" . $e -> getMessage (), $e -> getCode (), $e ); } SPL Standard PHP Library es el conjunto de funciones y utilidades que ofrece PHP, como: Estructuras de datos: pila, cola, cola de prioridad, lista doblemente enlazada, etc... Conjunto de iteradores dise\u00f1ados para recorrer estructuras agregadas: arrays, resultados de bases de datos, \u00e1rboles XML, listados de directorios, etc. Pod\u00e9is consultar la documentaci\u00f3n en https://www.php.net/manual/es/book.spl.php o ver algunos ejemplos en https://diego.com.es/tutorial-de-la-libreria-spl-de-php Tambi\u00e9n define un conjunto de excepciones que podemos utilizar para que las lancen nuestras aplicaciones: LogicException (extends Exception) BadFunctionCallException BadMethodCallException DomainException InvalidArgumentException LengthException OutOfRangeException RuntimeException (extends Exception) OutOfBoundsException OverflowException RangeException UnderflowException UnexpectedValueException Tambi\u00e9n pod\u00e9is consultar la documentaci\u00f3n de estas excepciones en https://www.php.net/manual/es/spl.exceptions.php. referencias Manual de PHP Manual de OO en PHP - www.desarrolloweb.com videos Curso PHP 8 desde cero (Actulizado) :","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud03/ud0303/#duracion-y-criterios-de-evaluacion","text":"Duraci\u00f3n estimada : 18 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio. a) Se han identificado las ventajas de separar la l\u00f3gica de negocio de los aspectos de presentaci\u00f3n de la aplicaci\u00f3n. b) Se han analizado tecnolog\u00edas y mecanismos que permiten realizar esta separaci\u00f3n y sus caracter\u00edsticas principales. c) Se han utilizado objetos y controles en el servidor para generar el aspecto visual de la aplicaci\u00f3n web en el cliente. d) Se han utilizado formularios generados de forma din\u00e1mica para responder a los eventos de la aplicaci\u00f3n Web. e) Se han escrito aplicaciones Web con mantenimiento de estado y separaci\u00f3n de la l\u00f3gica de negocio. f) Se han aplicado los principios de la programaci\u00f3n orientada a objetos. g) Se ha probado y documentado el c\u00f3digo.","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud03/ud0303/#clases-y-objetos","text":"PHP sigue un paradigma de programaci\u00f3n orientada a objetos (POO) basada en clases. Una clase es una plantilla que define las atributos y m\u00e9todos para poder crear objetos. De este manera, un objeto es una instancia de una clase . Tanto los atributos como los m\u00e9todos se definen con una visibilidad (qui\u00e9n puede acceder): Privado - private : S\u00f3lo puede acceder la propia clase. Protegido - protected : S\u00f3lo puede acceder la propia clase o sus descendientes. P\u00fablico - public : Puede acceder cualquier otra clase. Para declarar una clase, se utiliza la palabra clave class seguido del nombre de la clase. Para instanciar un objeto a partir de la clase, se utiliza new : PHP 1 2 3 4 5 6 7 <?php class NombreClase { // atributos // y m\u00e9todos } $ob = new NombreClase (); clases con may\u00fascula : Todas las clases empiezan por letra may\u00fascula. Cuando un proyecto crece, es normal modelar las clases mediante UML (\u00bfrecord\u00e1is Entornos de Desarrollo ?). La clases se representan mediante un cuadrado, separando el nombre, de los atributos y los m\u00e9todos: Una vez que hemos creado un objeto, se utiliza el operador -> para acceder a un atributo o un m\u00e9todo del objeto: PHP 1 2 $objeto->atributo; $objeto->m\u00e9todo(par\u00e1metros); Si desde, dentro de la clase, queremos acceder a un atributo o m\u00e9todo de la misma clase, utilizaremos la referencia $this ; PHP 1 2 $this->atributo; $this->m\u00e9todo(par\u00e1metros); As\u00ed pues, como ejemplo, codificar\u00edamos una persona en el fichero Persona.php como: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php class Persona { private string $nombre ; public function setNombre ( string $nombre ) { $this -> nombre = $nombre ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona (); // creamos un objeto $bruno -> setNombre ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Aunque se pueden declarar varias clases en el mismo archivo, es una mala pr\u00e1ctica. As\u00ed pues, cada fichero : contedr\u00e1 una sola clase , y se nombrar\u00e1 con el nombre de la clase .","title":"clases y objetos"},{"location":"ud03/ud0303/#encapsulacion","text":"Los atributos se definen privados o protegidos (si queremos que las clases heredadas puedan acceder). Para cada atributo, se a\u00f1aden m\u00e9todos p\u00fablicos ( getter / setter ): PHP 1 2 3 public function setAtributo (tipo $param); public function getAtributo () : tipo; Las constantes se definen p\u00fablicas para que sean accesibles por todos los recursos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 <?php class MayorMenor { private int $mayor ; private int $menor ; public function setMayor ( int $may ) { $this -> mayor = $may ; } public function setMenor ( int $men ) { $this -> menor = $men ; } public function getMayor () : int { return $this -> mayor ; } public function getMenor () : int { return $this -> menor ; } }","title":"encapsulaci\u00f3n"},{"location":"ud03/ud0303/#recibiendo-y-enviando-objetos","text":"Es recomendable indicarlo en el tipo de par\u00e1metros. Si el objeto puede devolver nulos se pone ? delante del nombre de la clase. objetos por referencia : Los objetos que se env\u00edan y reciben como par\u00e1metros siempre se pasan por referencia. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php function maymen ( array $numeros ) : ? MayorMenor { $a = max ( $numeros ); $b = min ( $numeros ); $result = new MayorMenor (); $result -> setMayor ( $a ); $result -> setMenor ( $b ); return $result ; } $resultado = maymen ( [ 1 , 76 , 9 , 388 , 41 , 39 , 25 , 97 , 22 ] ); echo \"<br>Mayor: \" . $resultado -> getMayor (); echo \"<br>Menor: \" . $resultado -> getMenor ();","title":"Recibiendo y enviando objetos"},{"location":"ud03/ud0303/#constructor","text":"El constructor de los objetos se define mediante el m\u00e9todo m\u00e1gico __construct . Puede o no tener par\u00e1metros, pero s\u00f3lo puede haber un \u00fanico constructor . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Persona { private string $nombre ; public function __construct ( string $nom ) { $this -> nombre = $nom ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona ( \"Bruno D\u00edaz\" ); $bruno -> imprimir ();","title":"constructor"},{"location":"ud03/ud0303/#constructores-en-php8","text":"Una de las grandes novedades que ofrece PHP 8 es la simplificaci\u00f3n de los constructores con par\u00e1metros, lo que se conoce como promoci\u00f3n de los atributos del constructor . Para ello, en vez de tener que declarar los atributos como privados o protegidos, y luego dentro del constructor tener que asignar los par\u00e1metros a estos atributos, el propio constructor promociona los atributos. Ve\u00e1moslo mejor con un ejemplo. Imaginemos una clase Punto donde queramos almacenar sus coordenadas. As\u00ed quedar\u00eda en PHP7 o anteriores: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Punto { protected float $x ; protected float $y ; protected float $z ; public function __construct ( float $x = 0.0 , float $y = 0.0 , float $z = 0.0 ) { $this -> x = $x ; $this -> y = $y ; $this -> z = $z ; } } En PHP8 , quedar\u00eda del siguiente modo (mucho m\u00e1s corto, lo que facilita su legibilidad): PHP 1 2 3 4 5 6 7 8 <?php class Punto { public function __construct ( protected float $x = 0.0 , protected float $y = 0.0 , protected float $z = 0.0 , ) {} } el orden importa: A la hora de codificar el orden de los elementos debe ser: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php declare ( strict_types = 1 ); class NombreClase { // atributos // constructor // getters - setters // resto de m\u00e9todos } ?>","title":"constructores en PHP8"},{"location":"ud03/ud0303/#clases-estaticas","text":"Son aquellas que tienen atributos ( o propiedades ) y/o m\u00e9todos est\u00e1ticos (tambi\u00e9n se conocen como de clase , porque su valor se comparte entre todas las instancias de la misma clase). Se declaran con static y se referencian con :: . Si queremos acceder a un m\u00e9todo est\u00e1tico , se antepone el nombre de la clase como sigue: Producto::nuevoProducto() . Si desde un m\u00e9todo queremos acceder a un atributo est\u00e1tico de la misma clase, se utiliza la referencia self como sigue: self::$numProductos . PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; public static function nuevoProducto () { self :: $numProductos ++ ; } } Producto :: nuevoProducto (); $impuesto = Producto :: IVA ; Tambi\u00e9n podemos tener clases normales que tengan algun atributo est\u00e1tico: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; private $codigo ; public function __construct ( string $cod ) { self :: $numProductos ++ ; $this -> codigo = $cod ; } public function mostrarResumen () : string { return \"El producto \" . $this -> codigo . \" es el n\u00famero \" . self :: $numProductos ; } } $prod1 = new Producto ( \"PS5\" ); $prod2 = new Producto ( \"XBOX Series X\" ); $prod3 = new Producto ( \"Nintendo Switch\" ); echo $prod3 -> mostrarResumen (); Bash 1 El producto Nintendo Switch es el n\u00famero 3","title":"clases est\u00e1ticas"},{"location":"ud03/ud0303/#introspeccion","text":"Al trabajar con clases y objetos, existen un conjunto de funciones ya definidas por el lenguaje que permiten obtener informaci\u00f3n sobre los objetos: instanceof : permite comprobar si un objeto es de una determinada clase. get_class : devuelve el nombre de la clase. get_declared_class : devuelve un array con los nombres de las clases definidas. class_alias : crea un alias. class_exists / method_exists / property_exists : devuelve true si la clase/m\u00e9todo/atributo est\u00e1 definida. get_class_methods / get_class_vars / get_object_vars : devuelve un array con los nombres de los m\u00e9todos/atributos de una clase / atributos de un objeto que son accesibles desde d\u00f3nde se hace la llamada. Un ejemplo de estas funciones puede ser el siguiente: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php $p = new Producto ( \"PS5\" ); if ( $p instanceof Producto ) { echo \"Es un producto.<br/>\" ; echo \"La clase es \" . get_class ( $p ) . \"<br/>\" ; class_alias ( \"Producto\" , \"Articulo\" ); $c = new Articulo ( \"Nintendo Switch\" ); echo \"Un articulo es un \" . get_class ( $c ) . \"<br/>\" ; print_r ( get_class_methods ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_class_vars ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_object_vars ( $p )); echo \"<br/>\" ; if ( method_exists ( $p , \"mostrarResumen\" )) { echo $p -> mostrarResumen (); } } clonado : Al asignar dos objetos no se copian, se crea una nueva referencia. Si queremos una copia, hay que clonarlo mediante el m\u00e9todo clone(object) : object . PHP nos permite crear un m\u00e9todo que se llamar\u00e1 cuando ejecutemos el operador clone. Este m\u00e9todo puede entre otras cosas inicializar algunos atributos. Si no se define el m\u00e9todo __clone() se har\u00e1 una copia id\u00e9ntica del objeto que le pasamos como par\u00e1metro al operador clone. Veamos un ejemplo: Crearemos una clase Persona que tenga como atributos su nombre y edad, definiremos los m\u00e9todos para cargar y retornar los valores de sus atributos. Haremos que cuando clonemos un objeto de dicha clase la edad de la persona se fije con cero. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php class Persona { private $nombre ; private $edad ; public function fijarNombreEdad ( $nom , $ed ) { $this -> nombre = $nom ; $this -> edad = $ed ; } public function getNombre () { return $this -> nombre ; } public function getEdad () { return $this -> edad ; } public function __clone () { $this -> edad = 0 ; } } $persona1 = new Persona (); $persona1 -> fijarNombreEdad ( 'Juan' , 20 ); echo 'Datos de $persona1:' ; echo $persona1 -> retornarNombre () . ' - ' . $persona1 -> retornarEdad () . '<br>' ; $persona2 = clone ( $persona1 ); echo 'Datos de $persona2:' ; echo $persona2 -> retornarNombre () . ' - ' . $persona2 -> retornarEdad () . '<br>' ; ?> El m\u00e9todo __clone se ejecutar\u00e1 cuando llamemos al operador clone para esta clase: PHP 1 2 3 public function __clone() { $this->edad=0; } Es decir cuando realicemos la asignaci\u00f3n: PHP 1 $persona2 = clone($persona1); inicialmente se hace una copia id\u00e9ntica de $persona1 pero luego se ejecuta el m\u00e9todo __clone con lo que el atributo $edad se modifica. Si queremos que una clase no pueda clonarse simplemente podemos implementar el siguiente c\u00f3digo en el m\u00e9todo __clone(): PHP 1 2 3 public function __clone() { die('No esta permitido clonar objetos de esta clase'); } M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/language.oop5.cloning.php","title":"introspecci\u00f3n"},{"location":"ud03/ud0303/#herencia","text":"PHP soporta herencia simple, de manera que una clase solo puede heredar de otra clase , no de dos o m\u00e1s clases a la vez. Para ello se utiliza la palabra clave extends . Si queremos que la clase A hereda de la clase B haremos: PHP 1 class A extends B La clase hija hereda los atributos y m\u00e9todos p\u00fablicos y protegidos de la clase madre. cada clase en un archivo : Como ya hemos comentado, deber\u00edamos colocar cada clase en un archivo diferente para posteriormente utilizarlo mediante include . En los siguientes ejemplos los hemos colocado juntos para facilitar su legibilidad. Por ejemplo, tenemos una clase Producto y una Tv que hereda de Producto : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Producto { protected $codigo ; protected $nombre ; protected $nombreCorto ; protected $PVP ; public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { protected $pulgadas ; protected $tecnologia ; } Podemos utilizar las siguientes funciones para averiguar si hay relaci\u00f3n entre dos clases: get_parent_class(object): string is_subclass_of(object, string): bool PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php $t = new Tv (); $t -> codigo = 33 ; if ( $t instanceof Producto ) { echo $t -> mostrarResumen (); } $madre = get_parent_class ( $t ); echo \"<br>La clase madre es: \" . $madre ; $objetoMadre = new $madre ; echo $objetoMadre -> mostrarResumen (); if ( is_subclass_of ( $t , 'Producto' )) { echo \"<br>Soy una hija de Producto\" ; }","title":"herencia"},{"location":"ud03/ud0303/#sobreescribir-metodos","text":"Podemos crear m\u00e9todos en las clase hijas con el mismo nombre que la clase madre, cambiando su comportamiento. Para invocar a los m\u00e9todos de la clase madre: parent::nombreMetodo() . PHP 1 2 3 4 5 6 7 8 9 10 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } }","title":"sobreescribir m\u00e9todos"},{"location":"ud03/ud0303/#constructor-en-clases-hijas","text":"En cambio, si lo definimos en la clase hija, hemos de invocar al de la clase madre de manera expl\u00edcita. PHP 7 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 <?php class Producto { public string $codigo ; public function __construct ( string $codigo ) { $this -> codigo = $codigo ; } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function __construct ( string $codigo , int $pulgadas , string $tecnologia ) { parent :: __construct ( $codigo ); $this -> pulgadas = $pulgadas ; $this -> tecnologia = $tecnologia ; } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } PHP 8 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php class Producto { public function __construct ( private string $codigo ) { } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public function __construct ( string $codigo , private int $pulgadas , private string $tecnologia ) { parent :: __construct ( $codigo ); } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } }","title":"constructor en clases hijas"},{"location":"ud03/ud0303/#clases-abstractas","text":"Las clases abstractas obligan a heredar de estas clases, ya que no se permite su instanciaci\u00f3n; s\u00ed se permite a las clases heredadas (siempre que no est\u00e9n tambi\u00e9n definidas como abstractas). Se define mediante abstract class NombreClase { . Una clase abstracta puede contener atributos y m\u00e9todos no-abstractos, y/o m\u00e9todos abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php // Clase abstracta abstract class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } // M\u00e9todo abstracto abstract public function mostrarResumen (); } Cuando una clase hereda de una clase abstracta, obligat\u00f3riamente debe implementar los m\u00e9todos que tiene la clase madre marcados como abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { //obligado a implementarlo echo \"<p>C\u00f3digo \" . $this -> getCodigo () . \"</p>\" ; echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } $t = new Tv (); echo $t -> getCodigo ();","title":"clases abstractas"},{"location":"ud03/ud0303/#clases-finales","text":"Son clases opuestas a abstractas, ya que evitan que se pueda heredar una clase o m\u00e9todo para sobreescribirlo. Se define mediante final class NombreClase { . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } final public function mostrarResumen () : string { return \"Producto \" . $this -> codigo ; } } // No podremos heredar de Microondas final class Microondas extends Producto { private $potencia ; public function getPotencia () : int { return $this -> potencia ; } // No podemos implementar mostrarResumen() }","title":"clases finales"},{"location":"ud03/ud0303/#interfaces","text":"Permite definir un contrato con las firmas de los m\u00e9todos a cumplir. As\u00ed pues, s\u00f3lo contiene declaraciones de funciones y todas deben ser p\u00fablicas. Se declaran con la palabra clave interface y luego las clases que cumplan el contrato lo realizan mediante la palabra clave implements . PHP 1 2 3 4 5 6 <?php interface Nombreable { // declaraci\u00f3n de funciones } class NombreClase implements NombreInterfaz { // c\u00f3digo de la clase Se permite la herencia de interfaces. Adem\u00e1s, una clase puede implementar varios interfaces (en este caso, s\u00ed soporta la herecia m\u00faltiple, pero s\u00f3lo de interfaces). PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php interface Mostrable { public function mostrarResumen () : string ; } interface MostrableTodo extends Mostrable { public function mostrarTodo () : string ; } interface Facturable { public function generarFactura () : string ; } class Producto implements MostrableTodo , Facturable { // Implementaciones de los m\u00e9todos // Obligatoriamente deber\u00e1 implementar: // - public function mostrarResumen, // - public function mostrarTodo y // - public function generarFactura }","title":"interfaces"},{"location":"ud03/ud0303/#metodos-encadenados","text":"Sigue el planteamiento de la programaci\u00f3n funcional, y tambi\u00e9n se conoce como method chaining . Plantea que sobre un objeto se realizan varias llamadas; o sea, consiste en llamar varios m\u00e9todos de un objeto en una misma l\u00ednea, basta con a\u00f1adir al final de cada m\u00e9todo: return $this; Con el siguiente ejemplo se entiende f\u00e1cilmente. Para facilitarlo, vamos a modificar todos sus m\u00e9todos mutadores (que modifican datos , setters , ...) para que devuelvan una referencia a $this : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Coche { public function lavar (){ echo \"Coche lavado. \\n \" ; return $this ; } public function encerar (){ echo \"Coche encerado. \\n \" ; return $this ; } } // ejemplo llamada a los m\u00e9todos encadenados $coche = new Coche ; $coche -> lavar () -> encerar (); Bash 1 2 3 // mostrar\u00e1 Coche lavado. Coche encerado. Otro ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php class Libro { private string $nombre ; private string $autor ; public function getNombre () : string { return $this -> nombre ; } public function setNombre ( string $nombre ) : Libro { $this -> nombre = $nombre ; return $this ; } public function getAutor () : string { return $this -> autor ; } public function setAutor ( string $autor ) : Libro { $this -> autor = $autor ; return $this ; } public function __toString () : string { return $this -> nombre . \" de \" . $this -> autor ; } }","title":"m\u00e9todos encadenados"},{"location":"ud03/ud0303/#metodos-magicos","text":"Todas las clases PHP ofrecen un conjunto de m\u00e9todos, tambi\u00e9n conocidos como magic methods que se pueden sobreescribir para sustituir su comportamiento. Algunos de ellos ya los hemos utilizado. Ante cualquier duda, es conveniente consultar la documentaci\u00f3n oficial . Los m\u00e1s destacables son: __construct() __destruct() \u2192 se invoca al perder la referencia. Se utiliza para cerrar una conexi\u00f3n a la BD, cerrar un fichero, ... __toString() \u2192 representaci\u00f3n del objeto como cadena. Es decir, cuando hacemos echo $objeto se ejecuta autom\u00e1ticamente este m\u00e9todo. get(atributo) , set(atributo, valor) \u2192 Permitir\u00eda acceder a los atributos privados, aunque siempre es m\u00e1s legible/mantenible codificar los getter/setter. __isset(atributo) , __unset(atributo) \u2192 Permite averiguar o quitar el valor a un atributo. sleep() , wakeup() \u2192 Se ejecutan al recuperar ( unserialize^ ) o almacenar un objeto que se serializa ( serialize ), y se utilizan para permite definir qu\u00e9 atributos se serializan. call() , callStatic() \u2192 Se ejecutan al llamar a un m\u00e9todo que no es p\u00fablico. Permiten sobrecargar m\u00e9todos.","title":"m\u00e9todos m\u00e1gicos"},{"location":"ud03/ud0303/#espacio-de-nombres","text":"Desde PHP 5.3 y tambi\u00e9n conocidos como Namespaces , permiten organizar las clases/interfaces, funciones y/o constantes (de forma similar a los paquetes en Java) en un \u00e1mbito restringido; evitando colisiones o conflictos de nombre con otros elementos que se pueden crear m\u00e1s adelante (o con algunas librer\u00edas que utilices). recomendaci\u00f3n : Un s\u00f3lo namespace por archivo y crear una estructura de carpetas respectando los niveles/subniveles (igual que se hace en Java). Se declaran en la primera l\u00ednea mediante la palabra clave namespace seguida del nombre del espacio de nombres asignado (cada subnivel se separa con la barra invertida \\ ): Por ejemplo, para colocar la clase Producto dentro del namespace Dwes\\Ejemplos lo har\u00edamos as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace Dwes\\Ejemplos ; const IVA = 0.21 ; class Producto { public $nombre ; public function muestra () : void { echo \"<p>Prod:\" . $this -> nombre . \"</p>\" ; } }","title":"espacio de nombres"},{"location":"ud03/ud0303/#acceso","text":"Para referenciar a un recurso que contiene un namespace, primero hemos de tenerlo disponible haciendo uso de include o require . Si el recurso est\u00e1 en el mismo namespace, se realiza un acceso directo (se conoce como acceso sin cualificar ). Realmente hay tres tipos de acceso: sin cualificar: recurso cualificado: rutaRelativa\\recurso \u2192 no hace falta poner el namespace completo. totalmente cualificado: \\rutaAbsoluta\\recurso PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php namespace Dwes\\Ejemplos ; include_once ( \"Producto.php\" ); // sin cualificar echo IVA ; // acceso cualificado. // Dar\u00eda error, no existe \\Dwes\\Ejemplos\\Utilidades\\IVA echo Utilidades\\IVA ; // totalmente cualificado echo \\Dwes\\Ejemplos\\IVA ; $p1 = new Producto (); // lo busca en el mismo namespace y // encuentra \\Dwes\\Ejemplos\\Producto $p2 = new Model\\Producto (); // dar\u00eda error, no existe el namespace Model. // Est\u00e1 buscando \\Dwes\\Ejemplos\\Model\\Producto $p3 = new \\Dwes\\Ejemplos\\Producto (); // \\Dwes\\Ejemplos\\Producto video","title":"acceso"},{"location":"ud03/ud0303/#use","text":"Para evitar la referencia cualificada podemos declarar el uso mediante use (similar a hacer import en Java). Se hace en la cabecera, tras el namespace: Los tipos posibles son: use const nombreCualificadoConstante use function nombreCualificadoFuncion use nombreCualificadoClase use nombreCualificadoClase as NuevoNombre // para renombrar elementos Por ejemplo, si queremos utilizar la clase \\Dwes\\Ejemplos\\Producto desde un recurso que se encuentra en la ra\u00edz, por ejemplo en inicio.php , har\u00edamos: PHP 1 2 3 4 5 6 7 8 <?php include_once ( \"Dwes\\Ejemplo\\Producto.php\" ); use const Dwes\\Ejemplos\\IVA ; use \\Dwes\\Ejemplos\\Producto ; echo IVA ; $p1 = new Producto (); to use or not to use En resumen, use permite acceder sin cualificar a recursos que est\u00e1n en otro namespace . Si estamos en el mismo espacio de nombre, no necesitamos use . video","title":"use"},{"location":"ud03/ud0303/#organizacion","text":"Todo proyecto, conforme crece, necesita organizar su c\u00f3digo fuente. Se plantea una organizaci\u00f3n en la que los archivos que interactuan con el navegador se colocan en el ra\u00edz, y las clases que definamos van dentro de un namespace (y dentro de su propia carpeta src o app). organizaci\u00f3n, includes y usos : Colocaremos cada recurso en un fichero aparte. En la primera l\u00ednea indicaremos su namespace (si no est\u00e1 en el ra\u00edz). Si utilizamos otros recursos, haremos un include_once de esos recursos (clases, interfaces, etc...). Cada recurso debe incluir todos los otros recursos que referencie: la clase de la que hereda, interfaces que implementa, clases utilizadas/recibidas como par\u00e1metros, etc... Si los recursos est\u00e1n en un espacio de nombres diferente al que estamos, emplearemos use con la ruta completa para luego utilizar referencias sin cualificar.","title":"organizaci\u00f3n"},{"location":"ud03/ud0303/#autoload","text":"\u00bfNo es tedioso tener que hacer el include de las clases? El autoload viene al rescate. As\u00ed pues, permite cargar las clases (no las constantes ni las funciones) que se van a utilizar y evitar tener que hacer el include_once de cada una de ellas. Para ello, se utiliza la funci\u00f3n spl_autoload_register . PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once $nombreClase . '.php' ; } ); ?> por qu\u00e9 se llama autoload : Porque antes se realizaba mediante el m\u00e9todo m\u00e1gico __autoload() , el cual est\u00e1 deprecated desde PHP 7.2. Y \u00bfc\u00f3mo organizamos ahora nuestro c\u00f3digo aprovechando el autoload? Para facilitar la b\u00fasqueda de los recursos a incluir, es recomendable colocar todas las clases dentro de una misma carpeta. Nosotros la vamos a colocar dentro de app (m\u00e1s adelante, cuando estudiemos Laravel veremos el motivo de esta decisi\u00f3n). Otras carpetas que podemos crear son test para colocar las pruebas PhpUnit que luego realizaremos, o la carpeta vendor donde se almacenar\u00e1n las librer\u00edas del proyecto (esta carpeta es un est\u00e1ndard dentro de PHP, ya que Composer la crea autom\u00e1ticamente). Como hemos colocado todos nuestros recursos dentro de app , ahora nuestro autoload.php (el cual colocamos en la carpeta ra\u00edz) s\u00f3lo va a buscar dentro de esa carpeta: PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once \"app/\" . $nombreClase . '.php' ; } ); ?> autoload y rutas err\u00f3neas : En Ubuntu al hacer el include de la clase que recibe como par\u00e1metro, las barras de los namespace ( \\ ) son diferentes a las de las rutas ( / ). Por ello, es mejor que utilicemos el fichero autoload: PHP 1 2 3 4 5 6 7 <?php spl_autoload_register ( function ( $nombreClase ) { $ruta = \"app \\\\ \" . $nombreClase . '.php' ; $ruta = str_replace ( \" \\\\ \" , \"/\" , $ruta ); // Sustituimos las barras include_once $ruta ' ; } ); ?> video Aqu\u00ed encontramos un peque\u00f1o video en el que https://www.youtube.com/watch?v=lP1hbkNA2uc","title":"autoload"},{"location":"ud03/ud0303/#gestion-de-errores","text":"PHP clasifica los errores que ocurren en diferentes niveles. Cada nivel se identifica con una constante. Por ejemplo: E_ERROR : errores fatales, no recuperables. Se interrumpe el script. E_WARNING : advertencias en tiempo de ejecuci\u00f3n. El script no se interrumpe. E_NOTICE : avisos en tiempo de ejecuci\u00f3n. Pod\u00e9is comprobar el listado completo de constantes de https://www.php.net/manual/es/errorfunc.constants.php Para la configuraci\u00f3n de los errores podemos hacerlo de dos formas: A nivel de php.ini : error_reporting : indica los niveles de errores a notificar. rerror_reporting = E_ALL & ~E_NOTICE -> Todos los errores menos los avisos en tiempo de ejecuci\u00f3n. display_errors : indica si mostrar o no los errores por pantalla. En entornos de producci\u00f3n es com\u00fan ponerlo a off. mediante c\u00f3digo con las siguientes funciones: error_reporting(codigo) -> Controla qu\u00e9 errores notificar. set_error_handler(nombreManejador) -> Indica qu\u00e9 funci\u00f3n se invocar\u00e1 cada vez que se encuentre un error. El manejador recibe como par\u00e1metros el nivel del error y el mensaje. A continuaci\u00f3n tenemos un ejemplo mediante c\u00f3digo: Funciones para la gesti\u00f3n de errores : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php error_reporting ( E_ALL & ~ E_NOTICE & ~ E_WARNING ); $resultado = $dividendo / $divisor ; error_reporting ( E_ALL & ~ E_NOTICE ); set_error_handler ( \"miManejadorErrores\" ); $resultado = $dividendo / $divisor ; restore_error_handler (); // vuelve al anterior function miManejadorErrores ( $nivel , $mensaje ) { switch ( $nivel ) { case E_WARNING : echo \"<strong>Warning</strong>: $mensaje .<br/>\" ; break ; default : echo \"Error de tipo no especificado: $mensaje .<br/>\" ; } } Consola : Text Only 1 2 3 Error de tipo no especificado: Undefined variable: dividendo. Error de tipo no especificado: Undefined variable: divisor. Error de tipo Warning: Division by zero.","title":"gesti\u00f3n de errores"},{"location":"ud03/ud0303/#excepciones","text":"La gesti\u00f3n de excepciones forma parte desde PHP 5. Su funcionamiento es similar a Java, haciendo uso de un bloque try / catch / finally . Si detectamos una situaci\u00f3n an\u00f3mala y queremos lanzar una excepci\u00f3n, deberemos realizar throw new Exception (adjuntando el mensaje que lo ha provocado). PHP 1 2 3 4 5 6 7 8 9 <?php try { if ( $divisor == 0 ) { throw new Exception ( \"Divisi\u00f3n por cero.\" ); } $resultado = $dividendo / $divisor ; } catch ( Exception $e ) { echo \"Se ha producido el siguiente error: \" . $e -> getMessage (); } La clase Exception es la clase madre de todas las excepciones. Su constructor recibe mensaje [, codigoError][, excepcionPrevia] . A partir de un objeto Exception , podemos acceder a los m\u00e9todos getMessage() y getCode() para obtener el mensaje y el c\u00f3digo de error de la excepci\u00f3n capturada. El propio lenguaje ofrece un conjunto de excepciones ya definidas, las cuales podemos capturar (y lanzar desde PHP 7). Se recomienda su consulta en la documentaci\u00f3n oficial .","title":"excepciones"},{"location":"ud03/ud0303/#creando-excepciones","text":"Para crear una excepci\u00f3n, la forma m\u00e1s corta es crear una clase que \u00fanicamente herede de Exception . PHP 1 2 <?php class HolaExcepcion extends Exception {} Si queremos, y es recomendable dependiendo de los requisitos, podemos sobrecargar los m\u00e9todos m\u00e1gicos, por ejemplo, sobrecargando el constructor y llamando al constructor de la clase madre, o rescribir el m\u00e9todo __toString para cambiar su mensaje: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MiExcepcion extends Exception { public function __construct ( $msj , $codigo = 0 , Exception $previa = null ) { // c\u00f3digo propio parent :: __construct ( $msj , $codigo , $previa ); } public function __toString () { return __CLASS__ . \": [ { $this -> code } ]: { $this -> message } \\n \" ; } public function miFuncion () { echo \"Una funci\u00f3n personalizada para este tipo de excepci\u00f3n \\n \" ; } } Si definimos una excepci\u00f3n de aplicaci\u00f3n dentro de un namespace , cuando referenciemos a Exception , deberemos referenciarla mediante su nombre totalmente cualificado ( \\Exception ), o utilizando use : Mediante nombre totalmente cualificado PHP 1 2 3 4 <?php namespace \\Dwes\\Ejemplos ; class AppExcepcion extends \\Exception {} Mediante use PHP 1 2 3 4 5 6 <?php namespace \\Dwes\\Ejemplos ; use Exception ; class AppExcepcion extends Exception {}","title":"creando excepciones"},{"location":"ud03/ud0303/#excepciones-multiples","text":"Se pueden usar excepciones m\u00faltiples para comprobar diferentes condiciones. A la hora de capturarlas, se hace de m\u00e1s espec\u00edfica a m\u00e1s general. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php $email = \"ejemplo@ejemplo.com\" ; try { // Comprueba si el email es v\u00e1lido if ( filter_var ( $email , FILTER_VALIDATE_EMAIL ) === FALSE ) { throw new MiExcepcion ( $email ); } // Comprueba la palabra ejemplo en la direcci\u00f3n email if ( strpos ( $email , \"ejemplo\" ) !== FALSE ) { throw new Exception ( \" $email es un email de ejemplo no v\u00e1lido\" ); } } catch ( MiExcepcion $e ) { echo $e -> miFuncion (); } catch ( Exception $e ) { echo $e -> getMessage (); } autoevaluaci\u00f3n : \u00bfQu\u00e9 pasar\u00eda al ejecutar el siguiente c\u00f3digo? PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException $e ) { echo \"Capturada MainException \" . $e -> getMessage (); } catch ( SubException $e ) { echo \"Capturada SubException \" . $e -> getMessage (); } catch ( Exception $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Si en el mismo catch queremos capturar varias excepciones, hemos de utilizar el operador | : PHP 1 2 3 4 5 6 7 8 9 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException | SubException $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Desde PHP 7, existe el tipo Throwable , el cual es un interfaz que implementan tanto los errores como las excepciones, y nos permite capturar los dos tipos a la vez: PHP 1 2 3 4 5 6 <?php try { // tu codigo } catch ( Throwable $e ) { echo 'Forma de capturar errores y excepciones a la vez' ; } Si s\u00f3lo queremos capturar los errores fatales, podemos hacer uso de la clase Error : PHP 1 2 3 4 5 6 7 8 9 <?php try { // Genera una notificaci\u00f3n que no se captura echo $variableNoAsignada ; // Error fatal que se captura funcionQueNoExiste (); } catch ( Error $e ) { echo \"Error capturado: \" . $e -> getMessage (); }","title":"excepciones m\u00faltiples"},{"location":"ud03/ud0303/#relanzar-excepciones","text":"En las aplicaciones reales, es muy com\u00fan capturar una excepci\u00f3n de sistema y lanzar una de aplicaci\u00f3n que hemos definido nosotros. Tambi\u00e9n podemos lanzar las excepciones sin necesidad de estar dentro de un try / catch . PHP 1 2 3 4 5 6 7 8 <?php class AppException extends Exception {} try { // C\u00f3digo de negocio que falla } catch ( Exception $e ) { throw new AppException ( \"AppException: \" . $e -> getMessage (), $e -> getCode (), $e ); }","title":"relanzar excepciones"},{"location":"ud03/ud0303/#spl","text":"Standard PHP Library es el conjunto de funciones y utilidades que ofrece PHP, como: Estructuras de datos: pila, cola, cola de prioridad, lista doblemente enlazada, etc... Conjunto de iteradores dise\u00f1ados para recorrer estructuras agregadas: arrays, resultados de bases de datos, \u00e1rboles XML, listados de directorios, etc. Pod\u00e9is consultar la documentaci\u00f3n en https://www.php.net/manual/es/book.spl.php o ver algunos ejemplos en https://diego.com.es/tutorial-de-la-libreria-spl-de-php Tambi\u00e9n define un conjunto de excepciones que podemos utilizar para que las lancen nuestras aplicaciones: LogicException (extends Exception) BadFunctionCallException BadMethodCallException DomainException InvalidArgumentException LengthException OutOfRangeException RuntimeException (extends Exception) OutOfBoundsException OverflowException RangeException UnderflowException UnexpectedValueException Tambi\u00e9n pod\u00e9is consultar la documentaci\u00f3n de estas excepciones en https://www.php.net/manual/es/spl.exceptions.php.","title":"SPL"},{"location":"ud03/ud0303/#referencias","text":"Manual de PHP Manual de OO en PHP - www.desarrolloweb.com videos Curso PHP 8 desde cero (Actulizado) :","title":"referencias"},{"location":"ud03/ud03T/","text":"duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada : 18 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio. a) Se han identificado las ventajas de separar la l\u00f3gica de negocio de los aspectos de presentaci\u00f3n de la aplicaci\u00f3n. b) Se han analizado tecnolog\u00edas y mecanismos que permiten realizar esta separaci\u00f3n y sus caracter\u00edsticas principales. c) Se han utilizado objetos y controles en el servidor para generar el aspecto visual de la aplicaci\u00f3n web en el cliente. d) Se han utilizado formularios generados de forma din\u00e1mica para responder a los eventos de la aplicaci\u00f3n Web. e) Se han escrito aplicaciones Web con mantenimiento de estado y separaci\u00f3n de la l\u00f3gica de negocio. f) Se han aplicado los principios de la programaci\u00f3n orientada a objetos. g) Se ha probado y documentado el c\u00f3digo. clases y objetos PHP sigue un paradigma de programaci\u00f3n orientada a objetos (POO) basada en clases. Una clase es una plantilla que define las atributos y m\u00e9todos para poder crear objetos. De este manera, un objeto es una instancia de una clase . Tanto los atributos como los m\u00e9todos se definen con una visibilidad (qui\u00e9n puede acceder): Privado - private : S\u00f3lo puede acceder la propia clase. Protegido - protected : S\u00f3lo puede acceder la propia clase o sus descendientes. P\u00fablico - public : Puede acceder cualquier otra clase. Para declarar una clase, se utiliza la palabra clave class seguido del nombre de la clase. Para instanciar un objeto a partir de la clase, se utiliza new : PHP 1 2 3 4 5 6 7 <?php class NombreClase { // atributos // y m\u00e9todos } $ob = new NombreClase (); clases con may\u00fascula : Todas las clases empiezan por letra may\u00fascula. Cuando un proyecto crece, es normal modelar las clases mediante UML (\u00bfrecord\u00e1is Entornos de Desarrollo ?). La clases se representan mediante un cuadrado, separando el nombre, de los atributos y los m\u00e9todos: Una vez que hemos creado un objeto, se utiliza el operador -> para acceder a un atributo o un m\u00e9todo del objeto: PHP 1 2 $objeto->atributo; $objeto->m\u00e9todo(par\u00e1metros); Si desde, dentro de la clase, queremos acceder a un atributo o m\u00e9todo de la misma clase, utilizaremos la referencia $this ; PHP 1 2 $this->atributo; $this->m\u00e9todo(par\u00e1metros); As\u00ed pues, como ejemplo, codificar\u00edamos una persona en el fichero Persona.php como: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php class Persona { private string $nombre ; public function setNombre ( string $nombre ) { $this -> nombre = $nombre ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona (); // creamos un objeto $bruno -> setNombre ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Aunque se pueden declarar varias clases en el mismo archivo, es una mala pr\u00e1ctica. As\u00ed pues, cada fichero : contedr\u00e1 una sola clase , y se nombrar\u00e1 con el nombre de la clase . encapsulaci\u00f3n Los atributos se definen privados o protegidos (si queremos que las clases heredadas puedan acceder). Para cada atributo, se a\u00f1aden m\u00e9todos p\u00fablicos ( getter / setter ): PHP 1 2 3 public function setAtributo (tipo $param); public function getAtributo () : tipo; Las constantes se definen p\u00fablicas para que sean accesibles por todos los recursos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 <?php class MayorMenor { private int $mayor ; private int $menor ; public function setMayor ( int $may ) { $this -> mayor = $may ; } public function setMenor ( int $men ) { $this -> menor = $men ; } public function getMayor () : int { return $this -> mayor ; } public function getMenor () : int { return $this -> menor ; } } Recibiendo y enviando objetos Es recomendable indicarlo en el tipo de par\u00e1metros. Si el objeto puede devolver nulos se pone ? delante del nombre de la clase. objetos por referencia : Los objetos que se env\u00edan y reciben como par\u00e1metros siempre se pasan por referencia. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php function maymen ( array $numeros ) : ? MayorMenor { $a = max ( $numeros ); $b = min ( $numeros ); $result = new MayorMenor (); $result -> setMayor ( $a ); $result -> setMenor ( $b ); return $result ; } $resultado = maymen ( [ 1 , 76 , 9 , 388 , 41 , 39 , 25 , 97 , 22 ] ); echo \"<br>Mayor: \" . $resultado -> getMayor (); echo \"<br>Menor: \" . $resultado -> getMenor (); constructor El constructor de los objetos se define mediante el m\u00e9todo m\u00e1gico __construct . Puede o no tener par\u00e1metros, pero s\u00f3lo puede haber un \u00fanico constructor . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Persona { private string $nombre ; public function __construct ( string $nom ) { $this -> nombre = $nom ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); constructores en PHP8 Una de las grandes novedades que ofrece PHP 8 es la simplificaci\u00f3n de los constructores con par\u00e1metros, lo que se conoce como promoci\u00f3n de los atributos del constructor . Para ello, en vez de tener que declarar los atributos como privados o protegidos, y luego dentro del constructor tener que asignar los par\u00e1metros a estos atributos, el propio constructor promociona los atributos. Ve\u00e1moslo mejor con un ejemplo. Imaginemos una clase Punto donde queramos almacenar sus coordenadas. As\u00ed quedar\u00eda en PHP7 o anteriores: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Punto { protected float $x ; protected float $y ; protected float $z ; public function __construct ( float $x = 0.0 , float $y = 0.0 , float $z = 0.0 ) { $this -> x = $x ; $this -> y = $y ; $this -> z = $z ; } } En PHP8 , quedar\u00eda del siguiente modo (mucho m\u00e1s corto, lo que facilita su legibilidad): PHP 1 2 3 4 5 6 7 8 <?php class Punto { public function __construct ( protected float $x = 0.0 , protected float $y = 0.0 , protected float $z = 0.0 , ) {} } el orden importa: A la hora de codificar el orden de los elementos debe ser: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php declare ( strict_types = 1 ); class NombreClase { // atributos // constructor // getters - setters // resto de m\u00e9todos } ?> clases est\u00e1ticas Son aquellas que tienen atributos ( o propiedades ) y/o m\u00e9todos est\u00e1ticos (tambi\u00e9n se conocen como de clase , porque su valor se comparte entre todas las instancias de la misma clase). Se declaran con static y se referencian con :: . Si queremos acceder a un m\u00e9todo est\u00e1tico , se antepone el nombre de la clase como sigue: Producto::nuevoProducto() . Si desde un m\u00e9todo queremos acceder a un atributo est\u00e1tico de la misma clase, se utiliza la referencia self como sigue: self::$numProductos . PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; public static function nuevoProducto () { self :: $numProductos ++ ; } } Producto :: nuevoProducto (); $impuesto = Producto :: IVA ; Tambi\u00e9n podemos tener clases normales que tengan algun atributo est\u00e1tico: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; private $codigo ; public function __construct ( string $cod ) { self :: $numProductos ++ ; $this -> codigo = $cod ; } public function mostrarResumen () : string { return \"El producto \" . $this -> codigo . \" es el n\u00famero \" . self :: $numProductos ; } } $prod1 = new Producto ( \"PS5\" ); $prod2 = new Producto ( \"XBOX Series X\" ); $prod3 = new Producto ( \"Nintendo Switch\" ); echo $prod3 -> mostrarResumen (); Bash 1 El producto Nintendo Switch es el n\u00famero 3 introspecci\u00f3n Al trabajar con clases y objetos, existen un conjunto de funciones ya definidas por el lenguaje que permiten obtener informaci\u00f3n sobre los objetos: instanceof : permite comprobar si un objeto es de una determinada clase. get_class : devuelve el nombre de la clase. get_declared_class : devuelve un array con los nombres de las clases definidas. class_alias : crea un alias. class_exists / method_exists / property_exists : devuelve true si la clase/m\u00e9todo/atributo est\u00e1 definida. get_class_methods / get_class_vars / get_object_vars : devuelve un array con los nombres de los m\u00e9todos/atributos de una clase / atributos de un objeto que son accesibles desde d\u00f3nde se hace la llamada. Un ejemplo de estas funciones puede ser el siguiente: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php $p = new Producto ( \"PS5\" ); if ( $p instanceof Producto ) { echo \"Es un producto.<br/>\" ; echo \"La clase es \" . get_class ( $p ) . \"<br/>\" ; class_alias ( \"Producto\" , \"Articulo\" ); $c = new Articulo ( \"Nintendo Switch\" ); echo \"Un articulo es un \" . get_class ( $c ) . \"<br/>\" ; print_r ( get_class_methods ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_class_vars ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_object_vars ( $p )); echo \"<br/>\" ; if ( method_exists ( $p , \"mostrarResumen\" )) { echo $p -> mostrarResumen (); } } clonado : Al asignar dos objetos no se copian, se crea una nueva referencia. Si queremos una copia, hay que clonarlo mediante el m\u00e9todo clone(object) : object . PHP nos permite crear un m\u00e9todo que se llamar\u00e1 cuando ejecutemos el operador clone. Este m\u00e9todo puede entre otras cosas inicializar algunos atributos. Si no se define el m\u00e9todo __clone() se har\u00e1 una copia id\u00e9ntica del objeto que le pasamos como par\u00e1metro al operador clone. Veamos un ejemplo: Crearemos una clase Persona que tenga como atributos su nombre y edad, definiremos los m\u00e9todos para cargar y retornar los valores de sus atributos. Haremos que cuando clonemos un objeto de dicha clase la edad de la persona se fije con cero. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php class Persona { private $nombre ; private $edad ; public function fijarNombreEdad ( $nom , $ed ) { $this -> nombre = $nom ; $this -> edad = $ed ; } public function getNombre () { return $this -> nombre ; } public function getEdad () { return $this -> edad ; } public function __clone () { $this -> edad = 0 ; } } $persona1 = new Persona (); $persona1 -> fijarNombreEdad ( 'Juan' , 20 ); echo 'Datos de $persona1:' ; echo $persona1 -> retornarNombre () . ' - ' . $persona1 -> retornarEdad () . '<br>' ; $persona2 = clone ( $persona1 ); echo 'Datos de $persona2:' ; echo $persona2 -> retornarNombre () . ' - ' . $persona2 -> retornarEdad () . '<br>' ; ?> El m\u00e9todo __clone se ejecutar\u00e1 cuando llamemos al operador clone para esta clase: PHP 1 2 3 public function __clone() { $this->edad=0; } Es decir cuando realicemos la asignaci\u00f3n: PHP 1 $persona2 = clone($persona1); inicialmente se hace una copia id\u00e9ntica de $persona1 pero luego se ejecuta el m\u00e9todo __clone con lo que el atributo $edad se modifica. Si queremos que una clase no pueda clonarse simplemente podemos implementar el siguiente c\u00f3digo en el m\u00e9todo __clone(): PHP 1 2 3 public function __clone() { die('No esta permitido clonar objetos de esta clase'); } M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/language.oop5.cloning.php herencia PHP soporta herencia simple, de manera que una clase solo puede heredar de otra clase , no de dos o m\u00e1s clases a la vez. Para ello se utiliza la palabra clave extends . Si queremos que la clase A hereda de la clase B haremos: PHP 1 class A extends B La clase hija hereda los atributos y m\u00e9todos p\u00fablicos y protegidos de la clase madre. cada clase en un archivo : Como ya hemos comentado, deber\u00edamos colocar cada clase en un archivo diferente para posteriormente utilizarlo mediante include . En los siguientes ejemplos los hemos colocado juntos para facilitar su legibilidad. Por ejemplo, tenemos una clase Producto y una Tv que hereda de Producto : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Producto { protected $codigo ; protected $nombre ; protected $nombreCorto ; protected $PVP ; public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { protected $pulgadas ; protected $tecnologia ; } Podemos utilizar las siguientes funciones para averiguar si hay relaci\u00f3n entre dos clases: get_parent_class(object): string is_subclass_of(object, string): bool PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php $t = new Tv (); $t -> codigo = 33 ; if ( $t instanceof Producto ) { echo $t -> mostrarResumen (); } $madre = get_parent_class ( $t ); echo \"<br>La clase madre es: \" . $madre ; $objetoMadre = new $madre ; echo $objetoMadre -> mostrarResumen (); if ( is_subclass_of ( $t , 'Producto' )) { echo \"<br>Soy una hija de Producto\" ; } sobreescribir m\u00e9todos Podemos crear m\u00e9todos en las clase hijas con el mismo nombre que la clase madre, cambiando su comportamiento. Para invocar a los m\u00e9todos de la clase madre: parent::nombreMetodo() . PHP 1 2 3 4 5 6 7 8 9 10 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } constructor en clases hijas En cambio, si lo definimos en la clase hija, hemos de invocar al de la clase madre de manera expl\u00edcita. PHP 7 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 <?php class Producto { public string $codigo ; public function __construct ( string $codigo ) { $this -> codigo = $codigo ; } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function __construct ( string $codigo , int $pulgadas , string $tecnologia ) { parent :: __construct ( $codigo ); $this -> pulgadas = $pulgadas ; $this -> tecnologia = $tecnologia ; } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } PHP 8 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php class Producto { public function __construct ( private string $codigo ) { } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public function __construct ( string $codigo , private int $pulgadas , private string $tecnologia ) { parent :: __construct ( $codigo ); } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } clases abstractas Las clases abstractas obligan a heredar de estas clases, ya que no se permite su instanciaci\u00f3n; s\u00ed se permite a las clases heredadas (siempre que no est\u00e9n tambi\u00e9n definidas como abstractas). Se define mediante abstract class NombreClase { . Una clase abstracta puede contener atributos y m\u00e9todos no-abstractos, y/o m\u00e9todos abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php // Clase abstracta abstract class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } // M\u00e9todo abstracto abstract public function mostrarResumen (); } Cuando una clase hereda de una clase abstracta, obligat\u00f3riamente debe implementar los m\u00e9todos que tiene la clase madre marcados como abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { //obligado a implementarlo echo \"<p>C\u00f3digo \" . $this -> getCodigo () . \"</p>\" ; echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } $t = new Tv (); echo $t -> getCodigo (); clases finales Son clases opuestas a abstractas, ya que evitan que se pueda heredar una clase o m\u00e9todo para sobreescribirlo. Se define mediante final class NombreClase { . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } final public function mostrarResumen () : string { return \"Producto \" . $this -> codigo ; } } // No podremos heredar de Microondas final class Microondas extends Producto { private $potencia ; public function getPotencia () : int { return $this -> potencia ; } // No podemos implementar mostrarResumen() } interfaces Permite definir un contrato con las firmas de los m\u00e9todos a cumplir. As\u00ed pues, s\u00f3lo contiene declaraciones de funciones y todas deben ser p\u00fablicas. Se declaran con la palabra clave interface y luego las clases que cumplan el contrato lo realizan mediante la palabra clave implements . PHP 1 2 3 4 5 6 <?php interface Nombreable { // declaraci\u00f3n de funciones } class NombreClase implements NombreInterfaz { // c\u00f3digo de la clase Se permite la herencia de interfaces. Adem\u00e1s, una clase puede implementar varios interfaces (en este caso, s\u00ed soporta la herecia m\u00faltiple, pero s\u00f3lo de interfaces). PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php interface Mostrable { public function mostrarResumen () : string ; } interface MostrableTodo extends Mostrable { public function mostrarTodo () : string ; } interface Facturable { public function generarFactura () : string ; } class Producto implements MostrableTodo , Facturable { // Implementaciones de los m\u00e9todos // Obligatoriamente deber\u00e1 implementar: // - public function mostrarResumen, // - public function mostrarTodo y // - public function generarFactura } m\u00e9todos encadenados Sigue el planteamiento de la programaci\u00f3n funcional, y tambi\u00e9n se conoce como method chaining . Plantea que sobre un objeto se realizan varias llamadas; o sea, consiste en llamar varios m\u00e9todos de un objeto en una misma l\u00ednea, basta con a\u00f1adir al final de cada m\u00e9todo: return $this; Con el siguiente ejemplo se entiende f\u00e1cilmente. Para facilitarlo, vamos a modificar todos sus m\u00e9todos mutadores (que modifican datos , setters , ...) para que devuelvan una referencia a $this : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Coche { public function lavar (){ echo \"Coche lavado. \\n \" ; return $this ; } public function encerar (){ echo \"Coche encerado. \\n \" ; return $this ; } } // ejemplo llamada a los m\u00e9todos encadenados $coche = new Coche ; $coche -> lavar () -> encerar (); Bash 1 2 3 // mostrar\u00e1 Coche lavado. Coche encerado. Otro ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php class Libro { private string $nombre ; private string $autor ; public function getNombre () : string { return $this -> nombre ; } public function setNombre ( string $nombre ) : Libro { $this -> nombre = $nombre ; return $this ; } public function getAutor () : string { return $this -> autor ; } public function setAutor ( string $autor ) : Libro { $this -> autor = $autor ; return $this ; } public function __toString () : string { return $this -> nombre . \" de \" . $this -> autor ; } } m\u00e9todos m\u00e1gicos Todas las clases PHP ofrecen un conjunto de m\u00e9todos, tambi\u00e9n conocidos como magic methods que se pueden sobreescribir para sustituir su comportamiento. Algunos de ellos ya los hemos utilizado. Ante cualquier duda, es conveniente consultar la documentaci\u00f3n oficial . Los m\u00e1s destacables son: __construct() __destruct() \u2192 se invoca al perder la referencia. Se utiliza para cerrar una conexi\u00f3n a la BD, cerrar un fichero, ... __toString() \u2192 representaci\u00f3n del objeto como cadena. Es decir, cuando hacemos echo $objeto se ejecuta autom\u00e1ticamente este m\u00e9todo. get(atributo) , set(atributo, valor) \u2192 Permitir\u00eda acceder a los atributos privados, aunque siempre es m\u00e1s legible/mantenible codificar los getter/setter. __isset(atributo) , __unset(atributo) \u2192 Permite averiguar o quitar el valor a un atributo. sleep() , wakeup() \u2192 Se ejecutan al recuperar ( unserialize^ ) o almacenar un objeto que se serializa ( serialize ), y se utilizan para permite definir qu\u00e9 atributos se serializan. call() , callStatic() \u2192 Se ejecutan al llamar a un m\u00e9todo que no es p\u00fablico. Permiten sobrecargar m\u00e9todos. espacio de nombres Desde PHP 5.3 y tambi\u00e9n conocidos como Namespaces , permiten organizar las clases/interfaces, funciones y/o constantes (de forma similar a los paquetes en Java) en un \u00e1mbito restringido; evitando colisiones o conflictos de nombre con otros elementos que se pueden crear m\u00e1s adelante (o con algunas librer\u00edas que utilices). recomendaci\u00f3n : Un s\u00f3lo namespace por archivo y crear una estructura de carpetas respectando los niveles/subniveles (igual que se hace en Java). Se declaran en la primera l\u00ednea mediante la palabra clave namespace seguida del nombre del espacio de nombres asignado (cada subnivel se separa con la barra invertida \\ ): Por ejemplo, para colocar la clase Producto dentro del namespace Dwes\\Ejemplos lo har\u00edamos as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace Dwes\\Ejemplos ; const IVA = 0.21 ; class Producto { public $nombre ; public function muestra () : void { echo \"<p>Prod:\" . $this -> nombre . \"</p>\" ; } } acceso Para referenciar a un recurso que contiene un namespace, primero hemos de tenerlo disponible haciendo uso de include o require . Si el recurso est\u00e1 en el mismo namespace, se realiza un acceso directo (se conoce como acceso sin cualificar ). Realmente hay tres tipos de acceso: sin cualificar: recurso cualificado: rutaRelativa\\recurso \u2192 no hace falta poner el namespace completo. totalmente cualificado: \\rutaAbsoluta\\recurso PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php namespace Dwes\\Ejemplos ; include_once ( \"Producto.php\" ); // sin cualificar echo IVA ; // acceso cualificado. // Dar\u00eda error, no existe \\Dwes\\Ejemplos\\Utilidades\\IVA echo Utilidades\\IVA ; // totalmente cualificado echo \\Dwes\\Ejemplos\\IVA ; $p1 = new Producto (); // lo busca en el mismo namespace y // encuentra \\Dwes\\Ejemplos\\Producto $p2 = new Model\\Producto (); // dar\u00eda error, no existe el namespace Model. // Est\u00e1 buscando \\Dwes\\Ejemplos\\Model\\Producto $p3 = new \\Dwes\\Ejemplos\\Producto (); // \\Dwes\\Ejemplos\\Producto video use Para evitar la referencia cualificada podemos declarar el uso mediante use (similar a hacer import en Java). Se hace en la cabecera, tras el namespace: Los tipos posibles son: use const nombreCualificadoConstante use function nombreCualificadoFuncion use nombreCualificadoClase use nombreCualificadoClase as NuevoNombre // para renombrar elementos Por ejemplo, si queremos utilizar la clase \\Dwes\\Ejemplos\\Producto desde un recurso que se encuentra en la ra\u00edz, por ejemplo en inicio.php , har\u00edamos: PHP 1 2 3 4 5 6 7 8 <?php include_once ( \"Dwes\\Ejemplo\\Producto.php\" ); use const Dwes\\Ejemplos\\IVA ; use \\Dwes\\Ejemplos\\Producto ; echo IVA ; $p1 = new Producto (); to use or not to use En resumen, use permite acceder sin cualificar a recursos que est\u00e1n en otro namespace . Si estamos en el mismo espacio de nombre, no necesitamos use . video organizaci\u00f3n Todo proyecto, conforme crece, necesita organizar su c\u00f3digo fuente. Se plantea una organizaci\u00f3n en la que los archivos que interactuan con el navegador se colocan en el ra\u00edz, y las clases que definamos van dentro de un namespace (y dentro de su propia carpeta src o app). organizaci\u00f3n, includes y usos : Colocaremos cada recurso en un fichero aparte. En la primera l\u00ednea indicaremos su namespace (si no est\u00e1 en el ra\u00edz). Si utilizamos otros recursos, haremos un include_once de esos recursos (clases, interfaces, etc...). Cada recurso debe incluir todos los otros recursos que referencie: la clase de la que hereda, interfaces que implementa, clases utilizadas/recibidas como par\u00e1metros, etc... Si los recursos est\u00e1n en un espacio de nombres diferente al que estamos, emplearemos use con la ruta completa para luego utilizar referencias sin cualificar. autoload \u00bfNo es tedioso tener que hacer el include de las clases? El autoload viene al rescate. As\u00ed pues, permite cargar las clases (no las constantes ni las funciones) que se van a utilizar y evitar tener que hacer el include_once de cada una de ellas. Para ello, se utiliza la funci\u00f3n spl_autoload_register . PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once $nombreClase . '.php' ; } ); ?> por qu\u00e9 se llama autoload : Porque antes se realizaba mediante el m\u00e9todo m\u00e1gico __autoload() , el cual est\u00e1 deprecated desde PHP 7.2. Y \u00bfc\u00f3mo organizamos ahora nuestro c\u00f3digo aprovechando el autoload? Para facilitar la b\u00fasqueda de los recursos a incluir, es recomendable colocar todas las clases dentro de una misma carpeta. Nosotros la vamos a colocar dentro de app (m\u00e1s adelante, cuando estudiemos Laravel veremos el motivo de esta decisi\u00f3n). Otras carpetas que podemos crear son test para colocar las pruebas PhpUnit que luego realizaremos, o la carpeta vendor donde se almacenar\u00e1n las librer\u00edas del proyecto (esta carpeta es un est\u00e1ndard dentro de PHP, ya que Composer la crea autom\u00e1ticamente). Como hemos colocado todos nuestros recursos dentro de app , ahora nuestro autoload.php (el cual colocamos en la carpeta ra\u00edz) s\u00f3lo va a buscar dentro de esa carpeta: PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once \"app/\" . $nombreClase . '.php' ; } ); ?> autoload y rutas err\u00f3neas : En Ubuntu al hacer el include de la clase que recibe como par\u00e1metro, las barras de los namespace ( \\ ) son diferentes a las de las rutas ( / ). Por ello, es mejor que utilicemos el fichero autoload: PHP 1 2 3 4 5 6 7 <?php spl_autoload_register ( function ( $nombreClase ) { $ruta = \"app \\\\ \" . $nombreClase . '.php' ; $ruta = str_replace ( \" \\\\ \" , \"/\" , $ruta ); // Sustituimos las barras include_once $ruta ' ; } ); ?> video Aqu\u00ed encontramos un peque\u00f1o video en el que https://www.youtube.com/watch?v=lP1hbkNA2uc gesti\u00f3n de errores PHP clasifica los errores que ocurren en diferentes niveles. Cada nivel se identifica con una constante. Por ejemplo: E_ERROR : errores fatales, no recuperables. Se interrumpe el script. E_WARNING : advertencias en tiempo de ejecuci\u00f3n. El script no se interrumpe. E_NOTICE : avisos en tiempo de ejecuci\u00f3n. Pod\u00e9is comprobar el listado completo de constantes de https://www.php.net/manual/es/errorfunc.constants.php Para la configuraci\u00f3n de los errores podemos hacerlo de dos formas: A nivel de php.ini : error_reporting : indica los niveles de errores a notificar. rerror_reporting = E_ALL & ~E_NOTICE -> Todos los errores menos los avisos en tiempo de ejecuci\u00f3n. display_errors : indica si mostrar o no los errores por pantalla. En entornos de producci\u00f3n es com\u00fan ponerlo a off. mediante c\u00f3digo con las siguientes funciones: error_reporting(codigo) -> Controla qu\u00e9 errores notificar. set_error_handler(nombreManejador) -> Indica qu\u00e9 funci\u00f3n se invocar\u00e1 cada vez que se encuentre un error. El manejador recibe como par\u00e1metros el nivel del error y el mensaje. A continuaci\u00f3n tenemos un ejemplo mediante c\u00f3digo: Funciones para la gesti\u00f3n de errores : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php error_reporting ( E_ALL & ~ E_NOTICE & ~ E_WARNING ); $resultado = $dividendo / $divisor ; error_reporting ( E_ALL & ~ E_NOTICE ); set_error_handler ( \"miManejadorErrores\" ); $resultado = $dividendo / $divisor ; restore_error_handler (); // vuelve al anterior function miManejadorErrores ( $nivel , $mensaje ) { switch ( $nivel ) { case E_WARNING : echo \"<strong>Warning</strong>: $mensaje .<br/>\" ; break ; default : echo \"Error de tipo no especificado: $mensaje .<br/>\" ; } } Consola : Text Only 1 2 3 Error de tipo no especificado: Undefined variable: dividendo. Error de tipo no especificado: Undefined variable: divisor. Error de tipo Warning: Division by zero. excepciones La gesti\u00f3n de excepciones forma parte desde PHP 5. Su funcionamiento es similar a Java, haciendo uso de un bloque try / catch / finally . Si detectamos una situaci\u00f3n an\u00f3mala y queremos lanzar una excepci\u00f3n, deberemos realizar throw new Exception (adjuntando el mensaje que lo ha provocado). PHP 1 2 3 4 5 6 7 8 9 <?php try { if ( $divisor == 0 ) { throw new Exception ( \"Divisi\u00f3n por cero.\" ); } $resultado = $dividendo / $divisor ; } catch ( Exception $e ) { echo \"Se ha producido el siguiente error: \" . $e -> getMessage (); } La clase Exception es la clase madre de todas las excepciones. Su constructor recibe mensaje [, codigoError][, excepcionPrevia] . A partir de un objeto Exception , podemos acceder a los m\u00e9todos getMessage() y getCode() para obtener el mensaje y el c\u00f3digo de error de la excepci\u00f3n capturada. El propio lenguaje ofrece un conjunto de excepciones ya definidas, las cuales podemos capturar (y lanzar desde PHP 7). Se recomienda su consulta en la documentaci\u00f3n oficial . creando excepciones Para crear una excepci\u00f3n, la forma m\u00e1s corta es crear una clase que \u00fanicamente herede de Exception . PHP 1 2 <?php class HolaExcepcion extends Exception {} Si queremos, y es recomendable dependiendo de los requisitos, podemos sobrecargar los m\u00e9todos m\u00e1gicos, por ejemplo, sobrecargando el constructor y llamando al constructor de la clase madre, o rescribir el m\u00e9todo __toString para cambiar su mensaje: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MiExcepcion extends Exception { public function __construct ( $msj , $codigo = 0 , Exception $previa = null ) { // c\u00f3digo propio parent :: __construct ( $msj , $codigo , $previa ); } public function __toString () { return __CLASS__ . \": [ { $this -> code } ]: { $this -> message } \\n \" ; } public function miFuncion () { echo \"Una funci\u00f3n personalizada para este tipo de excepci\u00f3n \\n \" ; } } Si definimos una excepci\u00f3n de aplicaci\u00f3n dentro de un namespace , cuando referenciemos a Exception , deberemos referenciarla mediante su nombre totalmente cualificado ( \\Exception ), o utilizando use : Mediante nombre totalmente cualificado PHP 1 2 3 4 <?php namespace \\Dwes\\Ejemplos ; class AppExcepcion extends \\Exception {} Mediante use PHP 1 2 3 4 5 6 <?php namespace \\Dwes\\Ejemplos ; use Exception ; class AppExcepcion extends Exception {} excepciones m\u00faltiples Se pueden usar excepciones m\u00faltiples para comprobar diferentes condiciones. A la hora de capturarlas, se hace de m\u00e1s espec\u00edfica a m\u00e1s general. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php $email = \"ejemplo@ejemplo.com\" ; try { // Comprueba si el email es v\u00e1lido if ( filter_var ( $email , FILTER_VALIDATE_EMAIL ) === FALSE ) { throw new MiExcepcion ( $email ); } // Comprueba la palabra ejemplo en la direcci\u00f3n email if ( strpos ( $email , \"ejemplo\" ) !== FALSE ) { throw new Exception ( \" $email es un email de ejemplo no v\u00e1lido\" ); } } catch ( MiExcepcion $e ) { echo $e -> miFuncion (); } catch ( Exception $e ) { echo $e -> getMessage (); } autoevaluaci\u00f3n : \u00bfQu\u00e9 pasar\u00eda al ejecutar el siguiente c\u00f3digo? PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException $e ) { echo \"Capturada MainException \" . $e -> getMessage (); } catch ( SubException $e ) { echo \"Capturada SubException \" . $e -> getMessage (); } catch ( Exception $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Si en el mismo catch queremos capturar varias excepciones, hemos de utilizar el operador | : PHP 1 2 3 4 5 6 7 8 9 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException | SubException $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Desde PHP 7, existe el tipo Throwable , el cual es un interfaz que implementan tanto los errores como las excepciones, y nos permite capturar los dos tipos a la vez: PHP 1 2 3 4 5 6 <?php try { // tu codigo } catch ( Throwable $e ) { echo 'Forma de capturar errores y excepciones a la vez' ; } Si s\u00f3lo queremos capturar los errores fatales, podemos hacer uso de la clase Error : PHP 1 2 3 4 5 6 7 8 9 <?php try { // Genera una notificaci\u00f3n que no se captura echo $variableNoAsignada ; // Error fatal que se captura funcionQueNoExiste (); } catch ( Error $e ) { echo \"Error capturado: \" . $e -> getMessage (); } relanzar excepciones En las aplicaciones reales, es muy com\u00fan capturar una excepci\u00f3n de sistema y lanzar una de aplicaci\u00f3n que hemos definido nosotros. Tambi\u00e9n podemos lanzar las excepciones sin necesidad de estar dentro de un try / catch . PHP 1 2 3 4 5 6 7 8 <?php class AppException extends Exception {} try { // C\u00f3digo de negocio que falla } catch ( Exception $e ) { throw new AppException ( \"AppException: \" . $e -> getMessage (), $e -> getCode (), $e ); } SPL Standard PHP Library es el conjunto de funciones y utilidades que ofrece PHP, como: Estructuras de datos: pila, cola, cola de prioridad, lista doblemente enlazada, etc... Conjunto de iteradores dise\u00f1ados para recorrer estructuras agregadas: arrays, resultados de bases de datos, \u00e1rboles XML, listados de directorios, etc. Pod\u00e9is consultar la documentaci\u00f3n en https://www.php.net/manual/es/book.spl.php o ver algunos ejemplos en https://diego.com.es/tutorial-de-la-libreria-spl-de-php Tambi\u00e9n define un conjunto de excepciones que podemos utilizar para que las lancen nuestras aplicaciones: LogicException (extends Exception) BadFunctionCallException BadMethodCallException DomainException InvalidArgumentException LengthException OutOfRangeException RuntimeException (extends Exception) OutOfBoundsException OverflowException RangeException UnderflowException UnexpectedValueException Tambi\u00e9n pod\u00e9is consultar la documentaci\u00f3n de estas excepciones en https://www.php.net/manual/es/spl.exceptions.php. referencias Manual de PHP Manual de OO en PHP - www.desarrolloweb.com videos Curso PHP 8 desde cero (Actulizado) :","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud03/ud03T/#duracion-y-criterios-de-evaluacion","text":"Duraci\u00f3n estimada : 18 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web identificando y aplicando mecanismos para separar el c\u00f3digo de presentaci\u00f3n de la l\u00f3gica de negocio. a) Se han identificado las ventajas de separar la l\u00f3gica de negocio de los aspectos de presentaci\u00f3n de la aplicaci\u00f3n. b) Se han analizado tecnolog\u00edas y mecanismos que permiten realizar esta separaci\u00f3n y sus caracter\u00edsticas principales. c) Se han utilizado objetos y controles en el servidor para generar el aspecto visual de la aplicaci\u00f3n web en el cliente. d) Se han utilizado formularios generados de forma din\u00e1mica para responder a los eventos de la aplicaci\u00f3n Web. e) Se han escrito aplicaciones Web con mantenimiento de estado y separaci\u00f3n de la l\u00f3gica de negocio. f) Se han aplicado los principios de la programaci\u00f3n orientada a objetos. g) Se ha probado y documentado el c\u00f3digo.","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud03/ud03T/#clases-y-objetos","text":"PHP sigue un paradigma de programaci\u00f3n orientada a objetos (POO) basada en clases. Una clase es una plantilla que define las atributos y m\u00e9todos para poder crear objetos. De este manera, un objeto es una instancia de una clase . Tanto los atributos como los m\u00e9todos se definen con una visibilidad (qui\u00e9n puede acceder): Privado - private : S\u00f3lo puede acceder la propia clase. Protegido - protected : S\u00f3lo puede acceder la propia clase o sus descendientes. P\u00fablico - public : Puede acceder cualquier otra clase. Para declarar una clase, se utiliza la palabra clave class seguido del nombre de la clase. Para instanciar un objeto a partir de la clase, se utiliza new : PHP 1 2 3 4 5 6 7 <?php class NombreClase { // atributos // y m\u00e9todos } $ob = new NombreClase (); clases con may\u00fascula : Todas las clases empiezan por letra may\u00fascula. Cuando un proyecto crece, es normal modelar las clases mediante UML (\u00bfrecord\u00e1is Entornos de Desarrollo ?). La clases se representan mediante un cuadrado, separando el nombre, de los atributos y los m\u00e9todos: Una vez que hemos creado un objeto, se utiliza el operador -> para acceder a un atributo o un m\u00e9todo del objeto: PHP 1 2 $objeto->atributo; $objeto->m\u00e9todo(par\u00e1metros); Si desde, dentro de la clase, queremos acceder a un atributo o m\u00e9todo de la misma clase, utilizaremos la referencia $this ; PHP 1 2 $this->atributo; $this->m\u00e9todo(par\u00e1metros); As\u00ed pues, como ejemplo, codificar\u00edamos una persona en el fichero Persona.php como: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php class Persona { private string $nombre ; public function setNombre ( string $nombre ) { $this -> nombre = $nombre ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona (); // creamos un objeto $bruno -> setNombre ( \"Bruno D\u00edaz\" ); $bruno -> imprimir (); Aunque se pueden declarar varias clases en el mismo archivo, es una mala pr\u00e1ctica. As\u00ed pues, cada fichero : contedr\u00e1 una sola clase , y se nombrar\u00e1 con el nombre de la clase .","title":"clases y objetos"},{"location":"ud03/ud03T/#encapsulacion","text":"Los atributos se definen privados o protegidos (si queremos que las clases heredadas puedan acceder). Para cada atributo, se a\u00f1aden m\u00e9todos p\u00fablicos ( getter / setter ): PHP 1 2 3 public function setAtributo (tipo $param); public function getAtributo () : tipo; Las constantes se definen p\u00fablicas para que sean accesibles por todos los recursos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 <?php class MayorMenor { private int $mayor ; private int $menor ; public function setMayor ( int $may ) { $this -> mayor = $may ; } public function setMenor ( int $men ) { $this -> menor = $men ; } public function getMayor () : int { return $this -> mayor ; } public function getMenor () : int { return $this -> menor ; } }","title":"encapsulaci\u00f3n"},{"location":"ud03/ud03T/#recibiendo-y-enviando-objetos","text":"Es recomendable indicarlo en el tipo de par\u00e1metros. Si el objeto puede devolver nulos se pone ? delante del nombre de la clase. objetos por referencia : Los objetos que se env\u00edan y reciben como par\u00e1metros siempre se pasan por referencia. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php function maymen ( array $numeros ) : ? MayorMenor { $a = max ( $numeros ); $b = min ( $numeros ); $result = new MayorMenor (); $result -> setMayor ( $a ); $result -> setMenor ( $b ); return $result ; } $resultado = maymen ( [ 1 , 76 , 9 , 388 , 41 , 39 , 25 , 97 , 22 ] ); echo \"<br>Mayor: \" . $resultado -> getMayor (); echo \"<br>Menor: \" . $resultado -> getMenor ();","title":"Recibiendo y enviando objetos"},{"location":"ud03/ud03T/#constructor","text":"El constructor de los objetos se define mediante el m\u00e9todo m\u00e1gico __construct . Puede o no tener par\u00e1metros, pero s\u00f3lo puede haber un \u00fanico constructor . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Persona { private string $nombre ; public function __construct ( string $nom ) { $this -> nombre = $nom ; } public function imprimir (){ echo $this -> nombre ; echo '<br>' ; } } $bruno = new Persona ( \"Bruno D\u00edaz\" ); $bruno -> imprimir ();","title":"constructor"},{"location":"ud03/ud03T/#constructores-en-php8","text":"Una de las grandes novedades que ofrece PHP 8 es la simplificaci\u00f3n de los constructores con par\u00e1metros, lo que se conoce como promoci\u00f3n de los atributos del constructor . Para ello, en vez de tener que declarar los atributos como privados o protegidos, y luego dentro del constructor tener que asignar los par\u00e1metros a estos atributos, el propio constructor promociona los atributos. Ve\u00e1moslo mejor con un ejemplo. Imaginemos una clase Punto donde queramos almacenar sus coordenadas. As\u00ed quedar\u00eda en PHP7 o anteriores: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Punto { protected float $x ; protected float $y ; protected float $z ; public function __construct ( float $x = 0.0 , float $y = 0.0 , float $z = 0.0 ) { $this -> x = $x ; $this -> y = $y ; $this -> z = $z ; } } En PHP8 , quedar\u00eda del siguiente modo (mucho m\u00e1s corto, lo que facilita su legibilidad): PHP 1 2 3 4 5 6 7 8 <?php class Punto { public function __construct ( protected float $x = 0.0 , protected float $y = 0.0 , protected float $z = 0.0 , ) {} } el orden importa: A la hora de codificar el orden de los elementos debe ser: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php declare ( strict_types = 1 ); class NombreClase { // atributos // constructor // getters - setters // resto de m\u00e9todos } ?>","title":"constructores en PHP8"},{"location":"ud03/ud03T/#clases-estaticas","text":"Son aquellas que tienen atributos ( o propiedades ) y/o m\u00e9todos est\u00e1ticos (tambi\u00e9n se conocen como de clase , porque su valor se comparte entre todas las instancias de la misma clase). Se declaran con static y se referencian con :: . Si queremos acceder a un m\u00e9todo est\u00e1tico , se antepone el nombre de la clase como sigue: Producto::nuevoProducto() . Si desde un m\u00e9todo queremos acceder a un atributo est\u00e1tico de la misma clase, se utiliza la referencia self como sigue: self::$numProductos . PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; public static function nuevoProducto () { self :: $numProductos ++ ; } } Producto :: nuevoProducto (); $impuesto = Producto :: IVA ; Tambi\u00e9n podemos tener clases normales que tengan algun atributo est\u00e1tico: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php class Producto { const IVA = 0.23 ; private static $numProductos = 0 ; private $codigo ; public function __construct ( string $cod ) { self :: $numProductos ++ ; $this -> codigo = $cod ; } public function mostrarResumen () : string { return \"El producto \" . $this -> codigo . \" es el n\u00famero \" . self :: $numProductos ; } } $prod1 = new Producto ( \"PS5\" ); $prod2 = new Producto ( \"XBOX Series X\" ); $prod3 = new Producto ( \"Nintendo Switch\" ); echo $prod3 -> mostrarResumen (); Bash 1 El producto Nintendo Switch es el n\u00famero 3","title":"clases est\u00e1ticas"},{"location":"ud03/ud03T/#introspeccion","text":"Al trabajar con clases y objetos, existen un conjunto de funciones ya definidas por el lenguaje que permiten obtener informaci\u00f3n sobre los objetos: instanceof : permite comprobar si un objeto es de una determinada clase. get_class : devuelve el nombre de la clase. get_declared_class : devuelve un array con los nombres de las clases definidas. class_alias : crea un alias. class_exists / method_exists / property_exists : devuelve true si la clase/m\u00e9todo/atributo est\u00e1 definida. get_class_methods / get_class_vars / get_object_vars : devuelve un array con los nombres de los m\u00e9todos/atributos de una clase / atributos de un objeto que son accesibles desde d\u00f3nde se hace la llamada. Un ejemplo de estas funciones puede ser el siguiente: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php $p = new Producto ( \"PS5\" ); if ( $p instanceof Producto ) { echo \"Es un producto.<br/>\" ; echo \"La clase es \" . get_class ( $p ) . \"<br/>\" ; class_alias ( \"Producto\" , \"Articulo\" ); $c = new Articulo ( \"Nintendo Switch\" ); echo \"Un articulo es un \" . get_class ( $c ) . \"<br/>\" ; print_r ( get_class_methods ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_class_vars ( \"Producto\" )); echo \"<br/>\" ; print_r ( get_object_vars ( $p )); echo \"<br/>\" ; if ( method_exists ( $p , \"mostrarResumen\" )) { echo $p -> mostrarResumen (); } } clonado : Al asignar dos objetos no se copian, se crea una nueva referencia. Si queremos una copia, hay que clonarlo mediante el m\u00e9todo clone(object) : object . PHP nos permite crear un m\u00e9todo que se llamar\u00e1 cuando ejecutemos el operador clone. Este m\u00e9todo puede entre otras cosas inicializar algunos atributos. Si no se define el m\u00e9todo __clone() se har\u00e1 una copia id\u00e9ntica del objeto que le pasamos como par\u00e1metro al operador clone. Veamos un ejemplo: Crearemos una clase Persona que tenga como atributos su nombre y edad, definiremos los m\u00e9todos para cargar y retornar los valores de sus atributos. Haremos que cuando clonemos un objeto de dicha clase la edad de la persona se fije con cero. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php class Persona { private $nombre ; private $edad ; public function fijarNombreEdad ( $nom , $ed ) { $this -> nombre = $nom ; $this -> edad = $ed ; } public function getNombre () { return $this -> nombre ; } public function getEdad () { return $this -> edad ; } public function __clone () { $this -> edad = 0 ; } } $persona1 = new Persona (); $persona1 -> fijarNombreEdad ( 'Juan' , 20 ); echo 'Datos de $persona1:' ; echo $persona1 -> retornarNombre () . ' - ' . $persona1 -> retornarEdad () . '<br>' ; $persona2 = clone ( $persona1 ); echo 'Datos de $persona2:' ; echo $persona2 -> retornarNombre () . ' - ' . $persona2 -> retornarEdad () . '<br>' ; ?> El m\u00e9todo __clone se ejecutar\u00e1 cuando llamemos al operador clone para esta clase: PHP 1 2 3 public function __clone() { $this->edad=0; } Es decir cuando realicemos la asignaci\u00f3n: PHP 1 $persona2 = clone($persona1); inicialmente se hace una copia id\u00e9ntica de $persona1 pero luego se ejecuta el m\u00e9todo __clone con lo que el atributo $edad se modifica. Si queremos que una clase no pueda clonarse simplemente podemos implementar el siguiente c\u00f3digo en el m\u00e9todo __clone(): PHP 1 2 3 public function __clone() { die('No esta permitido clonar objetos de esta clase'); } M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/language.oop5.cloning.php","title":"introspecci\u00f3n"},{"location":"ud03/ud03T/#herencia","text":"PHP soporta herencia simple, de manera que una clase solo puede heredar de otra clase , no de dos o m\u00e1s clases a la vez. Para ello se utiliza la palabra clave extends . Si queremos que la clase A hereda de la clase B haremos: PHP 1 class A extends B La clase hija hereda los atributos y m\u00e9todos p\u00fablicos y protegidos de la clase madre. cada clase en un archivo : Como ya hemos comentado, deber\u00edamos colocar cada clase en un archivo diferente para posteriormente utilizarlo mediante include . En los siguientes ejemplos los hemos colocado juntos para facilitar su legibilidad. Por ejemplo, tenemos una clase Producto y una Tv que hereda de Producto : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Producto { protected $codigo ; protected $nombre ; protected $nombreCorto ; protected $PVP ; public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { protected $pulgadas ; protected $tecnologia ; } Podemos utilizar las siguientes funciones para averiguar si hay relaci\u00f3n entre dos clases: get_parent_class(object): string is_subclass_of(object, string): bool PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php $t = new Tv (); $t -> codigo = 33 ; if ( $t instanceof Producto ) { echo $t -> mostrarResumen (); } $madre = get_parent_class ( $t ); echo \"<br>La clase madre es: \" . $madre ; $objetoMadre = new $madre ; echo $objetoMadre -> mostrarResumen (); if ( is_subclass_of ( $t , 'Producto' )) { echo \"<br>Soy una hija de Producto\" ; }","title":"herencia"},{"location":"ud03/ud03T/#sobreescribir-metodos","text":"Podemos crear m\u00e9todos en las clase hijas con el mismo nombre que la clase madre, cambiando su comportamiento. Para invocar a los m\u00e9todos de la clase madre: parent::nombreMetodo() . PHP 1 2 3 4 5 6 7 8 9 10 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } }","title":"sobreescribir m\u00e9todos"},{"location":"ud03/ud03T/#constructor-en-clases-hijas","text":"En cambio, si lo definimos en la clase hija, hemos de invocar al de la clase madre de manera expl\u00edcita. PHP 7 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 <?php class Producto { public string $codigo ; public function __construct ( string $codigo ) { $this -> codigo = $codigo ; } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function __construct ( string $codigo , int $pulgadas , string $tecnologia ) { parent :: __construct ( $codigo ); $this -> pulgadas = $pulgadas ; $this -> tecnologia = $tecnologia ; } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } PHP 8 : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php class Producto { public function __construct ( private string $codigo ) { } public function mostrarResumen () { echo \"<p>Prod:\" . $this -> codigo . \"</p>\" ; } } class Tv extends Producto { public function __construct ( string $codigo , private int $pulgadas , private string $tecnologia ) { parent :: __construct ( $codigo ); } public function mostrarResumen () { parent :: mostrarResumen (); echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } }","title":"constructor en clases hijas"},{"location":"ud03/ud03T/#clases-abstractas","text":"Las clases abstractas obligan a heredar de estas clases, ya que no se permite su instanciaci\u00f3n; s\u00ed se permite a las clases heredadas (siempre que no est\u00e9n tambi\u00e9n definidas como abstractas). Se define mediante abstract class NombreClase { . Una clase abstracta puede contener atributos y m\u00e9todos no-abstractos, y/o m\u00e9todos abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php // Clase abstracta abstract class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } // M\u00e9todo abstracto abstract public function mostrarResumen (); } Cuando una clase hereda de una clase abstracta, obligat\u00f3riamente debe implementar los m\u00e9todos que tiene la clase madre marcados como abstractos. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class Tv extends Producto { public $pulgadas ; public $tecnologia ; public function mostrarResumen () { //obligado a implementarlo echo \"<p>C\u00f3digo \" . $this -> getCodigo () . \"</p>\" ; echo \"<p>TV \" . $this -> tecnologia . \" de \" . $this -> pulgadas . \"</p>\" ; } } $t = new Tv (); echo $t -> getCodigo ();","title":"clases abstractas"},{"location":"ud03/ud03T/#clases-finales","text":"Son clases opuestas a abstractas, ya que evitan que se pueda heredar una clase o m\u00e9todo para sobreescribirlo. Se define mediante final class NombreClase { . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php class Producto { private $codigo ; public function getCodigo () : string { return $this -> codigo ; } final public function mostrarResumen () : string { return \"Producto \" . $this -> codigo ; } } // No podremos heredar de Microondas final class Microondas extends Producto { private $potencia ; public function getPotencia () : int { return $this -> potencia ; } // No podemos implementar mostrarResumen() }","title":"clases finales"},{"location":"ud03/ud03T/#interfaces","text":"Permite definir un contrato con las firmas de los m\u00e9todos a cumplir. As\u00ed pues, s\u00f3lo contiene declaraciones de funciones y todas deben ser p\u00fablicas. Se declaran con la palabra clave interface y luego las clases que cumplan el contrato lo realizan mediante la palabra clave implements . PHP 1 2 3 4 5 6 <?php interface Nombreable { // declaraci\u00f3n de funciones } class NombreClase implements NombreInterfaz { // c\u00f3digo de la clase Se permite la herencia de interfaces. Adem\u00e1s, una clase puede implementar varios interfaces (en este caso, s\u00ed soporta la herecia m\u00faltiple, pero s\u00f3lo de interfaces). PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php interface Mostrable { public function mostrarResumen () : string ; } interface MostrableTodo extends Mostrable { public function mostrarTodo () : string ; } interface Facturable { public function generarFactura () : string ; } class Producto implements MostrableTodo , Facturable { // Implementaciones de los m\u00e9todos // Obligatoriamente deber\u00e1 implementar: // - public function mostrarResumen, // - public function mostrarTodo y // - public function generarFactura }","title":"interfaces"},{"location":"ud03/ud03T/#metodos-encadenados","text":"Sigue el planteamiento de la programaci\u00f3n funcional, y tambi\u00e9n se conoce como method chaining . Plantea que sobre un objeto se realizan varias llamadas; o sea, consiste en llamar varios m\u00e9todos de un objeto en una misma l\u00ednea, basta con a\u00f1adir al final de cada m\u00e9todo: return $this; Con el siguiente ejemplo se entiende f\u00e1cilmente. Para facilitarlo, vamos a modificar todos sus m\u00e9todos mutadores (que modifican datos , setters , ...) para que devuelvan una referencia a $this : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Coche { public function lavar (){ echo \"Coche lavado. \\n \" ; return $this ; } public function encerar (){ echo \"Coche encerado. \\n \" ; return $this ; } } // ejemplo llamada a los m\u00e9todos encadenados $coche = new Coche ; $coche -> lavar () -> encerar (); Bash 1 2 3 // mostrar\u00e1 Coche lavado. Coche encerado. Otro ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php class Libro { private string $nombre ; private string $autor ; public function getNombre () : string { return $this -> nombre ; } public function setNombre ( string $nombre ) : Libro { $this -> nombre = $nombre ; return $this ; } public function getAutor () : string { return $this -> autor ; } public function setAutor ( string $autor ) : Libro { $this -> autor = $autor ; return $this ; } public function __toString () : string { return $this -> nombre . \" de \" . $this -> autor ; } }","title":"m\u00e9todos encadenados"},{"location":"ud03/ud03T/#metodos-magicos","text":"Todas las clases PHP ofrecen un conjunto de m\u00e9todos, tambi\u00e9n conocidos como magic methods que se pueden sobreescribir para sustituir su comportamiento. Algunos de ellos ya los hemos utilizado. Ante cualquier duda, es conveniente consultar la documentaci\u00f3n oficial . Los m\u00e1s destacables son: __construct() __destruct() \u2192 se invoca al perder la referencia. Se utiliza para cerrar una conexi\u00f3n a la BD, cerrar un fichero, ... __toString() \u2192 representaci\u00f3n del objeto como cadena. Es decir, cuando hacemos echo $objeto se ejecuta autom\u00e1ticamente este m\u00e9todo. get(atributo) , set(atributo, valor) \u2192 Permitir\u00eda acceder a los atributos privados, aunque siempre es m\u00e1s legible/mantenible codificar los getter/setter. __isset(atributo) , __unset(atributo) \u2192 Permite averiguar o quitar el valor a un atributo. sleep() , wakeup() \u2192 Se ejecutan al recuperar ( unserialize^ ) o almacenar un objeto que se serializa ( serialize ), y se utilizan para permite definir qu\u00e9 atributos se serializan. call() , callStatic() \u2192 Se ejecutan al llamar a un m\u00e9todo que no es p\u00fablico. Permiten sobrecargar m\u00e9todos.","title":"m\u00e9todos m\u00e1gicos"},{"location":"ud03/ud03T/#espacio-de-nombres","text":"Desde PHP 5.3 y tambi\u00e9n conocidos como Namespaces , permiten organizar las clases/interfaces, funciones y/o constantes (de forma similar a los paquetes en Java) en un \u00e1mbito restringido; evitando colisiones o conflictos de nombre con otros elementos que se pueden crear m\u00e1s adelante (o con algunas librer\u00edas que utilices). recomendaci\u00f3n : Un s\u00f3lo namespace por archivo y crear una estructura de carpetas respectando los niveles/subniveles (igual que se hace en Java). Se declaran en la primera l\u00ednea mediante la palabra clave namespace seguida del nombre del espacio de nombres asignado (cada subnivel se separa con la barra invertida \\ ): Por ejemplo, para colocar la clase Producto dentro del namespace Dwes\\Ejemplos lo har\u00edamos as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace Dwes\\Ejemplos ; const IVA = 0.21 ; class Producto { public $nombre ; public function muestra () : void { echo \"<p>Prod:\" . $this -> nombre . \"</p>\" ; } }","title":"espacio de nombres"},{"location":"ud03/ud03T/#acceso","text":"Para referenciar a un recurso que contiene un namespace, primero hemos de tenerlo disponible haciendo uso de include o require . Si el recurso est\u00e1 en el mismo namespace, se realiza un acceso directo (se conoce como acceso sin cualificar ). Realmente hay tres tipos de acceso: sin cualificar: recurso cualificado: rutaRelativa\\recurso \u2192 no hace falta poner el namespace completo. totalmente cualificado: \\rutaAbsoluta\\recurso PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php namespace Dwes\\Ejemplos ; include_once ( \"Producto.php\" ); // sin cualificar echo IVA ; // acceso cualificado. // Dar\u00eda error, no existe \\Dwes\\Ejemplos\\Utilidades\\IVA echo Utilidades\\IVA ; // totalmente cualificado echo \\Dwes\\Ejemplos\\IVA ; $p1 = new Producto (); // lo busca en el mismo namespace y // encuentra \\Dwes\\Ejemplos\\Producto $p2 = new Model\\Producto (); // dar\u00eda error, no existe el namespace Model. // Est\u00e1 buscando \\Dwes\\Ejemplos\\Model\\Producto $p3 = new \\Dwes\\Ejemplos\\Producto (); // \\Dwes\\Ejemplos\\Producto video","title":"acceso"},{"location":"ud03/ud03T/#use","text":"Para evitar la referencia cualificada podemos declarar el uso mediante use (similar a hacer import en Java). Se hace en la cabecera, tras el namespace: Los tipos posibles son: use const nombreCualificadoConstante use function nombreCualificadoFuncion use nombreCualificadoClase use nombreCualificadoClase as NuevoNombre // para renombrar elementos Por ejemplo, si queremos utilizar la clase \\Dwes\\Ejemplos\\Producto desde un recurso que se encuentra en la ra\u00edz, por ejemplo en inicio.php , har\u00edamos: PHP 1 2 3 4 5 6 7 8 <?php include_once ( \"Dwes\\Ejemplo\\Producto.php\" ); use const Dwes\\Ejemplos\\IVA ; use \\Dwes\\Ejemplos\\Producto ; echo IVA ; $p1 = new Producto (); to use or not to use En resumen, use permite acceder sin cualificar a recursos que est\u00e1n en otro namespace . Si estamos en el mismo espacio de nombre, no necesitamos use . video","title":"use"},{"location":"ud03/ud03T/#organizacion","text":"Todo proyecto, conforme crece, necesita organizar su c\u00f3digo fuente. Se plantea una organizaci\u00f3n en la que los archivos que interactuan con el navegador se colocan en el ra\u00edz, y las clases que definamos van dentro de un namespace (y dentro de su propia carpeta src o app). organizaci\u00f3n, includes y usos : Colocaremos cada recurso en un fichero aparte. En la primera l\u00ednea indicaremos su namespace (si no est\u00e1 en el ra\u00edz). Si utilizamos otros recursos, haremos un include_once de esos recursos (clases, interfaces, etc...). Cada recurso debe incluir todos los otros recursos que referencie: la clase de la que hereda, interfaces que implementa, clases utilizadas/recibidas como par\u00e1metros, etc... Si los recursos est\u00e1n en un espacio de nombres diferente al que estamos, emplearemos use con la ruta completa para luego utilizar referencias sin cualificar.","title":"organizaci\u00f3n"},{"location":"ud03/ud03T/#autoload","text":"\u00bfNo es tedioso tener que hacer el include de las clases? El autoload viene al rescate. As\u00ed pues, permite cargar las clases (no las constantes ni las funciones) que se van a utilizar y evitar tener que hacer el include_once de cada una de ellas. Para ello, se utiliza la funci\u00f3n spl_autoload_register . PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once $nombreClase . '.php' ; } ); ?> por qu\u00e9 se llama autoload : Porque antes se realizaba mediante el m\u00e9todo m\u00e1gico __autoload() , el cual est\u00e1 deprecated desde PHP 7.2. Y \u00bfc\u00f3mo organizamos ahora nuestro c\u00f3digo aprovechando el autoload? Para facilitar la b\u00fasqueda de los recursos a incluir, es recomendable colocar todas las clases dentro de una misma carpeta. Nosotros la vamos a colocar dentro de app (m\u00e1s adelante, cuando estudiemos Laravel veremos el motivo de esta decisi\u00f3n). Otras carpetas que podemos crear son test para colocar las pruebas PhpUnit que luego realizaremos, o la carpeta vendor donde se almacenar\u00e1n las librer\u00edas del proyecto (esta carpeta es un est\u00e1ndard dentro de PHP, ya que Composer la crea autom\u00e1ticamente). Como hemos colocado todos nuestros recursos dentro de app , ahora nuestro autoload.php (el cual colocamos en la carpeta ra\u00edz) s\u00f3lo va a buscar dentro de esa carpeta: PHP 1 2 3 4 5 <?php spl_autoload_register ( function ( $nombreClase ) { include_once \"app/\" . $nombreClase . '.php' ; } ); ?> autoload y rutas err\u00f3neas : En Ubuntu al hacer el include de la clase que recibe como par\u00e1metro, las barras de los namespace ( \\ ) son diferentes a las de las rutas ( / ). Por ello, es mejor que utilicemos el fichero autoload: PHP 1 2 3 4 5 6 7 <?php spl_autoload_register ( function ( $nombreClase ) { $ruta = \"app \\\\ \" . $nombreClase . '.php' ; $ruta = str_replace ( \" \\\\ \" , \"/\" , $ruta ); // Sustituimos las barras include_once $ruta ' ; } ); ?> video Aqu\u00ed encontramos un peque\u00f1o video en el que https://www.youtube.com/watch?v=lP1hbkNA2uc","title":"autoload"},{"location":"ud03/ud03T/#gestion-de-errores","text":"PHP clasifica los errores que ocurren en diferentes niveles. Cada nivel se identifica con una constante. Por ejemplo: E_ERROR : errores fatales, no recuperables. Se interrumpe el script. E_WARNING : advertencias en tiempo de ejecuci\u00f3n. El script no se interrumpe. E_NOTICE : avisos en tiempo de ejecuci\u00f3n. Pod\u00e9is comprobar el listado completo de constantes de https://www.php.net/manual/es/errorfunc.constants.php Para la configuraci\u00f3n de los errores podemos hacerlo de dos formas: A nivel de php.ini : error_reporting : indica los niveles de errores a notificar. rerror_reporting = E_ALL & ~E_NOTICE -> Todos los errores menos los avisos en tiempo de ejecuci\u00f3n. display_errors : indica si mostrar o no los errores por pantalla. En entornos de producci\u00f3n es com\u00fan ponerlo a off. mediante c\u00f3digo con las siguientes funciones: error_reporting(codigo) -> Controla qu\u00e9 errores notificar. set_error_handler(nombreManejador) -> Indica qu\u00e9 funci\u00f3n se invocar\u00e1 cada vez que se encuentre un error. El manejador recibe como par\u00e1metros el nivel del error y el mensaje. A continuaci\u00f3n tenemos un ejemplo mediante c\u00f3digo: Funciones para la gesti\u00f3n de errores : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php error_reporting ( E_ALL & ~ E_NOTICE & ~ E_WARNING ); $resultado = $dividendo / $divisor ; error_reporting ( E_ALL & ~ E_NOTICE ); set_error_handler ( \"miManejadorErrores\" ); $resultado = $dividendo / $divisor ; restore_error_handler (); // vuelve al anterior function miManejadorErrores ( $nivel , $mensaje ) { switch ( $nivel ) { case E_WARNING : echo \"<strong>Warning</strong>: $mensaje .<br/>\" ; break ; default : echo \"Error de tipo no especificado: $mensaje .<br/>\" ; } } Consola : Text Only 1 2 3 Error de tipo no especificado: Undefined variable: dividendo. Error de tipo no especificado: Undefined variable: divisor. Error de tipo Warning: Division by zero.","title":"gesti\u00f3n de errores"},{"location":"ud03/ud03T/#excepciones","text":"La gesti\u00f3n de excepciones forma parte desde PHP 5. Su funcionamiento es similar a Java, haciendo uso de un bloque try / catch / finally . Si detectamos una situaci\u00f3n an\u00f3mala y queremos lanzar una excepci\u00f3n, deberemos realizar throw new Exception (adjuntando el mensaje que lo ha provocado). PHP 1 2 3 4 5 6 7 8 9 <?php try { if ( $divisor == 0 ) { throw new Exception ( \"Divisi\u00f3n por cero.\" ); } $resultado = $dividendo / $divisor ; } catch ( Exception $e ) { echo \"Se ha producido el siguiente error: \" . $e -> getMessage (); } La clase Exception es la clase madre de todas las excepciones. Su constructor recibe mensaje [, codigoError][, excepcionPrevia] . A partir de un objeto Exception , podemos acceder a los m\u00e9todos getMessage() y getCode() para obtener el mensaje y el c\u00f3digo de error de la excepci\u00f3n capturada. El propio lenguaje ofrece un conjunto de excepciones ya definidas, las cuales podemos capturar (y lanzar desde PHP 7). Se recomienda su consulta en la documentaci\u00f3n oficial .","title":"excepciones"},{"location":"ud03/ud03T/#creando-excepciones","text":"Para crear una excepci\u00f3n, la forma m\u00e1s corta es crear una clase que \u00fanicamente herede de Exception . PHP 1 2 <?php class HolaExcepcion extends Exception {} Si queremos, y es recomendable dependiendo de los requisitos, podemos sobrecargar los m\u00e9todos m\u00e1gicos, por ejemplo, sobrecargando el constructor y llamando al constructor de la clase madre, o rescribir el m\u00e9todo __toString para cambiar su mensaje: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MiExcepcion extends Exception { public function __construct ( $msj , $codigo = 0 , Exception $previa = null ) { // c\u00f3digo propio parent :: __construct ( $msj , $codigo , $previa ); } public function __toString () { return __CLASS__ . \": [ { $this -> code } ]: { $this -> message } \\n \" ; } public function miFuncion () { echo \"Una funci\u00f3n personalizada para este tipo de excepci\u00f3n \\n \" ; } } Si definimos una excepci\u00f3n de aplicaci\u00f3n dentro de un namespace , cuando referenciemos a Exception , deberemos referenciarla mediante su nombre totalmente cualificado ( \\Exception ), o utilizando use : Mediante nombre totalmente cualificado PHP 1 2 3 4 <?php namespace \\Dwes\\Ejemplos ; class AppExcepcion extends \\Exception {} Mediante use PHP 1 2 3 4 5 6 <?php namespace \\Dwes\\Ejemplos ; use Exception ; class AppExcepcion extends Exception {}","title":"creando excepciones"},{"location":"ud03/ud03T/#excepciones-multiples","text":"Se pueden usar excepciones m\u00faltiples para comprobar diferentes condiciones. A la hora de capturarlas, se hace de m\u00e1s espec\u00edfica a m\u00e1s general. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php $email = \"ejemplo@ejemplo.com\" ; try { // Comprueba si el email es v\u00e1lido if ( filter_var ( $email , FILTER_VALIDATE_EMAIL ) === FALSE ) { throw new MiExcepcion ( $email ); } // Comprueba la palabra ejemplo en la direcci\u00f3n email if ( strpos ( $email , \"ejemplo\" ) !== FALSE ) { throw new Exception ( \" $email es un email de ejemplo no v\u00e1lido\" ); } } catch ( MiExcepcion $e ) { echo $e -> miFuncion (); } catch ( Exception $e ) { echo $e -> getMessage (); } autoevaluaci\u00f3n : \u00bfQu\u00e9 pasar\u00eda al ejecutar el siguiente c\u00f3digo? PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException $e ) { echo \"Capturada MainException \" . $e -> getMessage (); } catch ( SubException $e ) { echo \"Capturada SubException \" . $e -> getMessage (); } catch ( Exception $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Si en el mismo catch queremos capturar varias excepciones, hemos de utilizar el operador | : PHP 1 2 3 4 5 6 7 8 9 <?php class MainException extends Exception {} class SubException extends MainException {} try { throw new SubException ( \"Lanzada SubException\" ); } catch ( MainException | SubException $e ) { echo \"Capturada Exception \" . $e -> getMessage (); } Desde PHP 7, existe el tipo Throwable , el cual es un interfaz que implementan tanto los errores como las excepciones, y nos permite capturar los dos tipos a la vez: PHP 1 2 3 4 5 6 <?php try { // tu codigo } catch ( Throwable $e ) { echo 'Forma de capturar errores y excepciones a la vez' ; } Si s\u00f3lo queremos capturar los errores fatales, podemos hacer uso de la clase Error : PHP 1 2 3 4 5 6 7 8 9 <?php try { // Genera una notificaci\u00f3n que no se captura echo $variableNoAsignada ; // Error fatal que se captura funcionQueNoExiste (); } catch ( Error $e ) { echo \"Error capturado: \" . $e -> getMessage (); }","title":"excepciones m\u00faltiples"},{"location":"ud03/ud03T/#relanzar-excepciones","text":"En las aplicaciones reales, es muy com\u00fan capturar una excepci\u00f3n de sistema y lanzar una de aplicaci\u00f3n que hemos definido nosotros. Tambi\u00e9n podemos lanzar las excepciones sin necesidad de estar dentro de un try / catch . PHP 1 2 3 4 5 6 7 8 <?php class AppException extends Exception {} try { // C\u00f3digo de negocio que falla } catch ( Exception $e ) { throw new AppException ( \"AppException: \" . $e -> getMessage (), $e -> getCode (), $e ); }","title":"relanzar excepciones"},{"location":"ud03/ud03T/#spl","text":"Standard PHP Library es el conjunto de funciones y utilidades que ofrece PHP, como: Estructuras de datos: pila, cola, cola de prioridad, lista doblemente enlazada, etc... Conjunto de iteradores dise\u00f1ados para recorrer estructuras agregadas: arrays, resultados de bases de datos, \u00e1rboles XML, listados de directorios, etc. Pod\u00e9is consultar la documentaci\u00f3n en https://www.php.net/manual/es/book.spl.php o ver algunos ejemplos en https://diego.com.es/tutorial-de-la-libreria-spl-de-php Tambi\u00e9n define un conjunto de excepciones que podemos utilizar para que las lancen nuestras aplicaciones: LogicException (extends Exception) BadFunctionCallException BadMethodCallException DomainException InvalidArgumentException LengthException OutOfRangeException RuntimeException (extends Exception) OutOfBoundsException OverflowException RangeException UnderflowException UnexpectedValueException Tambi\u00e9n pod\u00e9is consultar la documentaci\u00f3n de estas excepciones en https://www.php.net/manual/es/spl.exceptions.php.","title":"SPL"},{"location":"ud03/ud03T/#referencias","text":"Manual de PHP Manual de OO en PHP - www.desarrolloweb.com videos Curso PHP 8 desde cero (Actulizado) :","title":"referencias"},{"location":"ud03/ud03ej/","text":"Text Only 1 2 3 4 5 6 7 8 9 10 11 unit: unidad did\u00e1ctica 3 title: Actividades language: ES author: Arturo Blasco subject: Desarrollo Web en Entornos Servidor keywords: [2023-2024, DWES, PHP] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${title} - ${subject} (ver: ${today}) footer:${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}/${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets \u00cdndice investigaci\u00f3n objetos proyecto Videoclub proyecto Videoclub 2.0 investigaci\u00f3n Actividad 301 Investiga la diferencia entre un paradigma orientado a objetos basado en clases ( PHP ) respecto a uno basado en prototipos ( JavaScript ). objetos Actividad 302 302Empleado.php : Crea una clase Empleado con su nombre , apellidos y sueldo . Encapsula las propiedades mediante getters / setters y a\u00f1ade m\u00e9todos para: Obtener su nombre completo \u2192 getNombreCompleto(): string Que devuelva un booleano indicando si debe o no pagar impuestos (se pagan cuando el sueldo es superior a 3333\u20ac) \u2192 debePagarImpuestos(): bool Actividad 303 303EmpleadoTelefonos.php : Copia la clase del ejercicio anterior y modif\u00edcala. A\u00f1ade una propiedad privada que almacene un array de n\u00fameros de tel\u00e9fonos. A\u00f1ade los siguientes m\u00e9todos: public function anyadirTelefono(int $telefono) : void \u2192 A\u00f1ade un tel\u00e9fono al array. public function listarTelefonos(): string \u2192 Muestra los tel\u00e9fonos separados por comas. public function vaciarTelefonos(): void \u2192 Elimina todos los tel\u00e9fonos. Actividad 304 304EmpleadoConstructor.php : Copia la clase del ejercicio anterior y modif\u00edcala. Elimina los setters de nombre y apellidos , de manera que dichos datos se asignan mediante el constructor (utiliza la sintaxis de PHP7). Si el constructor recibe un tercer par\u00e1metro, ser\u00e1 el sueldo del Empleado . Si no, se le asignar\u00e1 1000\u20ac como sueldo inicial. 304EmpleadoConstructor8.php : Modifica la clase y utiliza la sintaxis de PHP 8 de promoci\u00f3n de las propiedades del constructor. Actividad 305 305EmpleadoConstante.php : Copia la clase del ejercicio anterior y modif\u00edcala. A\u00f1ade una constante SUELDO_TOPE con el valor del sueldo que debe pagar impuestos, y modifica el c\u00f3digo para utilizar la constante. Actividad 306 306EmpleadoSueldo.php : Copia la clase del ejercicio anterior y modif\u00edcala. Cambia la constante por una variable est\u00e1tica sueldoTope , de manera que mediante getter/setter puedas modificar su valor. Actividad 307 307EmpleadoStatic.php : Copia la clase del ejercicio anterior y modif\u00edcala. Completa el siguiente m\u00e9todo con una cadena HTML que muestre los datos de un empleado dentro de un p\u00e1rrafo y todos los tel\u00e9fonos mediante una lista ordenada (para ello, deber\u00e1s crear un getter para los tel\u00e9fonos): public static function toHtml(Empleado $emp): string Actividad 308 308Persona.php : Copia la clase del ejercicio anterior en 308Empleado.php y modif\u00edcala. Crea una clase Persona que sea padre de Empleado , de manera que Persona contenga el nombre y los apellidos, y en Empleado quede el salario y los tel\u00e9fonos. Actividad 309 309PersonaH.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Crea en Persona el m\u00e9todo est\u00e1tico toHtml(Persona $p) , y modifica en Empleado el mismo m\u00e9todo toHtml(Persona $p) , pero cambia la firma para que reciba una Persona como par\u00e1metro. Para acceder a las propiedades del empleado con la persona que recibimos como par\u00e1metro, comprobaremos su tipo: PHP 1 2 3 4 5 6 7 8 9 10 11 <?php class Empleado extends Persona { /// resto del c\u00f3digo public static function toHtml ( Persona $p ) : string { if ( $p instanceof Empleado ) { // Aqui ya podemos acceder a las propiedades y m\u00e9todos de Empleado } } } Actividad 310 310PersonaE.php : Copia las clases del ejercicio anterior y modif\u00edcalas. A\u00f1ade en Persona un atributo edad . A la hora de saber si un empleado debe pagar impuestos, lo har\u00e1 siempre y cuando tenga m\u00e1s de 21 a\u00f1os y dependa del valor de su sueldo. Modifica todo el c\u00f3digo necesario para mostrar y/o editar la edad cuando sea necesario. Actividad 311 311PersonaS.php : Copia las clases del ejercicio anterior y modif\u00edcalas. A\u00f1ade nuevos m\u00e9todos que hagan una representaci\u00f3n de todas las propiedades de las clases Persona y Empleado , de forma similar a los realizados en HTML, pero sin que sean est\u00e1ticos, de manera que obtenga los datos mediante $this . function public __toString(): string magic methods El m\u00e9todo __toString() es un m\u00e9todo m\u00e1gico que se invoca autom\u00e1ticamente cuando queremos obtener la representaci\u00f3n en cadena de un objeto. Actividad 312 312PersonaA.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Transforma Persona a una clase abstracta donde su m\u00e9todo est\u00e1tico toHtml(Persona $p) tenga que ser redefinido en todos sus hijos. Actividad 313 313Trabajador.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Cambia la estructura de clases conforme al gr\u00e1fico respetando todos los m\u00e9todos que ya est\u00e1n hechos. Trabajador es una clase abstracta que ahora almacena los telefonos y donde calcularSueldo es un m\u00e9todo abstracto de manera que: El sueldo de un Empleado se calcula a partir de las horas trabajadas y lo que cobra por hora. Para los Gerente s, su sueldo se incrementa porcentualmente en base a su edad: salario + salario*edad/100 Actividad 314 314Empresa.php : Utilizando las clases de los ejercicios anteriores: Crea una clase Empresa que adem\u00e1s del nombre y la direcci\u00f3n, contenga una propiedad con un array de Trabajador es, ya sean Empleado s o Gerente s. A\u00f1ade getters/setters para el nombre y direcci\u00f3n. A\u00f1ade m\u00e9todos para a\u00f1adir y listar los trabajadores. public function anyadirTrabajador(Trabajador $t) public function listarTrabajadoresHtml() : string -> utiliza Trabajador::toHtml(Persona $p) A\u00f1ade un m\u00e9todo para obtener el coste total en n\u00f3minas. public function getCosteNominas(): float -> recorre los trabajadores e invoca al m\u00e9todo calcularSueldo() . Actividad 315 315EmpresaI.php : Copia las clases del ejercicio anterior y modif\u00edcalas. a) Crea un interfaz JSerializable, de manera que ofrezca los m\u00e9todos: toJSON(): string \u2192 utiliza la funci\u00f3n json_encode(mixed) . Ten en cuenta que como tenemos las propiedades de los objetos privados, debes recorrer las propiedades y colocarlas en un mapa. Por ejemplo: PHP 1 2 3 4 5 6 7 8 <?php public function toJSON () : string { foreach ( $this as $clave => $valor ) { $mapa -> $clave = $valor ; } return json_encode ( $mapa ); } ?> toSerialize(): string \u2192 utiliza la funci\u00f3n serialize(mixed) b) Modifica todas las clases que no son abstractas para que implementen el interfaz creado. proyecto Videoclub En los siguientes ejercicios vamos a simular un peque\u00f1o proyecto de un Videoclub (basado en la propuesta que hace el tutorial de desarrolloweb.com), el cual vamos a realizar mediante un desarrollo incremental y siguiendo la pr\u00e1ctica de programaci\u00f3n en parejas ( pair programming ). Antes de nada, crea un repositorio privado en GitHub y sube el proyecto actual de Videoclub. Una vez creado, invita a tu compa\u00f1ero al repositorio como colaborador. Inicializa en local tu repostorio de git, mediante git init . A\u00f1ade y sube los cambios a tu repositorio, mediante git add . y luego git commit -m 'Inicializando proyecto' . Conecta tu repositorio con GitHub y sube los cambios (mira la instrucciones de GitHub: comandos git remote y git push ). Tu compa\u00f1ero deber\u00e1 descargar el proyecto con sus credenciales. proyecto no real El siguiente proyecto est\u00e1 pensado desde un punto de vista formativo. Algunas de las decisiones que se toman no se deben usar (como hacer echo dentro de las clases) o probar el c\u00f3digo comparando el resultado en el navegador. Cada clase debe ir en un archivo php separado. Para facilitar su implementaci\u00f3n, se muestra la estructura UML del modelo y un fragmento de c\u00f3digo para probar las clases: Actividad 321 Crea una clase para almacenar soportes ( Soporte.php ). Esta clase ser\u00e1 la clase padre de los diferentes soportes con los que trabaje nuestro videoclub (cintas de v\u00eddeo, videojuegos, etc...): Crea el constructor que inicialice sus propiedades. F\u00edjate que la clase no tiene m\u00e9todos setters . Definir una constante mediante un propiedad privada y est\u00e1tica denominada IVA con un valor del 21% Crear un archivo ( inicio.php ) para usar las clases y copia el siguiente fragmento: PHP 1 2 3 4 5 6 7 8 9 <?php include ( \"Soporte.php\" ); $soporte1 = new Soporte ( \"Tenet\" , 22 , 3 ); echo \"<strong>\" . $soporte1 -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $soporte1 -> getPrecio () . \" \u20ac\" ; echo \"<br>Precio con IVA: \" . $soporte1 -> getPrecioConIVA () . \" \u20ac\" ; echo $soporte1 -> muestraResumen (); En el navegador: Bash 1 2 3 4 5 6 Tenet Precio: 3 \u20ac Precio con IVA: 3 .48 \u20ac Tenet 3 \u20ac ( IVA no incluido ) Actividad 322 Crea la clase CintaVideo la cual hereda de Soporte . A\u00f1ade el atributo duracion y sobreescribe tanto el contructor como el m\u00e9todo muestraResumen (desde CintaVideo deber\u00e1s llamar al m\u00e9todo muestraResumen del padre). A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: PHP 1 2 3 4 5 6 7 8 9 <?php include \"CintaVideo.php\" ; $miCinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); echo \"<strong>\" . $miCinta -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miCinta -> getPrecio () . \" \u20ac\" ; echo \"<br>Precio con IVA: \" . $miCinta -> getPrecioConIva () . \" \u20ac\" ; echo $miCinta -> muestraResumen (); En el navegador: Actividad 323 Crea la clase Dvd la cual hereda de Soporte . A\u00f1ade los atributos idiomas y formatoPantalla . A continuaci\u00f3n sobreescribe tanto el contructor como el m\u00e9todo muestraResumen . A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: PHP 1 2 3 4 5 6 7 8 9 <?php include \"Dvd.php\" ; $miDvd = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); echo \"<strong>\" . $miDvd -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miDvd -> getPrecio () . \" \u20ac\" ; echo \"<br>Precio con IVA: \" . $miDvd -> getPrecioConIva () . \" \u20ac\" ; echo $miDvd -> muestraResumen (); En el navegador: Actividad 324 Crea la clase Juego la cual hereda de Soporte . A\u00f1ade los atributos consola , minNumJugadores y maxNumJugadores . A continuaci\u00f3n a\u00f1ade el m\u00e9todo muestraJugadoresPosibles , el cual debe mostrar Para un jugador , Para X jugadores o De X a Y jugadores dependiendo de los valores de las atributos creados. Finalmente, sobreescribe tanto el contructor como el m\u00e9todo muestraResumen . A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: PHP 1 2 3 4 5 6 7 8 9 <?php include \"Juego.php\" ; $miJuego = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); echo \"<strong>\" . $miJuego -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miJuego -> getPrecio () . \" \u20ac\" ; echo \"<br>Precio con IVA: \" . $miJuego -> getPrecioConIva () . \" \u20ac\" ; echo $miJuego -> muestraResumen (); En el navegador: Llegados a este punto, nuestro modelo es similar al siguiente diagrama: Actividad 325 Crear la clase Cliente . El constructor recibir\u00e1 el nombre , numero y maxAlquilerConcurrente , este \u00faltimo pudiendo ser opcional y tomando como valor por defecto 3. Tras ello, a\u00f1ade getter/setter \u00fanicamente a numero , y un getter a numSoportesAlquilados (este campo va a almacenar un contador del total de alquileres que ha realizado). El array de soportes alquilados contedr\u00e1 clases que hereden de Soporte . Finalmente, a\u00f1ade el m\u00e9todo muestraResumen que muestre el nombre y la cantidad de alquileres (tama\u00f1o del array soportesAlquilados ). Actividad 326 Dentro de Cliente , a\u00f1ade las siguiente operaciones: tieneAlquilado(Soporte $s): bool \u2192 Recorre el array de soportes y comprueba si est\u00e1 el soporte alquilar(Soporte $s): bool -\u2192 Debe comprobar si el soporte est\u00e1 alquilado y si no ha superado el cupo de alquileres. Al alquilar, incrementar\u00e1 el numSoportesAlquilados y almacenar\u00e1 el soporte en el array. Para cada caso debe mostrar un mensaje informando de lo ocurrido. Actividad 327 Seguimos con Cliente para a\u00f1adir las operaciones: devolver(int $numSoporte): bool \u2192 Debe comprobar que el soporte estaba alquilado y actualizar la cantidad de soportes alquilados. Para cada caso debe mostrar un mensaje informando de lo ocurrido listarAlquileres(): void \u2192 Informa de cuantos alquileres tiene el cliente y los muestra. Crea el archivo inicio2.php con el siguiente c\u00f3digo fuente para probar la clase: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 <?php include_once \"CintaVideo.php\" ; include_once \"Dvd.php\" ; include_once \"Juego.php\" ; include_once \"Cliente.php\" ; //instanciamos un par de objetos cliente $cliente1 = new Cliente ( \"Bruce Wayne\" , 23 ); $cliente2 = new Cliente ( \"Clark Kent\" , 33 ); //mostramos el n\u00famero de cada cliente creado echo \"<br>El identificador del cliente 1 es: \" . $cliente1 -> getNumero (); echo \"<br>El identificador del cliente 2 es: \" . $cliente2 -> getNumero (); //instancio algunos soportes $soporte1 = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $soporte2 = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); $soporte3 = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); $soporte4 = new Dvd ( \"El Imperio Contraataca\" , 4 , 3 , \"es,en\" , \"16:9\" ); //alquilo algunos soportes $cliente1 -> alquilar ( $soporte1 ); $cliente1 -> alquilar ( $soporte2 ); $cliente1 -> alquilar ( $soporte3 ); //voy a intentar alquilar de nuevo un soporte que ya tiene alquilado $cliente1 -> alquilar ( $soporte1 ); //el cliente tiene 3 soportes en alquiler como m\u00e1ximo //este soporte no lo va a poder alquilar $cliente1 -> alquilar ( $soporte4 ); //este soporte no lo tiene alquilado $cliente1 -> devolver ( 4 ); //devuelvo un soporte que s\u00ed que tiene alquilado $cliente1 -> devolver ( 2 ); //alquilo otro soporte $cliente1 -> alquilar ( $soporte4 ); //listo los elementos alquilados $cliente1 -> listaAlquileres (); //este cliente no tiene alquileres $cliente2 -> devolver ( 2 ); En el navegador: Actividad 328 Llegado a este punto, vamos a relacionar los clientes y los soportes mediante la clase Videoclub . As\u00ed pues crea la clase que representa el gr\u00e1fico, teniendo en cuenta que: productos es un array de Soporte . socios es una array de Cliente . Los m\u00e9todos p\u00fablicos de incluir alg\u00fan soporte, crear\u00e1n la clase y llamar\u00e1n al m\u00e9todo privado de incluirProducto , el cual es el encargado de introducirlo dentro del array. El modelo completo quedar\u00e1 de la siguiente manera: Y para probar el proyecto, dentro inicio3.php colocaremos: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 <?php include_once \"Videoclub.php\" ; // No incluimos nada m\u00e1s $vc = new Videoclub ( \"Severo 8A\" ); //voy a incluir unos cuantos soportes de prueba $vc -> incluirJuego ( \"God of War\" , 19.99 , \"PS4\" , 1 , 1 ); $vc -> incluirJuego ( \"The Last of Us Part II\" , 49.99 , \"PS4\" , 1 , 1 ); $vc -> incluirDvd ( \"Torrente\" , 4.5 , \"es\" , \"16:9\" ); $vc -> incluirDvd ( \"Origen\" , 4.5 , \"es,en,fr\" , \"16:9\" ); $vc -> incluirDvd ( \"El Imperio Contraataca\" , 3 , \"es,en\" , \"16:9\" ); $vc -> incluirCintaVideo ( \"Los cazafantasmas\" , 3.5 , 107 ); $vc -> incluirCintaVideo ( \"El nombre de la Rosa\" , 1.5 , 140 ); //listo los productos $vc -> listarProductos (); //voy a crear algunos socios $vc -> incluirSocio ( \"Amancio Ortega\" ); $vc -> incluirSocio ( \"Pablo Picasso\" , 2 ); $vc -> alquilaSocioProducto ( 1 , 2 ); $vc -> alquilaSocioProducto ( 1 , 3 ); //alquilo otra vez el soporte 2 al socio 1. // no debe dejarme porque ya lo tiene alquilado $vc -> alquilaSocioProducto ( 1 , 2 ); //alquilo el soporte 6 al socio 1. //no se puede porque el socio 1 tiene 2 alquileres como m\u00e1ximo $vc -> alquilaSocioProducto ( 1 , 6 ); //listo los socios $vc -> listarSocios (); En el navegador: Actividad 329 Transforma Soporte a una clase abstracta y comprueba que todo sigue funcionando. \u00bfQu\u00e9 conseguimos al hacerla abstracta? Actividad 330 Crea un interfaz Resumible , de manera que las clases que lo implementen deben ofrecer el m\u00e9todo muestraResumen() . Modifica la clase Soporte y haz que implemente el interfaz. \u00bfHace falta que tambi\u00e9n lo implementen los hijos? proyecto Videoclub 2.0 Antes de comenzar con la segunda parte del videoclub, crea una etiqueta mediante git tag con el nombre v0.329 y sube los cambios a GitHub. Actividad 331 Modifica las operaciones de alquilar, tanto en Cliente como en Videoclub , para dar soporte al encadenamiento de m\u00e9todos. Posteriormente, modifica el c\u00f3digo de prueba para utilizar esta t\u00e9cnica. Actividad 332 Haciendo uso de namespaces : Coloca todas las clases/interfaces en Dwes\\ProyectoVideoclub . Cada clase debe hacer include_once de los recursos que emplea. Coloca el/los archivos de prueba en el ra\u00edz (sin espacio de nombres). Desde el archivo de pruebas, utiliza use para poder realizar accesos sin cualificar. Etiqueta los cambios como v0.331 . Actividad 333 Reorganiza las carpeta tal como hemos visto en los apuntes: app , test y vendor . Crea un fichero autoload.php para registrar la ruta donde encontrar las clases Modifica todo el c\u00f3digo necesario, incluyendo autoload.php donde sea necesario y borrando los includes previos. Actividad 334 A continuaci\u00f3n vamos a crear un conjunto de excepciones de aplicaci\u00f3n. Estas excepciones son simples, no necesitan sobreescribir ning\u00fan m\u00e9todo. As\u00ed pues, crea la excepci\u00f3n de aplicaci\u00f3n VideoclubException en el namespace Dwes\\ProyectoVideoclub\\Util . Posteriormente crea los siguientes hijos (deben heredar de VideoclubException ), cada uno en su propio archivo: SoporteYaAlquiladoException . CupoSuperadoException . SoporteNoEncontradoException . ClienteNoEncontradoException . Actividad 335 En Cliente , modifica los m\u00e9todos alquilar y devolver , para que hagan uso de las nuevas excepciones (lanz\u00e1ndolas cuando sea necesario) y funcionen como m\u00e9todos encadenados. Destacar que estos m\u00e9todos, no se capturar est\u00e1s excepciones, s\u00f3lo se lanzan. En Videoclub , modifica alquilarSocioPelicula para capturar todas las excepciones que ahora lanza Cliente e informar al usuario en consecuencia. Actividad 336 Vamos a modificar el proyecto para que el videoclub sepa qu\u00e9 productos est\u00e1n o no alquilados: En Soporte , crea una propiedad p\u00fablica cuyo nombre sea alquilado que inicialmente estar\u00e1 a false . Cuando se alquile, se pondr\u00e1 a true . Al devolver, la volveremos a poner a false . En Videoclub , crea dos nuevas propiedades y sus getters: numProductosAlquilados numTotalAlquileres Actividad 337 Crea un nuevo m\u00e9todo en Videoclub llamado alquilarSocioProductos(int numSocio, array numerosProductos) , el cual debe recibir un array con los productos a alquilar. Antes de alquilarlos, debe comprobar que todos los soportes est\u00e9n disponibles, de manera que si uno no lo est\u00e1, no se le alquile ninguno. Actividad 338 Crea dos nuevos m\u00e9todos en Videoclub , y mediante la definici\u00f3n, deduce qu\u00e9 deben realizar: devolverSocioProducto(int numSocio, int numeroProducto) devolverSocioProductos(int numSocio, array numerosProductos) Deben soportar el encadenamiento de m\u00e9todos. Recuerda actualizar la propiedad alquilado de los diferentes soportes. Cuando hayas realizado todos los ejercicios, crea una etiqueta mediante git tag con el nombre v0.337 y sube los cambios a GitHub.","title":"Ud03ej"},{"location":"ud03/ud03ej/#investigacion","text":"Actividad 301 Investiga la diferencia entre un paradigma orientado a objetos basado en clases ( PHP ) respecto a uno basado en prototipos ( JavaScript ).","title":"investigaci\u00f3n"},{"location":"ud03/ud03ej/#objetos","text":"Actividad 302 302Empleado.php : Crea una clase Empleado con su nombre , apellidos y sueldo . Encapsula las propiedades mediante getters / setters y a\u00f1ade m\u00e9todos para: Obtener su nombre completo \u2192 getNombreCompleto(): string Que devuelva un booleano indicando si debe o no pagar impuestos (se pagan cuando el sueldo es superior a 3333\u20ac) \u2192 debePagarImpuestos(): bool Actividad 303 303EmpleadoTelefonos.php : Copia la clase del ejercicio anterior y modif\u00edcala. A\u00f1ade una propiedad privada que almacene un array de n\u00fameros de tel\u00e9fonos. A\u00f1ade los siguientes m\u00e9todos: public function anyadirTelefono(int $telefono) : void \u2192 A\u00f1ade un tel\u00e9fono al array. public function listarTelefonos(): string \u2192 Muestra los tel\u00e9fonos separados por comas. public function vaciarTelefonos(): void \u2192 Elimina todos los tel\u00e9fonos. Actividad 304 304EmpleadoConstructor.php : Copia la clase del ejercicio anterior y modif\u00edcala. Elimina los setters de nombre y apellidos , de manera que dichos datos se asignan mediante el constructor (utiliza la sintaxis de PHP7). Si el constructor recibe un tercer par\u00e1metro, ser\u00e1 el sueldo del Empleado . Si no, se le asignar\u00e1 1000\u20ac como sueldo inicial. 304EmpleadoConstructor8.php : Modifica la clase y utiliza la sintaxis de PHP 8 de promoci\u00f3n de las propiedades del constructor. Actividad 305 305EmpleadoConstante.php : Copia la clase del ejercicio anterior y modif\u00edcala. A\u00f1ade una constante SUELDO_TOPE con el valor del sueldo que debe pagar impuestos, y modifica el c\u00f3digo para utilizar la constante. Actividad 306 306EmpleadoSueldo.php : Copia la clase del ejercicio anterior y modif\u00edcala. Cambia la constante por una variable est\u00e1tica sueldoTope , de manera que mediante getter/setter puedas modificar su valor. Actividad 307 307EmpleadoStatic.php : Copia la clase del ejercicio anterior y modif\u00edcala. Completa el siguiente m\u00e9todo con una cadena HTML que muestre los datos de un empleado dentro de un p\u00e1rrafo y todos los tel\u00e9fonos mediante una lista ordenada (para ello, deber\u00e1s crear un getter para los tel\u00e9fonos): public static function toHtml(Empleado $emp): string Actividad 308 308Persona.php : Copia la clase del ejercicio anterior en 308Empleado.php y modif\u00edcala. Crea una clase Persona que sea padre de Empleado , de manera que Persona contenga el nombre y los apellidos, y en Empleado quede el salario y los tel\u00e9fonos. Actividad 309 309PersonaH.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Crea en Persona el m\u00e9todo est\u00e1tico toHtml(Persona $p) , y modifica en Empleado el mismo m\u00e9todo toHtml(Persona $p) , pero cambia la firma para que reciba una Persona como par\u00e1metro. Para acceder a las propiedades del empleado con la persona que recibimos como par\u00e1metro, comprobaremos su tipo: PHP 1 2 3 4 5 6 7 8 9 10 11 <?php class Empleado extends Persona { /// resto del c\u00f3digo public static function toHtml ( Persona $p ) : string { if ( $p instanceof Empleado ) { // Aqui ya podemos acceder a las propiedades y m\u00e9todos de Empleado } } } Actividad 310 310PersonaE.php : Copia las clases del ejercicio anterior y modif\u00edcalas. A\u00f1ade en Persona un atributo edad . A la hora de saber si un empleado debe pagar impuestos, lo har\u00e1 siempre y cuando tenga m\u00e1s de 21 a\u00f1os y dependa del valor de su sueldo. Modifica todo el c\u00f3digo necesario para mostrar y/o editar la edad cuando sea necesario. Actividad 311 311PersonaS.php : Copia las clases del ejercicio anterior y modif\u00edcalas. A\u00f1ade nuevos m\u00e9todos que hagan una representaci\u00f3n de todas las propiedades de las clases Persona y Empleado , de forma similar a los realizados en HTML, pero sin que sean est\u00e1ticos, de manera que obtenga los datos mediante $this . function public __toString(): string magic methods El m\u00e9todo __toString() es un m\u00e9todo m\u00e1gico que se invoca autom\u00e1ticamente cuando queremos obtener la representaci\u00f3n en cadena de un objeto. Actividad 312 312PersonaA.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Transforma Persona a una clase abstracta donde su m\u00e9todo est\u00e1tico toHtml(Persona $p) tenga que ser redefinido en todos sus hijos. Actividad 313 313Trabajador.php : Copia las clases del ejercicio anterior y modif\u00edcalas. Cambia la estructura de clases conforme al gr\u00e1fico respetando todos los m\u00e9todos que ya est\u00e1n hechos. Trabajador es una clase abstracta que ahora almacena los telefonos y donde calcularSueldo es un m\u00e9todo abstracto de manera que: El sueldo de un Empleado se calcula a partir de las horas trabajadas y lo que cobra por hora. Para los Gerente s, su sueldo se incrementa porcentualmente en base a su edad: salario + salario*edad/100 Actividad 314 314Empresa.php : Utilizando las clases de los ejercicios anteriores: Crea una clase Empresa que adem\u00e1s del nombre y la direcci\u00f3n, contenga una propiedad con un array de Trabajador es, ya sean Empleado s o Gerente s. A\u00f1ade getters/setters para el nombre y direcci\u00f3n. A\u00f1ade m\u00e9todos para a\u00f1adir y listar los trabajadores. public function anyadirTrabajador(Trabajador $t) public function listarTrabajadoresHtml() : string -> utiliza Trabajador::toHtml(Persona $p) A\u00f1ade un m\u00e9todo para obtener el coste total en n\u00f3minas. public function getCosteNominas(): float -> recorre los trabajadores e invoca al m\u00e9todo calcularSueldo() . Actividad 315 315EmpresaI.php : Copia las clases del ejercicio anterior y modif\u00edcalas. a) Crea un interfaz JSerializable, de manera que ofrezca los m\u00e9todos: toJSON(): string \u2192 utiliza la funci\u00f3n json_encode(mixed) . Ten en cuenta que como tenemos las propiedades de los objetos privados, debes recorrer las propiedades y colocarlas en un mapa. Por ejemplo: PHP 1 2 3 4 5 6 7 8 <?php public function toJSON () : string { foreach ( $this as $clave => $valor ) { $mapa -> $clave = $valor ; } return json_encode ( $mapa ); } ?> toSerialize(): string \u2192 utiliza la funci\u00f3n serialize(mixed) b) Modifica todas las clases que no son abstractas para que implementen el interfaz creado.","title":"objetos"},{"location":"ud03/ud03ej/#proyecto-videoclub","text":"En los siguientes ejercicios vamos a simular un peque\u00f1o proyecto de un Videoclub (basado en la propuesta que hace el tutorial de desarrolloweb.com), el cual vamos a realizar mediante un desarrollo incremental y siguiendo la pr\u00e1ctica de programaci\u00f3n en parejas ( pair programming ). Antes de nada, crea un repositorio privado en GitHub y sube el proyecto actual de Videoclub. Una vez creado, invita a tu compa\u00f1ero al repositorio como colaborador. Inicializa en local tu repostorio de git, mediante git init . A\u00f1ade y sube los cambios a tu repositorio, mediante git add . y luego git commit -m 'Inicializando proyecto' . Conecta tu repositorio con GitHub y sube los cambios (mira la instrucciones de GitHub: comandos git remote y git push ). Tu compa\u00f1ero deber\u00e1 descargar el proyecto con sus credenciales. proyecto no real El siguiente proyecto est\u00e1 pensado desde un punto de vista formativo. Algunas de las decisiones que se toman no se deben usar (como hacer echo dentro de las clases) o probar el c\u00f3digo comparando el resultado en el navegador. Cada clase debe ir en un archivo php separado. Para facilitar su implementaci\u00f3n, se muestra la estructura UML del modelo y un fragmento de c\u00f3digo para probar las clases: Actividad 321 Crea una clase para almacenar soportes ( Soporte.php ). Esta clase ser\u00e1 la clase padre de los diferentes soportes con los que trabaje nuestro videoclub (cintas de v\u00eddeo, videojuegos, etc...): Crea el constructor que inicialice sus propiedades. F\u00edjate que la clase no tiene m\u00e9todos setters . Definir una constante mediante un propiedad privada y est\u00e1tica denominada IVA con un valor del 21% Crear un archivo ( inicio.php ) para usar las clases y copia el siguiente fragmento: PHP 1 2 3 4 5 6 7 8 9 <?php include ( \"Soporte.php\" ); $soporte1 = new Soporte ( \"Tenet\" , 22 , 3 ); echo \"<strong>\" . $soporte1 -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $soporte1 -> getPrecio () . \" \u20ac\" ; echo \"<br>Precio con IVA: \" . $soporte1 -> getPrecioConIVA () . \" \u20ac\" ; echo $soporte1 -> muestraResumen (); En el navegador: Bash 1 2 3 4 5 6 Tenet Precio: 3 \u20ac Precio con IVA: 3 .48 \u20ac Tenet 3 \u20ac ( IVA no incluido ) Actividad 322 Crea la clase CintaVideo la cual hereda de Soporte . A\u00f1ade el atributo duracion y sobreescribe tanto el contructor como el m\u00e9todo muestraResumen (desde CintaVideo deber\u00e1s llamar al m\u00e9todo muestraResumen del padre). A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: PHP 1 2 3 4 5 6 7 8 9 <?php include \"CintaVideo.php\" ; $miCinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); echo \"<strong>\" . $miCinta -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miCinta -> getPrecio () . \" \u20ac\" ; echo \"<br>Precio con IVA: \" . $miCinta -> getPrecioConIva () . \" \u20ac\" ; echo $miCinta -> muestraResumen (); En el navegador: Actividad 323 Crea la clase Dvd la cual hereda de Soporte . A\u00f1ade los atributos idiomas y formatoPantalla . A continuaci\u00f3n sobreescribe tanto el contructor como el m\u00e9todo muestraResumen . A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: PHP 1 2 3 4 5 6 7 8 9 <?php include \"Dvd.php\" ; $miDvd = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); echo \"<strong>\" . $miDvd -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miDvd -> getPrecio () . \" \u20ac\" ; echo \"<br>Precio con IVA: \" . $miDvd -> getPrecioConIva () . \" \u20ac\" ; echo $miDvd -> muestraResumen (); En el navegador: Actividad 324 Crea la clase Juego la cual hereda de Soporte . A\u00f1ade los atributos consola , minNumJugadores y maxNumJugadores . A continuaci\u00f3n a\u00f1ade el m\u00e9todo muestraJugadoresPosibles , el cual debe mostrar Para un jugador , Para X jugadores o De X a Y jugadores dependiendo de los valores de las atributos creados. Finalmente, sobreescribe tanto el contructor como el m\u00e9todo muestraResumen . A\u00f1ade a inicio.php el c\u00f3digo para probar la clase: PHP 1 2 3 4 5 6 7 8 9 <?php include \"Juego.php\" ; $miJuego = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); echo \"<strong>\" . $miJuego -> titulo . \"</strong>\" ; echo \"<br>Precio: \" . $miJuego -> getPrecio () . \" \u20ac\" ; echo \"<br>Precio con IVA: \" . $miJuego -> getPrecioConIva () . \" \u20ac\" ; echo $miJuego -> muestraResumen (); En el navegador: Llegados a este punto, nuestro modelo es similar al siguiente diagrama: Actividad 325 Crear la clase Cliente . El constructor recibir\u00e1 el nombre , numero y maxAlquilerConcurrente , este \u00faltimo pudiendo ser opcional y tomando como valor por defecto 3. Tras ello, a\u00f1ade getter/setter \u00fanicamente a numero , y un getter a numSoportesAlquilados (este campo va a almacenar un contador del total de alquileres que ha realizado). El array de soportes alquilados contedr\u00e1 clases que hereden de Soporte . Finalmente, a\u00f1ade el m\u00e9todo muestraResumen que muestre el nombre y la cantidad de alquileres (tama\u00f1o del array soportesAlquilados ). Actividad 326 Dentro de Cliente , a\u00f1ade las siguiente operaciones: tieneAlquilado(Soporte $s): bool \u2192 Recorre el array de soportes y comprueba si est\u00e1 el soporte alquilar(Soporte $s): bool -\u2192 Debe comprobar si el soporte est\u00e1 alquilado y si no ha superado el cupo de alquileres. Al alquilar, incrementar\u00e1 el numSoportesAlquilados y almacenar\u00e1 el soporte en el array. Para cada caso debe mostrar un mensaje informando de lo ocurrido. Actividad 327 Seguimos con Cliente para a\u00f1adir las operaciones: devolver(int $numSoporte): bool \u2192 Debe comprobar que el soporte estaba alquilado y actualizar la cantidad de soportes alquilados. Para cada caso debe mostrar un mensaje informando de lo ocurrido listarAlquileres(): void \u2192 Informa de cuantos alquileres tiene el cliente y los muestra. Crea el archivo inicio2.php con el siguiente c\u00f3digo fuente para probar la clase: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 <?php include_once \"CintaVideo.php\" ; include_once \"Dvd.php\" ; include_once \"Juego.php\" ; include_once \"Cliente.php\" ; //instanciamos un par de objetos cliente $cliente1 = new Cliente ( \"Bruce Wayne\" , 23 ); $cliente2 = new Cliente ( \"Clark Kent\" , 33 ); //mostramos el n\u00famero de cada cliente creado echo \"<br>El identificador del cliente 1 es: \" . $cliente1 -> getNumero (); echo \"<br>El identificador del cliente 2 es: \" . $cliente2 -> getNumero (); //instancio algunos soportes $soporte1 = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $soporte2 = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); $soporte3 = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); $soporte4 = new Dvd ( \"El Imperio Contraataca\" , 4 , 3 , \"es,en\" , \"16:9\" ); //alquilo algunos soportes $cliente1 -> alquilar ( $soporte1 ); $cliente1 -> alquilar ( $soporte2 ); $cliente1 -> alquilar ( $soporte3 ); //voy a intentar alquilar de nuevo un soporte que ya tiene alquilado $cliente1 -> alquilar ( $soporte1 ); //el cliente tiene 3 soportes en alquiler como m\u00e1ximo //este soporte no lo va a poder alquilar $cliente1 -> alquilar ( $soporte4 ); //este soporte no lo tiene alquilado $cliente1 -> devolver ( 4 ); //devuelvo un soporte que s\u00ed que tiene alquilado $cliente1 -> devolver ( 2 ); //alquilo otro soporte $cliente1 -> alquilar ( $soporte4 ); //listo los elementos alquilados $cliente1 -> listaAlquileres (); //este cliente no tiene alquileres $cliente2 -> devolver ( 2 ); En el navegador: Actividad 328 Llegado a este punto, vamos a relacionar los clientes y los soportes mediante la clase Videoclub . As\u00ed pues crea la clase que representa el gr\u00e1fico, teniendo en cuenta que: productos es un array de Soporte . socios es una array de Cliente . Los m\u00e9todos p\u00fablicos de incluir alg\u00fan soporte, crear\u00e1n la clase y llamar\u00e1n al m\u00e9todo privado de incluirProducto , el cual es el encargado de introducirlo dentro del array. El modelo completo quedar\u00e1 de la siguiente manera: Y para probar el proyecto, dentro inicio3.php colocaremos: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 <?php include_once \"Videoclub.php\" ; // No incluimos nada m\u00e1s $vc = new Videoclub ( \"Severo 8A\" ); //voy a incluir unos cuantos soportes de prueba $vc -> incluirJuego ( \"God of War\" , 19.99 , \"PS4\" , 1 , 1 ); $vc -> incluirJuego ( \"The Last of Us Part II\" , 49.99 , \"PS4\" , 1 , 1 ); $vc -> incluirDvd ( \"Torrente\" , 4.5 , \"es\" , \"16:9\" ); $vc -> incluirDvd ( \"Origen\" , 4.5 , \"es,en,fr\" , \"16:9\" ); $vc -> incluirDvd ( \"El Imperio Contraataca\" , 3 , \"es,en\" , \"16:9\" ); $vc -> incluirCintaVideo ( \"Los cazafantasmas\" , 3.5 , 107 ); $vc -> incluirCintaVideo ( \"El nombre de la Rosa\" , 1.5 , 140 ); //listo los productos $vc -> listarProductos (); //voy a crear algunos socios $vc -> incluirSocio ( \"Amancio Ortega\" ); $vc -> incluirSocio ( \"Pablo Picasso\" , 2 ); $vc -> alquilaSocioProducto ( 1 , 2 ); $vc -> alquilaSocioProducto ( 1 , 3 ); //alquilo otra vez el soporte 2 al socio 1. // no debe dejarme porque ya lo tiene alquilado $vc -> alquilaSocioProducto ( 1 , 2 ); //alquilo el soporte 6 al socio 1. //no se puede porque el socio 1 tiene 2 alquileres como m\u00e1ximo $vc -> alquilaSocioProducto ( 1 , 6 ); //listo los socios $vc -> listarSocios (); En el navegador: Actividad 329 Transforma Soporte a una clase abstracta y comprueba que todo sigue funcionando. \u00bfQu\u00e9 conseguimos al hacerla abstracta? Actividad 330 Crea un interfaz Resumible , de manera que las clases que lo implementen deben ofrecer el m\u00e9todo muestraResumen() . Modifica la clase Soporte y haz que implemente el interfaz. \u00bfHace falta que tambi\u00e9n lo implementen los hijos?","title":"proyecto Videoclub"},{"location":"ud03/ud03ej/#proyecto-videoclub-20","text":"Antes de comenzar con la segunda parte del videoclub, crea una etiqueta mediante git tag con el nombre v0.329 y sube los cambios a GitHub. Actividad 331 Modifica las operaciones de alquilar, tanto en Cliente como en Videoclub , para dar soporte al encadenamiento de m\u00e9todos. Posteriormente, modifica el c\u00f3digo de prueba para utilizar esta t\u00e9cnica. Actividad 332 Haciendo uso de namespaces : Coloca todas las clases/interfaces en Dwes\\ProyectoVideoclub . Cada clase debe hacer include_once de los recursos que emplea. Coloca el/los archivos de prueba en el ra\u00edz (sin espacio de nombres). Desde el archivo de pruebas, utiliza use para poder realizar accesos sin cualificar. Etiqueta los cambios como v0.331 . Actividad 333 Reorganiza las carpeta tal como hemos visto en los apuntes: app , test y vendor . Crea un fichero autoload.php para registrar la ruta donde encontrar las clases Modifica todo el c\u00f3digo necesario, incluyendo autoload.php donde sea necesario y borrando los includes previos. Actividad 334 A continuaci\u00f3n vamos a crear un conjunto de excepciones de aplicaci\u00f3n. Estas excepciones son simples, no necesitan sobreescribir ning\u00fan m\u00e9todo. As\u00ed pues, crea la excepci\u00f3n de aplicaci\u00f3n VideoclubException en el namespace Dwes\\ProyectoVideoclub\\Util . Posteriormente crea los siguientes hijos (deben heredar de VideoclubException ), cada uno en su propio archivo: SoporteYaAlquiladoException . CupoSuperadoException . SoporteNoEncontradoException . ClienteNoEncontradoException . Actividad 335 En Cliente , modifica los m\u00e9todos alquilar y devolver , para que hagan uso de las nuevas excepciones (lanz\u00e1ndolas cuando sea necesario) y funcionen como m\u00e9todos encadenados. Destacar que estos m\u00e9todos, no se capturar est\u00e1s excepciones, s\u00f3lo se lanzan. En Videoclub , modifica alquilarSocioPelicula para capturar todas las excepciones que ahora lanza Cliente e informar al usuario en consecuencia. Actividad 336 Vamos a modificar el proyecto para que el videoclub sepa qu\u00e9 productos est\u00e1n o no alquilados: En Soporte , crea una propiedad p\u00fablica cuyo nombre sea alquilado que inicialmente estar\u00e1 a false . Cuando se alquile, se pondr\u00e1 a true . Al devolver, la volveremos a poner a false . En Videoclub , crea dos nuevas propiedades y sus getters: numProductosAlquilados numTotalAlquileres Actividad 337 Crea un nuevo m\u00e9todo en Videoclub llamado alquilarSocioProductos(int numSocio, array numerosProductos) , el cual debe recibir un array con los productos a alquilar. Antes de alquilarlos, debe comprobar que todos los soportes est\u00e9n disponibles, de manera que si uno no lo est\u00e1, no se le alquile ninguno. Actividad 338 Crea dos nuevos m\u00e9todos en Videoclub , y mediante la definici\u00f3n, deduce qu\u00e9 deben realizar: devolverSocioProducto(int numSocio, int numeroProducto) devolverSocioProductos(int numSocio, array numerosProductos) Deben soportar el encadenamiento de m\u00e9todos. Recuerda actualizar la propiedad alquilado de los diferentes soportes. Cuando hayas realizado todos los ejercicios, crea una etiqueta mediante git tag con el nombre v0.337 y sube los cambios a GitHub.","title":"proyecto Videoclub 2.0"},{"location":"ud04/ud04_ProgramacionWeb/","text":"Text Only 1 2 3 4 5 6 7 8 9 10 11 unit: unidad did\u00e1ctica 4 title: Programaci\u00f3n Web language: ES author: Arturo Blasco subject: Desarrollo Web en Entornos Servidor keywords: [2023, DWES, PHP] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${title} - ${subject} (ver: ${today}) footer:${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}/${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets \u00cdndice duraci\u00f3n y criterios de evaluaci\u00f3n variables de servidor formularios validaci\u00f3n par\u00e1metros multivalor volviendo a rellenar un formulario subiendo archivos filtrado con php de tipos de ficheros subidos con html escritura de im\u00e1genes en carpeta del servidor seguridad de escritura de imagenes en carpeta del servidor extra 1: mostrar imagenes subidas con html extra 2: descargar ficheros subidos con html cabeceras de respuesta gesti\u00f3n de estado cookies sesi\u00f3n autenticaci\u00f3n de usuarios referencias duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada : 12 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. a) Se han identificado los mecanismos disponibles para el mantenimiento de la informaci\u00f3n que concierne a un cliente web concreto y se han se\u00f1alado sus ventajas. b) Se han utilizado sesiones para mantener el estado de las aplicaciones Web. c) Se han utilizado cookies para almacenar informaci\u00f3n en el cliente Web y para recuperar su contenido. d) Se han identificado y caracterizado los mecanismos disponibles para la autentificaci\u00f3n de usuarios. e) Se han escrito aplicaciones que integren mecanismos de autentificaci\u00f3n de usuarios. f) Se han realizado adaptaciones a aplicaciones Web existentes como gestores de contenidos u otras. g) Se han utilizado herramientas y entornos para facilitar la programaci\u00f3n, prueba y depuraci\u00f3n del c\u00f3digo. variables de servidor PHP almacena la informaci\u00f3n del servidor y de las peticiones HTTP en seis arrays globales: $_ENV : informaci\u00f3n sobre las variables de entorno. $_GET : par\u00e1metros enviados en la petici\u00f3n GET. $_POST : par\u00e1metros enviados en el envio POST. $_COOKIE : contiene las cookies de la petici\u00f3n, las claves del array son los nombres de las cookies. $_SERVER : informaci\u00f3n sobre el servidor. $_FILES : informaci\u00f3n sobre los ficheros cargados via upload. Si nos centramos en el array $_SERVER podemos consultar las siguientes propiedades: PHP_SELF : nombre del script ejecutado, relativo al document root (p.e.: /tienda/carrito.php ). SERVER_SOFTWARE : (p.e.: Apache ). SERVER_NAME : dominio, alias DNS (p.e.: www.elche.es ). REQUEST_METHOD : GET. REQUEST_URI : URI, sin el dominio. QUERY_STRING : todo lo que va despu\u00e9s de ? en la URL (p.e.: heroe=Batman&nombre=Bruce ). M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/reserved.variables.server.php. PHP 1 2 3 4 5 6 7 8 <?php echo $_SERVER [ \"PHP_SELF\" ] . \"<br>\" ; // /u4/401server.php echo $_SERVER [ \"SERVER_SOFTWARE\" ] . \"<br>\" ; // Apache/2.4.46 (Win64) OpenSSL/1.1.1g PHP/7.4.9 echo $_SERVER [ \"SERVER_NAME\" ] . \"<br>\" ; // localhost echo $_SERVER [ \"REQUEST_METHOD\" ] . \"<br>\" ; // GET echo $_SERVER [ \"REQUEST_URI\" ] . \"<br>\" ; // /u4/401server.php?hero=Batman echo $_SERVER [ \"QUERY_STRING\" ] . \"<br>\" ; // hero=Batman Otras propiedades relacionadas: PATH_INFO : ruta extra tras la petici\u00f3n (p.e.: si la URL es http://www.php.com/php/pathInfo.php/algo/cosa?foo=bar , entonces $_SERVER['PATH_INFO'] ser\u00e1 /algo/cosa ). REMOTE_HOST : hostname que hizo la petici\u00f3n. REMOTE_ADDR : IP del cliente. AUTH_TYPE : tipo de autenticaci\u00f3n (p.ej: Basic ). REMOTE_USER : nombre del usuario autenticado. Apache crea una clave para cada cabecera HTTP, en may\u00fasculas y sustituyendo los guiones por subrayados: HTTP_USER_AGENT : agente (navegador). HTTP_REFERER : p\u00e1gina desde la que se hizo la petici\u00f3n. PHP 1 2 <?php echo $_SERVER [ \"HTTP_USER_AGENT\" ] . \"<br>\" ; // Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 formularios A la hora de enviar un formulario, debemos tener claro cuando usar GET o POST: GET: los par\u00e1metros se pasan en la URL. <2048 caracteres, s\u00f3lo ASCII. Permite almacenar la direcci\u00f3n completa (marcador / historial). Idempotente: dos llamadas con los mismos datos siempre debe dar el mismo resultado. El navegador puede cachear las llamadas. POST: par\u00e1metros ocultos (no encriptados). Sin l\u00edmite de datos, permite datos binarios. No se pueden cachear. No idempotente \u2192 actualizar la BBDD. As\u00ed pues, para recoger los datos accederemos al array dependiendo del m\u00e9todo del formulario que nos ha invocado: PHP 1 2 3 <?php $par = $_GET [ \"parametro\" ] $par = $_POST [ \"parametro\" ] Para los siguientes apartados nos vamos a basar en el siguiente ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <form action=\"formulario.php\" method=\"GET\"> <p> <label for=\"nombre\">Nombre del alumno:</label> <input type=\"text\" name=\"nombre\" id=\"nombre\" value=\"\" /> </p> <p> <input type=\"checkbox\" name=\"modulos[]\" id=\"modulosDWES\" value=\"DWES\" /> <label for=\"modulosDWES\">Desarrollo web en entorno servidor</label> </p> <p> <input type=\"checkbox\" name=\"modulos[]\" id=\"modulosDWEC\" value=\"DWEC\" /> <label for=\"modulosDWEC\">Desarrollo web en entorno cliente</label> </p> <input type=\"submit\" value=\"Enviar\" name=\"enviar\" /> </form> validaci\u00f3n Respecto a la validaci\u00f3n, es conveniente siempre hacer validaci\u00f3n doble : En el cliente mediante JS. En servidor, antes de llamar a negocio, es conveniente volver a validar los datos. PHP 1 2 3 4 5 <?php if ( isset ( $_GET [ \"parametro\" ])) { $par = $_GET [ \"parametro\" ]; // comprobar si $par tiene el formato adecuado, su valor, etc... } librer\u00edas de validaci\u00f3n Existen diversas librer\u00edas que facilitan la validaci\u00f3n de los formularios, como son respect/validation o particle/validator . Cuando estudiemos Laravel profundizaremos en la validaci\u00f3n de forma declarativa. par\u00e1metros multivalor Existen elementos HTML que env\u00edan varios valores: select multiple checkbox Para recoger los datos, el nombre del elemento debe ser un array. PHP 1 2 3 4 5 6 7 8 9 10 11 <select name=\"lenguajes[]\" multiple=\"true\"> <option value=\"c\">C</option> <option value=\"java\">Java</option> <option value=\"php\">PHP</option> <option value=\"python\">Python</option> </select> <input type=\"checkbox\" name=\"lenguajes[]\" value=\"c\" />C<br /> <input type=\"checkbox\" name=\"lenguajes[]\" value=\"java\" />Java<br /> <input type=\"checkbox\" name=\"lenguajes[]\" value=\"php\" />Php<br /> <input type=\"checkbox\" name=\"lenguajes[]\" value=\"python\" />Python<br /> De manera que luego al recoger los datos: PHP 1 2 3 4 5 6 <?php $lenguajes = $_GET [ \"lenguajes\" ]; foreach ( $lenguajes as $lenguaje ) { echo \" $lenguaje <br />\" ; } volviendo a rellenar un formulario Un sticky form es un formulario que recuerda sus valores. Para ello, hemos de rellenar los atributos value de los elementos HTML con la informaci\u00f3n que conten\u00edan: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 <?php if ( ! empty ( $_POST [ 'modulos' ]) && ! empty ( $_POST [ 'nombre' ])) { // Aqu\u00ed se incluye el c\u00f3digo a ejecutar cuando los datos son correctos } else { // Generamos el formulario $nombre = $_POST [ 'nombre' ] ?? \"\" ; $modulos = $_POST [ 'modulos' ] ?? []; ?> <form action=\" <?php echo $_SERVER [ 'PHP_SELF' ]; ?> \" method=\"POST\"> <p> <label for=\"nombre\">Nombre del alumno:</label> <input type=\"text\" name=\"nombre\" id=\"nombre\" value=\" <? = $nombre ?> \" /> </p> <p> <input type=\"checkbox\" name=\"modulos[]\" id=\"modulosDWES\" value=\"DWES\" <?php if ( in_array ( \"DWES\" , $modulos )) echo 'checked=\"checked\"' ; ?> /> <label for=\"modulosDWES\">Desarrollo web en entorno servidor</label> </p> <p> <input type=\"checkbox\" name=\"modulos[]\" id=\"modulosDWEC\" value=\"DWEC\" <?php if ( in_array ( \"DWEC\" , $modulos )) echo 'checked=\"checked\"' ; ?> /> <label for=\"modulosDWEC\">Desarrollo web en entorno cliente</label> </p> <input type=\"submit\" value=\"Enviar\" name=\"enviar\"/> </form> <?php } ?> subiendo archivos Se almacenan en el servidor en el array $_FILES con el nombre del campo del tipo file del formulario. PHP 1 2 3 4 5 <form enctype=\"multipart/form-data\" action=\" <?php echo $_SERVER [ 'PHP_SELF' ]; ?> \" method=\"POST\"> Archivo: <input name=\"archivoEnviado\" type=\"file\" /> <br /> <input type=\"submit\" name=\"btnSubir\" value=\"Subir\" /> </form> Configuraci\u00f3n en php.ini : file_uploads : on / off. upload_max_filesize : 2M. upload_tmp_dir : directorio temporal. No es necesario configurarlo, coger\u00e1 el predeterminado del sistema. post_max_size : tama\u00f1o m\u00e1ximo de los datos POST. Debe ser mayor a upload_max_filesize. max_file_uploads : n\u00famero m\u00e1ximo de archivos que se pueden cargar a la vez. max_input_time : tiempo m\u00e1ximo empleado en la carga (GET/POST y upload \u2192 normalmente se configura en 60). memory_limit : 128M. max_execution_time : tiempo de ejecuci\u00f3n de un script (no tiene en cuenta el upload). Veamos de qu\u00e9 informaci\u00f3n disponemos en el array $_FILES para una imagen llamada 'saludo.jpg' subida mediante nuestro formulario: PHP 1 2 3 4 5 6 <?php echo $_FILES [ 'archivoEnviado' ][ 'name' ]; echo $_FILES [ 'archivoEnviado' ][ 'tmp_name' ]; echo $_FILES [ 'archivoEnviado' ][ 'type' ]; echo $_FILES [ 'archivoEnviado' ][ 'size' ]; ?> Mediante estos echo's se ha accedido a toda la informaci\u00f3n disponible del fichero en PHP. La informaci\u00f3n impresa ser\u00eda la siguiente: Bash 1 2 3 4 5 saludo 213mnuashduahs0923 image/jpg 120304 0 Para cargar los archivos, accedemos al array $_FILES : PHP 1 2 3 4 5 6 7 8 9 10 <?php if ( isset ( $_POST [ 'btnSubir' ]) && $_POST [ 'btnSubir' ] == 'Subir' ) { if ( is_uploaded_file ( $_FILES [ 'archivoEnviado' ][ 'tmp_name' ])) { // subido con \u00e9xito $nombre = $_FILES [ 'archivoEnviado' ][ 'name' ]; move_uploaded_file ( $_FILES [ 'archivoEnviado' ][ 'tmp_name' ], \"./uploads/ { $nombre } \" ); echo \"<p>Archivo $nombre subido con \u00e9xito</p>\" ; } } Cada archivo cargado en $_FILES tiene: name : nombre. tmp_name : nombre temporal asignado al fichero por el servidor. Este nombre es \u00fanico y permite identificarlo dentro de la carpeta de temporales. size : tama\u00f1o en bytes. type : tipo MIME. error : c\u00f3digo de error de la subida, en nuestro caso 0 o UPLOAD_ERR_OK que indica que no se ha producido error alguno. C\u00f3digos de error subida de fichero . filtrado con php de tipos de ficheros subidos con html Una vez sabemos c\u00f3mo acceder a la informaci\u00f3n de los ficheros subidos, vamos a centrarnos en el filtrado de los tipos de ficheros aceptados. Limitar el tipo de fichero subido es altamente recomendable para evitar posibles problemas de seguridad. Para este ejemplo voy comprobar que la imagen s\u00fabida sea en efecto una imagen con una de las extensiones m\u00e1s comunes y que su tama\u00f1o sea menor a 1 MB : PHP 1 2 3 4 5 6 7 8 9 10 <?php $extensiones = [ 'image/jpg' , 'image/jpeg' , 'image/png' ]; $max_tamanyo = 1024 * 1024 * 8 ; if ( in_array ( $_FILES [ 'archivoEnviado' ][ 'type' ], $extensiones ) ) { echo 'Es una imagen' ; if ( $_FILES [ 'archivoEnviado' ][ 'size' ] < $max_tamanyo ) { echo 'Pesa menos de 1 MB' ; } } ?> escritura de im\u00e1genes en carpeta del servidor Una vez tengamos nuestros ficheros filtrados vamos a proceder a guardarlos de forma permanente en una carpeta de nuestro servidor. Las imagenes o ficheros subidos mediante los formularios HTML son almacenados siempre en una carpeta temporal del sistema, por lo tanto deberemos moverlos para poder guardarlos permanentemente. Para trasladar los ficheros de la carpeta temporal directamente a nuestra carpeta elegida usaremos la funci\u00f3n move_uploaded_file( origen, destino ) . El siguiente ejemplo ser\u00eda un script alojado en la carpeta raiz de nuestra web, p.e. index.php: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php $ruta_indexphp = dirname ( realpath ( __FILE__ )); $ruta_fichero_origen = $_FILES [ 'archivoEnviado' ][ 'tmp_name' ]; $ruta_nuevo_destino = $ruta_indexphp . '/uploads/' . $_FILES [ 'imagen1' ][ 'name' ]; if ( in_array ( $_FILES [ 'archivoEnviado' ][ 'type' ], $extensiones ) ) { echo 'Es una imagen' ; if ( $_FILES [ 'archivoEnviado' ][ 'size' ] < $max_tamanyo ) { echo 'Pesa menos de 1 MB' ; if ( move_uploaded_file ( $ruta_fichero_origen , $ruta_nuevo_destino ) ) { echo 'Fichero guardado con \u00e9xito' ; } } } ?> El nombre temporal del fichero subido, que se encuentra en la carpeta de temporales, en $ruta_fichero_origen . La ruta completa de destino del fichero, que se compone por una parte de la ruta raiz del script donde estamos trabajando (estamos programando en index.php ) m\u00e1s el nombre de la carpeta que se ha creado para guardar las imagenes ( /uploads ) y por \u00faltimo el nombre definitivo que tendr\u00e1 el fichero ( el nombre original del fichero ). seguridad de escritura de imagenes en carpeta del servidor Al guardar los archivos subidos por los usuarios en nuestro servidor, puede ocurrir que no filtremos los ficheros introducidos, o guardemos ficheros susceptibles de provocar problemas de seguridad. Para evitar problemas de este tipo lo mejor ser\u00e1 incluir en la carpeta donde los almacenamos un peque\u00f1o script htaccess que evite la ejecuci\u00f3n de c\u00f3digo: Bash 1 2 RemoveHandler .phtml .php3 .php .pl .py .jsp .asp .htm .shtml .sh .cgi .dat RemoveType .phtml .php3 .php .pl .py .jsp .asp .htm .shtml .sh .cgi .dat Con estas dos l\u00edneas en un fichero con extensi\u00f3n .htaccess evitaremos una posible ejecuci\u00f3n de c\u00f3digo por parte de usuarios malintencionados. Recuerda que debes incluir este fichero en la misma carpeta donde almacenas los ficheros. Y ya est\u00e1, con esto tendr\u00edamos terminado un formulario para subir imagenes con php totalmente funcional, con comprobaciones de seguridad para evitar subidas de ficheros inesperadas que puedan provocar problemas o hackeos inesperados. extra 1: mostrar imagenes subidas con html Mostrar las imagenes guardadas en nuestra carpeta de almacenamiento es sencillo, tan solo deberemos incluir la ruta hasta el fichero en una etiqueta IMG html: PHP 1 <img src=\"uploads/nombreImagen.jpg\" /> extra 2: descargar ficheros subidos con html Si queremos incluir un enlace de descarga para el fichero almacenado, en vez de utilizar una etiqueta IMG usaremos una etiqueta para enlaces con el atributo HREF la ruta al fichero: PHP 1 <a href=\"uploads/nombreImagen.jpg\"> Descarga de la imagen </a> Este enlace producir\u00e1 que el usuario descargue el fichero en cuesti\u00f3n, no obstante si el archivo es por ejemplo una imagen o pdf, el usuario en vez de lograr una descarga directa visualizar\u00e1 el contenido, teniendo que descargarlo haciendo uso de la opci\u00f3n descargar del men\u00fa desplegable con clic derecho. Evitar la visualizaci\u00f3n de ficheros es posible gracias a HTML5 y los navegadores m\u00e1s modernos: Chrome, Firefox, Opera. Deberemos incluir el atributo download en la etiqueta de enlace anterior ( A ), as\u00ed, el enlace final para una descarga forzada quedar\u00eda as\u00ed: PHP 1 <a href=\"uploads/nombreImagen.jpg\" download=\"nombreImagen\">Descarga la imagen</a> cabeceras de respuesta Se devuelven mediante la funci\u00f3n header(cadena) . Mediante las cabeceras podemos configurar el tipo de contenido, tiempo de expiraci\u00f3n, redireccionar el navegador, especificar errores HTTP, etc. Debe ser lo primero a devolver El motivo es que en cuando un programa genera contenido HTML, el servidor genera autom\u00e1ticamente la informaci\u00f3n de estado y los campos de cabecera y a continuaci\u00f3n env\u00eda el contenido generado. Si despu\u00e9s el programa contiene una instrucci\u00f3n header() , se produce un error porque las cabeceras ya se han enviado (ni siquiera deja una linea en blanco). PHP 1 2 3 <?php header ( \"Content-Type: text/plain\" ); ?> <?php header ( \"Location: http://www.ejemplo.com/inicio.html\" ); exit (); inspeccionando las cabeceras Se puede comprobar en las herramientas del desarrollador de los navegadores web mediante Developer Tools \u2192 Network \u2192 Headers . Es muy com\u00fan configurar las cabeceras para evitar consultas a la cach\u00e9 o provocar su renovaci\u00f3n: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php header ( \"Expires: Sun, 31 Jan 2021 23:59:59 GMT\" ); // tres horas $now = time (); $horas3 = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" , $now + 60 * 60 * 3 ); header ( \"Expires: { $horas3 } \" ); // un a\u00f1o $now = time (); $anyo1 = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" , $now + 365 * 86440 ); header ( \"Expires: { $anyo1 } \" ); // se marca como expirado (fecha en el pasado) $pasado = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" ); header ( \"Expires: { $pasado } \" ); // evitamos cache de navegador y/o proxy header ( \"Expires: Mon, 26 Jul 1997 05:00:00 GMT\" ); header ( \"Last-Modified: \" . gmdate ( \"D, d M Y H:i:s\" ) . \" GMT\" ); header ( \"Cache-Control: no-store, no-cache, must-revalidate\" ); header ( \"Cache-Control: post-check=0, pre-check=0\" , false ); header ( \"Pragma: no-cache\" ); gesti\u00f3n de estado HTTP es un protocolo stateless, sin estado. Por ello, se simula el estado mediante el uso de cookies , tokens o la sesi\u00f3n . El estado es necesario para procesos tales como el carrito de la compra, operaciones asociadas a un usuario, etc... El mecanismo de PHP para gestionar la sesi\u00f3n emplea cookies de forma interna. Las cookies se almacenan en el navegador, y la sesi\u00f3n en el servidor web. cookies Las cookies se almacenan en el array global $_COOKIE . Lo que coloquemos dentro del array, se guardar\u00e1 en el cliente. Hay que tener presente que el cliente puede no querer almacenarlas. Existe una limitaci\u00f3 de 20 cookies por dominio y 300 en total en el navegador. En PHP, para crear una cookie se utiliza la funci\u00f3n setcookie : PHP 1 2 3 4 <?php setcookie ( nombre [, valor [, expira [, ruta [, dominio [, seguro [, httponly ]]]]]]); setcookie ( nombre [, valor = \"\" [, opciones = [] ]] ) ?> Destacar que el nombre no puede contener espacios ni el caracter ;. Respecto al contenido de la cookie, no puede superar los 4 KB. Por ejemplo, mediante cookies podemos comprobar la cantidad de visitas diferentes que realiza un usuario: PHP 1 2 3 4 5 6 7 <?php $accesosPagina = 0 ; if ( isset ( $_COOKIE [ 'accesos' ])) { $accesosPagina = $_COOKIE [ 'accesos' ]; // recuperamos una cookie setcookie ( 'accesos' , ++ $accesosPagina ); // le asignamos un valor } ?> inspeccionando las cookies Si queremos ver que contienen las cookies que tenemos almacenadas en el navegador, se puede comprobar su valor en Dev Tools \u2192 Application \u2192 Storage Ejemplo de cookies: 1) vamos a realizar un fichero html ( cookiesEjemplo1.html ) en el que: HTML 1 2 3 4 5 6 7 8 9 10 11 12 < center > < h2 > elige idioma: </ h2 > < a href = \"cookiesEjemplo1.php?idioma=va\" > < img src = \"./images/flag_valencian.png\" height = \"70\" width = \"70\" title = \"valenci\u00e0\" > </ a > < a href = \"cookiesEjemplo1.php?idioma=es\" > < img src = \"./images/flag_spanish.png\" height = \"70\" width = \"70\" title = \"castellano\" > </ a > < a href = \"cookiesEjemplo1.php?idioma=en\" > < img src = \"./images/flag_england.png\" height = \"70\" width = \"70\" title = \"ingl\u00e9s\" > </ a > </ center > 2) Creamos fichero cookiesEjemplo1.php en el que comprueba si se ha enviado el par\u00e1metro idioma , si es as\u00ed, crea una cookie de nombre idioma , valor $_GET['idioma'] , tiempo 1 hora y que trabaja desde la ra\u00edz \\ . Adem\u00e1s, se ha a\u00f1adido una cabecera que redireccionar\u00e1 a la p\u00e1gina cookiesEjemplo1_b.php : PHP 1 2 3 4 5 6 <?php if ( isset ( $_GET [ 'idioma' ])){ setcookie ( 'idioma' , $_GET [ 'idioma' ], time () + 3600 , \"/\" ); header ( \"Location:cookiesEjemplo1_b.php\" ); } ?> 3) En el fichero cookiesEjemplo1_b.php se comprueba el valor de la cookie idioma : PHP 1 2 3 4 5 6 7 8 9 10 11 <?php if ( ! $_COOKIE [ 'idioma' ]){ header ( 'Location:cookiesEjemplo1.html' ); } else if ( $_COOKIE [ 'idioma' ] == \"va\" ){ header ( 'Location:cookiesEjemplo1Va.php' ); } else if ( $_COOKIE [ 'idioma' ] == \"va\" ){ header ( 'Location:cookiesEjemplo1Es.php' ); } else if ( $_COOKIE [ 'idioma' ] == \"va\" ){ header ( 'Location:cookiesEjemplo1En.php' ); } ?> El fichero, por ejemplo, cookiesEjemplo1Va.php quedar\u00eda: PHP 1 2 3 <h2> idioma en valenci\u00e0 </h2> <br /> <br /> <a href=\"cookiesEjemplo2BorrarCookies.php\">borrar cookies</a> El tiempo de vida de las cookies puede ser tan largo como el sitio web en el que residen. Ellas seguir\u00e1n ah\u00ed, incluso si el navegador est\u00e1 cerrado o abierto. Para borrar una cookie se puede poner que expiren en el pasado: PHP 1 2 <?php setcookie ( nombre , \"\" , 1 ) // pasado O que caduquen dentro de un periodo de tiempo determinado: PHP 1 2 <?php setcookie ( nombre , valor , time () + 3600 ) // Caducan dentro de una hora Ejemplo 2: Siguiendo con el ejemplo anterior de idiomas, podr\u00edamos crear el fichero cookiesEjemplo2BorrarCookies.php y, desde ah\u00ed, eliminar la cookie idioma: PHP 1 2 3 4 <?php setcookie ( 'idioma' , '' , time () - 1 , '/' ); header ( 'Location:cookiesEjemplo1.html' ); ?> Se utilizan para: Recordar los inicios de sesi\u00f3n. Almacenar valores temporales de usuario. Si un usuario est\u00e1 navegando por una lista paginada de art\u00edculos, ordenados de cierta manera, podemos almacenar el ajuste de la clasificaci\u00f3n. La alternativa en el cliente para almacenar informaci\u00f3n en el navegador es el objeto LocalStorage . sesi\u00f3n La sesi\u00f3n a\u00f1ade la gesti\u00f3n del estado a HTTP, almacenando en este caso la informaci\u00f3n en el servidor. Cada visitante tiene un ID de sesi\u00f3n \u00fanico, el cual por defecto se almacena en una cookie denominada PHPSESSID . Si el cliente no tiene las cookies activas, el ID se propaga en cada URL dentro del mismo dominio. Cada sesi\u00f3n tiene asociado un almac\u00e9n de datos mediante el array global $_SESSION en el cual podemos almacenar y recuperar informaci\u00f3n. La sesi\u00f3n comienza al ejecutar un script PHP. Se genera un nuevo ID y se cargan los datos del almac\u00e9n: El trabajo con sesiones tiene tres partes: Creaci\u00f3n o apertura de la sesi\u00f3n: Cuando alguna p\u00e1gina crea una sesi\u00f3n utilizando la cabecera session_start(); ( recuerda que las cabeceras deben ir justo despu\u00e9s de <?php ), el servidor asocia al navegador del usuario un identificador de usuario \u00fanico. El identificador se guarda en el usuario en forma de cookie o, si el navegador del usuario no permite la creaci\u00f3n de cookies, a\u00f1adiendo el identificador en la direcci\u00f3n de la p\u00e1gina. Utilizaci\u00f3n de la sesi\u00f3n: Si ya se ha creado la sesi\u00f3n, las p\u00e1ginas solicitadas por el mismo navegador pueden guardar y recuperar informaci\u00f3n en el servidor, informaci\u00f3n que se asocia al identificador de usuario, por lo que no es accesible a otros usuarios. La informaci\u00f3n se conserva hasta que el usuario o el servidor destruyan la sesi\u00f3n. Destrucci\u00f3n o cierre de la sesi\u00f3n: Tanto el usuario como el servidor pueden cerrar la sesi\u00f3n. El usuario puede destruir la sesi\u00f3n cerrando el navegador. El servidor puede destruir la sesi\u00f3n cuando alguna p\u00e1gina utilice la funci\u00f3n session_destroy(); o al cabo de un tiempo determinado (definido mediante la funci\u00f3n session_set_cookie_params() ). Las operaciones que podemos realizar con la sesi\u00f3n son: PHP 1 2 3 4 5 6 <?php session_start (); // carga la sesi\u00f3n session_id () // devuelve el id $_SESSION [ clave ] = valor ; // inserci\u00f3n session_destroy (); // destruye la sesi\u00f3n unset ( $_SESSION [ clave ]; // borrado Vamos a ver mediante un ejemplo c\u00f3mo podemos insertar en un p\u00e1gina datos en la sesi\u00f3n para posteriormente en otra p\u00e1gina acceder a esos datos. Por ejemplo, en sesion1.php tendr\u00edamos: PHP 1 2 3 4 5 6 7 8 <?php session_start (); // inicializamos $_SESSION [ \"ies\" ] = \"IES Mestre Ramon Esteve\" ; // asignaci\u00f3n $instituto = $_SESSION [ \"ies\" ]; // recuperaci\u00f3n echo \"Estamos en el $instituto \" ; ?> <br /> <a href=\"sesion2.php\">Y luego</a> Y posteriormente podemos acceder a la sesi\u00f3n en sesion2.php : PHP 1 2 3 4 5 <?php session_start (); $instituto = $_SESSION [ \"ies\" ]; // recuperaci\u00f3n echo \"Otra vez, en el $instituto \" ; ?> configurando la sesi\u00f3n en php.ini Las siguientes propiedades de php.ini permiten configurar algunos aspectos de la sesi\u00f3n: session.save_handler : controlador que gestiona c\u00f3mo se almacena (valor files ). session.save_path : ruta donde se almacenan los archivos con los datos (si tenemos un cluster, podr\u00edamos usar /mnt/sessions en todos los servidores de manera que apuntan a una carpeta compartida). session.name : nombre de la sesi\u00f3n (PHSESSID). session.auto_start : Se puede hacer que se autocargue con cada script. Por defecto est\u00e1 deshabilitado. session.cookie_lifetime : tiempo de vida por defecto. M\u00e1s informaci\u00f3n en la documentaci\u00f3n oficial . cookie VS session Las sesiones no deben confundirse con las cookies . Las cookies es un m\u00e9todo que permite guardar informaci\u00f3n en el ordenador del cliente para recuperarla en el futuro; mientras que en las sesiones la informaci\u00f3n se mantiene en el servidor hasta que se cierra la sesi\u00f3n (por intervenci\u00f3n del usuario o por tiempo). En el manual de PHP se ofrece un cap\u00edtulo dedicado a las sesiones . Ejemplo: he aqu\u00ed un ejemplo gr\u00e1fico de utilizaci\u00f3n de sesiones. Programa de dos p\u00e1ginas que muestra gr\u00e1ficamente los votos recogidos por dos opciones. La primera p\u00e1gina contiene un formulario con tres botones de tipo submit con el mismo atributo name . Dos botones permiten votar a una u otra opci\u00f3n. El tercer bot\u00f3n pone a cero los contadores de votos. La segunda p\u00e1gina recibe el dato, modifica la variable de sesi\u00f3n que contiene el n\u00famero de votos de la opci\u00f3n elegida (o ambas) y redirige a la primera p\u00e1gina. Los dos n\u00fameros se guardan en dos variables de sesi\u00f3n. Si las variables de sesi\u00f3n no est\u00e1n definidas, se les dar\u00e1 el valor 0. Las franjas correspondientes a los votos se alargan de 10px en 10px y no tienen l\u00edmite de tama\u00f1o. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 <?php // Accedemos a la sesi\u00f3n session_name(\"sesion1\"); session_start(); // Si alg\u00fan contador no est\u00e1 guardado en la sesi\u00f3n, ponemos ambos a cero if (!isset($_SESSION[\"a\"]) || !isset($_SESSION[\"b\"])) { $_SESSION[\"a\"] = $_SESSION[\"b\"] = 0; } ?> <!-- ... --> <body> <h2>Votar una opci\u00f3n</h2> <form action=\"ps2.php\" method=\"get\"> <table> <tr> <td style=\"vertical-align: top;\"> <button type=\"submit\" name=\"accion\" value=\"a\" style=\"font-size: 60px; line-height: 50px; color: hwb(200 0% 0%);\"> &#x2714; </button> </td> <td> <?php // Dibujamos la primera barra print \" <svg width=\\\"$_SESSION[a]\\\" height=\\\"50\\\">\\n\"; print \" <line x1=\\\"0\\\" y1=\\\"25\\\" x2=\\\"$_SESSION[a]\\\" y2=\\\"25\\\" stroke=\\\"hwb(200 0% 0%)\\\" stroke-width=\\\"50\\\" />\\n\"; print \" </svg>\\n\"; ?> </td> </tr> <tr> <td> <button type=\"submit\" name=\"accion\" value=\"b\" style=\"font-size: 60px; line-height: 50px; color: hwb(35 0% 0%)\">&#x2714; </button> </td> <?php // Dibujamos la segunda barra print \" <td>\\n\"; print \" <svg width=\\\"$_SESSION[b]\\\" height=\\\"50\\\">\\n\"; print \" <line x1=\\\"0\\\" y1=\\\"25\\\" x2=\\\"$_SESSION[b]\\\" y2=\\\"25\\\" stroke=\\\"hwb(35 0% 0%)\\\" stroke-width=\\\"50\\\" />\\n\"; print \" </svg>\\n\"; print \" </td>\\n\"; ?> </tr> </table> <p> <button type=\"submit\" name=\"accion\" value=\"cero\">Poner a cero</button> </p> </form> </body> </html> Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <?php session_name(\"sesion1\"); session_start(); // Si alguno de los n\u00fameros de votos no est\u00e1 guardado en la sesi\u00f3n, redirigimos a la primera p\u00e1gina if (!isset($_SESSION[\"a\"]) || !isset($_SESSION[\"b\"])) { header(\"Location:ps1.php\"); exit; } $accion = $_GET['accion']; // Dependiendo de la acci\u00f3n recibida, modificamos el n\u00famero correspondiente if ($accion == \"a\") { $_SESSION[\"a\"] += 10; } elseif ($accion == \"b\") { $_SESSION[\"b\"] += 10; } elseif ($accion == \"cero\") { $_SESSION[\"a\"] = $_SESSION[\"b\"] = 0; } // Volvemos al formulario header(\"Location:ps1.php\"); autenticaci\u00f3n de usuarios Una sesi\u00f3n establece una relaci\u00f3n an\u00f3nima con un usuario particular, de manera que podemos saber si es el mismo usuario entre dos peticiones distintas. Si preparamos un sistema de login, podremos saber qui\u00e9n utiliza nuestra aplicaci\u00f3n. Para ello, preparemos un sencillo sistema de autenticaci\u00f3n: Mostrar el formulario login/password. Comprobar los datos enviados. A\u00f1adir el login a la sesi\u00f3n. Comprobar el login en la sesi\u00f3n para realizar tareas espec\u00edficas del usuario. Eliminar el login de la sesi\u00f3n cuando el usuario la cierra. Vamos a ver en c\u00f3digo cada paso del proceso. Comenzamos con el archivo index.php : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <form action='login.php' method='post'> <fieldset> <legend>Login</legend> <div><span class='error'> <?php echo $error ; ?> </span></div> <div class='fila'> <label for='usuario'>Usuario:</label><br /> <input type='text' name='inputUsuario' id='usuario' maxlength=\"50\" /><br /> </div> <div class='fila'> <label for='password'>Contrase\u00f1a:</label><br /> <input type='password' name='inputPassword' id='password' maxlength=\"50\" /><br /> </div> <div class='fila'> <input type='submit' name='enviar' value='Enviar' /> </div> </fieldset> </form> Al hacer submit nos lleva a login.php , el cual hace de controlador: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php // Comprobamos si ya se ha enviado el formulario if ( isset ( $_POST [ 'enviar' ])) { $usuario = $_POST [ 'inputUsuario' ]; $password = $_POST [ 'inputPassword' ]; // validamos que recibimos ambos par\u00e1metros if ( empty ( $usuario ) || empty ( $password )) { $error = \"Debes introducir un usuario y contrase\u00f1a\" ; include \"index.php\" ; } else { if ( $usuario == \"admin\" && $password == \"admin\" ) { // almacenamos el usuario en la sesi\u00f3n session_start (); $_SESSION [ 'usuario' ] = $usuario ; // cargamos la p\u00e1gina principal include \"main.php\" ; } else { // Si las credenciales no son v\u00e1lidas, se vuelven a pedir $error = \"Usuario o contrase\u00f1a no v\u00e1lidos!\" ; include \"index.php\" ; } } } Dependiendo del usuario que se haya logueado, vamos a ir a una vista o a otra. Por ejemplo, en main.php tendr\u00edamos: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 <?php // Recuperamos la informaci\u00f3n de la sesi\u00f3n if ( ! isset ( $_SESSION )) { session_start (); } // Y comprobamos que el usuario se haya autentificado if ( ! isset ( $_SESSION [ 'usuario' ])) { die ( \"Error - debe <a href='index.php'>identificarse</a>.<br />\" ); } ?> <!DOCTYPE html> <html lang=\"es\"> <head> <meta charset=\"UTF-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> <title>Listado de productos</title> </head> <body> <h1>Bienvenido <? = $_SESSION [ 'usuario' ] ?> </h1> <p>Pulse <a href=\"logout.php\">aqu\u00ed</a> para salir</p> <p>Volver al <a href=\"main.php\">inicio</a></p> <h2>Listado de productos</h2> <ul> <li>Producto 1</li> <li>Producto 2</li> <li>Producto 3</li> </ul> </body> </html> Finalmente, necesitamos la opci\u00f3n de cerrar la sesi\u00f3n que colocamos en logout.php : PHP 1 2 3 4 5 6 7 8 <?php // Recuperamos la informaci\u00f3n de la sesi\u00f3n session_start (); // Y la destruimos session_destroy (); header ( \"Location: index.php\" ); ?> autenticaci\u00f3n en producci\u00f3n En la actualidad la autenticaci\u00f3n de usuario no se realiza gestionando la sesi\u00f3n directamente, sino que se realiza mediante alg\u00fan framekwork que abstrae todo el proceso o la integraci\u00f3n de mecanismos de autenticaci\u00f3n tipo OAuth, como estudiaremos en la \u00faltima unidad mediante Laravel . referencias Cookies en PHP Manejo de sesiones en PHP","title":"ud04 ProgramacionWeb"},{"location":"ud04/ud04_ProgramacionWeb/#duracion-y-criterios-de-evaluacion","text":"Duraci\u00f3n estimada : 12 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. a) Se han identificado los mecanismos disponibles para el mantenimiento de la informaci\u00f3n que concierne a un cliente web concreto y se han se\u00f1alado sus ventajas. b) Se han utilizado sesiones para mantener el estado de las aplicaciones Web. c) Se han utilizado cookies para almacenar informaci\u00f3n en el cliente Web y para recuperar su contenido. d) Se han identificado y caracterizado los mecanismos disponibles para la autentificaci\u00f3n de usuarios. e) Se han escrito aplicaciones que integren mecanismos de autentificaci\u00f3n de usuarios. f) Se han realizado adaptaciones a aplicaciones Web existentes como gestores de contenidos u otras. g) Se han utilizado herramientas y entornos para facilitar la programaci\u00f3n, prueba y depuraci\u00f3n del c\u00f3digo.","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud04/ud04_ProgramacionWeb/#variables-de-servidor","text":"PHP almacena la informaci\u00f3n del servidor y de las peticiones HTTP en seis arrays globales: $_ENV : informaci\u00f3n sobre las variables de entorno. $_GET : par\u00e1metros enviados en la petici\u00f3n GET. $_POST : par\u00e1metros enviados en el envio POST. $_COOKIE : contiene las cookies de la petici\u00f3n, las claves del array son los nombres de las cookies. $_SERVER : informaci\u00f3n sobre el servidor. $_FILES : informaci\u00f3n sobre los ficheros cargados via upload. Si nos centramos en el array $_SERVER podemos consultar las siguientes propiedades: PHP_SELF : nombre del script ejecutado, relativo al document root (p.e.: /tienda/carrito.php ). SERVER_SOFTWARE : (p.e.: Apache ). SERVER_NAME : dominio, alias DNS (p.e.: www.elche.es ). REQUEST_METHOD : GET. REQUEST_URI : URI, sin el dominio. QUERY_STRING : todo lo que va despu\u00e9s de ? en la URL (p.e.: heroe=Batman&nombre=Bruce ). M\u00e1s informaci\u00f3n en https://www.php.net/manual/es/reserved.variables.server.php. PHP 1 2 3 4 5 6 7 8 <?php echo $_SERVER [ \"PHP_SELF\" ] . \"<br>\" ; // /u4/401server.php echo $_SERVER [ \"SERVER_SOFTWARE\" ] . \"<br>\" ; // Apache/2.4.46 (Win64) OpenSSL/1.1.1g PHP/7.4.9 echo $_SERVER [ \"SERVER_NAME\" ] . \"<br>\" ; // localhost echo $_SERVER [ \"REQUEST_METHOD\" ] . \"<br>\" ; // GET echo $_SERVER [ \"REQUEST_URI\" ] . \"<br>\" ; // /u4/401server.php?hero=Batman echo $_SERVER [ \"QUERY_STRING\" ] . \"<br>\" ; // hero=Batman Otras propiedades relacionadas: PATH_INFO : ruta extra tras la petici\u00f3n (p.e.: si la URL es http://www.php.com/php/pathInfo.php/algo/cosa?foo=bar , entonces $_SERVER['PATH_INFO'] ser\u00e1 /algo/cosa ). REMOTE_HOST : hostname que hizo la petici\u00f3n. REMOTE_ADDR : IP del cliente. AUTH_TYPE : tipo de autenticaci\u00f3n (p.ej: Basic ). REMOTE_USER : nombre del usuario autenticado. Apache crea una clave para cada cabecera HTTP, en may\u00fasculas y sustituyendo los guiones por subrayados: HTTP_USER_AGENT : agente (navegador). HTTP_REFERER : p\u00e1gina desde la que se hizo la petici\u00f3n. PHP 1 2 <?php echo $_SERVER [ \"HTTP_USER_AGENT\" ] . \"<br>\" ; // Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36","title":"variables de servidor"},{"location":"ud04/ud04_ProgramacionWeb/#formularios","text":"A la hora de enviar un formulario, debemos tener claro cuando usar GET o POST: GET: los par\u00e1metros se pasan en la URL. <2048 caracteres, s\u00f3lo ASCII. Permite almacenar la direcci\u00f3n completa (marcador / historial). Idempotente: dos llamadas con los mismos datos siempre debe dar el mismo resultado. El navegador puede cachear las llamadas. POST: par\u00e1metros ocultos (no encriptados). Sin l\u00edmite de datos, permite datos binarios. No se pueden cachear. No idempotente \u2192 actualizar la BBDD. As\u00ed pues, para recoger los datos accederemos al array dependiendo del m\u00e9todo del formulario que nos ha invocado: PHP 1 2 3 <?php $par = $_GET [ \"parametro\" ] $par = $_POST [ \"parametro\" ] Para los siguientes apartados nos vamos a basar en el siguiente ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <form action=\"formulario.php\" method=\"GET\"> <p> <label for=\"nombre\">Nombre del alumno:</label> <input type=\"text\" name=\"nombre\" id=\"nombre\" value=\"\" /> </p> <p> <input type=\"checkbox\" name=\"modulos[]\" id=\"modulosDWES\" value=\"DWES\" /> <label for=\"modulosDWES\">Desarrollo web en entorno servidor</label> </p> <p> <input type=\"checkbox\" name=\"modulos[]\" id=\"modulosDWEC\" value=\"DWEC\" /> <label for=\"modulosDWEC\">Desarrollo web en entorno cliente</label> </p> <input type=\"submit\" value=\"Enviar\" name=\"enviar\" /> </form>","title":"formularios"},{"location":"ud04/ud04_ProgramacionWeb/#validacion","text":"Respecto a la validaci\u00f3n, es conveniente siempre hacer validaci\u00f3n doble : En el cliente mediante JS. En servidor, antes de llamar a negocio, es conveniente volver a validar los datos. PHP 1 2 3 4 5 <?php if ( isset ( $_GET [ \"parametro\" ])) { $par = $_GET [ \"parametro\" ]; // comprobar si $par tiene el formato adecuado, su valor, etc... } librer\u00edas de validaci\u00f3n Existen diversas librer\u00edas que facilitan la validaci\u00f3n de los formularios, como son respect/validation o particle/validator . Cuando estudiemos Laravel profundizaremos en la validaci\u00f3n de forma declarativa.","title":"validaci\u00f3n"},{"location":"ud04/ud04_ProgramacionWeb/#parametros-multivalor","text":"Existen elementos HTML que env\u00edan varios valores: select multiple checkbox Para recoger los datos, el nombre del elemento debe ser un array. PHP 1 2 3 4 5 6 7 8 9 10 11 <select name=\"lenguajes[]\" multiple=\"true\"> <option value=\"c\">C</option> <option value=\"java\">Java</option> <option value=\"php\">PHP</option> <option value=\"python\">Python</option> </select> <input type=\"checkbox\" name=\"lenguajes[]\" value=\"c\" />C<br /> <input type=\"checkbox\" name=\"lenguajes[]\" value=\"java\" />Java<br /> <input type=\"checkbox\" name=\"lenguajes[]\" value=\"php\" />Php<br /> <input type=\"checkbox\" name=\"lenguajes[]\" value=\"python\" />Python<br /> De manera que luego al recoger los datos: PHP 1 2 3 4 5 6 <?php $lenguajes = $_GET [ \"lenguajes\" ]; foreach ( $lenguajes as $lenguaje ) { echo \" $lenguaje <br />\" ; }","title":"par\u00e1metros multivalor"},{"location":"ud04/ud04_ProgramacionWeb/#volviendo-a-rellenar-un-formulario","text":"Un sticky form es un formulario que recuerda sus valores. Para ello, hemos de rellenar los atributos value de los elementos HTML con la informaci\u00f3n que conten\u00edan: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 <?php if ( ! empty ( $_POST [ 'modulos' ]) && ! empty ( $_POST [ 'nombre' ])) { // Aqu\u00ed se incluye el c\u00f3digo a ejecutar cuando los datos son correctos } else { // Generamos el formulario $nombre = $_POST [ 'nombre' ] ?? \"\" ; $modulos = $_POST [ 'modulos' ] ?? []; ?> <form action=\" <?php echo $_SERVER [ 'PHP_SELF' ]; ?> \" method=\"POST\"> <p> <label for=\"nombre\">Nombre del alumno:</label> <input type=\"text\" name=\"nombre\" id=\"nombre\" value=\" <? = $nombre ?> \" /> </p> <p> <input type=\"checkbox\" name=\"modulos[]\" id=\"modulosDWES\" value=\"DWES\" <?php if ( in_array ( \"DWES\" , $modulos )) echo 'checked=\"checked\"' ; ?> /> <label for=\"modulosDWES\">Desarrollo web en entorno servidor</label> </p> <p> <input type=\"checkbox\" name=\"modulos[]\" id=\"modulosDWEC\" value=\"DWEC\" <?php if ( in_array ( \"DWEC\" , $modulos )) echo 'checked=\"checked\"' ; ?> /> <label for=\"modulosDWEC\">Desarrollo web en entorno cliente</label> </p> <input type=\"submit\" value=\"Enviar\" name=\"enviar\"/> </form> <?php } ?>","title":"volviendo a rellenar un formulario"},{"location":"ud04/ud04_ProgramacionWeb/#subiendo-archivos","text":"Se almacenan en el servidor en el array $_FILES con el nombre del campo del tipo file del formulario. PHP 1 2 3 4 5 <form enctype=\"multipart/form-data\" action=\" <?php echo $_SERVER [ 'PHP_SELF' ]; ?> \" method=\"POST\"> Archivo: <input name=\"archivoEnviado\" type=\"file\" /> <br /> <input type=\"submit\" name=\"btnSubir\" value=\"Subir\" /> </form> Configuraci\u00f3n en php.ini : file_uploads : on / off. upload_max_filesize : 2M. upload_tmp_dir : directorio temporal. No es necesario configurarlo, coger\u00e1 el predeterminado del sistema. post_max_size : tama\u00f1o m\u00e1ximo de los datos POST. Debe ser mayor a upload_max_filesize. max_file_uploads : n\u00famero m\u00e1ximo de archivos que se pueden cargar a la vez. max_input_time : tiempo m\u00e1ximo empleado en la carga (GET/POST y upload \u2192 normalmente se configura en 60). memory_limit : 128M. max_execution_time : tiempo de ejecuci\u00f3n de un script (no tiene en cuenta el upload). Veamos de qu\u00e9 informaci\u00f3n disponemos en el array $_FILES para una imagen llamada 'saludo.jpg' subida mediante nuestro formulario: PHP 1 2 3 4 5 6 <?php echo $_FILES [ 'archivoEnviado' ][ 'name' ]; echo $_FILES [ 'archivoEnviado' ][ 'tmp_name' ]; echo $_FILES [ 'archivoEnviado' ][ 'type' ]; echo $_FILES [ 'archivoEnviado' ][ 'size' ]; ?> Mediante estos echo's se ha accedido a toda la informaci\u00f3n disponible del fichero en PHP. La informaci\u00f3n impresa ser\u00eda la siguiente: Bash 1 2 3 4 5 saludo 213mnuashduahs0923 image/jpg 120304 0 Para cargar los archivos, accedemos al array $_FILES : PHP 1 2 3 4 5 6 7 8 9 10 <?php if ( isset ( $_POST [ 'btnSubir' ]) && $_POST [ 'btnSubir' ] == 'Subir' ) { if ( is_uploaded_file ( $_FILES [ 'archivoEnviado' ][ 'tmp_name' ])) { // subido con \u00e9xito $nombre = $_FILES [ 'archivoEnviado' ][ 'name' ]; move_uploaded_file ( $_FILES [ 'archivoEnviado' ][ 'tmp_name' ], \"./uploads/ { $nombre } \" ); echo \"<p>Archivo $nombre subido con \u00e9xito</p>\" ; } } Cada archivo cargado en $_FILES tiene: name : nombre. tmp_name : nombre temporal asignado al fichero por el servidor. Este nombre es \u00fanico y permite identificarlo dentro de la carpeta de temporales. size : tama\u00f1o en bytes. type : tipo MIME. error : c\u00f3digo de error de la subida, en nuestro caso 0 o UPLOAD_ERR_OK que indica que no se ha producido error alguno. C\u00f3digos de error subida de fichero .","title":"subiendo archivos"},{"location":"ud04/ud04_ProgramacionWeb/#filtrado-con-php-de-tipos-de-ficheros-subidos-con-html","text":"Una vez sabemos c\u00f3mo acceder a la informaci\u00f3n de los ficheros subidos, vamos a centrarnos en el filtrado de los tipos de ficheros aceptados. Limitar el tipo de fichero subido es altamente recomendable para evitar posibles problemas de seguridad. Para este ejemplo voy comprobar que la imagen s\u00fabida sea en efecto una imagen con una de las extensiones m\u00e1s comunes y que su tama\u00f1o sea menor a 1 MB : PHP 1 2 3 4 5 6 7 8 9 10 <?php $extensiones = [ 'image/jpg' , 'image/jpeg' , 'image/png' ]; $max_tamanyo = 1024 * 1024 * 8 ; if ( in_array ( $_FILES [ 'archivoEnviado' ][ 'type' ], $extensiones ) ) { echo 'Es una imagen' ; if ( $_FILES [ 'archivoEnviado' ][ 'size' ] < $max_tamanyo ) { echo 'Pesa menos de 1 MB' ; } } ?>","title":"filtrado con php de tipos de ficheros subidos con html"},{"location":"ud04/ud04_ProgramacionWeb/#escritura-de-imagenes-en-carpeta-del-servidor","text":"Una vez tengamos nuestros ficheros filtrados vamos a proceder a guardarlos de forma permanente en una carpeta de nuestro servidor. Las imagenes o ficheros subidos mediante los formularios HTML son almacenados siempre en una carpeta temporal del sistema, por lo tanto deberemos moverlos para poder guardarlos permanentemente. Para trasladar los ficheros de la carpeta temporal directamente a nuestra carpeta elegida usaremos la funci\u00f3n move_uploaded_file( origen, destino ) . El siguiente ejemplo ser\u00eda un script alojado en la carpeta raiz de nuestra web, p.e. index.php: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php $ruta_indexphp = dirname ( realpath ( __FILE__ )); $ruta_fichero_origen = $_FILES [ 'archivoEnviado' ][ 'tmp_name' ]; $ruta_nuevo_destino = $ruta_indexphp . '/uploads/' . $_FILES [ 'imagen1' ][ 'name' ]; if ( in_array ( $_FILES [ 'archivoEnviado' ][ 'type' ], $extensiones ) ) { echo 'Es una imagen' ; if ( $_FILES [ 'archivoEnviado' ][ 'size' ] < $max_tamanyo ) { echo 'Pesa menos de 1 MB' ; if ( move_uploaded_file ( $ruta_fichero_origen , $ruta_nuevo_destino ) ) { echo 'Fichero guardado con \u00e9xito' ; } } } ?> El nombre temporal del fichero subido, que se encuentra en la carpeta de temporales, en $ruta_fichero_origen . La ruta completa de destino del fichero, que se compone por una parte de la ruta raiz del script donde estamos trabajando (estamos programando en index.php ) m\u00e1s el nombre de la carpeta que se ha creado para guardar las imagenes ( /uploads ) y por \u00faltimo el nombre definitivo que tendr\u00e1 el fichero ( el nombre original del fichero ).","title":"escritura de im\u00e1genes en carpeta del servidor"},{"location":"ud04/ud04_ProgramacionWeb/#seguridad-de-escritura-de-imagenes-en-carpeta-del-servidor","text":"Al guardar los archivos subidos por los usuarios en nuestro servidor, puede ocurrir que no filtremos los ficheros introducidos, o guardemos ficheros susceptibles de provocar problemas de seguridad. Para evitar problemas de este tipo lo mejor ser\u00e1 incluir en la carpeta donde los almacenamos un peque\u00f1o script htaccess que evite la ejecuci\u00f3n de c\u00f3digo: Bash 1 2 RemoveHandler .phtml .php3 .php .pl .py .jsp .asp .htm .shtml .sh .cgi .dat RemoveType .phtml .php3 .php .pl .py .jsp .asp .htm .shtml .sh .cgi .dat Con estas dos l\u00edneas en un fichero con extensi\u00f3n .htaccess evitaremos una posible ejecuci\u00f3n de c\u00f3digo por parte de usuarios malintencionados. Recuerda que debes incluir este fichero en la misma carpeta donde almacenas los ficheros. Y ya est\u00e1, con esto tendr\u00edamos terminado un formulario para subir imagenes con php totalmente funcional, con comprobaciones de seguridad para evitar subidas de ficheros inesperadas que puedan provocar problemas o hackeos inesperados.","title":"seguridad de escritura de imagenes en carpeta del servidor"},{"location":"ud04/ud04_ProgramacionWeb/#extra-1-mostrar-imagenes-subidas-con-html","text":"Mostrar las imagenes guardadas en nuestra carpeta de almacenamiento es sencillo, tan solo deberemos incluir la ruta hasta el fichero en una etiqueta IMG html: PHP 1 <img src=\"uploads/nombreImagen.jpg\" />","title":"extra 1: mostrar imagenes subidas con html"},{"location":"ud04/ud04_ProgramacionWeb/#extra-2-descargar-ficheros-subidos-con-html","text":"Si queremos incluir un enlace de descarga para el fichero almacenado, en vez de utilizar una etiqueta IMG usaremos una etiqueta para enlaces con el atributo HREF la ruta al fichero: PHP 1 <a href=\"uploads/nombreImagen.jpg\"> Descarga de la imagen </a> Este enlace producir\u00e1 que el usuario descargue el fichero en cuesti\u00f3n, no obstante si el archivo es por ejemplo una imagen o pdf, el usuario en vez de lograr una descarga directa visualizar\u00e1 el contenido, teniendo que descargarlo haciendo uso de la opci\u00f3n descargar del men\u00fa desplegable con clic derecho. Evitar la visualizaci\u00f3n de ficheros es posible gracias a HTML5 y los navegadores m\u00e1s modernos: Chrome, Firefox, Opera. Deberemos incluir el atributo download en la etiqueta de enlace anterior ( A ), as\u00ed, el enlace final para una descarga forzada quedar\u00eda as\u00ed: PHP 1 <a href=\"uploads/nombreImagen.jpg\" download=\"nombreImagen\">Descarga la imagen</a>","title":"extra 2: descargar ficheros subidos con html"},{"location":"ud04/ud04_ProgramacionWeb/#cabeceras-de-respuesta","text":"Se devuelven mediante la funci\u00f3n header(cadena) . Mediante las cabeceras podemos configurar el tipo de contenido, tiempo de expiraci\u00f3n, redireccionar el navegador, especificar errores HTTP, etc. Debe ser lo primero a devolver El motivo es que en cuando un programa genera contenido HTML, el servidor genera autom\u00e1ticamente la informaci\u00f3n de estado y los campos de cabecera y a continuaci\u00f3n env\u00eda el contenido generado. Si despu\u00e9s el programa contiene una instrucci\u00f3n header() , se produce un error porque las cabeceras ya se han enviado (ni siquiera deja una linea en blanco). PHP 1 2 3 <?php header ( \"Content-Type: text/plain\" ); ?> <?php header ( \"Location: http://www.ejemplo.com/inicio.html\" ); exit (); inspeccionando las cabeceras Se puede comprobar en las herramientas del desarrollador de los navegadores web mediante Developer Tools \u2192 Network \u2192 Headers . Es muy com\u00fan configurar las cabeceras para evitar consultas a la cach\u00e9 o provocar su renovaci\u00f3n: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php header ( \"Expires: Sun, 31 Jan 2021 23:59:59 GMT\" ); // tres horas $now = time (); $horas3 = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" , $now + 60 * 60 * 3 ); header ( \"Expires: { $horas3 } \" ); // un a\u00f1o $now = time (); $anyo1 = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" , $now + 365 * 86440 ); header ( \"Expires: { $anyo1 } \" ); // se marca como expirado (fecha en el pasado) $pasado = gmstrftime ( \"%a, %d %b %Y %H:%M:%S GMT\" ); header ( \"Expires: { $pasado } \" ); // evitamos cache de navegador y/o proxy header ( \"Expires: Mon, 26 Jul 1997 05:00:00 GMT\" ); header ( \"Last-Modified: \" . gmdate ( \"D, d M Y H:i:s\" ) . \" GMT\" ); header ( \"Cache-Control: no-store, no-cache, must-revalidate\" ); header ( \"Cache-Control: post-check=0, pre-check=0\" , false ); header ( \"Pragma: no-cache\" );","title":"cabeceras de respuesta"},{"location":"ud04/ud04_ProgramacionWeb/#gestion-de-estado","text":"HTTP es un protocolo stateless, sin estado. Por ello, se simula el estado mediante el uso de cookies , tokens o la sesi\u00f3n . El estado es necesario para procesos tales como el carrito de la compra, operaciones asociadas a un usuario, etc... El mecanismo de PHP para gestionar la sesi\u00f3n emplea cookies de forma interna. Las cookies se almacenan en el navegador, y la sesi\u00f3n en el servidor web.","title":"gesti\u00f3n de estado"},{"location":"ud04/ud04_ProgramacionWeb/#cookies","text":"Las cookies se almacenan en el array global $_COOKIE . Lo que coloquemos dentro del array, se guardar\u00e1 en el cliente. Hay que tener presente que el cliente puede no querer almacenarlas. Existe una limitaci\u00f3 de 20 cookies por dominio y 300 en total en el navegador. En PHP, para crear una cookie se utiliza la funci\u00f3n setcookie : PHP 1 2 3 4 <?php setcookie ( nombre [, valor [, expira [, ruta [, dominio [, seguro [, httponly ]]]]]]); setcookie ( nombre [, valor = \"\" [, opciones = [] ]] ) ?> Destacar que el nombre no puede contener espacios ni el caracter ;. Respecto al contenido de la cookie, no puede superar los 4 KB. Por ejemplo, mediante cookies podemos comprobar la cantidad de visitas diferentes que realiza un usuario: PHP 1 2 3 4 5 6 7 <?php $accesosPagina = 0 ; if ( isset ( $_COOKIE [ 'accesos' ])) { $accesosPagina = $_COOKIE [ 'accesos' ]; // recuperamos una cookie setcookie ( 'accesos' , ++ $accesosPagina ); // le asignamos un valor } ?> inspeccionando las cookies Si queremos ver que contienen las cookies que tenemos almacenadas en el navegador, se puede comprobar su valor en Dev Tools \u2192 Application \u2192 Storage Ejemplo de cookies: 1) vamos a realizar un fichero html ( cookiesEjemplo1.html ) en el que: HTML 1 2 3 4 5 6 7 8 9 10 11 12 < center > < h2 > elige idioma: </ h2 > < a href = \"cookiesEjemplo1.php?idioma=va\" > < img src = \"./images/flag_valencian.png\" height = \"70\" width = \"70\" title = \"valenci\u00e0\" > </ a > < a href = \"cookiesEjemplo1.php?idioma=es\" > < img src = \"./images/flag_spanish.png\" height = \"70\" width = \"70\" title = \"castellano\" > </ a > < a href = \"cookiesEjemplo1.php?idioma=en\" > < img src = \"./images/flag_england.png\" height = \"70\" width = \"70\" title = \"ingl\u00e9s\" > </ a > </ center > 2) Creamos fichero cookiesEjemplo1.php en el que comprueba si se ha enviado el par\u00e1metro idioma , si es as\u00ed, crea una cookie de nombre idioma , valor $_GET['idioma'] , tiempo 1 hora y que trabaja desde la ra\u00edz \\ . Adem\u00e1s, se ha a\u00f1adido una cabecera que redireccionar\u00e1 a la p\u00e1gina cookiesEjemplo1_b.php : PHP 1 2 3 4 5 6 <?php if ( isset ( $_GET [ 'idioma' ])){ setcookie ( 'idioma' , $_GET [ 'idioma' ], time () + 3600 , \"/\" ); header ( \"Location:cookiesEjemplo1_b.php\" ); } ?> 3) En el fichero cookiesEjemplo1_b.php se comprueba el valor de la cookie idioma : PHP 1 2 3 4 5 6 7 8 9 10 11 <?php if ( ! $_COOKIE [ 'idioma' ]){ header ( 'Location:cookiesEjemplo1.html' ); } else if ( $_COOKIE [ 'idioma' ] == \"va\" ){ header ( 'Location:cookiesEjemplo1Va.php' ); } else if ( $_COOKIE [ 'idioma' ] == \"va\" ){ header ( 'Location:cookiesEjemplo1Es.php' ); } else if ( $_COOKIE [ 'idioma' ] == \"va\" ){ header ( 'Location:cookiesEjemplo1En.php' ); } ?> El fichero, por ejemplo, cookiesEjemplo1Va.php quedar\u00eda: PHP 1 2 3 <h2> idioma en valenci\u00e0 </h2> <br /> <br /> <a href=\"cookiesEjemplo2BorrarCookies.php\">borrar cookies</a> El tiempo de vida de las cookies puede ser tan largo como el sitio web en el que residen. Ellas seguir\u00e1n ah\u00ed, incluso si el navegador est\u00e1 cerrado o abierto. Para borrar una cookie se puede poner que expiren en el pasado: PHP 1 2 <?php setcookie ( nombre , \"\" , 1 ) // pasado O que caduquen dentro de un periodo de tiempo determinado: PHP 1 2 <?php setcookie ( nombre , valor , time () + 3600 ) // Caducan dentro de una hora Ejemplo 2: Siguiendo con el ejemplo anterior de idiomas, podr\u00edamos crear el fichero cookiesEjemplo2BorrarCookies.php y, desde ah\u00ed, eliminar la cookie idioma: PHP 1 2 3 4 <?php setcookie ( 'idioma' , '' , time () - 1 , '/' ); header ( 'Location:cookiesEjemplo1.html' ); ?> Se utilizan para: Recordar los inicios de sesi\u00f3n. Almacenar valores temporales de usuario. Si un usuario est\u00e1 navegando por una lista paginada de art\u00edculos, ordenados de cierta manera, podemos almacenar el ajuste de la clasificaci\u00f3n. La alternativa en el cliente para almacenar informaci\u00f3n en el navegador es el objeto LocalStorage .","title":"cookies"},{"location":"ud04/ud04_ProgramacionWeb/#sesion","text":"La sesi\u00f3n a\u00f1ade la gesti\u00f3n del estado a HTTP, almacenando en este caso la informaci\u00f3n en el servidor. Cada visitante tiene un ID de sesi\u00f3n \u00fanico, el cual por defecto se almacena en una cookie denominada PHPSESSID . Si el cliente no tiene las cookies activas, el ID se propaga en cada URL dentro del mismo dominio. Cada sesi\u00f3n tiene asociado un almac\u00e9n de datos mediante el array global $_SESSION en el cual podemos almacenar y recuperar informaci\u00f3n. La sesi\u00f3n comienza al ejecutar un script PHP. Se genera un nuevo ID y se cargan los datos del almac\u00e9n: El trabajo con sesiones tiene tres partes: Creaci\u00f3n o apertura de la sesi\u00f3n: Cuando alguna p\u00e1gina crea una sesi\u00f3n utilizando la cabecera session_start(); ( recuerda que las cabeceras deben ir justo despu\u00e9s de <?php ), el servidor asocia al navegador del usuario un identificador de usuario \u00fanico. El identificador se guarda en el usuario en forma de cookie o, si el navegador del usuario no permite la creaci\u00f3n de cookies, a\u00f1adiendo el identificador en la direcci\u00f3n de la p\u00e1gina. Utilizaci\u00f3n de la sesi\u00f3n: Si ya se ha creado la sesi\u00f3n, las p\u00e1ginas solicitadas por el mismo navegador pueden guardar y recuperar informaci\u00f3n en el servidor, informaci\u00f3n que se asocia al identificador de usuario, por lo que no es accesible a otros usuarios. La informaci\u00f3n se conserva hasta que el usuario o el servidor destruyan la sesi\u00f3n. Destrucci\u00f3n o cierre de la sesi\u00f3n: Tanto el usuario como el servidor pueden cerrar la sesi\u00f3n. El usuario puede destruir la sesi\u00f3n cerrando el navegador. El servidor puede destruir la sesi\u00f3n cuando alguna p\u00e1gina utilice la funci\u00f3n session_destroy(); o al cabo de un tiempo determinado (definido mediante la funci\u00f3n session_set_cookie_params() ). Las operaciones que podemos realizar con la sesi\u00f3n son: PHP 1 2 3 4 5 6 <?php session_start (); // carga la sesi\u00f3n session_id () // devuelve el id $_SESSION [ clave ] = valor ; // inserci\u00f3n session_destroy (); // destruye la sesi\u00f3n unset ( $_SESSION [ clave ]; // borrado Vamos a ver mediante un ejemplo c\u00f3mo podemos insertar en un p\u00e1gina datos en la sesi\u00f3n para posteriormente en otra p\u00e1gina acceder a esos datos. Por ejemplo, en sesion1.php tendr\u00edamos: PHP 1 2 3 4 5 6 7 8 <?php session_start (); // inicializamos $_SESSION [ \"ies\" ] = \"IES Mestre Ramon Esteve\" ; // asignaci\u00f3n $instituto = $_SESSION [ \"ies\" ]; // recuperaci\u00f3n echo \"Estamos en el $instituto \" ; ?> <br /> <a href=\"sesion2.php\">Y luego</a> Y posteriormente podemos acceder a la sesi\u00f3n en sesion2.php : PHP 1 2 3 4 5 <?php session_start (); $instituto = $_SESSION [ \"ies\" ]; // recuperaci\u00f3n echo \"Otra vez, en el $instituto \" ; ?> configurando la sesi\u00f3n en php.ini Las siguientes propiedades de php.ini permiten configurar algunos aspectos de la sesi\u00f3n: session.save_handler : controlador que gestiona c\u00f3mo se almacena (valor files ). session.save_path : ruta donde se almacenan los archivos con los datos (si tenemos un cluster, podr\u00edamos usar /mnt/sessions en todos los servidores de manera que apuntan a una carpeta compartida). session.name : nombre de la sesi\u00f3n (PHSESSID). session.auto_start : Se puede hacer que se autocargue con cada script. Por defecto est\u00e1 deshabilitado. session.cookie_lifetime : tiempo de vida por defecto. M\u00e1s informaci\u00f3n en la documentaci\u00f3n oficial . cookie VS session Las sesiones no deben confundirse con las cookies . Las cookies es un m\u00e9todo que permite guardar informaci\u00f3n en el ordenador del cliente para recuperarla en el futuro; mientras que en las sesiones la informaci\u00f3n se mantiene en el servidor hasta que se cierra la sesi\u00f3n (por intervenci\u00f3n del usuario o por tiempo). En el manual de PHP se ofrece un cap\u00edtulo dedicado a las sesiones . Ejemplo: he aqu\u00ed un ejemplo gr\u00e1fico de utilizaci\u00f3n de sesiones. Programa de dos p\u00e1ginas que muestra gr\u00e1ficamente los votos recogidos por dos opciones. La primera p\u00e1gina contiene un formulario con tres botones de tipo submit con el mismo atributo name . Dos botones permiten votar a una u otra opci\u00f3n. El tercer bot\u00f3n pone a cero los contadores de votos. La segunda p\u00e1gina recibe el dato, modifica la variable de sesi\u00f3n que contiene el n\u00famero de votos de la opci\u00f3n elegida (o ambas) y redirige a la primera p\u00e1gina. Los dos n\u00fameros se guardan en dos variables de sesi\u00f3n. Si las variables de sesi\u00f3n no est\u00e1n definidas, se les dar\u00e1 el valor 0. Las franjas correspondientes a los votos se alargan de 10px en 10px y no tienen l\u00edmite de tama\u00f1o. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 <?php // Accedemos a la sesi\u00f3n session_name(\"sesion1\"); session_start(); // Si alg\u00fan contador no est\u00e1 guardado en la sesi\u00f3n, ponemos ambos a cero if (!isset($_SESSION[\"a\"]) || !isset($_SESSION[\"b\"])) { $_SESSION[\"a\"] = $_SESSION[\"b\"] = 0; } ?> <!-- ... --> <body> <h2>Votar una opci\u00f3n</h2> <form action=\"ps2.php\" method=\"get\"> <table> <tr> <td style=\"vertical-align: top;\"> <button type=\"submit\" name=\"accion\" value=\"a\" style=\"font-size: 60px; line-height: 50px; color: hwb(200 0% 0%);\"> &#x2714; </button> </td> <td> <?php // Dibujamos la primera barra print \" <svg width=\\\"$_SESSION[a]\\\" height=\\\"50\\\">\\n\"; print \" <line x1=\\\"0\\\" y1=\\\"25\\\" x2=\\\"$_SESSION[a]\\\" y2=\\\"25\\\" stroke=\\\"hwb(200 0% 0%)\\\" stroke-width=\\\"50\\\" />\\n\"; print \" </svg>\\n\"; ?> </td> </tr> <tr> <td> <button type=\"submit\" name=\"accion\" value=\"b\" style=\"font-size: 60px; line-height: 50px; color: hwb(35 0% 0%)\">&#x2714; </button> </td> <?php // Dibujamos la segunda barra print \" <td>\\n\"; print \" <svg width=\\\"$_SESSION[b]\\\" height=\\\"50\\\">\\n\"; print \" <line x1=\\\"0\\\" y1=\\\"25\\\" x2=\\\"$_SESSION[b]\\\" y2=\\\"25\\\" stroke=\\\"hwb(35 0% 0%)\\\" stroke-width=\\\"50\\\" />\\n\"; print \" </svg>\\n\"; print \" </td>\\n\"; ?> </tr> </table> <p> <button type=\"submit\" name=\"accion\" value=\"cero\">Poner a cero</button> </p> </form> </body> </html> Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <?php session_name(\"sesion1\"); session_start(); // Si alguno de los n\u00fameros de votos no est\u00e1 guardado en la sesi\u00f3n, redirigimos a la primera p\u00e1gina if (!isset($_SESSION[\"a\"]) || !isset($_SESSION[\"b\"])) { header(\"Location:ps1.php\"); exit; } $accion = $_GET['accion']; // Dependiendo de la acci\u00f3n recibida, modificamos el n\u00famero correspondiente if ($accion == \"a\") { $_SESSION[\"a\"] += 10; } elseif ($accion == \"b\") { $_SESSION[\"b\"] += 10; } elseif ($accion == \"cero\") { $_SESSION[\"a\"] = $_SESSION[\"b\"] = 0; } // Volvemos al formulario header(\"Location:ps1.php\");","title":"sesi\u00f3n"},{"location":"ud04/ud04_ProgramacionWeb/#autenticacion-de-usuarios","text":"Una sesi\u00f3n establece una relaci\u00f3n an\u00f3nima con un usuario particular, de manera que podemos saber si es el mismo usuario entre dos peticiones distintas. Si preparamos un sistema de login, podremos saber qui\u00e9n utiliza nuestra aplicaci\u00f3n. Para ello, preparemos un sencillo sistema de autenticaci\u00f3n: Mostrar el formulario login/password. Comprobar los datos enviados. A\u00f1adir el login a la sesi\u00f3n. Comprobar el login en la sesi\u00f3n para realizar tareas espec\u00edficas del usuario. Eliminar el login de la sesi\u00f3n cuando el usuario la cierra. Vamos a ver en c\u00f3digo cada paso del proceso. Comenzamos con el archivo index.php : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <form action='login.php' method='post'> <fieldset> <legend>Login</legend> <div><span class='error'> <?php echo $error ; ?> </span></div> <div class='fila'> <label for='usuario'>Usuario:</label><br /> <input type='text' name='inputUsuario' id='usuario' maxlength=\"50\" /><br /> </div> <div class='fila'> <label for='password'>Contrase\u00f1a:</label><br /> <input type='password' name='inputPassword' id='password' maxlength=\"50\" /><br /> </div> <div class='fila'> <input type='submit' name='enviar' value='Enviar' /> </div> </fieldset> </form> Al hacer submit nos lleva a login.php , el cual hace de controlador: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php // Comprobamos si ya se ha enviado el formulario if ( isset ( $_POST [ 'enviar' ])) { $usuario = $_POST [ 'inputUsuario' ]; $password = $_POST [ 'inputPassword' ]; // validamos que recibimos ambos par\u00e1metros if ( empty ( $usuario ) || empty ( $password )) { $error = \"Debes introducir un usuario y contrase\u00f1a\" ; include \"index.php\" ; } else { if ( $usuario == \"admin\" && $password == \"admin\" ) { // almacenamos el usuario en la sesi\u00f3n session_start (); $_SESSION [ 'usuario' ] = $usuario ; // cargamos la p\u00e1gina principal include \"main.php\" ; } else { // Si las credenciales no son v\u00e1lidas, se vuelven a pedir $error = \"Usuario o contrase\u00f1a no v\u00e1lidos!\" ; include \"index.php\" ; } } } Dependiendo del usuario que se haya logueado, vamos a ir a una vista o a otra. Por ejemplo, en main.php tendr\u00edamos: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 <?php // Recuperamos la informaci\u00f3n de la sesi\u00f3n if ( ! isset ( $_SESSION )) { session_start (); } // Y comprobamos que el usuario se haya autentificado if ( ! isset ( $_SESSION [ 'usuario' ])) { die ( \"Error - debe <a href='index.php'>identificarse</a>.<br />\" ); } ?> <!DOCTYPE html> <html lang=\"es\"> <head> <meta charset=\"UTF-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"> <title>Listado de productos</title> </head> <body> <h1>Bienvenido <? = $_SESSION [ 'usuario' ] ?> </h1> <p>Pulse <a href=\"logout.php\">aqu\u00ed</a> para salir</p> <p>Volver al <a href=\"main.php\">inicio</a></p> <h2>Listado de productos</h2> <ul> <li>Producto 1</li> <li>Producto 2</li> <li>Producto 3</li> </ul> </body> </html> Finalmente, necesitamos la opci\u00f3n de cerrar la sesi\u00f3n que colocamos en logout.php : PHP 1 2 3 4 5 6 7 8 <?php // Recuperamos la informaci\u00f3n de la sesi\u00f3n session_start (); // Y la destruimos session_destroy (); header ( \"Location: index.php\" ); ?> autenticaci\u00f3n en producci\u00f3n En la actualidad la autenticaci\u00f3n de usuario no se realiza gestionando la sesi\u00f3n directamente, sino que se realiza mediante alg\u00fan framekwork que abstrae todo el proceso o la integraci\u00f3n de mecanismos de autenticaci\u00f3n tipo OAuth, como estudiaremos en la \u00faltima unidad mediante Laravel .","title":"autenticaci\u00f3n de usuarios"},{"location":"ud04/ud04_ProgramacionWeb/#referencias","text":"Cookies en PHP Manejo de sesiones en PHP","title":"referencias"},{"location":"ud04/ud04_ProgramacionWeb_actividades/","text":"unit: unidad did\u00e1ctica 4 title: Actividades language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets inicio formularios cookies y sesi\u00f3n autenticaci\u00f3n proyecto Videoclub 3.0 inicio Actividad 401 401server.php : igual que el ejemplo visto en los apuntes muestra los valores de $_SERVER al ejecutar un script en tu ordenador. Prueba a pasarle par\u00e1metros (p.e. nombre y apellidos ) por GET desde 401get.html . En otro ejemplo 401getNada.html no le pases ning\u00fan par\u00e1metro. Prepara un formulario ( 401post.html ) que haga un env\u00edo por POST (p.e. nombre y apellidos ) y compru\u00e9balo de nuevo. Crea una p\u00e1gina ( 401enlace.html ) que tenga un enlace a 401server.php y comprueba el valor de HTTP_REFERER . formularios Actividad 402 402formulario.html y 402formulario.php : Crea un formulario que solicite: Nombre y apellidos. Email. URL p\u00e1gina personal. Sexo ( radio ). N\u00famero de convivientes en el domicilio. Aficiones ( checkboxes ) \u2013 poner m\u00ednimo 4 valores. Men\u00fa favorito ( lista selecci\u00f3n m\u00faltiple ) \u2013 poner m\u00ednimo 4 valores. Muestra los valores cargados en una tabla-resumen. Actividad 403 403validacion.php : a partir del formulario anterior, introduce validaciones en HTML mediante el atributo required de los campos (usa tambi\u00e9n los tipos adecuados para cada campo), y comprueba los tipos de los datos y que cumplen los valores esperados (por ejemplo, en los checkboxes que los valores recogidos forman parte de todos los posibles). Prueba a pasarle datos erroneos via URL y comprobar su comportamiento. Nota : Investiga el uso de la funci\u00f3n filter_var . Actividad 404 404subida.html y 404subida.php : crea un formulario que permita subir un archivo al servidor. Adem\u00e1s del fichero, debe pedir en el mismo formulario dos campos num\u00e9ricos que soliciten la anchura y la altura . Comprueba que tanto el fichero como los datos llegan correctamente. Actividad 405 405subidaImagen.php : modifica el ejercicio anterior para que \u00fanicamente permita subir im\u00e1genes (comprueba la propiedad type del archivo subido). Si el usuario selecciona otro tipo de archivos, se le debe informar del error y permitir que suba un nuevo archivo. En el caso de subir el tipo correcto, visualizar la imagen con el tama\u00f1o de anchura y altura recibido como par\u00e1metro. cookies y sesi\u00f3n Actividad 406 406contadorVisitas.php : Mediante el uso de cookies, informa al usuario de si es su primera visita, o si no lo es, muestre su valor (valor de un contador). Adem\u00e1s, debes permitir que el usuario reinicialice su contador de visitas. Actividad 407 407fondo.php : Mediante el uso de cookies, crea una p\u00e1gina con un desplegable con varios colores, de manera que el usuario pueda cambiar el color de fondo de la p\u00e1gina (atributo bgcolor ). Al cerrar la p\u00e1gina, \u00e9sta debe recordar, al menos durante 24h, el color elegido y la pr\u00f3xima vez que se cargue la pagina, lo haga con el \u00faltimo color seleccionado. Actividad 408 408fondoSesion1.php : Modifica el ejercicio anterior para almacenar el color de fondo en la sesi\u00f3n y no emplear cookies. Adem\u00e1s, debe contener un enlace al siguiente archivo. 408fondoSesion2.php : Debe mostrar el color y dar la posibilidad de: volver a la p\u00e1gina anterior mediante un enlace y mediante otro enlace, vaciar la sesi\u00f3n y volver a la p\u00e1gina anterior. Actividad 409 Haciendo uso de la sesi\u00f3n, vamos a dividir el formulario del ejercicio 402formulario.php en 2 subformularios: 409formulario1.php env\u00eda los datos (nombre y apellidos, email, url y sexo) a 409formulario2.php . 409formulario2.php lee los datos y los mete en la sesi\u00f3n. A continuaci\u00f3n, muestra el resto de campos del formulario a rellenar (convivientes, aficiones y men\u00fa). Env\u00eda estos datos a 409formulario3.php . 409formulario3.php recoge los datos enviados en el paso anterior y junto a los que ya estaban en la sesi\u00f3n, se muestran todos los datos en una tabla/lista desordenada. autenticaci\u00f3n En los siguientes ejercicios vamos a montar una estructura de inicio de sesi\u00f3n similar a la vista en los apuntes. Actividad 410 410index.php : formulario de inicio de sesi\u00f3n Actividad 411 411login.php : hace de controlador, por lo que debe comprobar los datos recibidos (solo permite la entrada de usuario / usuario y si todo es correcto, ceder el control a la vista del siguiente ejercicio. No contiene c\u00f3digo HTML. Actividad 412 412peliculas.php : vista que muestra como t\u00edtulo \"Listado de Pel\u00edculas\", y una lista desordenada con tres pel\u00edculas. Actividad 413 413logout.php : vac\u00eda la sesi\u00f3n y nos lleva de nuevo al formulario de inicio de sesi\u00f3n. No contiene c\u00f3digo HTML Actividad 414 414series.php : A\u00f1ade un nueva vista similar a 412peliculas.php que muestra un \"Listado de Series\" con una lista desordenada con tres series. Tanto 412pelicuas.php como la vista recien creadas, deben tener un peque\u00f1o men\u00fa (sencillo, mediante enlaces) que permita pasar de un listado a otro. Comprueba que si se accede directamente a cualquiera de las vistas sin tener un usuario logueado via URL del navegador, no se muestra el listado. Actividad 415 Modifica tanto el controlador como las vistas para que: los datos los obtenga el controlador (almacena en la sesi\u00f3n un array de pel\u00edculas y otro de series) coloca los datos en la sesi\u00f3n En las vistas, los datos se recuperan de la sesi\u00f3n y se pintan en la lista desordenada recorriendo el array correspondiente. proyecto Videoclub 3.0 Actividad 420 Para el Videoclub, vamos a crear una p\u00e1gina index.php con un formulario que contenga un formulario de login/password. Se comprobar\u00e1n los datos en login.php . Los posibles usuarios son admin/admin o usuario/usuario Si el usuario es correcto, en main.php mostrar un mensaje de bienvenida con el nombre del usuario, junto a un enlace para cerrar la sesi\u00f3n, que lo llevar\u00eda de nuevo al login. Si el usuario es incorrecto, debe volver a cargar el formulario dando informaci\u00f3n al usuario de acceso incorrecto. Actividad 421 Si el usuario es administrador, se cargar\u00e1n en la sesi\u00f3n los datos de soportes y clientes del videoclub que ten\u00edamos en nuestras pruebas. En la siguiente unidad los obtendremos de la base de datos. En mainAdmin.php , adem\u00e1s de la bienvenida, debe mostrar: Listado de clientes Listado de soportes Actividad 422 Vamos a modificar la clase Cliente para almacenar el user y la password de cada cliente. Tras codificar los cambios, modificar el listado de clientes de mainAdmin.php para a\u00f1adir al listado el usuario. Actividad 423 Si el usuario que accede no es administrador y coincide con alguno de los clientes que tenemos cargados tras el login, debe cargar mainCliente.php donde se mostrar\u00e1 un listado de los alquileres del cliente. Para ello, modificaremos la clase Cliente para ofrecer el m\u00e9todo getAlquileres() : array , el cual llamaremos y luego recorreremos para mostrar el listado solicitado. Ahora volvemos a la parte de administraci\u00f3n: Actividad 424 Adem\u00e1s de mostrar el listado de clientes, vamos a ofrecer la opci\u00f3n de dar de alta a un nuevo cliente en formCreateCliente.php . Los datos se enviar\u00e1n mediante POST a createCliente.php que los introducir\u00e1 en la sesi\u00f3n. Una vez creado el cliente, debe volver a cargar mainAdmin.php donde se podr\u00e1 ver el cliente insertado. Si hay alg\u00fan dato incorrecto, debe volver a cargar el formulario de alta. Actividad 425 Crea en formUpdateCliente.php un formulario que permita editar los datos de un cliente. Debes recoger los datos en updateCliente.php Los datos de cliente se deben poder modificar desde la propia p\u00e1gina de un cliente, as\u00ed como desde el listado del administrador. Actividad 426 Desde el listado de clientes del administrador debes ofrecer la posibilidad de borrar un cliente. En el navegador, antes de redirigir al servidor, el usuario debe confirmar mediante JS que realmente desea eliminar al cliente. Finalmente, en removeCliente.php elimina al cliente de la sesi\u00f3n. Una vez eliminado, debe volver al listado de clientes.","title":"ud04 ProgramacionWeb actividades"},{"location":"ud04/ud04_ProgramacionWeb_actividades/#inicio","text":"Actividad 401 401server.php : igual que el ejemplo visto en los apuntes muestra los valores de $_SERVER al ejecutar un script en tu ordenador. Prueba a pasarle par\u00e1metros (p.e. nombre y apellidos ) por GET desde 401get.html . En otro ejemplo 401getNada.html no le pases ning\u00fan par\u00e1metro. Prepara un formulario ( 401post.html ) que haga un env\u00edo por POST (p.e. nombre y apellidos ) y compru\u00e9balo de nuevo. Crea una p\u00e1gina ( 401enlace.html ) que tenga un enlace a 401server.php y comprueba el valor de HTTP_REFERER .","title":"inicio"},{"location":"ud04/ud04_ProgramacionWeb_actividades/#formularios","text":"Actividad 402 402formulario.html y 402formulario.php : Crea un formulario que solicite: Nombre y apellidos. Email. URL p\u00e1gina personal. Sexo ( radio ). N\u00famero de convivientes en el domicilio. Aficiones ( checkboxes ) \u2013 poner m\u00ednimo 4 valores. Men\u00fa favorito ( lista selecci\u00f3n m\u00faltiple ) \u2013 poner m\u00ednimo 4 valores. Muestra los valores cargados en una tabla-resumen. Actividad 403 403validacion.php : a partir del formulario anterior, introduce validaciones en HTML mediante el atributo required de los campos (usa tambi\u00e9n los tipos adecuados para cada campo), y comprueba los tipos de los datos y que cumplen los valores esperados (por ejemplo, en los checkboxes que los valores recogidos forman parte de todos los posibles). Prueba a pasarle datos erroneos via URL y comprobar su comportamiento. Nota : Investiga el uso de la funci\u00f3n filter_var . Actividad 404 404subida.html y 404subida.php : crea un formulario que permita subir un archivo al servidor. Adem\u00e1s del fichero, debe pedir en el mismo formulario dos campos num\u00e9ricos que soliciten la anchura y la altura . Comprueba que tanto el fichero como los datos llegan correctamente. Actividad 405 405subidaImagen.php : modifica el ejercicio anterior para que \u00fanicamente permita subir im\u00e1genes (comprueba la propiedad type del archivo subido). Si el usuario selecciona otro tipo de archivos, se le debe informar del error y permitir que suba un nuevo archivo. En el caso de subir el tipo correcto, visualizar la imagen con el tama\u00f1o de anchura y altura recibido como par\u00e1metro.","title":"formularios"},{"location":"ud04/ud04_ProgramacionWeb_actividades/#cookies-y-sesion","text":"Actividad 406 406contadorVisitas.php : Mediante el uso de cookies, informa al usuario de si es su primera visita, o si no lo es, muestre su valor (valor de un contador). Adem\u00e1s, debes permitir que el usuario reinicialice su contador de visitas. Actividad 407 407fondo.php : Mediante el uso de cookies, crea una p\u00e1gina con un desplegable con varios colores, de manera que el usuario pueda cambiar el color de fondo de la p\u00e1gina (atributo bgcolor ). Al cerrar la p\u00e1gina, \u00e9sta debe recordar, al menos durante 24h, el color elegido y la pr\u00f3xima vez que se cargue la pagina, lo haga con el \u00faltimo color seleccionado. Actividad 408 408fondoSesion1.php : Modifica el ejercicio anterior para almacenar el color de fondo en la sesi\u00f3n y no emplear cookies. Adem\u00e1s, debe contener un enlace al siguiente archivo. 408fondoSesion2.php : Debe mostrar el color y dar la posibilidad de: volver a la p\u00e1gina anterior mediante un enlace y mediante otro enlace, vaciar la sesi\u00f3n y volver a la p\u00e1gina anterior. Actividad 409 Haciendo uso de la sesi\u00f3n, vamos a dividir el formulario del ejercicio 402formulario.php en 2 subformularios: 409formulario1.php env\u00eda los datos (nombre y apellidos, email, url y sexo) a 409formulario2.php . 409formulario2.php lee los datos y los mete en la sesi\u00f3n. A continuaci\u00f3n, muestra el resto de campos del formulario a rellenar (convivientes, aficiones y men\u00fa). Env\u00eda estos datos a 409formulario3.php . 409formulario3.php recoge los datos enviados en el paso anterior y junto a los que ya estaban en la sesi\u00f3n, se muestran todos los datos en una tabla/lista desordenada.","title":"cookies y sesi\u00f3n"},{"location":"ud04/ud04_ProgramacionWeb_actividades/#autenticacion","text":"En los siguientes ejercicios vamos a montar una estructura de inicio de sesi\u00f3n similar a la vista en los apuntes. Actividad 410 410index.php : formulario de inicio de sesi\u00f3n Actividad 411 411login.php : hace de controlador, por lo que debe comprobar los datos recibidos (solo permite la entrada de usuario / usuario y si todo es correcto, ceder el control a la vista del siguiente ejercicio. No contiene c\u00f3digo HTML. Actividad 412 412peliculas.php : vista que muestra como t\u00edtulo \"Listado de Pel\u00edculas\", y una lista desordenada con tres pel\u00edculas. Actividad 413 413logout.php : vac\u00eda la sesi\u00f3n y nos lleva de nuevo al formulario de inicio de sesi\u00f3n. No contiene c\u00f3digo HTML Actividad 414 414series.php : A\u00f1ade un nueva vista similar a 412peliculas.php que muestra un \"Listado de Series\" con una lista desordenada con tres series. Tanto 412pelicuas.php como la vista recien creadas, deben tener un peque\u00f1o men\u00fa (sencillo, mediante enlaces) que permita pasar de un listado a otro. Comprueba que si se accede directamente a cualquiera de las vistas sin tener un usuario logueado via URL del navegador, no se muestra el listado. Actividad 415 Modifica tanto el controlador como las vistas para que: los datos los obtenga el controlador (almacena en la sesi\u00f3n un array de pel\u00edculas y otro de series) coloca los datos en la sesi\u00f3n En las vistas, los datos se recuperan de la sesi\u00f3n y se pintan en la lista desordenada recorriendo el array correspondiente.","title":"autenticaci\u00f3n"},{"location":"ud04/ud04_ProgramacionWeb_actividades/#proyecto-videoclub-30","text":"Actividad 420 Para el Videoclub, vamos a crear una p\u00e1gina index.php con un formulario que contenga un formulario de login/password. Se comprobar\u00e1n los datos en login.php . Los posibles usuarios son admin/admin o usuario/usuario Si el usuario es correcto, en main.php mostrar un mensaje de bienvenida con el nombre del usuario, junto a un enlace para cerrar la sesi\u00f3n, que lo llevar\u00eda de nuevo al login. Si el usuario es incorrecto, debe volver a cargar el formulario dando informaci\u00f3n al usuario de acceso incorrecto. Actividad 421 Si el usuario es administrador, se cargar\u00e1n en la sesi\u00f3n los datos de soportes y clientes del videoclub que ten\u00edamos en nuestras pruebas. En la siguiente unidad los obtendremos de la base de datos. En mainAdmin.php , adem\u00e1s de la bienvenida, debe mostrar: Listado de clientes Listado de soportes Actividad 422 Vamos a modificar la clase Cliente para almacenar el user y la password de cada cliente. Tras codificar los cambios, modificar el listado de clientes de mainAdmin.php para a\u00f1adir al listado el usuario. Actividad 423 Si el usuario que accede no es administrador y coincide con alguno de los clientes que tenemos cargados tras el login, debe cargar mainCliente.php donde se mostrar\u00e1 un listado de los alquileres del cliente. Para ello, modificaremos la clase Cliente para ofrecer el m\u00e9todo getAlquileres() : array , el cual llamaremos y luego recorreremos para mostrar el listado solicitado. Ahora volvemos a la parte de administraci\u00f3n: Actividad 424 Adem\u00e1s de mostrar el listado de clientes, vamos a ofrecer la opci\u00f3n de dar de alta a un nuevo cliente en formCreateCliente.php . Los datos se enviar\u00e1n mediante POST a createCliente.php que los introducir\u00e1 en la sesi\u00f3n. Una vez creado el cliente, debe volver a cargar mainAdmin.php donde se podr\u00e1 ver el cliente insertado. Si hay alg\u00fan dato incorrecto, debe volver a cargar el formulario de alta. Actividad 425 Crea en formUpdateCliente.php un formulario que permita editar los datos de un cliente. Debes recoger los datos en updateCliente.php Los datos de cliente se deben poder modificar desde la propia p\u00e1gina de un cliente, as\u00ed como desde el listado del administrador. Actividad 426 Desde el listado de clientes del administrador debes ofrecer la posibilidad de borrar un cliente. En el navegador, antes de redirigir al servidor, el usuario debe confirmar mediante JS que realmente desea eliminar al cliente. Finalmente, en removeCliente.php elimina al cliente de la sesi\u00f3n. Una vez eliminado, debe volver al listado de clientes.","title":"proyecto Videoclub 3.0"},{"location":"ud05/ud05_HerramientasWeb/","text":"Text Only 1 2 3 4 5 6 7 8 9 10 11 unit: unidad did\u00e1ctica 5 title: Herramientas Web language: ES author: Arturo Blasco subject: Desarrollo Web en Entornos Servidor keywords: [2023-2024, DWES, PHP] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${title} - ${subject} (ver: ${today}) footer:${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}/${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets \u00cdndice duraci\u00f3n y criterios de evaluaci\u00f3n Composer instalaci\u00f3n primeros pasos actualizar librer\u00edas autoload.php Monolog niveles Hola Monolog funcionamiento manejadores canales procesadores formateadores uso de factor\u00edas Documentaci\u00f3n con phpDocumentor instalaci\u00f3n como binario uso del Docker DocBlock documentando el c\u00f3digo Web Scraping Goutte Goutte con selectores CSS Crawler Pruebas con PHPUnit puesta en marcha dise\u00f1ando pruebas aserciones comparando la salida proveedores de datos probando excepciones cobertura de c\u00f3digo referencias duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada : 16 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. \u200b g) Se han utilizado herramientas y entornos para facilitar la programaci\u00f3n, prueba y depuraci\u00f3n del c\u00f3digo. Composer Herramienta por excelencia en PHP para la gesti\u00f3n de librer\u00edas y dependencias, de manera que instala y las actualiza asegurando que todo el equipo de desarrollo tiene el mismo entorno y versiones. Adem\u00e1s, ofrece autoloading de nuestro c\u00f3digo, de manera que no tengamos que hacerlo nosotros \"a mano\". Est\u00e1 escrito en PHP, y pod\u00e9is consultar toda su documentaci\u00f3n en https://getcomposer.org/. Utiliza Packagist como repositorio de librer\u00edas. Funcionalmente, es similar a Maven (Java) / npm (JS). instalaci\u00f3n Si estamos usando XAMPP, hemos de instalar Composer en el propio sistema operativo. Se recomienda seguir las instrucciones oficiales seg\u00fan el sistema operativo a emplear. En cambio, si usamos Docker, necesitamos modificar la configuraci\u00f3n de nuestro contenedor. En nuestro caso, hemos decidido modificar el archivo Dockerfile y a\u00f1adir el siguiente comando: Bash 1 COPY --from = composer:2.0 /usr/bin/composer /usr/local/bin/composer Para facilitar el trabajo, hemos creado una plantilla ya preparada . Es importante que dentro del contenedor comprobemos que tenemos la v2: Bash 1 composer -V primeros pasos Cuando creemos un proyecto por primera vez, hemos de inicializar el repositorio. Para ello, ejecutaremos el comando composer init donde: Configuramos el nombre del paquete, descripci\u00f3n, autor (nombre ), tipo de paquete (project), etc... Definimos las dependencias del proyecto ( require ) y las de desarrollo ( require-dev ) de manera interactiva. En las de desarrollo se indica aquellas que no se instalar\u00e1n en el entorno de producci\u00f3n, por ejemplo, las librer\u00edas de pruebas. Tras su configuraci\u00f3n, se crear\u00e1 autom\u00e1ticamente el archivo composer.json con los datos introducidos y descarga las librer\u00edas en la carpeta vendor . La instalaci\u00f3n de las librer\u00edas siempre se realiza de manera local para cada proyecto. JSON 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 { \"name\" : \"dwes/log\" , \"description\" : \"Pruebas con Monolog\" , \"type\" : \"project\" , \"require\" : { \"monolog/monolog\" : \"^2.1\" }, \"license\" : \"MIT\" , \"authors\" : [ { \"name\" : \"Nombre Apellido\" , // ejemplo: Carmen Llopis \"email\" : \"inicialNombre.Apellido@edu.gva.es\" // ejemplo: c.llopis@edu.gva.es } ] } A la hora de indicar cada librer\u00eda introduciremos: el nombre de la librer\u00eda, compuesta tanto por el creador o \"vendor\", como por el nombre del proyecto. Ejemplos: monolog/monolog o laravel/installer . la versi\u00f3n de cada librer\u00eda. Tenemos diversas opciones para indicarla: Directamente: 1.4.2 Con comodines: 1.* A partir de: >= 2.0.3 Sin rotura de cambios: ^1.3.2 // >=1.3.2 <2.0.0 actualizar librer\u00edas Podemos definir las dependencias via el archivo composer.json o mediante comandos con el formato composer require vendor/package:version. Por ejemplo, si queremos a\u00f1adir phpUnit como librer\u00eda de desarrollo, haremos: Bash 1 composer require phpunit/phpunit \u2013dev Tras a\u00f1adir nuevas librer\u00edas, hemos de actualizar nuestro proyecto: Bash 1 composer update Si creamos el archivo composer.json nosotros directamente sin inicializar el repositorio, hemos de instalar las dependencias: Bash 1 composer install Al hacer este paso (tanto instalar como actualizar), como ya hemos comentado, se descargan las librer\u00edas en dentro de la carpeta vendor . Es muy importante a\u00f1adir esta carpeta al archivo .gitignore para no subirlas a GitHub. Adem\u00e1s se crea el archivo composer.lock , que almacena la versi\u00f3n exacta que se ha instalado de cada librer\u00eda (este archivo no se toca). autoload.php Composer crea de forma autom\u00e1tica en vendor/autoload.php el c\u00f3digo para incluir de forma autom\u00e1tica todas las librer\u00edas que tengamos configuradas en composer.json . Para utilizarlo, en la cabecera de nuestro archivos pondremos: PHP 1 2 <?php require 'vendor/autoload.php' ; En nuestro caso, de momento s\u00f3lo lo podremos en los archivos donde probamos las clases Si queremos que Composer tambi\u00e9n se encargue de cargar de forma autom\u00e1tica nuestras clases de dominio, dentro del archivo composer.json , definiremos la propiedad autoload : PHP 1 2 3 \"autoload\": { \"psr-4\": {\"Dwes\\\\\": \"app/Dwes\"} }, Posteriormente, hemos de volver a generar el autoload de Composer mediante la opci\u00f3n dump-autoload (o du ): Bash 1 composer dump-autoload Monolog Vamos a probar Composer a\u00f1adiendo la librer\u00eda de Monolog a nuestro proyecto. Se trata de un librer\u00eda para la gesti\u00f3n de logs de nuestras aplicaciones, soportando diferentes niveles (info, warning, etc...), salidas (ficheros, sockets, BBDD, Web Services, email, etc) y formatos (texto plano, HTML, JSON, etc...). Para ello, incluiremos la librer\u00eda en nuestro proyecto con: Bash 1 composer require monolog/monolog Monolog 2 requiere al menos PHP 7.2, cumple con el estandar de logging PSR-3, y es la librer\u00eda empleada por Laravel y Symfony para la gesti\u00f3n de logs. c\u00f3mo usar un log Seguir las acciones/movimientos de los usuarios Registrar las transacciones Rastrear los errores de usuario Fallos/avisos a nivel de sistema Interpretar y coleccionar datos para posterior investigaci\u00f3n de patrones niveles A continuaci\u00f3n mostramos los diferentes niveles de menos a m\u00e1s restrictivo: debug -100 : Informaci\u00f3n detallada con prop\u00f3sitos de debug. No usar en entornos de producci\u00f3n. info - 200 : Eventos interesantes como el inicio de sesi\u00f3n de usuarios. notice - 250 : Eventos normales pero significativos. warning - 300 : Ocurrencias excepcionales que no llegan a ser error. error - 400 : Errores de ejecuci\u00f3n que permiten continuar con la ejecuci\u00f3n de la aplicaci\u00f3n pero que deben ser monitorizados. critical - 500 : Situaciones importantes donde se generan excepciones no esperadas o no hay disponible un componente. alert - 550 : Se deben tomar medidas inmediatamente. Ca\u00edda completa de la web, base de datos no disponible, etc... Adem\u00e1s, se suelen enviar mensajes por email. emergency - 600 : Es el error m\u00e1s grave e indica que todo el sistema est\u00e1 inutilizable. Hola Monolog Por ejemplo, en el archivo pruebaLog.php que colocar\u00edamos en el ra\u00edz, primero incluimos el autoload , importamos las clases a utilizar para finalmente usar los m\u00e9todos de Monolog: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php include __DIR__ . \"/vendor/autoload.php\" ; use Monolog\\Logger ; use Monolog\\Handler\\StreamHandler ; $log = new Logger ( \"MiLogger\" ); $log -> pushHandler ( new StreamHandler ( \"logs/milog.log\" , Logger :: DEBUG )); $log -> debug ( \"Esto es un mensaje de DEBUG\" ); $log -> info ( \"Esto es un mensaje de INFO\" ); $log -> warning ( \"Esto es un mensaje de WARNING\" ); $log -> error ( \"Esto es un mensaje de ERROR\" ); $log -> critical ( \"Esto es un mensaje de CRITICAL\" ); $log -> alert ( \"Esto es un mensaje de ALERT\" ); En todos los m\u00e9todos de registro de mensajes ( debug , info , ...), adem\u00e1s del propio mensaje, le podemos pasar informaci\u00f3n como el contenido de alguna variable, usuario de la aplicaci\u00f3n, etc.. como segundo par\u00e1metro dentro de un array, el cual se conoce como array de contexto . Es conveniente hacerlo mediante un array asociativo para facilitar la lectura del log. PHP 1 2 3 <?php $log -> warning ( \"Producto no encontrado\" , [ $producto ]); $log -> warning ( \"Producto no encontrado\" , [ \"datos\" => $producto ]); funcionamiento Cada instancia Logger tiene un nombre de canal y una pila de manejadores ( handler ). Cada mensaje que mandamos al log atraviesa la pila de manejadores, y cada uno decide si debe registrar la informaci\u00f3n, y si se da el caso, finalizar la propagaci\u00f3n. Por ejemplo, un StreamHandler en el fondo de la pila que lo escriba todo en disco, y en el tope a\u00f1ade un MailHandler que env\u00ede un mail s\u00f3lo cuando haya un error. manejadores Cada manejador tambien tiene un formateador ( Formatter ). Si no se indica ninguno, se le asigna uno por defecto. El \u00faltimo manejador insertado ser\u00e1 el primero en ejecutarse. Luego se van ejecutando conforme a la pila. Los manejadores m\u00e1s utilizados son: StreamHandler(ruta, nivel) RotatingFileHandler(ruta, maxFiles, nivel) NativeMailerHandler(para, asunto, desde, nivel) FirePHPHandler(nivel) Si queremos que los mensajes de la aplicaci\u00f3n salgan por el log del servidor, en nuestro caso el archivo error.log de Apache utilizaremos como ruta la salida de error: PHP 1 2 3 <?php // error.log $log -> pushHandler ( new StreamHandler ( \"php://stderr\" , Logger :: DEBUG )); FirePHP Por ejemplo, mediante FirePHPHandler, podemos utilizar FirePHP, la cual es una herramienta para hacer debug en la consola de Firefox. Tras instalar la extensi\u00f3n en Firefox, habilitar las opciones y configurar el Handler, podemos ver los mensajes coloreados con sus datos: PHP 1 2 3 4 5 6 7 8 <?php $log = new Logger ( \"MiFirePHPLogger\" ); $log -> pushHandler ( new FirePHPHandler ( Logger :: INFO )); $datos = [ \"real\" => \"Bruce Wayne\" , \"personaje\" => \"Batman\" ]; $log -> debug ( \"Esto es un mensaje de DEBUG\" , $datos ); $log -> info ( \"Esto es un mensaje de INFO\" , $datos ); $log -> warning ( \"Esto es un mensaje de WARNING\" , $datos ); canales Se les asigna al crear el Logger. En grandes aplicaciones, se crea un canal por cada subsistema: ventas, contabilidad, almac\u00e9n. No es una buena pr\u00e1ctica usar el nombre de la clase como canal, esto se hace con un procesador . Para su uso, es recomiendo asignar el log a una propiedad privada a Logger, y posteriormente, en el constructor de la clase, asignar el canal, manejadores y formato. PHP 1 2 3 4 <?php $this -> log = new Logger ( \"MiApp\" ); $this -> log -> pushHandler ( new StreamHandler ( \"logs/milog.log\" , Logger :: DEBUG )); $this -> log -> pushHandler ( new FirePHPHandler ( Logger :: DEBUG )); Y dentro de los m\u00e9todos para escribir en el log: PHP 1 2 <?php $this -> log -> warning ( \"Producto no encontrado\" , [ $producto ]); procesadores Los procesadores permiten a\u00f1adir informaci\u00f3n a los mensajes. Para ello, se apilan despu\u00e9s de cada manejador mediante el m\u00e9todo pushProcessor($procesador) . Algunos procesadores conocidos son IntrospectionProcessor (muestran la linea, fichero, clase y metodo desde el que se invoca el log), WebProcessor (a\u00f1ade la URI, m\u00e9todo e IP) o GitProcessor (a\u00f1ade la rama y el commit). PHP PHP 1 2 3 4 5 6 7 <?php $log = new Logger ( \"MiLogger\" ); $log -> pushHandler ( new RotatingFileHandler ( \"logs/milog.log\" , 0 , Logger :: DEBUG )); $log -> pushProcessor ( new IntrospectionProcessor ()); $log -> pushHandler ( new StreamHandler ( \"php://stderr\" , Logger :: WARNING )); // no usa Introspection pq lo hemos apilado despu\u00e9s, le asigno otro $log -> pushProcessor ( new WebProcessor ()); Consola en formato texto Bash 1 2 [ 2020 -11-26T13:35:31.076138+01:00 ] MiLogger.DEBUG: Esto es un mensaje de DEBUG [] { \"file\" : \"C:\\\\xampp\\\\htdocs\\\\log\\\\procesador.php\" , \"line\" :12, \"class\" :null, \"function\" :null } [ 2020 -11-26T13:35:31.078344+01:00 ] MiLogger.INFO: Esto es un mensaje de INFO [] { \"file\" : \"C:\\\\xampp\\\\htdocs\\\\log\\\\procesador.php\" , \"line\" :13, \"class\" :null, \"function\" :null } formateadores Se asocian a los manejadores con setFormatter. Los formateadores m\u00e1s utilizados son LineFormatter, HtmlFormatter o JsonFormatter. PHP PHP 1 2 3 4 5 <?php $log = new Logger ( \"MiLogger\" ); $rfh = new RotatingFileHandler ( \"logs/milog.log\" , Logger :: DEBUG ); $rfh -> setFormatter ( new JsonFormatter ()); $log -> pushHandler ( $rfh ); Consola en JSON Bash 1 2 { \"message\" : \"Esto es un mensaje de DEBUG\" , \"context\" : {} , \"level\" :100, \"level_name\" : \"DEBUG\" , \"channel\" : \"MiLogger\" , \"datetime\" : \"2020-11-27T15:36:52.747211+01:00\" , \"extra\" : {}} { \"message\" : \"Esto es un mensaje de INFO\" , \"context\" : {} , \"level\" :200, \"level_name\" : \"INFO\" , \"channel\" : \"MiLogger\" , \"datetime\" : \"2020-11-27T15:36:52.747 m\u00e1s informaci\u00f3n M\u00e1s informaci\u00f3n sobre manejadores, formateadores y procesadores en https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md uso de factor\u00edas En vez de instanciar un log en cada clase, es conveniente crear una factor\u00eda (por ejemplo, siguiendo la idea del patr\u00f3n de dise\u00f1o Factory Method ). Para el siguiente ejemplo, vamos a suponer que creamos la factor\u00eda en el namespace Dwes\\Ejemplos\\Util . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace Dwes\\Ejemplos\\Util use Monolog\\Logger ; use Monolog\\Handler\\StreamHandler ; class LogFactory { public static function getLogger ( string $canal = \"miApp\" ) : Logger { $log = new Logger ( $canal ); $log -> pushHandler ( new StreamHandler ( \"logs/miApp.log\" , Logger :: DEBUG )); return $log ; } } Si en vez de devolver un Monolog\\Logger utilizamos el interfaz de PSR, si en el futuro cambiamos la implementaci\u00f3n del log, no tendremos que modificar nuestro codigo. As\u00ed pues, la factor\u00eda ahora devolver\u00e1 Psr\\Log\\LoggerInterface : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php namespace Dwes\\Ejemplos\\Util use Monolog\\Handler\\StreamHandler ; use Monolog\\Logger ; use Psr\\Log\\LoggerInterface ; class LogFactory { public static function getLogger ( string $canal = \"miApp\" ) : LoggerInterface { $log = new Logger ( $canal ); $log -> pushHandler ( new StreamHandler ( \"log/miApp.log\" , Logger :: DEBUG )); return $log ; } } Finalmente, para utilizar la factor\u00eda, s\u00f3lo cambiamos el c\u00f3digo que ten\u00edamos en el constructor de las clases que usan el log, quedando algo asi: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php namespace Dwes\\Ejemplos\\Util use Monolog\\Handler\\StreamHandler ; use Monolog\\Logger ; use Psr\\Log\\LoggerInterface ; class LogFactory { public static function getLogger ( string $canal = \"miApp\" ) : LoggerInterface { $log = new Logger ( $canal ); $log -> pushHandler ( new StreamHandler ( \"log/miApp.log\" , Logger :: DEBUG )); return $log ; } } Documentaci\u00f3n con phpDocumentor phpDocumentor es la herramienta de facto para documentar el c\u00f3digo PHP. Es similar en prop\u00f3sito y funcionamiento a Javadoc . As\u00ed pues, es un herramienta que facilita la documentaci\u00f3n del c\u00f3digo PHP, creando un sitio web con el API de la aplicaci\u00f3n. Se basa en el uso de anotaciones sobre los docblocks. Para ponerlo en marcha, en nuestro caso nos decantaremos por utilizar la imagen que ya existe de Docker. instalaci\u00f3n como binario Otra opci\u00f3n es seguir los pasos que recomienda la documentaci\u00f3n oficial para instalarlo como un ejecutable, que son descargar el archivo phpDocumentor.phar y darles permisos de ejecuci\u00f3n: Bash 1 2 3 4 wget https://phpdoc.org/phpDocumentor.phar chmod +x phpDocumentor.phar mv phpDocumentor.phar /usr/local/bin/phpdoc phpdoc --version Una vez instalado, desde el ra\u00edz del proyecto, suponiendo que tenemos nuestro c\u00f3digo dentro de app y que queremos la documentaci\u00f3n dentro de docs/api ejecutamos: Bash 1 phpdoc -d ./app -t docs/api uso del Docker En el caso de usar Docker, usaremos el siguiente comando para ejecutarlo (crea el contenedor, ejecuta el comando que le pidamos, y autom\u00e1ticamente lo borra): Docker 1 docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 A dicho comando, le adjuntaremos los diferentes par\u00e1metros que admite phpDocumentor, por ejemplo: Bash 1 2 3 4 5 # Muestra la versi\u00f3n docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 --version # Mediante -d se indica el origen a parsear # Mediante -t se indica el destino donde generar la documentaci\u00f3n docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 -d ./src/app -t ./docs/api DocBlock Un docblock es el bloque de c\u00f3digo que se coloca encima de un recurso. Su formato es: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php /* * *Sumario*, una sola l\u00ednea * * *Descripci\u00f3n* que puede utilizar varias l\u00edneas * y que ofrece detalles del elemento o referencias * para ampliar la informaci\u00f3n * * @param string $miArgumento con una *descripci\u00f3n* del argumento * que puede usar varias l\u00edneas. * * @return void */ function miFuncion ( tipo $miArgumento ) { } documentando el c\u00f3digo En todos los elementos, ademas del sumario y/o descripci\u00f3n, pondremos: En las clases: @author nombre @package ruta del namespace En las propiedades: @var tipo descripci\u00f3n En los m\u00e9todos: @param tipo $nombre descripci\u00f3n @throws ClaseException descripci\u00f3n @return tipo descripci\u00f3n Ve\u00e1moslo con un ejemplo. Supongamos que tenemos una clase que representa un cliente: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 <?php /* * Clase que representa un cliente * * El cliente se encarga de almacenar los soportes que tiene alquilado, * de manera que podemos alquilar y devolver productos mediante las operaciones * hom\u00f3nimas. * * @package Dwes\\Videoclub\\Model * @author Aitor Medrano <a.medrano@edu.gva.es> */ class Cliente { public string $nombre ; private string $numero ; /* * Colecci\u00f3n de soportes alquilados * @var array<Soporte> */ private $soportesAlquilados []; /* * Comprueba si el soporte recibido ya lo tiene alquilado el cliente * @param Soporte $soporte Soporte a comprobar * @return bool true si lo tiene alquilado */ public function tieneAlquilado ( Soporte $soporte ) : bool { // ... } Si generamos la documentaci\u00f3n y abrimos con un navegador el archivo docs/api/index.html podremos navegar hasta la clase Cliente : Web Scraping Consiste en navegar a una p\u00e1gina web y extraer informaci\u00f3n autom\u00e1ticamente, a partir del c\u00f3digo HTML generado, y organizar la informaci\u00f3n p\u00fablica disponible en Internet. Esta pr\u00e1ctica requiere el uso de una librer\u00eda que facilite la descarga de la informaci\u00f3n deseada imitando la interacci\u00f3n de un navegador web. Este \"robot\" puede acceder a varias p\u00e1ginas simult\u00e1neamente. es legal? Si el sitio web indica que tiene el contenido protegido por derechos de autor o en las normas de acceso via usuario/contrase\u00f1a nos avisa de su prohibici\u00f3n, estar\u00edamos incurriendo en un delito. Es recomendable estudiar el archivo robots.txt que se encuentra en el ra\u00edz de cada sitio web. M\u00e1s informaci\u00f3n en el art\u00edculo El manual completo para el web scraping legal y \u00e9tico en 2021 . Goutte Goutte es un sencillo cliente HTTP para PHP creado espec\u00edficamente para hacer web scraping. Lo desarroll\u00f3 el mismo autor del framework Symfony y ofrece un API sencilla para extraer datos de las respuestas HTML/XML de los sitios web. Datos : Revisar https://godofredo.ninja/web-scraping-con-php-utilizando-goutte/ Los componentes principales que abstrae Goutte sobre Symfony son: BrowserKit : simula el comportamiento de un navegador web. CssSelector : traduce consultas CSS en consultas XPath. DomCrawler : facilita el uso del DOM y XPath. Para poder utilizar Goutte en nuestro proyecto, ejecutaremos el siguiente comando en el terminal: Bash 1 composer require fabpot/goutte Goutte con selectores CSS A continuaci\u00f3n vamos a hacer un ejemplo muy sencillo utilizando los selectores CSS, extrayendo informaci\u00f3n de la web https://books.toscrape.com/ , la cual es una p\u00e1gina para pruebas que no rechazar\u00e1 nuestras peticiones. Tras crear un cliente con Goutte, hemos de realizar un petici\u00f3n a una URL. Con la respuesta obtenida, podemos utilizar el m\u00e9todo filter para indicarle la ruta CSS que queremos recorrer e iterar sobre los resultados mediante una funci\u00f3n an\u00f3nima. Una vez estamos dentro de un determinado nodo, el m\u00e9todo text() nos devolver\u00e1 el contenido del propio nodo. En concreto, vamos a meter en un array asociativo el t\u00edtulo y el precio de todos los libros de la categor\u00eda Classics . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <?php require '../vendor/autoload.php' ; $httpClient = new \\Goutte\\Client (); $response = $httpClient -> request ( 'GET' , 'https://books.toscrape.com/catalogue/category/books/classics_6/index.html' ); // colocamos los precios en un array $precios = []; $response -> filter ( '.row li article div.product_price p.price_color' ) -> each ( // le pasamos $precios por referencia para poder editarla dentro del closure function ( $node ) use ( & $precios ) { $precios [] = $node -> text (); } ); // colocamos el nombre y el precio en un array asociativo $contadorPrecios = 0 ; $libros = []; $response -> filter ( '.row li article h3 a' ) -> each ( function ( $node ) use ( $precios , & $contadorPrecios , & $libros ) { $libros [ $node -> text ()] = $precios [ $contadorPrecios ]; $contadorPrecios ++ ; } Crawler Un caso muy com\u00fan es obtener la informaci\u00f3n de una p\u00e1gina que tiene los resultados paginados, de manera que vayamos recorriendo los enlaces y accediendo a cada uno de los resultados. En este caso vamos a coger todos los precios de los libros de fantas\u00eda, y vamos a sumarlos: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 <?php require '../vendor/autoload.php' ; use Goutte\\Client ; use Symfony\\Component\\HttpClient\\HttpClient ; $client = new Client ( HttpClient :: create ([ 'timeout' => 60 ])); $crawler = $client -> request ( 'GET' , 'https://books.toscrape.com/catalogue/category/books/fantasy_19/index.html' ); $salir = false ; $precios = []; while ( ! $salir ) { $crawler -> filter ( '.row li article div.product_price p.price_color' ) -> each ( function ( $node ) use ( & $precios ) { $texto = $node -> text (); $cantidad = substr ( $texto , 2 ); // Le quitamos las libras \u00bf2 posiciones? $precios [] = floatval ( $cantidad ); } ); $enlace = $crawler -> selectLink ( 'next' ); if ( $enlace -> count () != 0 ) { // el enlace next existe $sigPag = $crawler -> selectLink ( 'next' ) -> link (); $crawler = $client -> click ( $sigPag ); // hacemos click } else { // ya no hay enlace next $salir = true ; } } $precioTotal = array_sum ( $precios ); echo $precioTotal ; Pruebas con PHPUnit El curso pasado, dentro del m\u00f3dulo de Entornos de Desarrollo, estudiamos la importancia de la realizaci\u00f3n de pruebas, as\u00ed como las pruebas unitarias mediante JUnit . A d\u00eda de hoy es de gran importancia seguir una buena metodolog\u00eda de pruebas, siendo el desarrollo dirigido por las pruebas (Test Driven Development / TDD) uno de los enfoques m\u00e1s empleados, el cual consiste en: Escribir el test, y como no hay c\u00f3digo implementado, la prueba falle (rojo). Escribir el c\u00f3digo de aplicaci\u00f3n para que la prueba funcione (verde). Refactorizar el c\u00f3digo de la aplicaci\u00f3n con la ayuda de la prueba para comprobar que no rompemos nada (refactor). En el caso de PHP, la herramienta que se utiliza es PHPUnit (https://phpunit.de/), que como su nombre indica, est\u00e1 basada en JUnit. La versi\u00f3n actual es la 9.0 Se recomienda consultar su documentaci\u00f3n en https://phpunit.readthedocs.io/es/latest/index.html. puesta en marcha Vamos a colocar todas las pruebas en una carpeta tests en el ra\u00edz de nuestro proyecto. En el archivo composer.json, a\u00f1adimos: PHP 1 2 3 4 5 6 \"require-dev\": { \"phpunit/phpunit\": \"^9\" }, \"scripts\": { \"test\": \"phpunit --testdox --colors tests\" } Si quisi\u00e9ramos a\u00f1adir la librer\u00eda desde un comando del terminal, tambi\u00e9n podr\u00edamos ejecutar: PHP 1 composer require --dev phpunit/phpunit ^9 librer\u00edas de desarrollo Las librer\u00edas que se colocan en require-dev son las de desarrollo y testing , de manera que no se instalar\u00e1n en un entorno de producci\u00f3n. Como hemos creado un script, podemos lanzar las pruebas mediante: Text Only 1 composer test Vasmos a realizar nuestra primera prueba: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php use PHPUnit\\Framework\\TestCase ; class PilaTest extends TestCase { public function testPushAndPop () { $pila = []; $this -> assertSame ( 0 , count ( $pila )); array_push ( $pila , 'batman' ); $this -> assertSame ( 'batman' , $pila [ count ( $pila ) - 1 ]); $this -> assertSame ( 1 , count ( $pila )); $this -> assertSame ( 'batman' , array_pop ( $pila )); $this -> assertSame ( 0 , count ( $pila )); } } Tenemos diferentes formas de ejecutar una prueba: Bash 1 2 3 4 ./vendor/bin/phpunit tests/PilaTest.php ./vendor/bin/phpunit tests ./vendor/bin/phpunit --testdox tests ./vendor/bin/phpunit --testdox --colors tests dise\u00f1ando pruebas Tal como hemos visto en el ejemplo, la clase de prueba debe heredar de TestCase , y el nombre de la clase debe acabar en Test, de ah\u00ed que hayamos llamado la clase de prueba como PilaTest . Una prueba implica un m\u00e9todo de prueba (p\u00fablico) por cada funcionalidad a probar. Cada un de los m\u00e9todos se les asocia un caso de prueba. Los m\u00e9todos deben nombrarse con el prefijo test , por ejemplo, testPushAndPop . Es muy importante que el nombre sea muy claro y descriptivo del prop\u00f3sito de la prueba. ( camelCase ). En los casos de prueba prepararemos varias aserciones para toda la casu\u00edstica: rangos de valores, tipos de datos, excepciones, etc... aserciones Las aserciones permiten comprobar el resultado de los m\u00e9todos que queremos probar. Las aserciones esperan que el predicado siempre sea verdadero. PHPUnit ofrece las siguiente aserciones: assertTrue / assertFalse : Comprueba que la condici\u00f3n dada sea evaluada como true / false . assertEquals / assertSame : Comprueba que dos variables sean iguales. assertNotEquals / assertNotSame : Comprueba que dos variables NO sean iguales. Same \u2192 comprueba los tipos. Si no coinciden los tipos y los valores, la aserci\u00f3n fallar\u00e1. Equals \u2192 sin comprobaci\u00f3n estricta. assertArrayHasKey / assertArrayNotHasKey : Comprueba que un array posea un key determinado / o NO lo posea assertArraySubset : Comprueba que un array posea otro array como subset del mismo assertAttributeContains / assertAttributeNotContains : Comprueba que un atributo de una clase contenga una variable determinada / o NO contenga una variable determinada assertAttributeEquals : Comprueba que un atributo de una clase sea igual a una variable determinada. comparando la salida Si los m\u00e9todos a probar generan contenido mediante echo o una instrucci\u00f3n similar, disponemos de las siguiente expectativas: expectOutputString(salidaEsperada) expectOutputRegex(expresionRegularEsperada) Las expectativas difieren de las aserciones que informan del resultado que se espera antes de invocar al m\u00e9todo. Tras definir la expectativa, se invoca al m\u00e9todo que realiza el echo / print . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php namespace Dwes\\Videoclub\\Model ; use PHPUnit\\Framework\\TestCase ; use Dwes\\Videoclub\\Model\\CintaVideo ; class CintaVideoTest extends TestCase { public function testConstructor () { $cinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $this -> assertSame ( $cinta -> getNumero (), 23 ); } public function testMuestraResumen () { $cinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $resultado = \"<br>Pel\u00edcula en VHS:\" ; $resultado .= \"<br>Los cazafantasmas<br>3.5 (IVA no incluido)\" ; $resultado .= \"<br>Duraci\u00f3n: 107 minutos\" ; // definimos la expectativa $this -> expectOutputString ( $resultado ); // invocamos al m\u00e9todo que har\u00e1 echo $cinta -> muestraResumen (); } } proveedores de datos Cuando tenemos pruebas que solo cambian respecto a los datos de entrada y de salida, es \u00fatil utilizar proveedores de datos. Se declaran en el docblock mediante @dataProvider nombreMetodo , donde se indica el nombre de un m\u00e9todo p\u00fablico que devuelve un array de arrays, donde cada elemento es un caso de prueba. La clase de prueba recibe como par\u00e1metros los datos a probar y el resultado de la prueba como \u00faltimo par\u00e1metro. El siguiente ejemplo comprueba con diferentes datos el funcionamiento de muestraResumen : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php /* * @dataProvider cintasProvider */ public function testMuestraResumenConProvider ( $titulo , $id , $precio , $duracion , $esperado ) { $cinta = new CintaVideo ( $titulo , $id , $precio , $duracion ); $this -> expectOutputString ( $esperado ); $cinta -> muestraResumen (); } public function cintasProvider () { return [ \"cazafantasmas\" => [ \"Los cazafantasmas\" , 23 , 3.5 , 107 , \"<br>VHS:<br>Los cazafantasmas<br>3.5 \u20ac(IVA no incluido)<br>Duraci\u00f3n: 107 min\" ], \"superman\" => [ \"Superman\" , 24 , 3 , 188 , \"<br>VHS:<br>Superman<br>3 \u20ac (IVA no incluido)<br>Duraci\u00f3n: 188 min\" ], ]; } probando excepciones Las pruebas adem\u00e1s de comprobar que las clases funcionan como se espera, han de cubrir todos los casos posibles. As\u00ed pues, debemos poder hacer pruebas que esperen que se lance una excepci\u00f3n (y que el mensaje contenga cierta informaci\u00f3n): Para ello, se utilizan las siguiente expectativas: expectException(Excepcion::class) expectExceptionCode(codigoExcepcion) expectExceptionMessage(mensaje) Del mismo modo que antes, primero se pone la expectativa, y luego se provoca que se lance la excepci\u00f3n: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php public function testAlquilarCupoLleno () { $soporte1 = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $soporte2 = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); $soporte3 = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); $soporte4 = new Dvd ( \"El Imperio Contraataca\" , 4 , 3 , \"es,en\" , \"16:9\" ); $cliente1 = new Cliente ( \"Bruce Wayne\" , 23 ); $cliente1 -> alquilar ( $soporte1 ); $cliente1 -> alquilar ( $soporte2 ); $cliente1 -> alquilar ( $soporte3 ); $this -> expectException ( CupoSuperadoException :: class ); $cliente1 -> alquilar ( $soporte4 ); } cobertura de c\u00f3digo La cobertura de pruebas indica la cantidad de c\u00f3digo que las pruebas cubren, siendo recomendable que cubran entre el 95 y el 100%. Una de las m\u00e9tricas asociadas a los informes de cobertura es el CRAP (An\u00e1lisis y Predicciones sobre el Riesgo en Cambios), el cual mide la cantidad de esfuerzo, dolor y tiempo requerido para mantener una porci\u00f3n de c\u00f3digo. Esta m\u00e9trica debe mantenerse con un valor inferior a 5. requisito xdebug Aunque ya viene instalado dentro de PHPUnit, para que funcione la cobertura del c\u00f3digo, es necesario que el c\u00f3digo PHP se ejecute con XDEBUG, y e indicarle a Apache que as\u00ed es (colocando en el archivo de configuraci\u00f3n php.ini la directiva xdebug.mode=coverage ). A\u00f1adimos en composer.json un nuevo script: Text Only 1 \"coverage\": \"phpunit --coverage-html coverage --coverage-filter app tests\" Y posteriormente ejecutamos Text Only 1 composer coverage Por ejemplo, si accedemos a la clase CintaVideo con la prueba que hab\u00edamos realizado anteriormente, podemos observar la cobertura que tiene al 100% y que su CRAP es 2. temas pendientes - Dependencia entre casos de prueba con el atributo @depends - Completamente configurable mediante el archivo phpxml.xml : https://phpunit.readthedocs.io/es/latest/configuration.html - Preparando las pruebas con setUpBeforeClass() y tearDownAfterClass() - Objetos y pruebas Mock (dobles) con createMock() referencias Tutorial de Composer Web Scraping with PHP \u2013 How to Crawl Web Pages Using Open Source Tools PHP Monolog Unit Testing con PHPUnit \u2014 Parte 1, de Emiliano Zublena.","title":"ud05 HerramientasWeb"},{"location":"ud05/ud05_HerramientasWeb/#duracion-y-criterios-de-evaluacion","text":"Duraci\u00f3n estimada : 16 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. \u200b g) Se han utilizado herramientas y entornos para facilitar la programaci\u00f3n, prueba y depuraci\u00f3n del c\u00f3digo.","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud05/ud05_HerramientasWeb/#composer","text":"Herramienta por excelencia en PHP para la gesti\u00f3n de librer\u00edas y dependencias, de manera que instala y las actualiza asegurando que todo el equipo de desarrollo tiene el mismo entorno y versiones. Adem\u00e1s, ofrece autoloading de nuestro c\u00f3digo, de manera que no tengamos que hacerlo nosotros \"a mano\". Est\u00e1 escrito en PHP, y pod\u00e9is consultar toda su documentaci\u00f3n en https://getcomposer.org/. Utiliza Packagist como repositorio de librer\u00edas. Funcionalmente, es similar a Maven (Java) / npm (JS).","title":"Composer"},{"location":"ud05/ud05_HerramientasWeb/#instalacion","text":"Si estamos usando XAMPP, hemos de instalar Composer en el propio sistema operativo. Se recomienda seguir las instrucciones oficiales seg\u00fan el sistema operativo a emplear. En cambio, si usamos Docker, necesitamos modificar la configuraci\u00f3n de nuestro contenedor. En nuestro caso, hemos decidido modificar el archivo Dockerfile y a\u00f1adir el siguiente comando: Bash 1 COPY --from = composer:2.0 /usr/bin/composer /usr/local/bin/composer Para facilitar el trabajo, hemos creado una plantilla ya preparada . Es importante que dentro del contenedor comprobemos que tenemos la v2: Bash 1 composer -V","title":"instalaci\u00f3n"},{"location":"ud05/ud05_HerramientasWeb/#primeros-pasos","text":"Cuando creemos un proyecto por primera vez, hemos de inicializar el repositorio. Para ello, ejecutaremos el comando composer init donde: Configuramos el nombre del paquete, descripci\u00f3n, autor (nombre ), tipo de paquete (project), etc... Definimos las dependencias del proyecto ( require ) y las de desarrollo ( require-dev ) de manera interactiva. En las de desarrollo se indica aquellas que no se instalar\u00e1n en el entorno de producci\u00f3n, por ejemplo, las librer\u00edas de pruebas. Tras su configuraci\u00f3n, se crear\u00e1 autom\u00e1ticamente el archivo composer.json con los datos introducidos y descarga las librer\u00edas en la carpeta vendor . La instalaci\u00f3n de las librer\u00edas siempre se realiza de manera local para cada proyecto. JSON 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 { \"name\" : \"dwes/log\" , \"description\" : \"Pruebas con Monolog\" , \"type\" : \"project\" , \"require\" : { \"monolog/monolog\" : \"^2.1\" }, \"license\" : \"MIT\" , \"authors\" : [ { \"name\" : \"Nombre Apellido\" , // ejemplo: Carmen Llopis \"email\" : \"inicialNombre.Apellido@edu.gva.es\" // ejemplo: c.llopis@edu.gva.es } ] } A la hora de indicar cada librer\u00eda introduciremos: el nombre de la librer\u00eda, compuesta tanto por el creador o \"vendor\", como por el nombre del proyecto. Ejemplos: monolog/monolog o laravel/installer . la versi\u00f3n de cada librer\u00eda. Tenemos diversas opciones para indicarla: Directamente: 1.4.2 Con comodines: 1.* A partir de: >= 2.0.3 Sin rotura de cambios: ^1.3.2 // >=1.3.2 <2.0.0","title":"primeros pasos"},{"location":"ud05/ud05_HerramientasWeb/#actualizar-librerias","text":"Podemos definir las dependencias via el archivo composer.json o mediante comandos con el formato composer require vendor/package:version. Por ejemplo, si queremos a\u00f1adir phpUnit como librer\u00eda de desarrollo, haremos: Bash 1 composer require phpunit/phpunit \u2013dev Tras a\u00f1adir nuevas librer\u00edas, hemos de actualizar nuestro proyecto: Bash 1 composer update Si creamos el archivo composer.json nosotros directamente sin inicializar el repositorio, hemos de instalar las dependencias: Bash 1 composer install Al hacer este paso (tanto instalar como actualizar), como ya hemos comentado, se descargan las librer\u00edas en dentro de la carpeta vendor . Es muy importante a\u00f1adir esta carpeta al archivo .gitignore para no subirlas a GitHub. Adem\u00e1s se crea el archivo composer.lock , que almacena la versi\u00f3n exacta que se ha instalado de cada librer\u00eda (este archivo no se toca).","title":"actualizar librer\u00edas"},{"location":"ud05/ud05_HerramientasWeb/#autoloadphp","text":"Composer crea de forma autom\u00e1tica en vendor/autoload.php el c\u00f3digo para incluir de forma autom\u00e1tica todas las librer\u00edas que tengamos configuradas en composer.json . Para utilizarlo, en la cabecera de nuestro archivos pondremos: PHP 1 2 <?php require 'vendor/autoload.php' ; En nuestro caso, de momento s\u00f3lo lo podremos en los archivos donde probamos las clases Si queremos que Composer tambi\u00e9n se encargue de cargar de forma autom\u00e1tica nuestras clases de dominio, dentro del archivo composer.json , definiremos la propiedad autoload : PHP 1 2 3 \"autoload\": { \"psr-4\": {\"Dwes\\\\\": \"app/Dwes\"} }, Posteriormente, hemos de volver a generar el autoload de Composer mediante la opci\u00f3n dump-autoload (o du ): Bash 1 composer dump-autoload","title":"autoload.php"},{"location":"ud05/ud05_HerramientasWeb/#monolog","text":"Vamos a probar Composer a\u00f1adiendo la librer\u00eda de Monolog a nuestro proyecto. Se trata de un librer\u00eda para la gesti\u00f3n de logs de nuestras aplicaciones, soportando diferentes niveles (info, warning, etc...), salidas (ficheros, sockets, BBDD, Web Services, email, etc) y formatos (texto plano, HTML, JSON, etc...). Para ello, incluiremos la librer\u00eda en nuestro proyecto con: Bash 1 composer require monolog/monolog Monolog 2 requiere al menos PHP 7.2, cumple con el estandar de logging PSR-3, y es la librer\u00eda empleada por Laravel y Symfony para la gesti\u00f3n de logs. c\u00f3mo usar un log Seguir las acciones/movimientos de los usuarios Registrar las transacciones Rastrear los errores de usuario Fallos/avisos a nivel de sistema Interpretar y coleccionar datos para posterior investigaci\u00f3n de patrones","title":"Monolog"},{"location":"ud05/ud05_HerramientasWeb/#niveles","text":"A continuaci\u00f3n mostramos los diferentes niveles de menos a m\u00e1s restrictivo: debug -100 : Informaci\u00f3n detallada con prop\u00f3sitos de debug. No usar en entornos de producci\u00f3n. info - 200 : Eventos interesantes como el inicio de sesi\u00f3n de usuarios. notice - 250 : Eventos normales pero significativos. warning - 300 : Ocurrencias excepcionales que no llegan a ser error. error - 400 : Errores de ejecuci\u00f3n que permiten continuar con la ejecuci\u00f3n de la aplicaci\u00f3n pero que deben ser monitorizados. critical - 500 : Situaciones importantes donde se generan excepciones no esperadas o no hay disponible un componente. alert - 550 : Se deben tomar medidas inmediatamente. Ca\u00edda completa de la web, base de datos no disponible, etc... Adem\u00e1s, se suelen enviar mensajes por email. emergency - 600 : Es el error m\u00e1s grave e indica que todo el sistema est\u00e1 inutilizable.","title":"niveles"},{"location":"ud05/ud05_HerramientasWeb/#hola-monolog","text":"Por ejemplo, en el archivo pruebaLog.php que colocar\u00edamos en el ra\u00edz, primero incluimos el autoload , importamos las clases a utilizar para finalmente usar los m\u00e9todos de Monolog: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php include __DIR__ . \"/vendor/autoload.php\" ; use Monolog\\Logger ; use Monolog\\Handler\\StreamHandler ; $log = new Logger ( \"MiLogger\" ); $log -> pushHandler ( new StreamHandler ( \"logs/milog.log\" , Logger :: DEBUG )); $log -> debug ( \"Esto es un mensaje de DEBUG\" ); $log -> info ( \"Esto es un mensaje de INFO\" ); $log -> warning ( \"Esto es un mensaje de WARNING\" ); $log -> error ( \"Esto es un mensaje de ERROR\" ); $log -> critical ( \"Esto es un mensaje de CRITICAL\" ); $log -> alert ( \"Esto es un mensaje de ALERT\" ); En todos los m\u00e9todos de registro de mensajes ( debug , info , ...), adem\u00e1s del propio mensaje, le podemos pasar informaci\u00f3n como el contenido de alguna variable, usuario de la aplicaci\u00f3n, etc.. como segundo par\u00e1metro dentro de un array, el cual se conoce como array de contexto . Es conveniente hacerlo mediante un array asociativo para facilitar la lectura del log. PHP 1 2 3 <?php $log -> warning ( \"Producto no encontrado\" , [ $producto ]); $log -> warning ( \"Producto no encontrado\" , [ \"datos\" => $producto ]);","title":"Hola Monolog"},{"location":"ud05/ud05_HerramientasWeb/#funcionamiento","text":"Cada instancia Logger tiene un nombre de canal y una pila de manejadores ( handler ). Cada mensaje que mandamos al log atraviesa la pila de manejadores, y cada uno decide si debe registrar la informaci\u00f3n, y si se da el caso, finalizar la propagaci\u00f3n. Por ejemplo, un StreamHandler en el fondo de la pila que lo escriba todo en disco, y en el tope a\u00f1ade un MailHandler que env\u00ede un mail s\u00f3lo cuando haya un error.","title":"funcionamiento"},{"location":"ud05/ud05_HerramientasWeb/#manejadores","text":"Cada manejador tambien tiene un formateador ( Formatter ). Si no se indica ninguno, se le asigna uno por defecto. El \u00faltimo manejador insertado ser\u00e1 el primero en ejecutarse. Luego se van ejecutando conforme a la pila. Los manejadores m\u00e1s utilizados son: StreamHandler(ruta, nivel) RotatingFileHandler(ruta, maxFiles, nivel) NativeMailerHandler(para, asunto, desde, nivel) FirePHPHandler(nivel) Si queremos que los mensajes de la aplicaci\u00f3n salgan por el log del servidor, en nuestro caso el archivo error.log de Apache utilizaremos como ruta la salida de error: PHP 1 2 3 <?php // error.log $log -> pushHandler ( new StreamHandler ( \"php://stderr\" , Logger :: DEBUG )); FirePHP Por ejemplo, mediante FirePHPHandler, podemos utilizar FirePHP, la cual es una herramienta para hacer debug en la consola de Firefox. Tras instalar la extensi\u00f3n en Firefox, habilitar las opciones y configurar el Handler, podemos ver los mensajes coloreados con sus datos: PHP 1 2 3 4 5 6 7 8 <?php $log = new Logger ( \"MiFirePHPLogger\" ); $log -> pushHandler ( new FirePHPHandler ( Logger :: INFO )); $datos = [ \"real\" => \"Bruce Wayne\" , \"personaje\" => \"Batman\" ]; $log -> debug ( \"Esto es un mensaje de DEBUG\" , $datos ); $log -> info ( \"Esto es un mensaje de INFO\" , $datos ); $log -> warning ( \"Esto es un mensaje de WARNING\" , $datos );","title":"manejadores"},{"location":"ud05/ud05_HerramientasWeb/#canales","text":"Se les asigna al crear el Logger. En grandes aplicaciones, se crea un canal por cada subsistema: ventas, contabilidad, almac\u00e9n. No es una buena pr\u00e1ctica usar el nombre de la clase como canal, esto se hace con un procesador . Para su uso, es recomiendo asignar el log a una propiedad privada a Logger, y posteriormente, en el constructor de la clase, asignar el canal, manejadores y formato. PHP 1 2 3 4 <?php $this -> log = new Logger ( \"MiApp\" ); $this -> log -> pushHandler ( new StreamHandler ( \"logs/milog.log\" , Logger :: DEBUG )); $this -> log -> pushHandler ( new FirePHPHandler ( Logger :: DEBUG )); Y dentro de los m\u00e9todos para escribir en el log: PHP 1 2 <?php $this -> log -> warning ( \"Producto no encontrado\" , [ $producto ]);","title":"canales"},{"location":"ud05/ud05_HerramientasWeb/#procesadores","text":"Los procesadores permiten a\u00f1adir informaci\u00f3n a los mensajes. Para ello, se apilan despu\u00e9s de cada manejador mediante el m\u00e9todo pushProcessor($procesador) . Algunos procesadores conocidos son IntrospectionProcessor (muestran la linea, fichero, clase y metodo desde el que se invoca el log), WebProcessor (a\u00f1ade la URI, m\u00e9todo e IP) o GitProcessor (a\u00f1ade la rama y el commit). PHP PHP 1 2 3 4 5 6 7 <?php $log = new Logger ( \"MiLogger\" ); $log -> pushHandler ( new RotatingFileHandler ( \"logs/milog.log\" , 0 , Logger :: DEBUG )); $log -> pushProcessor ( new IntrospectionProcessor ()); $log -> pushHandler ( new StreamHandler ( \"php://stderr\" , Logger :: WARNING )); // no usa Introspection pq lo hemos apilado despu\u00e9s, le asigno otro $log -> pushProcessor ( new WebProcessor ()); Consola en formato texto Bash 1 2 [ 2020 -11-26T13:35:31.076138+01:00 ] MiLogger.DEBUG: Esto es un mensaje de DEBUG [] { \"file\" : \"C:\\\\xampp\\\\htdocs\\\\log\\\\procesador.php\" , \"line\" :12, \"class\" :null, \"function\" :null } [ 2020 -11-26T13:35:31.078344+01:00 ] MiLogger.INFO: Esto es un mensaje de INFO [] { \"file\" : \"C:\\\\xampp\\\\htdocs\\\\log\\\\procesador.php\" , \"line\" :13, \"class\" :null, \"function\" :null }","title":"procesadores"},{"location":"ud05/ud05_HerramientasWeb/#formateadores","text":"Se asocian a los manejadores con setFormatter. Los formateadores m\u00e1s utilizados son LineFormatter, HtmlFormatter o JsonFormatter. PHP PHP 1 2 3 4 5 <?php $log = new Logger ( \"MiLogger\" ); $rfh = new RotatingFileHandler ( \"logs/milog.log\" , Logger :: DEBUG ); $rfh -> setFormatter ( new JsonFormatter ()); $log -> pushHandler ( $rfh ); Consola en JSON Bash 1 2 { \"message\" : \"Esto es un mensaje de DEBUG\" , \"context\" : {} , \"level\" :100, \"level_name\" : \"DEBUG\" , \"channel\" : \"MiLogger\" , \"datetime\" : \"2020-11-27T15:36:52.747211+01:00\" , \"extra\" : {}} { \"message\" : \"Esto es un mensaje de INFO\" , \"context\" : {} , \"level\" :200, \"level_name\" : \"INFO\" , \"channel\" : \"MiLogger\" , \"datetime\" : \"2020-11-27T15:36:52.747 m\u00e1s informaci\u00f3n M\u00e1s informaci\u00f3n sobre manejadores, formateadores y procesadores en https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md","title":"formateadores"},{"location":"ud05/ud05_HerramientasWeb/#uso-de-factorias","text":"En vez de instanciar un log en cada clase, es conveniente crear una factor\u00eda (por ejemplo, siguiendo la idea del patr\u00f3n de dise\u00f1o Factory Method ). Para el siguiente ejemplo, vamos a suponer que creamos la factor\u00eda en el namespace Dwes\\Ejemplos\\Util . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace Dwes\\Ejemplos\\Util use Monolog\\Logger ; use Monolog\\Handler\\StreamHandler ; class LogFactory { public static function getLogger ( string $canal = \"miApp\" ) : Logger { $log = new Logger ( $canal ); $log -> pushHandler ( new StreamHandler ( \"logs/miApp.log\" , Logger :: DEBUG )); return $log ; } } Si en vez de devolver un Monolog\\Logger utilizamos el interfaz de PSR, si en el futuro cambiamos la implementaci\u00f3n del log, no tendremos que modificar nuestro codigo. As\u00ed pues, la factor\u00eda ahora devolver\u00e1 Psr\\Log\\LoggerInterface : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php namespace Dwes\\Ejemplos\\Util use Monolog\\Handler\\StreamHandler ; use Monolog\\Logger ; use Psr\\Log\\LoggerInterface ; class LogFactory { public static function getLogger ( string $canal = \"miApp\" ) : LoggerInterface { $log = new Logger ( $canal ); $log -> pushHandler ( new StreamHandler ( \"log/miApp.log\" , Logger :: DEBUG )); return $log ; } } Finalmente, para utilizar la factor\u00eda, s\u00f3lo cambiamos el c\u00f3digo que ten\u00edamos en el constructor de las clases que usan el log, quedando algo asi: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php namespace Dwes\\Ejemplos\\Util use Monolog\\Handler\\StreamHandler ; use Monolog\\Logger ; use Psr\\Log\\LoggerInterface ; class LogFactory { public static function getLogger ( string $canal = \"miApp\" ) : LoggerInterface { $log = new Logger ( $canal ); $log -> pushHandler ( new StreamHandler ( \"log/miApp.log\" , Logger :: DEBUG )); return $log ; } }","title":"uso de factor\u00edas"},{"location":"ud05/ud05_HerramientasWeb/#documentacion-con-phpdocumentor","text":"phpDocumentor es la herramienta de facto para documentar el c\u00f3digo PHP. Es similar en prop\u00f3sito y funcionamiento a Javadoc . As\u00ed pues, es un herramienta que facilita la documentaci\u00f3n del c\u00f3digo PHP, creando un sitio web con el API de la aplicaci\u00f3n. Se basa en el uso de anotaciones sobre los docblocks. Para ponerlo en marcha, en nuestro caso nos decantaremos por utilizar la imagen que ya existe de Docker.","title":"Documentaci\u00f3n con phpDocumentor"},{"location":"ud05/ud05_HerramientasWeb/#instalacion-como-binario","text":"Otra opci\u00f3n es seguir los pasos que recomienda la documentaci\u00f3n oficial para instalarlo como un ejecutable, que son descargar el archivo phpDocumentor.phar y darles permisos de ejecuci\u00f3n: Bash 1 2 3 4 wget https://phpdoc.org/phpDocumentor.phar chmod +x phpDocumentor.phar mv phpDocumentor.phar /usr/local/bin/phpdoc phpdoc --version Una vez instalado, desde el ra\u00edz del proyecto, suponiendo que tenemos nuestro c\u00f3digo dentro de app y que queremos la documentaci\u00f3n dentro de docs/api ejecutamos: Bash 1 phpdoc -d ./app -t docs/api","title":"instalaci\u00f3n como binario"},{"location":"ud05/ud05_HerramientasWeb/#uso-del-docker","text":"En el caso de usar Docker, usaremos el siguiente comando para ejecutarlo (crea el contenedor, ejecuta el comando que le pidamos, y autom\u00e1ticamente lo borra): Docker 1 docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 A dicho comando, le adjuntaremos los diferentes par\u00e1metros que admite phpDocumentor, por ejemplo: Bash 1 2 3 4 5 # Muestra la versi\u00f3n docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 --version # Mediante -d se indica el origen a parsear # Mediante -t se indica el destino donde generar la documentaci\u00f3n docker run --rm -v \" $( pwd ) \" :/data phpdoc/phpdoc:3 -d ./src/app -t ./docs/api","title":"uso del Docker"},{"location":"ud05/ud05_HerramientasWeb/#docblock","text":"Un docblock es el bloque de c\u00f3digo que se coloca encima de un recurso. Su formato es: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php /* * *Sumario*, una sola l\u00ednea * * *Descripci\u00f3n* que puede utilizar varias l\u00edneas * y que ofrece detalles del elemento o referencias * para ampliar la informaci\u00f3n * * @param string $miArgumento con una *descripci\u00f3n* del argumento * que puede usar varias l\u00edneas. * * @return void */ function miFuncion ( tipo $miArgumento ) { }","title":"DocBlock"},{"location":"ud05/ud05_HerramientasWeb/#documentando-el-codigo","text":"En todos los elementos, ademas del sumario y/o descripci\u00f3n, pondremos: En las clases: @author nombre @package ruta del namespace En las propiedades: @var tipo descripci\u00f3n En los m\u00e9todos: @param tipo $nombre descripci\u00f3n @throws ClaseException descripci\u00f3n @return tipo descripci\u00f3n Ve\u00e1moslo con un ejemplo. Supongamos que tenemos una clase que representa un cliente: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 <?php /* * Clase que representa un cliente * * El cliente se encarga de almacenar los soportes que tiene alquilado, * de manera que podemos alquilar y devolver productos mediante las operaciones * hom\u00f3nimas. * * @package Dwes\\Videoclub\\Model * @author Aitor Medrano <a.medrano@edu.gva.es> */ class Cliente { public string $nombre ; private string $numero ; /* * Colecci\u00f3n de soportes alquilados * @var array<Soporte> */ private $soportesAlquilados []; /* * Comprueba si el soporte recibido ya lo tiene alquilado el cliente * @param Soporte $soporte Soporte a comprobar * @return bool true si lo tiene alquilado */ public function tieneAlquilado ( Soporte $soporte ) : bool { // ... } Si generamos la documentaci\u00f3n y abrimos con un navegador el archivo docs/api/index.html podremos navegar hasta la clase Cliente :","title":"documentando el c\u00f3digo"},{"location":"ud05/ud05_HerramientasWeb/#web-scraping","text":"Consiste en navegar a una p\u00e1gina web y extraer informaci\u00f3n autom\u00e1ticamente, a partir del c\u00f3digo HTML generado, y organizar la informaci\u00f3n p\u00fablica disponible en Internet. Esta pr\u00e1ctica requiere el uso de una librer\u00eda que facilite la descarga de la informaci\u00f3n deseada imitando la interacci\u00f3n de un navegador web. Este \"robot\" puede acceder a varias p\u00e1ginas simult\u00e1neamente. es legal? Si el sitio web indica que tiene el contenido protegido por derechos de autor o en las normas de acceso via usuario/contrase\u00f1a nos avisa de su prohibici\u00f3n, estar\u00edamos incurriendo en un delito. Es recomendable estudiar el archivo robots.txt que se encuentra en el ra\u00edz de cada sitio web. M\u00e1s informaci\u00f3n en el art\u00edculo El manual completo para el web scraping legal y \u00e9tico en 2021 .","title":"Web Scraping"},{"location":"ud05/ud05_HerramientasWeb/#goutte","text":"Goutte es un sencillo cliente HTTP para PHP creado espec\u00edficamente para hacer web scraping. Lo desarroll\u00f3 el mismo autor del framework Symfony y ofrece un API sencilla para extraer datos de las respuestas HTML/XML de los sitios web. Datos : Revisar https://godofredo.ninja/web-scraping-con-php-utilizando-goutte/ Los componentes principales que abstrae Goutte sobre Symfony son: BrowserKit : simula el comportamiento de un navegador web. CssSelector : traduce consultas CSS en consultas XPath. DomCrawler : facilita el uso del DOM y XPath. Para poder utilizar Goutte en nuestro proyecto, ejecutaremos el siguiente comando en el terminal: Bash 1 composer require fabpot/goutte","title":"Goutte"},{"location":"ud05/ud05_HerramientasWeb/#goutte-con-selectores-css","text":"A continuaci\u00f3n vamos a hacer un ejemplo muy sencillo utilizando los selectores CSS, extrayendo informaci\u00f3n de la web https://books.toscrape.com/ , la cual es una p\u00e1gina para pruebas que no rechazar\u00e1 nuestras peticiones. Tras crear un cliente con Goutte, hemos de realizar un petici\u00f3n a una URL. Con la respuesta obtenida, podemos utilizar el m\u00e9todo filter para indicarle la ruta CSS que queremos recorrer e iterar sobre los resultados mediante una funci\u00f3n an\u00f3nima. Una vez estamos dentro de un determinado nodo, el m\u00e9todo text() nos devolver\u00e1 el contenido del propio nodo. En concreto, vamos a meter en un array asociativo el t\u00edtulo y el precio de todos los libros de la categor\u00eda Classics . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <?php require '../vendor/autoload.php' ; $httpClient = new \\Goutte\\Client (); $response = $httpClient -> request ( 'GET' , 'https://books.toscrape.com/catalogue/category/books/classics_6/index.html' ); // colocamos los precios en un array $precios = []; $response -> filter ( '.row li article div.product_price p.price_color' ) -> each ( // le pasamos $precios por referencia para poder editarla dentro del closure function ( $node ) use ( & $precios ) { $precios [] = $node -> text (); } ); // colocamos el nombre y el precio en un array asociativo $contadorPrecios = 0 ; $libros = []; $response -> filter ( '.row li article h3 a' ) -> each ( function ( $node ) use ( $precios , & $contadorPrecios , & $libros ) { $libros [ $node -> text ()] = $precios [ $contadorPrecios ]; $contadorPrecios ++ ; }","title":"Goutte con selectores CSS"},{"location":"ud05/ud05_HerramientasWeb/#crawler","text":"Un caso muy com\u00fan es obtener la informaci\u00f3n de una p\u00e1gina que tiene los resultados paginados, de manera que vayamos recorriendo los enlaces y accediendo a cada uno de los resultados. En este caso vamos a coger todos los precios de los libros de fantas\u00eda, y vamos a sumarlos: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 <?php require '../vendor/autoload.php' ; use Goutte\\Client ; use Symfony\\Component\\HttpClient\\HttpClient ; $client = new Client ( HttpClient :: create ([ 'timeout' => 60 ])); $crawler = $client -> request ( 'GET' , 'https://books.toscrape.com/catalogue/category/books/fantasy_19/index.html' ); $salir = false ; $precios = []; while ( ! $salir ) { $crawler -> filter ( '.row li article div.product_price p.price_color' ) -> each ( function ( $node ) use ( & $precios ) { $texto = $node -> text (); $cantidad = substr ( $texto , 2 ); // Le quitamos las libras \u00bf2 posiciones? $precios [] = floatval ( $cantidad ); } ); $enlace = $crawler -> selectLink ( 'next' ); if ( $enlace -> count () != 0 ) { // el enlace next existe $sigPag = $crawler -> selectLink ( 'next' ) -> link (); $crawler = $client -> click ( $sigPag ); // hacemos click } else { // ya no hay enlace next $salir = true ; } } $precioTotal = array_sum ( $precios ); echo $precioTotal ;","title":"Crawler"},{"location":"ud05/ud05_HerramientasWeb/#pruebas-con-phpunit","text":"El curso pasado, dentro del m\u00f3dulo de Entornos de Desarrollo, estudiamos la importancia de la realizaci\u00f3n de pruebas, as\u00ed como las pruebas unitarias mediante JUnit . A d\u00eda de hoy es de gran importancia seguir una buena metodolog\u00eda de pruebas, siendo el desarrollo dirigido por las pruebas (Test Driven Development / TDD) uno de los enfoques m\u00e1s empleados, el cual consiste en: Escribir el test, y como no hay c\u00f3digo implementado, la prueba falle (rojo). Escribir el c\u00f3digo de aplicaci\u00f3n para que la prueba funcione (verde). Refactorizar el c\u00f3digo de la aplicaci\u00f3n con la ayuda de la prueba para comprobar que no rompemos nada (refactor). En el caso de PHP, la herramienta que se utiliza es PHPUnit (https://phpunit.de/), que como su nombre indica, est\u00e1 basada en JUnit. La versi\u00f3n actual es la 9.0 Se recomienda consultar su documentaci\u00f3n en https://phpunit.readthedocs.io/es/latest/index.html.","title":"Pruebas con PHPUnit"},{"location":"ud05/ud05_HerramientasWeb/#puesta-en-marcha","text":"Vamos a colocar todas las pruebas en una carpeta tests en el ra\u00edz de nuestro proyecto. En el archivo composer.json, a\u00f1adimos: PHP 1 2 3 4 5 6 \"require-dev\": { \"phpunit/phpunit\": \"^9\" }, \"scripts\": { \"test\": \"phpunit --testdox --colors tests\" } Si quisi\u00e9ramos a\u00f1adir la librer\u00eda desde un comando del terminal, tambi\u00e9n podr\u00edamos ejecutar: PHP 1 composer require --dev phpunit/phpunit ^9 librer\u00edas de desarrollo Las librer\u00edas que se colocan en require-dev son las de desarrollo y testing , de manera que no se instalar\u00e1n en un entorno de producci\u00f3n. Como hemos creado un script, podemos lanzar las pruebas mediante: Text Only 1 composer test Vasmos a realizar nuestra primera prueba: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 <?php use PHPUnit\\Framework\\TestCase ; class PilaTest extends TestCase { public function testPushAndPop () { $pila = []; $this -> assertSame ( 0 , count ( $pila )); array_push ( $pila , 'batman' ); $this -> assertSame ( 'batman' , $pila [ count ( $pila ) - 1 ]); $this -> assertSame ( 1 , count ( $pila )); $this -> assertSame ( 'batman' , array_pop ( $pila )); $this -> assertSame ( 0 , count ( $pila )); } } Tenemos diferentes formas de ejecutar una prueba: Bash 1 2 3 4 ./vendor/bin/phpunit tests/PilaTest.php ./vendor/bin/phpunit tests ./vendor/bin/phpunit --testdox tests ./vendor/bin/phpunit --testdox --colors tests","title":"puesta en marcha"},{"location":"ud05/ud05_HerramientasWeb/#disenando-pruebas","text":"Tal como hemos visto en el ejemplo, la clase de prueba debe heredar de TestCase , y el nombre de la clase debe acabar en Test, de ah\u00ed que hayamos llamado la clase de prueba como PilaTest . Una prueba implica un m\u00e9todo de prueba (p\u00fablico) por cada funcionalidad a probar. Cada un de los m\u00e9todos se les asocia un caso de prueba. Los m\u00e9todos deben nombrarse con el prefijo test , por ejemplo, testPushAndPop . Es muy importante que el nombre sea muy claro y descriptivo del prop\u00f3sito de la prueba. ( camelCase ). En los casos de prueba prepararemos varias aserciones para toda la casu\u00edstica: rangos de valores, tipos de datos, excepciones, etc...","title":"dise\u00f1ando pruebas"},{"location":"ud05/ud05_HerramientasWeb/#aserciones","text":"Las aserciones permiten comprobar el resultado de los m\u00e9todos que queremos probar. Las aserciones esperan que el predicado siempre sea verdadero. PHPUnit ofrece las siguiente aserciones: assertTrue / assertFalse : Comprueba que la condici\u00f3n dada sea evaluada como true / false . assertEquals / assertSame : Comprueba que dos variables sean iguales. assertNotEquals / assertNotSame : Comprueba que dos variables NO sean iguales. Same \u2192 comprueba los tipos. Si no coinciden los tipos y los valores, la aserci\u00f3n fallar\u00e1. Equals \u2192 sin comprobaci\u00f3n estricta. assertArrayHasKey / assertArrayNotHasKey : Comprueba que un array posea un key determinado / o NO lo posea assertArraySubset : Comprueba que un array posea otro array como subset del mismo assertAttributeContains / assertAttributeNotContains : Comprueba que un atributo de una clase contenga una variable determinada / o NO contenga una variable determinada assertAttributeEquals : Comprueba que un atributo de una clase sea igual a una variable determinada.","title":"aserciones"},{"location":"ud05/ud05_HerramientasWeb/#comparando-la-salida","text":"Si los m\u00e9todos a probar generan contenido mediante echo o una instrucci\u00f3n similar, disponemos de las siguiente expectativas: expectOutputString(salidaEsperada) expectOutputRegex(expresionRegularEsperada) Las expectativas difieren de las aserciones que informan del resultado que se espera antes de invocar al m\u00e9todo. Tras definir la expectativa, se invoca al m\u00e9todo que realiza el echo / print . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php namespace Dwes\\Videoclub\\Model ; use PHPUnit\\Framework\\TestCase ; use Dwes\\Videoclub\\Model\\CintaVideo ; class CintaVideoTest extends TestCase { public function testConstructor () { $cinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $this -> assertSame ( $cinta -> getNumero (), 23 ); } public function testMuestraResumen () { $cinta = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $resultado = \"<br>Pel\u00edcula en VHS:\" ; $resultado .= \"<br>Los cazafantasmas<br>3.5 (IVA no incluido)\" ; $resultado .= \"<br>Duraci\u00f3n: 107 minutos\" ; // definimos la expectativa $this -> expectOutputString ( $resultado ); // invocamos al m\u00e9todo que har\u00e1 echo $cinta -> muestraResumen (); } }","title":"comparando la salida"},{"location":"ud05/ud05_HerramientasWeb/#proveedores-de-datos","text":"Cuando tenemos pruebas que solo cambian respecto a los datos de entrada y de salida, es \u00fatil utilizar proveedores de datos. Se declaran en el docblock mediante @dataProvider nombreMetodo , donde se indica el nombre de un m\u00e9todo p\u00fablico que devuelve un array de arrays, donde cada elemento es un caso de prueba. La clase de prueba recibe como par\u00e1metros los datos a probar y el resultado de la prueba como \u00faltimo par\u00e1metro. El siguiente ejemplo comprueba con diferentes datos el funcionamiento de muestraResumen : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 <?php /* * @dataProvider cintasProvider */ public function testMuestraResumenConProvider ( $titulo , $id , $precio , $duracion , $esperado ) { $cinta = new CintaVideo ( $titulo , $id , $precio , $duracion ); $this -> expectOutputString ( $esperado ); $cinta -> muestraResumen (); } public function cintasProvider () { return [ \"cazafantasmas\" => [ \"Los cazafantasmas\" , 23 , 3.5 , 107 , \"<br>VHS:<br>Los cazafantasmas<br>3.5 \u20ac(IVA no incluido)<br>Duraci\u00f3n: 107 min\" ], \"superman\" => [ \"Superman\" , 24 , 3 , 188 , \"<br>VHS:<br>Superman<br>3 \u20ac (IVA no incluido)<br>Duraci\u00f3n: 188 min\" ], ]; }","title":"proveedores de datos"},{"location":"ud05/ud05_HerramientasWeb/#probando-excepciones","text":"Las pruebas adem\u00e1s de comprobar que las clases funcionan como se espera, han de cubrir todos los casos posibles. As\u00ed pues, debemos poder hacer pruebas que esperen que se lance una excepci\u00f3n (y que el mensaje contenga cierta informaci\u00f3n): Para ello, se utilizan las siguiente expectativas: expectException(Excepcion::class) expectExceptionCode(codigoExcepcion) expectExceptionMessage(mensaje) Del mismo modo que antes, primero se pone la expectativa, y luego se provoca que se lance la excepci\u00f3n: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php public function testAlquilarCupoLleno () { $soporte1 = new CintaVideo ( \"Los cazafantasmas\" , 23 , 3.5 , 107 ); $soporte2 = new Juego ( \"The Last of Us Part II\" , 26 , 49.99 , \"PS4\" , 1 , 1 ); $soporte3 = new Dvd ( \"Origen\" , 24 , 15 , \"es,en,fr\" , \"16:9\" ); $soporte4 = new Dvd ( \"El Imperio Contraataca\" , 4 , 3 , \"es,en\" , \"16:9\" ); $cliente1 = new Cliente ( \"Bruce Wayne\" , 23 ); $cliente1 -> alquilar ( $soporte1 ); $cliente1 -> alquilar ( $soporte2 ); $cliente1 -> alquilar ( $soporte3 ); $this -> expectException ( CupoSuperadoException :: class ); $cliente1 -> alquilar ( $soporte4 ); }","title":"probando excepciones"},{"location":"ud05/ud05_HerramientasWeb/#cobertura-de-codigo","text":"La cobertura de pruebas indica la cantidad de c\u00f3digo que las pruebas cubren, siendo recomendable que cubran entre el 95 y el 100%. Una de las m\u00e9tricas asociadas a los informes de cobertura es el CRAP (An\u00e1lisis y Predicciones sobre el Riesgo en Cambios), el cual mide la cantidad de esfuerzo, dolor y tiempo requerido para mantener una porci\u00f3n de c\u00f3digo. Esta m\u00e9trica debe mantenerse con un valor inferior a 5. requisito xdebug Aunque ya viene instalado dentro de PHPUnit, para que funcione la cobertura del c\u00f3digo, es necesario que el c\u00f3digo PHP se ejecute con XDEBUG, y e indicarle a Apache que as\u00ed es (colocando en el archivo de configuraci\u00f3n php.ini la directiva xdebug.mode=coverage ). A\u00f1adimos en composer.json un nuevo script: Text Only 1 \"coverage\": \"phpunit --coverage-html coverage --coverage-filter app tests\" Y posteriormente ejecutamos Text Only 1 composer coverage Por ejemplo, si accedemos a la clase CintaVideo con la prueba que hab\u00edamos realizado anteriormente, podemos observar la cobertura que tiene al 100% y que su CRAP es 2. temas pendientes - Dependencia entre casos de prueba con el atributo @depends - Completamente configurable mediante el archivo phpxml.xml : https://phpunit.readthedocs.io/es/latest/configuration.html - Preparando las pruebas con setUpBeforeClass() y tearDownAfterClass() - Objetos y pruebas Mock (dobles) con createMock()","title":"cobertura de c\u00f3digo"},{"location":"ud05/ud05_HerramientasWeb/#referencias","text":"Tutorial de Composer Web Scraping with PHP \u2013 How to Crawl Web Pages Using Open Source Tools PHP Monolog Unit Testing con PHPUnit \u2014 Parte 1, de Emiliano Zublena.","title":"referencias"},{"location":"ud05/ud05_HerramientasWeb_actividades/","text":"unit: unidad did\u00e1ctica 5 title: Actividades language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets Monolog proyecto Videoclub IV phpDocumentor Web Scraping phpUnit proyecto Videoclub V ampliaci\u00f3n Monolog Actividad 501 Crea un nuevo proyecto con Composer llamado Monologos : Incluye como librer\u00eda la \u00faltima versi\u00f3n de Monolog. Crea la clase Dwes\\Monologos\\HolaMonolog . Define una propiedad privada nombrada miLog para guardar el log. Define en el constructor un RotatingFileHandler que escriba en la carpeta logs del proyecto, y que almacene los mensajes a partir de debug . Crea los m\u00e9todos saludar y despedir que hagan un log de tipo info con la acci\u00f3n correspondiente. Actividad 502 Siguiendo con el proyecto Monologos : Crea un archivo llamado inicio.php que permita probar HolaMonolog . Comprueba que los mensajes aparecen en el log . Cambia el nivel para que el manejador solo muestre los mensajes a partir de warning . Vuelve a ejectuar inicio.php y comprueba el archivo de log. Actividad 503 Modifica la clase HolaMonolog : En el constructor, a\u00f1ade a la pila un manejador que escriba a la salida de error conjunto al procesador de introspecci\u00f3n, mostrando mensajes desde el nivel debug . A\u00f1ade una propiedad denominada hora , la cual se inicializa \u00fanicamente como par\u00e1metro del constructor. Si la hora es inferior a 0 o mayor de 24, debe escribir un log de warning con un mensaje apropiado. Modifica los m\u00e9todos saludar y despedir para hacerlo acorde a la propiedad hora (buenos d\u00edas, buenas tardes, hasta ma\u00f1ana, etc...) proyecto Videoclub IV Actividad 511 Como ya tenemos Composer instalado: Inicial\u00edzalo dentro de tu proyecto Videoclub. Incluye Monolog y PhpUnit , cada una en su lugar adecuado. A\u00f1ade el autoload al archivo composer.json , y haz los cambios necesarios en las clases para utilizar el autoload de Composer . Sube los cambios a GitHub y crea la etiqueta v0.511 . Actividad 512 Modifica la clase Cliente para introducir un Logger de Monolog. A\u00f1ade el log como una propiedad de la clase e inicial\u00edzalo en el constructor, con el nombre del canal VideoclubLogger . Se debe almacenar en logs/videoclub.log mostrando todos los mensajes desde debug . Antes de lanzar cualquier excepci\u00f3n, debe escribir un log de tipo warning . Sustituir los echo que haya en el c\u00f3digo, que ahora pasar\u00e1n por el log con el nivel info, a excepci\u00f3n del m\u00e9todo muestraResumen que seguir\u00e1 haciendo echo . Actividad 513 Vuelve a hacer lo mismo que en el ejercicio anterior, pero ahora con la clase Videoclub . Adem\u00e1s: Siempre que se llame a un m\u00e9todo del log, se le pasar\u00e1 como segundo par\u00e1metro la informaci\u00f3n que dispongamos. Ejecuta el archivo de prueba y comprueba que el log se rellena correctamente. Actividad 514 Vamos a refactorizar el c\u00f3digo com\u00fan de inicializaci\u00f3n de Monolog que tenemos repetidos en los constructores a una factor\u00eda de Monolog , la cual colocaremos en \\Dwes\\Videoclub\\Util\\LogFactory . Comprueba que sigue funcionando correctamente. Actividad 515 Modifica la factor\u00eda para que devuelva LogInterface y comprueba que sigue funcionando. Sube los cambios a GitHub con la etiqueta v0.515 . phpDocumentor Actividad 521 Comprueba que en el contenedor de Docker funciona phpDocumentor . Ejecuta phpdoc sobre tu proyecto Monolog y comprueba el api que se crea. Comenta tanto la clase como los m\u00e9todos, y posteriormente, vuelve a ejecutar phpdoc. Actividad 522 Documenta el proyecto Videoclub , y genera la documentaci\u00f3n. Empieza por las clases de Soporte y sus hijos. Comprueba el resultado. Luego sigue con Cliente y finalmente Videoclub . Web Scraping Actividad 531 A partir de los datos de http://www.seleccionbaloncesto.es , calcula la altura y edad media del equipo de baloncesto masculino. Observa que tienes los datos dentro de una tabla debajo de las noticias. Actividad 532 Volviendo al Videoclub, en Soporte a\u00f1ade una propiedad llamada metacritic para almacenar la URL de cada soporte. A continuaci\u00f3n, modifica los m\u00e9todos incluirXXX de Videoclub para que admitan como primer par\u00e1metro dicha URL. Tras ello, modifica el fichero inicio3.php para pasarle la URL de cada soporte (para ello deber\u00e1s consultarlos en Metacritic haciendo b\u00fasquedas manuales). Por ejemplo, en el caso de la pel\u00edcula Cazafantasmas, su URL es https://www.metacritic.com/movie/ghostbusters. Actividad 533 Finalmente, a\u00f1ade un m\u00e9todo abstracto en Soporte llamado getPuntuacion , que haciendo uso de Web Scraping se conecte a Metacritic y obtenga su puntuaci\u00f3n. Modifica inicio3.php para obtener todos los alquileres de un cliente mediante getAlquileres() : array , y para cada uno de ellos, adem\u00e1s del t\u00edtulo, muestra su puntuaci\u00f3n. phpUnit Actividad 541 A partir de la clase HolaMonolog , modifica los m\u00e9todos para que adem\u00e1s de escribir en en log, devuelvan el saludo como una cadena. Crea la clase HolaMonologTest y a\u00f1ade diferentes casos de prueba para comprobar que los saludos y despedidas son acordes a la hora con la que se crea la clase. Actividad 542 Vamos a simular Test Driven Development . Queremos que nuestra aplicaci\u00f3n almacene los \u00faltimos tres saludos que ha realizado. Para ello: Crea las prueba necesarias (invoca al m\u00e9todo saludar varias veces y llama al m\u00e9todo que te devuelva los saludos almacenados) Implementa el c\u00f3digo para pasar las pruebas Refactoriza el c\u00f3digo Actividad 543 Crea una nueva prueba que utilice proveedores de datos para comprobar esta \u00faltima funcionalidad, pas\u00e1ndole: Un saludo. Tres saludos. Cuatro saludos. Actividad 544 \u00bfRecuerdas que si la hora es negativa o superior a 24 escrib\u00edamos en el log un warning ? Ahora debe lanzar una excepci\u00f3n de tipo InvalidArgumentException (como la excepci\u00f3n forma para de PHP, hay que poner su FQN: \\InvalidArgumentException ). Vuelve a aplicar TDD y completa tus casos de prueba. Actividad 545 Comenta la \u00faltima prueba realizada (la comprobaci\u00f3n de las excepciones) y realiza un informe de cobertura de pruebas. Analiza los resultados obtenidos. Elimina los \u00faltimos comentarios sobre la \u00faltima prueba y vuelve a generar y analizar el informe de cobertura. proyecto Videoclub V El objetivo de los siguientes ejercicios es conseguir de manera incremental una cobertura de pruebas superior al 95%. Actividad 551 Crea pruebas dentro de la carpeta tests para las clases Soporte , CintaVideo , Dvd y Juego . Recuerda respetar el espacio de nombres. Los m\u00e9todos muestraResumen , tras hacer echo de los mensajes, deben devolver una cadena con el propio mensaje. Actividad 552 Crea pruebas para la clase Cliente , aprovechando todo el c\u00f3digo que ten\u00edamos para comprobar la funcionalidad. Utiliza proveedores de datos para a\u00f1adir conjuntos de datos mayores que los empleados. Comprueba que funciona con diferentes cupos, que al intentar alquilar un soporte marcado como ya alquilado debe lanzar una excepci\u00f3n, que no coincidan los ids de los soportes, etc... Actividad 553 Crea las pruebas para la clase Videoclub . Ten en cuenta los \u00faltimos m\u00e9todos a\u00f1adidos que permit\u00edan alquilar y devolver soportes, tanto de manera individual como mediante un array. Actividad 554 Crea el informe de cobertura. Una vez creado, analiza los datos de cobertura (>= 90%) y comprueba el valor de CRAP, de manera que siempre sea <= 5. En caso de no cumplirse, crea nuevos casos de prueba y/o refactoriza el c\u00f3digo de tu aplicaci\u00f3n. Sube los cambios a GitHub con la etiqueta v0.554 . ampliaci\u00f3n Actividad 561 Queremos que en Videoclub , cuando un cliente no existe (tanto al alquilar como al devolver) se lance una nueva excepci\u00f3n: ClienteNoExisteException . Adem\u00e1s, dado el n\u00famero creciente de excepciones, queremos mover las excepciones al namespace Dwes\\Videoclub\\Exception . Siguiendo TDD, primero crea las pruebas, y luego modifica el c\u00f3digo de aplicaci\u00f3n. Vuelve a generar el informe de cobertura y comprueba la calidad de nuestras pruebas. Actividad 562 \u00bfNadie se ha dado cuenta que en los Dvd no estamos almacenando su duraci\u00f3n? Haz todos los cambios necesarios, primero en las pruebas y luego en el c\u00f3digo. Actividad 563 Tras a\u00f1os luchando contra la tecnolog\u00eda, decidimos introducir los Blu-ray en nuestra empresa. Hemos decido que Bluray herede de Soporte . Adem\u00e1s del t\u00edtulo y la duracion , nos interesa almacenar si es4k . Haz todos los cambios necesarios, primero en las pruebas y luego en el c\u00f3digo. Sube los cambios a GitHub con la etiqueta v0.563 .","title":"ud05 HerramientasWeb actividades"},{"location":"ud05/ud05_HerramientasWeb_actividades/#monolog","text":"Actividad 501 Crea un nuevo proyecto con Composer llamado Monologos : Incluye como librer\u00eda la \u00faltima versi\u00f3n de Monolog. Crea la clase Dwes\\Monologos\\HolaMonolog . Define una propiedad privada nombrada miLog para guardar el log. Define en el constructor un RotatingFileHandler que escriba en la carpeta logs del proyecto, y que almacene los mensajes a partir de debug . Crea los m\u00e9todos saludar y despedir que hagan un log de tipo info con la acci\u00f3n correspondiente. Actividad 502 Siguiendo con el proyecto Monologos : Crea un archivo llamado inicio.php que permita probar HolaMonolog . Comprueba que los mensajes aparecen en el log . Cambia el nivel para que el manejador solo muestre los mensajes a partir de warning . Vuelve a ejectuar inicio.php y comprueba el archivo de log. Actividad 503 Modifica la clase HolaMonolog : En el constructor, a\u00f1ade a la pila un manejador que escriba a la salida de error conjunto al procesador de introspecci\u00f3n, mostrando mensajes desde el nivel debug . A\u00f1ade una propiedad denominada hora , la cual se inicializa \u00fanicamente como par\u00e1metro del constructor. Si la hora es inferior a 0 o mayor de 24, debe escribir un log de warning con un mensaje apropiado. Modifica los m\u00e9todos saludar y despedir para hacerlo acorde a la propiedad hora (buenos d\u00edas, buenas tardes, hasta ma\u00f1ana, etc...)","title":"Monolog"},{"location":"ud05/ud05_HerramientasWeb_actividades/#proyecto-videoclub-iv","text":"Actividad 511 Como ya tenemos Composer instalado: Inicial\u00edzalo dentro de tu proyecto Videoclub. Incluye Monolog y PhpUnit , cada una en su lugar adecuado. A\u00f1ade el autoload al archivo composer.json , y haz los cambios necesarios en las clases para utilizar el autoload de Composer . Sube los cambios a GitHub y crea la etiqueta v0.511 . Actividad 512 Modifica la clase Cliente para introducir un Logger de Monolog. A\u00f1ade el log como una propiedad de la clase e inicial\u00edzalo en el constructor, con el nombre del canal VideoclubLogger . Se debe almacenar en logs/videoclub.log mostrando todos los mensajes desde debug . Antes de lanzar cualquier excepci\u00f3n, debe escribir un log de tipo warning . Sustituir los echo que haya en el c\u00f3digo, que ahora pasar\u00e1n por el log con el nivel info, a excepci\u00f3n del m\u00e9todo muestraResumen que seguir\u00e1 haciendo echo . Actividad 513 Vuelve a hacer lo mismo que en el ejercicio anterior, pero ahora con la clase Videoclub . Adem\u00e1s: Siempre que se llame a un m\u00e9todo del log, se le pasar\u00e1 como segundo par\u00e1metro la informaci\u00f3n que dispongamos. Ejecuta el archivo de prueba y comprueba que el log se rellena correctamente. Actividad 514 Vamos a refactorizar el c\u00f3digo com\u00fan de inicializaci\u00f3n de Monolog que tenemos repetidos en los constructores a una factor\u00eda de Monolog , la cual colocaremos en \\Dwes\\Videoclub\\Util\\LogFactory . Comprueba que sigue funcionando correctamente. Actividad 515 Modifica la factor\u00eda para que devuelva LogInterface y comprueba que sigue funcionando. Sube los cambios a GitHub con la etiqueta v0.515 .","title":"proyecto Videoclub IV"},{"location":"ud05/ud05_HerramientasWeb_actividades/#phpdocumentor","text":"Actividad 521 Comprueba que en el contenedor de Docker funciona phpDocumentor . Ejecuta phpdoc sobre tu proyecto Monolog y comprueba el api que se crea. Comenta tanto la clase como los m\u00e9todos, y posteriormente, vuelve a ejecutar phpdoc. Actividad 522 Documenta el proyecto Videoclub , y genera la documentaci\u00f3n. Empieza por las clases de Soporte y sus hijos. Comprueba el resultado. Luego sigue con Cliente y finalmente Videoclub .","title":"phpDocumentor"},{"location":"ud05/ud05_HerramientasWeb_actividades/#web-scraping","text":"Actividad 531 A partir de los datos de http://www.seleccionbaloncesto.es , calcula la altura y edad media del equipo de baloncesto masculino. Observa que tienes los datos dentro de una tabla debajo de las noticias. Actividad 532 Volviendo al Videoclub, en Soporte a\u00f1ade una propiedad llamada metacritic para almacenar la URL de cada soporte. A continuaci\u00f3n, modifica los m\u00e9todos incluirXXX de Videoclub para que admitan como primer par\u00e1metro dicha URL. Tras ello, modifica el fichero inicio3.php para pasarle la URL de cada soporte (para ello deber\u00e1s consultarlos en Metacritic haciendo b\u00fasquedas manuales). Por ejemplo, en el caso de la pel\u00edcula Cazafantasmas, su URL es https://www.metacritic.com/movie/ghostbusters. Actividad 533 Finalmente, a\u00f1ade un m\u00e9todo abstracto en Soporte llamado getPuntuacion , que haciendo uso de Web Scraping se conecte a Metacritic y obtenga su puntuaci\u00f3n. Modifica inicio3.php para obtener todos los alquileres de un cliente mediante getAlquileres() : array , y para cada uno de ellos, adem\u00e1s del t\u00edtulo, muestra su puntuaci\u00f3n.","title":"Web Scraping"},{"location":"ud05/ud05_HerramientasWeb_actividades/#phpunit","text":"Actividad 541 A partir de la clase HolaMonolog , modifica los m\u00e9todos para que adem\u00e1s de escribir en en log, devuelvan el saludo como una cadena. Crea la clase HolaMonologTest y a\u00f1ade diferentes casos de prueba para comprobar que los saludos y despedidas son acordes a la hora con la que se crea la clase. Actividad 542 Vamos a simular Test Driven Development . Queremos que nuestra aplicaci\u00f3n almacene los \u00faltimos tres saludos que ha realizado. Para ello: Crea las prueba necesarias (invoca al m\u00e9todo saludar varias veces y llama al m\u00e9todo que te devuelva los saludos almacenados) Implementa el c\u00f3digo para pasar las pruebas Refactoriza el c\u00f3digo Actividad 543 Crea una nueva prueba que utilice proveedores de datos para comprobar esta \u00faltima funcionalidad, pas\u00e1ndole: Un saludo. Tres saludos. Cuatro saludos. Actividad 544 \u00bfRecuerdas que si la hora es negativa o superior a 24 escrib\u00edamos en el log un warning ? Ahora debe lanzar una excepci\u00f3n de tipo InvalidArgumentException (como la excepci\u00f3n forma para de PHP, hay que poner su FQN: \\InvalidArgumentException ). Vuelve a aplicar TDD y completa tus casos de prueba. Actividad 545 Comenta la \u00faltima prueba realizada (la comprobaci\u00f3n de las excepciones) y realiza un informe de cobertura de pruebas. Analiza los resultados obtenidos. Elimina los \u00faltimos comentarios sobre la \u00faltima prueba y vuelve a generar y analizar el informe de cobertura.","title":"phpUnit"},{"location":"ud05/ud05_HerramientasWeb_actividades/#proyecto-videoclub-v","text":"El objetivo de los siguientes ejercicios es conseguir de manera incremental una cobertura de pruebas superior al 95%. Actividad 551 Crea pruebas dentro de la carpeta tests para las clases Soporte , CintaVideo , Dvd y Juego . Recuerda respetar el espacio de nombres. Los m\u00e9todos muestraResumen , tras hacer echo de los mensajes, deben devolver una cadena con el propio mensaje. Actividad 552 Crea pruebas para la clase Cliente , aprovechando todo el c\u00f3digo que ten\u00edamos para comprobar la funcionalidad. Utiliza proveedores de datos para a\u00f1adir conjuntos de datos mayores que los empleados. Comprueba que funciona con diferentes cupos, que al intentar alquilar un soporte marcado como ya alquilado debe lanzar una excepci\u00f3n, que no coincidan los ids de los soportes, etc... Actividad 553 Crea las pruebas para la clase Videoclub . Ten en cuenta los \u00faltimos m\u00e9todos a\u00f1adidos que permit\u00edan alquilar y devolver soportes, tanto de manera individual como mediante un array. Actividad 554 Crea el informe de cobertura. Una vez creado, analiza los datos de cobertura (>= 90%) y comprueba el valor de CRAP, de manera que siempre sea <= 5. En caso de no cumplirse, crea nuevos casos de prueba y/o refactoriza el c\u00f3digo de tu aplicaci\u00f3n. Sube los cambios a GitHub con la etiqueta v0.554 .","title":"proyecto Videoclub V"},{"location":"ud05/ud05_HerramientasWeb_actividades/#ampliacion","text":"Actividad 561 Queremos que en Videoclub , cuando un cliente no existe (tanto al alquilar como al devolver) se lance una nueva excepci\u00f3n: ClienteNoExisteException . Adem\u00e1s, dado el n\u00famero creciente de excepciones, queremos mover las excepciones al namespace Dwes\\Videoclub\\Exception . Siguiendo TDD, primero crea las pruebas, y luego modifica el c\u00f3digo de aplicaci\u00f3n. Vuelve a generar el informe de cobertura y comprueba la calidad de nuestras pruebas. Actividad 562 \u00bfNadie se ha dado cuenta que en los Dvd no estamos almacenando su duraci\u00f3n? Haz todos los cambios necesarios, primero en las pruebas y luego en el c\u00f3digo. Actividad 563 Tras a\u00f1os luchando contra la tecnolog\u00eda, decidimos introducir los Blu-ray en nuestra empresa. Hemos decido que Bluray herede de Soporte . Adem\u00e1s del t\u00edtulo y la duracion , nos interesa almacenar si es4k . Haz todos los cambios necesarios, primero en las pruebas y luego en el c\u00f3digo. Sube los cambios a GitHub con la etiqueta v0.563 .","title":"ampliaci\u00f3n"},{"location":"ud06/ud06_AccesoADatos/","text":"unit: unidad did\u00e1ctica 6 title: Acceso a datos language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets duraci\u00f3n y criterios de evaluaci\u00f3n instalaci\u00f3n estructura de una base de datos CholloSevero SQL phpMyAdmin Creando una base de datos dentro de phpMyAdmin opciones en phpMyAdmin MySQLi recuperando datos de una BD PHP Data Objects :: PDO fichero de configuraci\u00f3n de la BD sentencias preparadas ejemplo par\u00e1metros ejemplo bindParam bindValue VS bindParam insertando registros consultando registros consultas con modelos consultas con LIKE login & password acceso a ficheros modos de apertura de ficheros operaciones con archivos informaci\u00f3n de un fichero archivos PDF referencias duraci\u00f3n y criterios de evaluaci\u00f3n En esta unidad vamos a aprender a acceder a datos que se encuentran en un servidor; recuperando, editando y creando dichos datos a trav\u00e9s de una base de datos. A trav\u00e9s de las distintas capas o niveles, de las cuales 2 de ellas ya conocemos ( Apache , PHP ) y MySQL la que vamos a estudiar en este tema. Duraci\u00f3n estimada : 12 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : RA6. Desarrolla aplicaciones de acceso a almacenes de datos, aplicando medidas para mantener la seguridad y la integridad de la informaci\u00f3n. a) Se han analizado las tecnolog\u00edas que permiten el acceso mediante programaci\u00f3n a la informaci\u00f3n disponible en almacenes de datos. b) Se han creado aplicaciones que establezcan conexiones con bases de datos. c) Se ha recuperado informaci\u00f3n almacenada en bases de datos. d) Se ha publicado en aplicaciones web la informaci\u00f3n recuperada. e) Se han utilizado conjuntos de datos para almacenar la informaci\u00f3n. f) Se han creado aplicaciones web que permitan la actualizaci\u00f3n y la eliminaci\u00f3n de informaci\u00f3n disponible en una base de datos. g) Se han probado y documentado las aplicaciones web. instalaci\u00f3n XAMPP : simplemente nos descargar\u00edamos el programa y lo activar\u00edamos. Para descargar XAMPP pulsa aqu\u00ed . Docker : utilizando el software de contenedores nos descargaremos la imagen docker de esta unidad did\u00e1ctica del curso y lanzamos: Bash 1 docker-compose up -d Si todo ha salido bien y el contenedor est\u00e1 en marcha, podremos visitar la p\u00e1gina de phpMyAdmin de la siguiente manera: Bash 1 http://localhost:8000 Para acceder debemos utilizar las siguientes credenciales que vienen configuradas en el archivo docker-compose.yml : Bash 1 2 usuario: root contrase\u00f1a: 1234 Recuerda Podemos utilizar tambi\u00e9n el docker Portainer para gestionar (lanzar, parar, acceder) a los contenedores generados en la imagen anterior. estructura de una base de datos Echando un vistazo al m\u00f3dulo de primer curso Bases de Datos sabemos que una base de datos tiene muchos campos con sus nombres y valores; pero adem\u00e1s sabemos que la base de datos debe tener un nombre. Por tanto, tendr\u00edamos la siguiente estructura para una base de datos: Bash 1 2 3 4 5 6 7 8 9 10 NombreBaseDeDatos | __Tabla-#1 | | __DatosTabla-#1 | | __Tabla-#2 | | __DatosTabla-#2 | | __Tabla-#3 | | __DatosTabla-#3 [ ... ] Ve\u00e1moslo en un ejemplo real: Bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 Ryanair | __pasajero | | __id [ * ] | | __nombre | | __apellidos | | __edad | | __id_vuelo [ ^ ] | | __vuelo | | __id [ * ] | | __n_plazas | | __disponible | | __id_pais [ ^ ] | | __pais | __id [ * ] | __nombre [ ] Clave primaria [^] Clave For\u00e1nea* CholloSevero A lo largo de esta unidad vamos a trabajar con una base de datos que iremos confeccionando conforme avancemos; donde almacenaremos la informaci\u00f3n relacionada con ofertas que publiquen los usuarios y los listaremos en funci\u00f3n de varios filtros, nuevos, m\u00e1s votados, m\u00e1s vistos, m\u00e1s comentados entre otros, al m\u00e1s puro estilo Chollometro . SQL Utilizaremos el lenguaje de consulta estructurada ( Structured Query Language ) SQL para realizar las consultas a nuestras bases de datos y para mostrar el contenido en las distintas interfaces web que creemos a lo largo de la unidad. Si quieres saber m\u00e1s detalles visita Wiki SQL . Ejemplo de una sentencia SQL donde seleccionamos todas las filas y columnas de nuestra tabla llamada pais : SQL 1 SELECT * FROM pais Estas sentencias pueden invocarse desde la consola de comandos mediante el int\u00e9rprete mysql* (previamente instalado en el sistema) o a trav\u00e9s de la herramienta phpMyAdmin . Las sentencias SQL tambi\u00e9n las podemos usar dentro de nuestro c\u00f3digo php; de tal manera que cuando se cargue nuestra interfaz web, lance una sentecia SQL para mostrar los datos que queramos. PHP 1 2 3 4 <?php // Listado de clientes, ordenados por DNI de manera ASCendente $clientesOrdenadosPorDNI = \"SELECT * FROM `pasajero` ORDER BY `dni` ASC\" ; ?> phpMyAdmin Este software funciona bajo Apache y PHP y es una interfaz web para gestionar las bases de datos que tengamos disponibles en nuestro servidor local. Muchos hostings ofrecen esta herramienta por defecto para poder gestionar las BBDD que tengamos configuradas bajo nuestra cuenta. Creando una base de datos dentro de phpMyAdmin Para crear una nueva base de datos debemos entrar en phpMyAdmin como usuario root y pinchar en la opci\u00f3n Nueva del men\u00fa de la izquierda. En la nueva ventana de creaci\u00f3n pondremos un nombre a nuestra bd. Tambi\u00e9n estableceremos el cotejamiento utf8m4_unicode_ci para que nuestra bd soporte todo tipo de caracteres (como los asi\u00e1ticos e incluso emojis :smile:). Le damos al bot\u00f3n de Crear para crear la bd y comenzar a creaer las distintas tablas que vayamos a introducir en ella. El sistema generar\u00e1 el c\u00f3digo SQL para crear todo lo que le hemos puesto y crear\u00e1 la base de datos con las tablas que le hayamos insertado. SQL 1 CREATE TABLE ` persona ` ( ` id ` INT NOT NULL AUTO_INCREMENT , ` nombre ` TINYTEXT NOT NULL , ` apellidos ` TEXT NOT NULL , ` telefono ` TINYTEXT NOT NULL , PRIMARY KEY ( ` id ` )) ENGINE = InnoDB ; opciones en phpMyAdmin Cuando seleccionamos una base de datos de la lista, el sistema nos muestra varias pesta\u00f1as con las cuales interactuar con la base de datos en cuesti\u00f3n: Estructura : podemos ver las distintas tablas que consolidan nuestra base de datos. SQL : si queremos inyectar c\u00f3digo SQL para que el sistema lo interprete. Buscar : para buscar por t\u00e9rminos, en nuestra base de datos, aplicando distintos filtros de b\u00fasqueda. Generar consulta : parecido a SQL pero de forma gr\u00e1fica, sin tener que saber nada del lenguaje. Exportar e importar : como su nombre indica, para hacer cualquiera de las 2 operaciones sobre la base de datos. Operaciones : distintas opciones avanzadas para realizar en nuestra base de datos, de la cual destacaremos la opci\u00f3n Cotejamiento donde podremos cambiar el cotejamiento de nuestra tabla . OJO CON \u00c9STO porque podemos eliminar datos sin querer, ya que al cambiar el cotejamiento podemos suprimir caracteres no soportados por el nuevo cotejamiento. No vamos a profundizar en el resto de opciones, pero, en la pesta\u00f1a M\u00e1s , existe la opci\u00f3n Dise\u00f1ador para poder editar las relaciones entre tablas de una manera gr\u00e1fica (pinchando y arrastrando) que veremos m\u00e1s adelante. MySQLi PHP hace uso de esta extensi\u00f3n mejorada para poder comunicarse con las bases de datos, ya sean MySQL (4.1 o superior) o MariaDB. Cualquier consulta que queramos hacer a una base de datos necesitaremos hacer uso de la extensi\u00f3n mysqli() . Veamos c\u00f3mo conectarnos con una base de datos a trav\u00e9s del c\u00f3digo PHP: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592 pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592 // \"SERVIDOR\", \"USUARIO\", \"CONTRASE\u00d1A\", \"BASE DE DATOS\" $conexion = mysqli_connect ( \"d939ebf6a741\" , \"tuUsuario\" , \"tuContrase\u00f1a\" , \"tuBaseDeDatos\" ); // COMPROBAMOS LA CONEXI\u00d3N if ( mysqli_connect_errno ()) { echo \"Failed to connect to MySQL: \" . mysqli_connect_error (); exit (); } echo \"<h1>Bienvenid@ a MySQL !!</h1>\" ; ?> servidor : el servidor donde se encuentra la base de datos que queremos usar suele ser localhost , pero en nuestro caso, al utilizar Docker ser\u00e1 el nombre de la imagen mysql:8.0 que aparece al dejar el rat\u00f3n encima en el Visual Studio Code. usuarioDB : el usuario de la base de datos. passwordDB : la contrase\u00f1a para ese usuario de la base de datos. baseDeDatos : nombre de la base de datos que queramos usar. Si todo ha salido bien habr\u00e9is visto un mensaje diciendo Bienvenid@ a MySQL !! recuperando datos de una BD Ahora que ya sabemos c\u00f3mo conectarnos a una base de datos alojada en nuestro servidor, lo que necesitamos saber es c\u00f3mo recuperar datos almacenados en la base de datos. Durante la instalaci\u00f3n de la imagen de Docker, se ha creado una tabla llamada Pruebas que contiene varios registros de distintas personas. Vamos a recuperar esos datos para ver de qu\u00e9 forma se hace con PHP. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $conexion = mysqli_connect ( \"d939ebf6a741\" , \"usuario\" , \"1234\" , \"pruebadb\" ); // COMPROBAMOS LA CONEXI\u00d3N if ( mysqli_connect_errno ()) { echo \"Failed to connect to MySQL: \" . mysqli_connect_error (); exit (); } // CONSULTA A LA BASE DE DATOS $consulta = \"SELECT * FROM `productos`\" ; $listaproductos = mysqli_query ( $conexion , $consulta ); // COMPROBAMOS SI EL SERVIDOR NOS HA DEVUELTO RESULTADOS if ( $listaproductos ) { // RECORREMOS CADA RESULTADO QUE NOS DEVUELVE EL SERVIDOR foreach ( $listaproductos as $elemento ) { echo \" $elemento[id] - $elemento[descripcion] - $elemento[stock] <br> \" ; } } ?> Si todo ha salido bien, por pantalla ver\u00e1s el siguiente listado: Text Only 1 2 3 4 5 6 7 8 9 10 \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 http://localhost/pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 1 leche 25 2 pan 12 3 galletas 5 4 gominolas 120 5 monster 2 6 kit kat 17 7 patatas fritas 7 8 donetes 5 PHP Data Objects :: PDO De la misma manera que hemos visto con mysqli, PHP Data Objects (o PDO ) es un driver de PHP que se utiliza para trabajar bajo una interfaz de objetos con la base de datos. A d\u00eda de hoy, es lo que m\u00e1s se utiliza para manejar informaci\u00f3n desde una base de datos, ya sea relacional o no relacional. De igual manera que pasaba con los objetos en PHP nativos, en la interfaz de MySQL el momento de la conexi\u00f3n es distinta: PHP 1 2 <?php $conexion = new PDO ( 'mysql:host=localhost; dbname=pruebadb' , 'usuario' , '1234' ); en docker Recordar cambiar localhost por ID del contenedor mysql:8.0 . Adem\u00e1s, con PDO podemos usar las excepciones con try / catch para gestionar los errores que se produzcan en nuestra aplicaci\u00f3n. Para ello, como hac\u00edamos antes, debemos encapsular el c\u00f3digo entre bloques try / catch: PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php // dsn (Nombre del Origen de Datos, DSN) $dsn = 'mysql:dbname=pruebadb; host=127.0.0.1' ; // 127.0.01 -> ID contenedor mysql:8.0 $usuario = 'usuario' ; $contrasenya = '1234' ; try { $mbd = new PDO ( $dsn , $usuario , $contrasenya ); $mbd -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); } catch ( PDOException $e ) { echo 'Fallo en la conexi\u00f3n: ' . $e -> getMessage (); } Los pasos a seguir han sigo: 1\u00ba ) Creamos la conexi\u00f3n con la base de datos a trav\u00e9s del constructor PDO pas\u00e1ndole la informaci\u00f3n de la base de datos. 2\u00ba ) Establecemos los par\u00e1metros para manejar las excepciones, en este caso hemos utilizado: PDO::ATTR_ERRMODE indic\u00e1ndole a PHP que queremos un reporte de errores. PDO::ERRMODE_EXCEPTION con este atributo obligamos a que lance excepciones, adem\u00e1s de ser la opci\u00f3n m\u00e1s humana y legible que hay a la hora de controlar errores. 3\u00aa ) Cualquier error que se lance a trav\u00e9s de PDO, el sistema lanzar\u00e1 una PDOException . fichero de configuraci\u00f3n de la BD De la misma manera que creamos nuestro archivo de funciones funciones-php y albergamos todas las funciones que se usan de manera global en la aplicaci\u00f3n, podemos establecer un archivo de constantes donde definamos los par\u00e1metros de conexi\u00f3n con la base de datos. PHP 1 2 3 4 5 6 7 8 9 10 <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 conexion.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 const DSN = \"mysql:host=localhost; dbname=pruebadb\" ; // localhost -> ID contenedor mysql:8.0 const USUARIO = \"usuario\" ; const PASSWORD = \"1234\" ; /* \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 * \u2592\u2592\u2592\u2592\u2592\u2592 NO SUBAS ESTE ARCHIVO A git \u2592\u2592\u2592\u2592\u2592\u2592 * \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 */ OJO Este archivo contiene informaci\u00f3n muy sensible as\u00ed que no es recomendable que subas este archivo a git. sentencias preparadas Se trata de sentencias que se establecen como si fueran plantillas de la SQL que vamos a lanzar, aceptando par\u00e1metros que son establecidos a posteriori de la declaraci\u00f3n de la sentencia preparada. Las sentencias preparadas evitan la injecci\u00f3n de SQL (SQL Injection) y mejoran el rendimiento de nuestras aplicaci\u00f3nes o p\u00e1ginas web. PHP 1 2 <?php $sql = \"INSERT INTO productos VALUES (?, ?, ?)\" ; Cada interrogante es un par\u00e1metro que estableceremos despu\u00e9s unas cuantas l\u00edneas m\u00e1s abajo. Una vez tenemos la plantilla de nuestra consulta, debemos seguir con la preparaci\u00f3n junto con 3 m\u00e9todos m\u00e1s de PHP para su completa ejecuci\u00f3n: 1\u00ba ) prepare : prepara la sentencia antes de ser ejecutada. 2\u00ba ) bind : el tipo de uni\u00f3n ( bind ) de dato. Puede ser mediante ? o :parametro . 3\u00ba ) execute : se ejecuta la consulta uniendo la plantilla con las variables o par\u00e1metros que hemos establecido. ejemplo par\u00e1metros PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 Borrando con par\u00e1metros \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $cantidad = $_GET [ \"cantidad\" ]; $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"DELETE FROM productos WHERE stock = ?\" ; $sentencia = $conexion -> prepare ( $sql ); $isOk = $sentencia -> execute ([ $cantidad ]); $cantidadAfectada = $sentencia -> rowCount (); echo $cantidadAfectada . \" fila(s) afectada(s).\" ; } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; ejemplo bindParam Muy parecido a utilizar par\u00e1metros pero esta vez la variable est\u00e1 dentro de la sentencia SQL, en este caso la hemos llamado :cant PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 <?php include \"config/database.inc.php\" ; $conexion = null ; try { $cantidad = $_GET [ \"cantidad\" ] ?? 0 ; $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"DELETE FROM productos WHERE stock = :cant\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> bindParam ( \":cant\" , $cantidad ); $isOk = $sentencia -> execute (); $cantidadAfectada = $sentencia -> rowCount (); echo $cantidadAfectada . \" fila(s) afectada(s).\" ; } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; bindValue VS bindParam Utilizaremos bindValue() cuando tengamos que insertar datos s\u00f3lo una vez. En cambio, deberemos usar bindParam() cuando tengamos que pasar datos m\u00faltiples, como por ejemplo, un array. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <?php // \u2592\u2592\u2592 FALTA CONEXI\u00d3N A BD \u2592\u2592\u2592\u2592 // se asignan nombre a los parametros $sql = \"DELETE FROM productos WHERE stock = :cant\" ; $sentencia = $conexion -> prepare ( $sql ); // bindValue enlaza por VALOR $cantidad = 0 ; $sentencia -> bindValue ( \":cant\" , $cantidad ); $cantidad = 1 ; // se eliminan con cant = 0 $isOk = $sentencia -> execute (); // bindParam enlaza por REFERENCIA $cantidad = 0 ; $sentencia -> bindParam ( \":cant\" , $cantidad ); $cantidad = 1 ; // se eliminan con cant = 1 $isOk = $sentencia -> execute (); Para m\u00e1s informaci\u00f3n y uso de las variables PDO consulta el manual de PHP . insertando registros A la hora de insertar registros en una base de datos, debemos tener en cuenta que en la tabla puede haber valores autoincrementados. Para salvaguardar esto, lo que debemos hacer es dejar vac\u00edo ese campo autoincrementado; pero a la hora de hacer la conexi\u00f3n, debemos recuperarlo con el m\u00e9todo lastInsertId() . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php include \"config/database.inc.php\" ; try { $descripcion = $_GET [ \"descripcion\" ] ?? \"PRODUCTO X\" ; $stock = $_GET [ \"stock\" ] ?? 0 ; $conexion = null ; $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"insert into productos (descripcion, stock) values (:desc, :stock)\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> bindParam ( \":desc\" , $descripcion ); $sentencia -> bindParam ( \":stock\" , $stock ); $isOk = $sentencia -> execute (); $idGenerado = $conexion -> lastInsertId (); } catch ( PDOException $e ){ echo $e -> getMessage (); } consultando registros A la hora de recuperar los resultados de una consulta, bastar\u00e1 con invocar al m\u00e9todo PDOStatement::fetch para listar las filas generadas por la consulta. Pero debemos elegir el tipo de dato que queremos recibir entre los 3 que hay disponibles: PDO::FETCH_ASSOC : array indexado cuyos keys son el nombre de las columnas. PDO::FETCH_NUM : array indexado cuyos keys son n\u00fameros. PDO::FETCH_BOTH : valor por defecto. Devuelve un array indexado cuyos keys son tanto el nombre de las columnas como n\u00fameros. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 consulta con array asociativo.php \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"select * from productos\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_ASSOC ); $sentencia -> execute (); while ( $fila = $sentencia -> fetch ()){ echo \"Id:\" . $fila [ \"id\" ] . \"<br />\" ; echo \"Descripci\u00f3n:\" . $fila [ \"descripcion\" ] . \"<br />\" ; echo \"Stock:\" . $fila [ \"stock\" ] . \"<br /><br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; Recuperando datos con una matriz como resultado de nuestra consulta: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 consulta con array asociativo \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"SELECT * FROM productos\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_ASSOC ); $sentencia -> execute (); // recuperado en la matriz $productos $productos = $sentencia -> fetchAll (); foreach ( $productos as $elemento ) { echo \"Id:\" . $elemento [ \"id\" ] . \"<br />\" ; echo \"Descripci\u00f3n:\" . $elemento [ \"descripcion\" ] . \"<br />\" ; echo \"Stock:\" . $elemento [ \"stock\" ] . \"<br /><br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; Pero si lo que queremos es leer datos con forma de objeto utilizando PDO::FETCH_OBJ , debemos crear un objeto con propiedades p\u00fablicas con el mismo nombre que las columnas de la tabla que vayamos a consultar. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592 consulta con formato de objeto \u2592\u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"SELECT * FROM productos\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_OBJ ); $sentencia -> execute (); while ( $p = $sentencia -> fetch ()) { echo \"Id:\" . $p -> id . \"<br />\" ; echo \"Descripci\u00f3n:\" . $p -> descripcion . \"<br />\" ; echo \"Stock:\" . $p -> stock . \"<br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; consultas con modelos Llevamos tiempo creando clases en PHP y las consultas tambi\u00e9n admiten este tipo de datos mediante el uso de PDO::FETCH_CLASS . Si usamos este m\u00e9todo, debemos tener en cuenta que los nombres de los atributos privados deben coincidir con los nombres de las columnas de la tabla que vayamos a manejar. As\u00ed pues, si por lo que sea cambiamos la estructura de la tabla DEBEMOS CAMBIAR nuestra clase para que todo siga funcionando. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 clase Producto \u2592\u2592\u2592\u2592\u2592\u2592 class Producto { private int $id ; private string $descripcion ; private ? int $stock ; public function getId () : int { return $this -> id ; } public function getDescripcion () : string { return $this -> descripcion ; } public function getStock () : ? int { return $this -> stock ; } } ?> <?php // \u2592\u2592\u2592\u2592\u2592\u2592 Consultando a trav\u00e9s de la clase Producto \u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM productos\" ; $sentencia = $conexion -> prepare ( $sql ); // Aqu\u00ed 'Tienda' es el nombre de nuestra clase $sentencia -> setFetchMode ( PDO :: FETCH_CLASS , \"Producto\" ); $sentencia -> execute (); while ( $p = $sentencia -> fetch ()) { echo \"Id: \" . $p -> getId () . \"<br />\" ; echo \"Descripcion: \" . $p -> getDescripcion () . \"<br />\" ; echo \"Stock: \" . $p -> getStock () . \"<br /><br />\" ; //var_dump($p); } Pero \u00bfqu\u00e9 pasa si nuestras clases tienen constructor? pues que debemos indicarle, al m\u00e9todo FECTH, que rellene las propiedades despu\u00e9s de llamar al constructor y para ello hacemos uso de PDO::FETCH_PROPS_LATE . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 clase Producto \u2592\u2592\u2592\u2592\u2592\u2592 class Producto { public function __construct ( public int $id = 1 , public string $descripcion = \"x\" , public int $stock = 1 ){ } public function getId () : int { return $this -> id ; } public function getDescripcion () : string { return $this -> descripcion ; } public function getStock () : int { return $this -> stock ; } } ?> <?php // \u2592\u2592\u2592\u2592\u2592\u2592 consulta con array asociativo.php \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"SELECT * FROM productos\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_CLASS | PDO :: FETCH_PROPS_LATE , \"Producto\" ); $sentencia -> execute (); //$productos = $sentencia -> fetchAll(); while ( $p = $sentencia -> fetch ()) { echo \"Id:\" . $p -> id . \"<br />\" ; echo \"Descripci\u00f3n:\" . $p -> descripcion . \"<br />\" ; echo \"Stock:\" . $p -> stock . \"<br /><br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; consultas con LIKE Para utilizar el comod\u00edn LIKE u otros comodines, debemos asociarlo al dato y NUNCA en la propia consulta. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 clase Producto \u2592\u2592\u2592\u2592\u2592\u2592 class Producto { public function __construct ( public int $id = 1 , public string $descripcion = \"x\" , public int $stock = 1 ){ } public function getId () : int { return $this -> id ; } public function getDescripcion () : string { return $this -> descripcion ; } public function getStock () : int { return $this -> stock ; } } ?> <?php $busqueda1 = $_POST [ \"cadenaDescripcion\" ]; $busqueda2 = $_POST [ \"numStock\" ]; // \u2592\u2592\u2592\u2592\u2592\u2592 Utilizando comodines :: LIKE \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"SELECT * FROM productos where descripcion like :desc and stock = :stk\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_CLASS | PDO :: FETCH_PROPS_LATE , Producto :: class ); $cadBuscar1 = \"%\" . $busqueda . \"%\" ; $sentencia -> execute ([ \"desc\" => $cadBuscar1 , \"stk\" => $cadBuscar2 ]); while ( $p = $sentencia -> fetch ()) { echo \"Id:\" . $p -> id . \"<br />\" ; echo \"Descripci\u00f3n:\" . $p -> descripcion . \"<br />\" ; echo \"Stock:\" . $p -> stock . \"<br /><br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; Ten\u00e9is una lista de ejemplos muy completa en la documentaci\u00f3n oficial . login & password Para manejar un sistema completo de login y password con contrase\u00f1as cifradas, necesitamos un m\u00e9todo que cifre esos strings que el usuario introduce como contrase\u00f1a; tanto en el formulario de registro como en el del login, ya que al codificar una contrase\u00f1a, despu\u00e9s tenemos que decodificarla para comprobar que ambas contras\u00f1eas (la que instroduce el usuario en el login y la que tenemos en la base de datos) coincidan. Necesitamos pues: 1\u00ba ) password_hash() para almacenar la contrase\u00f1a en la base de datos a la hora de hacer el INSERT. PASSWORD_DEFAULT almacenamos la contrase\u00f1a usando el m\u00e9todo de encriptaci\u00f3n bcrypt . PASSWORD_BCRYPT almacenamos la contrase\u00f1a usando el algoritmo CRYPT_BLOWFISH compatible con crypt(). 2\u00ba ) password_verify() para verificar el usuario y la contrase\u00f1a. Ejemplo: HTML 1 2 3 4 5 6 7 8 < form action = \"loginCrear.php\" method = \"post\" > < label for = \"usuario\" > usuario: </ label > < input type = \"text\" name = \"usuario\" > < label for = \"password\" > password: </ label > < input type = \"password\" name = \"password\" > < input type = \"submit\" name = \"enviar\" value = \"enviar\" > </ form > PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 loginCrear.php \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $usu = $_POST [ \"usuario\" ]; $pas = $_POST [ \"password\" ]; $fechaActual = date ( \"Y-m-d H:i:s\" ); $cre = $fechaActual ; $acc = $fechaActual ; $sql = \"INSERT INTO usuarios (usuario, password, created, access) VALUES (:usu, :pas, :cre, :acc)\" ; $sentencia = $conexion -> prepare ( $sql ); $isOk = $sentencia -> execute ([ \"usu\" => $usu , \"pas\" => password_hash ( $pas , PASSWORD_DEFAULT ), \"cre\" => $cre , \"acc\" => $acc ]); //$idGenerado = $conexion -> lastInsertId(); } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; Ahora que tenemos el usuario codificado y guardado en la base de datos, vamos a recuperarlo para poder loguearlo correctamente. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 Recuperando usuario y password en BD \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $usu = $_POST [ \"usuario\" ] ?? \"\" ; $sql = \"select * from usuarios where usuario = ?\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> execute ([ $usu ]); $usuario = $sentencia -> fetch (); if ( $usuario && password_verify ( $_POST [ 'password' ], $usuario [ 'password' ])) { echo \"OK!\" ; } else { echo \"KO\" ; } } catch ( PDOException $e ){ echo $e -> getMessage (); } $conexion = null ; acceso a ficheros Gracias a la funcion fopen() desde PHP podemos abrir archivos que se encuentren en nuestros servidor o una URL. A esta funci\u00f3n hay que pasarle 2 par\u00e1metros; el nombre del archivo que queremos abrir y el modo en el que se abrir\u00e1: PHP 1 $fp = fopen(\"miarchivo.txt\", \"r\"); Muchas veces no podemos abrir el archivo porque \u00e9ste no se encuentra o no tenemos acceso a \u00e9l; por eso es recomendable comprobar que podemos hacerlo: PHP 1 2 3 if (!$fp = fopen(\"miarchivo.txt\", \"r\")){ echo \"No se ha podido abrir el archivo\"; } modos de apertura de ficheros r : Modo lectura. Puntero al principio del archivo. r+ : Apertura para lectura y escritura. Puntero al principio del archivo. w : Apertura para escritura. Puntero al principio del archivo y lo sobreescribe. Si no existe se intenta crear. w+ : Apertura para lectura y escritura. Puntero al principio del archivo y lo sobreescribe. Si no existe se intenta crear. a : Apertura para escritura. Puntero al final del archivo. Si no existe se intenta crear. a+ : Apertura para lectura y escritura. Puntero al final del archivo. Si no existe se intenta crear. x : Creaci\u00f3n y apertura para s\u00f3lo escritura. Puntero al principio del archivo. Si el archivo ya existe dar\u00e1 error E_WARNING. Si no existe se intenta crear. x+ : Creaci\u00f3n y apertura para lectura y escritura. Mismo comportamiento que x. c : Apertura para escritura. Si no existe se crea. Si existe no se sobreescribe ni da ning\u00fan error. Puntero al principio del archivo. c+ : Apertura para lectura y escritura. Mismo comportamiento que C. b : Cuando se trabaja con archivos binarios como jpg, pdf, png y dem\u00e1s. Se suele colocar al final del modo, es decir rb, r+b, x+b, wb... operaciones con archivos Para poder leer un archivo necesitamos usar la funci\u00f3n fread() de PHP: PHP 1 2 3 4 5 6 7 8 9 10 11 // \u2592\u2592\u2592\u2592\u2592\u2592 Abriendo un archivo y leyendo su contenido \u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\"; $fp = fopen($file, \"r\"); // $contents guardar\u00e1 el contenido // filesize() nos devuelve el tama\u00f1o del archivo en cuesti\u00f3n $contents = fread($fp, filesize($file)); print $contents; // Cerramos la conexi\u00f3n con el archivo fclose($fp) Si lo que queremos es escribir en un archivo, deberemos hacer uso de la funci\u00f3n fwrite() : PHP 1 2 3 4 5 6 7 8 // \u2592\u2592\u2592\u2592\u2592\u2592 Escribiendo en un archivo \u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\"; $texto = \"Hola qu\u00e9 tal\"; $fp = fopen($file, \"w\"); fwrite($fp, $texto); fclose($fp); informaci\u00f3n de un fichero Con PHP y su m\u00e9todo stat() podemos obtener informaci\u00f3n sobre los archivos que le indiquemos. Este m\u00e9todo devuelve hasta un total de 12 elementos con informaci\u00f3n acerca de nuestro archivo. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 0 dev n\u00famero de dispositivo 1 ino n\u00famero de i-nodo 2 mode modo de protecci\u00f3n del i-nodo 3 nlink n\u00famero de enlaces 4 uid ID de usuario del propietario 5 gid ID de grupo del propietario 6 rdev tipo de dispositivo, si es un dispositivo i-nodo 7 size tama\u00f1o en bytes 8 atime momento del \u00faltimo acceso (tiempo Unix) 9 mtime momento de la \u00faltima modificaci\u00f3n (tiempo Unix) 10 ctime momento de la \u00faltima modificaci\u00f3n del i-nodo (tiempo Unix) 11 blksize tama\u00f1o del bloque E/S del sistema de ficheros 12 blocks n\u00famero de bloques de 512 bytes asignados Unos ejemplos... PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 Informaci\u00f3n del archivo \u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\" ; $texto = \"Todos somos muy ignorantes, lo que ocurre es que no todos ignoramos las mismas cosas.\" ; $fp = fopen ( $file , \"w\" ); fwrite ( $fp , $texto ); $datos = stat ( $file ); echo $datos [ 3 ] . \"<br>\" ; // N\u00famero de enlaces, 1 echo $datos [ 7 ] . \"<br>\" ; // Tama\u00f1o en bytes, 85 echo $datos [ 8 ] . \"<br>\" ; // Momento de \u00faltimo acceso, 1444138104 echo $datos [ 9 ] . \"<br>\" ; // Momento de \u00faltima modificaci\u00f3n, 1444138251 ?> Echa un vistazo a las funciones de directorios que tiene PHP, es muy interesante. archivos PDF Con PHP podemos manejar todo tipo de archivos como ya hemos visto pero, \u00bfqu\u00e9 pasa si queremos generar ficheros PDF con datos sacados de una base de datos? Gracias a una clase escrita en PHP, podemos generar archivos PDF sin necesidad de instalar librer\u00edas adicionales en nuestro servidor. Para ello, como tenemos composer dentro de nuestra imagen de Docker, usaremos composer para instalar esta dependencia. Acu\u00e9rdate que debemos haber hecho composer init para empezar un proyecto con composer, de lo contrario no podr\u00e1s a\u00f1adir ning\u00fan paquete. Veamos un ejemplo de Hello World convertido a PDF: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php ob_end_clean (); require ( 'fpdf/fpdf.php' ); // Instanciamos la clase // P = Portrait | mm = unidades en mil\u00edmetros | A4 = formato $pdf = new FPDF ( 'P' , 'mm' , 'A4' ); // A\u00f1adimos una p\u00e1gina $pdf -> AddPage (); // Establecemos la fuente y el tama\u00f1o de letra $pdf -> SetFont ( 'Arial' , 'B' , 18 ); // Imprimimos una celda con el texto que nosotros queramos $pdf -> Cell ( 60 , 20 , 'Hello World!' ); // Terminamos el PDF $pdf -> Output (); ?> Hay muchos ejemplos y tutoriales, as\u00ed como documentaci\u00f3n de la clase FPDF en la p\u00e1gina oficial. Visita la secci\u00f3n de tutoriales y el manual para sacar mayor partido a esta clase. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 <?php require ( 'fpdf/fpdf.php' ); class PDF extends FPDF { // Cabecera function Header () { // A\u00f1adimos un logotipo $this -> Image ( 'logo.png' , 10 , 8 , 33 ); // establecemos la fuente y el tama\u00f1o $this -> SetFont ( 'Arial' , 'B' , 20 ); // Movemos el contenido un poco a la derecha $this -> Cell ( 80 ); // Pintamos la celda $this -> Cell ( 50 , 10 , 'Cabecera' , 1 , 0 , 'C' ); // Pasamos a la siguiente l\u00ednea $this -> Ln ( 20 ); } // Pie de p\u00e1gina function Footer () { // Nos posicionamos a 1.5 cm desde abajo del todo de la p\u00e1gina $this -> SetY ( - 15 ); // Arial italic 8 $this -> SetFont ( 'Arial' , 'I' , 8 ); // N\u00famero de p\u00e1gina $this -> Cell ( 0 , 10 , 'P\u00e1gina ' . $this -> PageNo () . '/{nb}' , 0 , 0 , 'C' ); } } // Instanciamos la clase $pdf = new PDF (); // Definimos un alias para la numeraci\u00f3n de p\u00e1ginas $pdf -> AliasNbPages (); $pdf -> AddPage (); $pdf -> SetFont ( 'Times' , '' , 14 ); for ( $i = 1 ; $i <= 30 ; $i ++ ) $pdf -> Cell ( 0 , 10 , 'N\u00famero de l\u00ednea ' . $i , 0 , 1 ); $pdf -> Output (); ?> referencias Tutorial de Composer Web Scraping with PHP \u2013 How to Crawl Web Pages Using Open Source Tools PHP Monolog Unit Testing con PHPUnit \u2014 Parte 1, de Emiliano Zublena.","title":"ud06 AccesoADatos"},{"location":"ud06/ud06_AccesoADatos/#duracion-y-criterios-de-evaluacion","text":"En esta unidad vamos a aprender a acceder a datos que se encuentran en un servidor; recuperando, editando y creando dichos datos a trav\u00e9s de una base de datos. A trav\u00e9s de las distintas capas o niveles, de las cuales 2 de ellas ya conocemos ( Apache , PHP ) y MySQL la que vamos a estudiar en este tema. Duraci\u00f3n estimada : 12 sesiones Resultado de aprendizaje y criterios de evaluaci\u00f3n : RA6. Desarrolla aplicaciones de acceso a almacenes de datos, aplicando medidas para mantener la seguridad y la integridad de la informaci\u00f3n. a) Se han analizado las tecnolog\u00edas que permiten el acceso mediante programaci\u00f3n a la informaci\u00f3n disponible en almacenes de datos. b) Se han creado aplicaciones que establezcan conexiones con bases de datos. c) Se ha recuperado informaci\u00f3n almacenada en bases de datos. d) Se ha publicado en aplicaciones web la informaci\u00f3n recuperada. e) Se han utilizado conjuntos de datos para almacenar la informaci\u00f3n. f) Se han creado aplicaciones web que permitan la actualizaci\u00f3n y la eliminaci\u00f3n de informaci\u00f3n disponible en una base de datos. g) Se han probado y documentado las aplicaciones web.","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud06/ud06_AccesoADatos/#instalacion","text":"XAMPP : simplemente nos descargar\u00edamos el programa y lo activar\u00edamos. Para descargar XAMPP pulsa aqu\u00ed . Docker : utilizando el software de contenedores nos descargaremos la imagen docker de esta unidad did\u00e1ctica del curso y lanzamos: Bash 1 docker-compose up -d Si todo ha salido bien y el contenedor est\u00e1 en marcha, podremos visitar la p\u00e1gina de phpMyAdmin de la siguiente manera: Bash 1 http://localhost:8000 Para acceder debemos utilizar las siguientes credenciales que vienen configuradas en el archivo docker-compose.yml : Bash 1 2 usuario: root contrase\u00f1a: 1234 Recuerda Podemos utilizar tambi\u00e9n el docker Portainer para gestionar (lanzar, parar, acceder) a los contenedores generados en la imagen anterior.","title":"instalaci\u00f3n"},{"location":"ud06/ud06_AccesoADatos/#estructura-de-una-base-de-datos","text":"Echando un vistazo al m\u00f3dulo de primer curso Bases de Datos sabemos que una base de datos tiene muchos campos con sus nombres y valores; pero adem\u00e1s sabemos que la base de datos debe tener un nombre. Por tanto, tendr\u00edamos la siguiente estructura para una base de datos: Bash 1 2 3 4 5 6 7 8 9 10 NombreBaseDeDatos | __Tabla-#1 | | __DatosTabla-#1 | | __Tabla-#2 | | __DatosTabla-#2 | | __Tabla-#3 | | __DatosTabla-#3 [ ... ] Ve\u00e1moslo en un ejemplo real: Bash 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 Ryanair | __pasajero | | __id [ * ] | | __nombre | | __apellidos | | __edad | | __id_vuelo [ ^ ] | | __vuelo | | __id [ * ] | | __n_plazas | | __disponible | | __id_pais [ ^ ] | | __pais | __id [ * ] | __nombre [ ] Clave primaria [^] Clave For\u00e1nea*","title":"estructura de una base de datos"},{"location":"ud06/ud06_AccesoADatos/#chollosevero","text":"A lo largo de esta unidad vamos a trabajar con una base de datos que iremos confeccionando conforme avancemos; donde almacenaremos la informaci\u00f3n relacionada con ofertas que publiquen los usuarios y los listaremos en funci\u00f3n de varios filtros, nuevos, m\u00e1s votados, m\u00e1s vistos, m\u00e1s comentados entre otros, al m\u00e1s puro estilo Chollometro .","title":"CholloSevero"},{"location":"ud06/ud06_AccesoADatos/#sql","text":"Utilizaremos el lenguaje de consulta estructurada ( Structured Query Language ) SQL para realizar las consultas a nuestras bases de datos y para mostrar el contenido en las distintas interfaces web que creemos a lo largo de la unidad. Si quieres saber m\u00e1s detalles visita Wiki SQL . Ejemplo de una sentencia SQL donde seleccionamos todas las filas y columnas de nuestra tabla llamada pais : SQL 1 SELECT * FROM pais Estas sentencias pueden invocarse desde la consola de comandos mediante el int\u00e9rprete mysql* (previamente instalado en el sistema) o a trav\u00e9s de la herramienta phpMyAdmin . Las sentencias SQL tambi\u00e9n las podemos usar dentro de nuestro c\u00f3digo php; de tal manera que cuando se cargue nuestra interfaz web, lance una sentecia SQL para mostrar los datos que queramos. PHP 1 2 3 4 <?php // Listado de clientes, ordenados por DNI de manera ASCendente $clientesOrdenadosPorDNI = \"SELECT * FROM `pasajero` ORDER BY `dni` ASC\" ; ?>","title":"SQL"},{"location":"ud06/ud06_AccesoADatos/#phpmyadmin","text":"Este software funciona bajo Apache y PHP y es una interfaz web para gestionar las bases de datos que tengamos disponibles en nuestro servidor local. Muchos hostings ofrecen esta herramienta por defecto para poder gestionar las BBDD que tengamos configuradas bajo nuestra cuenta.","title":"phpMyAdmin"},{"location":"ud06/ud06_AccesoADatos/#creando-una-base-de-datos-dentro-de-phpmyadmin","text":"Para crear una nueva base de datos debemos entrar en phpMyAdmin como usuario root y pinchar en la opci\u00f3n Nueva del men\u00fa de la izquierda. En la nueva ventana de creaci\u00f3n pondremos un nombre a nuestra bd. Tambi\u00e9n estableceremos el cotejamiento utf8m4_unicode_ci para que nuestra bd soporte todo tipo de caracteres (como los asi\u00e1ticos e incluso emojis :smile:). Le damos al bot\u00f3n de Crear para crear la bd y comenzar a creaer las distintas tablas que vayamos a introducir en ella. El sistema generar\u00e1 el c\u00f3digo SQL para crear todo lo que le hemos puesto y crear\u00e1 la base de datos con las tablas que le hayamos insertado. SQL 1 CREATE TABLE ` persona ` ( ` id ` INT NOT NULL AUTO_INCREMENT , ` nombre ` TINYTEXT NOT NULL , ` apellidos ` TEXT NOT NULL , ` telefono ` TINYTEXT NOT NULL , PRIMARY KEY ( ` id ` )) ENGINE = InnoDB ;","title":"Creando una base de datos dentro de phpMyAdmin"},{"location":"ud06/ud06_AccesoADatos/#opciones-en-phpmyadmin","text":"Cuando seleccionamos una base de datos de la lista, el sistema nos muestra varias pesta\u00f1as con las cuales interactuar con la base de datos en cuesti\u00f3n: Estructura : podemos ver las distintas tablas que consolidan nuestra base de datos. SQL : si queremos inyectar c\u00f3digo SQL para que el sistema lo interprete. Buscar : para buscar por t\u00e9rminos, en nuestra base de datos, aplicando distintos filtros de b\u00fasqueda. Generar consulta : parecido a SQL pero de forma gr\u00e1fica, sin tener que saber nada del lenguaje. Exportar e importar : como su nombre indica, para hacer cualquiera de las 2 operaciones sobre la base de datos. Operaciones : distintas opciones avanzadas para realizar en nuestra base de datos, de la cual destacaremos la opci\u00f3n Cotejamiento donde podremos cambiar el cotejamiento de nuestra tabla . OJO CON \u00c9STO porque podemos eliminar datos sin querer, ya que al cambiar el cotejamiento podemos suprimir caracteres no soportados por el nuevo cotejamiento. No vamos a profundizar en el resto de opciones, pero, en la pesta\u00f1a M\u00e1s , existe la opci\u00f3n Dise\u00f1ador para poder editar las relaciones entre tablas de una manera gr\u00e1fica (pinchando y arrastrando) que veremos m\u00e1s adelante.","title":"opciones en phpMyAdmin"},{"location":"ud06/ud06_AccesoADatos/#mysqli","text":"PHP hace uso de esta extensi\u00f3n mejorada para poder comunicarse con las bases de datos, ya sean MySQL (4.1 o superior) o MariaDB. Cualquier consulta que queramos hacer a una base de datos necesitaremos hacer uso de la extensi\u00f3n mysqli() . Veamos c\u00f3mo conectarnos con una base de datos a trav\u00e9s del c\u00f3digo PHP: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592 pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592 // \"SERVIDOR\", \"USUARIO\", \"CONTRASE\u00d1A\", \"BASE DE DATOS\" $conexion = mysqli_connect ( \"d939ebf6a741\" , \"tuUsuario\" , \"tuContrase\u00f1a\" , \"tuBaseDeDatos\" ); // COMPROBAMOS LA CONEXI\u00d3N if ( mysqli_connect_errno ()) { echo \"Failed to connect to MySQL: \" . mysqli_connect_error (); exit (); } echo \"<h1>Bienvenid@ a MySQL !!</h1>\" ; ?> servidor : el servidor donde se encuentra la base de datos que queremos usar suele ser localhost , pero en nuestro caso, al utilizar Docker ser\u00e1 el nombre de la imagen mysql:8.0 que aparece al dejar el rat\u00f3n encima en el Visual Studio Code. usuarioDB : el usuario de la base de datos. passwordDB : la contrase\u00f1a para ese usuario de la base de datos. baseDeDatos : nombre de la base de datos que queramos usar. Si todo ha salido bien habr\u00e9is visto un mensaje diciendo Bienvenid@ a MySQL !!","title":"MySQLi"},{"location":"ud06/ud06_AccesoADatos/#recuperando-datos-de-una-bd","text":"Ahora que ya sabemos c\u00f3mo conectarnos a una base de datos alojada en nuestro servidor, lo que necesitamos saber es c\u00f3mo recuperar datos almacenados en la base de datos. Durante la instalaci\u00f3n de la imagen de Docker, se ha creado una tabla llamada Pruebas que contiene varios registros de distintas personas. Vamos a recuperar esos datos para ver de qu\u00e9 forma se hace con PHP. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 $conexion = mysqli_connect ( \"d939ebf6a741\" , \"usuario\" , \"1234\" , \"pruebadb\" ); // COMPROBAMOS LA CONEXI\u00d3N if ( mysqli_connect_errno ()) { echo \"Failed to connect to MySQL: \" . mysqli_connect_error (); exit (); } // CONSULTA A LA BASE DE DATOS $consulta = \"SELECT * FROM `productos`\" ; $listaproductos = mysqli_query ( $conexion , $consulta ); // COMPROBAMOS SI EL SERVIDOR NOS HA DEVUELTO RESULTADOS if ( $listaproductos ) { // RECORREMOS CADA RESULTADO QUE NOS DEVUELVE EL SERVIDOR foreach ( $listaproductos as $elemento ) { echo \" $elemento[id] - $elemento[descripcion] - $elemento[stock] <br> \" ; } } ?> Si todo ha salido bien, por pantalla ver\u00e1s el siguiente listado: Text Only 1 2 3 4 5 6 7 8 9 10 \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 http://localhost/pruebas.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 1 leche 25 2 pan 12 3 galletas 5 4 gominolas 120 5 monster 2 6 kit kat 17 7 patatas fritas 7 8 donetes 5","title":"recuperando datos de una BD"},{"location":"ud06/ud06_AccesoADatos/#php-data-objects-pdo","text":"De la misma manera que hemos visto con mysqli, PHP Data Objects (o PDO ) es un driver de PHP que se utiliza para trabajar bajo una interfaz de objetos con la base de datos. A d\u00eda de hoy, es lo que m\u00e1s se utiliza para manejar informaci\u00f3n desde una base de datos, ya sea relacional o no relacional. De igual manera que pasaba con los objetos en PHP nativos, en la interfaz de MySQL el momento de la conexi\u00f3n es distinta: PHP 1 2 <?php $conexion = new PDO ( 'mysql:host=localhost; dbname=pruebadb' , 'usuario' , '1234' ); en docker Recordar cambiar localhost por ID del contenedor mysql:8.0 . Adem\u00e1s, con PDO podemos usar las excepciones con try / catch para gestionar los errores que se produzcan en nuestra aplicaci\u00f3n. Para ello, como hac\u00edamos antes, debemos encapsular el c\u00f3digo entre bloques try / catch: PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php // dsn (Nombre del Origen de Datos, DSN) $dsn = 'mysql:dbname=pruebadb; host=127.0.0.1' ; // 127.0.01 -> ID contenedor mysql:8.0 $usuario = 'usuario' ; $contrasenya = '1234' ; try { $mbd = new PDO ( $dsn , $usuario , $contrasenya ); $mbd -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); } catch ( PDOException $e ) { echo 'Fallo en la conexi\u00f3n: ' . $e -> getMessage (); } Los pasos a seguir han sigo: 1\u00ba ) Creamos la conexi\u00f3n con la base de datos a trav\u00e9s del constructor PDO pas\u00e1ndole la informaci\u00f3n de la base de datos. 2\u00ba ) Establecemos los par\u00e1metros para manejar las excepciones, en este caso hemos utilizado: PDO::ATTR_ERRMODE indic\u00e1ndole a PHP que queremos un reporte de errores. PDO::ERRMODE_EXCEPTION con este atributo obligamos a que lance excepciones, adem\u00e1s de ser la opci\u00f3n m\u00e1s humana y legible que hay a la hora de controlar errores. 3\u00aa ) Cualquier error que se lance a trav\u00e9s de PDO, el sistema lanzar\u00e1 una PDOException .","title":"PHP Data Objects :: PDO"},{"location":"ud06/ud06_AccesoADatos/#fichero-de-configuracion-de-la-bd","text":"De la misma manera que creamos nuestro archivo de funciones funciones-php y albergamos todas las funciones que se usan de manera global en la aplicaci\u00f3n, podemos establecer un archivo de constantes donde definamos los par\u00e1metros de conexi\u00f3n con la base de datos. PHP 1 2 3 4 5 6 7 8 9 10 <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 conexion.php \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 const DSN = \"mysql:host=localhost; dbname=pruebadb\" ; // localhost -> ID contenedor mysql:8.0 const USUARIO = \"usuario\" ; const PASSWORD = \"1234\" ; /* \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 * \u2592\u2592\u2592\u2592\u2592\u2592 NO SUBAS ESTE ARCHIVO A git \u2592\u2592\u2592\u2592\u2592\u2592 * \u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592\u2592 */ OJO Este archivo contiene informaci\u00f3n muy sensible as\u00ed que no es recomendable que subas este archivo a git.","title":"fichero de configuraci\u00f3n de la BD"},{"location":"ud06/ud06_AccesoADatos/#sentencias-preparadas","text":"Se trata de sentencias que se establecen como si fueran plantillas de la SQL que vamos a lanzar, aceptando par\u00e1metros que son establecidos a posteriori de la declaraci\u00f3n de la sentencia preparada. Las sentencias preparadas evitan la injecci\u00f3n de SQL (SQL Injection) y mejoran el rendimiento de nuestras aplicaci\u00f3nes o p\u00e1ginas web. PHP 1 2 <?php $sql = \"INSERT INTO productos VALUES (?, ?, ?)\" ; Cada interrogante es un par\u00e1metro que estableceremos despu\u00e9s unas cuantas l\u00edneas m\u00e1s abajo. Una vez tenemos la plantilla de nuestra consulta, debemos seguir con la preparaci\u00f3n junto con 3 m\u00e9todos m\u00e1s de PHP para su completa ejecuci\u00f3n: 1\u00ba ) prepare : prepara la sentencia antes de ser ejecutada. 2\u00ba ) bind : el tipo de uni\u00f3n ( bind ) de dato. Puede ser mediante ? o :parametro . 3\u00ba ) execute : se ejecuta la consulta uniendo la plantilla con las variables o par\u00e1metros que hemos establecido.","title":"sentencias preparadas"},{"location":"ud06/ud06_AccesoADatos/#ejemplo-parametros","text":"PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 Borrando con par\u00e1metros \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $cantidad = $_GET [ \"cantidad\" ]; $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"DELETE FROM productos WHERE stock = ?\" ; $sentencia = $conexion -> prepare ( $sql ); $isOk = $sentencia -> execute ([ $cantidad ]); $cantidadAfectada = $sentencia -> rowCount (); echo $cantidadAfectada . \" fila(s) afectada(s).\" ; } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ;","title":"ejemplo par\u00e1metros"},{"location":"ud06/ud06_AccesoADatos/#ejemplo-bindparam","text":"Muy parecido a utilizar par\u00e1metros pero esta vez la variable est\u00e1 dentro de la sentencia SQL, en este caso la hemos llamado :cant PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 <?php include \"config/database.inc.php\" ; $conexion = null ; try { $cantidad = $_GET [ \"cantidad\" ] ?? 0 ; $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"DELETE FROM productos WHERE stock = :cant\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> bindParam ( \":cant\" , $cantidad ); $isOk = $sentencia -> execute (); $cantidadAfectada = $sentencia -> rowCount (); echo $cantidadAfectada . \" fila(s) afectada(s).\" ; } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ;","title":"ejemplo bindParam"},{"location":"ud06/ud06_AccesoADatos/#bindvalue-vs-bindparam","text":"Utilizaremos bindValue() cuando tengamos que insertar datos s\u00f3lo una vez. En cambio, deberemos usar bindParam() cuando tengamos que pasar datos m\u00faltiples, como por ejemplo, un array. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <?php // \u2592\u2592\u2592 FALTA CONEXI\u00d3N A BD \u2592\u2592\u2592\u2592 // se asignan nombre a los parametros $sql = \"DELETE FROM productos WHERE stock = :cant\" ; $sentencia = $conexion -> prepare ( $sql ); // bindValue enlaza por VALOR $cantidad = 0 ; $sentencia -> bindValue ( \":cant\" , $cantidad ); $cantidad = 1 ; // se eliminan con cant = 0 $isOk = $sentencia -> execute (); // bindParam enlaza por REFERENCIA $cantidad = 0 ; $sentencia -> bindParam ( \":cant\" , $cantidad ); $cantidad = 1 ; // se eliminan con cant = 1 $isOk = $sentencia -> execute (); Para m\u00e1s informaci\u00f3n y uso de las variables PDO consulta el manual de PHP .","title":"bindValue VS bindParam"},{"location":"ud06/ud06_AccesoADatos/#insertando-registros","text":"A la hora de insertar registros en una base de datos, debemos tener en cuenta que en la tabla puede haber valores autoincrementados. Para salvaguardar esto, lo que debemos hacer es dejar vac\u00edo ese campo autoincrementado; pero a la hora de hacer la conexi\u00f3n, debemos recuperarlo con el m\u00e9todo lastInsertId() . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 <?php include \"config/database.inc.php\" ; try { $descripcion = $_GET [ \"descripcion\" ] ?? \"PRODUCTO X\" ; $stock = $_GET [ \"stock\" ] ?? 0 ; $conexion = null ; $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"insert into productos (descripcion, stock) values (:desc, :stock)\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> bindParam ( \":desc\" , $descripcion ); $sentencia -> bindParam ( \":stock\" , $stock ); $isOk = $sentencia -> execute (); $idGenerado = $conexion -> lastInsertId (); } catch ( PDOException $e ){ echo $e -> getMessage (); }","title":"insertando registros"},{"location":"ud06/ud06_AccesoADatos/#consultando-registros","text":"A la hora de recuperar los resultados de una consulta, bastar\u00e1 con invocar al m\u00e9todo PDOStatement::fetch para listar las filas generadas por la consulta. Pero debemos elegir el tipo de dato que queremos recibir entre los 3 que hay disponibles: PDO::FETCH_ASSOC : array indexado cuyos keys son el nombre de las columnas. PDO::FETCH_NUM : array indexado cuyos keys son n\u00fameros. PDO::FETCH_BOTH : valor por defecto. Devuelve un array indexado cuyos keys son tanto el nombre de las columnas como n\u00fameros. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 consulta con array asociativo.php \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"select * from productos\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_ASSOC ); $sentencia -> execute (); while ( $fila = $sentencia -> fetch ()){ echo \"Id:\" . $fila [ \"id\" ] . \"<br />\" ; echo \"Descripci\u00f3n:\" . $fila [ \"descripcion\" ] . \"<br />\" ; echo \"Stock:\" . $fila [ \"stock\" ] . \"<br /><br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; Recuperando datos con una matriz como resultado de nuestra consulta: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 consulta con array asociativo \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"SELECT * FROM productos\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_ASSOC ); $sentencia -> execute (); // recuperado en la matriz $productos $productos = $sentencia -> fetchAll (); foreach ( $productos as $elemento ) { echo \"Id:\" . $elemento [ \"id\" ] . \"<br />\" ; echo \"Descripci\u00f3n:\" . $elemento [ \"descripcion\" ] . \"<br />\" ; echo \"Stock:\" . $elemento [ \"stock\" ] . \"<br /><br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; Pero si lo que queremos es leer datos con forma de objeto utilizando PDO::FETCH_OBJ , debemos crear un objeto con propiedades p\u00fablicas con el mismo nombre que las columnas de la tabla que vayamos a consultar. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 <?php // \u2592\u2592\u2592\u2592\u2592\u2592\u2592 consulta con formato de objeto \u2592\u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"SELECT * FROM productos\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_OBJ ); $sentencia -> execute (); while ( $p = $sentencia -> fetch ()) { echo \"Id:\" . $p -> id . \"<br />\" ; echo \"Descripci\u00f3n:\" . $p -> descripcion . \"<br />\" ; echo \"Stock:\" . $p -> stock . \"<br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ;","title":"consultando registros"},{"location":"ud06/ud06_AccesoADatos/#consultas-con-modelos","text":"Llevamos tiempo creando clases en PHP y las consultas tambi\u00e9n admiten este tipo de datos mediante el uso de PDO::FETCH_CLASS . Si usamos este m\u00e9todo, debemos tener en cuenta que los nombres de los atributos privados deben coincidir con los nombres de las columnas de la tabla que vayamos a manejar. As\u00ed pues, si por lo que sea cambiamos la estructura de la tabla DEBEMOS CAMBIAR nuestra clase para que todo siga funcionando. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 clase Producto \u2592\u2592\u2592\u2592\u2592\u2592 class Producto { private int $id ; private string $descripcion ; private ? int $stock ; public function getId () : int { return $this -> id ; } public function getDescripcion () : string { return $this -> descripcion ; } public function getStock () : ? int { return $this -> stock ; } } ?> <?php // \u2592\u2592\u2592\u2592\u2592\u2592 Consultando a trav\u00e9s de la clase Producto \u2592\u2592\u2592\u2592\u2592\u2592 $sql = \"SELECT * FROM productos\" ; $sentencia = $conexion -> prepare ( $sql ); // Aqu\u00ed 'Tienda' es el nombre de nuestra clase $sentencia -> setFetchMode ( PDO :: FETCH_CLASS , \"Producto\" ); $sentencia -> execute (); while ( $p = $sentencia -> fetch ()) { echo \"Id: \" . $p -> getId () . \"<br />\" ; echo \"Descripcion: \" . $p -> getDescripcion () . \"<br />\" ; echo \"Stock: \" . $p -> getStock () . \"<br /><br />\" ; //var_dump($p); } Pero \u00bfqu\u00e9 pasa si nuestras clases tienen constructor? pues que debemos indicarle, al m\u00e9todo FECTH, que rellene las propiedades despu\u00e9s de llamar al constructor y para ello hacemos uso de PDO::FETCH_PROPS_LATE . PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 clase Producto \u2592\u2592\u2592\u2592\u2592\u2592 class Producto { public function __construct ( public int $id = 1 , public string $descripcion = \"x\" , public int $stock = 1 ){ } public function getId () : int { return $this -> id ; } public function getDescripcion () : string { return $this -> descripcion ; } public function getStock () : int { return $this -> stock ; } } ?> <?php // \u2592\u2592\u2592\u2592\u2592\u2592 consulta con array asociativo.php \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"SELECT * FROM productos\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_CLASS | PDO :: FETCH_PROPS_LATE , \"Producto\" ); $sentencia -> execute (); //$productos = $sentencia -> fetchAll(); while ( $p = $sentencia -> fetch ()) { echo \"Id:\" . $p -> id . \"<br />\" ; echo \"Descripci\u00f3n:\" . $p -> descripcion . \"<br />\" ; echo \"Stock:\" . $p -> stock . \"<br /><br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ;","title":"consultas con modelos"},{"location":"ud06/ud06_AccesoADatos/#consultas-con-like","text":"Para utilizar el comod\u00edn LIKE u otros comodines, debemos asociarlo al dato y NUNCA en la propia consulta. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 clase Producto \u2592\u2592\u2592\u2592\u2592\u2592 class Producto { public function __construct ( public int $id = 1 , public string $descripcion = \"x\" , public int $stock = 1 ){ } public function getId () : int { return $this -> id ; } public function getDescripcion () : string { return $this -> descripcion ; } public function getStock () : int { return $this -> stock ; } } ?> <?php $busqueda1 = $_POST [ \"cadenaDescripcion\" ]; $busqueda2 = $_POST [ \"numStock\" ]; // \u2592\u2592\u2592\u2592\u2592\u2592 Utilizando comodines :: LIKE \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $sql = \"SELECT * FROM productos where descripcion like :desc and stock = :stk\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> setFetchMode ( PDO :: FETCH_CLASS | PDO :: FETCH_PROPS_LATE , Producto :: class ); $cadBuscar1 = \"%\" . $busqueda . \"%\" ; $sentencia -> execute ([ \"desc\" => $cadBuscar1 , \"stk\" => $cadBuscar2 ]); while ( $p = $sentencia -> fetch ()) { echo \"Id:\" . $p -> id . \"<br />\" ; echo \"Descripci\u00f3n:\" . $p -> descripcion . \"<br />\" ; echo \"Stock:\" . $p -> stock . \"<br /><br />\" ; } } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; Ten\u00e9is una lista de ejemplos muy completa en la documentaci\u00f3n oficial .","title":"consultas con LIKE"},{"location":"ud06/ud06_AccesoADatos/#login-password","text":"Para manejar un sistema completo de login y password con contrase\u00f1as cifradas, necesitamos un m\u00e9todo que cifre esos strings que el usuario introduce como contrase\u00f1a; tanto en el formulario de registro como en el del login, ya que al codificar una contrase\u00f1a, despu\u00e9s tenemos que decodificarla para comprobar que ambas contras\u00f1eas (la que instroduce el usuario en el login y la que tenemos en la base de datos) coincidan. Necesitamos pues: 1\u00ba ) password_hash() para almacenar la contrase\u00f1a en la base de datos a la hora de hacer el INSERT. PASSWORD_DEFAULT almacenamos la contrase\u00f1a usando el m\u00e9todo de encriptaci\u00f3n bcrypt . PASSWORD_BCRYPT almacenamos la contrase\u00f1a usando el algoritmo CRYPT_BLOWFISH compatible con crypt(). 2\u00ba ) password_verify() para verificar el usuario y la contrase\u00f1a. Ejemplo: HTML 1 2 3 4 5 6 7 8 < form action = \"loginCrear.php\" method = \"post\" > < label for = \"usuario\" > usuario: </ label > < input type = \"text\" name = \"usuario\" > < label for = \"password\" > password: </ label > < input type = \"password\" name = \"password\" > < input type = \"submit\" name = \"enviar\" value = \"enviar\" > </ form > PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 loginCrear.php \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $usu = $_POST [ \"usuario\" ]; $pas = $_POST [ \"password\" ]; $fechaActual = date ( \"Y-m-d H:i:s\" ); $cre = $fechaActual ; $acc = $fechaActual ; $sql = \"INSERT INTO usuarios (usuario, password, created, access) VALUES (:usu, :pas, :cre, :acc)\" ; $sentencia = $conexion -> prepare ( $sql ); $isOk = $sentencia -> execute ([ \"usu\" => $usu , \"pas\" => password_hash ( $pas , PASSWORD_DEFAULT ), \"cre\" => $cre , \"acc\" => $acc ]); //$idGenerado = $conexion -> lastInsertId(); } catch ( PDOException $e ) { echo $e -> getMessage (); } $conexion = null ; Ahora que tenemos el usuario codificado y guardado en la base de datos, vamos a recuperarlo para poder loguearlo correctamente. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 Recuperando usuario y password en BD \u2592\u2592\u2592\u2592\u2592\u2592 include \"config/database.inc.php\" ; $conexion = null ; try { $conexion = new PDO ( DSN , USUARIO , PASSWORD ); $conexion -> setAttribute ( PDO :: ATTR_ERRMODE , PDO :: ERRMODE_EXCEPTION ); $usu = $_POST [ \"usuario\" ] ?? \"\" ; $sql = \"select * from usuarios where usuario = ?\" ; $sentencia = $conexion -> prepare ( $sql ); $sentencia -> execute ([ $usu ]); $usuario = $sentencia -> fetch (); if ( $usuario && password_verify ( $_POST [ 'password' ], $usuario [ 'password' ])) { echo \"OK!\" ; } else { echo \"KO\" ; } } catch ( PDOException $e ){ echo $e -> getMessage (); } $conexion = null ;","title":"login &amp; password"},{"location":"ud06/ud06_AccesoADatos/#acceso-a-ficheros","text":"Gracias a la funcion fopen() desde PHP podemos abrir archivos que se encuentren en nuestros servidor o una URL. A esta funci\u00f3n hay que pasarle 2 par\u00e1metros; el nombre del archivo que queremos abrir y el modo en el que se abrir\u00e1: PHP 1 $fp = fopen(\"miarchivo.txt\", \"r\"); Muchas veces no podemos abrir el archivo porque \u00e9ste no se encuentra o no tenemos acceso a \u00e9l; por eso es recomendable comprobar que podemos hacerlo: PHP 1 2 3 if (!$fp = fopen(\"miarchivo.txt\", \"r\")){ echo \"No se ha podido abrir el archivo\"; }","title":"acceso a ficheros"},{"location":"ud06/ud06_AccesoADatos/#modos-de-apertura-de-ficheros","text":"r : Modo lectura. Puntero al principio del archivo. r+ : Apertura para lectura y escritura. Puntero al principio del archivo. w : Apertura para escritura. Puntero al principio del archivo y lo sobreescribe. Si no existe se intenta crear. w+ : Apertura para lectura y escritura. Puntero al principio del archivo y lo sobreescribe. Si no existe se intenta crear. a : Apertura para escritura. Puntero al final del archivo. Si no existe se intenta crear. a+ : Apertura para lectura y escritura. Puntero al final del archivo. Si no existe se intenta crear. x : Creaci\u00f3n y apertura para s\u00f3lo escritura. Puntero al principio del archivo. Si el archivo ya existe dar\u00e1 error E_WARNING. Si no existe se intenta crear. x+ : Creaci\u00f3n y apertura para lectura y escritura. Mismo comportamiento que x. c : Apertura para escritura. Si no existe se crea. Si existe no se sobreescribe ni da ning\u00fan error. Puntero al principio del archivo. c+ : Apertura para lectura y escritura. Mismo comportamiento que C. b : Cuando se trabaja con archivos binarios como jpg, pdf, png y dem\u00e1s. Se suele colocar al final del modo, es decir rb, r+b, x+b, wb...","title":"modos de apertura de ficheros"},{"location":"ud06/ud06_AccesoADatos/#operaciones-con-archivos","text":"Para poder leer un archivo necesitamos usar la funci\u00f3n fread() de PHP: PHP 1 2 3 4 5 6 7 8 9 10 11 // \u2592\u2592\u2592\u2592\u2592\u2592 Abriendo un archivo y leyendo su contenido \u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\"; $fp = fopen($file, \"r\"); // $contents guardar\u00e1 el contenido // filesize() nos devuelve el tama\u00f1o del archivo en cuesti\u00f3n $contents = fread($fp, filesize($file)); print $contents; // Cerramos la conexi\u00f3n con el archivo fclose($fp) Si lo que queremos es escribir en un archivo, deberemos hacer uso de la funci\u00f3n fwrite() : PHP 1 2 3 4 5 6 7 8 // \u2592\u2592\u2592\u2592\u2592\u2592 Escribiendo en un archivo \u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\"; $texto = \"Hola qu\u00e9 tal\"; $fp = fopen($file, \"w\"); fwrite($fp, $texto); fclose($fp);","title":"operaciones con archivos"},{"location":"ud06/ud06_AccesoADatos/#informacion-de-un-fichero","text":"Con PHP y su m\u00e9todo stat() podemos obtener informaci\u00f3n sobre los archivos que le indiquemos. Este m\u00e9todo devuelve hasta un total de 12 elementos con informaci\u00f3n acerca de nuestro archivo. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 0 dev n\u00famero de dispositivo 1 ino n\u00famero de i-nodo 2 mode modo de protecci\u00f3n del i-nodo 3 nlink n\u00famero de enlaces 4 uid ID de usuario del propietario 5 gid ID de grupo del propietario 6 rdev tipo de dispositivo, si es un dispositivo i-nodo 7 size tama\u00f1o en bytes 8 atime momento del \u00faltimo acceso (tiempo Unix) 9 mtime momento de la \u00faltima modificaci\u00f3n (tiempo Unix) 10 ctime momento de la \u00faltima modificaci\u00f3n del i-nodo (tiempo Unix) 11 blksize tama\u00f1o del bloque E/S del sistema de ficheros 12 blocks n\u00famero de bloques de 512 bytes asignados Unos ejemplos... PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php // \u2592\u2592\u2592\u2592\u2592\u2592 Informaci\u00f3n del archivo \u2592\u2592\u2592\u2592\u2592\u2592 $file = \"miarchivo.txt\" ; $texto = \"Todos somos muy ignorantes, lo que ocurre es que no todos ignoramos las mismas cosas.\" ; $fp = fopen ( $file , \"w\" ); fwrite ( $fp , $texto ); $datos = stat ( $file ); echo $datos [ 3 ] . \"<br>\" ; // N\u00famero de enlaces, 1 echo $datos [ 7 ] . \"<br>\" ; // Tama\u00f1o en bytes, 85 echo $datos [ 8 ] . \"<br>\" ; // Momento de \u00faltimo acceso, 1444138104 echo $datos [ 9 ] . \"<br>\" ; // Momento de \u00faltima modificaci\u00f3n, 1444138251 ?> Echa un vistazo a las funciones de directorios que tiene PHP, es muy interesante.","title":"informaci\u00f3n de un fichero"},{"location":"ud06/ud06_AccesoADatos/#archivos-pdf","text":"Con PHP podemos manejar todo tipo de archivos como ya hemos visto pero, \u00bfqu\u00e9 pasa si queremos generar ficheros PDF con datos sacados de una base de datos? Gracias a una clase escrita en PHP, podemos generar archivos PDF sin necesidad de instalar librer\u00edas adicionales en nuestro servidor. Para ello, como tenemos composer dentro de nuestra imagen de Docker, usaremos composer para instalar esta dependencia. Acu\u00e9rdate que debemos haber hecho composer init para empezar un proyecto con composer, de lo contrario no podr\u00e1s a\u00f1adir ning\u00fan paquete. Veamos un ejemplo de Hello World convertido a PDF: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 <?php ob_end_clean (); require ( 'fpdf/fpdf.php' ); // Instanciamos la clase // P = Portrait | mm = unidades en mil\u00edmetros | A4 = formato $pdf = new FPDF ( 'P' , 'mm' , 'A4' ); // A\u00f1adimos una p\u00e1gina $pdf -> AddPage (); // Establecemos la fuente y el tama\u00f1o de letra $pdf -> SetFont ( 'Arial' , 'B' , 18 ); // Imprimimos una celda con el texto que nosotros queramos $pdf -> Cell ( 60 , 20 , 'Hello World!' ); // Terminamos el PDF $pdf -> Output (); ?> Hay muchos ejemplos y tutoriales, as\u00ed como documentaci\u00f3n de la clase FPDF en la p\u00e1gina oficial. Visita la secci\u00f3n de tutoriales y el manual para sacar mayor partido a esta clase. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 <?php require ( 'fpdf/fpdf.php' ); class PDF extends FPDF { // Cabecera function Header () { // A\u00f1adimos un logotipo $this -> Image ( 'logo.png' , 10 , 8 , 33 ); // establecemos la fuente y el tama\u00f1o $this -> SetFont ( 'Arial' , 'B' , 20 ); // Movemos el contenido un poco a la derecha $this -> Cell ( 80 ); // Pintamos la celda $this -> Cell ( 50 , 10 , 'Cabecera' , 1 , 0 , 'C' ); // Pasamos a la siguiente l\u00ednea $this -> Ln ( 20 ); } // Pie de p\u00e1gina function Footer () { // Nos posicionamos a 1.5 cm desde abajo del todo de la p\u00e1gina $this -> SetY ( - 15 ); // Arial italic 8 $this -> SetFont ( 'Arial' , 'I' , 8 ); // N\u00famero de p\u00e1gina $this -> Cell ( 0 , 10 , 'P\u00e1gina ' . $this -> PageNo () . '/{nb}' , 0 , 0 , 'C' ); } } // Instanciamos la clase $pdf = new PDF (); // Definimos un alias para la numeraci\u00f3n de p\u00e1ginas $pdf -> AliasNbPages (); $pdf -> AddPage (); $pdf -> SetFont ( 'Times' , '' , 14 ); for ( $i = 1 ; $i <= 30 ; $i ++ ) $pdf -> Cell ( 0 , 10 , 'N\u00famero de l\u00ednea ' . $i , 0 , 1 ); $pdf -> Output (); ?>","title":"archivos PDF"},{"location":"ud06/ud06_AccesoADatos/#referencias","text":"Tutorial de Composer Web Scraping with PHP \u2013 How to Crawl Web Pages Using Open Source Tools PHP Monolog Unit Testing con PHPUnit \u2014 Parte 1, de Emiliano Zublena.","title":"referencias"},{"location":"ud06/ud06_AccesoADatos_actividades/","text":"unit: unidad did\u00e1ctica 6 title: Actividades language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets MySQLi filtros y comodines PDO ficheros proyecto CholloSevero MySQLi Actividad 601 Crea una nueva base de datos con el nombre lol y cotejamiento de datos utf8mb4_unicode_ci . Actividad 602 En nuestra base de datos lol que acabamos de crear, vamos a crear la tabla campeon con los siguientes campos (no olvides poner el tipo de datos de cada uno de los campos). id [*] nombre rol dificultad descripcion [*] clave primaria. Actividad 603 Rellena la tabla campeon con, al menos 5 registros, con los datos que t\u00fa quieras o si lo prefieres, puedes basarte en la p\u00e1gina oficial del juego pero \u00a1\u00a1 NO TE PONGAS A JUGAR !! Actividad 604 Crea 604campeones.php y lista todos los campeones del LOL que has metido en tu base de datos (1\u00ba conexi\u00f3n a BD y 2\u00ba foreach para cada campe\u00f3n que tengas en la tabla campeon ). Actividad 605 Modifica el archivo 604campeones.php y gu\u00e1rdalo como 606campeones.php pero pon al lado de cada uno de los campeones listados un bot\u00f3n para editar y otro para borrar . Cada uno de esos botones har\u00e1 la correspondiente funci\u00f3n dependiendo del id del campe\u00f3n seleccionado. Al pinchar en editar, el usuario ser\u00e1 redirigido al archivo 605editando.php donde mostrar\u00e1 un formulario con los campos rellenos por los datos del campe\u00f3n seleccionado. Al darle al bot\u00f3n de guardar los datos se guardar\u00e1n en la base de datos y el usuario ser\u00e1 redirigido a la lista de campones para poder ver los cambios. Al pinchar en borrar, el usuario ser\u00e1 preguntado a trav\u00e9s de un mensaje de JavaScript (prompt) si est\u00e1 seguro de que quiere borrar al campe\u00f3n seleccionado. En el mensaje de confirmaci\u00f3n debe aparecer el nombre del campe\u00f3n seleccionado . Si el usuario pincha en Aceptar el campe\u00f3n ser\u00e1 eliminado de la base de datos y el usuario ser\u00e1 redirigido nuevamente al listado de campeones para comprobar que, efectivamente dicho campe\u00f3n se ha eliminado de la lista. filtros y comodines Actividad 606 Modifica el archivo 604campeones.php y gu\u00e1rdalo como 606campeones.php para que se muestre como una tabla con las columnas de la propia tabla de la base de datos, es decir; id, nombre, rol, dificultad, descripci\u00f3n. Al lado de cada nombre de cada columna, pon 2 iconos que sean \u02c4 \u02c5 y que cada uno de ellos ordene el listado en funci\u00f3n de cu\u00e1l se haya pinchado. Si se ha pulsado en Nombre el icono de \u02c4, el listado debe aparecer ordenado por nombre ascendente. Si por el contrario se ha pulsado \u02c5 tendr\u00e1 que ordenarse por nombre descendente. Ten en cuenta que cada icono debe llevar consigo un enlace al listado que contenga par\u00e1metros en la URL que satisfagan las opciones seleccionadas as\u00ed que haced uso de $_GET para poder capturarlos y escribid las consultas SQL que sean necesarias para hacer cada uno de los filtros. Puedes usar Font Awesome para los iconos pero es algo opcional. PDO Actividad 607 Aprovecha lo que hiciste de los ejercicios 601 al 604 pero esta vez utilizando PDO::FETCH_ASSOC . Actividad 608 Crea una tabla nueva dentro de la base de datos lol que ya tienes y crea un sistema de login con usuarios. Introduce en la base de datos al menos 3 usuarios diferentes con sus contrase\u00f1as distintas. Recuerda que: La tabla nueva ha de llamarse usuario . Los campos a crear en la nueva tabla deben ser id [*] nombre usuario password email Las contrase\u00f1as deben ser cifradas antes de guardar el datos en la base de datos. Crea el formulario 608registro.php donde el usuario introduzca los datos de registro y vinc\u00falalo con 608nuevoUsuario.php para que recoja los datos mediante POST y los inserte en la base de datos si todo ha ido bien. Queda PROHIBID\u00cdSIMO acceder a 608nuevoUsuario.php sin el formulario rellenado. La sentencia de INSERT debe estar controlada para que no pueda introducirse ning\u00fan dato en blanco. Ten en cuenta que est\u00e1s modificando la base de datos y no queremos campos mal rellenados. Si todo ha ido bien, muestra un mensaje por pantalla diciendo El usuario XXX ha sido introducido en el sistema con la contrase\u00f1a YYY . ficheros Actividad 609 Entra en loremipsum.com y genera un texto de 3 p\u00e1rrafos. Copia el texto generado y gu\u00e1rdalo en un archivo nuevo llamado 609loremIpsum.txt . Genera un archivo php llamado 609loremIpsum.php y muestra por pantalla el texto del archivo txt que acabas de crear, su tama\u00f1o en Kilobytes , la fecha de su \u00faltima modificaci\u00f3n y el ID de usuario que cre\u00f3 el archivo. Actividad 610 Vuelve a cargar el archivo 606campeones.php y ren\u00f3mbralo a 610campeones.php pero en vez de mostrar la tabla por pantalla, genera un archivo CSV 610campeones.csv y otro 610campeonesCSV.php donde saques por pantalla el contenido del archivo 610campeones.csv . proyecto CholloSevero Actividad 615 Estructura el proyecto y piensa en las tablas y bases de datos que necesit\u00e9is para crear el proyecto. Crea los UML necesarios con nombres como 615UMLnombreTabla metiendo todos los campos que se necesiten as\u00ed como las relaciones que creas necesarias. Establece un sistema de archivos para el proyecto, teniendo en cuenta que van a haber im\u00e1genes, css, funciones php, constantes e incluso javaScript (pero algo b\u00e1sico) para controlar los eventos del usuario a lo largo de la interfaz. Actividad 616 Crea un sistema de login/password con los roles administrador y usuario . De momento que se validen los usuarios correctamente utilizando encriptaci\u00f3n en la contrase\u00f1a. Administrador : Puede ver todos los usuarios registrados as\u00ed como los administradores y los chollos creados en la base de datos. Usuario : Puede ver sus propios chollos, editarlos y borrarlos, adem\u00e1s de crear nuevos. Actividad 617 Crea la vista para poner nuevos chollos y recuerda s\u00f3lo pueden entrar a esta vista usuarios registrados o administradores . Actividad 618 Crea la vista donde se muestren todos los chollos creados. Esta vista puede verla cualquier usuario, registrado o no en el sistema. Ten en cuenta que esta vista ser\u00e1 la vista general de la web as\u00ed que puedes llamarla index.php donde despu\u00e9s aplicaremos filtros por $_GET.","title":"ud06 AccesoADatos actividades"},{"location":"ud06/ud06_AccesoADatos_actividades/#mysqli","text":"Actividad 601 Crea una nueva base de datos con el nombre lol y cotejamiento de datos utf8mb4_unicode_ci . Actividad 602 En nuestra base de datos lol que acabamos de crear, vamos a crear la tabla campeon con los siguientes campos (no olvides poner el tipo de datos de cada uno de los campos). id [*] nombre rol dificultad descripcion [*] clave primaria. Actividad 603 Rellena la tabla campeon con, al menos 5 registros, con los datos que t\u00fa quieras o si lo prefieres, puedes basarte en la p\u00e1gina oficial del juego pero \u00a1\u00a1 NO TE PONGAS A JUGAR !! Actividad 604 Crea 604campeones.php y lista todos los campeones del LOL que has metido en tu base de datos (1\u00ba conexi\u00f3n a BD y 2\u00ba foreach para cada campe\u00f3n que tengas en la tabla campeon ). Actividad 605 Modifica el archivo 604campeones.php y gu\u00e1rdalo como 606campeones.php pero pon al lado de cada uno de los campeones listados un bot\u00f3n para editar y otro para borrar . Cada uno de esos botones har\u00e1 la correspondiente funci\u00f3n dependiendo del id del campe\u00f3n seleccionado. Al pinchar en editar, el usuario ser\u00e1 redirigido al archivo 605editando.php donde mostrar\u00e1 un formulario con los campos rellenos por los datos del campe\u00f3n seleccionado. Al darle al bot\u00f3n de guardar los datos se guardar\u00e1n en la base de datos y el usuario ser\u00e1 redirigido a la lista de campones para poder ver los cambios. Al pinchar en borrar, el usuario ser\u00e1 preguntado a trav\u00e9s de un mensaje de JavaScript (prompt) si est\u00e1 seguro de que quiere borrar al campe\u00f3n seleccionado. En el mensaje de confirmaci\u00f3n debe aparecer el nombre del campe\u00f3n seleccionado . Si el usuario pincha en Aceptar el campe\u00f3n ser\u00e1 eliminado de la base de datos y el usuario ser\u00e1 redirigido nuevamente al listado de campeones para comprobar que, efectivamente dicho campe\u00f3n se ha eliminado de la lista.","title":"MySQLi"},{"location":"ud06/ud06_AccesoADatos_actividades/#filtros-y-comodines","text":"Actividad 606 Modifica el archivo 604campeones.php y gu\u00e1rdalo como 606campeones.php para que se muestre como una tabla con las columnas de la propia tabla de la base de datos, es decir; id, nombre, rol, dificultad, descripci\u00f3n. Al lado de cada nombre de cada columna, pon 2 iconos que sean \u02c4 \u02c5 y que cada uno de ellos ordene el listado en funci\u00f3n de cu\u00e1l se haya pinchado. Si se ha pulsado en Nombre el icono de \u02c4, el listado debe aparecer ordenado por nombre ascendente. Si por el contrario se ha pulsado \u02c5 tendr\u00e1 que ordenarse por nombre descendente. Ten en cuenta que cada icono debe llevar consigo un enlace al listado que contenga par\u00e1metros en la URL que satisfagan las opciones seleccionadas as\u00ed que haced uso de $_GET para poder capturarlos y escribid las consultas SQL que sean necesarias para hacer cada uno de los filtros. Puedes usar Font Awesome para los iconos pero es algo opcional.","title":"filtros y comodines"},{"location":"ud06/ud06_AccesoADatos_actividades/#pdo","text":"Actividad 607 Aprovecha lo que hiciste de los ejercicios 601 al 604 pero esta vez utilizando PDO::FETCH_ASSOC . Actividad 608 Crea una tabla nueva dentro de la base de datos lol que ya tienes y crea un sistema de login con usuarios. Introduce en la base de datos al menos 3 usuarios diferentes con sus contrase\u00f1as distintas. Recuerda que: La tabla nueva ha de llamarse usuario . Los campos a crear en la nueva tabla deben ser id [*] nombre usuario password email Las contrase\u00f1as deben ser cifradas antes de guardar el datos en la base de datos. Crea el formulario 608registro.php donde el usuario introduzca los datos de registro y vinc\u00falalo con 608nuevoUsuario.php para que recoja los datos mediante POST y los inserte en la base de datos si todo ha ido bien. Queda PROHIBID\u00cdSIMO acceder a 608nuevoUsuario.php sin el formulario rellenado. La sentencia de INSERT debe estar controlada para que no pueda introducirse ning\u00fan dato en blanco. Ten en cuenta que est\u00e1s modificando la base de datos y no queremos campos mal rellenados. Si todo ha ido bien, muestra un mensaje por pantalla diciendo El usuario XXX ha sido introducido en el sistema con la contrase\u00f1a YYY .","title":"PDO"},{"location":"ud06/ud06_AccesoADatos_actividades/#ficheros","text":"Actividad 609 Entra en loremipsum.com y genera un texto de 3 p\u00e1rrafos. Copia el texto generado y gu\u00e1rdalo en un archivo nuevo llamado 609loremIpsum.txt . Genera un archivo php llamado 609loremIpsum.php y muestra por pantalla el texto del archivo txt que acabas de crear, su tama\u00f1o en Kilobytes , la fecha de su \u00faltima modificaci\u00f3n y el ID de usuario que cre\u00f3 el archivo. Actividad 610 Vuelve a cargar el archivo 606campeones.php y ren\u00f3mbralo a 610campeones.php pero en vez de mostrar la tabla por pantalla, genera un archivo CSV 610campeones.csv y otro 610campeonesCSV.php donde saques por pantalla el contenido del archivo 610campeones.csv .","title":"ficheros"},{"location":"ud06/ud06_AccesoADatos_actividades/#proyecto-chollosevero","text":"Actividad 615 Estructura el proyecto y piensa en las tablas y bases de datos que necesit\u00e9is para crear el proyecto. Crea los UML necesarios con nombres como 615UMLnombreTabla metiendo todos los campos que se necesiten as\u00ed como las relaciones que creas necesarias. Establece un sistema de archivos para el proyecto, teniendo en cuenta que van a haber im\u00e1genes, css, funciones php, constantes e incluso javaScript (pero algo b\u00e1sico) para controlar los eventos del usuario a lo largo de la interfaz. Actividad 616 Crea un sistema de login/password con los roles administrador y usuario . De momento que se validen los usuarios correctamente utilizando encriptaci\u00f3n en la contrase\u00f1a. Administrador : Puede ver todos los usuarios registrados as\u00ed como los administradores y los chollos creados en la base de datos. Usuario : Puede ver sus propios chollos, editarlos y borrarlos, adem\u00e1s de crear nuevos. Actividad 617 Crea la vista para poner nuevos chollos y recuerda s\u00f3lo pueden entrar a esta vista usuarios registrados o administradores . Actividad 618 Crea la vista donde se muestren todos los chollos creados. Esta vista puede verla cualquier usuario, registrado o no en el sistema. Ten en cuenta que esta vista ser\u00e1 la vista general de la web as\u00ed que puedes llamarla index.php donde despu\u00e9s aplicaremos filtros por $_GET.","title":"proyecto CholloSevero"},{"location":"ud07/ud07_FrameworksPHP-Laravel/","text":"unit: unidad did\u00e1ctica 7 title: Framework Laravel language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets duraci\u00f3n y criterios de evaluaci\u00f3n consideraciones previas MVC Modelo Vista Controlador Router Artisan instalar docker bitnami/Laravel VSCode extensiones carpetas en Laravel app/Http/Controllers Models public resources routes vendor .env rutas alias forma corta para una vista par\u00e1metros plantillas o templates directivas separando c\u00f3digo estructuras de control controladores convenciones tipos de Request En HTTP y API\u2019s validaci\u00f3n de formularios mostrar errores de forma din\u00e1mica mensajes en castellano mantener el valor en el campo despu\u00e9s de un error confirmar password en otro campo migraciones y la base de datos qu\u00e9 son migraciones rollback de la migraci\u00f3n modelos ORM Eloquent convenciones en Laravel en Modelos crear registros con Eloquent ORM cambiar el campo 'username' a \u00fanico redireccionar al usuario al Muro una vez la cuenta es creada autenticar un usuario que ha creado su cuenta anexo I - instalaci\u00f3n de Tailwind CSS anexo II - reinstalaci\u00f3n de node ejemplos ejemplo 01. Hola Mundo ejemplo 02. Otras vistas ejemplo 03. Paso de par\u00e1metros ejemplo 04. Uso de directivas ejemplo 05. Vista registrarse ejemplo 06. Pasar datos a una vista ejemplo 07. Controlador RegisterController y su formulario ejemplo 08. Petici\u00f3n post problema a la \"vista\"!! ejemplo 09. Validaci\u00f3n de campos ejemplo 10. Mensajes de errores din\u00e1micos ejemplo 11. Mantener valor despu\u00e9s de un error ejemplo 12. Confirmar valor del password ejemplo 13. Crear usuario en la app referencias duraci\u00f3n y criterios de evaluaci\u00f3n Duraci\u00f3n estimada : \u221e sesiones. Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. a) Se han identificado los mecanismos disponibles para el mantenimiento de la informaci\u00f3n que concierne a un cliente web concreto y se han se\u00f1alado sus ventajas. b) Se han utilizado sesiones para mantener el estado de las aplicaciones Web. c) Se han utilizado cookies para almacenar informaci\u00f3n en el cliente Web y para recuperar su contenido. d) Se han identificado y caracterizado los mecanismos disponibles para la autentificaci\u00f3n de usuarios. e) Se han escrito aplicaciones que integren mecanismos de autentificaci\u00f3n de usuarios. f) Se han realizado adaptaciones a aplicaciones Web existentes como gestores de contenidos u otras. g) Se han utilizado herramientas y entornos para facilitar la programaci\u00f3n, prueba y depuraci\u00f3n del c\u00f3digo. consideraciones previas MVC MVC (Model View Controller o Modelo Vista Controlador) es un patr\u00f3n de arquitectura de software que permite la separaci\u00f3n de obligaciones de cada pieza de tu c\u00f3digo. Este paradigma de la programaci\u00f3n enfatiza la separaci\u00f3n de la l\u00f3gica de programaci\u00f3n con la presentaci\u00f3n. Ventajas : MVC no mejora el performance del c\u00f3digo, tampoco da seguridad; pero tu c\u00f3digo tendr\u00e1 un mejor orden y ser\u00e1 f\u00e1cil de mantener . En un grupo de trabajo, el tener el c\u00f3digo ordenado permite que m\u00e1s de una persona pueda entender que es lo que hace cada parte de \u00e9l. Aprender MVC, te har\u00e1 que otras tecnolog\u00edas como Nest , Rails , Django , Net Core , Spring Boot te ser\u00e1n m\u00e1s sencillas de aprender. Modelo Encargado de todas las interacciones en la base de datos (obtener datos, actualizarlos y eliminar). El Modelo se encarga de consultar una base de datos, obtiene la informaci\u00f3n pero no la muestra (esa tarea es para las vistas). El Modelo tampoco se encarga de actualizar la informaci\u00f3n directamente (esa tarea es del Controlador, que es quien decide cu\u00e1ndo llamarlo). Vista Se encarga de todo lo que se ve en pantalla (HTML). Laravel tiene un Template Engine llamado Blade para mostrar los datos. Si utilizas React , Vue , Angular , Svelte , etc. estos ser\u00edan tu vista. El Modelo consulta la base de datos, pero es por medio del Controlador que se decide qu\u00e9 Vista hay que llamar y qu\u00e9 datos presentar. Controlador Es el que comunica Modelo y Vista ; antes de que el Modelo consulte la base de datos el Controlador es el encargado de llamar un Modelo en espec\u00edfico. Una vez consultado el Modelo , el Controlador recibe esa informaci\u00f3n, manda llamar a la Vista y le pasa la informaci\u00f3n. El Controlador es el que mandar llamar la Vista y Modelo s, que se requieren en cada parte de tu aplicaci\u00f3n. Router Es el encargado de registrar todas las URL\u2019s o Endpoints que va a soportar nuestra aplicaci\u00f3n. Ejemplo: Si el Usuario accede a /productos el router ya tiene registrada esa ruta y un controlador con una funci\u00f3n que sabe que Modelo debe llamar y que vista mostrar cuando el usuario visita esa URL. Artisan Artisan es el CLI (Command Line Interface) incluido en Laravel. Artisan es un script que existe en la base de tu proyecto de Laravel y cuenta con una gran cantidad de scripts disponibles. Estos comandos te permiten crear migraciones , controladores , modelos , policies y mucho m\u00e1s. Todos los comando podemos encontrarlos ejecutando: Bash 1 2 3 # php artisan # \u00f3, si no funciona: sudo docker-compose exec myapp php artisan Por ejemplo, si quisi\u00e9ramos crear un controlador (como veremos m\u00e1s adelante) la orden ser\u00eda: Bash 1 2 3 # php artisan make:controller RegisterController # \u00f3, si no funciona: sudo docker-compose exec myapp php artisan make:controller RegisterController instalar docker bitnami/Laravel Lo primero de todo es crear una carpeta con el nombre del proyecto y accedemos ella. Por ejemplo, creamos el proyecto prularavel dentro de nuestra carpeta de proyectos: Bash 1 $ mkdir ~/dwes/proyectos/prularavel Accedemos dentro de la carpeta de este nuevo proyecto. En este punto tenemos dos opciones: A. Utilizar la imagen de Bitnami ya preparada, as\u00ed que lo que hacer ahora es descargar el archivo docker-compose.yml del repositorio de Github oficial. Bash 1 curl -LO https://raw.githubusercontent.com/bitnami/containers/main/bitnami/laravel/docker-compose.yml B. Utilizar el fichero docker-compose.yml que tenemos en nuestra carpeta del curso (en el que se a\u00f1ade el contenedor para phpMyadmin ). En caso ejecutaremos la opci\u00f3n B. Una vez descargado el archivo en nuestra carpeta que acabamos de crear con el nombre del proyecto, lanzamos el siguiente comando por consola para instalar todas las dependencias y crear las im\u00e1genes de Docker correspondientes. Bash 1 sudo docker-compose up -d Si utilizamos el contenedor Portainer para la gesti\u00f3n de nuestros contenedores, podremos observar que estar\u00e1n en marcha nuestros dos contenedores (pertenecientes al servidor web y servidor de bases de datos): Si por alguna extra\u00f1a raz\u00f3n est\u00e1s en Windows y no te funciona una de las 2 im\u00e1genes, puede ser debido a la instalaci\u00f3n de composer dentro de la imagen de Laravel. Para solucionarlo, nos vamos a la carpeta del proyecto que se te habr\u00e1 creado por defecto al hacer docker-compose; en este caso, y si no has modificado el archivo .yml, la carpeta del proyecto sera my-proyect y dentro de ella eliminamos la carpeta vendor. Acto seguido instalar Composer de manera global en nuestro sistema Windows (b\u00e1jate el instalador desde este enlace ). Una vez lo instales ya ser\u00e1s capaz de lanzar el comando composer desde cualquier consola de Windows. VSCode extensiones Recomendable instalar los siguientes plugins para Visual Studio Code. Referentes a PHP: PHP Intelephense PHP IntelliSense PHP Namespace Resolver Referentes a Laravel: Laravel Blade Snippets Laravel Snippets Laravel goto view Laravel Extra Intellisense Referentes a API: Thunder Client Referentes a CSS: Tailwind CSS IntelliSense Aporte Un aporte, o instalaci\u00f3n, a tener en cuenta, podr\u00eda ser la de instalar Tailwind CSS . Este software nos va a proporcionar, de manera sencilla y c\u00f3moda, una opci\u00f3n de utilizar CSS. Para ello, seguir las instrucciones del anexo I - instalaci\u00f3n de Tailwind CSS . carpetas en Laravel Al crear un nuevo proyecto con este framework, Laravel crea una serie de carpetas por defecto. Esta estructura de carpetas es la recomendada para utilizar Laravel. app/Http/Controllers En esta carpeta es donde se van a introducir nuestros controladores (cuando se cree un controlador, es aqu\u00ed donde va a ubicarse). Models Para seguir el paradigma de M VC, los modelos van a introducirse en esta carpeta. public Esta es la carpeta m\u00e1s importante ya que es donde se ponen todos los archivos que el cliente va a mostrar al usuario cuando introduzcamos la URL de nuestro sitio web (por ejemplo, dentro de esta carpeta crear otra carpeta img ). Normalmente se carga el archivo index.php por defecto. resources Esta es nuestra carpeta de recursos donde guardaremos los siguientes archivos, que tambi\u00e9n, est\u00e1n separados por sus carpetas... como cada nombre indica: css Archivos CSS (archivos originales que son procesadas y se colocan las versiones compiladas en public mediante al archivo webpack.mix.js ). js Archivos JS o JavaScript (archivos originales que son procesadas y se colocan las versiones compiladas en public mediante al archivo webpack.mix.js ). lang Archivos relacionados con el idioma del sitio (variables & strings). views Archivos de nuestras vistas, lo que las rutas cargan (com\u00fanmente: lo que se ve en pantalla). Ejemplo : Podemos observar todo esto en el ejemplo 01 . routes Otra de las carpetas que m\u00e1s vamos a usar a lo largo de esta unidad dedicada a Laravel es routes . En ella se albergan todas las rutas (redirecciones web) de nuestro proyecto, pero m\u00e1s concretamente en el archivo web.php : Bash 1 Dada una ruta \u2192 se cargar\u00e1 una vista vendor En esta carpeta se colocan todas las dependencias de Composer que son necesarias tanto para que Laravel funcione o si quieres agregar alguna dependencia extra (por ejemplo: agregar pagos con Paypal . Laravel tiene un paquete llamado cashier que permite pagos en l\u00ednea y tambi\u00e9n podemos instalar una dependencia extra mediante Composer). Podemos observar en el archivo composer.json las dependencias instaladas. .env Aunque .env no es una carpeta, sino un archivo, tambi\u00e9n merece especial atenci\u00f3n por ser un fichero de configuraci\u00f3n de nuestro proyecto. Por ejemplo, en nuestro caso, la conexi\u00f3n a base de datos ser\u00eda: Bash 1 2 3 4 5 6 7 8 # ... DB_CONNECTION = mysql DB_HOST = 127 .0.0.1 DB_PORT = 3306 DB_DATABASE = dwes DB_USERNAME = dwes DB_PASSWORD = dwes # ... rutas Las rutas en Laravel (y en casi cualquier Framework) sirven para redireccionar al cliente (o navegador) a las vistas que nosotros queramos. Estas rutas se configuran en el archivo routes/web.php donde se define la ruta que el usuario pone en la URL despu\u00e9s del dominio y se retorna la vista que se quiere cargar al introducir dicha direcci\u00f3n en el navegador. En este ejemplo podemos obersvar la clase Route y un m\u00e9todo est\u00e1tico get , este m\u00e9todo est\u00e1tico toma la URL ('/' en este caso) y tambi\u00e9n un closure o callback function () ... PHP 1 2 3 4 5 <?php // Ruta por defecto para cargar la vista welcome (sin extensi\u00f3n .blade.php) cuando el usuario introduce simplemente el dominio Route :: get ( '/' , function () { return view ( 'welcome' ); }); En el ejemplo de arriba vamos a cargar la vista llamada welcome que hace referencia a la vista resources/views/welcome.blade.php . closure VS controlador Se puede definir en el segundo par\u00e1metro un closure o un controlador (veremos m\u00e1s adelante este caso). Por ejemplo: PHP 1 Route::get('/register', [RegisterController::class, 'index']) -> name('register'); alias Es interesante darle un alias o un nombre a nuestras rutas para poder utilizar dichos alias en nuestras plantillas de Laravel que veremos m\u00e1s adelante. Para ello, basta con utilizar la palabra name al final de la estructura de la ruta y darle un nombre que queramos; normalmente descriptivo y asociado a la vista que tiene que cargar el enroutador de Laravel. PHP 1 2 3 4 <?php Route :: get ( '/users' , function () { return view ( 'users' ); }) -> name ( 'usuarios' ); Despu\u00e9s veremos que es muy \u00fatil ya que a la hora de refactorizar o hacer un cambio, si tenemos enlaces o men\u00fas de navegaci\u00f3n que apuntan a esta ruta, s\u00f3lo tendr\u00edamos que cambiar el par\u00e1metro dentro del get() y no tener que ir archivo por archivo. forma corta para una vista Laravel nos proporciona una manera m\u00e1s c\u00f3moda a la hora de cargar una vista si no queremos par\u00e1metros ni condiciones. Tan s\u00f3lo definiremos la siguiente l\u00ednea que hace referencia la ruta datos en la URL y va a cargar el archivo usuarios.php de nuestra carpeta views como le hemos indicado en el segundo par\u00e1metro. PHP 1 2 3 <?php /* http://localhost/datos/ */ Route :: view ( 'datos' , 'usuarios' ); Pero no s\u00f3lo podemos retornar una vista, sino, desde un simple string, a m\u00f3dulos propios de Laravel. Ejemplo : Podemos observar todo esto en el ejemplo 02 . par\u00e1metros Ya hemos visto que con PHP podemos pasar par\u00e1metros a trav\u00e9s de la URL, como si fueran variables, que las recuper\u00e1bamos a trav\u00e9s del m\u00e9todo GET o POST. Con Laravel tambi\u00e9n podemos introducir par\u00e1metros pero de una forma m\u00e1s vistosa y ordenada, de tal manera que sea visualmente m\u00e1s c\u00f3modo de recordar y de indexar por los motores de b\u00fasqueda como Google. Text Only 1 http://localhost/cliente/324 Para configurar este tipo de rutas en nuestro archivo de rutas public/routes/web.php haremos lo siguiente. PHP 1 2 3 4 <?php Route :: get ( 'cliente/{id}' , function ( $id ) { return ( 'Cliente con el id: ' . $id ); }); \u00bfQu\u00e9 pasa si no introducimos un id y s\u00f3lo navegamos hasta cliente/ ? ... que nos va a devolver un 404 | NOT FOUND . Para resolver esto, podemos definir una ruta por defecto en caso de que el id (o par\u00e1metro) no sea pasado. Para ello usaremos el s\u00edmbolo ? en nuestro nombre de ruta e inicializaremos la variable con el valor que queramos. PHP 1 2 3 4 <?php Route :: get ( 'cliente/{id?}' , function ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); }); Ahora tenemos otro problema, porque estamos filtrando por id del cliente que, normalmente es un n\u00famero; pero si introducimos un par\u00e1metro que no sea un n\u00famero, vamos a obtener un resultado no deseado. Para resolver este caso haremos uso de la cl\u00e1usula where junto con una expresi\u00f3n regular n\u00famerica: PHP 1 2 3 4 <?php Route :: get ( 'cliente/{id?}' , function ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); }) -> where ( 'id' , '[0-9]+' ); Adem\u00e1s, podemos pasarle variables a nuestra URL para luego utilizarlas en nuestros archivos de plantillas o en archivos .php haciendo uso de un array asociativo. Veamos un ejemplo con la forma reducida para ahorrarnos c\u00f3digo: PHP 1 2 <?php Route :: view ( 'datos' , 'usuarios' , [ 'id' => 5446 ]); ... y el archivo resources/views/usuarios.blade.php debe tener algo parecido a \u00e9sto: PHP 1 2 3 4 <!-- Estructura t\u00edpica de un archivo HTML5 --> <!-- ... --> <p>Usuario con id: <? = $id ?> </p> <!-- ... --> Con las plantillas de Laravel blade.php veremos c\u00f3mo simplificar a\u00fan m\u00e1s nuestro c\u00f3digo. Para m\u00e1s informaci\u00f3n acerca de las rutas, par\u00e1metros y expresiones regulares en las rutas puedes echar un vistazo a la documentaci\u00f3n oficial de rutas que contiene numerosos ejemplos. Ejemplo : Podemos observar un ejemplo en ejemplo 03 . plantillas o templates A trav\u00e9s de las plantillas de Laravel vamos a escribir menos c\u00f3digo PHP y vamos a tener nuestros archivos mejor organizados . Blade es el sistema de plantillas que trae Laravel, por eso los archivos de plantillas que guardamos en el directorio de views llevan la extensi\u00f3n blade.php . De esta manera sabemos inmediatamente que se trata de una plantilla de Laravel y que forma parte de una vista que se mostrar\u00e1 en el navegador. directivas Laravel tiene un gran n\u00famero de directivas que podemos utilizar para ahorrarnos mucho c\u00f3digo repetitivo entre otras funciones. Digamos que las directivas son peque\u00f1as funciones ya escritas que aceptan par\u00e1metros y que cada una de ellas hace una funci\u00f3n diferente dentro de Laravel. Por ejemplo: @yield define el contenido din\u00e1mico que se va a cargar. Se usa conjuntamente con @section . @section y @endsection es un bloque de c\u00f3digo din\u00e1mico. @extends importa el contenido de una plantilla ya creada. separando c\u00f3digo Veamos sobre un ejemplo c\u00f3mo separar el c\u00f3digo para no repetirlo. Ejemplo : Podemos observar todo esto en el ejemplo 04 . Ejemplo : Realiza tambi\u00e9n el ejemplo 05 . estructuras de control Como en todo buen lenguaje de programaci\u00f3n, en Laravel tambi\u00e9n tenemos estructuras de control. En Blade (plantillas de Laravel) siempre que iniciemos un bloque de estructura de control DEBEMOS cerrarla. @foreach ~ @endforeach lo usamos para recorrer arrays. @if ~ @endif para comprobar condiciones l\u00f3gicas. @switch ~ @endswitch en funci\u00f3n del valor de una variable ejecutar un c\u00f3digo. @case define la casu\u00edstica del switch. @break rompe la ejecuci\u00f3n del c\u00f3digo en curso. @default si ninguna casu\u00edstica se cumple. PHP 1 2 3 4 5 6 7 8 9 10 <?php $equipo = [ 'Mar\u00eda' , 'Alfredo' , 'William' , 'Ver\u00f3nica' ]; @ foreach ( $equipo as $elemento ) < p > {{ $elemento }} </ p > @ endforeach // si no funciona la estructura anterior: // foreach ($equipo as $elemento) { // echo \"<p>\" . $elemento . \"</p>\"; // } Acordaros que podemos pasar variables a trav\u00e9s de las rutas como si fueran par\u00e1metros. Pero en este caso, vamos a ver otra directiva m\u00e1s; el uso de @compact . PHP 1 2 3 4 5 6 <?php // Uso de @compact $equipo = [ 'Mar\u00eda' , 'Alfredo' , 'William' , 'Ver\u00f3nica' ]; // Route::view('nosotros', ['equipo' => 'equipo']); Route :: view ( 'nosotros' , @ compact ( 'equipo' )); Ejemplo : Veamos sobre un ejemplo pasar informaci\u00f3n a la vista a trav\u00e9s del ejemplo 06 . controladores Los controladores son el lugar perfecto para definir la l\u00f3gica de negocio de nuestra aplicaci\u00f3n o sitio web. Hace de intermediario entre la Vista (lo que vemos con nuestro navegador o cliente) y el servidor donde la app est\u00e1 alojada. Por defecto, los controladores se guardan en una carpeta espec\u00edfica situada en app/Http/Controllers y tienen extensi\u00f3n .php . Para crear un controlador nuevo debemos hacer uso de nuestro querido CLI artisan donde le diremos que cree un controlador con el nombre que nosotros queramos. Abrimos la consola y nos situamos en la ra\u00edz de nuestro proyecto: Bash 1 2 3 php artisan make:controller PagesController # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan make:controller PagesController Si todo ha salido bien, recibiremos un mensaje por consola con que todo ha ido bien y podremos comprobar que, efectivamente, se ha creado el archivo PagesController.php con una estructura b\u00e1sica de controlador, dentro de la carpeta Controllers que hemos descrito anteriormente. Ahora podemos modificar nuestro archivo de rutas web.pbp para dejarlo limpio de l\u00f3gica y trasladar \u00e9sta a nuestro nuevo controlador. La idea de esto es dejar el archivo web.php tan limpio como podamos para que, de un vistazo, se entienda todo perfectamente. recuerda s\u00f3lo movemos la l\u00f3gica, mientras que las cl\u00e1usulas como where y name las seguimos dejando en el archivo de rutas web.php . convenciones Laravel tiene una convenci\u00f3n a la hora de nombrar los m\u00e9todos de tus controllers conocida como Resource Controllers. Esta convenci\u00f3n ayuda bastante para tener todo mejor organizado: verbo HTTP URI acci\u00f3n ruta GET /clientes index clientes.index POST /clientes store clientes.store DELETE /clientes/{cliente} destroy clientes.destroy En este enlace a la documentaci\u00f3n de Laravel vemos las acciones que son controladas (o manejadas) por el controlador enlace . Veamos c\u00f3mo quedar\u00eda un refactor del archivo de rutas utilizando un Controller como el que acabamos de crear. Ahora nos quedar\u00eda de la siguiente manera: PHP 1 2 3 4 5 6 7 8 9 <?php // web.php (v2.0) \u2592\u2592\u2592 Refactorizado use App\\Http\\Controllers\\PagesController ; use Illuminate\\Support\\Facades\\Route ; Route :: get ( '/' , [ PagesController :: class , 'inicio' ]); Route :: get ( 'datos' , [ PagesController :: class , 'datos' ]); Route :: get ( 'cliente/{id?}' , [ PagesController :: class , 'cliente' ]) -> where ( 'id' , '[0-9]+' ); Route :: get ( 'nosotros/{nosotros?}' , [ PagesController :: class , 'nosotros' ]) -> name ( 'nosotros' ); y en nuestro archivo controlador lo dejar\u00edamos de la siguiente manera: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php // PagesController.php namespace App\\Http\\Controllers ; class PagesController extends Controller { public function inicio () { return view ( 'welcome' ); } public function datos () { return view ( 'usuarios' , [ 'id' => 56 ]); } public function cliente ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); } public function nosotros ( $nombre = null ) { $equipo = [ 'Paco' , 'Enrique' , 'Maria' , 'Veronica' ]; return view ( 'nosotros' , @ compact ( 'equipo' , 'nombre' )); } } Ejemplo : Podemos observar todo esto en el ejemplo 07 . tipos de Request En HTTP y API\u2019s En HTTP existen diferentes tipos de Request o tipos de Petici\u00f3n: GET, POST, PUT, PATCH y DELETE. GET es el m\u00e1s simple; cuando visitas un sitio web por default es un GET, y el m\u00e9todo solo se utiliza para recuperar datos pero nunca debe enviar datos. POST se utiliza cuando mandas datos a un servidor; esto incluye informaci\u00f3n que llenas en un formulario o buscador. PUT es utilizado para actualizar un elemento; pero si no existe crea uno nuevo; PUT es un reemplazo total de un registro. PATCH es utilizado para actualizar parcialmente un elemento o recurso. DELETE se utiliza para eliminar un recurso o elemento. Ejemplo : Podemos observar todo esto en el ejemplo 08 . validaci\u00f3n de formularios Para validar los campos de un formulario podemos utilizar las reglas de validaci\u00f3n; \u00e9stas se colocar\u00e1n en la funci\u00f3n store del controlador. Todas las reglas de validaci\u00f3n de Laravel podemos observarlas en la documentaci\u00f3n oficial, en este enlace . Ejemplo : Podemos observar todo esto en el ejemplo 09 . mostrar errores de forma din\u00e1mica Si utilizamos la directiva @error ... @enderror de esta forma: Text Only 1 2 3 4 5 @error('name') <p class=\"bg-red-500 text-white my-2 rounded-lg text-sm p-2 text-center\"> el nombre es obligatorio </p> @enderror solo mostrar\u00eda si el nombre es obligatorio; pero podemos tener m\u00e1s validaciones (en el mismo input ) que chequear. Este tipo de errores con texto est\u00e1tico no es la mejor opci\u00f3n . Laravel ya tiene una serie de mensajes para dicho caso. Deberemos imprimir un mensaje con el mensaje de error $message . Ejemplo : Podemos observar todo esto en el ejemplo 10 . mensajes en castellano Los mensajes de errores est\u00e1n en ingl\u00e9s, \u00bfc\u00f3mo podemos mostrarlos en castellano ? Existen paquetes en Laravel en castellano, por ejemplo MarcoGomesr/laravel-validation-en-espanol . En el terminal, a nivel de tu proyecto, ejecuta la clonaci\u00f3n: PHP 1 git clone https://github.com/MarcoGomesr/laravel-validation-en-espanol.git resources/lang Para terminar el cambio accede al fichero config/app.php y en la linea 86 (m\u00e1s o menos) cambiar el idioma a espa\u00f1ol: PHP 1 'locale' => 'es', Ejemplo : Poner nuestro proyecto en idioma espa\u00f1ol. mantener el valor en el campo despu\u00e9s de un error Muchas veces es frustrante volver a un formulario despu\u00e9s de un error y observar que los valores de todos los campos se han borrado y que necesitas volver a introducirlos. Para evitar este caso podemos poner en los input el atributo value y pasarle \"{{ old('username') }}\" . Ejemplo : Podemos observar todo esto en el ejemplo 11 . confirmar password en otro campo Para confirmar el password notamos que hab\u00edamos puesto anteriormente al campo de confirmaci\u00f3n de password esta etiqueta: Una convenci\u00f3n en Laravel para comprobar si dos campos son iguales es asignarle al segundo el prefijo _confirmation . Pasos a seguir: Poner de nombre del segundo input password_confirmation (y debe nombrarse as\u00ed ) Poner la validaci\u00f3n confirmed para el campo pasword en el controlador. Ejemplo : Podemos observar todo esto en el ejemplo 12 . migraciones y la base de datos Si has seguido los ejemplos anteriores correctamente habr\u00e1s comprobado que cuando ponemos un correo e intentamos acceder muestra el siguiente error: Nos indica que est\u00e1 revisando el valor de email en la tabla de usuarios y esta no existe. Para completar el formulario habr\u00e1 que crear dicha tabla users . Para esto debemos realizar nuestra primera migraci\u00f3n . qu\u00e9 son migraciones Las Migraciones se les conoce como el control de versiones de tu base de datos; de esta forma se puede crear la base de datos y compartir el dise\u00f1o con el equipo de trabajo. Si deseas agregar nuevas tablas o columnas a una tabla existente, puedes hacerlo con una nueva migraci\u00f3n; si el resultado no fue el deseado, puedes revertir esa migraci\u00f3n. Lanzar desde la linea de comandos: PHP 1 2 3 4 // ejecuta las migraciones php artisan migrate // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate PHP 1 2 3 4 5 6 7 8 9 // en caso de querer deshacer el cambio: php artisan migrate:rollback // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback // regresar las \u00faltimas 5 (por ejemplo) migraciones php artisan migrate:rollback --step=5 // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback --step=5 Las migraciones se van a ir colocando, siempre, en la carpeta del proyecto database/migrations : Laravel tiene unas migraciones por defecto, sobre todo para la creaci\u00f3n de usuarios. Consideraciones previas Recuerda tener el fichero .env configurado para acceder a tu bd en q\u00fcesti\u00f3n y con usuario y contrase\u00f1a adecuados: Abrimos el terminal, dentro del proyecto: PHP 1 2 3 php artisan migrate // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate Si, despu\u00e9s de ejecutar, accedemos a nuestra base de datos, por ejemplo desde phpMyadmin : rollback de la migraci\u00f3n Si, quisi\u00e9ramos echar para atr\u00e1s en la migraci\u00f3n: PHP 1 2 3 php artisan migrate:rollback // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback Vemos que las tablas dejan de existir (solo queda la tabla migraciones) en nuestra bd: Ejemplo : Podemos observar todo esto en el ejemplo 13 . modelos ORM Eloquent Laravel incluye su propio ORM (Object Relacional Mapper) que hace muy sencillo interactuar con tu base de datos. En Eloquent cada tabla tiene su propio modelo ; ese modelo interact\u00faa \u00fanicamente con esa tabla y tiene las funciones necesarias para crear registros, obtenerlos, actualizarlos y eliminarlos. Bash 1 sudo docker-compose exec myapp php artisan make:model Cliente Laravel tiene el modelo users creado por defecto. convenciones en Laravel en Modelos Cuando creas el Modelo Cliente , Eloquent asume que la tabla se va a llamar clientes . Si el Modelo se llama Producto ; Eloquent espera una tabla llamada productos . Problema Puede ser un problema llamar tu modelo Proveedor , porque Eloquent espera la tabla llamada provedors , pero se puede reescribir en el modelo. crear registros con Eloquent ORM Para insertar una fila en nuestra tabla users , debemos insertar el siguiente c\u00f3digo en nuestro controlador RegisterController.php : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 //... use Illuminate\\Support\\Facades\\Hash use App\\Models\\User // si no se encuentra se a\u00f1ade //... public function store(Request $request) { //... User::create([ 'name' => $request->name, 'username' => $request->username, 'mail' => $request->email, 'password' => Hash::make($request->password) ]); } //... A tener en cuenta: cuando introducimos User arriba en el c\u00f3digo se va a importar use App\\Models\\User; el m\u00e9todo create corresponde a un insert into ... podemos utilizar un helper (en Laravel encontramos una gran variedad) relacionado con los string; por ejemplo para que no introduzcamos espacios no deseados en el campo username. vemos que, para hashear el password y que no se vea la cadena literal, podemos utilizar la clase Hash::make(cadena) . Si no importa directamente use Illuminate\\Support\\Facades\\Hash le damos bot\u00f3n derecho - import class . cuidado Si no modificamos nada m\u00e1s, el campo username obtendr\u00e1 un error. Esto es debido a que este campo lo hemos introducido nosotros despu\u00e9s de la primera migraci\u00f3n; y Laravel tiene un sistema de seguridad por el que no permite creaciones de campos tan f\u00e1cilmente (as\u00ed prevee posibles ataques de inserci\u00f3n de c\u00f3digo en nuestra base de datos). Para ello, adem\u00e1s del c\u00f3digo anterior, modificaremos el modelo User.php que se encuentra en la carpeta app/Models como medida de seguridad: Probamos insertar un usuario en la app: Y vemos que se ha insertado en la base de datos: cambiar el campo 'username' a \u00fanico Echar para atr\u00e1s la \u00faltima migraci\u00f3n: PHP 1 2 3 php artisan migrate:rollback // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback Hacer cambios en el fichero ...add_username_to_users_table.php : PHP 1 2 3 4 5 //... Schema::table('users', function(Blueprint $table)){ $table->string('username')-> unique() -> after('name'); }); //... Volver a migrar: PHP 1 2 3 php artisan migrate // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate Ahora podemos hacer un cambio en RegisterController.php , que convierte la cadena a una URL (min\u00fascula y los espacios los sustituye por un gui\u00f3n medio): Insertamos un valor en username con may\u00fasculas y espacios: Para que no aparezca un mensaje de error al introducir dos usuarios con el username iguales, lo que podemos hacer es modificar el Request (cuando es nuestra \u00faltima opci\u00f3n): redireccionar al usuario al Muro una vez la cuenta es creada Crear un controlador de nombre PostController : Bash 1 sudo docker-compose exec myapp php artisan make:controller PostController Crear un controlador de nombre LoginController : Bash 1 sudo docker-compose exec myapp php artisan make:controller LoginController autenticar un usuario que ha creado su cuenta anexo I - instalaci\u00f3n de Tailwind CSS Si hemos decidido instalar Tailwind CSS para que nos eche una mano con nuestro css, deberemos de seguir estos pasos: Hay que comprobar la versi\u00f3n de npm y node: Bash 1 2 npm -v node -v Si la versi\u00f3n de nodejs es inferior a la versi\u00f3n 14 (a la hora de crear este documento) antes de seguir habremos de reinstalarlo . Para ello habr\u00e1 que ir al anexo II - reinstalaci\u00f3n de node en este mismo documento. no continuar si la versi\u00f3n de node es inferior a 14 . Si nuestra versi\u00f3n de nodejs es correcta (o hemos procedido a reinstalar node en el punto 2), lo primero ser\u00e1 desinstalar bootstrap: Bash 1 npm uninstall bootstrap Instalaremos en desarrollo estas tres dependencias: Bash 1 npm install -D tailwindcss postcss autoprefixer Generamos ahora el fichero tailwindcss.config.js que aparecer\u00e1 en la ra\u00edz del proyecto: Bash 1 npx tailwindcss init -p Editar el fichero del proyecto Laravel tailwindcss.config.js que se ha generado en el directorio ra\u00edz del proyecto y donde indicaremos d\u00f3nde vamos a utilizarlo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 /** @type {import('tailwindcss').Config} */ export default { content: [ \"./resources/**/*.blade.php\", \"./resources/**/*.js\", \"./resources/**/*.vue\", ], theme: { extend: {}, }, plugins: [], } Ahora, en el fichero /resources/css/ app.css agregar las siguientes l\u00edneas: CSS 1 2 3 @ tailwind base ; @ tailwind components ; @ tailwind utilities ; Desde el terminal (y siempre dentro de nuestro proyecto), vamos a ejecutar: Bash 1 2 3 npm run dev # \u00f3, si no funciona: # npm run dev -- --host En el fichero /resources/views/layouts/ app.blade.php hay que indicarle que va a utilizar el fichero /resources/css/ app.css , para ello hay que a\u00f1adirlo en: Text Only 1 @vite('resources/css/app.css') A partir de ahora, y con este ejemplo, podemos observar que se nos muestra el css: anexo II - reinstalaci\u00f3n de node Para reinstalar nodejs: Desinstalar node por completo: Bash 1 sudo apt-get purge --auto-remove nodejs Eliminar todo resto de node y npm: a. Antes que nadas, debe ejecutar el siguiente comando desde el terminal: Bash 1 sudo rm -rf /usr/local/bin/npm /usr/local/share/man/man1/node* /usr/local/lib/dtrace/node.d ~/.npm ~/.node-gyp /opt/local/bin/node opt/local/include/node /opt/local/lib/node_modules Text Only 1 b. Eliminar los directorios node o node_modules de /usr/local/lib con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/lib/node* Text Only 1 c. Eliminar los directorios node o node_modules de /usr/local/include con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/include/node* Text Only 1 d. Eliminar cualquier archivo de nodo o directorio de /usr/local/bin con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/bin/node Instalar otra vez nvm: a. Instalar NvM (Node Version Manager), desde el directorio de usuario ~ : Bash 1 curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash Text Only 1 b. Actualiza el archivo .bashrc: Bash 1 source .bashrc Text Only 1 c. Confirma que el directorio local est\u00e1 configurado: Bash 1 2 echo $NVM_DIR /home/username/.nvm Instalar node: a. Revisar qu\u00e9 versiones de Node.js est\u00e1n disponibles: Bash 1 nvm ls-remote Text Only 1 b. Instalar la versi\u00f3n que desees (elige la v20.10.0): Bash 1 nvm install v20.10.0 Comprobar que la nueva versi\u00f3n de node es superior a 14: Bash 1 node -v ejemplos ejemplo 01. Hola Mundo Vamos a eliminar todo el style que viene por defecto y a vaciar de contenido de la etiqueta <body> de la vista resources/views/ wellcome.blade.php y creamos etiquetas: Text Only 1 2 <h1>P\u00e1gina principal</h1> <h2>Hola Mundo.</h2> [volver ^] ejemplo 02. Otras vistas Creamos dos ficheros nosotros.blade.php , tienda.blade.php en resources/views : Adem\u00e1s, a\u00f1adimos en el fichero web.php las siguientes rutas: PHP 1 2 3 4 5 Route::get('/nosotros', function () { return view('nosotros'); }); Route::view('/tienda-virtual','tienda'); // forma corta para la ruta a una vista [volver ^] ejemplo 03. Paso de par\u00e1metros En el fichero web.php modifica la ruta a tienda-virtual para que se le pase por par\u00e1metro la variable $id. Pr\u00e9viamente se ha inicializado a un valor; controlar si se ha introducido sin valor y si se ha introducido alg\u00fan valor no num\u00e9rico: PHP 1 2 3 4 5 6 Route::get('tienda/{id?}', function($id = 1) { return view('tienda', ['id' => $id]); }) -> where('id', '[0-9]+'); // otra forma: // Route::view('tienda/{id?}', 'tienda', ['id' => 1]); Despu\u00e9s, mostrar este valor en la vista tienda.blade.php : Text Only 1 2 <h1>tienda virtual</h1> <p>producto con id: <?= $id ?></p> [volver ^] ejemplo 04. Uso de directivas C\u00f3mo hacer uso del poder de Laravel para crear plantillas y no repetir c\u00f3digo. Supongamos que tenemos ciertas estructuras HTML repetidas como puede ser una cabecera header , un men\u00fa de navegaci\u00f3n nav y un par de secciones que hacen uso de este mismo c\u00f3digo. Supongamos que tenemos 3 apartados en la web: Inicio | Blog | Fotos Primero de todo tendremos que generar un archivo que haga de plantilla de nuestro sitio web. Para ello creamos el archivo app.blade.php dentro del nuevo directorio de plantillas resources/views/layouts . Dicho archivo va a contener el t\u00edpico c\u00f3digo de una p\u00e1gina simple de HTML y en el body a\u00f1adiremos nuestros contenido est\u00e1tico y din\u00e1mico. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 <!DOCTYPE html> <html lang=\"{{ str_replace('_', '-', app()->getLocale()) }}\"> <head> <meta charset=\"utf-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"> <title>Mi proyecto - @yield('titulo')</title> <!-- introducir la siguiente linea para poder utilizar TailwindCSS --> @vite('resources/css/app.css') </head> <body class=\"bg-gray-100\"> <header class=\"p-5 border-b bg-white shadow\"> <div class=\"container mx-auto flex justify-between items-center\"> <h1 class=\"text-3xl font-black\"> @yield('titulo') </h1> <nav class=\"flex gap-5 items-center\"> <a class=\"font-bold uppercase text-gray-600 text-sm\" href=\"#\">Login</a> <a class=\"font-bold uppercase text-gray-600 text-sm\" href=\"#\">Crear cuenta</a> </nav> </div> </header> <!-- BORRAR M\u00c1S ADELANTE este men\u00fa en el siguiente ejemplo --> <nav class=\"flex gap-5 items-center\"> <a class=\"font-bold uppercase text-gray-600 text-sm\" href={{ route('inicio') }} >inicio</a> | <a class=\"font-bold uppercase text-gray-600 text-sm\" href={{ route('noticias') }} >blogs</a> | <a class=\"font-bold uppercase text-gray-600 text-sm\" href={{ route('galeria') }} >fotos</a> </nav> <!-- CONTENIDO PRINCIPAL --> <main class=\"container mx-auto mt-10\"> <h2 class=\"font-black text-center text-3xl mb-10\"> @yield('titulo') </h2> @yield('contenido') </main> <!-- FOOTER --> <footer class=\"text-center p-5 text-gray-500 font-bold uppercase\"> MiPrimeraWeb - Todos los derechos reservados @php echo date('Y') @endphp <br> <!-- con helpers --> MiPrimeraWeb - Todos los derechos reservados {{ now()->year }} </footer> </body> </html> Cada secci\u00f3n que haga uso de esta plantilla contendr\u00e1 un men\u00fa de navegaci\u00f3n con enlaces a cada una de las secciones y el contenido din\u00e1mico de cada secci\u00f3n. A tener en cuenta: {{ route('inicio') }} muestra: {{ ... }} es una etiqueta para Blade que muestra un echo. route(...) lanza la ruta de nombre (o alias) concreto. @php echo date('Y') @endphp son etiquetas para Blade para contener c\u00f3digo php. En este caso un echo que muestra el a\u00f1o 'Y' de la fecha actual date() . now() es un helper de Laravel (componente del framework dise\u00f1ado para facilitar alguna tarea t\u00edpica en el desarrollo de una aplicaci\u00f3n web). Tiene distintos atributos y m\u00e9todos, entre ellos, year para mostrar el a\u00f1o. Ahora crearemos los archivos din\u00e1micos de cada una de las secciones, en nuestro caso: inicio.blade.php : Importamos el contenido de plantilla bajo la directiva @extends para que cargue los elementos est\u00e1ticos que hemos declarado y con la directiva @section y @endsection definimos el bloque de c\u00f3digo din\u00e1mico, en funci\u00f3n de la secci\u00f3n que estemos visitando. PHP 1 2 3 4 5 6 7 8 9 @extends('layouts.app') @section('titulo') p\u00e1gina principal @endsection @section('contenido') contenido de la p\u00e1gina principal @endsection blog.blade.php : PHP 1 2 3 4 5 6 7 8 9 @extends('layouts.app') @section('titulo') not\u00edcias @endsection @section('contenido') contenido de todas las not\u00edcias @endsection fotos.blade.php : PHP 1 2 3 4 5 6 7 8 9 @extends('layouts.app') @section('titulo') fotograf\u00edas @endsection @section('contenido') galer\u00eda de fotograf\u00edas @endsection El \u00faltimo paso que nos queda es configurar el archivo de rutas routes/web.php : PHP 1 2 3 4 5 <?php // web.php Route :: view ( '' , 'inicio' ) -> name ( 'inicio' ); Route :: view ( 'blog' , 'blog' ) -> name ( 'noticias' ); Route :: view ( 'fotos' , 'fotos' ) -> name ( 'galeria' ); De esta manera podremos hacer uso del men\u00fa de navegaci\u00f3n que hemos puesto en nuestra plantilla y gracias a los alias noticias y galeria, la URL ser\u00e1 m\u00e1s amigable. [volver ^] ejemplo 05. Vista registrarse Antes de continuar con el ejemplo, debes modificar ( guarda los modificados ): elimina el men\u00fa de navegaci\u00f3n de inicio | blogs | fotos del fichero layouts/app.blade.php . elimina las rutas en el fichero web.php que afecten a este men\u00fa (exceptuando la ruta de inicio). elimina las dos vistas blog.blade.php y foto.blade.php . Este borrado se debe a que NO vamos a continuar con estas vistas; solo eran un ejemplo de uso de directivas y la separaci\u00f3n de c\u00f3digo. Como has observado, nuestro anterior ejemplo conten\u00eda en el fichero resources/views/layouts/app.php un men\u00fa de navegaci\u00f3n en el que se indicaba Login y Crear cuenta . Crea las vistas para estos dos enlaces. Para ello alojar\u00e1s sus dos vistas en una carpeta nueva resources/views/auth con nombre register.blade.php para Crear cuenta . PHP 1 2 3 4 5 6 7 8 9 @extends('layouts.app') @section('titulo') Reg\u00edstrate en tu APP @endsection @section('contenido') @endsection Modificar en el fichero app.blade.app el men\u00fa de crear cuenta para que se pueda acceder des del enlace a la vista creada anteriormente: Text Only 1 2 3 4 5 6 // ... <nav class=\"flex gap-5 items-center\"> <a class=\"font-bold uppercase text-gray-600 text-sm\" href=\"#\">Login</a> <a class=\"font-bold uppercase text-gray-600 text-sm\" href={{ route('register') }}>Crear cuenta</a> </nav> // .. A\u00f1adir al fichero web.php la entrada: PHP 1 Route::view('/crear-cuenta','auth.register') -> name('register'); //la ruta contiene . [volver ^] ejemplo 06. Pasar datos a una vista Crear en web.php un array (de nombre arrayProductos ) con, al menos, 4 \u00edtems: PHP 1 2 3 4 Route::get('listaproductos', function(){ $productos = ['rosa','clavel','orqu\u00eddea','l\u00edrio']; return view('pru1', compact('productos')); }); Para pasar un array a una vista existen varios m\u00e9todos: return view('pru1', ['productos' => $productos]); return view('pru1') -> with ('productos', $productos); return view('pru1', compact('productos')); con la funci\u00f3n de php compact se crea internamente un array con productos. Pasar este array a una vista, de nombre listaproductos.blade.php y mu\u00e9stralos en una tabla: Text Only 1 2 3 4 5 <?php foreach ($productos as $item) { echo \"<li>\".$item.\"</li>\"; } ?> Pero como hemos visto, Laravel tiene unas directivas que funcionan en sus vistas y que se pueden utilizar de forma m\u00e1s elegante: PHP 1 2 3 @foreach ($usuarios as $item) <li>{{ $item }}</li> @endforeach [volver ^] ejemplo 07. Controlador RegisterController y su formulario En vez de usar closures (o callbacks ) en el fichero web.php vamos a crear controladores en nuestro ejemplo y trasladar la l\u00f3gica de negocio a estos \u00faltimos. As\u00ed, y siguiendo con los ejemplos anteriores, vamos a crear un controlador para gestionar el registro en nuestra APP (vamos a ordenar nuestros ficheros y colocaremos RegisterConroller dentro de la carpeta Auth y a\u00f1adimos doble diagonal inversa \\\\ ). Abrimos el CLI artisan (nuevo terminal en VS Code o Ctrl +`) en la carpeta de nuestro proyecto y ejecutamos: Bash 1 2 3 php artisan make:controller Auth \\\\ RegisterController # \u00f3, si no fuciona: # sudo docker-compose exec myapp php artisan make:controller Auth\\\\RegisterController En web.php modificar la ruta de Crear cuenta (quitar el callback y a\u00f1adir el controlador y su m\u00e9todo). Se recomienda como convenci\u00f3n el nombre del m\u00e9todo index : PHP 1 2 3 4 // ... use App\\Http\\Controllers\\Auth\\RegisterController; // ... Route::get('/register', [RegisterController::class, 'index']) -> name('register'); Y en RegisterController.php , trasladamos la l\u00f3gica de negocio que ejecutaba el callback , a\u00f1adiendo la palabra reservada public y a\u00f1adiendo tambi\u00e9n un nombre a esta funci\u00f3n index() : PHP 1 2 3 public function index() { return view('auth.register'); } Para la vista de register register.blade.php vamos a introducir el c\u00f3digo: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 @extends('layouts.app') @section('titulo') Reg\u00edstrate en la APP @endsection @section('contenido') <div class=\"md:flex md:justify-center md:gap-10 md:items-center\"> <div class=\"md:w-6/12 p-5\"> <img src=\"{{asset('images/dwes_registrar.png')}}\" alt=\"imagen registro usuario\"> </div> <div class=\"md:w-4/12 bg-white p-6 rounded-lg shadow-xl\"> <!-- todav\u00eda no existe ni m\u00e9todo ni enlace en el form --> <form action=\"\"> <div> <label for=\"name\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Nombre </label> <input id=\"name\" name=\"name\" type=\"text\" placeholder=\"tu nombre\" class=\"border p-3 w-full rounded-lg\" /> </div> <div> <label for=\"username\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Nombre </label> <input id=\"username\" name=\"username\" type=\"text\" placeholder=\"tu nombre de usuario\" class=\"border p-3 w-full rounded-lg\" /> </div> <div> <label for=\"email\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Email </label> <input id=\"email\" name=\"email\" type=\"text\" placeholder=\"tu email de registro\" class=\"border p-3 w-full rounded-lg\" /> </div> <div> <label for=\"password\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Password </label> <input id=\"password\" name=\"password\" type=\"password\" placeholder=\"tu contrase\u00f1a de registro\" class=\"border p-3 w-full rounded-lg\" /> </div> <div> <label for=\"password_confirmation\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Repetir password </label> <!-- password_confirmation para validar posteriormente password --> <input id=\"password_confirmation\" name=\"password_confirmation\" type=\"password\" placeholder=\"repite la contrase\u00f1a\" class=\"border p-3 w-full rounded-lg\" /> </div> <br> <input type=\"submit\" value=\"Crear cuenta\" class=\"bg-sky-600 hover:bg-sky-700 transition-colors cursor-pointer uppercase font-bold w-full p-3 text-white rounded-lg\" /> </form> </div> @endsection A tener en cuenta: En {{asset('images/dwes_registrar.png')}} : {{ }} hace referencia a un echo. asset() hace referencia a la ruta app/public de Laravel. El input password_confirmation del formulario tiene este nombre de forma ' obligatoria '; es decir, el prefijo _confirmation har\u00e1 que Laravel, internamente, compruebe que el input de nombre password y el input de nombre password_confirmation contengan la misma cadena. [volver ^] ejemplo 08. Petici\u00f3n post Vamos a crear ahora el enlace registrarse. Para ello accedemos a web.php e introducimos la linea con el m\u00e9todo POST: PHP 1 2 Route::get('/register', [RegisterController::class, 'index']) -> name('register'); Route::post('/register', [RegisterController::class, 'store']); A tener en cuenta No ponemos un alias en la segunda ruta porque va a tomar tambi\u00e9n el alias del anterior ruta. Al mismo tiempo, en nuestro controlador RegisterController.php agregamos la funci\u00f3n store : PHP 1 2 3 public function store() { dd('formulario...'); } La funci\u00f3n dd ( dump or die ) en Laravel permite parar la ejecuci\u00f3n en ese punto. Es decir, parecida a la funci\u00f3n dump() pero finaliza la ejecuci\u00f3n del script. Para terminar este punto, en la vista register.blade.php vamos a modificar la etiqueta form para que redireccione al action correspondiente con el m\u00e9todo en q\u00fcesti\u00f3n. F\u00edjate que en action ponemos la funci\u00f3n route y el nombre de la ruta: PHP 1 2 3 ... <form action=\"{{ route('register') }}\" method=\"POST\"> ... problema a la \"vista\"!! Si recargamos la p\u00e1gina y clicamos en el enlace vemos que nos muestra el siguiente error: \u00bfPor qu\u00e9 una p\u00e1gina expirada? Laravel es un framework enfocado a la seguridad (en este caso, se asegura que no suframos ataques del tipo XSRF o Cross Site Request Forgery). As\u00ed que Laravel tiene consideraciones de seguridad. Para evitar estos ataques usaremos la directiva @csrf justo despu\u00e9s de la linea de la etiqueta <form> . Text Only 1 2 3 4 ... <form action=\"{{ route('register') }}\" method=\"POST\"> @csrf ... Si pulsamos F12 para ver el c\u00f3digo en el navegador se mostrar\u00e1 un campo oculto con un token oculto para validar la cadena y evitar este tipo de ataques: Modificamos la funci\u00f3n store para pasarle el objeto $request : PHP 1 2 3 4 public function store(Request $request) { dd(request); // dd(request->get('email')); } Si accedemos a la ruta localhost/register se observa la informaci\u00f3n del array $request : [volver ^] ejemplo 09. Validaci\u00f3n de campos Para validar los campos del formulario del controlador RegisterController.php podemos utilizar las reglas de validaci\u00f3n siguientes; \u00e9stas se colocar\u00e1n en la funci\u00f3n store del controlador: PHP 1 2 3 4 5 6 7 8 9 10 11 public function store(Request $request) { //dd($request); //dd($request->get('email')); //validaci\u00f3n $this->validate($request, [ 'name' => ['required', 'min:5'], 'username' => ['required', 'unique:users', 'min:3', 'max:20'], 'email' => ['required', 'unique:users','email','max:60'], 'password' => ['required','confirmed','min:6'] ]); por qu\u00e9 en unique se refiere a una tabla users que todav\u00eda no la hemos creado? M\u00e1s adelante lo veremos, pero se puede obersar en la carpeta database/migrations que tenemos una migraci\u00f3n de la tabla users . Laravel crea autom\u00e1ticamente estas tablas. Podemos observar que, en apariencia, no hace nada (o no muestra nada). Es decir, para mostrar un mensaje de error cuando no se cumpla una validaci\u00f3n colocaremos la directiva @error ... @enderrror en nuestro formulario (en el ejemplo register.blade.php ) justo despu\u00e9s del <input> en cuesti\u00f3n. Siguiendo en el ejemplo: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 <input id=\"name\" name=\"name\" type=\"text\" placeholder=\"tu nombre\" class=\"border p-3 w-full rounded-lg\" > @error('name') <p class=\"bg-red-500 text-white my-2 rounded-lg text-sm p-2 text-center\"> el nombre es obligatorio </p> @enderror [volver ^] ejemplo 10. Mensajes de errores din\u00e1micos Como se ha comentado, la mejor opci\u00f3n de mostrar un mensaje de error en Laravel es de forma din\u00e1mica mediante $message : En el ejemplo anterior, modificar\u00edamos el contenido de la directiva @error . Text Only 1 2 3 4 5 @error('username') <p class=\"bg-red-500 text-white my-2 rounded-lg text-sm p-2 text-center\"> {{ $message }} </p> @enderror A tener en cuenta: El p\u00e1rrafo se ha modificado para tener texto blanco sobre fondo rojo. Si, adem\u00e1s, queremos pintar de color rojo el campo en el que aparece el error, podemos poner en la clase del input un @error que diga que si existe un error en (por ejemplo) el campo username coloree el borde del campo en rojo: PHP 1 2 3 4 5 6 7 8 <input id=\"username\" name=\"username\" type=\"text\" placeholder=\"tu nombre de usuario\" class=\"border p-3 w-full rounded-lg @error('username') border-red-500 @enderror\" > [volver ^] ejemplo 11. Mantener valor despu\u00e9s de un error Para 'guardar' del valor de un campo si volvemos al formulario en el atributo value del input colocaremos {{ old('username') }} . En el ejemplo de username : Text Only 1 2 3 4 5 6 7 8 9 <input id=\"username\" name=\"username\" type=\"text\" placeholder=\"tu nombre de usuario\" class=\"border p-3 w-full rounded-lg @error('username') border-red-500 @enderror\" value= \"{{ old('username') }}\" > Entre las validaciones de Laravel tambi\u00e9n podr\u00e1 verse la validaci\u00f3n de HTML5. Si quieres deshabilitar esta \u00faltima puedes introducir el atributo novalidate en la etiqueta <form ... novalidate> . A partir de ahora, como tarea, puedes validar t\u00fa mismo todos los campos del formulario. [volver ^] ejemplo 12. Confirmar valor del password En el ejemplo, poner en el Blade que lleva el formulario: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 <div> <label for=\"password_confirmation\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Repetir password </label> <input id=\"password_confirmation\" name=\"password_confirmation\" type=\"password\" placeholder=\"repite la contrase\u00f1a\" class=\"border p-3 w-full rounded-lg\" /> </div> Despu\u00e9s, en el controlador en cuesti\u00f3n ( RegisterController.php ), poner la validaci\u00f3n confirmed (ya se hab\u00eda introducido en anteriores ejemplos): PHP 1 2 3 4 5 6 7 8 //... $this->validate($request, [ 'name' => ['required', 'min:5'], 'username' => ['required', 'unique:users', 'min:3', 'max:20'], 'email' => ['required', 'unique:users','email','max:60'], 'password' => ['required','confirmed','min:6'] ]); //... [volver ^] ejemplo 13. Crear usuario en la app Como vemos, si intentamos crear un usuario en nuestro ejemplo de inserci\u00f3n de usuarios, se obtiene un error en el que nos indica que falta el campo username en la tabla users . Esto es debido a que, cuando se ha ejecutado, por primera vez, la migraci\u00f3n este campo no exist\u00eda. Para que la app funcione deberemos de migrar este campo. Ejecutamos (el nombre lleva una convenci\u00f3n de Laravel): Bash 1 2 3 php artisan make:migration add_username_to_users_table # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan make:migration add_username_to_users_table Si accedemos al fichero generado en la carpeta migrations insertaremos el c\u00f3digo que se muestra a continuaci\u00f3n: PHP 1 2 3 4 5 //... Schema::table('users', function(Blueprint $table)){ $table->string('username')-> unique() -> after('name'); }); //... Para que los cambios surjan efecto, volvemos a ejecutar migrate : PHP 1 2 3 php artisan migrate # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan migrate Aunque se indique el campo username como string se crear\u00e1 en la base de datos como varchar . Siguiendo el ejemplo anterior ahora no nos dar\u00e1 error la inserci\u00f3n en el formulario. [volver ^] referencias Tutorial de Composer Web Scraping with PHP \u2013 How to Crawl Web Pages Using Open Source Tools PHP Monolog Unit Testing con PHPUnit \u2014 Parte 1, de Emiliano Zublena.","title":"ud07 FrameworksPHP Laravel"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#duracion-y-criterios-de-evaluacion","text":"Duraci\u00f3n estimada : \u221e sesiones. Resultado de aprendizaje y criterios de evaluaci\u00f3n : Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades seg\u00fan especificaciones. a) Se han identificado los mecanismos disponibles para el mantenimiento de la informaci\u00f3n que concierne a un cliente web concreto y se han se\u00f1alado sus ventajas. b) Se han utilizado sesiones para mantener el estado de las aplicaciones Web. c) Se han utilizado cookies para almacenar informaci\u00f3n en el cliente Web y para recuperar su contenido. d) Se han identificado y caracterizado los mecanismos disponibles para la autentificaci\u00f3n de usuarios. e) Se han escrito aplicaciones que integren mecanismos de autentificaci\u00f3n de usuarios. f) Se han realizado adaptaciones a aplicaciones Web existentes como gestores de contenidos u otras. g) Se han utilizado herramientas y entornos para facilitar la programaci\u00f3n, prueba y depuraci\u00f3n del c\u00f3digo.","title":"duraci\u00f3n y criterios de evaluaci\u00f3n"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#consideraciones-previas","text":"","title":"consideraciones previas"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#mvc","text":"MVC (Model View Controller o Modelo Vista Controlador) es un patr\u00f3n de arquitectura de software que permite la separaci\u00f3n de obligaciones de cada pieza de tu c\u00f3digo. Este paradigma de la programaci\u00f3n enfatiza la separaci\u00f3n de la l\u00f3gica de programaci\u00f3n con la presentaci\u00f3n. Ventajas : MVC no mejora el performance del c\u00f3digo, tampoco da seguridad; pero tu c\u00f3digo tendr\u00e1 un mejor orden y ser\u00e1 f\u00e1cil de mantener . En un grupo de trabajo, el tener el c\u00f3digo ordenado permite que m\u00e1s de una persona pueda entender que es lo que hace cada parte de \u00e9l. Aprender MVC, te har\u00e1 que otras tecnolog\u00edas como Nest , Rails , Django , Net Core , Spring Boot te ser\u00e1n m\u00e1s sencillas de aprender.","title":"MVC"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#modelo","text":"Encargado de todas las interacciones en la base de datos (obtener datos, actualizarlos y eliminar). El Modelo se encarga de consultar una base de datos, obtiene la informaci\u00f3n pero no la muestra (esa tarea es para las vistas). El Modelo tampoco se encarga de actualizar la informaci\u00f3n directamente (esa tarea es del Controlador, que es quien decide cu\u00e1ndo llamarlo).","title":"Modelo"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#vista","text":"Se encarga de todo lo que se ve en pantalla (HTML). Laravel tiene un Template Engine llamado Blade para mostrar los datos. Si utilizas React , Vue , Angular , Svelte , etc. estos ser\u00edan tu vista. El Modelo consulta la base de datos, pero es por medio del Controlador que se decide qu\u00e9 Vista hay que llamar y qu\u00e9 datos presentar.","title":"Vista"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#controlador","text":"Es el que comunica Modelo y Vista ; antes de que el Modelo consulte la base de datos el Controlador es el encargado de llamar un Modelo en espec\u00edfico. Una vez consultado el Modelo , el Controlador recibe esa informaci\u00f3n, manda llamar a la Vista y le pasa la informaci\u00f3n. El Controlador es el que mandar llamar la Vista y Modelo s, que se requieren en cada parte de tu aplicaci\u00f3n.","title":"Controlador"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#router","text":"Es el encargado de registrar todas las URL\u2019s o Endpoints que va a soportar nuestra aplicaci\u00f3n. Ejemplo: Si el Usuario accede a /productos el router ya tiene registrada esa ruta y un controlador con una funci\u00f3n que sabe que Modelo debe llamar y que vista mostrar cuando el usuario visita esa URL.","title":"Router"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#artisan","text":"Artisan es el CLI (Command Line Interface) incluido en Laravel. Artisan es un script que existe en la base de tu proyecto de Laravel y cuenta con una gran cantidad de scripts disponibles. Estos comandos te permiten crear migraciones , controladores , modelos , policies y mucho m\u00e1s. Todos los comando podemos encontrarlos ejecutando: Bash 1 2 3 # php artisan # \u00f3, si no funciona: sudo docker-compose exec myapp php artisan Por ejemplo, si quisi\u00e9ramos crear un controlador (como veremos m\u00e1s adelante) la orden ser\u00eda: Bash 1 2 3 # php artisan make:controller RegisterController # \u00f3, si no funciona: sudo docker-compose exec myapp php artisan make:controller RegisterController","title":"Artisan"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#instalar-docker-bitnamilaravel","text":"Lo primero de todo es crear una carpeta con el nombre del proyecto y accedemos ella. Por ejemplo, creamos el proyecto prularavel dentro de nuestra carpeta de proyectos: Bash 1 $ mkdir ~/dwes/proyectos/prularavel Accedemos dentro de la carpeta de este nuevo proyecto. En este punto tenemos dos opciones: A. Utilizar la imagen de Bitnami ya preparada, as\u00ed que lo que hacer ahora es descargar el archivo docker-compose.yml del repositorio de Github oficial. Bash 1 curl -LO https://raw.githubusercontent.com/bitnami/containers/main/bitnami/laravel/docker-compose.yml B. Utilizar el fichero docker-compose.yml que tenemos en nuestra carpeta del curso (en el que se a\u00f1ade el contenedor para phpMyadmin ). En caso ejecutaremos la opci\u00f3n B. Una vez descargado el archivo en nuestra carpeta que acabamos de crear con el nombre del proyecto, lanzamos el siguiente comando por consola para instalar todas las dependencias y crear las im\u00e1genes de Docker correspondientes. Bash 1 sudo docker-compose up -d Si utilizamos el contenedor Portainer para la gesti\u00f3n de nuestros contenedores, podremos observar que estar\u00e1n en marcha nuestros dos contenedores (pertenecientes al servidor web y servidor de bases de datos): Si por alguna extra\u00f1a raz\u00f3n est\u00e1s en Windows y no te funciona una de las 2 im\u00e1genes, puede ser debido a la instalaci\u00f3n de composer dentro de la imagen de Laravel. Para solucionarlo, nos vamos a la carpeta del proyecto que se te habr\u00e1 creado por defecto al hacer docker-compose; en este caso, y si no has modificado el archivo .yml, la carpeta del proyecto sera my-proyect y dentro de ella eliminamos la carpeta vendor. Acto seguido instalar Composer de manera global en nuestro sistema Windows (b\u00e1jate el instalador desde este enlace ). Una vez lo instales ya ser\u00e1s capaz de lanzar el comando composer desde cualquier consola de Windows.","title":"instalar docker bitnami/Laravel"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#vscode-extensiones","text":"Recomendable instalar los siguientes plugins para Visual Studio Code. Referentes a PHP: PHP Intelephense PHP IntelliSense PHP Namespace Resolver Referentes a Laravel: Laravel Blade Snippets Laravel Snippets Laravel goto view Laravel Extra Intellisense Referentes a API: Thunder Client Referentes a CSS: Tailwind CSS IntelliSense Aporte Un aporte, o instalaci\u00f3n, a tener en cuenta, podr\u00eda ser la de instalar Tailwind CSS . Este software nos va a proporcionar, de manera sencilla y c\u00f3moda, una opci\u00f3n de utilizar CSS. Para ello, seguir las instrucciones del anexo I - instalaci\u00f3n de Tailwind CSS .","title":"VSCode extensiones"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#carpetas-en-laravel","text":"Al crear un nuevo proyecto con este framework, Laravel crea una serie de carpetas por defecto. Esta estructura de carpetas es la recomendada para utilizar Laravel.","title":"carpetas en Laravel"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#apphttpcontrollers","text":"En esta carpeta es donde se van a introducir nuestros controladores (cuando se cree un controlador, es aqu\u00ed donde va a ubicarse).","title":"app/Http/Controllers"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#models","text":"Para seguir el paradigma de M VC, los modelos van a introducirse en esta carpeta.","title":"Models"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#public","text":"Esta es la carpeta m\u00e1s importante ya que es donde se ponen todos los archivos que el cliente va a mostrar al usuario cuando introduzcamos la URL de nuestro sitio web (por ejemplo, dentro de esta carpeta crear otra carpeta img ). Normalmente se carga el archivo index.php por defecto.","title":"public"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#resources","text":"Esta es nuestra carpeta de recursos donde guardaremos los siguientes archivos, que tambi\u00e9n, est\u00e1n separados por sus carpetas... como cada nombre indica: css Archivos CSS (archivos originales que son procesadas y se colocan las versiones compiladas en public mediante al archivo webpack.mix.js ). js Archivos JS o JavaScript (archivos originales que son procesadas y se colocan las versiones compiladas en public mediante al archivo webpack.mix.js ). lang Archivos relacionados con el idioma del sitio (variables & strings). views Archivos de nuestras vistas, lo que las rutas cargan (com\u00fanmente: lo que se ve en pantalla). Ejemplo : Podemos observar todo esto en el ejemplo 01 .","title":"resources"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#routes","text":"Otra de las carpetas que m\u00e1s vamos a usar a lo largo de esta unidad dedicada a Laravel es routes . En ella se albergan todas las rutas (redirecciones web) de nuestro proyecto, pero m\u00e1s concretamente en el archivo web.php : Bash 1 Dada una ruta \u2192 se cargar\u00e1 una vista","title":"routes"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#vendor","text":"En esta carpeta se colocan todas las dependencias de Composer que son necesarias tanto para que Laravel funcione o si quieres agregar alguna dependencia extra (por ejemplo: agregar pagos con Paypal . Laravel tiene un paquete llamado cashier que permite pagos en l\u00ednea y tambi\u00e9n podemos instalar una dependencia extra mediante Composer). Podemos observar en el archivo composer.json las dependencias instaladas.","title":"vendor"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#env","text":"Aunque .env no es una carpeta, sino un archivo, tambi\u00e9n merece especial atenci\u00f3n por ser un fichero de configuraci\u00f3n de nuestro proyecto. Por ejemplo, en nuestro caso, la conexi\u00f3n a base de datos ser\u00eda: Bash 1 2 3 4 5 6 7 8 # ... DB_CONNECTION = mysql DB_HOST = 127 .0.0.1 DB_PORT = 3306 DB_DATABASE = dwes DB_USERNAME = dwes DB_PASSWORD = dwes # ...","title":".env"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#rutas","text":"Las rutas en Laravel (y en casi cualquier Framework) sirven para redireccionar al cliente (o navegador) a las vistas que nosotros queramos. Estas rutas se configuran en el archivo routes/web.php donde se define la ruta que el usuario pone en la URL despu\u00e9s del dominio y se retorna la vista que se quiere cargar al introducir dicha direcci\u00f3n en el navegador. En este ejemplo podemos obersvar la clase Route y un m\u00e9todo est\u00e1tico get , este m\u00e9todo est\u00e1tico toma la URL ('/' en este caso) y tambi\u00e9n un closure o callback function () ... PHP 1 2 3 4 5 <?php // Ruta por defecto para cargar la vista welcome (sin extensi\u00f3n .blade.php) cuando el usuario introduce simplemente el dominio Route :: get ( '/' , function () { return view ( 'welcome' ); }); En el ejemplo de arriba vamos a cargar la vista llamada welcome que hace referencia a la vista resources/views/welcome.blade.php . closure VS controlador Se puede definir en el segundo par\u00e1metro un closure o un controlador (veremos m\u00e1s adelante este caso). Por ejemplo: PHP 1 Route::get('/register', [RegisterController::class, 'index']) -> name('register');","title":"rutas"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#alias","text":"Es interesante darle un alias o un nombre a nuestras rutas para poder utilizar dichos alias en nuestras plantillas de Laravel que veremos m\u00e1s adelante. Para ello, basta con utilizar la palabra name al final de la estructura de la ruta y darle un nombre que queramos; normalmente descriptivo y asociado a la vista que tiene que cargar el enroutador de Laravel. PHP 1 2 3 4 <?php Route :: get ( '/users' , function () { return view ( 'users' ); }) -> name ( 'usuarios' ); Despu\u00e9s veremos que es muy \u00fatil ya que a la hora de refactorizar o hacer un cambio, si tenemos enlaces o men\u00fas de navegaci\u00f3n que apuntan a esta ruta, s\u00f3lo tendr\u00edamos que cambiar el par\u00e1metro dentro del get() y no tener que ir archivo por archivo.","title":"alias"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#forma-corta-para-una-vista","text":"Laravel nos proporciona una manera m\u00e1s c\u00f3moda a la hora de cargar una vista si no queremos par\u00e1metros ni condiciones. Tan s\u00f3lo definiremos la siguiente l\u00ednea que hace referencia la ruta datos en la URL y va a cargar el archivo usuarios.php de nuestra carpeta views como le hemos indicado en el segundo par\u00e1metro. PHP 1 2 3 <?php /* http://localhost/datos/ */ Route :: view ( 'datos' , 'usuarios' ); Pero no s\u00f3lo podemos retornar una vista, sino, desde un simple string, a m\u00f3dulos propios de Laravel. Ejemplo : Podemos observar todo esto en el ejemplo 02 .","title":"forma corta para una vista"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#parametros","text":"Ya hemos visto que con PHP podemos pasar par\u00e1metros a trav\u00e9s de la URL, como si fueran variables, que las recuper\u00e1bamos a trav\u00e9s del m\u00e9todo GET o POST. Con Laravel tambi\u00e9n podemos introducir par\u00e1metros pero de una forma m\u00e1s vistosa y ordenada, de tal manera que sea visualmente m\u00e1s c\u00f3modo de recordar y de indexar por los motores de b\u00fasqueda como Google. Text Only 1 http://localhost/cliente/324 Para configurar este tipo de rutas en nuestro archivo de rutas public/routes/web.php haremos lo siguiente. PHP 1 2 3 4 <?php Route :: get ( 'cliente/{id}' , function ( $id ) { return ( 'Cliente con el id: ' . $id ); }); \u00bfQu\u00e9 pasa si no introducimos un id y s\u00f3lo navegamos hasta cliente/ ? ... que nos va a devolver un 404 | NOT FOUND . Para resolver esto, podemos definir una ruta por defecto en caso de que el id (o par\u00e1metro) no sea pasado. Para ello usaremos el s\u00edmbolo ? en nuestro nombre de ruta e inicializaremos la variable con el valor que queramos. PHP 1 2 3 4 <?php Route :: get ( 'cliente/{id?}' , function ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); }); Ahora tenemos otro problema, porque estamos filtrando por id del cliente que, normalmente es un n\u00famero; pero si introducimos un par\u00e1metro que no sea un n\u00famero, vamos a obtener un resultado no deseado. Para resolver este caso haremos uso de la cl\u00e1usula where junto con una expresi\u00f3n regular n\u00famerica: PHP 1 2 3 4 <?php Route :: get ( 'cliente/{id?}' , function ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); }) -> where ( 'id' , '[0-9]+' ); Adem\u00e1s, podemos pasarle variables a nuestra URL para luego utilizarlas en nuestros archivos de plantillas o en archivos .php haciendo uso de un array asociativo. Veamos un ejemplo con la forma reducida para ahorrarnos c\u00f3digo: PHP 1 2 <?php Route :: view ( 'datos' , 'usuarios' , [ 'id' => 5446 ]); ... y el archivo resources/views/usuarios.blade.php debe tener algo parecido a \u00e9sto: PHP 1 2 3 4 <!-- Estructura t\u00edpica de un archivo HTML5 --> <!-- ... --> <p>Usuario con id: <? = $id ?> </p> <!-- ... --> Con las plantillas de Laravel blade.php veremos c\u00f3mo simplificar a\u00fan m\u00e1s nuestro c\u00f3digo. Para m\u00e1s informaci\u00f3n acerca de las rutas, par\u00e1metros y expresiones regulares en las rutas puedes echar un vistazo a la documentaci\u00f3n oficial de rutas que contiene numerosos ejemplos. Ejemplo : Podemos observar un ejemplo en ejemplo 03 .","title":"par\u00e1metros"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#plantillas-o-templates","text":"A trav\u00e9s de las plantillas de Laravel vamos a escribir menos c\u00f3digo PHP y vamos a tener nuestros archivos mejor organizados . Blade es el sistema de plantillas que trae Laravel, por eso los archivos de plantillas que guardamos en el directorio de views llevan la extensi\u00f3n blade.php . De esta manera sabemos inmediatamente que se trata de una plantilla de Laravel y que forma parte de una vista que se mostrar\u00e1 en el navegador.","title":"plantillas o templates"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#directivas","text":"Laravel tiene un gran n\u00famero de directivas que podemos utilizar para ahorrarnos mucho c\u00f3digo repetitivo entre otras funciones. Digamos que las directivas son peque\u00f1as funciones ya escritas que aceptan par\u00e1metros y que cada una de ellas hace una funci\u00f3n diferente dentro de Laravel. Por ejemplo: @yield define el contenido din\u00e1mico que se va a cargar. Se usa conjuntamente con @section . @section y @endsection es un bloque de c\u00f3digo din\u00e1mico. @extends importa el contenido de una plantilla ya creada.","title":"directivas"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#separando-codigo","text":"Veamos sobre un ejemplo c\u00f3mo separar el c\u00f3digo para no repetirlo. Ejemplo : Podemos observar todo esto en el ejemplo 04 . Ejemplo : Realiza tambi\u00e9n el ejemplo 05 .","title":"separando c\u00f3digo"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#estructuras-de-control","text":"Como en todo buen lenguaje de programaci\u00f3n, en Laravel tambi\u00e9n tenemos estructuras de control. En Blade (plantillas de Laravel) siempre que iniciemos un bloque de estructura de control DEBEMOS cerrarla. @foreach ~ @endforeach lo usamos para recorrer arrays. @if ~ @endif para comprobar condiciones l\u00f3gicas. @switch ~ @endswitch en funci\u00f3n del valor de una variable ejecutar un c\u00f3digo. @case define la casu\u00edstica del switch. @break rompe la ejecuci\u00f3n del c\u00f3digo en curso. @default si ninguna casu\u00edstica se cumple. PHP 1 2 3 4 5 6 7 8 9 10 <?php $equipo = [ 'Mar\u00eda' , 'Alfredo' , 'William' , 'Ver\u00f3nica' ]; @ foreach ( $equipo as $elemento ) < p > {{ $elemento }} </ p > @ endforeach // si no funciona la estructura anterior: // foreach ($equipo as $elemento) { // echo \"<p>\" . $elemento . \"</p>\"; // } Acordaros que podemos pasar variables a trav\u00e9s de las rutas como si fueran par\u00e1metros. Pero en este caso, vamos a ver otra directiva m\u00e1s; el uso de @compact . PHP 1 2 3 4 5 6 <?php // Uso de @compact $equipo = [ 'Mar\u00eda' , 'Alfredo' , 'William' , 'Ver\u00f3nica' ]; // Route::view('nosotros', ['equipo' => 'equipo']); Route :: view ( 'nosotros' , @ compact ( 'equipo' )); Ejemplo : Veamos sobre un ejemplo pasar informaci\u00f3n a la vista a trav\u00e9s del ejemplo 06 .","title":"estructuras de control"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#controladores","text":"Los controladores son el lugar perfecto para definir la l\u00f3gica de negocio de nuestra aplicaci\u00f3n o sitio web. Hace de intermediario entre la Vista (lo que vemos con nuestro navegador o cliente) y el servidor donde la app est\u00e1 alojada. Por defecto, los controladores se guardan en una carpeta espec\u00edfica situada en app/Http/Controllers y tienen extensi\u00f3n .php . Para crear un controlador nuevo debemos hacer uso de nuestro querido CLI artisan donde le diremos que cree un controlador con el nombre que nosotros queramos. Abrimos la consola y nos situamos en la ra\u00edz de nuestro proyecto: Bash 1 2 3 php artisan make:controller PagesController # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan make:controller PagesController Si todo ha salido bien, recibiremos un mensaje por consola con que todo ha ido bien y podremos comprobar que, efectivamente, se ha creado el archivo PagesController.php con una estructura b\u00e1sica de controlador, dentro de la carpeta Controllers que hemos descrito anteriormente. Ahora podemos modificar nuestro archivo de rutas web.pbp para dejarlo limpio de l\u00f3gica y trasladar \u00e9sta a nuestro nuevo controlador. La idea de esto es dejar el archivo web.php tan limpio como podamos para que, de un vistazo, se entienda todo perfectamente. recuerda s\u00f3lo movemos la l\u00f3gica, mientras que las cl\u00e1usulas como where y name las seguimos dejando en el archivo de rutas web.php .","title":"controladores"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#convenciones","text":"Laravel tiene una convenci\u00f3n a la hora de nombrar los m\u00e9todos de tus controllers conocida como Resource Controllers. Esta convenci\u00f3n ayuda bastante para tener todo mejor organizado: verbo HTTP URI acci\u00f3n ruta GET /clientes index clientes.index POST /clientes store clientes.store DELETE /clientes/{cliente} destroy clientes.destroy En este enlace a la documentaci\u00f3n de Laravel vemos las acciones que son controladas (o manejadas) por el controlador enlace . Veamos c\u00f3mo quedar\u00eda un refactor del archivo de rutas utilizando un Controller como el que acabamos de crear. Ahora nos quedar\u00eda de la siguiente manera: PHP 1 2 3 4 5 6 7 8 9 <?php // web.php (v2.0) \u2592\u2592\u2592 Refactorizado use App\\Http\\Controllers\\PagesController ; use Illuminate\\Support\\Facades\\Route ; Route :: get ( '/' , [ PagesController :: class , 'inicio' ]); Route :: get ( 'datos' , [ PagesController :: class , 'datos' ]); Route :: get ( 'cliente/{id?}' , [ PagesController :: class , 'cliente' ]) -> where ( 'id' , '[0-9]+' ); Route :: get ( 'nosotros/{nosotros?}' , [ PagesController :: class , 'nosotros' ]) -> name ( 'nosotros' ); y en nuestro archivo controlador lo dejar\u00edamos de la siguiente manera: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <?php // PagesController.php namespace App\\Http\\Controllers ; class PagesController extends Controller { public function inicio () { return view ( 'welcome' ); } public function datos () { return view ( 'usuarios' , [ 'id' => 56 ]); } public function cliente ( $id = 1 ) { return ( 'Cliente con el id: ' . $id ); } public function nosotros ( $nombre = null ) { $equipo = [ 'Paco' , 'Enrique' , 'Maria' , 'Veronica' ]; return view ( 'nosotros' , @ compact ( 'equipo' , 'nombre' )); } } Ejemplo : Podemos observar todo esto en el ejemplo 07 .","title":"convenciones"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#tipos-de-request","text":"","title":"tipos de Request"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#en-http-y-apis","text":"En HTTP existen diferentes tipos de Request o tipos de Petici\u00f3n: GET, POST, PUT, PATCH y DELETE. GET es el m\u00e1s simple; cuando visitas un sitio web por default es un GET, y el m\u00e9todo solo se utiliza para recuperar datos pero nunca debe enviar datos. POST se utiliza cuando mandas datos a un servidor; esto incluye informaci\u00f3n que llenas en un formulario o buscador. PUT es utilizado para actualizar un elemento; pero si no existe crea uno nuevo; PUT es un reemplazo total de un registro. PATCH es utilizado para actualizar parcialmente un elemento o recurso. DELETE se utiliza para eliminar un recurso o elemento. Ejemplo : Podemos observar todo esto en el ejemplo 08 .","title":"En HTTP y API\u2019s"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#validacion-de-formularios","text":"Para validar los campos de un formulario podemos utilizar las reglas de validaci\u00f3n; \u00e9stas se colocar\u00e1n en la funci\u00f3n store del controlador. Todas las reglas de validaci\u00f3n de Laravel podemos observarlas en la documentaci\u00f3n oficial, en este enlace . Ejemplo : Podemos observar todo esto en el ejemplo 09 .","title":"validaci\u00f3n de formularios"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#mostrar-errores-de-forma-dinamica","text":"Si utilizamos la directiva @error ... @enderror de esta forma: Text Only 1 2 3 4 5 @error('name') <p class=\"bg-red-500 text-white my-2 rounded-lg text-sm p-2 text-center\"> el nombre es obligatorio </p> @enderror solo mostrar\u00eda si el nombre es obligatorio; pero podemos tener m\u00e1s validaciones (en el mismo input ) que chequear. Este tipo de errores con texto est\u00e1tico no es la mejor opci\u00f3n . Laravel ya tiene una serie de mensajes para dicho caso. Deberemos imprimir un mensaje con el mensaje de error $message . Ejemplo : Podemos observar todo esto en el ejemplo 10 .","title":"mostrar errores de forma din\u00e1mica"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#mensajes-en-castellano","text":"Los mensajes de errores est\u00e1n en ingl\u00e9s, \u00bfc\u00f3mo podemos mostrarlos en castellano ? Existen paquetes en Laravel en castellano, por ejemplo MarcoGomesr/laravel-validation-en-espanol . En el terminal, a nivel de tu proyecto, ejecuta la clonaci\u00f3n: PHP 1 git clone https://github.com/MarcoGomesr/laravel-validation-en-espanol.git resources/lang Para terminar el cambio accede al fichero config/app.php y en la linea 86 (m\u00e1s o menos) cambiar el idioma a espa\u00f1ol: PHP 1 'locale' => 'es', Ejemplo : Poner nuestro proyecto en idioma espa\u00f1ol.","title":"mensajes en castellano"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#mantener-el-valor-en-el-campo-despues-de-un-error","text":"Muchas veces es frustrante volver a un formulario despu\u00e9s de un error y observar que los valores de todos los campos se han borrado y que necesitas volver a introducirlos. Para evitar este caso podemos poner en los input el atributo value y pasarle \"{{ old('username') }}\" . Ejemplo : Podemos observar todo esto en el ejemplo 11 .","title":"mantener el valor en el campo despu\u00e9s de un error"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#confirmar-password-en-otro-campo","text":"Para confirmar el password notamos que hab\u00edamos puesto anteriormente al campo de confirmaci\u00f3n de password esta etiqueta: Una convenci\u00f3n en Laravel para comprobar si dos campos son iguales es asignarle al segundo el prefijo _confirmation . Pasos a seguir: Poner de nombre del segundo input password_confirmation (y debe nombrarse as\u00ed ) Poner la validaci\u00f3n confirmed para el campo pasword en el controlador. Ejemplo : Podemos observar todo esto en el ejemplo 12 .","title":"confirmar password en otro campo"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#migraciones-y-la-base-de-datos","text":"Si has seguido los ejemplos anteriores correctamente habr\u00e1s comprobado que cuando ponemos un correo e intentamos acceder muestra el siguiente error: Nos indica que est\u00e1 revisando el valor de email en la tabla de usuarios y esta no existe. Para completar el formulario habr\u00e1 que crear dicha tabla users . Para esto debemos realizar nuestra primera migraci\u00f3n .","title":"migraciones y la base de datos"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#que-son-migraciones","text":"Las Migraciones se les conoce como el control de versiones de tu base de datos; de esta forma se puede crear la base de datos y compartir el dise\u00f1o con el equipo de trabajo. Si deseas agregar nuevas tablas o columnas a una tabla existente, puedes hacerlo con una nueva migraci\u00f3n; si el resultado no fue el deseado, puedes revertir esa migraci\u00f3n. Lanzar desde la linea de comandos: PHP 1 2 3 4 // ejecuta las migraciones php artisan migrate // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate PHP 1 2 3 4 5 6 7 8 9 // en caso de querer deshacer el cambio: php artisan migrate:rollback // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback // regresar las \u00faltimas 5 (por ejemplo) migraciones php artisan migrate:rollback --step=5 // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback --step=5 Las migraciones se van a ir colocando, siempre, en la carpeta del proyecto database/migrations : Laravel tiene unas migraciones por defecto, sobre todo para la creaci\u00f3n de usuarios. Consideraciones previas Recuerda tener el fichero .env configurado para acceder a tu bd en q\u00fcesti\u00f3n y con usuario y contrase\u00f1a adecuados: Abrimos el terminal, dentro del proyecto: PHP 1 2 3 php artisan migrate // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate Si, despu\u00e9s de ejecutar, accedemos a nuestra base de datos, por ejemplo desde phpMyadmin :","title":"qu\u00e9 son migraciones"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#rollback-de-la-migracion","text":"Si, quisi\u00e9ramos echar para atr\u00e1s en la migraci\u00f3n: PHP 1 2 3 php artisan migrate:rollback // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback Vemos que las tablas dejan de existir (solo queda la tabla migraciones) en nuestra bd: Ejemplo : Podemos observar todo esto en el ejemplo 13 .","title":"rollback de la migraci\u00f3n"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#modelos","text":"","title":"modelos"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#orm-eloquent","text":"Laravel incluye su propio ORM (Object Relacional Mapper) que hace muy sencillo interactuar con tu base de datos. En Eloquent cada tabla tiene su propio modelo ; ese modelo interact\u00faa \u00fanicamente con esa tabla y tiene las funciones necesarias para crear registros, obtenerlos, actualizarlos y eliminarlos. Bash 1 sudo docker-compose exec myapp php artisan make:model Cliente Laravel tiene el modelo users creado por defecto.","title":"ORM Eloquent"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#convenciones-en-laravel","text":"","title":"convenciones en Laravel"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#en-modelos","text":"Cuando creas el Modelo Cliente , Eloquent asume que la tabla se va a llamar clientes . Si el Modelo se llama Producto ; Eloquent espera una tabla llamada productos . Problema Puede ser un problema llamar tu modelo Proveedor , porque Eloquent espera la tabla llamada provedors , pero se puede reescribir en el modelo.","title":"en Modelos"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#crear-registros-con-eloquent-orm","text":"Para insertar una fila en nuestra tabla users , debemos insertar el siguiente c\u00f3digo en nuestro controlador RegisterController.php : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 //... use Illuminate\\Support\\Facades\\Hash use App\\Models\\User // si no se encuentra se a\u00f1ade //... public function store(Request $request) { //... User::create([ 'name' => $request->name, 'username' => $request->username, 'mail' => $request->email, 'password' => Hash::make($request->password) ]); } //... A tener en cuenta: cuando introducimos User arriba en el c\u00f3digo se va a importar use App\\Models\\User; el m\u00e9todo create corresponde a un insert into ... podemos utilizar un helper (en Laravel encontramos una gran variedad) relacionado con los string; por ejemplo para que no introduzcamos espacios no deseados en el campo username. vemos que, para hashear el password y que no se vea la cadena literal, podemos utilizar la clase Hash::make(cadena) . Si no importa directamente use Illuminate\\Support\\Facades\\Hash le damos bot\u00f3n derecho - import class . cuidado Si no modificamos nada m\u00e1s, el campo username obtendr\u00e1 un error. Esto es debido a que este campo lo hemos introducido nosotros despu\u00e9s de la primera migraci\u00f3n; y Laravel tiene un sistema de seguridad por el que no permite creaciones de campos tan f\u00e1cilmente (as\u00ed prevee posibles ataques de inserci\u00f3n de c\u00f3digo en nuestra base de datos). Para ello, adem\u00e1s del c\u00f3digo anterior, modificaremos el modelo User.php que se encuentra en la carpeta app/Models como medida de seguridad: Probamos insertar un usuario en la app: Y vemos que se ha insertado en la base de datos:","title":"crear registros con Eloquent ORM"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#cambiar-el-campo-username-a-unico","text":"Echar para atr\u00e1s la \u00faltima migraci\u00f3n: PHP 1 2 3 php artisan migrate:rollback // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback Hacer cambios en el fichero ...add_username_to_users_table.php : PHP 1 2 3 4 5 //... Schema::table('users', function(Blueprint $table)){ $table->string('username')-> unique() -> after('name'); }); //... Volver a migrar: PHP 1 2 3 php artisan migrate // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate Ahora podemos hacer un cambio en RegisterController.php , que convierte la cadena a una URL (min\u00fascula y los espacios los sustituye por un gui\u00f3n medio): Insertamos un valor en username con may\u00fasculas y espacios: Para que no aparezca un mensaje de error al introducir dos usuarios con el username iguales, lo que podemos hacer es modificar el Request (cuando es nuestra \u00faltima opci\u00f3n):","title":"cambiar el campo 'username' a \u00fanico"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#redireccionar-al-usuario-al-muro-una-vez-la-cuenta-es-creada","text":"Crear un controlador de nombre PostController : Bash 1 sudo docker-compose exec myapp php artisan make:controller PostController Crear un controlador de nombre LoginController : Bash 1 sudo docker-compose exec myapp php artisan make:controller LoginController","title":"redireccionar al usuario al Muro una vez la cuenta es creada"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#autenticar-un-usuario-que-ha-creado-su-cuenta","text":"","title":"autenticar un usuario que ha creado su cuenta"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#anexo-i-instalacion-de-tailwind-css","text":"Si hemos decidido instalar Tailwind CSS para que nos eche una mano con nuestro css, deberemos de seguir estos pasos: Hay que comprobar la versi\u00f3n de npm y node: Bash 1 2 npm -v node -v Si la versi\u00f3n de nodejs es inferior a la versi\u00f3n 14 (a la hora de crear este documento) antes de seguir habremos de reinstalarlo . Para ello habr\u00e1 que ir al anexo II - reinstalaci\u00f3n de node en este mismo documento. no continuar si la versi\u00f3n de node es inferior a 14 . Si nuestra versi\u00f3n de nodejs es correcta (o hemos procedido a reinstalar node en el punto 2), lo primero ser\u00e1 desinstalar bootstrap: Bash 1 npm uninstall bootstrap Instalaremos en desarrollo estas tres dependencias: Bash 1 npm install -D tailwindcss postcss autoprefixer Generamos ahora el fichero tailwindcss.config.js que aparecer\u00e1 en la ra\u00edz del proyecto: Bash 1 npx tailwindcss init -p Editar el fichero del proyecto Laravel tailwindcss.config.js que se ha generado en el directorio ra\u00edz del proyecto y donde indicaremos d\u00f3nde vamos a utilizarlo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 /** @type {import('tailwindcss').Config} */ export default { content: [ \"./resources/**/*.blade.php\", \"./resources/**/*.js\", \"./resources/**/*.vue\", ], theme: { extend: {}, }, plugins: [], } Ahora, en el fichero /resources/css/ app.css agregar las siguientes l\u00edneas: CSS 1 2 3 @ tailwind base ; @ tailwind components ; @ tailwind utilities ; Desde el terminal (y siempre dentro de nuestro proyecto), vamos a ejecutar: Bash 1 2 3 npm run dev # \u00f3, si no funciona: # npm run dev -- --host En el fichero /resources/views/layouts/ app.blade.php hay que indicarle que va a utilizar el fichero /resources/css/ app.css , para ello hay que a\u00f1adirlo en: Text Only 1 @vite('resources/css/app.css') A partir de ahora, y con este ejemplo, podemos observar que se nos muestra el css:","title":"anexo I - instalaci\u00f3n de Tailwind CSS"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#anexo-ii-reinstalacion-de-node","text":"Para reinstalar nodejs: Desinstalar node por completo: Bash 1 sudo apt-get purge --auto-remove nodejs Eliminar todo resto de node y npm: a. Antes que nadas, debe ejecutar el siguiente comando desde el terminal: Bash 1 sudo rm -rf /usr/local/bin/npm /usr/local/share/man/man1/node* /usr/local/lib/dtrace/node.d ~/.npm ~/.node-gyp /opt/local/bin/node opt/local/include/node /opt/local/lib/node_modules Text Only 1 b. Eliminar los directorios node o node_modules de /usr/local/lib con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/lib/node* Text Only 1 c. Eliminar los directorios node o node_modules de /usr/local/include con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/include/node* Text Only 1 d. Eliminar cualquier archivo de nodo o directorio de /usr/local/bin con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/bin/node Instalar otra vez nvm: a. Instalar NvM (Node Version Manager), desde el directorio de usuario ~ : Bash 1 curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash Text Only 1 b. Actualiza el archivo .bashrc: Bash 1 source .bashrc Text Only 1 c. Confirma que el directorio local est\u00e1 configurado: Bash 1 2 echo $NVM_DIR /home/username/.nvm Instalar node: a. Revisar qu\u00e9 versiones de Node.js est\u00e1n disponibles: Bash 1 nvm ls-remote Text Only 1 b. Instalar la versi\u00f3n que desees (elige la v20.10.0): Bash 1 nvm install v20.10.0 Comprobar que la nueva versi\u00f3n de node es superior a 14: Bash 1 node -v","title":"anexo II - reinstalaci\u00f3n de node"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplos","text":"","title":"ejemplos"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-01-hola-mundo","text":"Vamos a eliminar todo el style que viene por defecto y a vaciar de contenido de la etiqueta <body> de la vista resources/views/ wellcome.blade.php y creamos etiquetas: Text Only 1 2 <h1>P\u00e1gina principal</h1> <h2>Hola Mundo.</h2> [volver ^]","title":"ejemplo 01. Hola Mundo"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-02-otras-vistas","text":"Creamos dos ficheros nosotros.blade.php , tienda.blade.php en resources/views : Adem\u00e1s, a\u00f1adimos en el fichero web.php las siguientes rutas: PHP 1 2 3 4 5 Route::get('/nosotros', function () { return view('nosotros'); }); Route::view('/tienda-virtual','tienda'); // forma corta para la ruta a una vista [volver ^]","title":"ejemplo 02. Otras vistas"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-03-paso-de-parametros","text":"En el fichero web.php modifica la ruta a tienda-virtual para que se le pase por par\u00e1metro la variable $id. Pr\u00e9viamente se ha inicializado a un valor; controlar si se ha introducido sin valor y si se ha introducido alg\u00fan valor no num\u00e9rico: PHP 1 2 3 4 5 6 Route::get('tienda/{id?}', function($id = 1) { return view('tienda', ['id' => $id]); }) -> where('id', '[0-9]+'); // otra forma: // Route::view('tienda/{id?}', 'tienda', ['id' => 1]); Despu\u00e9s, mostrar este valor en la vista tienda.blade.php : Text Only 1 2 <h1>tienda virtual</h1> <p>producto con id: <?= $id ?></p> [volver ^]","title":"ejemplo 03. Paso de par\u00e1metros"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-04-uso-de-directivas","text":"C\u00f3mo hacer uso del poder de Laravel para crear plantillas y no repetir c\u00f3digo. Supongamos que tenemos ciertas estructuras HTML repetidas como puede ser una cabecera header , un men\u00fa de navegaci\u00f3n nav y un par de secciones que hacen uso de este mismo c\u00f3digo. Supongamos que tenemos 3 apartados en la web: Inicio | Blog | Fotos Primero de todo tendremos que generar un archivo que haga de plantilla de nuestro sitio web. Para ello creamos el archivo app.blade.php dentro del nuevo directorio de plantillas resources/views/layouts . Dicho archivo va a contener el t\u00edpico c\u00f3digo de una p\u00e1gina simple de HTML y en el body a\u00f1adiremos nuestros contenido est\u00e1tico y din\u00e1mico. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 <!DOCTYPE html> <html lang=\"{{ str_replace('_', '-', app()->getLocale()) }}\"> <head> <meta charset=\"utf-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"> <title>Mi proyecto - @yield('titulo')</title> <!-- introducir la siguiente linea para poder utilizar TailwindCSS --> @vite('resources/css/app.css') </head> <body class=\"bg-gray-100\"> <header class=\"p-5 border-b bg-white shadow\"> <div class=\"container mx-auto flex justify-between items-center\"> <h1 class=\"text-3xl font-black\"> @yield('titulo') </h1> <nav class=\"flex gap-5 items-center\"> <a class=\"font-bold uppercase text-gray-600 text-sm\" href=\"#\">Login</a> <a class=\"font-bold uppercase text-gray-600 text-sm\" href=\"#\">Crear cuenta</a> </nav> </div> </header> <!-- BORRAR M\u00c1S ADELANTE este men\u00fa en el siguiente ejemplo --> <nav class=\"flex gap-5 items-center\"> <a class=\"font-bold uppercase text-gray-600 text-sm\" href={{ route('inicio') }} >inicio</a> | <a class=\"font-bold uppercase text-gray-600 text-sm\" href={{ route('noticias') }} >blogs</a> | <a class=\"font-bold uppercase text-gray-600 text-sm\" href={{ route('galeria') }} >fotos</a> </nav> <!-- CONTENIDO PRINCIPAL --> <main class=\"container mx-auto mt-10\"> <h2 class=\"font-black text-center text-3xl mb-10\"> @yield('titulo') </h2> @yield('contenido') </main> <!-- FOOTER --> <footer class=\"text-center p-5 text-gray-500 font-bold uppercase\"> MiPrimeraWeb - Todos los derechos reservados @php echo date('Y') @endphp <br> <!-- con helpers --> MiPrimeraWeb - Todos los derechos reservados {{ now()->year }} </footer> </body> </html> Cada secci\u00f3n que haga uso de esta plantilla contendr\u00e1 un men\u00fa de navegaci\u00f3n con enlaces a cada una de las secciones y el contenido din\u00e1mico de cada secci\u00f3n. A tener en cuenta: {{ route('inicio') }} muestra: {{ ... }} es una etiqueta para Blade que muestra un echo. route(...) lanza la ruta de nombre (o alias) concreto. @php echo date('Y') @endphp son etiquetas para Blade para contener c\u00f3digo php. En este caso un echo que muestra el a\u00f1o 'Y' de la fecha actual date() . now() es un helper de Laravel (componente del framework dise\u00f1ado para facilitar alguna tarea t\u00edpica en el desarrollo de una aplicaci\u00f3n web). Tiene distintos atributos y m\u00e9todos, entre ellos, year para mostrar el a\u00f1o. Ahora crearemos los archivos din\u00e1micos de cada una de las secciones, en nuestro caso: inicio.blade.php : Importamos el contenido de plantilla bajo la directiva @extends para que cargue los elementos est\u00e1ticos que hemos declarado y con la directiva @section y @endsection definimos el bloque de c\u00f3digo din\u00e1mico, en funci\u00f3n de la secci\u00f3n que estemos visitando. PHP 1 2 3 4 5 6 7 8 9 @extends('layouts.app') @section('titulo') p\u00e1gina principal @endsection @section('contenido') contenido de la p\u00e1gina principal @endsection blog.blade.php : PHP 1 2 3 4 5 6 7 8 9 @extends('layouts.app') @section('titulo') not\u00edcias @endsection @section('contenido') contenido de todas las not\u00edcias @endsection fotos.blade.php : PHP 1 2 3 4 5 6 7 8 9 @extends('layouts.app') @section('titulo') fotograf\u00edas @endsection @section('contenido') galer\u00eda de fotograf\u00edas @endsection El \u00faltimo paso que nos queda es configurar el archivo de rutas routes/web.php : PHP 1 2 3 4 5 <?php // web.php Route :: view ( '' , 'inicio' ) -> name ( 'inicio' ); Route :: view ( 'blog' , 'blog' ) -> name ( 'noticias' ); Route :: view ( 'fotos' , 'fotos' ) -> name ( 'galeria' ); De esta manera podremos hacer uso del men\u00fa de navegaci\u00f3n que hemos puesto en nuestra plantilla y gracias a los alias noticias y galeria, la URL ser\u00e1 m\u00e1s amigable. [volver ^]","title":"ejemplo 04. Uso de directivas"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-05-vista-registrarse","text":"Antes de continuar con el ejemplo, debes modificar ( guarda los modificados ): elimina el men\u00fa de navegaci\u00f3n de inicio | blogs | fotos del fichero layouts/app.blade.php . elimina las rutas en el fichero web.php que afecten a este men\u00fa (exceptuando la ruta de inicio). elimina las dos vistas blog.blade.php y foto.blade.php . Este borrado se debe a que NO vamos a continuar con estas vistas; solo eran un ejemplo de uso de directivas y la separaci\u00f3n de c\u00f3digo. Como has observado, nuestro anterior ejemplo conten\u00eda en el fichero resources/views/layouts/app.php un men\u00fa de navegaci\u00f3n en el que se indicaba Login y Crear cuenta . Crea las vistas para estos dos enlaces. Para ello alojar\u00e1s sus dos vistas en una carpeta nueva resources/views/auth con nombre register.blade.php para Crear cuenta . PHP 1 2 3 4 5 6 7 8 9 @extends('layouts.app') @section('titulo') Reg\u00edstrate en tu APP @endsection @section('contenido') @endsection Modificar en el fichero app.blade.app el men\u00fa de crear cuenta para que se pueda acceder des del enlace a la vista creada anteriormente: Text Only 1 2 3 4 5 6 // ... <nav class=\"flex gap-5 items-center\"> <a class=\"font-bold uppercase text-gray-600 text-sm\" href=\"#\">Login</a> <a class=\"font-bold uppercase text-gray-600 text-sm\" href={{ route('register') }}>Crear cuenta</a> </nav> // .. A\u00f1adir al fichero web.php la entrada: PHP 1 Route::view('/crear-cuenta','auth.register') -> name('register'); //la ruta contiene . [volver ^]","title":"ejemplo 05. Vista registrarse"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-06-pasar-datos-a-una-vista","text":"Crear en web.php un array (de nombre arrayProductos ) con, al menos, 4 \u00edtems: PHP 1 2 3 4 Route::get('listaproductos', function(){ $productos = ['rosa','clavel','orqu\u00eddea','l\u00edrio']; return view('pru1', compact('productos')); }); Para pasar un array a una vista existen varios m\u00e9todos: return view('pru1', ['productos' => $productos]); return view('pru1') -> with ('productos', $productos); return view('pru1', compact('productos')); con la funci\u00f3n de php compact se crea internamente un array con productos. Pasar este array a una vista, de nombre listaproductos.blade.php y mu\u00e9stralos en una tabla: Text Only 1 2 3 4 5 <?php foreach ($productos as $item) { echo \"<li>\".$item.\"</li>\"; } ?> Pero como hemos visto, Laravel tiene unas directivas que funcionan en sus vistas y que se pueden utilizar de forma m\u00e1s elegante: PHP 1 2 3 @foreach ($usuarios as $item) <li>{{ $item }}</li> @endforeach [volver ^]","title":"ejemplo 06. Pasar datos a una vista"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-07-controlador-registercontroller-y-su-formulario","text":"En vez de usar closures (o callbacks ) en el fichero web.php vamos a crear controladores en nuestro ejemplo y trasladar la l\u00f3gica de negocio a estos \u00faltimos. As\u00ed, y siguiendo con los ejemplos anteriores, vamos a crear un controlador para gestionar el registro en nuestra APP (vamos a ordenar nuestros ficheros y colocaremos RegisterConroller dentro de la carpeta Auth y a\u00f1adimos doble diagonal inversa \\\\ ). Abrimos el CLI artisan (nuevo terminal en VS Code o Ctrl +`) en la carpeta de nuestro proyecto y ejecutamos: Bash 1 2 3 php artisan make:controller Auth \\\\ RegisterController # \u00f3, si no fuciona: # sudo docker-compose exec myapp php artisan make:controller Auth\\\\RegisterController En web.php modificar la ruta de Crear cuenta (quitar el callback y a\u00f1adir el controlador y su m\u00e9todo). Se recomienda como convenci\u00f3n el nombre del m\u00e9todo index : PHP 1 2 3 4 // ... use App\\Http\\Controllers\\Auth\\RegisterController; // ... Route::get('/register', [RegisterController::class, 'index']) -> name('register'); Y en RegisterController.php , trasladamos la l\u00f3gica de negocio que ejecutaba el callback , a\u00f1adiendo la palabra reservada public y a\u00f1adiendo tambi\u00e9n un nombre a esta funci\u00f3n index() : PHP 1 2 3 public function index() { return view('auth.register'); } Para la vista de register register.blade.php vamos a introducir el c\u00f3digo: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 @extends('layouts.app') @section('titulo') Reg\u00edstrate en la APP @endsection @section('contenido') <div class=\"md:flex md:justify-center md:gap-10 md:items-center\"> <div class=\"md:w-6/12 p-5\"> <img src=\"{{asset('images/dwes_registrar.png')}}\" alt=\"imagen registro usuario\"> </div> <div class=\"md:w-4/12 bg-white p-6 rounded-lg shadow-xl\"> <!-- todav\u00eda no existe ni m\u00e9todo ni enlace en el form --> <form action=\"\"> <div> <label for=\"name\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Nombre </label> <input id=\"name\" name=\"name\" type=\"text\" placeholder=\"tu nombre\" class=\"border p-3 w-full rounded-lg\" /> </div> <div> <label for=\"username\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Nombre </label> <input id=\"username\" name=\"username\" type=\"text\" placeholder=\"tu nombre de usuario\" class=\"border p-3 w-full rounded-lg\" /> </div> <div> <label for=\"email\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Email </label> <input id=\"email\" name=\"email\" type=\"text\" placeholder=\"tu email de registro\" class=\"border p-3 w-full rounded-lg\" /> </div> <div> <label for=\"password\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Password </label> <input id=\"password\" name=\"password\" type=\"password\" placeholder=\"tu contrase\u00f1a de registro\" class=\"border p-3 w-full rounded-lg\" /> </div> <div> <label for=\"password_confirmation\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Repetir password </label> <!-- password_confirmation para validar posteriormente password --> <input id=\"password_confirmation\" name=\"password_confirmation\" type=\"password\" placeholder=\"repite la contrase\u00f1a\" class=\"border p-3 w-full rounded-lg\" /> </div> <br> <input type=\"submit\" value=\"Crear cuenta\" class=\"bg-sky-600 hover:bg-sky-700 transition-colors cursor-pointer uppercase font-bold w-full p-3 text-white rounded-lg\" /> </form> </div> @endsection A tener en cuenta: En {{asset('images/dwes_registrar.png')}} : {{ }} hace referencia a un echo. asset() hace referencia a la ruta app/public de Laravel. El input password_confirmation del formulario tiene este nombre de forma ' obligatoria '; es decir, el prefijo _confirmation har\u00e1 que Laravel, internamente, compruebe que el input de nombre password y el input de nombre password_confirmation contengan la misma cadena. [volver ^]","title":"ejemplo 07. Controlador RegisterController y su formulario"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-08-peticion-post","text":"Vamos a crear ahora el enlace registrarse. Para ello accedemos a web.php e introducimos la linea con el m\u00e9todo POST: PHP 1 2 Route::get('/register', [RegisterController::class, 'index']) -> name('register'); Route::post('/register', [RegisterController::class, 'store']); A tener en cuenta No ponemos un alias en la segunda ruta porque va a tomar tambi\u00e9n el alias del anterior ruta. Al mismo tiempo, en nuestro controlador RegisterController.php agregamos la funci\u00f3n store : PHP 1 2 3 public function store() { dd('formulario...'); } La funci\u00f3n dd ( dump or die ) en Laravel permite parar la ejecuci\u00f3n en ese punto. Es decir, parecida a la funci\u00f3n dump() pero finaliza la ejecuci\u00f3n del script. Para terminar este punto, en la vista register.blade.php vamos a modificar la etiqueta form para que redireccione al action correspondiente con el m\u00e9todo en q\u00fcesti\u00f3n. F\u00edjate que en action ponemos la funci\u00f3n route y el nombre de la ruta: PHP 1 2 3 ... <form action=\"{{ route('register') }}\" method=\"POST\"> ...","title":"ejemplo 08. Petici\u00f3n post"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#problema-a-la-vista","text":"Si recargamos la p\u00e1gina y clicamos en el enlace vemos que nos muestra el siguiente error: \u00bfPor qu\u00e9 una p\u00e1gina expirada? Laravel es un framework enfocado a la seguridad (en este caso, se asegura que no suframos ataques del tipo XSRF o Cross Site Request Forgery). As\u00ed que Laravel tiene consideraciones de seguridad. Para evitar estos ataques usaremos la directiva @csrf justo despu\u00e9s de la linea de la etiqueta <form> . Text Only 1 2 3 4 ... <form action=\"{{ route('register') }}\" method=\"POST\"> @csrf ... Si pulsamos F12 para ver el c\u00f3digo en el navegador se mostrar\u00e1 un campo oculto con un token oculto para validar la cadena y evitar este tipo de ataques: Modificamos la funci\u00f3n store para pasarle el objeto $request : PHP 1 2 3 4 public function store(Request $request) { dd(request); // dd(request->get('email')); } Si accedemos a la ruta localhost/register se observa la informaci\u00f3n del array $request : [volver ^]","title":"problema a la \"vista\"!!"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-09-validacion-de-campos","text":"Para validar los campos del formulario del controlador RegisterController.php podemos utilizar las reglas de validaci\u00f3n siguientes; \u00e9stas se colocar\u00e1n en la funci\u00f3n store del controlador: PHP 1 2 3 4 5 6 7 8 9 10 11 public function store(Request $request) { //dd($request); //dd($request->get('email')); //validaci\u00f3n $this->validate($request, [ 'name' => ['required', 'min:5'], 'username' => ['required', 'unique:users', 'min:3', 'max:20'], 'email' => ['required', 'unique:users','email','max:60'], 'password' => ['required','confirmed','min:6'] ]); por qu\u00e9 en unique se refiere a una tabla users que todav\u00eda no la hemos creado? M\u00e1s adelante lo veremos, pero se puede obersar en la carpeta database/migrations que tenemos una migraci\u00f3n de la tabla users . Laravel crea autom\u00e1ticamente estas tablas. Podemos observar que, en apariencia, no hace nada (o no muestra nada). Es decir, para mostrar un mensaje de error cuando no se cumpla una validaci\u00f3n colocaremos la directiva @error ... @enderrror en nuestro formulario (en el ejemplo register.blade.php ) justo despu\u00e9s del <input> en cuesti\u00f3n. Siguiendo en el ejemplo: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 <input id=\"name\" name=\"name\" type=\"text\" placeholder=\"tu nombre\" class=\"border p-3 w-full rounded-lg\" > @error('name') <p class=\"bg-red-500 text-white my-2 rounded-lg text-sm p-2 text-center\"> el nombre es obligatorio </p> @enderror [volver ^]","title":"ejemplo 09. Validaci\u00f3n de campos"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-10-mensajes-de-errores-dinamicos","text":"Como se ha comentado, la mejor opci\u00f3n de mostrar un mensaje de error en Laravel es de forma din\u00e1mica mediante $message : En el ejemplo anterior, modificar\u00edamos el contenido de la directiva @error . Text Only 1 2 3 4 5 @error('username') <p class=\"bg-red-500 text-white my-2 rounded-lg text-sm p-2 text-center\"> {{ $message }} </p> @enderror A tener en cuenta: El p\u00e1rrafo se ha modificado para tener texto blanco sobre fondo rojo. Si, adem\u00e1s, queremos pintar de color rojo el campo en el que aparece el error, podemos poner en la clase del input un @error que diga que si existe un error en (por ejemplo) el campo username coloree el borde del campo en rojo: PHP 1 2 3 4 5 6 7 8 <input id=\"username\" name=\"username\" type=\"text\" placeholder=\"tu nombre de usuario\" class=\"border p-3 w-full rounded-lg @error('username') border-red-500 @enderror\" > [volver ^]","title":"ejemplo 10. Mensajes de errores din\u00e1micos"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-11-mantener-valor-despues-de-un-error","text":"Para 'guardar' del valor de un campo si volvemos al formulario en el atributo value del input colocaremos {{ old('username') }} . En el ejemplo de username : Text Only 1 2 3 4 5 6 7 8 9 <input id=\"username\" name=\"username\" type=\"text\" placeholder=\"tu nombre de usuario\" class=\"border p-3 w-full rounded-lg @error('username') border-red-500 @enderror\" value= \"{{ old('username') }}\" > Entre las validaciones de Laravel tambi\u00e9n podr\u00e1 verse la validaci\u00f3n de HTML5. Si quieres deshabilitar esta \u00faltima puedes introducir el atributo novalidate en la etiqueta <form ... novalidate> . A partir de ahora, como tarea, puedes validar t\u00fa mismo todos los campos del formulario. [volver ^]","title":"ejemplo 11. Mantener valor despu\u00e9s de un error"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-12-confirmar-valor-del-password","text":"En el ejemplo, poner en el Blade que lleva el formulario: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 <div> <label for=\"password_confirmation\" class=\"mb-2 block uppercase text-gray-500 font-bold\"> Repetir password </label> <input id=\"password_confirmation\" name=\"password_confirmation\" type=\"password\" placeholder=\"repite la contrase\u00f1a\" class=\"border p-3 w-full rounded-lg\" /> </div> Despu\u00e9s, en el controlador en cuesti\u00f3n ( RegisterController.php ), poner la validaci\u00f3n confirmed (ya se hab\u00eda introducido en anteriores ejemplos): PHP 1 2 3 4 5 6 7 8 //... $this->validate($request, [ 'name' => ['required', 'min:5'], 'username' => ['required', 'unique:users', 'min:3', 'max:20'], 'email' => ['required', 'unique:users','email','max:60'], 'password' => ['required','confirmed','min:6'] ]); //... [volver ^]","title":"ejemplo 12. Confirmar valor del password"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#ejemplo-13-crear-usuario-en-la-app","text":"Como vemos, si intentamos crear un usuario en nuestro ejemplo de inserci\u00f3n de usuarios, se obtiene un error en el que nos indica que falta el campo username en la tabla users . Esto es debido a que, cuando se ha ejecutado, por primera vez, la migraci\u00f3n este campo no exist\u00eda. Para que la app funcione deberemos de migrar este campo. Ejecutamos (el nombre lleva una convenci\u00f3n de Laravel): Bash 1 2 3 php artisan make:migration add_username_to_users_table # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan make:migration add_username_to_users_table Si accedemos al fichero generado en la carpeta migrations insertaremos el c\u00f3digo que se muestra a continuaci\u00f3n: PHP 1 2 3 4 5 //... Schema::table('users', function(Blueprint $table)){ $table->string('username')-> unique() -> after('name'); }); //... Para que los cambios surjan efecto, volvemos a ejecutar migrate : PHP 1 2 3 php artisan migrate # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan migrate Aunque se indique el campo username como string se crear\u00e1 en la base de datos como varchar . Siguiendo el ejemplo anterior ahora no nos dar\u00e1 error la inserci\u00f3n en el formulario. [volver ^]","title":"ejemplo 13. Crear usuario en la app"},{"location":"ud07/ud07_FrameworksPHP-Laravel/#referencias","text":"Tutorial de Composer Web Scraping with PHP \u2013 How to Crawl Web Pages Using Open Source Tools PHP Monolog Unit Testing con PHPUnit \u2014 Parte 1, de Emiliano Zublena.","title":"referencias"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/","text":"unit: unidad did\u00e1ctica 7 title: actividades language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets ejercicio 1. mostrar tabla crear controlador y modelo crear tabla crear seeder crear ruta crear vista ejercicio 2. insertar registro crear formulario crear p\u00e1gina crear ruta post A tener en cuenta : Dado que crearemos distintos elementos del framework Laravel desde Artisan con usuario root deberemos de tener en cuenta que, una vez creado dicho elemento, cambiar el usuario:grupo de ese fichero. Para acelerar esta tarea, desde la carpeta de Laravel: Bash 1 sudo chown tuUsuario:tuGrupo -R tuProyecto Si, al intentar ejecutar la migraci\u00f3n o un seeder el navegador muestra un error de permisos de acceso a la base de datos, deberemos de realizar tres tareas: a) Acceder al fichero .env de tu proyecto laravel y configurar el nombre de base de datos, usuario y contrase\u00f1a: PHP 1 2 3 4 5 6 DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=dwes DB_USERNAME=dwes DB_PASSWORD=dwes b) Acceder a la base de datos (por ejemplo, mediante phpMyAdmin) y poner permisos al usuario en la base de datos del punto a . c) Si todav\u00eda persisten los errores de permisos, ejecutar desde Artisan: PHP 1 2 3 sudo docker-compose exec myapp php artisan cache:clear sudo docker-compose exec myapp php artisan config:clear sudo docker-compose exec myapp php artisan config:cache ejercicio 1. mostrar tabla Sobre el proyecto de la sesi\u00f3n anterior, vamos a crear una p\u00e1gina (vista) en la que se muestre el contenido de una tabla.a a\u00f1adir un formulario (parecido) al que hemos estado creando (registro) pero que muestre (por ejemplo) un producto (como por ejemplo libros): crear controlador y modelo Crear un controlador para la tabla libros . Para esto, recuerda: crear un controlador: PHP 1 sudo docker-compose exec myapp php artisan make:controller LibroController --model=Libro Este comando generar\u00e1, a la vez, un controlador y su modelo relacionado. database/migrations . Esto crear\u00e1 el controlador en la carpeta App\\Http\\Controllers y el modelo en la carpeta App\\Models . Si queremos mostrar todas las filas de la tabla libros creamos el siguiente m\u00e9todo en el controlador anteriormente generado: PHP 1 2 3 4 5 6 7 8 public function mostrarTodos() { // Obtener todas las filas de la tabla \"libro\" $libros = Libro::all(); // Pasar los datos a la vista return view('libros.mostrar', ['libros' => $libros]); } En dicho m\u00e9todo se aprecia que guarda en la variable $libros todos los libros de la tabla libros. A continuaci\u00f3n, lanza una vista de nombre mostrar.blade.php almacenada en la carpeta resources/views/libros en la que pasa por par\u00e1metro la variable $libros anteriormente creada. Por otro lado, en el modelo debemos insertar en la clase Libro : PHP 1 protected $table = 'libros'; crear tabla Crea una tabla libros en tu base de datos. Para esto, recuerda: crear una migraci\u00f3n para crear la tabla libros: PHP 1 sudo docker-compose exec myapp php artisan make:migration create_libros_table Este comando generar\u00e1 un nuevo archivo de migraci\u00f3n en el directorio database/migrations . abre el archivo de migraci\u00f3n reci\u00e9n creado. Puedes encontrarlo en el directorio database/migrations y tendr\u00e1 un nombre similar a 2024_01_01_000000_create_libros_table.php (la fecha y la hora pueden variar). dentro del archivo de migraci\u00f3n, encontrar\u00e1s dos m\u00e9todos: up y down . En el m\u00e9todo up , define la estructura de la tabla \"libro\". Puedes hacerlo utilizando la sintaxis del constructor de esquemas de Laravel. Aqu\u00ed hay un ejemplo b\u00e1sico: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use Illuminate\\Database\\Migrations\\Migration; use Illuminate\\Database\\Schema\\Blueprint; use Illuminate\\Support\\Facades\\Schema; class CreateLibroTable extends Migration { public function up() { Schema::create('libros', function (Blueprint $table) { $table->id(); $table->string('titulo'); $table->text('descripcion')->nullable(); // Agrega m\u00e1s columnas seg\u00fan sea necesario para tu aplicaci\u00f3n $table->decimal('precio', 8, 2); $table->timestamps(); }); } public function down() { Schema::dropIfExists('libros'); } } En este ejemplo, la tabla libros tiene una columna de ID, un t\u00edtulo, una descripci\u00f3n, un precio (que hemos a\u00f1adido nosotros pues podemos personalizar la estructura de la tabla seg\u00fan nuestras necesidades) y las marcas de tiempo ( created_at y updated_at ). Despu\u00e9s de definir la estructura de la tabla, ejecuta las migraciones con el siguiente comando: PHP 1 sudo docker-compose exec myapp php artisan migrate Este comando aplicar\u00e1 la migraci\u00f3n y crear\u00e1 la tabla \"libro\" en tu base de datos. crear seeder Crea un seeder para introducir informaci\u00f3n: PHP 1 sudo docker-compose exec myapp php artisan make:seeder LibroSeeder \u200b Este comando generar\u00e1 un nuevo archivo de seeder en el directorio database/seeders . abre el archivo de seeder reci\u00e9n creado. Puedes encontrarlo en el directorio database/seeders y tendr\u00e1 un nombre similar a LibroSeeder.php . Dentro del archivo de seeder, dentro del m\u00e9todo run , puedes utilizar el modelo Libro para insertar datos en la tabla. Aseg\u00farate de tener el modelo Libro creado en tu aplicaci\u00f3n. Aqu\u00ed tienes un ejemplo b\u00e1sico: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 use Illuminate\\Database\\Seeder; use App\\Models\\Libro; class LibroSeeder extends Seeder { public function run() { // Ejemplo de inserci\u00f3n de datos en la tabla \"libro\" Libro::create([ 'titulo' => 'Libro 1', 'descripcion' => 'Descripci\u00f3n del Libro 1', 'precio' => 15.99, ]); Libro::create([ 'titulo' => 'Libro 2', 'descripcion' => 'Descripci\u00f3n del Libro 2', 'precio' => 21.50, ]); // ************************************ // AGREGA M\u00c1S LIBROS (POR LO MENOS 5) // ************************************ } } ejecutar el seeder y insertar los datos en la tabla, utiliza el siguiente comando: PHP 1 sudo docker-compose exec myapp php artisan db:seed --class=LibroSeeder \u200b Esto ejecutar\u00e1 el seeder que acabas de crear y agregar\u00eda los datos a la tabla \"libro\". Recuerda que, adem\u00e1s de ejecutar un seeder espec\u00edfico, tambi\u00e9n puedes utilizar el comando php artisan db:seed sin especificar un seeder en particular para ejecutar todos los seeders definidos en tu aplicaci\u00f3n. crear ruta Crear una ruta para acceder a dicho formulario de inserci\u00f3n de libros (productos). Para ello, recuerda introducir en el fichero web.php de la carpeta routes la ruta para lanzar el controlador-mostrarTodos (y, si no se introduce de forma autom\u00e1tica, poner tambi\u00e9n el use que apunte a dicho controlador). PHP 1 Route::get('/libros', [LibroController::class, 'mostrarTodos']) -> name('libros'); crear vista Crear la vista resources/views/libros/mostrar.blade.php e introducir el c\u00f3digo para recorrer la variable $libros que se pasa desde el m\u00e9todo mostrarTodos del controlador LibroController mediante una tabla html. Para esto, recuerda, utilizar la directiva @foreach ... @foreach y acceder a cada campo mediante $libro->id (por ejemplo). Crea en tu p\u00e1gina principal (del ejemplo seguido durante esta unidad) un enlace a dicha ruta para probar el ejercicio (tambi\u00e9n lo podr\u00e1s probar a\u00f1adiendo a la URL de la aplicaci\u00f3n /mostrar-libros ). ejercicio 2. insertar registro Crear una p\u00e1gina (vista) en la que se inserte un registro de la tabla libros. Un formulario (parecido) al que hemos estado creando (registro) pero que muestre un libro: Recuerda poner en el m\u00e9todo store en el controlador: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public function store(Request $request) { // validaciones sobre los campos del formulario $this->validate($request, [ 'titulo' => ['required', 'unique:libros'], 'precio' => ['required', 'numeric', 'min: 0','max:10000', 'regex:/^\\d+(\\.\\d{1,2})?$/'] ]); // inserci\u00f3n en la tabla libros (modelo Libro) Libro::create([ 'titulo' => $request->titulo, 'descripcion' => $request->descripcion, 'precio' => $request->precio ]); // redireccionar hacia mostrarDatos return redirect() -> route('libros'); } \u200b Sobre la validaci\u00f3n de campos del formulario: 'max:10000' para establecer un valor m\u00e1ximo permitido. 'regex:/^\\d+(\\.\\d{1,2})?$/' para permitir decimales con hasta dos lugares decimales. \u200b Sobre la inserci\u00f3n del registro completo en la tabla libros: Insert en Laravel es el m\u00e9todo create() sobre el modelo en cuesti\u00f3n (en este caso Libro). Recoge los campos del array $request y los guarda en cada atributo de la tabla libros. Los campos autoincrementables id , created_at y update_at no se hacen referencia. \u200b Sobre la inserci\u00f3n del registro completo en la tabla libros: Despu\u00e9s de validar e insertar en la tabla (por ese orden) se redireccionar\u00e1 a la ruta de nombre libros (que si nos fijamos en el fichero web.php hace referencia a mostrar.blade.php ). Por otro lado, en el modelo debemos insertar en la clase Libro : PHP 1 2 3 4 5 protected $fillable = [ 'titulo', 'descripcion', 'precio', ]; En Laravel, el atributo protected $fillable se utiliza para especificar qu\u00e9 campos de una tabla de base de datos pueden ser asignados masivamente. Cuando se realiza una operaci\u00f3n de asignaci\u00f3n masiva, como al crear un nuevo modelo utilizando el m\u00e9todo create o al actualizar un modelo mediante el m\u00e9todo update , Laravel utiliza el conjunto de campos especificados en $fillable para determinar qu\u00e9 datos se deben incluir en la operaci\u00f3n. En este caso, al crear o actualizar un usuario, solo los campos titulo , descripcion y precio ser\u00e1n aceptados en una asignaci\u00f3n masiva. Si intentas asignar otros campos no especificados en $fillable , Laravel lanzar\u00e1 una excepci\u00f3n MassAssignmentException para proteger contra la asignaci\u00f3n masiva no autorizada. Este enfoque ayuda a mejorar la seguridad al limitar qu\u00e9 campos pueden ser modificados de manera masiva, evitando posibles ataques de asignaci\u00f3n masiva no autorizada. Es una pr\u00e1ctica recomendada utilizar $fillable para definir expl\u00edcitamente los campos que pueden ser asignados masivamente en lugar de permitir la asignaci\u00f3n masiva de todos los campos con $guarded . crear formulario Puedes ayudarte en el ejemplo de la teor\u00eda Register . Recuerda: poner la directiva @csrf justo despu\u00e9s de la etiqueta <form> . recoger los errores mediante @error {{ $message }} @enderror . crear p\u00e1gina Como anteriormente, en el controlador, le hemos indicado que redirecciona a App\\resources\\views\\libros\\mostrar.blade.php crear ruta post En web.php : PHP 1 Route::post('/libros', [LibroController::class, 'store']) -> name('libros'); \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir tu proyecto laravel con los cambios incorporados, y eliminando las carpetas vendor y node_modules . Renombra el archivo comprimido a proyecto_07.zip .","title":"ud07 FrameworksPHP Laravel actividades"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/#ejercicio-1-mostrar-tabla","text":"Sobre el proyecto de la sesi\u00f3n anterior, vamos a crear una p\u00e1gina (vista) en la que se muestre el contenido de una tabla.a a\u00f1adir un formulario (parecido) al que hemos estado creando (registro) pero que muestre (por ejemplo) un producto (como por ejemplo libros):","title":"ejercicio 1. mostrar tabla"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/#crear-controlador-y-modelo","text":"Crear un controlador para la tabla libros . Para esto, recuerda: crear un controlador: PHP 1 sudo docker-compose exec myapp php artisan make:controller LibroController --model=Libro Este comando generar\u00e1, a la vez, un controlador y su modelo relacionado. database/migrations . Esto crear\u00e1 el controlador en la carpeta App\\Http\\Controllers y el modelo en la carpeta App\\Models . Si queremos mostrar todas las filas de la tabla libros creamos el siguiente m\u00e9todo en el controlador anteriormente generado: PHP 1 2 3 4 5 6 7 8 public function mostrarTodos() { // Obtener todas las filas de la tabla \"libro\" $libros = Libro::all(); // Pasar los datos a la vista return view('libros.mostrar', ['libros' => $libros]); } En dicho m\u00e9todo se aprecia que guarda en la variable $libros todos los libros de la tabla libros. A continuaci\u00f3n, lanza una vista de nombre mostrar.blade.php almacenada en la carpeta resources/views/libros en la que pasa por par\u00e1metro la variable $libros anteriormente creada. Por otro lado, en el modelo debemos insertar en la clase Libro : PHP 1 protected $table = 'libros';","title":"crear controlador y modelo"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/#crear-tabla","text":"Crea una tabla libros en tu base de datos. Para esto, recuerda: crear una migraci\u00f3n para crear la tabla libros: PHP 1 sudo docker-compose exec myapp php artisan make:migration create_libros_table Este comando generar\u00e1 un nuevo archivo de migraci\u00f3n en el directorio database/migrations . abre el archivo de migraci\u00f3n reci\u00e9n creado. Puedes encontrarlo en el directorio database/migrations y tendr\u00e1 un nombre similar a 2024_01_01_000000_create_libros_table.php (la fecha y la hora pueden variar). dentro del archivo de migraci\u00f3n, encontrar\u00e1s dos m\u00e9todos: up y down . En el m\u00e9todo up , define la estructura de la tabla \"libro\". Puedes hacerlo utilizando la sintaxis del constructor de esquemas de Laravel. Aqu\u00ed hay un ejemplo b\u00e1sico: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 use Illuminate\\Database\\Migrations\\Migration; use Illuminate\\Database\\Schema\\Blueprint; use Illuminate\\Support\\Facades\\Schema; class CreateLibroTable extends Migration { public function up() { Schema::create('libros', function (Blueprint $table) { $table->id(); $table->string('titulo'); $table->text('descripcion')->nullable(); // Agrega m\u00e1s columnas seg\u00fan sea necesario para tu aplicaci\u00f3n $table->decimal('precio', 8, 2); $table->timestamps(); }); } public function down() { Schema::dropIfExists('libros'); } } En este ejemplo, la tabla libros tiene una columna de ID, un t\u00edtulo, una descripci\u00f3n, un precio (que hemos a\u00f1adido nosotros pues podemos personalizar la estructura de la tabla seg\u00fan nuestras necesidades) y las marcas de tiempo ( created_at y updated_at ). Despu\u00e9s de definir la estructura de la tabla, ejecuta las migraciones con el siguiente comando: PHP 1 sudo docker-compose exec myapp php artisan migrate Este comando aplicar\u00e1 la migraci\u00f3n y crear\u00e1 la tabla \"libro\" en tu base de datos.","title":"crear tabla"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/#crear-seeder","text":"Crea un seeder para introducir informaci\u00f3n: PHP 1 sudo docker-compose exec myapp php artisan make:seeder LibroSeeder \u200b Este comando generar\u00e1 un nuevo archivo de seeder en el directorio database/seeders . abre el archivo de seeder reci\u00e9n creado. Puedes encontrarlo en el directorio database/seeders y tendr\u00e1 un nombre similar a LibroSeeder.php . Dentro del archivo de seeder, dentro del m\u00e9todo run , puedes utilizar el modelo Libro para insertar datos en la tabla. Aseg\u00farate de tener el modelo Libro creado en tu aplicaci\u00f3n. Aqu\u00ed tienes un ejemplo b\u00e1sico: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 use Illuminate\\Database\\Seeder; use App\\Models\\Libro; class LibroSeeder extends Seeder { public function run() { // Ejemplo de inserci\u00f3n de datos en la tabla \"libro\" Libro::create([ 'titulo' => 'Libro 1', 'descripcion' => 'Descripci\u00f3n del Libro 1', 'precio' => 15.99, ]); Libro::create([ 'titulo' => 'Libro 2', 'descripcion' => 'Descripci\u00f3n del Libro 2', 'precio' => 21.50, ]); // ************************************ // AGREGA M\u00c1S LIBROS (POR LO MENOS 5) // ************************************ } } ejecutar el seeder y insertar los datos en la tabla, utiliza el siguiente comando: PHP 1 sudo docker-compose exec myapp php artisan db:seed --class=LibroSeeder \u200b Esto ejecutar\u00e1 el seeder que acabas de crear y agregar\u00eda los datos a la tabla \"libro\". Recuerda que, adem\u00e1s de ejecutar un seeder espec\u00edfico, tambi\u00e9n puedes utilizar el comando php artisan db:seed sin especificar un seeder en particular para ejecutar todos los seeders definidos en tu aplicaci\u00f3n.","title":"crear seeder"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/#crear-ruta","text":"Crear una ruta para acceder a dicho formulario de inserci\u00f3n de libros (productos). Para ello, recuerda introducir en el fichero web.php de la carpeta routes la ruta para lanzar el controlador-mostrarTodos (y, si no se introduce de forma autom\u00e1tica, poner tambi\u00e9n el use que apunte a dicho controlador). PHP 1 Route::get('/libros', [LibroController::class, 'mostrarTodos']) -> name('libros');","title":"crear ruta"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/#crear-vista","text":"Crear la vista resources/views/libros/mostrar.blade.php e introducir el c\u00f3digo para recorrer la variable $libros que se pasa desde el m\u00e9todo mostrarTodos del controlador LibroController mediante una tabla html. Para esto, recuerda, utilizar la directiva @foreach ... @foreach y acceder a cada campo mediante $libro->id (por ejemplo). Crea en tu p\u00e1gina principal (del ejemplo seguido durante esta unidad) un enlace a dicha ruta para probar el ejercicio (tambi\u00e9n lo podr\u00e1s probar a\u00f1adiendo a la URL de la aplicaci\u00f3n /mostrar-libros ).","title":"crear vista"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/#ejercicio-2-insertar-registro","text":"Crear una p\u00e1gina (vista) en la que se inserte un registro de la tabla libros. Un formulario (parecido) al que hemos estado creando (registro) pero que muestre un libro: Recuerda poner en el m\u00e9todo store en el controlador: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public function store(Request $request) { // validaciones sobre los campos del formulario $this->validate($request, [ 'titulo' => ['required', 'unique:libros'], 'precio' => ['required', 'numeric', 'min: 0','max:10000', 'regex:/^\\d+(\\.\\d{1,2})?$/'] ]); // inserci\u00f3n en la tabla libros (modelo Libro) Libro::create([ 'titulo' => $request->titulo, 'descripcion' => $request->descripcion, 'precio' => $request->precio ]); // redireccionar hacia mostrarDatos return redirect() -> route('libros'); } \u200b Sobre la validaci\u00f3n de campos del formulario: 'max:10000' para establecer un valor m\u00e1ximo permitido. 'regex:/^\\d+(\\.\\d{1,2})?$/' para permitir decimales con hasta dos lugares decimales. \u200b Sobre la inserci\u00f3n del registro completo en la tabla libros: Insert en Laravel es el m\u00e9todo create() sobre el modelo en cuesti\u00f3n (en este caso Libro). Recoge los campos del array $request y los guarda en cada atributo de la tabla libros. Los campos autoincrementables id , created_at y update_at no se hacen referencia. \u200b Sobre la inserci\u00f3n del registro completo en la tabla libros: Despu\u00e9s de validar e insertar en la tabla (por ese orden) se redireccionar\u00e1 a la ruta de nombre libros (que si nos fijamos en el fichero web.php hace referencia a mostrar.blade.php ). Por otro lado, en el modelo debemos insertar en la clase Libro : PHP 1 2 3 4 5 protected $fillable = [ 'titulo', 'descripcion', 'precio', ]; En Laravel, el atributo protected $fillable se utiliza para especificar qu\u00e9 campos de una tabla de base de datos pueden ser asignados masivamente. Cuando se realiza una operaci\u00f3n de asignaci\u00f3n masiva, como al crear un nuevo modelo utilizando el m\u00e9todo create o al actualizar un modelo mediante el m\u00e9todo update , Laravel utiliza el conjunto de campos especificados en $fillable para determinar qu\u00e9 datos se deben incluir en la operaci\u00f3n. En este caso, al crear o actualizar un usuario, solo los campos titulo , descripcion y precio ser\u00e1n aceptados en una asignaci\u00f3n masiva. Si intentas asignar otros campos no especificados en $fillable , Laravel lanzar\u00e1 una excepci\u00f3n MassAssignmentException para proteger contra la asignaci\u00f3n masiva no autorizada. Este enfoque ayuda a mejorar la seguridad al limitar qu\u00e9 campos pueden ser modificados de manera masiva, evitando posibles ataques de asignaci\u00f3n masiva no autorizada. Es una pr\u00e1ctica recomendada utilizar $fillable para definir expl\u00edcitamente los campos que pueden ser asignados masivamente en lugar de permitir la asignaci\u00f3n masiva de todos los campos con $guarded .","title":"ejercicio 2. insertar registro"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/#crear-formulario","text":"Puedes ayudarte en el ejemplo de la teor\u00eda Register . Recuerda: poner la directiva @csrf justo despu\u00e9s de la etiqueta <form> . recoger los errores mediante @error {{ $message }} @enderror .","title":"crear formulario"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/#crear-pagina","text":"Como anteriormente, en el controlador, le hemos indicado que redirecciona a App\\resources\\views\\libros\\mostrar.blade.php","title":"crear p\u00e1gina"},{"location":"ud07/ud07_FrameworksPHP-Laravel_actividades/#crear-ruta-post","text":"En web.php : PHP 1 Route::post('/libros', [LibroController::class, 'store']) -> name('libros'); \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir tu proyecto laravel con los cambios incorporados, y eliminando las carpetas vendor y node_modules . Renombra el archivo comprimido a proyecto_07.zip .","title":"crear ruta post"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/","text":"unit: unidad did\u00e1ctica 7 title: API RESTful en Laravel language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel, API, RESTful] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets qu\u00e9 es API qu\u00e9 es REST ejemplo API Rest en tabla productos crear tabla productos crear controlador ProductoController c\u00f3mo funciona la API REST listar todos los productos listar un producto en concreto introducir producto nuevo actualizar un producto existente eliminar un producto qu\u00e9 es API Una API ( Application Programming Interface ) es un conjunto de funciones y procedimientos por los cuales, una aplicaci\u00f3n externa accede a los datos, a modo de biblioteca como una capa de abstracci\u00f3n y la API se encarga de enviar el dato solicitado. Una de las caracter\u00edsticas fundamentales de las API es que son Sateless , lo que quiere decir que las peticiones se hacen y desaparecen, no hay usuarios logueados ni datos que se quedan almacenados. Ejemplos de APIs gratuitas: ChuckNorris IO OMDB PokeAPI - Pokemon RAWg - Videojuegos The Star Wars API Para hacer pruebas con estas APIs podemos implementar el c\u00f3digo para consumirlas o utilizar un cliente especial para el consumo de estos servicios. PostMan Thunder Client (utilizaremos esta extensi\u00f3n de VS Code para nuestras comprobaciones). Insomnia Advance REST Client (desde el navegador) Para mostrar en el navegador el c\u00f3digo JSON con un formato m\u00e1s legible tambi\u00e9n podremos instalar, en el navegador que utilices, la extensi\u00f3n para tal efecto: JSON formatter , en Google Chrome. JSON formatter , en Mozilla Firefox. qu\u00e9 es REST Con esta metodolog\u00eda llamada REST vamos a poder construir APIs para que desde un cliente externo se puedan consumir. Gracias a este standard de la arquitectura del software vamos a poder montar un API que utilice los m\u00e9todos standard GET , POST , PUT y DELETE . ejemplo API Rest en tabla productos crear tabla productos Antes de crear nuestra API en tabla Productos deberemos tener dicha tabla migrada en nuestro sistema. Para ello: Crear migraci\u00f3n para la tabla productos : Recuerda que el nombre de la migraci\u00f3n contiene palabras reservadas para como son create y table . PHP 1 2 3 php artisan make:migration create_productos_table # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan make:migration create_productos_table A\u00f1adir al fichero generado (en la carpeta migrations y en el ejemplo anterior 2024_01_08_102832_create_productos_table.php ) el resto de campos que se requieran en la tabla productos : PHP 1 2 3 4 5 6 7 8 9 10 public function up(): void { Schema::create('productos', function (Blueprint $table) { $table->id(); $table->string('nombre'); $table->text('descripcion'); $table->decimal('precio', 8, 2); $table->timestamps(); }); } Ejecutar migraci\u00f3n: PHP 1 2 3 php artisan migrate # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan migrate Crear un seeder para realizar una carga de datos: PHP 1 2 3 php artisan make:seeder ProductoSeeder # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan make:seeder ProductoSeeder Introducimos informaci\u00f3n en esta tabla nueva, creando un fichero en la carpeta database/seeders de nombre ProductoSeeder.php : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <?php namespace Database\\Seeders ; use Illuminate\\Database\\Seeder ; use Illuminate\\Support\\Facades\\DB ; class ProductoSeeder extends Seeder { public function run () { // insertar datos prueba DB :: table ( 'productos' ) -> insert ([ 'nombre' => 'producto prueba 1' , 'descripcion' => 'esta es una descripci\u00f3n para el producto prueba 1' , 'precio' => 19.99 , ]); DB :: table ( 'productos' ) -> insert ([ 'nombre' => 'producto prueba 2' , 'descripcion' => 'esta es una descripci\u00f3n para el producto prueba 2' , 'precio' => 29.99 , ]); } } Ejecutar el seeder : PHP 1 2 3 php artisan db:seed --class=ProductoSeeder # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan db:seed --class=ProductoSeeder crear controlador ProductoController Crear un controlador donde establezcamos los m\u00e9todos que nosotros queramos realizar a la hora de trabajar con los datos. Crear desde consola un controlador (con modelo ) para la tabla productos : Bash 1 2 3 php artisan make:controller ProductoController --api --model = Producto # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan make:controller ProductoController --api --model=Producto La estructura de este archivo es un poco diferente a los controladores que ya hemos visto anteriormente. Ahora tenemos los siguientes m\u00e9todos creados de manera autom\u00e1tica: index() normalmente para listar (en nuestro caso los chollos). create() para crear plantillas (no lo vamos a usar). store() para guardar los datos que pasemos a la API. update() para actualizar un dato ya existente en la BD. delete() para eliminar un dato ya existente en la BD. Como vamos a conectarnos a un modelo para traer la informaci\u00f3n de dicho modelo a\u00f1adimos mediante use . Tambi\u00e9n creamos la funci\u00f3n index para listar todos los elementos de la tabla (en este caso productos ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace App\\Http\\Controllers ; use Illuminate\\Http\\Request ; use App\\Models\\Producto ; // <-- esta linea class ProductoController extends Controller { public function index (){ return response () -> json ( Producto :: all ()); } } CUIDADO CON EL RETURN porque ahora no estamos devolviendo una vista sino un array de datos en formato JSON. A\u00f1adir en el modelo Producto.php : PHP 1 2 3 4 5 6 7 8 <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Producto extends Model { protected $fillable = [ 'nombre' , 'descripcion' , 'precio' ]; } Ir a fichero web.php (en la carpeta routes ) y colocar nuestras rutas: PHP 1 2 3 4 5 6 7 // cargar el recurso del controlador ProductoController use App\\Http\\Controllers\\ProductoController Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); }); La funci\u00f3n anterior index nos devuelve todos los productos. Pero, qu\u00e9 pasa si queremos listar un producto en cuesti\u00f3n : En ProductoController.php a\u00f1adimos otra funci\u00f3n (show) en la que se le pasa por par\u00e1materos el id : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace App\\Http\\Controllers ; use Illuminate\\Http\\Request ; use App\\Models\\Producto ; // <-- esta linea class ProductoController extends Controller { public function index (){ return response () -> json ( Producto :: all ()); } public function show ( $id ){ return response () -> json ( Producto :: find ( $id )); } } En web.php a\u00f1adimos otra ruta en nuestro grupo: PHP 1 2 3 4 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); }); Para introducir datos utilizaremos el m\u00e9todo store : a) en ProductoController.php : PHP 1 2 3 4 public function store(Request $request){ $producto = Producto::create($request->all()); return response()->json($producto, 201); } b) en web.php : PHP 1 2 3 4 5 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); }); Para actualizar datos de un producto, utilizaremos el m\u00e9todo update : a) en ProductoController.php : PHP 1 2 3 4 5 6 public function update(Request $request, $id){ $producto = Producto::findOrFail($id); $producto -> update($request->all()); return response()->json($producto, 200); } b) en web.php : PHP 1 2 3 4 5 6 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); Route::put('/{id}',[ProductoController::class, 'update']); }); Y para eliminar un producto , el m\u00e9todo delete : a) en ProductoController.php : PHP 1 2 3 4 5 public function destroy($id){ Producto::findOrFail($id)->delete(); return response()->json(null, 204); } b) en web.php : PHP 1 2 3 4 5 6 7 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); Route::put('/{id}',[ProductoController::class, 'update']); Route::delete('/{id}',[ProductoController::class, 'destroy']); }); c\u00f3mo funciona la API REST Para ello vamos a utilizar un software que es una extensi\u00f3n de Visual Studio Code, de nombre Thunder Client : listar todos los productos listar un producto en concreto introducir producto nuevo Si realizamos una nueva petici\u00f3n (new request) con m\u00e9todo post y pasando (desde body y en json ) un nuevo producto, va a mostrarnos un error . Esto se debe a que Laravel, por sus m\u00e9todos de seguridad, necesita un token llamado csrf . Ya que, ahora mismo, estamos realizando pruebas, vamos a indicarle a Laravel que excluya la URL en cuesti\u00f3n de la verificaci\u00f3n. Para ello accedemos al fichero VerifyCsrfToken.php de la carpeta app\\Http\\Middleware : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php namespace App\\Http\\Middleware ; use Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken as Middleware ; class VerifyCsrfToken extends Middleware { /** * The URIs that should be excluded from CSRF verification. * * @var array<int, string> */ protected $except = [ \"http://0.0.0.0:8000/productos\" , // <-- esta excepci\u00f3n ]; } actualizar un producto existente Recuerda a\u00f1adir al fichero VerifyCsrfToken.php de la carpeta app\\Http\\Middleware la excepci\u00f3n: PHP 1 2 3 4 5 6 7 <?php // [..] protected $except = [ \"http://0.0.0.0:8000/productos\" , \"http://0.0.0.0:8000/productos/3\" , // <-- esta nueva excepci\u00f3n ]; } eliminar un producto","title":"ud07 FrameworksPHP Laravel api restful"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#que-es-api","text":"Una API ( Application Programming Interface ) es un conjunto de funciones y procedimientos por los cuales, una aplicaci\u00f3n externa accede a los datos, a modo de biblioteca como una capa de abstracci\u00f3n y la API se encarga de enviar el dato solicitado. Una de las caracter\u00edsticas fundamentales de las API es que son Sateless , lo que quiere decir que las peticiones se hacen y desaparecen, no hay usuarios logueados ni datos que se quedan almacenados. Ejemplos de APIs gratuitas: ChuckNorris IO OMDB PokeAPI - Pokemon RAWg - Videojuegos The Star Wars API Para hacer pruebas con estas APIs podemos implementar el c\u00f3digo para consumirlas o utilizar un cliente especial para el consumo de estos servicios. PostMan Thunder Client (utilizaremos esta extensi\u00f3n de VS Code para nuestras comprobaciones). Insomnia Advance REST Client (desde el navegador) Para mostrar en el navegador el c\u00f3digo JSON con un formato m\u00e1s legible tambi\u00e9n podremos instalar, en el navegador que utilices, la extensi\u00f3n para tal efecto: JSON formatter , en Google Chrome. JSON formatter , en Mozilla Firefox.","title":"qu\u00e9 es API"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#que-es-rest","text":"Con esta metodolog\u00eda llamada REST vamos a poder construir APIs para que desde un cliente externo se puedan consumir. Gracias a este standard de la arquitectura del software vamos a poder montar un API que utilice los m\u00e9todos standard GET , POST , PUT y DELETE .","title":"qu\u00e9 es REST"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#ejemplo-api-rest-en-tabla-productos","text":"","title":"ejemplo API Rest en tabla productos"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#crear-tabla-productos","text":"Antes de crear nuestra API en tabla Productos deberemos tener dicha tabla migrada en nuestro sistema. Para ello: Crear migraci\u00f3n para la tabla productos : Recuerda que el nombre de la migraci\u00f3n contiene palabras reservadas para como son create y table . PHP 1 2 3 php artisan make:migration create_productos_table # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan make:migration create_productos_table A\u00f1adir al fichero generado (en la carpeta migrations y en el ejemplo anterior 2024_01_08_102832_create_productos_table.php ) el resto de campos que se requieran en la tabla productos : PHP 1 2 3 4 5 6 7 8 9 10 public function up(): void { Schema::create('productos', function (Blueprint $table) { $table->id(); $table->string('nombre'); $table->text('descripcion'); $table->decimal('precio', 8, 2); $table->timestamps(); }); } Ejecutar migraci\u00f3n: PHP 1 2 3 php artisan migrate # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan migrate Crear un seeder para realizar una carga de datos: PHP 1 2 3 php artisan make:seeder ProductoSeeder # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan make:seeder ProductoSeeder Introducimos informaci\u00f3n en esta tabla nueva, creando un fichero en la carpeta database/seeders de nombre ProductoSeeder.php : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <?php namespace Database\\Seeders ; use Illuminate\\Database\\Seeder ; use Illuminate\\Support\\Facades\\DB ; class ProductoSeeder extends Seeder { public function run () { // insertar datos prueba DB :: table ( 'productos' ) -> insert ([ 'nombre' => 'producto prueba 1' , 'descripcion' => 'esta es una descripci\u00f3n para el producto prueba 1' , 'precio' => 19.99 , ]); DB :: table ( 'productos' ) -> insert ([ 'nombre' => 'producto prueba 2' , 'descripcion' => 'esta es una descripci\u00f3n para el producto prueba 2' , 'precio' => 29.99 , ]); } } Ejecutar el seeder : PHP 1 2 3 php artisan db:seed --class=ProductoSeeder # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan db:seed --class=ProductoSeeder","title":"crear tabla productos"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#crear-controlador-productocontroller","text":"Crear un controlador donde establezcamos los m\u00e9todos que nosotros queramos realizar a la hora de trabajar con los datos. Crear desde consola un controlador (con modelo ) para la tabla productos : Bash 1 2 3 php artisan make:controller ProductoController --api --model = Producto # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan make:controller ProductoController --api --model=Producto La estructura de este archivo es un poco diferente a los controladores que ya hemos visto anteriormente. Ahora tenemos los siguientes m\u00e9todos creados de manera autom\u00e1tica: index() normalmente para listar (en nuestro caso los chollos). create() para crear plantillas (no lo vamos a usar). store() para guardar los datos que pasemos a la API. update() para actualizar un dato ya existente en la BD. delete() para eliminar un dato ya existente en la BD. Como vamos a conectarnos a un modelo para traer la informaci\u00f3n de dicho modelo a\u00f1adimos mediante use . Tambi\u00e9n creamos la funci\u00f3n index para listar todos los elementos de la tabla (en este caso productos ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace App\\Http\\Controllers ; use Illuminate\\Http\\Request ; use App\\Models\\Producto ; // <-- esta linea class ProductoController extends Controller { public function index (){ return response () -> json ( Producto :: all ()); } } CUIDADO CON EL RETURN porque ahora no estamos devolviendo una vista sino un array de datos en formato JSON. A\u00f1adir en el modelo Producto.php : PHP 1 2 3 4 5 6 7 8 <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Producto extends Model { protected $fillable = [ 'nombre' , 'descripcion' , 'precio' ]; } Ir a fichero web.php (en la carpeta routes ) y colocar nuestras rutas: PHP 1 2 3 4 5 6 7 // cargar el recurso del controlador ProductoController use App\\Http\\Controllers\\ProductoController Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); }); La funci\u00f3n anterior index nos devuelve todos los productos. Pero, qu\u00e9 pasa si queremos listar un producto en cuesti\u00f3n : En ProductoController.php a\u00f1adimos otra funci\u00f3n (show) en la que se le pasa por par\u00e1materos el id : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace App\\Http\\Controllers ; use Illuminate\\Http\\Request ; use App\\Models\\Producto ; // <-- esta linea class ProductoController extends Controller { public function index (){ return response () -> json ( Producto :: all ()); } public function show ( $id ){ return response () -> json ( Producto :: find ( $id )); } } En web.php a\u00f1adimos otra ruta en nuestro grupo: PHP 1 2 3 4 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); }); Para introducir datos utilizaremos el m\u00e9todo store : a) en ProductoController.php : PHP 1 2 3 4 public function store(Request $request){ $producto = Producto::create($request->all()); return response()->json($producto, 201); } b) en web.php : PHP 1 2 3 4 5 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); }); Para actualizar datos de un producto, utilizaremos el m\u00e9todo update : a) en ProductoController.php : PHP 1 2 3 4 5 6 public function update(Request $request, $id){ $producto = Producto::findOrFail($id); $producto -> update($request->all()); return response()->json($producto, 200); } b) en web.php : PHP 1 2 3 4 5 6 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); Route::put('/{id}',[ProductoController::class, 'update']); }); Y para eliminar un producto , el m\u00e9todo delete : a) en ProductoController.php : PHP 1 2 3 4 5 public function destroy($id){ Producto::findOrFail($id)->delete(); return response()->json(null, 204); } b) en web.php : PHP 1 2 3 4 5 6 7 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); Route::put('/{id}',[ProductoController::class, 'update']); Route::delete('/{id}',[ProductoController::class, 'destroy']); });","title":"crear controlador ProductoController"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#como-funciona-la-api-rest","text":"Para ello vamos a utilizar un software que es una extensi\u00f3n de Visual Studio Code, de nombre Thunder Client :","title":"c\u00f3mo funciona la API REST"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#listar-todos-los-productos","text":"","title":"listar todos los productos"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#listar-un-producto-en-concreto","text":"","title":"listar un producto en concreto"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#introducir-producto-nuevo","text":"Si realizamos una nueva petici\u00f3n (new request) con m\u00e9todo post y pasando (desde body y en json ) un nuevo producto, va a mostrarnos un error . Esto se debe a que Laravel, por sus m\u00e9todos de seguridad, necesita un token llamado csrf . Ya que, ahora mismo, estamos realizando pruebas, vamos a indicarle a Laravel que excluya la URL en cuesti\u00f3n de la verificaci\u00f3n. Para ello accedemos al fichero VerifyCsrfToken.php de la carpeta app\\Http\\Middleware : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php namespace App\\Http\\Middleware ; use Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken as Middleware ; class VerifyCsrfToken extends Middleware { /** * The URIs that should be excluded from CSRF verification. * * @var array<int, string> */ protected $except = [ \"http://0.0.0.0:8000/productos\" , // <-- esta excepci\u00f3n ]; }","title":"introducir producto nuevo"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#actualizar-un-producto-existente","text":"Recuerda a\u00f1adir al fichero VerifyCsrfToken.php de la carpeta app\\Http\\Middleware la excepci\u00f3n: PHP 1 2 3 4 5 6 7 <?php // [..] protected $except = [ \"http://0.0.0.0:8000/productos\" , \"http://0.0.0.0:8000/productos/3\" , // <-- esta nueva excepci\u00f3n ]; }","title":"actualizar un producto existente"},{"location":"ud07/ud07_FrameworksPHP-Laravel_api_restful/#eliminar-un-producto","text":"","title":"eliminar un producto"},{"location":"ud07/ud07_FrameworksPHP-Laravel_carritocompra/","text":"unit: unidad did\u00e1ctica 7 title: Laravel - carrito de compra language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets creaci\u00f3n de un carrito de compras Si todav\u00eda no tenemos creado un proyecto en Laravel, se deber\u00e1 crear antes: Descargar Laravel: Bash 1 composer create-project --prefer-dist laravel/laravel carrito Configurar la base de datos en el archivo .env y creamos la base de datos en phpmyadmin como indica el video. Para que este ejercicio sea r\u00e1pido y f\u00e1cil usaremos un plugin llamado darryldecode/cart : https://github.com/darryldecode/laravelshoppingcart instalar plugin carrito compra Instalamos el plugin anteriormente mencionado desde la terminal de Visual Studio Code (\"altura\" proyecto) con composer: PHP 1 sudo docker-compose exec myapp composer require \"darryldecode/cart\" modificar fichero app.php Editamos el archivo config/app.php y en el array Providers agregamos: PHP 1 2 3 //.. Darryldecode\\Cart\\CartServiceProvider::class, //.. Luego, en el mismo fichero, en el array Aliases agregamos: PHP 1 2 3 //... 'Cart' => Darryldecode\\Cart\\Facades\\CartFacade::class, //... crear modelo Crea el Modelo Producto y su archivo de migraci\u00f3n en la terminal de Visual Studio Code : PHP 1 2 3 php artisan make:model Producto -m # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan make:model Producto -m Agrega los campos para nuestra migraci\u00f3n products en database/migrations algo como 2024_01_12_102939_create_productos_table.php : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 Schema::create('productos', function (Blueprint $table) { $table->id(); $table->string('name')->unique(); $table->string('slug')->unique(); $table->string('details')->nullable(); $table->double('price'); $table->double('shipping_cost'); $table->text('description'); $table->integer('category_id'); $table->unsignedInteger('brand_id')->unsigned(); $table->string('image_path'); $table->timestamps(); }); crear seeder Alimentar datos a la base de datos. Ahora podemos introducir algunos datos en la tabla que hemos creado. Laravel proporciona sembradoras o seeders para eso, en la terminal y escribe este comando: PHP 1 2 3 php artisan make:seed ProductosTableSeeder # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan make:seed ProductosTableSeeder Ahora modifica el archivo de Seeder que est\u00e1 en database\\seeders\\ProductosTableSeeder.php (en la cabecera importar Product y dentro de public function run():void{..} ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 use App\\Models\\Producto; use Illuminate\\Support\\Facades\\DB; //... DB::table('productos')->insert([ 'name' => 'MacBook Pro', 'slug' => 'macbook-pro', 'details' => '15 pulgadas, 1TB HDD, 32GB RAM', 'price' => 2499.99, 'shipping_cost' => 29.99, 'description' => 'MackBook Pro', 'category_id' => 1, 'brand_id' => 1, 'image_path' => 'macbook-pro.png' ]); DB::table('productos')->insert([ 'name' => 'Dell Vostro 3557', 'slug' => 'vostro-3557', 'details' => '15 pulgadas, 1TB HDD, 8GB RAM', 'price' => 1499.99, 'shipping_cost' => 19.99, 'description' => 'Dell Vostro 3557', 'category_id' => 1, 'brand_id' => 2, 'image_path' => 'dell-v3557.png' ]); DB::table('productos')->insert([ 'name' => 'iPhone 11 Pro', 'slug' => 'iphone-11-pro', 'details' => '6.1 pulgadas, 64GB 4GB RAM', 'price' => 649.99, 'shipping_cost' => 14.99, 'description' => 'iPhone 11 Pro', 'category_id' => 2, 'brand_id' => 1, 'image_path' => 'iphone-11-pro.png' ]); DB::table('productos')->insert([ 'name' => 'Remax 610D Headset', 'slug' => 'remax-610d', 'details' => '6.1 pulgadas, 64GB 4GB RAM', 'price' => 8.99, 'shipping_cost' => 1.89, 'description' => 'Remax 610D Headset', 'category_id' => 3, 'brand_id' => 3, 'image_path' => 'remax-610d.jpg' ]); DB::table('productos')->insert([ 'name' => 'Samsung LED TV', 'slug' => 'samsung-led-24', 'details' => '24 pulgadas, LED Display, Resoluci\u00f3n 1366 x 768', 'price' => 41.99, 'shipping_cost' => 12.59, 'description' => 'Samsung LED TV', 'category_id' => 4, 'brand_id' => 4, 'image_path' => 'samsung-led-24.png' ]); DB::table('productos')->insert([ 'name' => 'Samsung Camara Digital', 'slug' => 'samsung-mv800', 'details' => '16.1MP, 5x Optical Zoom', 'price' => 144.99, 'shipping_cost' => 13.39, 'description' => 'Samsung Digital Camera', 'category_id' => 5, 'brand_id' => 4, 'image_path' => 'samsung-mv800.jpg' ]); DB::table('productos')->insert([ 'name' => 'Huawei GR 5 2017', 'slug' => 'gr5-2017', 'details' => '5.5 pulgadas, 32GB 4GB RAM', 'price' => 148.99, 'shipping_cost' => 6.79, 'description' => 'Huawei GR 5 2017', 'category_id' => 2, 'brand_id' => 5, 'image_path' => 'gr5-2017.jpg' ]); //... Ahora editamos el archivo database/seeders/DatabaseSeeder.php y le agregamos la clase: PHP 1 $this->call(ProductosTableSeeder::class); Ahora crearemos las tablas de la BD y los productos de prueba: PHP 1 2 3 php artisan migrate # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan migrate Ejecutar el seeder: PHP 1 2 3 php artisan db:seed --class=ProductosTableSeeder #\u00f3, si no funciona: #sudo docker-compose exec myapp php artisan db:seed --class=ProductosTableSeeder crear controlador Crea un controlador para el carrito: PHP 1 2 3 php artisan make:controller CartController # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan make:controller CartController Editamos el archivo CartController.php y le pegamos este c\u00f3digo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 namespace App\\Http\\Controllers; use Illuminate\\Http\\Request; use App\\Models\\Producto; class CartController extends Controller { public function shop() { //Para capturar la excepci\u00f3n que pudiera provocar: //try { $productos = Producto::all(); //} catch (\\Exception $e) { // dd($e->getMessage()); //} return view('shop')->withTitle('E-COMMERCE STORE | SHOP')->with(['productos' => $productos]); } public function cart() { $cartCollection = \\Cart::getContent(); //dd($cartCollection); return view('cart')->withTitle('E-COMMERCE STORE | CART')->with(['cartCollection' => $cartCollection]);; } public function remove(Request $request){ \\Cart::remove($request->id); return redirect()->route('cart.index')->with('success_msg', 'Item is removed!'); } public function add(Request$request){ \\Cart::add(array( 'id' => $request->id, 'name' => $request->name, 'price' => $request->price, 'quantity' => $request->quantity, 'attributes' => array( 'image' => $request->img, 'slug' => $request->slug ) )); return redirect()->route('cart.index')->with('success_msg', 'Producto agregado a tu carrito!'); } public function update(Request $request){ \\Cart::update($request->id, array( 'quantity' => array( 'relative' => false, 'value' => $request->quantity ), )); return redirect()->route('cart.index')->with('success_msg', 'El carro de compra se ha modificado!'); } public function clear(){ \\Cart::clear(); return redirect()->route('cart.index')->with('success_msg', 'Carrito de compra vaicado!'); } } crear rutas Creamos las rutas en web.php : PHP 1 2 3 4 5 6 7 8 9 //... use App\\Http\\Controllers\\CartController; //... Route::get('/', [CartController::class, 'shop'])->name('shop'); Route::get('/cart', [CartController::class, 'cart'])->name('cart.index'); Route::post('/add', [CartController::class, 'add'])->name('cart.store'); Route::post('/update', [CartController::class, 'update'])->name('cart.update'); Route::post('/remove', [CartController::class, 'remove'])->name('cart.remove'); Route::post('/clear', [CartController::class, 'clear'])->name('cart.clear'); Ejecutemos el servidor virtual para probar nuestro proyecto en la terminal: PHP 1 2 3 php artisan serve # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan serve Si se produce un error en la linea: PHP 1 $productos = Producto::all(); de CartController.php podremos activar el try/catch comentado en las lineas de c\u00f3digo. Adem\u00e1s de: comprobar que el usuario de la base de datos tiene privilegios sobre la base de datos. limpiar la cach\u00e9 de Laravel: PHP 1 2 3 4 5 6 7 8 php artisan cache:clear php artisan config:clear php artisan config:cache # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan cache:clear # sudo docker-compose exec myapp php artisan config:clear # sudo docker-compose exec myapp php artisan config:cache reiniciar los servidores. crear vistas Ahora tenemos que crear dos vistas tanto para el carrito como para las p\u00e1ginas de la tienda en la carpeta resources/views : shop.blade.php y cart.blade.php resources\\views\\shop.blade.php : Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 @extends('layouts.app') @section('content') <div class=\"container\" style=\"margin-top: 80px\"> <nav aria-label=\"breadcrumb\"> <ol class=\"breadcrumb\"> <li class=\"breadcrumb-item\"><a href=\"/\">Inicio</a></li> <li class=\"breadcrumb-item active\" aria-current=\"page\">Tienda</li> </ol> </nav> <div class=\"row justify-content-center\"> <div class=\"col-lg-12\"> <div class=\"row\"> <div class=\"col-lg-7\"> <h4>Productos</h4> </div> </div> <hr> <div class=\"row\"> @foreach($productos as $item) <div class=\"col-lg-3\"> <div class=\"card\" style=\"margin-bottom: 20px; height: auto;\"> <img src=\"/images/{{ $item->image_path }}\" class=\"card-img-top mx-auto\" style=\"height: 150px; width: 150px;display: block;\" alt=\"{{ $item->image_path }}\" > <div class=\"card-body\"> <a href=\"\"><h6 class=\"card-title\">{{ $item->name }}</h6></a> <p>{{ $item->price }} \u20ac</p> <form action=\"{{ route('cart.store') }}\" method=\"POST\"> {{ csrf_field() }} <input type=\"hidden\" value=\"{{ $item->id }}\" id=\"id\" name=\"id\"> <input type=\"hidden\" value=\"{{ $item->name }}\" id=\"name\" name=\"name\"> <input type=\"hidden\" value=\"{{ $item->price }}\" id=\"price\" name=\"price\"> <input type=\"hidden\" value=\"{{ $item->image_path }}\" id=\"img\" name=\"img\"> <input type=\"hidden\" value=\"{{ $item->slug }}\" id=\"slug\" name=\"slug\"> <input type=\"hidden\" value=\"1\" id=\"quantity\" name=\"quantity\"> <div class=\"card-footer\" style=\"background-color: white;\"> <div class=\"row\"> <button class=\"btn btn-secondary btn-sm\" class=\"tooltip-test\" title=\"add to cart\"> <i class=\"fa fa-shopping-cart\"></i> agregar al carrito </button> </div> </div> </form> </div> </div> </div> @endforeach </div> </div> </div> </div> @endsection resources\\views\\cart.blade.php : Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 @extends('layouts.app') @section('content') <div class=\"container\" style=\"margin-top: 80px\"> <nav aria-label=\"breadcrumb\"> <ol class=\"breadcrumb\"> <li class=\"breadcrumb-item\"><a href=\"/\">Tienda</a></li> <li class=\"breadcrumb-item active\" aria-current=\"page\">Cart</li> </ol> </nav> @if(session()->has('success_msg')) <div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\"> {{ session()->get('success_msg') }} <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"> <span aria-hidden=\"true\">\u00d7</span> </button> </div> @endif @if(session()->has('alert_msg')) <div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\"> {{ session()->get('alert_msg') }} <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"> <span aria-hidden=\"true\">\u00d7</span> </button> </div> @endif @if(count($errors) > 0) @foreach($errors0>all() as $error) <div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\"> {{ $error }} <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"> <span aria-hidden=\"true\">\u00d7</span> </button> </div> @endforeach @endif <div class=\"row justify-content-center\"> <div class=\"col-lg-7\"> <br> @if(\\Cart::getTotalQuantity()>0) <h4>{{ \\Cart::getTotalQuantity()}} Producto(s) en el carrito</h4><br> @else <h4>No hay producto(s) en tu carrito</h4><br> <a href=\"/\" class=\"btn btn-dark\">Continua en la tienda</a> @endif @foreach($cartCollection as $item) <div class=\"row\"> <div class=\"col-lg-3\"> <img src=\"/images/{{ $item->attributes->image }}\" class=\"img-thumbnail\" width=\"200\" height=\"200\"> </div> <div class=\"col-lg-5\"> <p> <b><a href=\"/shop/{{ $item->attributes->slug }}\">{{ $item->name }}</a></b><br> <b>Precio: </b>{{ $item->price }} \u20ac<br> <b>Subtotal: </b>{{ \\Cart::get($item->id)->getPriceSum() }} \u20ac<br> {{-- <b>With Discount: </b>${{ \\Cart::get($item->id)->getPriceSumWithConditions() }}--}} </p> </div> <div class=\"col-lg-4\"> <div class=\"row\"> <form action=\"{{ route('cart.update') }}\" method=\"POST\"> {{ csrf_field() }} <div class=\"form-group row\"> <input type=\"hidden\" value=\"{{ $item->id}}\" id=\"id\" name=\"id\"> <input type=\"number\" class=\"form-control form-control-sm\" value=\"{{ $item->quantity }}\" id=\"quantity\" name=\"quantity\" style=\"width: 70px; margin-right: 10px;\"> <button class=\"btn btn-secondary btn-sm\" style=\"margin-right: 25px;\"><i class=\"fa fa-edit\"></i></button> </div> </form> <form action=\"{{ route('cart.remove') }}\" method=\"POST\"> {{ csrf_field() }} <input type=\"hidden\" value=\"{{ $item->id }}\" id=\"id\" name=\"id\"> <button class=\"btn btn-dark btn-sm\" style=\"margin-right: 10px;\"><i class=\"fa fa-trash\"></i></button> </form> </div> </div> </div> <hr> @endforeach @if(count($cartCollection)>0) <form action=\"{{ route('cart.clear') }}\" method=\"POST\"> {{ csrf_field() }} <button class=\"btn btn-secondary btn-md\">Borrar Carrito</button> </form> @endif </div> @if(count($cartCollection)>0) <div class=\"col-lg-5\"> <div class=\"card\"> <ul class=\"list-group list-group-flush\"> <li class=\"list-group-item\"><b>Total: </b>${{ \\Cart::getTotal() }}</li> </ul> </div> <br> <a href=\"/\" class=\"btn btn-dark\">Continua en la tienda</a> <a href=\"/checkout\" class=\"btn btn-success\">Proceder al Checkout</a> </div> @endif </div> <br><br> </div> @endsection A continuaci\u00f3n crear, si no lo tienes, el archivo layouts/app.blade.php : Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <!doctype html> <html lang=\"{{ str_replace('_', '-', app()->getLocale()) }}\"> <head> <meta charset=\"utf-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"> <meta name=\"csrf-token\" content=\"{{ csrf_token() }}\"> <title>{{ $title ?? 'E-COMMERCE TIENDA' }}</title> <link rel=\"stylesheet\" href={{ url('css/app.css') }}> <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" integrity=\"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\" crossorigin=\"anonymous\"> <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\"> <link href=\"https://fonts.googleapis.com/css?family=Nunito\" rel=\"stylesheet\"> </head> <body> <div id=\"app\"> @include('partials.navbar') <main class=\"py-4\"> @yield('content') </main> </div> <script src=\"https://code.jquery.com/jquery-3.3.1.slim.min.js\" integrity=\"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\" crossorigin=\"anonymous\"></script> <script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\" integrity=\"sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1\" crossorigin=\"anonymous\"></script> <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\" integrity=\"sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM\" crossorigin=\"anonymous\"></script> <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js\"</script> </body> </html> Creas esta carpeta y archivo dentro de views/partials/navbar.blade.php . C\u00f3digo para el men\u00fa y agregas el c\u00f3digo: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 <nav class=\"navbar navbar-expand-md navbar-dark fixed-top bg-dark shadow-sm\"> <div class=\"container\"> <a class=\"navbar-brand\" href=\"{{ url('/') }}\"> E-COMMERCE TIENDA </a> <button class=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"{{ __('Toggle navigation') }}\"> <span class=\"navbar-toggler-icon\"></span> </button> <div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\"> <ul class=\"navbar-nav ml-auto\"> <li class=\"nav-item\"> <a class=\"nav-link\" href=\"{{ route('shop') }}\">TIENDA</a> </li> <li class=\"nav-item dropdown\"> <a id=\"navbarDropdown\" class=\"nav-link dropdown-toggle\" href=\"#\" role=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" > <span class=\"badge badge-pill badge-dark\"> <i class=\"fa fa-shopping-cart\"></i> {{ \\Cart::getTotalQuantity()}} </span> </a> <div class=\"dropdown-menu dropdown-menu-right\" aria-labelledby=\"navbarDropdown\" style=\"width: 450px; padding: 0px; border-color: #9DA0A2\"> <ul class=\"list-group\" style=\"margin: 20px;\"> @include('partials.cart-drop') </ul> </div> </li> </ul> </div> </div> </nav> partials/cart-drop.blade.php : Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 @if(count(\\Cart::getContent()) > 0) @foreach(\\Cart::getContent() as $item) <li class=\"list-group-item\"> <div class=\"row\"> <div class=\"col-lg-3\"> <img src=\"/images/{{ $item->attributes->image }}\" style=\"width: 50px; height: 50px;\" > </div> <div class=\"col-lg-6\"> <b>{{$item->name}}</b> <br><small>Qty: {{$item->quantity}}</small> </div> <div class=\"col-lg-3\"> <p>${{ \\Cart::get($item->id)->getPriceSum() }}</p> </div> <hr> </div> </li> @endforeach <br> <li class=\"list-group-item\"> <div class=\"row\"> <div class=\"col-lg-10\"> <b>Total: </b>${{ \\Cart::getTotal() }} </div> <div class=\"col-lg-2\"> <form action=\"{{ route('cart.clear') }}\" method=\"POST\"> {{ csrf_field() }} <button class=\"btn btn-secondary btn-sm\"><i class=\"fa fa-trash\"></i></button> </form> </div> </div> </li> <br> <div class=\"row\" style=\"margin: 0px;\"> <a class=\"btn btn-dark btn-sm btn-block\" href=\"{{ route('cart.index') }}\"> CARRITO <i class=\"fa fa-arrow-right\"></i> </a> <a class=\"btn btn-dark btn-sm btn-block\" href=\"\"> CHECKOUT <i class=\"fa fa-arrow-right\"></i> </a> </div> @else <li class=\"list-group-item\">Tu carrito esta vac\u00edo</li> @endif Cargar las im\u00e1genes en la carpeta public/images . Una vez finalizado el c\u00f3digo, el producto resultante ser\u00e1: bibliograf\u00eda Enrique Mart\u00ednez para compucenter33 https://www.youtube.com/c/compucenter33","title":"ud07 FrameworksPHP Laravel carritocompra"},{"location":"ud07/ud07_FrameworksPHP-Laravel_carritocompra/#creacion-de-un-carrito-de-compras","text":"Si todav\u00eda no tenemos creado un proyecto en Laravel, se deber\u00e1 crear antes: Descargar Laravel: Bash 1 composer create-project --prefer-dist laravel/laravel carrito Configurar la base de datos en el archivo .env y creamos la base de datos en phpmyadmin como indica el video. Para que este ejercicio sea r\u00e1pido y f\u00e1cil usaremos un plugin llamado darryldecode/cart : https://github.com/darryldecode/laravelshoppingcart","title":"creaci\u00f3n de un carrito de compras"},{"location":"ud07/ud07_FrameworksPHP-Laravel_carritocompra/#instalar-plugin-carrito-compra","text":"Instalamos el plugin anteriormente mencionado desde la terminal de Visual Studio Code (\"altura\" proyecto) con composer: PHP 1 sudo docker-compose exec myapp composer require \"darryldecode/cart\"","title":"instalar plugin carrito compra"},{"location":"ud07/ud07_FrameworksPHP-Laravel_carritocompra/#modificar-fichero-appphp","text":"Editamos el archivo config/app.php y en el array Providers agregamos: PHP 1 2 3 //.. Darryldecode\\Cart\\CartServiceProvider::class, //.. Luego, en el mismo fichero, en el array Aliases agregamos: PHP 1 2 3 //... 'Cart' => Darryldecode\\Cart\\Facades\\CartFacade::class, //...","title":"modificar fichero app.php"},{"location":"ud07/ud07_FrameworksPHP-Laravel_carritocompra/#crear-modelo","text":"Crea el Modelo Producto y su archivo de migraci\u00f3n en la terminal de Visual Studio Code : PHP 1 2 3 php artisan make:model Producto -m # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan make:model Producto -m Agrega los campos para nuestra migraci\u00f3n products en database/migrations algo como 2024_01_12_102939_create_productos_table.php : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 Schema::create('productos', function (Blueprint $table) { $table->id(); $table->string('name')->unique(); $table->string('slug')->unique(); $table->string('details')->nullable(); $table->double('price'); $table->double('shipping_cost'); $table->text('description'); $table->integer('category_id'); $table->unsignedInteger('brand_id')->unsigned(); $table->string('image_path'); $table->timestamps(); });","title":"crear modelo"},{"location":"ud07/ud07_FrameworksPHP-Laravel_carritocompra/#crear-seeder","text":"Alimentar datos a la base de datos. Ahora podemos introducir algunos datos en la tabla que hemos creado. Laravel proporciona sembradoras o seeders para eso, en la terminal y escribe este comando: PHP 1 2 3 php artisan make:seed ProductosTableSeeder # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan make:seed ProductosTableSeeder Ahora modifica el archivo de Seeder que est\u00e1 en database\\seeders\\ProductosTableSeeder.php (en la cabecera importar Product y dentro de public function run():void{..} ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 use App\\Models\\Producto; use Illuminate\\Support\\Facades\\DB; //... DB::table('productos')->insert([ 'name' => 'MacBook Pro', 'slug' => 'macbook-pro', 'details' => '15 pulgadas, 1TB HDD, 32GB RAM', 'price' => 2499.99, 'shipping_cost' => 29.99, 'description' => 'MackBook Pro', 'category_id' => 1, 'brand_id' => 1, 'image_path' => 'macbook-pro.png' ]); DB::table('productos')->insert([ 'name' => 'Dell Vostro 3557', 'slug' => 'vostro-3557', 'details' => '15 pulgadas, 1TB HDD, 8GB RAM', 'price' => 1499.99, 'shipping_cost' => 19.99, 'description' => 'Dell Vostro 3557', 'category_id' => 1, 'brand_id' => 2, 'image_path' => 'dell-v3557.png' ]); DB::table('productos')->insert([ 'name' => 'iPhone 11 Pro', 'slug' => 'iphone-11-pro', 'details' => '6.1 pulgadas, 64GB 4GB RAM', 'price' => 649.99, 'shipping_cost' => 14.99, 'description' => 'iPhone 11 Pro', 'category_id' => 2, 'brand_id' => 1, 'image_path' => 'iphone-11-pro.png' ]); DB::table('productos')->insert([ 'name' => 'Remax 610D Headset', 'slug' => 'remax-610d', 'details' => '6.1 pulgadas, 64GB 4GB RAM', 'price' => 8.99, 'shipping_cost' => 1.89, 'description' => 'Remax 610D Headset', 'category_id' => 3, 'brand_id' => 3, 'image_path' => 'remax-610d.jpg' ]); DB::table('productos')->insert([ 'name' => 'Samsung LED TV', 'slug' => 'samsung-led-24', 'details' => '24 pulgadas, LED Display, Resoluci\u00f3n 1366 x 768', 'price' => 41.99, 'shipping_cost' => 12.59, 'description' => 'Samsung LED TV', 'category_id' => 4, 'brand_id' => 4, 'image_path' => 'samsung-led-24.png' ]); DB::table('productos')->insert([ 'name' => 'Samsung Camara Digital', 'slug' => 'samsung-mv800', 'details' => '16.1MP, 5x Optical Zoom', 'price' => 144.99, 'shipping_cost' => 13.39, 'description' => 'Samsung Digital Camera', 'category_id' => 5, 'brand_id' => 4, 'image_path' => 'samsung-mv800.jpg' ]); DB::table('productos')->insert([ 'name' => 'Huawei GR 5 2017', 'slug' => 'gr5-2017', 'details' => '5.5 pulgadas, 32GB 4GB RAM', 'price' => 148.99, 'shipping_cost' => 6.79, 'description' => 'Huawei GR 5 2017', 'category_id' => 2, 'brand_id' => 5, 'image_path' => 'gr5-2017.jpg' ]); //... Ahora editamos el archivo database/seeders/DatabaseSeeder.php y le agregamos la clase: PHP 1 $this->call(ProductosTableSeeder::class); Ahora crearemos las tablas de la BD y los productos de prueba: PHP 1 2 3 php artisan migrate # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan migrate Ejecutar el seeder: PHP 1 2 3 php artisan db:seed --class=ProductosTableSeeder #\u00f3, si no funciona: #sudo docker-compose exec myapp php artisan db:seed --class=ProductosTableSeeder","title":"crear seeder"},{"location":"ud07/ud07_FrameworksPHP-Laravel_carritocompra/#crear-controlador","text":"Crea un controlador para el carrito: PHP 1 2 3 php artisan make:controller CartController # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan make:controller CartController Editamos el archivo CartController.php y le pegamos este c\u00f3digo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 namespace App\\Http\\Controllers; use Illuminate\\Http\\Request; use App\\Models\\Producto; class CartController extends Controller { public function shop() { //Para capturar la excepci\u00f3n que pudiera provocar: //try { $productos = Producto::all(); //} catch (\\Exception $e) { // dd($e->getMessage()); //} return view('shop')->withTitle('E-COMMERCE STORE | SHOP')->with(['productos' => $productos]); } public function cart() { $cartCollection = \\Cart::getContent(); //dd($cartCollection); return view('cart')->withTitle('E-COMMERCE STORE | CART')->with(['cartCollection' => $cartCollection]);; } public function remove(Request $request){ \\Cart::remove($request->id); return redirect()->route('cart.index')->with('success_msg', 'Item is removed!'); } public function add(Request$request){ \\Cart::add(array( 'id' => $request->id, 'name' => $request->name, 'price' => $request->price, 'quantity' => $request->quantity, 'attributes' => array( 'image' => $request->img, 'slug' => $request->slug ) )); return redirect()->route('cart.index')->with('success_msg', 'Producto agregado a tu carrito!'); } public function update(Request $request){ \\Cart::update($request->id, array( 'quantity' => array( 'relative' => false, 'value' => $request->quantity ), )); return redirect()->route('cart.index')->with('success_msg', 'El carro de compra se ha modificado!'); } public function clear(){ \\Cart::clear(); return redirect()->route('cart.index')->with('success_msg', 'Carrito de compra vaicado!'); } }","title":"crear controlador"},{"location":"ud07/ud07_FrameworksPHP-Laravel_carritocompra/#crear-rutas","text":"Creamos las rutas en web.php : PHP 1 2 3 4 5 6 7 8 9 //... use App\\Http\\Controllers\\CartController; //... Route::get('/', [CartController::class, 'shop'])->name('shop'); Route::get('/cart', [CartController::class, 'cart'])->name('cart.index'); Route::post('/add', [CartController::class, 'add'])->name('cart.store'); Route::post('/update', [CartController::class, 'update'])->name('cart.update'); Route::post('/remove', [CartController::class, 'remove'])->name('cart.remove'); Route::post('/clear', [CartController::class, 'clear'])->name('cart.clear'); Ejecutemos el servidor virtual para probar nuestro proyecto en la terminal: PHP 1 2 3 php artisan serve # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan serve Si se produce un error en la linea: PHP 1 $productos = Producto::all(); de CartController.php podremos activar el try/catch comentado en las lineas de c\u00f3digo. Adem\u00e1s de: comprobar que el usuario de la base de datos tiene privilegios sobre la base de datos. limpiar la cach\u00e9 de Laravel: PHP 1 2 3 4 5 6 7 8 php artisan cache:clear php artisan config:clear php artisan config:cache # \u00f3, si no funciona: # sudo docker-compose exec myapp php artisan cache:clear # sudo docker-compose exec myapp php artisan config:clear # sudo docker-compose exec myapp php artisan config:cache reiniciar los servidores.","title":"crear rutas"},{"location":"ud07/ud07_FrameworksPHP-Laravel_carritocompra/#crear-vistas","text":"Ahora tenemos que crear dos vistas tanto para el carrito como para las p\u00e1ginas de la tienda en la carpeta resources/views : shop.blade.php y cart.blade.php resources\\views\\shop.blade.php : Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 @extends('layouts.app') @section('content') <div class=\"container\" style=\"margin-top: 80px\"> <nav aria-label=\"breadcrumb\"> <ol class=\"breadcrumb\"> <li class=\"breadcrumb-item\"><a href=\"/\">Inicio</a></li> <li class=\"breadcrumb-item active\" aria-current=\"page\">Tienda</li> </ol> </nav> <div class=\"row justify-content-center\"> <div class=\"col-lg-12\"> <div class=\"row\"> <div class=\"col-lg-7\"> <h4>Productos</h4> </div> </div> <hr> <div class=\"row\"> @foreach($productos as $item) <div class=\"col-lg-3\"> <div class=\"card\" style=\"margin-bottom: 20px; height: auto;\"> <img src=\"/images/{{ $item->image_path }}\" class=\"card-img-top mx-auto\" style=\"height: 150px; width: 150px;display: block;\" alt=\"{{ $item->image_path }}\" > <div class=\"card-body\"> <a href=\"\"><h6 class=\"card-title\">{{ $item->name }}</h6></a> <p>{{ $item->price }} \u20ac</p> <form action=\"{{ route('cart.store') }}\" method=\"POST\"> {{ csrf_field() }} <input type=\"hidden\" value=\"{{ $item->id }}\" id=\"id\" name=\"id\"> <input type=\"hidden\" value=\"{{ $item->name }}\" id=\"name\" name=\"name\"> <input type=\"hidden\" value=\"{{ $item->price }}\" id=\"price\" name=\"price\"> <input type=\"hidden\" value=\"{{ $item->image_path }}\" id=\"img\" name=\"img\"> <input type=\"hidden\" value=\"{{ $item->slug }}\" id=\"slug\" name=\"slug\"> <input type=\"hidden\" value=\"1\" id=\"quantity\" name=\"quantity\"> <div class=\"card-footer\" style=\"background-color: white;\"> <div class=\"row\"> <button class=\"btn btn-secondary btn-sm\" class=\"tooltip-test\" title=\"add to cart\"> <i class=\"fa fa-shopping-cart\"></i> agregar al carrito </button> </div> </div> </form> </div> </div> </div> @endforeach </div> </div> </div> </div> @endsection resources\\views\\cart.blade.php : Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 @extends('layouts.app') @section('content') <div class=\"container\" style=\"margin-top: 80px\"> <nav aria-label=\"breadcrumb\"> <ol class=\"breadcrumb\"> <li class=\"breadcrumb-item\"><a href=\"/\">Tienda</a></li> <li class=\"breadcrumb-item active\" aria-current=\"page\">Cart</li> </ol> </nav> @if(session()->has('success_msg')) <div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\"> {{ session()->get('success_msg') }} <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"> <span aria-hidden=\"true\">\u00d7</span> </button> </div> @endif @if(session()->has('alert_msg')) <div class=\"alert alert-warning alert-dismissible fade show\" role=\"alert\"> {{ session()->get('alert_msg') }} <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"> <span aria-hidden=\"true\">\u00d7</span> </button> </div> @endif @if(count($errors) > 0) @foreach($errors0>all() as $error) <div class=\"alert alert-success alert-dismissible fade show\" role=\"alert\"> {{ $error }} <button type=\"button\" class=\"close\" data-dismiss=\"alert\" aria-label=\"Close\"> <span aria-hidden=\"true\">\u00d7</span> </button> </div> @endforeach @endif <div class=\"row justify-content-center\"> <div class=\"col-lg-7\"> <br> @if(\\Cart::getTotalQuantity()>0) <h4>{{ \\Cart::getTotalQuantity()}} Producto(s) en el carrito</h4><br> @else <h4>No hay producto(s) en tu carrito</h4><br> <a href=\"/\" class=\"btn btn-dark\">Continua en la tienda</a> @endif @foreach($cartCollection as $item) <div class=\"row\"> <div class=\"col-lg-3\"> <img src=\"/images/{{ $item->attributes->image }}\" class=\"img-thumbnail\" width=\"200\" height=\"200\"> </div> <div class=\"col-lg-5\"> <p> <b><a href=\"/shop/{{ $item->attributes->slug }}\">{{ $item->name }}</a></b><br> <b>Precio: </b>{{ $item->price }} \u20ac<br> <b>Subtotal: </b>{{ \\Cart::get($item->id)->getPriceSum() }} \u20ac<br> {{-- <b>With Discount: </b>${{ \\Cart::get($item->id)->getPriceSumWithConditions() }}--}} </p> </div> <div class=\"col-lg-4\"> <div class=\"row\"> <form action=\"{{ route('cart.update') }}\" method=\"POST\"> {{ csrf_field() }} <div class=\"form-group row\"> <input type=\"hidden\" value=\"{{ $item->id}}\" id=\"id\" name=\"id\"> <input type=\"number\" class=\"form-control form-control-sm\" value=\"{{ $item->quantity }}\" id=\"quantity\" name=\"quantity\" style=\"width: 70px; margin-right: 10px;\"> <button class=\"btn btn-secondary btn-sm\" style=\"margin-right: 25px;\"><i class=\"fa fa-edit\"></i></button> </div> </form> <form action=\"{{ route('cart.remove') }}\" method=\"POST\"> {{ csrf_field() }} <input type=\"hidden\" value=\"{{ $item->id }}\" id=\"id\" name=\"id\"> <button class=\"btn btn-dark btn-sm\" style=\"margin-right: 10px;\"><i class=\"fa fa-trash\"></i></button> </form> </div> </div> </div> <hr> @endforeach @if(count($cartCollection)>0) <form action=\"{{ route('cart.clear') }}\" method=\"POST\"> {{ csrf_field() }} <button class=\"btn btn-secondary btn-md\">Borrar Carrito</button> </form> @endif </div> @if(count($cartCollection)>0) <div class=\"col-lg-5\"> <div class=\"card\"> <ul class=\"list-group list-group-flush\"> <li class=\"list-group-item\"><b>Total: </b>${{ \\Cart::getTotal() }}</li> </ul> </div> <br> <a href=\"/\" class=\"btn btn-dark\">Continua en la tienda</a> <a href=\"/checkout\" class=\"btn btn-success\">Proceder al Checkout</a> </div> @endif </div> <br><br> </div> @endsection A continuaci\u00f3n crear, si no lo tienes, el archivo layouts/app.blade.php : Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 <!doctype html> <html lang=\"{{ str_replace('_', '-', app()->getLocale()) }}\"> <head> <meta charset=\"utf-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"> <meta name=\"csrf-token\" content=\"{{ csrf_token() }}\"> <title>{{ $title ?? 'E-COMMERCE TIENDA' }}</title> <link rel=\"stylesheet\" href={{ url('css/app.css') }}> <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css\" integrity=\"sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T\" crossorigin=\"anonymous\"> <link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\"> <link href=\"https://fonts.googleapis.com/css?family=Nunito\" rel=\"stylesheet\"> </head> <body> <div id=\"app\"> @include('partials.navbar') <main class=\"py-4\"> @yield('content') </main> </div> <script src=\"https://code.jquery.com/jquery-3.3.1.slim.min.js\" integrity=\"sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo\" crossorigin=\"anonymous\"></script> <script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js\" integrity=\"sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1\" crossorigin=\"anonymous\"></script> <script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js\" integrity=\"sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM\" crossorigin=\"anonymous\"></script> <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js\"</script> </body> </html> Creas esta carpeta y archivo dentro de views/partials/navbar.blade.php . C\u00f3digo para el men\u00fa y agregas el c\u00f3digo: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 <nav class=\"navbar navbar-expand-md navbar-dark fixed-top bg-dark shadow-sm\"> <div class=\"container\"> <a class=\"navbar-brand\" href=\"{{ url('/') }}\"> E-COMMERCE TIENDA </a> <button class=\"navbar-toggler\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"{{ __('Toggle navigation') }}\"> <span class=\"navbar-toggler-icon\"></span> </button> <div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\"> <ul class=\"navbar-nav ml-auto\"> <li class=\"nav-item\"> <a class=\"nav-link\" href=\"{{ route('shop') }}\">TIENDA</a> </li> <li class=\"nav-item dropdown\"> <a id=\"navbarDropdown\" class=\"nav-link dropdown-toggle\" href=\"#\" role=\"button\" data-toggle=\"dropdown\" aria-haspopup=\"true\" aria-expanded=\"false\" > <span class=\"badge badge-pill badge-dark\"> <i class=\"fa fa-shopping-cart\"></i> {{ \\Cart::getTotalQuantity()}} </span> </a> <div class=\"dropdown-menu dropdown-menu-right\" aria-labelledby=\"navbarDropdown\" style=\"width: 450px; padding: 0px; border-color: #9DA0A2\"> <ul class=\"list-group\" style=\"margin: 20px;\"> @include('partials.cart-drop') </ul> </div> </li> </ul> </div> </div> </nav> partials/cart-drop.blade.php : Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 @if(count(\\Cart::getContent()) > 0) @foreach(\\Cart::getContent() as $item) <li class=\"list-group-item\"> <div class=\"row\"> <div class=\"col-lg-3\"> <img src=\"/images/{{ $item->attributes->image }}\" style=\"width: 50px; height: 50px;\" > </div> <div class=\"col-lg-6\"> <b>{{$item->name}}</b> <br><small>Qty: {{$item->quantity}}</small> </div> <div class=\"col-lg-3\"> <p>${{ \\Cart::get($item->id)->getPriceSum() }}</p> </div> <hr> </div> </li> @endforeach <br> <li class=\"list-group-item\"> <div class=\"row\"> <div class=\"col-lg-10\"> <b>Total: </b>${{ \\Cart::getTotal() }} </div> <div class=\"col-lg-2\"> <form action=\"{{ route('cart.clear') }}\" method=\"POST\"> {{ csrf_field() }} <button class=\"btn btn-secondary btn-sm\"><i class=\"fa fa-trash\"></i></button> </form> </div> </div> </li> <br> <div class=\"row\" style=\"margin: 0px;\"> <a class=\"btn btn-dark btn-sm btn-block\" href=\"{{ route('cart.index') }}\"> CARRITO <i class=\"fa fa-arrow-right\"></i> </a> <a class=\"btn btn-dark btn-sm btn-block\" href=\"\"> CHECKOUT <i class=\"fa fa-arrow-right\"></i> </a> </div> @else <li class=\"list-group-item\">Tu carrito esta vac\u00edo</li> @endif Cargar las im\u00e1genes en la carpeta public/images . Una vez finalizado el c\u00f3digo, el producto resultante ser\u00e1:","title":"crear vistas"},{"location":"ud07/ud07_FrameworksPHP-Laravel_carritocompra/#bibliografia","text":"Enrique Mart\u00ednez para compucenter33 https://www.youtube.com/c/compucenter33","title":"bibliograf\u00eda"},{"location":"ud07/ud07_FrameworksPHP-Laravel_multiidioma/","text":"unit: unidad did\u00e1ctica 7 title: multiidioma en Laravel language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel, API, RESTful] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets multiidioma multiidioma Crear middleware 'Localization': PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <?php namespace App\\Http\\Middleware ; use Closure ; use Illuminate\\Http\\Request ; use Symfony\\Component\\HttpFoundation\\Response ; use Illuminate\\Support\\Facades\\App ; // <-- introducir class Localization { public function handle ( Request $request , Closure $next ) : Response { if ( session () -> has ( 'locale' )){ App :: setLocale ( session () -> get ( 'locale' )); } return $next ( $request ); } } A\u00f1adir en App/Http/kernel.php , al final del array $middlewareGroups : PHP 1 2 3 4 5 6 protected $middlewareGroups = [ 'web' => [ //... \\App\\Http\\Middleware\\Localization::class, ], //... En carpeta resources/lang poner carpetas idiomas ( resources/lang/en , resources/lang/es , resources/lang/va ) con un fichero de nombre messages.php : PHP 1 2 3 4 5 6 7 8 <?php // fichero messages.php para ingl\u00e9s: return [ 'title' => 'my web!' , 'wellcome' => 'wellcome to my aplication' , 'bye' => 'bye' , 'lang' => 'lang' , ]; En carpeta public/img/flag poner banderas ( public/img/flag/en.png , public/img/flag/es.png , public/img/flag/va.png ) . Introducir en web.php : PHP 1 2 3 4 Route::get('locale/{locale}', function($locale){ session()->put('locale', $locale); return Redirect::back(); }); vista.blade.php : PHP 1 2 3 4 5 6 7 8 9 10 //... <title>@lang('messages.title')</title> //... <div> <a href={{ url('locale/va')}}><img src=\"img/flag/va.png\"></a> <a href={{ url('locale/es')}}><img src=\"img/flag/es.png\"></a> <a href={{ url('locale/en')}}><img src=\"img/flag/en.png\"></a> </div> <p>{{ __('messages.wellcome') }}</p>","title":"ud07 FrameworksPHP Laravel multiidioma"},{"location":"ud07/ud07_FrameworksPHP-Laravel_multiidioma/#multiidioma","text":"Crear middleware 'Localization': PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <?php namespace App\\Http\\Middleware ; use Closure ; use Illuminate\\Http\\Request ; use Symfony\\Component\\HttpFoundation\\Response ; use Illuminate\\Support\\Facades\\App ; // <-- introducir class Localization { public function handle ( Request $request , Closure $next ) : Response { if ( session () -> has ( 'locale' )){ App :: setLocale ( session () -> get ( 'locale' )); } return $next ( $request ); } } A\u00f1adir en App/Http/kernel.php , al final del array $middlewareGroups : PHP 1 2 3 4 5 6 protected $middlewareGroups = [ 'web' => [ //... \\App\\Http\\Middleware\\Localization::class, ], //... En carpeta resources/lang poner carpetas idiomas ( resources/lang/en , resources/lang/es , resources/lang/va ) con un fichero de nombre messages.php : PHP 1 2 3 4 5 6 7 8 <?php // fichero messages.php para ingl\u00e9s: return [ 'title' => 'my web!' , 'wellcome' => 'wellcome to my aplication' , 'bye' => 'bye' , 'lang' => 'lang' , ]; En carpeta public/img/flag poner banderas ( public/img/flag/en.png , public/img/flag/es.png , public/img/flag/va.png ) . Introducir en web.php : PHP 1 2 3 4 Route::get('locale/{locale}', function($locale){ session()->put('locale', $locale); return Redirect::back(); }); vista.blade.php : PHP 1 2 3 4 5 6 7 8 9 10 //... <title>@lang('messages.title')</title> //... <div> <a href={{ url('locale/va')}}><img src=\"img/flag/va.png\"></a> <a href={{ url('locale/es')}}><img src=\"img/flag/es.png\"></a> <a href={{ url('locale/en')}}><img src=\"img/flag/en.png\"></a> </div> <p>{{ __('messages.wellcome') }}</p>","title":"multiidioma"},{"location":"ud07/ud07_Laravel_1_Introduccion/","text":"unit: unidad did\u00e1ctica 7 title: Laravel - Introducci\u00f3n language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2024, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets licencia : el uso de estos materiales est\u00e1 sujeto a licencia Creative Commons CC BY-NC . material : extra\u00eddo de https://nachoiborraies.github.io/laravel/ Frameworks PHP Ejemplos de frameworks PHP \u00bfCu\u00e1l elegir? El patr\u00f3n MVC software necesario Visual Studio Code Apache, PHP y MariaDB/MySQL con XAMPP Instalaci\u00f3n El manager de XAMPP Laravel Instalando composer Instalando Laravel Actualizando Laravel Node.js Instalaci\u00f3n en Linux Instalaci\u00f3n en Mac OSX Instalaci\u00f3n en Windows Utilizando NVM Prueba de Node Recursos adicionales Primeros pasos con Laravel Crear proyectos Laravel Usando el comando laravel Usando el comando composer Crear proyectos Laravel usando versiones anteriores El comando artisan Laravel y Visual Studio Code Estructura de un proyecto Laravel Configuraci\u00f3n general del proyecto Arquitectura de un proyecto Laravel Los proveedores de servicios (service providers) Las clases del n\u00facleo de Laravel Otros elementos Prueba de proyectos Laravel Permisos en carpetas del proyecto Puesta en marcha con el comando artisan Puesta en marcha en carpeta predefinida de XAMPP Puesta en marcha como host virtual Importando / Exportando un proyecto Laravel Exportar un proyecto Importar un proyecto existente referencias Frameworks PHP Un framework es una herramienta que proporciona una serie de m\u00f3dulos que ayudan a organizar y desarrollar un producto software. En el caso concreto de los frameworks PHP, la mayor\u00eda de ellos proporcionan una serie de comandos o herramientas para crear proyectos con una estructura determinada (normalmente, siguiendo el patr\u00f3n MVC que veremos despu\u00e9s), de forma que ya dan una base de trabajo hecha, y facilidades para poder crear el modelo de datos, la conexi\u00f3n a la base de datos, las rutas de las diferentes secciones de la aplicaci\u00f3n, etc. Ejemplos de frameworks PHP Actualmente existe una gran variedad de frameworks PHP que elegir para desarrollar nuestras aplicaciones. Algunos de los m\u00e1s populares son: Laravel , un framework relativamente reciente (fue creado en 2011), y que ha ganado bastante popularidad en los \u00faltimos a\u00f1os. Su filosof\u00eda es el poder desarrollar proyectos de forma elegante y simple. Cuenta con una amplia comunidad de soporte detr\u00e1s, y se le augura un futuro bastante consolidado. Symfony , creado en 2005, cuenta con m\u00e1s camino hecho que Laravel, y una estructura m\u00e1s consolidada. En sus primeras versiones se presentaba como un framework m\u00e1s monol\u00edtico (se instalaban demasiados m\u00f3dulos que luego no necesit\u00e1bamos), pero recientemente ha adaptado su estructura para hacerla m\u00e1s modular. De hecho, podr\u00edamos considerar Symfony como un metaframework , es decir, un framework que, a su vez, sirve para desarrollar otros frameworks. Prueba de ello es que, por ejemplo, Laravel utiliza Symfony como base para ampliar esas funcionalidades. CodeIgniter , un framework m\u00e1s ligero que los anteriores, pero tambi\u00e9n con un amplio grupo de seguidores y desarrolladores. Fue creado en 2006 y, aunque ha sufrido una etapa de abandono, ha vuelto a coger fuerza en los \u00faltimos a\u00f1os, quiz\u00e1 debido a su simplicidad de uso. Yii , un framework de alto rendimiento para el desarrollo de aplicaciones web modernas. Es conocido por su eficiencia y velocidad. CakePHP , creado en 2005, es otro framework similar a CodeIgniter en cuanto a simplicidad y facilidad de uso, aunque con menor popularidad. Zend , creado en 2006, es otro framework bastante popular, aunque quiz\u00e1 con menor visibilidad que los anteriores hoy en d\u00eda, a la altura de CakePHP. Phalcon , otro framework de reciente creaci\u00f3n (2012), con una potente capacidad de procesamiento de p\u00e1ginas PHP, y la posibilidad de trabajar como microframework (m\u00e1s ligero, para ofrecer funcionalidades muy espec\u00edficas) o como framework completo. De hecho, muchos frameworks m\u00e1s antiguos tambi\u00e9n han incorporado recientemente la posibilidad de ejecutarlos como microframeworks. otros . Casi todos los frameworks PHP tienen una serie de caracter\u00edsticas comunes, como son el uso del patr\u00f3n MVC para desarrollar sus proyectos, la inyecci\u00f3n de dependencias para gestionar recursos tales como conexiones a bases de datos, o elementos compartidos por toda la aplicaci\u00f3n, la posibilidad de desarrollar tanto webs completas como servicios REST accesibles desde diversos clientes, etc. \u00bfCu\u00e1l elegir? A la hora de decantarnos por uno u otro framework, no nos deber\u00edamos dejar enga\u00f1ar por la popularidad del mismo, en t\u00e9rminos de cuota de mercado. En ese terreno, Symfony y Laravel probablemente sean los m\u00e1s beneficiados, pero la curva de aprendizaje en ellos puede que sea m\u00e1s pronunciada que en otros a priori m\u00e1s sencillos, como CodeIgniter o CakePHP. Cada framework puede estar mejor orientado que otro para determinados tipos de proyectos o necesidades. Si queremos aprender algo r\u00e1pido para lanzar la aplicaci\u00f3n cuanto antes mejor, quiz\u00e1 Symfony no sea la mejor opci\u00f3n. Si, por el contrario, preferimos empaparnos de un framework con una comunidad importante detr\u00e1s que nos pueda dar soporte y nos garantice un tiempo de vida largo, entonces Symfony o Laravel pueden ser mejores candidatos. Llegados a este punto\u2026 \u00bfqu\u00e9 caracter\u00edsticas debemos mirar a la hora de decantarnos por uno u otro framework? Quiz\u00e1 algunas de las m\u00e1s importantes (y no necesariamente excluyentes entre s\u00ed) son: Popularidad La popularidad la podemos medir en base a diferentes webs estad\u00edsticas. Por ejemplo, si comparamos las b\u00fasquedas en Google Trends de los principales frameworks PHP, podemos determinar cu\u00e1les son los m\u00e1s buscados a nivel mundial: Demanda laboral Otro factor determinante para elegir un framework de desarrollo es la demanda laboral que tiene, las puertas que se nos pueden abrir al aprenderlo. Por ejemplo, si hacemos una b\u00fasqueda en el portal espa\u00f1ol de b\u00fasqueda de empleo InfoJobs de algunos frameworks PHP, a fecha de Junio de 2022 , obtenemos estos datos aproximados: Framework Ofertas encontradas Laravel 107 Symfony 76 CodeIgniter 15 Zend 4 CakePHP 3 Facilidad de aprendizaje Es otro factor importante a tener en cuenta, especialmente cuando el tiempo de que disponemos para realizar el proyecto es escaso. En este sentido, frameworks como Symfony o Laravel suelen ser m\u00e1s \u201cpesados de digerir\u201d, precisamente por su envergadura y la cantidad de opciones que ofrecen, mientras que otros m\u00e1s livianos como CodeIgniter o Zend son m\u00e1s f\u00e1cilmente asimilables. Soporte y documentaci\u00f3n Es importante analizar la documentaci\u00f3n y la comunidad de desarrollo y soporte que hay detr\u00e1s de cada framework, para saber si vamos a poder resolver dudas sobre su uso con facilidad. Por ejemplo, Laravel y Symfony, que son dos de los frameworks m\u00e1s difundidos, cuentan con una gran comunidad detr\u00e1s (especialmente Laravel), y una documentaci\u00f3n muy completa y actualizada. Documentaci\u00f3n de Laravel Documentaci\u00f3n de Symfony Extensiones o plug-ins Tambi\u00e9n puede resultar un dato relevante el conocer la capacidad de ampliaci\u00f3n de un framework, qu\u00e9 otras funcionalidades adicionales se le pueden incluir en caso necesario. Muchos de los frameworks PHP pueden hacer uso de la herramienta composer que veremos en otras secciones para instalar dependencias o m\u00f3dulos externos, y enriquecer as\u00ed la funcionalidad de la aplicaci\u00f3n. En el caso de algunos frameworks, ya vienen con ciertas funcionalidades o extensiones incorporadas que suponen un valor a\u00f1adido. Por ejemplo, Laravel incorpora un motor de plantillas llamado Blade para desarrollar f\u00e1cilmente vistas HTML, as\u00ed como un ORM llamado Eloquent para trabajar con bases de datos relacionales como si fueran objetos. Symfony tambi\u00e9n hace lo propio con el motor de plantillas Twig y el ORM Doctrine, respectivamente. En realidad, una vez se conoce uno de estos frameworks, es m\u00e1s sencillo asimilar el resto, llegado el momento. As\u00ed que cualquiera de ellos, con unos motivos que se ajusten a nuestras necesidades, puede ser un buen punto de partida. El patr\u00f3n MVC Como hemos comentado anteriormente, la gran mayor\u00eda de frameworks PHP se apoyan en el patr\u00f3n MVC. MVC son las siglas de Modelo-Vista-Controlador (o en ingl\u00e9s, Model-View-Controller ), y es el patr\u00f3n por excelencia ahora mismo en el mundo de las aplicaciones web, e incluso muchas aplicaciones de escritorio. Como su nombre indica, este patr\u00f3n se basa en dividir el dise\u00f1o de una aplicaci\u00f3n web en tres componentes fundamentales: El modelo , que podr\u00edamos resumir como el conjunto de todos los datos o informaci\u00f3n que maneja la aplicaci\u00f3n. T\u00edpicamente ser\u00e1n variables u objetos extra\u00eddos de una base de datos o cualquier otro sistema de almacenamiento, por lo que el c\u00f3digo del modelo normalmente estar\u00e1 formado por clases o elementos donde almacenar los datos que extraigamos o vayamos a almacenar en esa base de datos. Generalmente, el modelo no tendr\u00e1 conocimiento del resto de componentes del sistema. La vista , que es el intermediario entre la aplicaci\u00f3n y el usuario, es decir, lo que el usuario ve en pantalla de la aplicaci\u00f3n. Por lo tanto, la vista la compondr\u00e1n las diferentes p\u00e1ginas, formularios, etc, que la aplicaci\u00f3n mostrar\u00e1 al usuario para interactuar con \u00e9l. El controlador (o controladores), que son los fragmentos de c\u00f3digo encargados de coordinar el funcionamiento general de la aplicaci\u00f3n. Ante peticiones de los usuarios, las recogen, las identifican, y utilizan el modelo para actualizar o recuperar datos, y a su vez, deciden qu\u00e9 vista mostrarle al usuario a continuaci\u00f3n de la acci\u00f3n que acaba de realizar. Es un patr\u00f3n de dise\u00f1o muy conciso y bien estructurado, lo que le ha valido la fama que tiene hoy en d\u00eda. Entre sus muchas ventajas, permite aislar los tres elementos involucrados (vista, modelo y controlador), de forma que el trabajo es mucho m\u00e1s modular y divisible, pudiendo encargarse de las vistas, por ejemplo, un dise\u00f1ador web que no tenga mucha idea de programaci\u00f3n en el servidor, y del controlador un programador PHP que no tenga muchas nociones de HTML. En forma de esquema, podr\u00edamos representarlo as\u00ed: software necesario A la hora de trabajar con Laravel, necesitamos tener previamente instalados en nuestro sistema una serie de recursos software, como son: Un IDE (entorno de desarrollo) con el que editar el c\u00f3digo de nuestros proyectos. Emplearemos Visual Studio Code en estos apuntes, aunque existen otras alternativas similares, como PHPStorm, Sublime Text, Atom, etc. Un servidor web que soporte PHP. En nuestro caso, utilizaremos Apache . Un servidor de bases de datos en el que almacenar la informaci\u00f3n de nuestras aplicaciones. Emplearemos un servidor MariaDB / MySQL . PHP actualizado a una versi\u00f3n compatible con la versi\u00f3n de Laravel que vayamos a utilizar. Por ejemplo, para Laravel versi\u00f3n 9 se necesita una versi\u00f3n de PHP 8.0 o posterior. El propio framework Laravel . Se necesitar\u00e1 instalar la herramienta composer para, despu\u00e9s, instalar Laravel. Aunque tambi\u00e9n se pueden crear proyectos Laravel desde la propia herramienta composer , como veremos m\u00e1s adelante. Adem\u00e1s, necesitaremos el gestor de paquetes npm para instalar dependencias del lado del cliente en proyectos Laravel. Este gestor se instala con el framework Node.js . Otras herramientas adicionales que nos puedan venir bien, como por ejemplo alguna herramienta para probar el acceso a los servicios REST que desarrollemos. Veremos a continuaci\u00f3n los pasos necesarios para instalar todo el software que utilizaremos. Se dar\u00e1n las pautas de instalaci\u00f3n en un sistema Linux basado en Debian, como por ejemplo Ubuntu, Lubuntu, Linux Mint, etc. Tambi\u00e9n se facilitar\u00e1 un enlace a una m\u00e1quina virtual donde poder instalar todo el software, as\u00ed como otra m\u00e1quina virtual con el software ya preinstalado y listo para utilizarse, usando las versiones que se indican a lo largo del documento. Para usuarios de otros sistemas , como Windows o Mac OSX, la mayor\u00eda de opciones que veremos aqu\u00ed son igualmente v\u00e1lidas (cambiando la ruta y/o el modo de instalaci\u00f3n de algunas herramientas). En cualquier caso, se puede hacer uso de otras herramientas alternativas, como por ejemplo: Laragon para Windows, un sistema que integra los componentes de los puntos 2 a 6 vistos antes (servidor web, de base de datos, PHP, Node, etc). Laravel Homestead , un ecosistema basado en m\u00e1quinas virtuales que tambi\u00e9n integra distintos componentes necesarios para desarrollar aplicaciones Laravel, aunque m\u00e1s complejo de instalar y configurar que Laragon o los pasos que seguiremos aqu\u00ed en la m\u00e1quina virtual. En cualquier caso, no es el prop\u00f3sito de este curso aprender a instalar todo el software en todos los sistemas posibles, y es por ello que proporcionamos la m\u00e1quina virtual indicada, para simplificar las opciones. Veremos algunas pinceladas de c\u00f3mo instalar ciertas herramientas en varios sistemas, no obstante. Visual Studio Code Como IDE para desarrollar nuestras aplicaciones emplearemos Visual Studio Code , que es uno de los IDEs m\u00e1s vers\u00e1tiles que existen hoy en d\u00eda para desarrollo web. Desde la web oficial de Visual Studio Code podemos descargarlo para la plataforma deseada. versi\u00f3n requerida : ninguna en particular, sirve con la \u00faltima versi\u00f3n disponible. Linux (Debian) En el caso de nuestra m\u00e1quina virtual o una distribuci\u00f3n similar, descargaremos un archivo .deb . Una vez descargado, accedemos por terminal a la carpeta donde est\u00e9 y ejecutamos este comando para instalarlo: Bash 1 sudo dpkg -i nombre_del_archivo.deb Se crear\u00e1 autom\u00e1ticamente un acceso directo en el men\u00fa de inicio, dentro de la secci\u00f3n de Programaci\u00f3n en el caso de Lubuntu. Windows Para Windows descargamos el instalador y seguimos los pasos. No hay mucho que configurar; en todo caso, podemos dejar marcada la casilla para a\u00f1adir el men\u00fa contextual \u201c Abrir con Code \u201d para poder abrir archivos y carpetas con VS Code desde el explorador de archivos directamente, con un clic derecho. Mac OSX Para Mac OSX , descargamos la aplicaci\u00f3n y la podemos ejecutar directamente. Tambi\u00e9n podemos moverla a la carpeta de Aplicaciones para tenerla localizada. Extensiones para VS Code Recomendable ser\u00e1 instalar los siguientes plugins para Visual Studio Code. Referentes a PHP: PHP Intelephense PHP IntelliSense PHP Namespace Resolver Referentes a Laravel: Laravel Blade Snippets Laravel Snippets Laravel goto view Laravel Extra Intellisense Referentes a API: Thunder Client Esta herramienta nos servir\u00e1 para simular peticiones a servidores web, y recoger y analizar la respuesta. La emplearemos para probar los servicios REST que desarrollaremos en algunas sesiones. Se instala como una extensi\u00f3n de Visual Studio Code. La buscamos en el panel de extensiones y la instalamos: Nos aparecer\u00e1 un icono en el panel izquierdo desde el que gestionaremos las conexiones y peticiones (aprenderemos a utilizarlo m\u00e1s adelante): Como alternativa, tambi\u00e9n podemos utilizar la herramienta Postman , o bien v\u00eda web o instalando la aplicaci\u00f3n de escritorio desde su web oficial . Referentes a CSS: Tailwind CSS IntelliSense Apache, PHP y MariaDB/MySQL con XAMPP Para poder tener un sistema con Apache, PHP y un gestor de bases de datos (como MariaDB/MySQL), y poderlo gestionar c\u00f3modamente, trabajaremos con un sistema AMPP, paquetes que integran en una sola instalaci\u00f3n todas estas cosas. El ejemplo m\u00e1s conocido de estos sistemas es XAMPP , aunque existen otros como WAMPP, para Windows. Una de las ventajas que ofrecen es que, adem\u00e1s de instalar Apache, PHP y MySQL y dejarlo todo integrado, nos proporciona un cliente web llamado phpMyAdmin para poder administrar las bases de datos desde Apache. Esto nos vendr\u00e1 bien para crear o importar las bases de datos de los distintos ejercicios. versi\u00f3n requerida : depende sobre todo de la versi\u00f3n de Laravel con la que vayamos a trabajar. En el caso por ejemplo de Laravel 9, es necesario tener al menos una versi\u00f3n de PHP 8.0, y para ello debemos contar con una versi\u00f3n de XAMPP 8.x. Instalaci\u00f3n Para instalar XAMPP, basta con descargarlo de su web oficial y seguir los pasos del asistente. Nos basta con tener instalado Apache, MySQL y PHP, as\u00ed que podemos descartar otras opciones que nos ofrezca, si nos da a elegir. Linux En el caso de Linux, debemos dar permisos de ejecuci\u00f3n y ejecutar el archivo .run que descarguemos desde alg\u00fan terminal, con permisos de administrador ( sudo ). Suponiendo que el archivo se llame xampp-linux-x64-7.4.5-installer.run , por ejemplo, los pasos son los siguientes (desde la carpeta donde lo hemos descargado): Bash 1 2 sudo chmod +x xampp-linux-x64-7.4.5-installer.run sudo ./xampp-linux-x64-7.4.5-installer.run Windows y MacOSX En el caso de Windows o Mac OSX simplemente hay que lanzar el instalador y seguir los pasos, eligiendo las opciones que nos interese instalar (al menos, Apache, MySQL y PHP), si nos dan a elegir. As\u00ed es como podemos dejarlo en el caso de Windows, por ejemplo: El manager de XAMPP XAMPP proporciona una herramienta manager o panel de control que nos permite gestionar en todo momento los servicios activos. En el caso de Linux se encuentra en /opt/lampp/manager-linux-x64.run . Podemos acceder a la carpeta desde el terminal para ejecutarlo (con permisos de superusuario); o bien crear alg\u00fan acceso directo en otra ubicaci\u00f3n que nos resulte m\u00e1s c\u00f3moda. Por ejemplo, podemos crear un acceso directo en el escritorio con el editor nano o con el propio editor Visual Studio Code que hemos instalado previamente. Suponiendo la carpeta /home/alumno/Escritorio/ o /home/alumno/Desktop/ , como la que tenemos en la m\u00e1quina virtual, podemos primero crear el archivo vac\u00edo: Text Only 1 touch /home/alumno/Desktop/XAMPP.desktop Editamos el contenido del archivo y a\u00f1adimos las l\u00edneas de configuraci\u00f3n para el acceso directo: Bash 1 2 3 4 5 6 7 8 9 10 [ Desktop Entry ] Encoding = UTF-8 Name = Manager XAMPP Comment = Manager XAMPP Exec = sudo /opt/lampp/manager-linux-x64.run Icon = /opt/lampp/htdocs/favicon.ico Categories = Aplicaciones ; Programaci\u00f3n ; Web Version = 8 .1.6 Type = Application Terminal = 1 nota : la versi\u00f3n del programa (atributo Version ) depender\u00e1 de la versi\u00f3n que hayamos instalado de XAMPP en el momento concreto. El atributo Terminal lo ponemos a 1 para poder especificar el password de superusuario al ejecutar, de lo contrario no funcionar\u00e1. En el caso de Windows , dicho manager est\u00e1 en la carpeta de instalaci\u00f3n (t\u00edpicamente C:\\xampp ), en un archivo llamado xampp-control.exe , que podemos ejecutar. En el caso de Mac OSX , se habr\u00e1 creado un acceso en la secci\u00f3n de Aplicaciones para poder poner en marcha este manager. El manager nos permitir\u00e1 lanzar o detener cada servidor. Para las pruebas que haremos deberemos tener iniciados tanto Apache como MySQL. En Linux y Mac OS X tendr\u00e1 una apariencia como \u00e9sta aproximadamente: En el caso de Windows la apariencia es algo diferente, aunque igualmente funcional: Por defecto, Apache estar\u00e1 escuchando en el puerto 80 (o 443 para conexiones SSL), y MySQL en el 3306. Podemos modificar estos puertos en los respectivos archivos de configuraci\u00f3n (\u201c httpd.conf \u201d y \u201c my.cnf \u201d), dentro de las carpetas de la instalaci\u00f3n de XAMPP (la ubicaci\u00f3n concreta de estos archivos var\u00eda entre versiones y entre sistemas operativos). Laravel Para trabajar con Laravel, ser\u00e1 necesario instalar el gestor de paquetes composer mediante el que podremos tanto crear proyectos Laravel como gestionar las dependencias de otros m\u00f3dulos en un proyecto. versi\u00f3n requerida : en la \u00faltima actualizaci\u00f3n de estos apuntes, se dispone de la versi\u00f3n 2.3.x de la herramienta composer y de la versi\u00f3n 9.x de Laravel. Instalando composer Como hemos comentado, la instalaci\u00f3n de Laravel se realiza a trav\u00e9s del gestor de paquetes composer . \u00c9sta es una herramienta muy habitual en ecosistemas PHP, y su labor es similar a la que desempe\u00f1a el gestor NPM para aplicaciones JavaScript: gestionar las dependencias de un determinado proyecto, descargando, actualizando o desinstalando los paquetes necesarios. En este caso, lo utilizaremos para descargar e instalar el propio framework Laravel. Composer puede instalarse localmente para cada proyecto web, o de forma global para todo el sistema. Esta \u00faltima opci\u00f3n es la recomendable en el caso de querer gestionar varios proyectos en nuestro equipo, para no tener que instalarlo en todos ellos. Linux y Mac OSX Para instalar composer en Linux y Mac OSX, debemos descargar el archivo composer.phar de la web oficial y copiarlo renombrado a composer desde donde lo hayamos descargado a alguna carpeta que forme parte del PATH del sistema, y activarlo como ejecutable. Por ejemplo: Bash 1 2 3 mv composer.phar composer sudo mv composer /usr/local/bin/composer sudo chmod +x /usr/local/bin/composer Como \u00faltimo paso, y ya que Composer utiliza el ejecutable de PHP, necesitamos que dicho ejecutable est\u00e9 tambi\u00e9n en el PATH del sistema. Para Linux deberemos hacer lo siguiente: Bash 1 2 echo \"export PATH= $PATH :/opt/lampp/bin\" >> ~/.bashrc source ~/.bashrc Para Mac OSX, es posible que se tenga alguna versi\u00f3n previa de PHP instalada con alguna otra herramienta. Para superponer la nueva versi\u00f3n de XAMPP a esta otra, podemos hacer este cambio en el PATH: Bash 1 2 echo \"export PATH=/Applications/XAMPP/xamppfiles/bin: $PATH \" >> ~/.bash_profile source ~/.bash_profile Adem\u00e1s, en el caso de Mac OSX quiz\u00e1 tengamos que editar el archivo de configuraci\u00f3n de PHP ( /Applications/XAMPP/xamppfiles/etc/php.ini ) y a\u00f1adir esta l\u00ednea al final, para permitir que el comando PHP gestione la memoria: Bash 1 pcre.jit = 0 Windows Para instalar composer en Windows debemos hacerlo a trav\u00e9s de un instalador que tambi\u00e9n podemos descargar desde la web oficial , en la secci\u00f3n Windows Installer . Seguimos los pasos del asistente, y deberemos indicar la ruta donde se encuentra el comando php , necesario para poder utilizar la herramienta. A\u00f1adimos este comando al PATH del sistema tambi\u00e9n: Comprobaci\u00f3n de la instalaci\u00f3n Una vez instalado, podemos ejecutar el comando composer sin m\u00e1s en un terminal, y comprobar que muestra una salida con las opciones que ofrece: Instalando Laravel A trav\u00e9s de la herramienta composer se pueden crear directamente proyectos Laravel, como veremos en el curso. Sin embargo, la sintaxis del comando de creaci\u00f3n es algo larga, si la comparamos con el instalador de Laravel, por lo que vamos a instalarlo tambi\u00e9n. Para hacerlo, usamos la propia herramienta composer , con este comando: PHP 1 composer global require laravel/installer En el caso de Windows , este comando ya deja el instalador laravel listo para poderse ejecutar desde terminal. Para Linux y Mac OSX, deberemos a\u00f1adirlo al PATH del sistema (en realidad, a\u00f1adimos la carpeta con las utilidades que composer instala de forma global al sistema). Linux: Bash 1 2 echo \"export PATH= $PATH : $HOME /.config/composer/vendor/bin\" >> ~/.bashrc source ~/.bashrc nota : en algunos sistemas la carpeta que hay que incluir en el PATH es $HOME/composer/vendor/bin en lugar de la anterior. Mac OSX: Bash 1 2 echo \"export PATH= $PATH : $HOME /.composer/vendor/bin\" >> ~/.bash_profile source ~/.bash_profile Con esto, se habr\u00e1 instalado un comando llamado laravel , que podemos utilizar a partir de ahora para crear los proyectos. Podemos probar a ejecutarlo en un terminal para que nos muestre las opciones disponibles, lo que indicar\u00e1 que est\u00e1 correctamente instalado y localizado. Actualizando Laravel En general, el comando laravel que se instala se encargar\u00e1 de crear proyectos empleando la \u00faltima versi\u00f3n de Laravel que haya disponible. As\u00ed, si por ejemplo lo instalamos cuando a\u00fan exist\u00eda la versi\u00f3n 7 de Laravel pero se publica la versi\u00f3n 8, autom\u00e1ticamente el comando laravel nos permitir\u00e1 crear proyectos de la versi\u00f3n 8 desde ese punto. Sin embargo, es posible que con el tiempo se requiera actualizar el instalador para que los proyectos con nuevas versiones se sigan creando sin problemas. Para poder actualizar a la versi\u00f3n m\u00e1s reciente de Laravel, tenemos dos opciones, aunque es cierto que ninguna de ellas est\u00e1 recogida en la documentaci\u00f3n oficial de Laravel, y lo que aqu\u00ed se menciona se basa en recomendaciones de webs externas a Laravel. La primera forma de actualizar es utilizar el comando de actualizaci\u00f3n: PHP 1 composer global update laravel/installer Sin embargo, esta opci\u00f3n puede no ser suficiente si el cambio es demasiado brusco (por ejemplo, pasar de Laravel 5 a Laravel 7), ya que algunas dependencias que tambi\u00e9n haya instaladas har\u00edan inviable el cambio. En este caso, podemos optar por quitar la versi\u00f3n instalada por completo, e instalar la reciente: PHP 1 2 composer global remove laravel/installer composer global require laravel/installer Node.js A pesar de que podr\u00eda parecer que Node.js es un ecosistema diferente a Laravel, lo cierto es que con la instalaci\u00f3n de Node se incorpora una herramienta muy \u00fatil en cualquier aplicaci\u00f3n web que utilice librer\u00edas JavaScript, como puedan ser Bootstrap o jQuery. Es la herramienta NPM ( Node Package Manager ), que permite instalar de forma sencilla estas librer\u00edas en cualquier proyecto. versi\u00f3n requerida : es recomendable tener instalada la \u00faltima versi\u00f3n LTS ( Long Term Support ). En la \u00faltima versi\u00f3n de estos apuntes, dicha versi\u00f3n es la 16.x. Para instalar Node en cualquiera de los sistemas que estamos contemplando (Linux, Windows o Mac OSX) podemos optar por: Instalarlo a trav\u00e9s del instalador correspondiente Utilizar la herramienta NVM ( Node Version Manager ). Esta herramienta nos va a permitir tener m\u00e1s de una versi\u00f3n de Node instalada, y poder elegir en todo momento cu\u00e1l de ellas es la que queremos tener activa. En el caso de Windows, la herramienta NVM que podemos utilizar no es la \u201coficial\u201d, pero s\u00ed existe una especie de clon alternativo funcional. Instalaci\u00f3n en Linux En el caso de distribuciones Linux, como es el caso de la m\u00e1quina virtual proporcionada, podemos optar por ejecutar un instalador o por usar NVM. En la versi\u00f3n completa de la m\u00e1quina virtual proporcionada se ha optado por esta \u00faltima opci\u00f3n (NVM), pero damos aqu\u00ed los pasos a seguir para ambas opciones. Opci\u00f3n de instalador Si optamos por instalar Node.js a trav\u00e9s de un instalador, los pasos a seguir son: En primer lugar, si no tenemos instalada la herramienta curl , la instalamos con: Bash 1 sudo apt-get install curl Despu\u00e9s, utilizamos curl para recuperar la versi\u00f3n de Node que queramos (versi\u00f3n LTS actual, 14.x): Bash 1 curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash - Finalmente, instalamos Node.js Bash 1 sudo apt-get install -y nodejs Si quisi\u00e9ramos actualizar la versi\u00f3n de Node.js en un futuro, bastar\u00eda con repetir los dos \u00faltimos comandos, poniendo en el paso 2 la versi\u00f3n a obtener en este caso. Opci\u00f3n de NVM Podemos consultar informaci\u00f3n de esta herramienta en su web oficial en GitHub . Para instalarla, debemos descargarla con el comando curl o wget , seg\u00fan se explica en la propia web de GitHub. Si optamos por wget , el comando es como sigue (en una sola l\u00ednea): Bash 1 wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash En el caso de no disponer del comando wget instalado, podemos o bien instalarlo, o bien emplear este otro comando equivalente, con la orden curl (tambi\u00e9n en una sola l\u00ednea): Bash 1 curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash nota : el n\u00famero de versi\u00f3n v0.39.1 puede variar. Es preferible consultar la web de GitHub para obtener el comando actualizado. nota : despu\u00e9s de ejecutar el comando anterior, ser\u00e1 necesario cerrar el terminal y volverlo a abrir para poder utilizar el comando nvm . Si sigue sin reconocer el comando, quiz\u00e1 debamos actualizar con source ~/.bashrc Instalaci\u00f3n en Mac OSX Para distribuciones Mac OSX, tenemos igualmente la opci\u00f3n de usar un instalador o la herramienta NVM. Opci\u00f3n de instalador El instalador de Node.js para Mac OSX es muy sencillo. Lo descargamos de la web oficial de Node y lo lanzamos. Si queremos actualizar versi\u00f3n en un futuro, basta con volver a descargar esa \u00faltima versi\u00f3n y lanzar el instalador correspondiente para actualizarla. Opci\u00f3n NVM Para utilizar NVM en Mac OSX seguimos los mismos pasos que para Linux, comentados anteriormente, pero en este caso para actualizar el terminal ejecutaremos source ~/.bash_profile . Instalaci\u00f3n en Windows Opci\u00f3n de instalador El instalador de Node.js para Windows es igualmente muy sencillo. Lo descargamos de la web oficial de Node y lo lanzamos. Si queremos actualizar versi\u00f3n en un futuro, basta con volver a descargar esa \u00faltima versi\u00f3n y lanzar el instalador correspondiente para actualizarla. Opci\u00f3n NVM Como coment\u00e1bamos, la herramienta NVM oficial s\u00f3lo est\u00e1 disponible para sistemas Unix, por lo que funciona en Linux y Mac OSX, pero no en Windows. Como alternativa, existe alguna implementaci\u00f3n paralela de nvm que podemos hacer servir, como esta . Podemos descargar un instalador ( nvm-setup.zip ) y ejecutarlo para instalar este gestor. Despu\u00e9s, desde l\u00ednea de comandos tendremos disponibles una serie de comandos para gestionar las versiones de Node, como veremos a continuaci\u00f3n. Utilizando NVM Si hemos optado por instalar Node a trav\u00e9s de nvm , tendremos disponibles una serie de comandos en el terminal para instalar y gestionar las versiones de Node. Aqu\u00ed resumimos los m\u00e1s importantes. Linux y Mac OSX En el caso de estos sistemas, habremos instalado la versi\u00f3n oficial de NVM, y los comandos que podemos utilizar son estos: nvm install node : instala la \u00faltima versi\u00f3n disponible de Node nvm install --lts : instala la \u00faltima versi\u00f3n LTS disponible nvm install 12.16.0 : instala la versi\u00f3n especificada de Node nvm uninstall 12.16.0 : desinstala la versi\u00f3n especificada de Node nvm ls-remote : muestra todas las versiones disponibles para instalar nvm list : muestra todas las versiones instaladas localmente nvm current : muestra la versi\u00f3n actualmente activa nvm use 12.16.0 : marca la versi\u00f3n indicada como actualmente activa nvm use --lts : marca como activa la \u00faltima versi\u00f3n LTS instalada En nuestro caso, vamos a instalar la \u00faltima versi\u00f3n LTS disponible, ya que \u00e9stas son las versiones que tienen soporte a largo plazo. Por lo tanto, ejecutaremos los comandos: Bash 1 2 nvm install --lts nvm use --lts NOTA : el comando nvm use normalmente no es necesario, ya que la instalaci\u00f3n autom\u00e1ticamente deja como activa la versi\u00f3n que elegimos. Pero si el terminal no termina de reconocer el comando node puede ser necesario ejecutarla. Windows En el caso de Windows con la versi\u00f3n alternativa de NVM, los comandos son ligeramente diferentes: nvm install 12.16.0 : instala la versi\u00f3n especificada de Node nvm uninstall 12.16.0 : desinstala la versi\u00f3n especificada de Node nvm list : muestra todas las versiones instaladas localmente nvm list available : muestra todas las versiones disponibles para instalar con esta adaptaci\u00f3n de NVM. nvm use 12.16.0 : marca como activa la versi\u00f3n de Node especificada (previamente instalada). Para instalar la versi\u00f3n LTS disponible, tendremos que ver su n\u00famero en la web oficial de Node, y luego ejecutar el comando correspondiente. Por ejemplo: Bash 1 2 nvm install 16 .16.0 nvm use 16 .16.0 Prueba de Node Podemos ejecutar ahora node -v en el terminal y comprobar que nos muestra el n\u00famero de versi\u00f3n adecuado. Tambi\u00e9n podemos ejecutar el comando npm - v para comprobar la versi\u00f3n que se ha instalado del gestor NPM (que no tiene por qu\u00e9 coincidir con la de Node). Recursos adicionales Para facilitar la labor de instalar y/o trabajar con el software propuesto, se proporcionan dos m\u00e1quinas virtuales basadas en sistemas Lubuntu (versi\u00f3n 20). En ambos casos, se cuenta con un usuario alumno con password alumno . M\u00e1quina virtual base M\u00e1quina virtual con software instalado Es necesario utilizar el programa VirtualBox para ejecutar estas m\u00e1quinas virtuales. Tambi\u00e9n se puede cambiar la configuraci\u00f3n por defecto de dichas m\u00e1quinas virtuales, para darles m\u00e1s memoria RAM o n\u00facleos de procesador, si se cree conveniente. instalar docker bitnami/Laravel Otra opci\u00f3n ( vamos a utilizar esta en nuestros equipos linux ) ser\u00e1 utilizar una stack de contenedores docker que contendr\u00e1 servidor Apache, servidor BBDD MariaDB, Laravel y phpMyadmin. Lo primero de todo es crear una carpeta con el nombre del proyecto y accedemos ella. Por ejemplo, creamos el proyecto prularavel dentro de nuestra carpeta de proyectos: Bash 1 $ mkdir ~/dwes/proyectos/nombreProyecto Accedemos dentro de la carpeta de este nuevo proyecto. Utilizar el fichero docker-compose.yml (que tenemos en nuestra carpeta del curso). Una vez descargado el archivo en nuestra carpeta que acabamos de crear con el nombre del proyecto, lanzamos el siguiente comando por consola para instalar todas las dependencias y crear las im\u00e1genes de Docker correspondientes. Bash 1 sudo docker-compose up -d Si utilizamos el contenedor Portainer para la gesti\u00f3n de nuestros contenedores, podremos observar que estar\u00e1n en marcha nuestros dos contenedores (pertenecientes al servidor web y servidor de bases de datos): aporte Un aporte, o instalaci\u00f3n, a tener en cuenta, podr\u00eda ser la de instalar Tailwind CSS . Este software nos va a proporcionar, de manera sencilla y c\u00f3moda, una opci\u00f3n de utilizar CSS. Para ello, seguir las instrucciones del anexos - instalaci\u00f3n de Tailwind CSS . Primeros pasos con Laravel Ahora que ya tenemos todo el sistema preparado para desarrollar proyectos Laravel, veamos los primeros pasos que debemos dar para crear estos proyectos. importante En este enlace podremos encontrar la documentaci\u00f3n oficial de Laravel (en este caso, la versi\u00f3n 10.x). No dudes en consultarlo cuando tengas dudas! Crear proyectos Laravel Para crear proyectos Laravel, tenemos dos alternativas: Emplear el comando laravel que hemos instalado en sesiones anteriores mediante composer Utilizar el propio comando composer para crear el proyecto. Esta opci\u00f3n ser\u00e1 la recomendada si queremos crear proyectos con versiones de Laravel que no sean la \u00faltima, o si por alg\u00fan motivo no funciona la opci\u00f3n anterior. Usando el comando laravel Si empleamos el comando laravel para crear proyectos (asumiendo que ya lo tendremos instalado de la sesi\u00f3n de software necesario ), nos deberemos ubicar en la carpeta donde queramos crear el proyecto y escribir este comando: PHP 1 laravel new nombre_proyecto Por ejemplo, para las pruebas que iremos construyendo poco a poco en las siguientes sesiones, vamos a crear una web de libros, por lo que, en la carpeta donde queramos tener este proyecto, comenzamos escribiendo este comando: PHP 1 laravel new biblioteca Esto crear\u00e1 un proyecto biblioteca en una subcarpeta con el mismo nombre. Usando el comando composer Alternativamente, tambi\u00e9n se puede emplear la herramienta composer para crear el proyecto, usando la siguiente sintaxis (tambi\u00e9n desde la carpeta donde queramos ubicar el proyecto): PHP 1 composer create-project --prefer-dist laravel/laravel nombre_proyecto En nuestro caso, para el ejemplo de la biblioteca que vamos a ir desarrollando, escribiremos este comando: PHP 1 composer create-project --prefer-dist laravel/laravel biblioteca Del mismo modo que en el caso anterior, se crear\u00e1 una carpeta biblioteca con el contenido inicial del proyecto dentro, empleando la \u00faltima versi\u00f3n de Laravel disponible. Crear proyectos Laravel usando versiones anteriores Al crear un proyecto con el comando laravel new , se crear\u00e1 con la \u00faltima versi\u00f3n disponible de Laravel. En el caso de que necesitemos crear un proyecto Laravel que no utilice la \u00faltima versi\u00f3n, sino alguna anterior, necesitamos utilizar la herramienta composer para especificar el n\u00famero de versi\u00f3n de Laravel que queremos utilizar. Por ejemplo, este comando crea un proyecto llamado \u201cprueba\u201d utilizando Laravel 7: PHP 1 composer create-project --prefer-dist laravel/laravel prueba 7.x El comando artisan Cuando se crea un proyecto Laravel, se instala una herramienta llamada artisan en la ra\u00edz del proyecto. Es una interfaz de l\u00ednea de comandos (CLI, Command Line Interface ), que proporciona una serie de opciones adicionales que nos vendr\u00e1n bien en nuestra gesti\u00f3n de proyectos Laravel para, por ejemplo, crear controladores, migrar datos a una base de datos, etc. Para comprobar que est\u00e1 instalada y las opciones que ofrece, podemos escribir el siguiente comando en un terminal desde la carpeta del proyecto que hayamos creado: PHP 1 php artisan list Este otro comando muestra la versi\u00f3n de Laravel del proyecto en el que estamos: PHP 1 php artisan --version Para escribir estos comandos, podemos abrir la carpeta del proyecto con Visual Studio Code, y abrir el terminal integrado en este IDE (men\u00fa Ver > Terminal ). Esto nos ubicar\u00e1 autom\u00e1ticamente en la carpeta del proyecto, y podemos directamente ejecutar estos comandos desde ah\u00ed. Laravel y Visual Studio Code Como hemos comentado, podemos gestionar muy c\u00f3modamente los proyectos Laravel desde el IDE Visual Studio Code. Basta con abrir la carpeta principal del proyecto desde el propio IDE, y eso puede hacerse desde el men\u00fa Archivo > Abrir Carpeta , o bien arrastrando la carpeta a la zona principal del IDE, e incluso, dependiendo de c\u00f3mo hayamos hecho la instalaci\u00f3n, tambi\u00e9n podemos hacer clic derecho sobre la carpeta del proyecto en el explorador de archivos, y elegir Abrir con Code en el men\u00fa contextual. Una vez abierto, tendremos la estructura del proyecto en la parte izquierda (pesta\u00f1a de explorador de archivos), y podremos ir editando los archivos en la parte derecha. Para facilitar a\u00fan m\u00e1s la gesti\u00f3n de proyectos Laravel, podemos instalar alguna extensi\u00f3n adicional a Visual Studio Code. Una de las m\u00e1s populares es Laravel Extension Pack , que a su vez contiene una serie de extensiones para resaltar sintaxis, editar vistas, etc: Estructura de un proyecto Laravel Los proyectos Laravel se pueden gestionar abriendo la carpeta directamente desde nuestro IDE (Visual Studio Code). Cuando creamos un proyecto Laravel, se crea una estructura de carpetas y archivos predefinida. Explicamos ahora brevemente en qu\u00e9 consisten las principales carpetas y archivos que se generan, de acuerdo a la versi\u00f3n actualizada de estos apuntes. php app : contiene el c\u00f3digo fuente de la aplicaci\u00f3n. Gran parte de las clases que definamos estar\u00e1n en esta carpeta. Inicialmente, se incluyen algunas subcarpetas dentro: Console : para definir nuestros propios comandos Exceptions : para definir nuestras propias excepciones Http : contiene los controladores y el middleware Models : almacena los modelos de datos de la aplicaci\u00f3n (clases que se utilizar\u00e1n para gestionar los objetos que intervienen en el sistema). Providers : contiene los proveedores de servicios de la aplicaci\u00f3n, m\u00e1s los que podamos definir nosotros. Adem\u00e1s, podemos definir aqu\u00ed otras carpetas que podamos necesitar. Por ejemplo, en versiones anteriores de Laravel se creaba aqu\u00ed a mano la carpeta Models para gestionar los modelos de datos. bootstrap : contiene el archivo app.php , que es el que pone en marcha la aplicaci\u00f3n. Adem\u00e1s, contiene la carpeta cache , donde se almacenan los archivos ya cargados por Laravel para acelerar su acceso en futuras peticiones. config : contiene los archivos de configuraci\u00f3n de la aplicaci\u00f3n, donde se tienen variables de entorno, o si nuestra aplicaci\u00f3n est\u00e1 en desarrollo o producci\u00f3n, o los par\u00e1metros de conexi\u00f3n a la base de datos, entre otras cosas. database : almacena los elementos de gesti\u00f3n de la base de datos, tales como generadores de objetos, migraciones, etc. public : contenido visible de la web. Contiene el archivo index.php , punto de entrada de todas las peticiones a la web, y adem\u00e1s podemos definir o generar carpetas donde ubicar el contenido est\u00e1tico del cliente (im\u00e1genes, hojas de estilo CSS, archivos JavaScript\u2026). resources : contiene, por un lado, las vistas de nuestra aplicaci\u00f3n. Por otro lado, tambi\u00e9n contiene archivos no compilados de CSS (archivos sass ) y JavaScript (archivos sin minimizar u optimizar). Adem\u00e1s, tambi\u00e9n almacena los archivos de traducci\u00f3n, en el caso de que queramos hacer sitios multi idioma. routes : almacena las rutas de la aplicaci\u00f3n, tanto para acceder a contenido web normal ( web.php ), como para servicios web ( api.php ), como para comandos y otras opciones. storage : contiene las vistas compiladas, y otros archivos generados por Laravel, como los logs o las sesiones. test : para almacenar los tests o pruebas sobre los componentes de nuestra aplicaci\u00f3n vendor : donde se almacenan las dependencias o librer\u00edas adicionales que se requieren en nuestro proyecto Laravel. Esta carpeta deber\u00eda ser ignorada por Git, y regenerada cada vez que se clone el repositorio remoto, para evitar almacenar demasiada informaci\u00f3n innecesaria. Aunque algunos de los conceptos vistos aqu\u00ed pueden no estar claros a\u00fan (como el concepto de middleware , o los proveedores de servicios), los iremos viendo poco a poco durante el curso. Configuraci\u00f3n general del proyecto De entre la estructura de carpetas de un proyecto Laravel vista anteriormente, echaremos ahora un r\u00e1pido vistazo a d\u00f3nde se encuentra la configuraci\u00f3n general del proyecto. Por un lado, disponemos de un archivo .env en la ra\u00edz del proyecto, que b\u00e1sicamente contiene una serie de variables de entorno generales. Por ejemplo, se tiene la variable APP_NAME con el nombre que queremos que tenga la aplicaci\u00f3n, o un conjunto de variables que utilizaremos m\u00e1s adelante para conectar con la base de datos, entre otras cosas: PHP 1 2 3 4 5 6 7 8 9 APP_NAME=Laravel ... DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=laravel DB_USERNAME=root DB_PASSWORD= ... En general, los cambios de configuraci\u00f3n es preferible hacerlos en este archivo .env , de forma que en los archivos de la carpeta config accederemos a estas variables de entorno definidas en env . Por ejemplo, podemos definir las propiedades del archivo .env de este modo para el proyecto biblioteca que hemos creado anteriormente: PHP 1 2 3 4 5 6 7 8 9 APP_NAME=Biblioteca ... DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=biblioteca DB_USERNAME=root DB_PASSWORD= ... NOTA: Adem\u00e1s, el archivo .env est\u00e1 configurado (o debe configurarse, de lo contrario) para ser ignorado por Git, de modo que no se suba a repositorios, y se evite un acceso a datos confidenciales que pongan en riesgo el acceso al sistema. Por otra parte, la carpeta config contiene unos archivos generales de configuraci\u00f3n. Iremos viendo algunos de ellos en sesiones posteriores, pero, para empezar, podemos echar un vistazo al archivo config/app.php , que contiene par\u00e1metros de configuraci\u00f3n general de la aplicaci\u00f3n. Por ejemplo, podemos modificar el nombre de la aplicaci\u00f3n, en la propiedad name , aunque, como vemos, el nombre lo coge de la propiedad APP_NAME del archivo .env . PHP 1 'name' => env('APP_NAME', 'Laravel'), Es m\u00e1s habitual modificar los valores del archivo .env que los que hay en este archivo de configuraci\u00f3n. Pero, en algunos casos, s\u00ed convendr\u00e1 acudir a alguno de los archivos de esta carpeta y modificar la informaci\u00f3n que contiene. Arquitectura de un proyecto Laravel Una vez vista la estructura de carpetas y archivos que se genera cuando creamos un proyecto Laravel, es importante tambi\u00e9n tener unas nociones b\u00e1sicas de c\u00f3mo se interconectan los elementos internamente, y qu\u00e9 hace que un proyecto Laravel se pueda poner en marcha. Los proveedores de servicios ( service providers ) Los proveedores de servicios son los principales responsables del arranque o puesta en marcha de todo proyecto Laravel, lo que se conoce como bootstrapping . Se encargan de registrar los componentes del proyecto, dependencias externas, clases y m\u00e9todos definidos por nosotros, para hacerlos accesibles al resto de la aplicaci\u00f3n. Si abrimos el archivo config/app.php de nuestro proyecto Laravel, veremos entre otras cosas una secci\u00f3n denominada providers , donde se define un array con todos los proveedores de servicios que se ponen en marcha al arrancar la aplicaci\u00f3n. Por ejemplo, hay proveedores de servicios para acceso a la base de datos ( DatabaseServiceProvider ), autenticaci\u00f3n de usuarios ( AuthServiceProvider ), etc. Las clases del n\u00facleo de Laravel Para poder desarrollar los componentes de las aplicaciones Laravel, es necesario contar con una infraestructura previa de clases que nos faciliten esta tarea. As\u00ed, a lo largo de las siguientes sesiones haremos uso de algunas clases proporcionadas por Laravel que vienen preinstaladas con el framework, tales como Model , Route , etc, y que nos permiten o bien heredar de ellas para crear otras subclases (como es el caso de los modelos de datos) o bien utilizar algunos m\u00e9todos de utilidad que estas clases proporcionan (como es el caso de la clase Route , por ejemplo). Conviene tener presente que todas estas clases pertenecientes al n\u00facleo de Laravel parten de un espacio de nombres com\u00fan llamado Illuminate , por lo que, en los archivos fuente donde las utilicemos, ser\u00e1 frecuente encontrar instrucciones use que comiencen por dicho espacio de nombres. Por ejemplo: PHP 1 use Illuminate\\Database\\Eloquent\\Model; Otros elementos Adem\u00e1s de los dos pilares anteriores sobre los que se sustenta fundamentalmente el desarrollo de proyectos en Laravel, podemos hablar de otros elementos que nos pueden resultar de utilidad en el desarrollo, como son los facades y los contracts . Las facades proporcionan una interfaz est\u00e1tica a los elementos de la aplicaci\u00f3n, de forma que facilitan el acceso a ciertos m\u00e9todos o utilidades. Por ejemplo, la facade Cache permite acceder de forma sencilla con su m\u00e9todo get a ciertas propiedades cacheadas previamente. PHP 1 return Cache::get('key'); Los contracts son un conjunto de interfaces que proporcionan el n\u00facleo de servicios ofrecidos por Laravel. Por ejemplo, m\u00e9todos para enviar e-mails, o encolar tareas en una cola de prioridad, etc. Prueba de proyectos Laravel Existen varias formas de probar o poner en marcha un proyecto Laravel, dependiendo de si estamos desarroll\u00e1ndolo y prob\u00e1ndolo (en cuyo caso buscamos ponerlo en marcha f\u00e1cilmente), o si ya lo hemos puesto en producci\u00f3n. Resumidamente, veremos tres formas de poner en marcha el proyecto: De forma local al proyecto, a trav\u00e9s de la herramienta artisan De forma local a XAMPP, ubicando el proyecto en una carpeta predefinida De forma general en el sistema, definiendo un host virtual conectado con Apache La tercera forma ser\u00e1 la que necesitemos utilizar si queremos poner la web en producci\u00f3n en un servidor real, ya que en estos casos cada aplicaci\u00f3n tiene su propia configuraci\u00f3n y ubicaci\u00f3n diferente al resto. Las otras dos primeras opciones pueden resultarnos \u00fatiles para pruebas sencillas durante el desarrollo. Permisos en carpetas del proyecto Para poder probar nuestro proyecto Laravel, adem\u00e1s de configurar y poner en marcha el servidor correspondiente es necesario habilitar permisos de acceso y escritura a ciertas carpetas del proyecto, especialmente en sistemas Linux o Mac, si movemos el proyecto a una carpeta con permisos reducidos. Carpeta storage junto con sus subcarpetas y contenidos. En esta carpeta se compilar\u00e1n las vistas, se generar\u00e1n los archivos de log, etc, por lo que conviene que esta carpeta tenga permisos de escritura. Subcarpeta bootstrap/cache , donde se almacenar\u00e1 la cach\u00e9 de los archivos ya cargados. Para habilitar los permisos en estas carpetas bajo Linux o Mac OSX, podemos ejecutar estos comandos desde la ra\u00edz del proyecto (la opci\u00f3n -R aplica los permisos de forma recursiva): Bash 1 2 3 sudo chmod -R 777 bootstrap/cache sudo chmod -R 777 storage sudo chmod -R 777 storage/logs NOTA El tercer comando no ser\u00eda necesario en principio, ya que la subcarpeta logs est\u00e1 dentro de la carpeta storage , y se aplican los cambios de forma recursiva. Sin embargo, es posible que en algunas situaciones esta subcarpeta se cree a posteriori y no tenga los permisos adecuados. Comprobaremos al cargar la aplicaci\u00f3n desde el navegador si existe alg\u00fan error al inicio. En este caso, el propio error indicar\u00e1 que no puede generar el log , y deberemos escribir ese comando. Puesta en marcha con el comando artisan La forma m\u00e1s sencilla de probar nuestro proyecto es a trav\u00e9s del comando artisan . Nos ubicamos en la carpeta ra\u00edz del proyecto (recuerda que esto se puede hacer autom\u00e1ticamente abriendo la carpeta con Visual Studio Code y abriendo su terminal), y ejecutamos este comando: PHP 1 php artisan serve Esto habilitar\u00e1 un peque\u00f1o servidor local, y se nos indicar\u00e1 en un mensaje en el terminal la URL que podemos emplear para probar el proyecto, que suele ser algo as\u00ed: PHP 1 Starting Laravel development server: http://127.0.0.1:8000 Conectando a la URL que se nos facilita, veremos la pantalla de inicio de nuestro proyecto, que ser\u00e1 algo as\u00ed (aunque el dise\u00f1o de la p\u00e1gina de inicio puede variar dependiendo de la versi\u00f3n de Laravel que usemos): M\u00e1s adelante aprenderemos a modificar esta p\u00e1gina de inicio, obviamente, y a ir a\u00f1adiendo otras. NOTA : si nuestra aplicaci\u00f3n necesita acceder a una base de datos, adem\u00e1s de arrancarla con el comando artisan visto antes, tambi\u00e9n tendremos que tener en marcha el servidor de bases de datos correspondiente, a trav\u00e9s del manager de XAMPP. Puesta en marcha en carpeta predefinida de XAMPP Como segunda alternativa relativamente r\u00e1pida, podemos ubicar la carpeta del proyecto dentro de la carpeta predefinida de XAMPP para alojar webs: En el caso de Windows es la carpeta htdocs dentro de la carpeta de instalaci\u00f3n de XAMPP. T\u00edpicamente la ruta es C:\\xampp\\htdocs En el caso de Linux , en particular en la distribuci\u00f3n de nuestra m\u00e1quina virtual, es la carpeta /opt/lampp/htdocs En el caso de Mac OSX , la ruta es /Applications/XAMPP/xamppfiles/htdocs Por ejemplo, si nuestro proyecto se llama biblioteca y queremos moverlo a esta carpeta en Linux, escribimos este comando desde la carpeta que contiene nuestro proyecto: Bash 1 sudo mv biblioteca /opt/lampp/htdocs A continuaci\u00f3n debemos poner en marcha el servidor Apache (empleando el manager de XAMPP), y luego acceder a la URL http://localhost/biblioteca/public . Obtendremos la misma p\u00e1gina de inicio que en el caso anterior. NOTA : al mover la carpeta del proyecto a la ubicaci\u00f3n de XAMPP en Linux, ten en cuenta que esa carpeta es de acceso restringido. Deberemos dar permisos a las carpetas indicadas en la secci\u00f3n 4.1 para que la aplicaci\u00f3n se pueda poner en marcha adecuadamente. Puesta en marcha como host virtual En el caso de una puesta en producci\u00f3n real, o si queremos dejar una aplicaci\u00f3n correctamente configurada con Apache, hay que realizar una serie de pasos previos, tales como asociarlo a un virtual host (de Apache, en nuestro caso). A continuaci\u00f3n indicamos los pasos a seguir, y conviene tener presente que: El paso 1 deberemos hacerlo s\u00f3lo una vez , cuando demos de alta nuestro primer virtual host con Apache. El resto de pasos deberemos hacerlos una vez por proyecto para configurar dicho proyecto en Apache y establecer los permisos adecuados. 1. Habilitar los *virtual hosts* en Apache Los virtual hosts son un mecanismo que ofrecen los servidores web, como Apache, para poder asociar carpetas arbitrarias del sistema, externas a la estructura de Apache, al propio servidor, de forma que, accediendo a una URL o nombre de dominio determinado, le indicamos a Apache que cargue los contenidos de esa carpeta. En primer lugar debemos habilitar los virtual hosts en Apache, editando el archivo de configuraci\u00f3n de Apache: Archivo /opt/lampp/etc/httpd.conf en Linux Archivo C:\\xampp\\apache\\conf\\httpd.conf de la carpeta de instalaci\u00f3n de XAMPP en Windows (suponiendo que lo hemos instalado en C:\\xampp ) Archivo /Applications/XAMPP/xamppfiles/etc/httpd.conf en Mac OSX En todos los casos, debemos asegurarnos de que est\u00e1 descomentada la l\u00ednea que hace referencia al lugar donde se definen dichos virtual hosts . Debe quedar as\u00ed en Linux y Mac OSX: PHP 1 2 # Virtual hosts Include etc/extra/httpd-vhosts.conf O as\u00ed en Windows, por ejemplo: PHP 1 2 # Virtual hosts Include conf/extra/httpd-vhosts.conf 2. A\u00f1adir el nuevo nombre de dominio Despu\u00e9s, debemos editar el archivo hosts del sistema y asignar un nombre de dominio (local) a nuestro proyecto. Dicho archivo de hosts es: /etc/hosts en Linux C:\\Windows\\System32\\drivers\\etc\\hosts en Windows /private/etc/hosts en Mac OSX Por ejemplo, para el proyecto biblioteca que hemos creado antes, podr\u00edamos definir algo como esto (al final, o entre los otros registros de nombres existentes en dicho archivo): PHP 1 127.0.0.5 biblioteca Lo que hemos hecho ha sido asignar la IP local 127.0.0.5 (puede ser la IP local que nosotros queramos) al nombre \u201cbiblioteca\u201d. De este modo, cuando carguemos localmente el proyecto podremos acceder a \u00e9l mediante la URL http://biblioteca o bien con http://127.0.0.5 . 3. Definir la configuraci\u00f3n del nuevo *virtual host* A continuaci\u00f3n, debemos editar el archivo al que hac\u00eda referencia la l\u00ednea que hemos descomentado antes en el paso 1: el archivo httpd-vhosts.conf , y a\u00f1adir una nueva configuraci\u00f3n para nuestro nuevo virtual host . Por ejemplo: Bash 1 2 3 4 5 6 7 8 9 10 <VirtualHost 127 .0.0.5:80> DocumentRoot \"/home/alumno/ProyectosLaravel/biblioteca/public\" DirectoryIndex index.php <Directory \"/home/alumno/ProyectosLaravel/biblioteca/public\" > Options All AllowOverride All Require all granted </Directory> </VirtualHost> NOTA : la ruta indicada en el atributo DocumentRoot depender\u00e1, evidentemente, de la ruta donde tengamos alojado nuestro proyecto biblioteca . El ejemplo anterior se ha ilustrado suponiendo que el proyecto biblioteca se ubica en una carpeta ProyectosLaravel en la carpeta de usuario de nuestra m\u00e1quina virtual. Importando / Exportando un proyecto Laravel Vamos a indicar ahora unas instrucciones necesarias en el caso de que queramos importar un proyecto Laravel a un nuevo ordenador, o llevarlo a otro diferente, descarg\u00e1ndolo de, por ejemplo, un repositorio GitHub, o comprimido en un archivo ZIP o similar. Dado que ciertas carpetas y archivos no se suben a dicho repositorio (o no deber\u00edan subirse), es conveniente saber c\u00f3mo regenerar estos elementos en la nueva ubicaci\u00f3n del proyecto. Exportar un proyecto Si queremos exportar o compartir un proyecto Laravel de forma externa, podemos: Compartirlo en un repositorio remoto tipo GitHub o similar. En este caso, el propio archivo .gitignore que se crea en el proyecto indica qu\u00e9 elementos no van a subirse al repositorio. De entre estos elementos, conviene destacar el archivo de configuraci\u00f3n .env , y las carpetas vendor y node_modules . Comprimirlo en un archivo que poder distribuir o instalar en otras partes. En este caso, debemos tomar las mismas precauciones que cuando lo compartimos v\u00eda GitHub, y eliminar los elementos que no sean necesarios. NOTA IMPORTANTE : cuando comprimas un proyecto Laravel, procura comprimir la carpeta entera desde fuera, para as\u00ed incluir tambi\u00e9n los archivos ocultos, como .env.example . De lo contrario, no ser\u00e1 posible poner en marcha el proyecto en el lugar donde se utilice. As\u00ed que, simplemente, elimina las carpetas pesadas ( vendor y node_modules ), archivos que no quieras compartir directamente ( .env , si es el caso) sal a la carpeta padre y compr\u00edmela. Importar un proyecto existente A la hora de importar en un nuevo ordenador un proyecto existente (bien descarg\u00e1ndolo de GitHub, o descomprimi\u00e9ndolo de un archivo ZIP), debemos dar estos pasos (una vez descargado o descomprimido el proyecto). 1. El archivo de configuraci\u00f3n de variables de entorno *.env* Como hemos comentado antes, el archivo .env es uno de los que no se incluye por defecto en un repositorio GitHub, ya que contiene informaci\u00f3n sensible, como la contrase\u00f1a de acceso a la base de datos. Sin embargo, lo que s\u00ed se incluye es una copia inicial del mismo, en el archivo .env.backup o .env.example , dependiendo de la versi\u00f3n de Laravel que utilicemos. Basta con hacer una copia de dicho archivo en la carpeta ra\u00edz del proyecto\u2026 Bash 1 cp .env.example .env \u2026 y luego editar dicho archivo para establecer la configuraci\u00f3n oportuna en el lugar donde hayamos importado el proyecto: par\u00e1metros de conexi\u00f3n a la base de datos, y otras variables de entorno que iremos viendo en este curso. 2. La clave del proyecto Laravel necesita de una clave en la variable de entorno APP_KEY del archivo .env anterior, que por defecto est\u00e1 vac\u00eda. Dicha clave es un c\u00f3digo aleatorio de 32 caracteres, que Laravel emplea para encriptar cookies. Podemos generar una clave con el comando php artisan (desde la ra\u00edz del proyecto): PHP 1 php artisan key:generate y ya la tendremos lista en nuestro archivo .env . 3. Dependencias PHP Otro de los elementos del proyecto que no se comparte en repositorios es la carpeta vendor , donde vienen descargadas las dependencias PHP de nuestro proyecto. Por defecto, al generar un nuevo proyecto Laravel, se presuponen algunas de ellas, incluidas en el archivo composer.json de la ra\u00edz del proyecto. Para volverlas a instalar en donde hayamos clonado el proyecto, ejecutamos este comando desde la ra\u00edz del proyecto (suponiendo que ya tengamos instalado el comando composer de pasos anteriores): PHP 1 composer install 4. Dependencias JavaScript Del mismo modo, existen algunas dependencias para la parte de cliente (como por ejemplo Bootstrap , o jQuery ), definidas en el archivo package.json de la ra\u00edz del proyecto, y que se encuentran preinstaladas en la carpeta node_modules . Esta carpeta, sin embargo, tampoco se comparte en el repositorio, as\u00ed que para volverla a generar en el proyecto clonado, y suponiendo que tambi\u00e9n tendremos instalada la herramienta npm de pasos anteriores, ejecutamos el comando siguiente desde la ra\u00edz del proyecto: Bash 1 npm install referencias Nacho Iborra Baeza .","title":"ud07 Laravel 1 Introduccion"},{"location":"ud07/ud07_Laravel_1_Introduccion/#frameworks-php","text":"Un framework es una herramienta que proporciona una serie de m\u00f3dulos que ayudan a organizar y desarrollar un producto software. En el caso concreto de los frameworks PHP, la mayor\u00eda de ellos proporcionan una serie de comandos o herramientas para crear proyectos con una estructura determinada (normalmente, siguiendo el patr\u00f3n MVC que veremos despu\u00e9s), de forma que ya dan una base de trabajo hecha, y facilidades para poder crear el modelo de datos, la conexi\u00f3n a la base de datos, las rutas de las diferentes secciones de la aplicaci\u00f3n, etc.","title":"Frameworks PHP"},{"location":"ud07/ud07_Laravel_1_Introduccion/#ejemplos-de-frameworks-php","text":"Actualmente existe una gran variedad de frameworks PHP que elegir para desarrollar nuestras aplicaciones. Algunos de los m\u00e1s populares son: Laravel , un framework relativamente reciente (fue creado en 2011), y que ha ganado bastante popularidad en los \u00faltimos a\u00f1os. Su filosof\u00eda es el poder desarrollar proyectos de forma elegante y simple. Cuenta con una amplia comunidad de soporte detr\u00e1s, y se le augura un futuro bastante consolidado. Symfony , creado en 2005, cuenta con m\u00e1s camino hecho que Laravel, y una estructura m\u00e1s consolidada. En sus primeras versiones se presentaba como un framework m\u00e1s monol\u00edtico (se instalaban demasiados m\u00f3dulos que luego no necesit\u00e1bamos), pero recientemente ha adaptado su estructura para hacerla m\u00e1s modular. De hecho, podr\u00edamos considerar Symfony como un metaframework , es decir, un framework que, a su vez, sirve para desarrollar otros frameworks. Prueba de ello es que, por ejemplo, Laravel utiliza Symfony como base para ampliar esas funcionalidades. CodeIgniter , un framework m\u00e1s ligero que los anteriores, pero tambi\u00e9n con un amplio grupo de seguidores y desarrolladores. Fue creado en 2006 y, aunque ha sufrido una etapa de abandono, ha vuelto a coger fuerza en los \u00faltimos a\u00f1os, quiz\u00e1 debido a su simplicidad de uso. Yii , un framework de alto rendimiento para el desarrollo de aplicaciones web modernas. Es conocido por su eficiencia y velocidad. CakePHP , creado en 2005, es otro framework similar a CodeIgniter en cuanto a simplicidad y facilidad de uso, aunque con menor popularidad. Zend , creado en 2006, es otro framework bastante popular, aunque quiz\u00e1 con menor visibilidad que los anteriores hoy en d\u00eda, a la altura de CakePHP. Phalcon , otro framework de reciente creaci\u00f3n (2012), con una potente capacidad de procesamiento de p\u00e1ginas PHP, y la posibilidad de trabajar como microframework (m\u00e1s ligero, para ofrecer funcionalidades muy espec\u00edficas) o como framework completo. De hecho, muchos frameworks m\u00e1s antiguos tambi\u00e9n han incorporado recientemente la posibilidad de ejecutarlos como microframeworks. otros . Casi todos los frameworks PHP tienen una serie de caracter\u00edsticas comunes, como son el uso del patr\u00f3n MVC para desarrollar sus proyectos, la inyecci\u00f3n de dependencias para gestionar recursos tales como conexiones a bases de datos, o elementos compartidos por toda la aplicaci\u00f3n, la posibilidad de desarrollar tanto webs completas como servicios REST accesibles desde diversos clientes, etc.","title":"Ejemplos de frameworks PHP"},{"location":"ud07/ud07_Laravel_1_Introduccion/#cual-elegir","text":"A la hora de decantarnos por uno u otro framework, no nos deber\u00edamos dejar enga\u00f1ar por la popularidad del mismo, en t\u00e9rminos de cuota de mercado. En ese terreno, Symfony y Laravel probablemente sean los m\u00e1s beneficiados, pero la curva de aprendizaje en ellos puede que sea m\u00e1s pronunciada que en otros a priori m\u00e1s sencillos, como CodeIgniter o CakePHP. Cada framework puede estar mejor orientado que otro para determinados tipos de proyectos o necesidades. Si queremos aprender algo r\u00e1pido para lanzar la aplicaci\u00f3n cuanto antes mejor, quiz\u00e1 Symfony no sea la mejor opci\u00f3n. Si, por el contrario, preferimos empaparnos de un framework con una comunidad importante detr\u00e1s que nos pueda dar soporte y nos garantice un tiempo de vida largo, entonces Symfony o Laravel pueden ser mejores candidatos. Llegados a este punto\u2026 \u00bfqu\u00e9 caracter\u00edsticas debemos mirar a la hora de decantarnos por uno u otro framework? Quiz\u00e1 algunas de las m\u00e1s importantes (y no necesariamente excluyentes entre s\u00ed) son: Popularidad La popularidad la podemos medir en base a diferentes webs estad\u00edsticas. Por ejemplo, si comparamos las b\u00fasquedas en Google Trends de los principales frameworks PHP, podemos determinar cu\u00e1les son los m\u00e1s buscados a nivel mundial: Demanda laboral Otro factor determinante para elegir un framework de desarrollo es la demanda laboral que tiene, las puertas que se nos pueden abrir al aprenderlo. Por ejemplo, si hacemos una b\u00fasqueda en el portal espa\u00f1ol de b\u00fasqueda de empleo InfoJobs de algunos frameworks PHP, a fecha de Junio de 2022 , obtenemos estos datos aproximados: Framework Ofertas encontradas Laravel 107 Symfony 76 CodeIgniter 15 Zend 4 CakePHP 3 Facilidad de aprendizaje Es otro factor importante a tener en cuenta, especialmente cuando el tiempo de que disponemos para realizar el proyecto es escaso. En este sentido, frameworks como Symfony o Laravel suelen ser m\u00e1s \u201cpesados de digerir\u201d, precisamente por su envergadura y la cantidad de opciones que ofrecen, mientras que otros m\u00e1s livianos como CodeIgniter o Zend son m\u00e1s f\u00e1cilmente asimilables. Soporte y documentaci\u00f3n Es importante analizar la documentaci\u00f3n y la comunidad de desarrollo y soporte que hay detr\u00e1s de cada framework, para saber si vamos a poder resolver dudas sobre su uso con facilidad. Por ejemplo, Laravel y Symfony, que son dos de los frameworks m\u00e1s difundidos, cuentan con una gran comunidad detr\u00e1s (especialmente Laravel), y una documentaci\u00f3n muy completa y actualizada. Documentaci\u00f3n de Laravel Documentaci\u00f3n de Symfony Extensiones o plug-ins Tambi\u00e9n puede resultar un dato relevante el conocer la capacidad de ampliaci\u00f3n de un framework, qu\u00e9 otras funcionalidades adicionales se le pueden incluir en caso necesario. Muchos de los frameworks PHP pueden hacer uso de la herramienta composer que veremos en otras secciones para instalar dependencias o m\u00f3dulos externos, y enriquecer as\u00ed la funcionalidad de la aplicaci\u00f3n. En el caso de algunos frameworks, ya vienen con ciertas funcionalidades o extensiones incorporadas que suponen un valor a\u00f1adido. Por ejemplo, Laravel incorpora un motor de plantillas llamado Blade para desarrollar f\u00e1cilmente vistas HTML, as\u00ed como un ORM llamado Eloquent para trabajar con bases de datos relacionales como si fueran objetos. Symfony tambi\u00e9n hace lo propio con el motor de plantillas Twig y el ORM Doctrine, respectivamente. En realidad, una vez se conoce uno de estos frameworks, es m\u00e1s sencillo asimilar el resto, llegado el momento. As\u00ed que cualquiera de ellos, con unos motivos que se ajusten a nuestras necesidades, puede ser un buen punto de partida.","title":"\u00bfCu\u00e1l elegir?"},{"location":"ud07/ud07_Laravel_1_Introduccion/#el-patron-mvc","text":"Como hemos comentado anteriormente, la gran mayor\u00eda de frameworks PHP se apoyan en el patr\u00f3n MVC. MVC son las siglas de Modelo-Vista-Controlador (o en ingl\u00e9s, Model-View-Controller ), y es el patr\u00f3n por excelencia ahora mismo en el mundo de las aplicaciones web, e incluso muchas aplicaciones de escritorio. Como su nombre indica, este patr\u00f3n se basa en dividir el dise\u00f1o de una aplicaci\u00f3n web en tres componentes fundamentales: El modelo , que podr\u00edamos resumir como el conjunto de todos los datos o informaci\u00f3n que maneja la aplicaci\u00f3n. T\u00edpicamente ser\u00e1n variables u objetos extra\u00eddos de una base de datos o cualquier otro sistema de almacenamiento, por lo que el c\u00f3digo del modelo normalmente estar\u00e1 formado por clases o elementos donde almacenar los datos que extraigamos o vayamos a almacenar en esa base de datos. Generalmente, el modelo no tendr\u00e1 conocimiento del resto de componentes del sistema. La vista , que es el intermediario entre la aplicaci\u00f3n y el usuario, es decir, lo que el usuario ve en pantalla de la aplicaci\u00f3n. Por lo tanto, la vista la compondr\u00e1n las diferentes p\u00e1ginas, formularios, etc, que la aplicaci\u00f3n mostrar\u00e1 al usuario para interactuar con \u00e9l. El controlador (o controladores), que son los fragmentos de c\u00f3digo encargados de coordinar el funcionamiento general de la aplicaci\u00f3n. Ante peticiones de los usuarios, las recogen, las identifican, y utilizan el modelo para actualizar o recuperar datos, y a su vez, deciden qu\u00e9 vista mostrarle al usuario a continuaci\u00f3n de la acci\u00f3n que acaba de realizar. Es un patr\u00f3n de dise\u00f1o muy conciso y bien estructurado, lo que le ha valido la fama que tiene hoy en d\u00eda. Entre sus muchas ventajas, permite aislar los tres elementos involucrados (vista, modelo y controlador), de forma que el trabajo es mucho m\u00e1s modular y divisible, pudiendo encargarse de las vistas, por ejemplo, un dise\u00f1ador web que no tenga mucha idea de programaci\u00f3n en el servidor, y del controlador un programador PHP que no tenga muchas nociones de HTML. En forma de esquema, podr\u00edamos representarlo as\u00ed:","title":"El patr\u00f3n MVC"},{"location":"ud07/ud07_Laravel_1_Introduccion/#software-necesario","text":"A la hora de trabajar con Laravel, necesitamos tener previamente instalados en nuestro sistema una serie de recursos software, como son: Un IDE (entorno de desarrollo) con el que editar el c\u00f3digo de nuestros proyectos. Emplearemos Visual Studio Code en estos apuntes, aunque existen otras alternativas similares, como PHPStorm, Sublime Text, Atom, etc. Un servidor web que soporte PHP. En nuestro caso, utilizaremos Apache . Un servidor de bases de datos en el que almacenar la informaci\u00f3n de nuestras aplicaciones. Emplearemos un servidor MariaDB / MySQL . PHP actualizado a una versi\u00f3n compatible con la versi\u00f3n de Laravel que vayamos a utilizar. Por ejemplo, para Laravel versi\u00f3n 9 se necesita una versi\u00f3n de PHP 8.0 o posterior. El propio framework Laravel . Se necesitar\u00e1 instalar la herramienta composer para, despu\u00e9s, instalar Laravel. Aunque tambi\u00e9n se pueden crear proyectos Laravel desde la propia herramienta composer , como veremos m\u00e1s adelante. Adem\u00e1s, necesitaremos el gestor de paquetes npm para instalar dependencias del lado del cliente en proyectos Laravel. Este gestor se instala con el framework Node.js . Otras herramientas adicionales que nos puedan venir bien, como por ejemplo alguna herramienta para probar el acceso a los servicios REST que desarrollemos. Veremos a continuaci\u00f3n los pasos necesarios para instalar todo el software que utilizaremos. Se dar\u00e1n las pautas de instalaci\u00f3n en un sistema Linux basado en Debian, como por ejemplo Ubuntu, Lubuntu, Linux Mint, etc. Tambi\u00e9n se facilitar\u00e1 un enlace a una m\u00e1quina virtual donde poder instalar todo el software, as\u00ed como otra m\u00e1quina virtual con el software ya preinstalado y listo para utilizarse, usando las versiones que se indican a lo largo del documento. Para usuarios de otros sistemas , como Windows o Mac OSX, la mayor\u00eda de opciones que veremos aqu\u00ed son igualmente v\u00e1lidas (cambiando la ruta y/o el modo de instalaci\u00f3n de algunas herramientas). En cualquier caso, se puede hacer uso de otras herramientas alternativas, como por ejemplo: Laragon para Windows, un sistema que integra los componentes de los puntos 2 a 6 vistos antes (servidor web, de base de datos, PHP, Node, etc). Laravel Homestead , un ecosistema basado en m\u00e1quinas virtuales que tambi\u00e9n integra distintos componentes necesarios para desarrollar aplicaciones Laravel, aunque m\u00e1s complejo de instalar y configurar que Laragon o los pasos que seguiremos aqu\u00ed en la m\u00e1quina virtual. En cualquier caso, no es el prop\u00f3sito de este curso aprender a instalar todo el software en todos los sistemas posibles, y es por ello que proporcionamos la m\u00e1quina virtual indicada, para simplificar las opciones. Veremos algunas pinceladas de c\u00f3mo instalar ciertas herramientas en varios sistemas, no obstante.","title":"software necesario"},{"location":"ud07/ud07_Laravel_1_Introduccion/#visual-studio-code","text":"Como IDE para desarrollar nuestras aplicaciones emplearemos Visual Studio Code , que es uno de los IDEs m\u00e1s vers\u00e1tiles que existen hoy en d\u00eda para desarrollo web. Desde la web oficial de Visual Studio Code podemos descargarlo para la plataforma deseada. versi\u00f3n requerida : ninguna en particular, sirve con la \u00faltima versi\u00f3n disponible. Linux (Debian) En el caso de nuestra m\u00e1quina virtual o una distribuci\u00f3n similar, descargaremos un archivo .deb . Una vez descargado, accedemos por terminal a la carpeta donde est\u00e9 y ejecutamos este comando para instalarlo: Bash 1 sudo dpkg -i nombre_del_archivo.deb Se crear\u00e1 autom\u00e1ticamente un acceso directo en el men\u00fa de inicio, dentro de la secci\u00f3n de Programaci\u00f3n en el caso de Lubuntu. Windows Para Windows descargamos el instalador y seguimos los pasos. No hay mucho que configurar; en todo caso, podemos dejar marcada la casilla para a\u00f1adir el men\u00fa contextual \u201c Abrir con Code \u201d para poder abrir archivos y carpetas con VS Code desde el explorador de archivos directamente, con un clic derecho. Mac OSX Para Mac OSX , descargamos la aplicaci\u00f3n y la podemos ejecutar directamente. Tambi\u00e9n podemos moverla a la carpeta de Aplicaciones para tenerla localizada. Extensiones para VS Code Recomendable ser\u00e1 instalar los siguientes plugins para Visual Studio Code. Referentes a PHP: PHP Intelephense PHP IntelliSense PHP Namespace Resolver Referentes a Laravel: Laravel Blade Snippets Laravel Snippets Laravel goto view Laravel Extra Intellisense Referentes a API: Thunder Client Esta herramienta nos servir\u00e1 para simular peticiones a servidores web, y recoger y analizar la respuesta. La emplearemos para probar los servicios REST que desarrollaremos en algunas sesiones. Se instala como una extensi\u00f3n de Visual Studio Code. La buscamos en el panel de extensiones y la instalamos: Nos aparecer\u00e1 un icono en el panel izquierdo desde el que gestionaremos las conexiones y peticiones (aprenderemos a utilizarlo m\u00e1s adelante): Como alternativa, tambi\u00e9n podemos utilizar la herramienta Postman , o bien v\u00eda web o instalando la aplicaci\u00f3n de escritorio desde su web oficial . Referentes a CSS: Tailwind CSS IntelliSense","title":"Visual Studio Code"},{"location":"ud07/ud07_Laravel_1_Introduccion/#apache-php-y-mariadbmysql-con-xampp","text":"Para poder tener un sistema con Apache, PHP y un gestor de bases de datos (como MariaDB/MySQL), y poderlo gestionar c\u00f3modamente, trabajaremos con un sistema AMPP, paquetes que integran en una sola instalaci\u00f3n todas estas cosas. El ejemplo m\u00e1s conocido de estos sistemas es XAMPP , aunque existen otros como WAMPP, para Windows. Una de las ventajas que ofrecen es que, adem\u00e1s de instalar Apache, PHP y MySQL y dejarlo todo integrado, nos proporciona un cliente web llamado phpMyAdmin para poder administrar las bases de datos desde Apache. Esto nos vendr\u00e1 bien para crear o importar las bases de datos de los distintos ejercicios. versi\u00f3n requerida : depende sobre todo de la versi\u00f3n de Laravel con la que vayamos a trabajar. En el caso por ejemplo de Laravel 9, es necesario tener al menos una versi\u00f3n de PHP 8.0, y para ello debemos contar con una versi\u00f3n de XAMPP 8.x.","title":"Apache, PHP y MariaDB/MySQL con XAMPP"},{"location":"ud07/ud07_Laravel_1_Introduccion/#instalacion","text":"Para instalar XAMPP, basta con descargarlo de su web oficial y seguir los pasos del asistente. Nos basta con tener instalado Apache, MySQL y PHP, as\u00ed que podemos descartar otras opciones que nos ofrezca, si nos da a elegir. Linux En el caso de Linux, debemos dar permisos de ejecuci\u00f3n y ejecutar el archivo .run que descarguemos desde alg\u00fan terminal, con permisos de administrador ( sudo ). Suponiendo que el archivo se llame xampp-linux-x64-7.4.5-installer.run , por ejemplo, los pasos son los siguientes (desde la carpeta donde lo hemos descargado): Bash 1 2 sudo chmod +x xampp-linux-x64-7.4.5-installer.run sudo ./xampp-linux-x64-7.4.5-installer.run Windows y MacOSX En el caso de Windows o Mac OSX simplemente hay que lanzar el instalador y seguir los pasos, eligiendo las opciones que nos interese instalar (al menos, Apache, MySQL y PHP), si nos dan a elegir. As\u00ed es como podemos dejarlo en el caso de Windows, por ejemplo:","title":"Instalaci\u00f3n"},{"location":"ud07/ud07_Laravel_1_Introduccion/#el-manager-de-xampp","text":"XAMPP proporciona una herramienta manager o panel de control que nos permite gestionar en todo momento los servicios activos. En el caso de Linux se encuentra en /opt/lampp/manager-linux-x64.run . Podemos acceder a la carpeta desde el terminal para ejecutarlo (con permisos de superusuario); o bien crear alg\u00fan acceso directo en otra ubicaci\u00f3n que nos resulte m\u00e1s c\u00f3moda. Por ejemplo, podemos crear un acceso directo en el escritorio con el editor nano o con el propio editor Visual Studio Code que hemos instalado previamente. Suponiendo la carpeta /home/alumno/Escritorio/ o /home/alumno/Desktop/ , como la que tenemos en la m\u00e1quina virtual, podemos primero crear el archivo vac\u00edo: Text Only 1 touch /home/alumno/Desktop/XAMPP.desktop Editamos el contenido del archivo y a\u00f1adimos las l\u00edneas de configuraci\u00f3n para el acceso directo: Bash 1 2 3 4 5 6 7 8 9 10 [ Desktop Entry ] Encoding = UTF-8 Name = Manager XAMPP Comment = Manager XAMPP Exec = sudo /opt/lampp/manager-linux-x64.run Icon = /opt/lampp/htdocs/favicon.ico Categories = Aplicaciones ; Programaci\u00f3n ; Web Version = 8 .1.6 Type = Application Terminal = 1 nota : la versi\u00f3n del programa (atributo Version ) depender\u00e1 de la versi\u00f3n que hayamos instalado de XAMPP en el momento concreto. El atributo Terminal lo ponemos a 1 para poder especificar el password de superusuario al ejecutar, de lo contrario no funcionar\u00e1. En el caso de Windows , dicho manager est\u00e1 en la carpeta de instalaci\u00f3n (t\u00edpicamente C:\\xampp ), en un archivo llamado xampp-control.exe , que podemos ejecutar. En el caso de Mac OSX , se habr\u00e1 creado un acceso en la secci\u00f3n de Aplicaciones para poder poner en marcha este manager. El manager nos permitir\u00e1 lanzar o detener cada servidor. Para las pruebas que haremos deberemos tener iniciados tanto Apache como MySQL. En Linux y Mac OS X tendr\u00e1 una apariencia como \u00e9sta aproximadamente: En el caso de Windows la apariencia es algo diferente, aunque igualmente funcional: Por defecto, Apache estar\u00e1 escuchando en el puerto 80 (o 443 para conexiones SSL), y MySQL en el 3306. Podemos modificar estos puertos en los respectivos archivos de configuraci\u00f3n (\u201c httpd.conf \u201d y \u201c my.cnf \u201d), dentro de las carpetas de la instalaci\u00f3n de XAMPP (la ubicaci\u00f3n concreta de estos archivos var\u00eda entre versiones y entre sistemas operativos).","title":"El manager de XAMPP"},{"location":"ud07/ud07_Laravel_1_Introduccion/#laravel","text":"Para trabajar con Laravel, ser\u00e1 necesario instalar el gestor de paquetes composer mediante el que podremos tanto crear proyectos Laravel como gestionar las dependencias de otros m\u00f3dulos en un proyecto. versi\u00f3n requerida : en la \u00faltima actualizaci\u00f3n de estos apuntes, se dispone de la versi\u00f3n 2.3.x de la herramienta composer y de la versi\u00f3n 9.x de Laravel.","title":"Laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#instalando-composer","text":"Como hemos comentado, la instalaci\u00f3n de Laravel se realiza a trav\u00e9s del gestor de paquetes composer . \u00c9sta es una herramienta muy habitual en ecosistemas PHP, y su labor es similar a la que desempe\u00f1a el gestor NPM para aplicaciones JavaScript: gestionar las dependencias de un determinado proyecto, descargando, actualizando o desinstalando los paquetes necesarios. En este caso, lo utilizaremos para descargar e instalar el propio framework Laravel. Composer puede instalarse localmente para cada proyecto web, o de forma global para todo el sistema. Esta \u00faltima opci\u00f3n es la recomendable en el caso de querer gestionar varios proyectos en nuestro equipo, para no tener que instalarlo en todos ellos. Linux y Mac OSX Para instalar composer en Linux y Mac OSX, debemos descargar el archivo composer.phar de la web oficial y copiarlo renombrado a composer desde donde lo hayamos descargado a alguna carpeta que forme parte del PATH del sistema, y activarlo como ejecutable. Por ejemplo: Bash 1 2 3 mv composer.phar composer sudo mv composer /usr/local/bin/composer sudo chmod +x /usr/local/bin/composer Como \u00faltimo paso, y ya que Composer utiliza el ejecutable de PHP, necesitamos que dicho ejecutable est\u00e9 tambi\u00e9n en el PATH del sistema. Para Linux deberemos hacer lo siguiente: Bash 1 2 echo \"export PATH= $PATH :/opt/lampp/bin\" >> ~/.bashrc source ~/.bashrc Para Mac OSX, es posible que se tenga alguna versi\u00f3n previa de PHP instalada con alguna otra herramienta. Para superponer la nueva versi\u00f3n de XAMPP a esta otra, podemos hacer este cambio en el PATH: Bash 1 2 echo \"export PATH=/Applications/XAMPP/xamppfiles/bin: $PATH \" >> ~/.bash_profile source ~/.bash_profile Adem\u00e1s, en el caso de Mac OSX quiz\u00e1 tengamos que editar el archivo de configuraci\u00f3n de PHP ( /Applications/XAMPP/xamppfiles/etc/php.ini ) y a\u00f1adir esta l\u00ednea al final, para permitir que el comando PHP gestione la memoria: Bash 1 pcre.jit = 0 Windows Para instalar composer en Windows debemos hacerlo a trav\u00e9s de un instalador que tambi\u00e9n podemos descargar desde la web oficial , en la secci\u00f3n Windows Installer . Seguimos los pasos del asistente, y deberemos indicar la ruta donde se encuentra el comando php , necesario para poder utilizar la herramienta. A\u00f1adimos este comando al PATH del sistema tambi\u00e9n: Comprobaci\u00f3n de la instalaci\u00f3n Una vez instalado, podemos ejecutar el comando composer sin m\u00e1s en un terminal, y comprobar que muestra una salida con las opciones que ofrece:","title":"Instalando composer"},{"location":"ud07/ud07_Laravel_1_Introduccion/#instalando-laravel","text":"A trav\u00e9s de la herramienta composer se pueden crear directamente proyectos Laravel, como veremos en el curso. Sin embargo, la sintaxis del comando de creaci\u00f3n es algo larga, si la comparamos con el instalador de Laravel, por lo que vamos a instalarlo tambi\u00e9n. Para hacerlo, usamos la propia herramienta composer , con este comando: PHP 1 composer global require laravel/installer En el caso de Windows , este comando ya deja el instalador laravel listo para poderse ejecutar desde terminal. Para Linux y Mac OSX, deberemos a\u00f1adirlo al PATH del sistema (en realidad, a\u00f1adimos la carpeta con las utilidades que composer instala de forma global al sistema). Linux: Bash 1 2 echo \"export PATH= $PATH : $HOME /.config/composer/vendor/bin\" >> ~/.bashrc source ~/.bashrc nota : en algunos sistemas la carpeta que hay que incluir en el PATH es $HOME/composer/vendor/bin en lugar de la anterior. Mac OSX: Bash 1 2 echo \"export PATH= $PATH : $HOME /.composer/vendor/bin\" >> ~/.bash_profile source ~/.bash_profile Con esto, se habr\u00e1 instalado un comando llamado laravel , que podemos utilizar a partir de ahora para crear los proyectos. Podemos probar a ejecutarlo en un terminal para que nos muestre las opciones disponibles, lo que indicar\u00e1 que est\u00e1 correctamente instalado y localizado.","title":"Instalando Laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#actualizando-laravel","text":"En general, el comando laravel que se instala se encargar\u00e1 de crear proyectos empleando la \u00faltima versi\u00f3n de Laravel que haya disponible. As\u00ed, si por ejemplo lo instalamos cuando a\u00fan exist\u00eda la versi\u00f3n 7 de Laravel pero se publica la versi\u00f3n 8, autom\u00e1ticamente el comando laravel nos permitir\u00e1 crear proyectos de la versi\u00f3n 8 desde ese punto. Sin embargo, es posible que con el tiempo se requiera actualizar el instalador para que los proyectos con nuevas versiones se sigan creando sin problemas. Para poder actualizar a la versi\u00f3n m\u00e1s reciente de Laravel, tenemos dos opciones, aunque es cierto que ninguna de ellas est\u00e1 recogida en la documentaci\u00f3n oficial de Laravel, y lo que aqu\u00ed se menciona se basa en recomendaciones de webs externas a Laravel. La primera forma de actualizar es utilizar el comando de actualizaci\u00f3n: PHP 1 composer global update laravel/installer Sin embargo, esta opci\u00f3n puede no ser suficiente si el cambio es demasiado brusco (por ejemplo, pasar de Laravel 5 a Laravel 7), ya que algunas dependencias que tambi\u00e9n haya instaladas har\u00edan inviable el cambio. En este caso, podemos optar por quitar la versi\u00f3n instalada por completo, e instalar la reciente: PHP 1 2 composer global remove laravel/installer composer global require laravel/installer","title":"Actualizando Laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#nodejs","text":"A pesar de que podr\u00eda parecer que Node.js es un ecosistema diferente a Laravel, lo cierto es que con la instalaci\u00f3n de Node se incorpora una herramienta muy \u00fatil en cualquier aplicaci\u00f3n web que utilice librer\u00edas JavaScript, como puedan ser Bootstrap o jQuery. Es la herramienta NPM ( Node Package Manager ), que permite instalar de forma sencilla estas librer\u00edas en cualquier proyecto. versi\u00f3n requerida : es recomendable tener instalada la \u00faltima versi\u00f3n LTS ( Long Term Support ). En la \u00faltima versi\u00f3n de estos apuntes, dicha versi\u00f3n es la 16.x. Para instalar Node en cualquiera de los sistemas que estamos contemplando (Linux, Windows o Mac OSX) podemos optar por: Instalarlo a trav\u00e9s del instalador correspondiente Utilizar la herramienta NVM ( Node Version Manager ). Esta herramienta nos va a permitir tener m\u00e1s de una versi\u00f3n de Node instalada, y poder elegir en todo momento cu\u00e1l de ellas es la que queremos tener activa. En el caso de Windows, la herramienta NVM que podemos utilizar no es la \u201coficial\u201d, pero s\u00ed existe una especie de clon alternativo funcional.","title":"Node.js"},{"location":"ud07/ud07_Laravel_1_Introduccion/#instalacion-en-linux","text":"En el caso de distribuciones Linux, como es el caso de la m\u00e1quina virtual proporcionada, podemos optar por ejecutar un instalador o por usar NVM. En la versi\u00f3n completa de la m\u00e1quina virtual proporcionada se ha optado por esta \u00faltima opci\u00f3n (NVM), pero damos aqu\u00ed los pasos a seguir para ambas opciones. Opci\u00f3n de instalador Si optamos por instalar Node.js a trav\u00e9s de un instalador, los pasos a seguir son: En primer lugar, si no tenemos instalada la herramienta curl , la instalamos con: Bash 1 sudo apt-get install curl Despu\u00e9s, utilizamos curl para recuperar la versi\u00f3n de Node que queramos (versi\u00f3n LTS actual, 14.x): Bash 1 curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash - Finalmente, instalamos Node.js Bash 1 sudo apt-get install -y nodejs Si quisi\u00e9ramos actualizar la versi\u00f3n de Node.js en un futuro, bastar\u00eda con repetir los dos \u00faltimos comandos, poniendo en el paso 2 la versi\u00f3n a obtener en este caso. Opci\u00f3n de NVM Podemos consultar informaci\u00f3n de esta herramienta en su web oficial en GitHub . Para instalarla, debemos descargarla con el comando curl o wget , seg\u00fan se explica en la propia web de GitHub. Si optamos por wget , el comando es como sigue (en una sola l\u00ednea): Bash 1 wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash En el caso de no disponer del comando wget instalado, podemos o bien instalarlo, o bien emplear este otro comando equivalente, con la orden curl (tambi\u00e9n en una sola l\u00ednea): Bash 1 curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash nota : el n\u00famero de versi\u00f3n v0.39.1 puede variar. Es preferible consultar la web de GitHub para obtener el comando actualizado. nota : despu\u00e9s de ejecutar el comando anterior, ser\u00e1 necesario cerrar el terminal y volverlo a abrir para poder utilizar el comando nvm . Si sigue sin reconocer el comando, quiz\u00e1 debamos actualizar con source ~/.bashrc","title":"Instalaci\u00f3n en Linux"},{"location":"ud07/ud07_Laravel_1_Introduccion/#instalacion-en-mac-osx","text":"Para distribuciones Mac OSX, tenemos igualmente la opci\u00f3n de usar un instalador o la herramienta NVM. Opci\u00f3n de instalador El instalador de Node.js para Mac OSX es muy sencillo. Lo descargamos de la web oficial de Node y lo lanzamos. Si queremos actualizar versi\u00f3n en un futuro, basta con volver a descargar esa \u00faltima versi\u00f3n y lanzar el instalador correspondiente para actualizarla. Opci\u00f3n NVM Para utilizar NVM en Mac OSX seguimos los mismos pasos que para Linux, comentados anteriormente, pero en este caso para actualizar el terminal ejecutaremos source ~/.bash_profile .","title":"Instalaci\u00f3n en Mac OSX"},{"location":"ud07/ud07_Laravel_1_Introduccion/#instalacion-en-windows","text":"Opci\u00f3n de instalador El instalador de Node.js para Windows es igualmente muy sencillo. Lo descargamos de la web oficial de Node y lo lanzamos. Si queremos actualizar versi\u00f3n en un futuro, basta con volver a descargar esa \u00faltima versi\u00f3n y lanzar el instalador correspondiente para actualizarla. Opci\u00f3n NVM Como coment\u00e1bamos, la herramienta NVM oficial s\u00f3lo est\u00e1 disponible para sistemas Unix, por lo que funciona en Linux y Mac OSX, pero no en Windows. Como alternativa, existe alguna implementaci\u00f3n paralela de nvm que podemos hacer servir, como esta . Podemos descargar un instalador ( nvm-setup.zip ) y ejecutarlo para instalar este gestor. Despu\u00e9s, desde l\u00ednea de comandos tendremos disponibles una serie de comandos para gestionar las versiones de Node, como veremos a continuaci\u00f3n.","title":"Instalaci\u00f3n en Windows"},{"location":"ud07/ud07_Laravel_1_Introduccion/#utilizando-nvm","text":"Si hemos optado por instalar Node a trav\u00e9s de nvm , tendremos disponibles una serie de comandos en el terminal para instalar y gestionar las versiones de Node. Aqu\u00ed resumimos los m\u00e1s importantes. Linux y Mac OSX En el caso de estos sistemas, habremos instalado la versi\u00f3n oficial de NVM, y los comandos que podemos utilizar son estos: nvm install node : instala la \u00faltima versi\u00f3n disponible de Node nvm install --lts : instala la \u00faltima versi\u00f3n LTS disponible nvm install 12.16.0 : instala la versi\u00f3n especificada de Node nvm uninstall 12.16.0 : desinstala la versi\u00f3n especificada de Node nvm ls-remote : muestra todas las versiones disponibles para instalar nvm list : muestra todas las versiones instaladas localmente nvm current : muestra la versi\u00f3n actualmente activa nvm use 12.16.0 : marca la versi\u00f3n indicada como actualmente activa nvm use --lts : marca como activa la \u00faltima versi\u00f3n LTS instalada En nuestro caso, vamos a instalar la \u00faltima versi\u00f3n LTS disponible, ya que \u00e9stas son las versiones que tienen soporte a largo plazo. Por lo tanto, ejecutaremos los comandos: Bash 1 2 nvm install --lts nvm use --lts NOTA : el comando nvm use normalmente no es necesario, ya que la instalaci\u00f3n autom\u00e1ticamente deja como activa la versi\u00f3n que elegimos. Pero si el terminal no termina de reconocer el comando node puede ser necesario ejecutarla. Windows En el caso de Windows con la versi\u00f3n alternativa de NVM, los comandos son ligeramente diferentes: nvm install 12.16.0 : instala la versi\u00f3n especificada de Node nvm uninstall 12.16.0 : desinstala la versi\u00f3n especificada de Node nvm list : muestra todas las versiones instaladas localmente nvm list available : muestra todas las versiones disponibles para instalar con esta adaptaci\u00f3n de NVM. nvm use 12.16.0 : marca como activa la versi\u00f3n de Node especificada (previamente instalada). Para instalar la versi\u00f3n LTS disponible, tendremos que ver su n\u00famero en la web oficial de Node, y luego ejecutar el comando correspondiente. Por ejemplo: Bash 1 2 nvm install 16 .16.0 nvm use 16 .16.0","title":"Utilizando NVM"},{"location":"ud07/ud07_Laravel_1_Introduccion/#prueba-de-node","text":"Podemos ejecutar ahora node -v en el terminal y comprobar que nos muestra el n\u00famero de versi\u00f3n adecuado. Tambi\u00e9n podemos ejecutar el comando npm - v para comprobar la versi\u00f3n que se ha instalado del gestor NPM (que no tiene por qu\u00e9 coincidir con la de Node).","title":"Prueba de Node"},{"location":"ud07/ud07_Laravel_1_Introduccion/#recursos-adicionales","text":"Para facilitar la labor de instalar y/o trabajar con el software propuesto, se proporcionan dos m\u00e1quinas virtuales basadas en sistemas Lubuntu (versi\u00f3n 20). En ambos casos, se cuenta con un usuario alumno con password alumno . M\u00e1quina virtual base M\u00e1quina virtual con software instalado Es necesario utilizar el programa VirtualBox para ejecutar estas m\u00e1quinas virtuales. Tambi\u00e9n se puede cambiar la configuraci\u00f3n por defecto de dichas m\u00e1quinas virtuales, para darles m\u00e1s memoria RAM o n\u00facleos de procesador, si se cree conveniente. instalar docker bitnami/Laravel Otra opci\u00f3n ( vamos a utilizar esta en nuestros equipos linux ) ser\u00e1 utilizar una stack de contenedores docker que contendr\u00e1 servidor Apache, servidor BBDD MariaDB, Laravel y phpMyadmin. Lo primero de todo es crear una carpeta con el nombre del proyecto y accedemos ella. Por ejemplo, creamos el proyecto prularavel dentro de nuestra carpeta de proyectos: Bash 1 $ mkdir ~/dwes/proyectos/nombreProyecto Accedemos dentro de la carpeta de este nuevo proyecto. Utilizar el fichero docker-compose.yml (que tenemos en nuestra carpeta del curso). Una vez descargado el archivo en nuestra carpeta que acabamos de crear con el nombre del proyecto, lanzamos el siguiente comando por consola para instalar todas las dependencias y crear las im\u00e1genes de Docker correspondientes. Bash 1 sudo docker-compose up -d Si utilizamos el contenedor Portainer para la gesti\u00f3n de nuestros contenedores, podremos observar que estar\u00e1n en marcha nuestros dos contenedores (pertenecientes al servidor web y servidor de bases de datos): aporte Un aporte, o instalaci\u00f3n, a tener en cuenta, podr\u00eda ser la de instalar Tailwind CSS . Este software nos va a proporcionar, de manera sencilla y c\u00f3moda, una opci\u00f3n de utilizar CSS. Para ello, seguir las instrucciones del anexos - instalaci\u00f3n de Tailwind CSS .","title":"Recursos adicionales"},{"location":"ud07/ud07_Laravel_1_Introduccion/#primeros-pasos-con-laravel","text":"Ahora que ya tenemos todo el sistema preparado para desarrollar proyectos Laravel, veamos los primeros pasos que debemos dar para crear estos proyectos. importante En este enlace podremos encontrar la documentaci\u00f3n oficial de Laravel (en este caso, la versi\u00f3n 10.x). No dudes en consultarlo cuando tengas dudas!","title":"Primeros pasos con Laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#crear-proyectos-laravel","text":"Para crear proyectos Laravel, tenemos dos alternativas: Emplear el comando laravel que hemos instalado en sesiones anteriores mediante composer Utilizar el propio comando composer para crear el proyecto. Esta opci\u00f3n ser\u00e1 la recomendada si queremos crear proyectos con versiones de Laravel que no sean la \u00faltima, o si por alg\u00fan motivo no funciona la opci\u00f3n anterior.","title":"Crear proyectos Laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#usando-el-comando-laravel","text":"Si empleamos el comando laravel para crear proyectos (asumiendo que ya lo tendremos instalado de la sesi\u00f3n de software necesario ), nos deberemos ubicar en la carpeta donde queramos crear el proyecto y escribir este comando: PHP 1 laravel new nombre_proyecto Por ejemplo, para las pruebas que iremos construyendo poco a poco en las siguientes sesiones, vamos a crear una web de libros, por lo que, en la carpeta donde queramos tener este proyecto, comenzamos escribiendo este comando: PHP 1 laravel new biblioteca Esto crear\u00e1 un proyecto biblioteca en una subcarpeta con el mismo nombre.","title":"Usando el comando laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#usando-el-comando-composer","text":"Alternativamente, tambi\u00e9n se puede emplear la herramienta composer para crear el proyecto, usando la siguiente sintaxis (tambi\u00e9n desde la carpeta donde queramos ubicar el proyecto): PHP 1 composer create-project --prefer-dist laravel/laravel nombre_proyecto En nuestro caso, para el ejemplo de la biblioteca que vamos a ir desarrollando, escribiremos este comando: PHP 1 composer create-project --prefer-dist laravel/laravel biblioteca Del mismo modo que en el caso anterior, se crear\u00e1 una carpeta biblioteca con el contenido inicial del proyecto dentro, empleando la \u00faltima versi\u00f3n de Laravel disponible.","title":"Usando el comando composer"},{"location":"ud07/ud07_Laravel_1_Introduccion/#crear-proyectos-laravel-usando-versiones-anteriores","text":"Al crear un proyecto con el comando laravel new , se crear\u00e1 con la \u00faltima versi\u00f3n disponible de Laravel. En el caso de que necesitemos crear un proyecto Laravel que no utilice la \u00faltima versi\u00f3n, sino alguna anterior, necesitamos utilizar la herramienta composer para especificar el n\u00famero de versi\u00f3n de Laravel que queremos utilizar. Por ejemplo, este comando crea un proyecto llamado \u201cprueba\u201d utilizando Laravel 7: PHP 1 composer create-project --prefer-dist laravel/laravel prueba 7.x","title":"Crear proyectos Laravel usando versiones anteriores"},{"location":"ud07/ud07_Laravel_1_Introduccion/#el-comando-artisan","text":"Cuando se crea un proyecto Laravel, se instala una herramienta llamada artisan en la ra\u00edz del proyecto. Es una interfaz de l\u00ednea de comandos (CLI, Command Line Interface ), que proporciona una serie de opciones adicionales que nos vendr\u00e1n bien en nuestra gesti\u00f3n de proyectos Laravel para, por ejemplo, crear controladores, migrar datos a una base de datos, etc. Para comprobar que est\u00e1 instalada y las opciones que ofrece, podemos escribir el siguiente comando en un terminal desde la carpeta del proyecto que hayamos creado: PHP 1 php artisan list Este otro comando muestra la versi\u00f3n de Laravel del proyecto en el que estamos: PHP 1 php artisan --version Para escribir estos comandos, podemos abrir la carpeta del proyecto con Visual Studio Code, y abrir el terminal integrado en este IDE (men\u00fa Ver > Terminal ). Esto nos ubicar\u00e1 autom\u00e1ticamente en la carpeta del proyecto, y podemos directamente ejecutar estos comandos desde ah\u00ed.","title":"El comando artisan"},{"location":"ud07/ud07_Laravel_1_Introduccion/#laravel-y-visual-studio-code","text":"Como hemos comentado, podemos gestionar muy c\u00f3modamente los proyectos Laravel desde el IDE Visual Studio Code. Basta con abrir la carpeta principal del proyecto desde el propio IDE, y eso puede hacerse desde el men\u00fa Archivo > Abrir Carpeta , o bien arrastrando la carpeta a la zona principal del IDE, e incluso, dependiendo de c\u00f3mo hayamos hecho la instalaci\u00f3n, tambi\u00e9n podemos hacer clic derecho sobre la carpeta del proyecto en el explorador de archivos, y elegir Abrir con Code en el men\u00fa contextual. Una vez abierto, tendremos la estructura del proyecto en la parte izquierda (pesta\u00f1a de explorador de archivos), y podremos ir editando los archivos en la parte derecha. Para facilitar a\u00fan m\u00e1s la gesti\u00f3n de proyectos Laravel, podemos instalar alguna extensi\u00f3n adicional a Visual Studio Code. Una de las m\u00e1s populares es Laravel Extension Pack , que a su vez contiene una serie de extensiones para resaltar sintaxis, editar vistas, etc:","title":"Laravel y Visual Studio Code"},{"location":"ud07/ud07_Laravel_1_Introduccion/#estructura-de-un-proyecto-laravel","text":"Los proyectos Laravel se pueden gestionar abriendo la carpeta directamente desde nuestro IDE (Visual Studio Code). Cuando creamos un proyecto Laravel, se crea una estructura de carpetas y archivos predefinida. Explicamos ahora brevemente en qu\u00e9 consisten las principales carpetas y archivos que se generan, de acuerdo a la versi\u00f3n actualizada de estos apuntes. php app : contiene el c\u00f3digo fuente de la aplicaci\u00f3n. Gran parte de las clases que definamos estar\u00e1n en esta carpeta. Inicialmente, se incluyen algunas subcarpetas dentro: Console : para definir nuestros propios comandos Exceptions : para definir nuestras propias excepciones Http : contiene los controladores y el middleware Models : almacena los modelos de datos de la aplicaci\u00f3n (clases que se utilizar\u00e1n para gestionar los objetos que intervienen en el sistema). Providers : contiene los proveedores de servicios de la aplicaci\u00f3n, m\u00e1s los que podamos definir nosotros. Adem\u00e1s, podemos definir aqu\u00ed otras carpetas que podamos necesitar. Por ejemplo, en versiones anteriores de Laravel se creaba aqu\u00ed a mano la carpeta Models para gestionar los modelos de datos. bootstrap : contiene el archivo app.php , que es el que pone en marcha la aplicaci\u00f3n. Adem\u00e1s, contiene la carpeta cache , donde se almacenan los archivos ya cargados por Laravel para acelerar su acceso en futuras peticiones. config : contiene los archivos de configuraci\u00f3n de la aplicaci\u00f3n, donde se tienen variables de entorno, o si nuestra aplicaci\u00f3n est\u00e1 en desarrollo o producci\u00f3n, o los par\u00e1metros de conexi\u00f3n a la base de datos, entre otras cosas. database : almacena los elementos de gesti\u00f3n de la base de datos, tales como generadores de objetos, migraciones, etc. public : contenido visible de la web. Contiene el archivo index.php , punto de entrada de todas las peticiones a la web, y adem\u00e1s podemos definir o generar carpetas donde ubicar el contenido est\u00e1tico del cliente (im\u00e1genes, hojas de estilo CSS, archivos JavaScript\u2026). resources : contiene, por un lado, las vistas de nuestra aplicaci\u00f3n. Por otro lado, tambi\u00e9n contiene archivos no compilados de CSS (archivos sass ) y JavaScript (archivos sin minimizar u optimizar). Adem\u00e1s, tambi\u00e9n almacena los archivos de traducci\u00f3n, en el caso de que queramos hacer sitios multi idioma. routes : almacena las rutas de la aplicaci\u00f3n, tanto para acceder a contenido web normal ( web.php ), como para servicios web ( api.php ), como para comandos y otras opciones. storage : contiene las vistas compiladas, y otros archivos generados por Laravel, como los logs o las sesiones. test : para almacenar los tests o pruebas sobre los componentes de nuestra aplicaci\u00f3n vendor : donde se almacenan las dependencias o librer\u00edas adicionales que se requieren en nuestro proyecto Laravel. Esta carpeta deber\u00eda ser ignorada por Git, y regenerada cada vez que se clone el repositorio remoto, para evitar almacenar demasiada informaci\u00f3n innecesaria. Aunque algunos de los conceptos vistos aqu\u00ed pueden no estar claros a\u00fan (como el concepto de middleware , o los proveedores de servicios), los iremos viendo poco a poco durante el curso.","title":"Estructura de un proyecto Laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#configuracion-general-del-proyecto","text":"De entre la estructura de carpetas de un proyecto Laravel vista anteriormente, echaremos ahora un r\u00e1pido vistazo a d\u00f3nde se encuentra la configuraci\u00f3n general del proyecto. Por un lado, disponemos de un archivo .env en la ra\u00edz del proyecto, que b\u00e1sicamente contiene una serie de variables de entorno generales. Por ejemplo, se tiene la variable APP_NAME con el nombre que queremos que tenga la aplicaci\u00f3n, o un conjunto de variables que utilizaremos m\u00e1s adelante para conectar con la base de datos, entre otras cosas: PHP 1 2 3 4 5 6 7 8 9 APP_NAME=Laravel ... DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=laravel DB_USERNAME=root DB_PASSWORD= ... En general, los cambios de configuraci\u00f3n es preferible hacerlos en este archivo .env , de forma que en los archivos de la carpeta config accederemos a estas variables de entorno definidas en env . Por ejemplo, podemos definir las propiedades del archivo .env de este modo para el proyecto biblioteca que hemos creado anteriormente: PHP 1 2 3 4 5 6 7 8 9 APP_NAME=Biblioteca ... DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=biblioteca DB_USERNAME=root DB_PASSWORD= ... NOTA: Adem\u00e1s, el archivo .env est\u00e1 configurado (o debe configurarse, de lo contrario) para ser ignorado por Git, de modo que no se suba a repositorios, y se evite un acceso a datos confidenciales que pongan en riesgo el acceso al sistema. Por otra parte, la carpeta config contiene unos archivos generales de configuraci\u00f3n. Iremos viendo algunos de ellos en sesiones posteriores, pero, para empezar, podemos echar un vistazo al archivo config/app.php , que contiene par\u00e1metros de configuraci\u00f3n general de la aplicaci\u00f3n. Por ejemplo, podemos modificar el nombre de la aplicaci\u00f3n, en la propiedad name , aunque, como vemos, el nombre lo coge de la propiedad APP_NAME del archivo .env . PHP 1 'name' => env('APP_NAME', 'Laravel'), Es m\u00e1s habitual modificar los valores del archivo .env que los que hay en este archivo de configuraci\u00f3n. Pero, en algunos casos, s\u00ed convendr\u00e1 acudir a alguno de los archivos de esta carpeta y modificar la informaci\u00f3n que contiene.","title":"Configuraci\u00f3n general del proyecto"},{"location":"ud07/ud07_Laravel_1_Introduccion/#arquitectura-de-un-proyecto-laravel","text":"Una vez vista la estructura de carpetas y archivos que se genera cuando creamos un proyecto Laravel, es importante tambi\u00e9n tener unas nociones b\u00e1sicas de c\u00f3mo se interconectan los elementos internamente, y qu\u00e9 hace que un proyecto Laravel se pueda poner en marcha.","title":"Arquitectura de un proyecto Laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#los-proveedores-de-servicios-service-providers","text":"Los proveedores de servicios son los principales responsables del arranque o puesta en marcha de todo proyecto Laravel, lo que se conoce como bootstrapping . Se encargan de registrar los componentes del proyecto, dependencias externas, clases y m\u00e9todos definidos por nosotros, para hacerlos accesibles al resto de la aplicaci\u00f3n. Si abrimos el archivo config/app.php de nuestro proyecto Laravel, veremos entre otras cosas una secci\u00f3n denominada providers , donde se define un array con todos los proveedores de servicios que se ponen en marcha al arrancar la aplicaci\u00f3n. Por ejemplo, hay proveedores de servicios para acceso a la base de datos ( DatabaseServiceProvider ), autenticaci\u00f3n de usuarios ( AuthServiceProvider ), etc.","title":"Los proveedores de servicios (service providers)"},{"location":"ud07/ud07_Laravel_1_Introduccion/#las-clases-del-nucleo-de-laravel","text":"Para poder desarrollar los componentes de las aplicaciones Laravel, es necesario contar con una infraestructura previa de clases que nos faciliten esta tarea. As\u00ed, a lo largo de las siguientes sesiones haremos uso de algunas clases proporcionadas por Laravel que vienen preinstaladas con el framework, tales como Model , Route , etc, y que nos permiten o bien heredar de ellas para crear otras subclases (como es el caso de los modelos de datos) o bien utilizar algunos m\u00e9todos de utilidad que estas clases proporcionan (como es el caso de la clase Route , por ejemplo). Conviene tener presente que todas estas clases pertenecientes al n\u00facleo de Laravel parten de un espacio de nombres com\u00fan llamado Illuminate , por lo que, en los archivos fuente donde las utilicemos, ser\u00e1 frecuente encontrar instrucciones use que comiencen por dicho espacio de nombres. Por ejemplo: PHP 1 use Illuminate\\Database\\Eloquent\\Model;","title":"Las clases del n\u00facleo de Laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#otros-elementos","text":"Adem\u00e1s de los dos pilares anteriores sobre los que se sustenta fundamentalmente el desarrollo de proyectos en Laravel, podemos hablar de otros elementos que nos pueden resultar de utilidad en el desarrollo, como son los facades y los contracts . Las facades proporcionan una interfaz est\u00e1tica a los elementos de la aplicaci\u00f3n, de forma que facilitan el acceso a ciertos m\u00e9todos o utilidades. Por ejemplo, la facade Cache permite acceder de forma sencilla con su m\u00e9todo get a ciertas propiedades cacheadas previamente. PHP 1 return Cache::get('key'); Los contracts son un conjunto de interfaces que proporcionan el n\u00facleo de servicios ofrecidos por Laravel. Por ejemplo, m\u00e9todos para enviar e-mails, o encolar tareas en una cola de prioridad, etc.","title":"Otros elementos"},{"location":"ud07/ud07_Laravel_1_Introduccion/#prueba-de-proyectos-laravel","text":"Existen varias formas de probar o poner en marcha un proyecto Laravel, dependiendo de si estamos desarroll\u00e1ndolo y prob\u00e1ndolo (en cuyo caso buscamos ponerlo en marcha f\u00e1cilmente), o si ya lo hemos puesto en producci\u00f3n. Resumidamente, veremos tres formas de poner en marcha el proyecto: De forma local al proyecto, a trav\u00e9s de la herramienta artisan De forma local a XAMPP, ubicando el proyecto en una carpeta predefinida De forma general en el sistema, definiendo un host virtual conectado con Apache La tercera forma ser\u00e1 la que necesitemos utilizar si queremos poner la web en producci\u00f3n en un servidor real, ya que en estos casos cada aplicaci\u00f3n tiene su propia configuraci\u00f3n y ubicaci\u00f3n diferente al resto. Las otras dos primeras opciones pueden resultarnos \u00fatiles para pruebas sencillas durante el desarrollo.","title":"Prueba de proyectos Laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#permisos-en-carpetas-del-proyecto","text":"Para poder probar nuestro proyecto Laravel, adem\u00e1s de configurar y poner en marcha el servidor correspondiente es necesario habilitar permisos de acceso y escritura a ciertas carpetas del proyecto, especialmente en sistemas Linux o Mac, si movemos el proyecto a una carpeta con permisos reducidos. Carpeta storage junto con sus subcarpetas y contenidos. En esta carpeta se compilar\u00e1n las vistas, se generar\u00e1n los archivos de log, etc, por lo que conviene que esta carpeta tenga permisos de escritura. Subcarpeta bootstrap/cache , donde se almacenar\u00e1 la cach\u00e9 de los archivos ya cargados. Para habilitar los permisos en estas carpetas bajo Linux o Mac OSX, podemos ejecutar estos comandos desde la ra\u00edz del proyecto (la opci\u00f3n -R aplica los permisos de forma recursiva): Bash 1 2 3 sudo chmod -R 777 bootstrap/cache sudo chmod -R 777 storage sudo chmod -R 777 storage/logs NOTA El tercer comando no ser\u00eda necesario en principio, ya que la subcarpeta logs est\u00e1 dentro de la carpeta storage , y se aplican los cambios de forma recursiva. Sin embargo, es posible que en algunas situaciones esta subcarpeta se cree a posteriori y no tenga los permisos adecuados. Comprobaremos al cargar la aplicaci\u00f3n desde el navegador si existe alg\u00fan error al inicio. En este caso, el propio error indicar\u00e1 que no puede generar el log , y deberemos escribir ese comando.","title":"Permisos en carpetas del proyecto"},{"location":"ud07/ud07_Laravel_1_Introduccion/#puesta-en-marcha-con-el-comando-artisan","text":"La forma m\u00e1s sencilla de probar nuestro proyecto es a trav\u00e9s del comando artisan . Nos ubicamos en la carpeta ra\u00edz del proyecto (recuerda que esto se puede hacer autom\u00e1ticamente abriendo la carpeta con Visual Studio Code y abriendo su terminal), y ejecutamos este comando: PHP 1 php artisan serve Esto habilitar\u00e1 un peque\u00f1o servidor local, y se nos indicar\u00e1 en un mensaje en el terminal la URL que podemos emplear para probar el proyecto, que suele ser algo as\u00ed: PHP 1 Starting Laravel development server: http://127.0.0.1:8000 Conectando a la URL que se nos facilita, veremos la pantalla de inicio de nuestro proyecto, que ser\u00e1 algo as\u00ed (aunque el dise\u00f1o de la p\u00e1gina de inicio puede variar dependiendo de la versi\u00f3n de Laravel que usemos): M\u00e1s adelante aprenderemos a modificar esta p\u00e1gina de inicio, obviamente, y a ir a\u00f1adiendo otras. NOTA : si nuestra aplicaci\u00f3n necesita acceder a una base de datos, adem\u00e1s de arrancarla con el comando artisan visto antes, tambi\u00e9n tendremos que tener en marcha el servidor de bases de datos correspondiente, a trav\u00e9s del manager de XAMPP.","title":"Puesta en marcha con el comando artisan"},{"location":"ud07/ud07_Laravel_1_Introduccion/#puesta-en-marcha-en-carpeta-predefinida-de-xampp","text":"Como segunda alternativa relativamente r\u00e1pida, podemos ubicar la carpeta del proyecto dentro de la carpeta predefinida de XAMPP para alojar webs: En el caso de Windows es la carpeta htdocs dentro de la carpeta de instalaci\u00f3n de XAMPP. T\u00edpicamente la ruta es C:\\xampp\\htdocs En el caso de Linux , en particular en la distribuci\u00f3n de nuestra m\u00e1quina virtual, es la carpeta /opt/lampp/htdocs En el caso de Mac OSX , la ruta es /Applications/XAMPP/xamppfiles/htdocs Por ejemplo, si nuestro proyecto se llama biblioteca y queremos moverlo a esta carpeta en Linux, escribimos este comando desde la carpeta que contiene nuestro proyecto: Bash 1 sudo mv biblioteca /opt/lampp/htdocs A continuaci\u00f3n debemos poner en marcha el servidor Apache (empleando el manager de XAMPP), y luego acceder a la URL http://localhost/biblioteca/public . Obtendremos la misma p\u00e1gina de inicio que en el caso anterior. NOTA : al mover la carpeta del proyecto a la ubicaci\u00f3n de XAMPP en Linux, ten en cuenta que esa carpeta es de acceso restringido. Deberemos dar permisos a las carpetas indicadas en la secci\u00f3n 4.1 para que la aplicaci\u00f3n se pueda poner en marcha adecuadamente.","title":"Puesta en marcha en carpeta predefinida de XAMPP"},{"location":"ud07/ud07_Laravel_1_Introduccion/#puesta-en-marcha-como-host-virtual","text":"En el caso de una puesta en producci\u00f3n real, o si queremos dejar una aplicaci\u00f3n correctamente configurada con Apache, hay que realizar una serie de pasos previos, tales como asociarlo a un virtual host (de Apache, en nuestro caso). A continuaci\u00f3n indicamos los pasos a seguir, y conviene tener presente que: El paso 1 deberemos hacerlo s\u00f3lo una vez , cuando demos de alta nuestro primer virtual host con Apache. El resto de pasos deberemos hacerlos una vez por proyecto para configurar dicho proyecto en Apache y establecer los permisos adecuados. 1. Habilitar los *virtual hosts* en Apache Los virtual hosts son un mecanismo que ofrecen los servidores web, como Apache, para poder asociar carpetas arbitrarias del sistema, externas a la estructura de Apache, al propio servidor, de forma que, accediendo a una URL o nombre de dominio determinado, le indicamos a Apache que cargue los contenidos de esa carpeta. En primer lugar debemos habilitar los virtual hosts en Apache, editando el archivo de configuraci\u00f3n de Apache: Archivo /opt/lampp/etc/httpd.conf en Linux Archivo C:\\xampp\\apache\\conf\\httpd.conf de la carpeta de instalaci\u00f3n de XAMPP en Windows (suponiendo que lo hemos instalado en C:\\xampp ) Archivo /Applications/XAMPP/xamppfiles/etc/httpd.conf en Mac OSX En todos los casos, debemos asegurarnos de que est\u00e1 descomentada la l\u00ednea que hace referencia al lugar donde se definen dichos virtual hosts . Debe quedar as\u00ed en Linux y Mac OSX: PHP 1 2 # Virtual hosts Include etc/extra/httpd-vhosts.conf O as\u00ed en Windows, por ejemplo: PHP 1 2 # Virtual hosts Include conf/extra/httpd-vhosts.conf 2. A\u00f1adir el nuevo nombre de dominio Despu\u00e9s, debemos editar el archivo hosts del sistema y asignar un nombre de dominio (local) a nuestro proyecto. Dicho archivo de hosts es: /etc/hosts en Linux C:\\Windows\\System32\\drivers\\etc\\hosts en Windows /private/etc/hosts en Mac OSX Por ejemplo, para el proyecto biblioteca que hemos creado antes, podr\u00edamos definir algo como esto (al final, o entre los otros registros de nombres existentes en dicho archivo): PHP 1 127.0.0.5 biblioteca Lo que hemos hecho ha sido asignar la IP local 127.0.0.5 (puede ser la IP local que nosotros queramos) al nombre \u201cbiblioteca\u201d. De este modo, cuando carguemos localmente el proyecto podremos acceder a \u00e9l mediante la URL http://biblioteca o bien con http://127.0.0.5 . 3. Definir la configuraci\u00f3n del nuevo *virtual host* A continuaci\u00f3n, debemos editar el archivo al que hac\u00eda referencia la l\u00ednea que hemos descomentado antes en el paso 1: el archivo httpd-vhosts.conf , y a\u00f1adir una nueva configuraci\u00f3n para nuestro nuevo virtual host . Por ejemplo: Bash 1 2 3 4 5 6 7 8 9 10 <VirtualHost 127 .0.0.5:80> DocumentRoot \"/home/alumno/ProyectosLaravel/biblioteca/public\" DirectoryIndex index.php <Directory \"/home/alumno/ProyectosLaravel/biblioteca/public\" > Options All AllowOverride All Require all granted </Directory> </VirtualHost> NOTA : la ruta indicada en el atributo DocumentRoot depender\u00e1, evidentemente, de la ruta donde tengamos alojado nuestro proyecto biblioteca . El ejemplo anterior se ha ilustrado suponiendo que el proyecto biblioteca se ubica en una carpeta ProyectosLaravel en la carpeta de usuario de nuestra m\u00e1quina virtual.","title":"Puesta en marcha como host virtual"},{"location":"ud07/ud07_Laravel_1_Introduccion/#importando-exportando-un-proyecto-laravel","text":"Vamos a indicar ahora unas instrucciones necesarias en el caso de que queramos importar un proyecto Laravel a un nuevo ordenador, o llevarlo a otro diferente, descarg\u00e1ndolo de, por ejemplo, un repositorio GitHub, o comprimido en un archivo ZIP o similar. Dado que ciertas carpetas y archivos no se suben a dicho repositorio (o no deber\u00edan subirse), es conveniente saber c\u00f3mo regenerar estos elementos en la nueva ubicaci\u00f3n del proyecto.","title":"Importando / Exportando un proyecto Laravel"},{"location":"ud07/ud07_Laravel_1_Introduccion/#exportar-un-proyecto","text":"Si queremos exportar o compartir un proyecto Laravel de forma externa, podemos: Compartirlo en un repositorio remoto tipo GitHub o similar. En este caso, el propio archivo .gitignore que se crea en el proyecto indica qu\u00e9 elementos no van a subirse al repositorio. De entre estos elementos, conviene destacar el archivo de configuraci\u00f3n .env , y las carpetas vendor y node_modules . Comprimirlo en un archivo que poder distribuir o instalar en otras partes. En este caso, debemos tomar las mismas precauciones que cuando lo compartimos v\u00eda GitHub, y eliminar los elementos que no sean necesarios. NOTA IMPORTANTE : cuando comprimas un proyecto Laravel, procura comprimir la carpeta entera desde fuera, para as\u00ed incluir tambi\u00e9n los archivos ocultos, como .env.example . De lo contrario, no ser\u00e1 posible poner en marcha el proyecto en el lugar donde se utilice. As\u00ed que, simplemente, elimina las carpetas pesadas ( vendor y node_modules ), archivos que no quieras compartir directamente ( .env , si es el caso) sal a la carpeta padre y compr\u00edmela.","title":"Exportar un proyecto"},{"location":"ud07/ud07_Laravel_1_Introduccion/#importar-un-proyecto-existente","text":"A la hora de importar en un nuevo ordenador un proyecto existente (bien descarg\u00e1ndolo de GitHub, o descomprimi\u00e9ndolo de un archivo ZIP), debemos dar estos pasos (una vez descargado o descomprimido el proyecto). 1. El archivo de configuraci\u00f3n de variables de entorno *.env* Como hemos comentado antes, el archivo .env es uno de los que no se incluye por defecto en un repositorio GitHub, ya que contiene informaci\u00f3n sensible, como la contrase\u00f1a de acceso a la base de datos. Sin embargo, lo que s\u00ed se incluye es una copia inicial del mismo, en el archivo .env.backup o .env.example , dependiendo de la versi\u00f3n de Laravel que utilicemos. Basta con hacer una copia de dicho archivo en la carpeta ra\u00edz del proyecto\u2026 Bash 1 cp .env.example .env \u2026 y luego editar dicho archivo para establecer la configuraci\u00f3n oportuna en el lugar donde hayamos importado el proyecto: par\u00e1metros de conexi\u00f3n a la base de datos, y otras variables de entorno que iremos viendo en este curso. 2. La clave del proyecto Laravel necesita de una clave en la variable de entorno APP_KEY del archivo .env anterior, que por defecto est\u00e1 vac\u00eda. Dicha clave es un c\u00f3digo aleatorio de 32 caracteres, que Laravel emplea para encriptar cookies. Podemos generar una clave con el comando php artisan (desde la ra\u00edz del proyecto): PHP 1 php artisan key:generate y ya la tendremos lista en nuestro archivo .env . 3. Dependencias PHP Otro de los elementos del proyecto que no se comparte en repositorios es la carpeta vendor , donde vienen descargadas las dependencias PHP de nuestro proyecto. Por defecto, al generar un nuevo proyecto Laravel, se presuponen algunas de ellas, incluidas en el archivo composer.json de la ra\u00edz del proyecto. Para volverlas a instalar en donde hayamos clonado el proyecto, ejecutamos este comando desde la ra\u00edz del proyecto (suponiendo que ya tengamos instalado el comando composer de pasos anteriores): PHP 1 composer install 4. Dependencias JavaScript Del mismo modo, existen algunas dependencias para la parte de cliente (como por ejemplo Bootstrap , o jQuery ), definidas en el archivo package.json de la ra\u00edz del proyecto, y que se encuentran preinstaladas en la carpeta node_modules . Esta carpeta, sin embargo, tampoco se comparte en el repositorio, as\u00ed que para volverla a generar en el proyecto clonado, y suponiendo que tambi\u00e9n tendremos instalada la herramienta npm de pasos anteriores, ejecutamos el comando siguiente desde la ra\u00edz del proyecto: Bash 1 npm install","title":"Importar un proyecto existente"},{"location":"ud07/ud07_Laravel_1_Introduccion/#referencias","text":"Nacho Iborra Baeza .","title":"referencias"},{"location":"ud07/ud07_Laravel_1_Introduccion_actividades/","text":"unit: unidad did\u00e1ctica 7 title: Laravel - Introducci\u00f3n (actividades) language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets licencia : el uso de estos materiales est\u00e1 sujeto a licencia Creative Commons CC BY-NC . material : extra\u00eddo de https://nachoiborraies.github.io/laravel/ ejercicios propuestos Ejercicio 1 Ejercicio 2 bibliografia ejercicios propuestos Ejercicio 1 Crea un proyecto Laravel llamado blog . Ponlo en marcha con el comando php artisan serve e intenta acceder a \u00e9l desde el navegador. Captura la pantalla del navegador, de modo que incluya tanto la p\u00e1gina de inicio que se muestra como la URL de la barra de direcciones. Guarda la captura como captura01 , en formato JPG o PNG. Ejercicio 2 Sobre el proyecto del ejercicio anterior, configura un virtual host en Apache con el mismo nombre de host ( blog ), y as\u00f3cialo a una IP local (la que t\u00fa quieras, por ejemplo, 127.0.0.6). Prueba a acceder a la p\u00e1gina de inicio de este nuevo proyecto (con http://blog o con http://127.0.0.6 ). Captura la pantalla del navegador, mostrando la p\u00e1gina de inicio y la URL de la barra de direcciones. Guarda la captura como captura02 , en formato JPG o PNG. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_07d.zip . bibliografia Nacho Iborra Baeza .","title":"ud07 Laravel 1 Introduccion actividades"},{"location":"ud07/ud07_Laravel_1_Introduccion_actividades/#ejercicios-propuestos","text":"","title":"ejercicios propuestos"},{"location":"ud07/ud07_Laravel_1_Introduccion_actividades/#ejercicio-1","text":"Crea un proyecto Laravel llamado blog . Ponlo en marcha con el comando php artisan serve e intenta acceder a \u00e9l desde el navegador. Captura la pantalla del navegador, de modo que incluya tanto la p\u00e1gina de inicio que se muestra como la URL de la barra de direcciones. Guarda la captura como captura01 , en formato JPG o PNG.","title":"Ejercicio 1"},{"location":"ud07/ud07_Laravel_1_Introduccion_actividades/#ejercicio-2","text":"Sobre el proyecto del ejercicio anterior, configura un virtual host en Apache con el mismo nombre de host ( blog ), y as\u00f3cialo a una IP local (la que t\u00fa quieras, por ejemplo, 127.0.0.6). Prueba a acceder a la p\u00e1gina de inicio de este nuevo proyecto (con http://blog o con http://127.0.0.6 ). Captura la pantalla del navegador, mostrando la p\u00e1gina de inicio y la URL de la barra de direcciones. Guarda la captura como captura02 , en formato JPG o PNG. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_07d.zip .","title":"Ejercicio 2"},{"location":"ud07/ud07_Laravel_1_Introduccion_actividades/#bibliografia","text":"Nacho Iborra Baeza .","title":"bibliografia"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/","text":"unit: unidad did\u00e1ctica 7 title: Laravel - Rutas y Vistas language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets licencia : el uso de estos materiales est\u00e1 sujeto a licencia Creative Commons CC BY-NC . material : extra\u00eddo de https://nachoiborraies.github.io/laravel/ rutas Rutas simples Rutas con par\u00e1metros Validaci\u00f3n de par\u00e1metros Rutas con nombre o named routes Combinaci\u00f3n de elementos en rutas Otros m\u00e9todos de Route vistas Pasar valores a las vistas Primeros pasos con el motor de plantillas Blade Estructuras de control de flujo en Blade Sobre los enlaces a otras rutas Definir plantillas comunes Incluir vistas dentro de otras Estructurar vistas en carpetas Vistas para p\u00e1ginas de error estilos y Javascript Infraestructura para archivos CSS y JavaScript Generaci\u00f3n autom\u00e1tica de CSS y JavaScript Generaci\u00f3n con Laravel mix Generaci\u00f3n con Vite Incluir estilos Bootstrap bibliografia rutas Las rutas ( routes ) son un mecanismo que permite a Laravel establecer qu\u00e9 respuesta enviar a una petici\u00f3n que intenta acceder a una determinada URL. Estas rutas se especifican en diferentes archivos dentro de la carpeta routes de nuestro proyecto Laravel. Podr\u00edamos decir que existen dos tipos principales de rutas: Las rutas web (almacenadas en el archivo routes/web.php de la aplicaci\u00f3n), que nos permitir\u00e1n cargar distintas vistas en funci\u00f3n de la URL que indique el cliente. Las rutas API (almacenadas en el archivo routes/api.php ), a trav\u00e9s de las cuales definiremos distintos servicios REST, como veremos tambi\u00e9n m\u00e1s adelante. Nos vamos a centrar durante esta sesi\u00f3n en el primer grupo, por lo que editaremos el contenido del archivo routes/web.php . Estas rutas son las m\u00e1s habituales, y se utilizan para recuperar contenidos t\u00edpicamente en formato HTML. Inicialmente ya existe una ruta predefinida hacia la ra\u00edz del proyecto, que carga la p\u00e1gina de bienvenida al mismo: PHP 1 2 3 4 5 6 7 8 9 <?php use Illuminate\\Support\\Facades\\Route ; // Ruta por defecto para cargar la vista welcome (sin extensi\u00f3n .blade.php) // cuando el usuario introduce simplemente el dominio Route :: get ( '/' , function () { return view ( 'welcome' ); }); Para definir una ruta en Laravel, se hace una llamada a un m\u00e9todo est\u00e1tico de la clase Route (en el ejemplo anterior, al m\u00e9todo Route::get ). Como primer par\u00e1metro, especificaremos la URL de la ruta (la ruta ra\u00edz, en el ejemplo anterior), y como segundo par\u00e1metro, la funci\u00f3n que se va a ejecutar ( callback o closure ) cuando alg\u00fan cliente haga una petici\u00f3n a esa ruta. closure VS controlador : Se puede definir en el segundo par\u00e1metro del m\u00e9todo Route::get un closure o un controlador (veremos este segundo caso m\u00e1s adelante). Por ejemplo: PHP 1 Route::get('/libros', [LibroController::class, 'index']) -> name('libros'); Rutas simples Las rutas simples tienen un nombre de ruta fijo, y una funci\u00f3n que responde a dicho nombre emitiendo una respuesta. Un ejemplo es la ruta ra\u00edz que viene por defecto en nuestro proyecto. Podr\u00edamos definir otra ruta a continuaci\u00f3n de esa, mediante la cual, si accedemos a la URL http://biblioteca/fecha nos muestre la fecha y hora actuales: PHP 1 2 3 Route::get('fecha', function() { return date(\"d/m/y h:i:s\"); }); Si ponemos en marcha el servidor y accedemos a esa URL (o a http://127.0.0.1:8000/fecha si hemos lanzado la aplicaci\u00f3n con php artisan serve ), podremos ver esa fecha y hora actual. realizar ejercicio 1 . Rutas con par\u00e1metros Es tambi\u00e9n posible pasar par\u00e1metros en la URL de la ruta. Para ello, incluimos el nombre del par\u00e1metro entre llaves, y lo pasamos tambi\u00e9n a la funci\u00f3n del segundo par\u00e1metro. Por ejemplo, si definimos una ruta para saludar al nombre que nos llega como par\u00e1metro, el c\u00f3digo quedar\u00eda as\u00ed: PHP 1 2 3 Route::get('saludo/{nombre}', function($nombre) { return \"Hola, \" . $nombre; }); En este caso, si el par\u00e1metro es obligatorio y no lo indicamos en la URL, nos redirigir\u00e1 a una p\u00e1gina de error 404 . Para indicar que un par\u00e1metro no es obligatorio, se termina su nombre con un interrogante ? , y tambi\u00e9n conviene darle un valor por defecto en la funci\u00f3n PHP de respuesta. As\u00ed modificar\u00edamos la ruta anterior para que el nombre del usuario sea opcional y, en caso de no ponerlo, se le asigne el nombre \u201cInvitado\u201d: PHP 1 2 3 Route::get('saludo/{nombre?}', function($nombre = \"Invitado\") { return \"Hola, \" . $nombre; }); Validaci\u00f3n de par\u00e1metros Algunos par\u00e1metros ser\u00e1 preciso que sigan un determinado patr\u00f3n. Por ejemplo, un identificador num\u00e9rico s\u00f3lo contendr\u00e1 d\u00edgitos. Para asegurarnos de eso, podemos emplear el m\u00e9todo where al definir la ruta. A este m\u00e9todo le pasamos dos par\u00e1metros: el nombre del par\u00e1metro a validar, y la expresi\u00f3n regular que tiene que cumplir. En el caso del nombre anterior, si queremos que s\u00f3lo contenga letras (may\u00fasculas o min\u00fasculas), podemos hacer algo as\u00ed: PHP 1 2 3 Route::get('saludo/{nombre?}', function($nombre = \"Invitado\") { return \"Hola, \" . $nombre; }) -> where('nombre', \"[A-Za-z]+\"); En caso de que la ruta no cumpla el patr\u00f3n, se obtendr\u00e1 una p\u00e1gina de error. M\u00e1s adelante se explicar\u00e1 c\u00f3mo podemos personalizar estas p\u00e1ginas de error. realizar ejercicio 2 . Rutas con nombre o named routes En ocasiones puede ser conveniente asociar un nombre a una ruta. Especialmente, cuando esa ruta va a formar parte de un enlace en alguna p\u00e1gina de nuestro sitio, ya que en un futuro la ruta podr\u00eda cambiar, y de este modo evitamos tener que actualizar los enlaces con el nuevo nombre. Para ello, al definir la ruta, le asociamos con la funci\u00f3n name el nombre que queramos. Por ejemplo: PHP 1 2 3 Route::get('contacto', function() { return \"P\u00e1gina de contacto\"; }) -> name('ruta_contacto'); Ahora, si queremos definir un enlace a esta ruta en cualquier parte, basta con emplear la funci\u00f3n route de Laravel, indicando el nombre que le hemos asignado a esta ruta. Por lo tanto, en lugar de poner esto: PHP 1 echo '<a href=\"/contacto\">Contacto</a>'; Podemos hacer algo como esto otro, tal y como veremos m\u00e1s adelante cuando definamos nuestras vistas: PHP 1 <a href=\"{{ route('ruta_contacto') }}\">Contacto</a> De este modo, ante futuros cambios en las rutas, s\u00f3lo deberemos cambiar la URL en el correspondiente Route::get de routes/web.php . Combinaci\u00f3n de elementos en rutas Podemos combinar varias cl\u00e1usulas where en una ruta para validar distintos par\u00e1metros que pueda tener, y tambi\u00e9n enlazar estas llamadas con una a la funci\u00f3n name para nombrar la ruta. Por ejemplo, la siguiente ruta espera recibir un nombre con caracteres, y un id num\u00e9rico, ambos con valores por defecto: PHP 1 2 3 4 5 Route::get('saludo/{nombre?}/{id?}', function($nombre=\"Invitado\", $id=0) { return \"Hola $nombre, tu c\u00f3digo es el $id\"; }) -> where('nombre', \"[A-Za-z]+\") -> where('id', \"[0-9]+\") -> name('saludo'); Si accedemos a cada una de las siguientes URLs, obtendremos cada una de las respuestas indicadas: URL Respuesta /saludo Hola Invitado, tu c\u00f3digo es el 0 /saludo/Nacho Hola Nacho, tu c\u00f3digo es el 0 /saludo/Nacho/3 Hola Nacho, tu c\u00f3digo es el 3 /saludo/3 Error 404 (URL incorrecta) Notar que el \u00faltimo caso es incorrecto. No podemos especificar un id sin haber especificado un nombre delante, porque incumple el patr\u00f3n de la URL. Se puede dejar un par\u00e1metro omitido, siempre y cuando los posteriores tambi\u00e9n lo est\u00e9n. Otros m\u00e9todos de Route Adem\u00e1s de utilizar el m\u00e9todo get , desde la clase Route tambi\u00e9n podemos acceder a otros m\u00e9todos est\u00e1ticos \u00fatiles, como Route::post (\u00fatil para recoger datos de formularios, por ejemplo), o tambi\u00e9n Route::put , Route::delete \u2026 Los veremos con m\u00e1s detalle en secciones posteriores. vistas Hasta ahora las rutas que hemos definido devuelven un texto simple, salvo la que ya estaba creada por defecto en el proyecto, que apuntaba a la p\u00e1gina de inicio. Si quisi\u00e9ramos devolver contenido HTML, una opci\u00f3n (costosa) ser\u00eda devolver dicho contenido generado desde el propio m\u00e9todo de la ruta, a trav\u00e9s de la instrucci\u00f3n return , pero en lugar de hacer esto desde dentro de la propia funci\u00f3n de respuesta, lo m\u00e1s habitual (y recomendable) es generar una vista con el contenido HTML que se quiere enviar al cliente. La forma general de mostrar vistas en Laravel es hacer que las rutas devuelvan ( return ) una determinada vista. Para ello, se puede emplear la funci\u00f3n view de Laravel, indicando el nombre de la vista a generar o mostrar. Por defecto, en la carpeta resources/views tenemos disponible una vista de ejemplo llamada welcome.blade.php . Es la que se utiliza como p\u00e1gina de inicio en la ruta ra\u00edz en routes/web.php : PHP 1 2 3 Route::get('/', function() { return view('welcome'); }); A trav\u00e9s de las plantillas de Laravel vamos a escribir menos c\u00f3digo PHP y vamos a tener nuestros archivos mejor organizados . Blade es el sistema de plantillas que trae Laravel, por eso los archivos de plantillas que guardamos en el directorio de views llevan la extensi\u00f3n blade.php . De esta manera sabemos inmediatamente que se trata de una plantilla de Laravel y que forma parte de una vista que se mostrar\u00e1 en el navegador. nota : no es necesario indicar el path o ruta hacia el archivo de la vista, ni tampoco la extensi\u00f3n, puesto que Laravel asume que por defecto las vistas se encuentran en la carpeta resources/views , con la extensi\u00f3n .blade.php (que hace referencia al motor de plantillas Blade que veremos a continuaci\u00f3n), o simplemente con extensi\u00f3n .php (en el caso de vistas simples que no utilicen Blade). Podemos, por ejemplo, crear una vista sencilla dentro de esta carpeta de vistas (llam\u00e9mosla inicio.blade.php ), con un contenido HTML b\u00e1sico: Text Only 1 2 3 4 5 6 7 8 <html> <head> <title>Inicio</title> </head> <body> <h1>P\u00e1gina de inicio</h1> </body> </html> Y podemos utilizar esta vista como p\u00e1gina de inicio: PHP 1 2 3 Route::get('/', function() { return view('inicio'); }); Pasar valores a las vistas Es muy habitual pasar cierta informaci\u00f3n a ciertas vistas, como por ejemplo, listados de datos a mostrar, o datos de un elemento en concreto. Por ejemplo, si queremos dar un mensaje de bienvenida a un nombre (supuestamente variable), debemos almacenar el nombre en una variable en la ruta, y pas\u00e1rselo a la vista al cargarla. Esto puede hacerse, por ejemplo, con el m\u00e9todo with tras generar la vista, indicando el nombre con que lo vamos a asociar a la vista, y el valor (variable) asociado a dicho nombre. En nuestro caso quedar\u00eda as\u00ed: PHP 1 2 3 4 Route::get('/', function() { $nombre = \"Nacho\"; return view('inicio')->with('nombre', $nombre); }); Posteriormente, en la vista, deberemos mostrar el valor de esta variable en alg\u00fan lugar del c\u00f3digo HTML. Podemos emplear PHP tradicional para recoger esta variable: Text Only 1 2 3 4 5 6 7 8 9 <html> <head> <title>Inicio</title> </head> <body> <h1>P\u00e1gina de inicio</h1> <p>Bienvenido/a <?php echo $nombre; ?></p> </body> </html> Pero es m\u00e1s habitual y limpio emplear una sintaxis espec\u00edfica de Blade, como veremos a continuaci\u00f3n. Como alternativas al uso de with comentado antes, tambi\u00e9n podemos utilizar un array asociativo (asignando as\u00ed varios nombres a varios valores): PHP 1 return view('inicio')->with(['nombre' => $nombre, ...]); Asimismo, podemos utilizar este mismo array como segundo par\u00e1metro de la funci\u00f3n view , y prescindir as\u00ed de with : PHP 1 return view('inicio', ['nombre' => $nombre, ...]); Y tambi\u00e9n podemos utilizar una funci\u00f3n llamada compact como segundo par\u00e1metro de view . A esta funci\u00f3n le pasamos \u00fanicamente el nombre de la variable que usaremos en la vista y, siempre que la variable asociada se llame igual, establece la asociaci\u00f3n por nosotros: PHP 1 return view('inicio', compact('nombre')); La funci\u00f3n compact admite tantos par\u00e1metros como datos queramos enviar a la vista por separado, cada uno con su nombre asociado. Si simplemente vamos a devolver una vista con poca informaci\u00f3n asociada, o poca l\u00f3gica interna, tambi\u00e9n podemos abreviar el c\u00f3digo anterior llamando directamente a view , en lugar de a get primero, en el archivo routes/web.php , y le pasamos as\u00ed la informaci\u00f3n asociada a la vista: PHP 1 Route::view('/', 'inicio', ['nombre' => 'Nacho']); Primeros pasos con el motor de plantillas Blade Hemos comentado en el apartado anterior que el uso de Blade permite simplificar la sintaxis y la forma de procesar algunas cosas en nuestras vistas. Siempre que creemos el archivo de la vista con la extensi\u00f3n .blade.php , nos permitir\u00e1 autom\u00e1ticamente aprovechar la sintaxis y funcionalidades de Blade en nuestras vistas. Por ejemplo, si queremos mostrar el contenido de la variable nombre que hemos pasado antes a la p\u00e1gina de inicio, en lugar de hacer un rudimentario echo en PHP, podemos emplear una sintaxis de dobles llaves, facilitada por Blade, para mostrar el contenido de esa variable. Con esto la l\u00ednea que mostraba el nombre pasa de ser as\u00ed\u2026 PHP 1 Bienvenido/a <?php echo $nombre ?> \u2026 a ser as\u00ed: PHP 1 Bienvenido/a {{ $nombre }} nota : Cada vez que se renderiza una vista en Laravel, se almacena el contenido PHP generado en storage/framework/views , y s\u00f3lo se vuelve a re-generar ante un cambio en la vista, con lo que volver a llamar a una vista ya renderizada no afecta al rendimiento de la aplicaci\u00f3n. Si echamos un vistazo a la vista generada con PHP plano y con Blade, veremos que hay una sutil diferencia entre ambas, y es que con Blade, en lugar de hacer un simple echo para mostrar el valor de la variable, se utiliza una funci\u00f3n intermedia llamada e , que evita ataques XSS ( Cross Site Scripting ), es decir, que se inyecten scripts de JavaScript con la variable a mostrar. En otras palabras, el c\u00f3digo no se interpreta, y se muestra tal cual. En algunos casos (especialmente cuando generamos contenido HTML desde dentro de la expresi\u00f3n Blade) nos puede interesar que no proteja contra estas inyecciones de c\u00f3digo. En ese caso, se sustituye la segunda llave por una doble exclamaci\u00f3n: PHP 1 Bienvenido/a {!! $nombre !!} Adem\u00e1s de esta sintaxis b\u00e1sica para mostrar datos de variables en un lugar determinado de la vista, existen ciertas directivas en Blade que nos permiten realizar comprobaciones o repeticiones. Estructuras de control de flujo en Blade Para iterar sobre un conjunto de datos (array), podemos emplear la directiva @foreach , con una sintaxis similar al foreach de PHP, pero sin necesidad de llaves. Basta con finalizar el bucle con la directiva @endforeach , de este modo: PHP 1 2 3 4 5 <ul> @foreach($elementos as $elemento) <li>{{ $elemento }}</li> @endforeach </ul> En el caso de querer realizar alguna comprobaci\u00f3n (por ejemplo, si el array anterior est\u00e1 vac\u00edo, para mostrar un mensaje pertinente), usamos la directiva @if , cerrada por su correspondiente pareja @endif . Opcionalmente, se puede intercalar una directiva @else para el camino alternativo, o tambi\u00e9n @elseif para indicar otra condici\u00f3n. El ejemplo anterior podr\u00eda quedar as\u00ed: PHP 1 2 3 4 5 6 7 8 9 <ul> @if($elementos) @foreach($elementos as $elemento) <li>{{ $elemento }}</li> @endforeach @else <li>No hay elementos que mostrar</li> @endif </ul> Tambi\u00e9n podemos comprobar si una variable est\u00e1 definida. En este caso, reemplazamos la directiva @if por @isset , con su correspondiente cierre @endisset . PHP 1 2 3 4 5 6 7 8 9 <ul> @isset($elementos) @foreach($elementos as $elemento) <li>{{ $elemento }}</li> @endforeach @else <li>No hay elementos que mostrar</li> @endisset </ul> Sin embargo, con cualquiera de estas opciones tenemos un problema: en el primer caso, si la variable $elementos no est\u00e1 definida, mostrar\u00e1 un error de PHP. En el segundo caso, si la variable s\u00ed est\u00e1 definida pero no contiene elementos, no se mostrar\u00e1 nada por pantalla. Una tercera estructura alternativa que agrupa estos dos casos (controlar a la vez que la variable est\u00e9 definida y tenga elementos) es emplear la directiva @forelse en lugar de @foreach . Esta directiva permite una cl\u00e1usula adicional @empty para indicar qu\u00e9 hacer si la colecci\u00f3n no tiene elementos o est\u00e1 sin definir. El ejemplo anterior quedar\u00eda ahora as\u00ed de abreviado: PHP 1 2 3 4 5 6 7 <ul> @forelse($elementos as $elemento) <li>{{ $elemento }}</li> @empty <li>No hay elementos que mostrar</li> @endforelse </ul> En este tipo de iteradores ( @foreach o @forelse ), tenemos disponible un objeto llamado $loop , con una serie de propiedades sobre el bucle que estamos iterando, como por ejemplo: index : posici\u00f3n dentro del array por la que vamos. count : total de elementos. first y last : booleanos que determinan si es el primer o \u00faltimo elemento, respectivamente. otras Podemos ver todas las propiedades disponibles en este objeto llamando a var_dump : PHP 1 2 3 4 5 6 7 <ul> @forelse($elementos as $elemento) <li>{{ $elemento }} {{ var_dump($loop) }} </li> @empty <li>No hay elementos que mostrar</li> @endforelse </ul> Si, por ejemplo, queremos determinar si es el \u00faltimo elemento de la lista, y mostrar un mensaje o estilo especial, podemos hacer algo como esto: PHP 1 2 3 4 5 6 7 8 9 <ul> @forelse($elementos as $elemento) <li>{{ $elemento }} {{ $loop->last ? \"Ultimo elemento\" : \"\" }} </li> @empty <li>No hay elementos que mostrar</li> @endforelse </ul> Existen otros tipos de estructuras iterativas y selectivas en Blade, como @while , @for o @switch , entre otras. Pod\u00e9is consultar sobre su uso en la documentaci\u00f3n oficial de Blade . Vamos a aplicar esto en nuestro ejemplo del proyecto biblioteca . Definiremos una ruta para sacar un listado de libros y, de momento, vamos a crear a mano dicho listado en el propio m\u00e9todo de enrutamiento, y se lo pasaremos a una vista llamada listado.blade.php . Por un lado, la nueva ruta para el listado puede quedar as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 Route::get('/listado', function() { $libros = array( array(\"titulo\" => \"El juego de Ender\", \"autor\" => \"Orson Scott Card\"), array(\"titulo\" => \"La tabla de Flandes\", \"autor\" => \"Arturo P\u00e9rez Reverte\"), array(\"titulo\" => \"La historia interminable\", \"autor\" => \"Michael Ende\"), array(\"titulo\" => \"El Se\u00f1or de los Anillos\", \"autor\" => \"J.R.R. Tolkien\") ); return view('listado', compact('libros')); })->name('listado_libros'); Por su parte, la vista listado.blade.php puede quedar as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <html> <head> <title>Listado de libros</title> </head> <body> <h1>Listado de libros</h1> <ul> @forelse ($libros as $libro) <li>{{ $libro[\"titulo\"] }} ({{ $libro[\"autor\"] }})</li> @empty <li>No se encontraron libros</li> @endforelse </ul> </body> </html> Sobre los enlaces a otras rutas Hemos comentado brevemente en puntos anteriores que, gracias a Blade y a los nombres en las rutas, podemos enlazar una vista con otra de dos formas: de forma tradicional\u2026 PHP 1 echo '<a href=\"/contacto\">Contacto</a>'; \u2026 o bien empleando la funci\u00f3n route seguida del nombre que le hemos dado a la ruta: PHP 1 <a href=\"{{ route('ruta_contacto') }}\">Contacto</a> Por ejemplo, podemos poner un enlace a la vista del listado de libros que hemos creado antes (y que hemos nombrado como listado_libros de este modo en nuestra vista de inicio.blade.php : PHP 1 2 <p>Bienvenido/a {{ $nombre }}</p> <p><a href=\"{{ route('listado_libros') }}\">Listado de libros</a></p> Definir plantillas comunes A la hora de dar homogeneidad a una web, es habitual que la cabecera, el men\u00fa de navegaci\u00f3n o el pie de p\u00e1gina formen parte de una plantilla que se repite en todas las p\u00e1ginas del sitio, de modo que evitamos tener que actualizar todas las p\u00e1ginas ante cualquier posible cambio en estos elementos. Para crear una plantilla en Blade, creamos un archivo normal y corriente (por ejemplo, plantilla.blade.php ), en la carpeta de vistas, con el contenido general de la plantilla. En aquellas zonas del documento donde vamos a permitir contenido variable dependiendo de la vista en s\u00ed, a\u00f1adimos una secci\u00f3n llamada @yield , con un nombre asociado. Nuestra plantilla podr\u00eda ser esta (notar que se permiten varios @yield con diferentes nombres): Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 <html> <head> <title> @yield('titulo') </title> </head> <body> <nav> <!-- ... Men\u00fa de navegaci\u00f3n --> </nav> @yield('contenido') </body> </html> Despu\u00e9s, en cada vista en que queramos utilizar esta plantilla, a\u00f1adimos la directiva @extends de Blade, indicando el nombre de plantilla que vamos a utilizar. Con la directiva @section , seguida del nombre de la secci\u00f3n, definimos el contenido para cada uno de los @yield que se hayan indicado en la plantilla. Finalizaremos cada secci\u00f3n con la directiva @endsection . As\u00ed, para nuestra p\u00e1gina inicial ( inicio.blade.php ), el contenido puede ser ahora \u00e9ste: PHP 1 2 3 4 5 6 7 8 @extends('plantilla') @section('titulo', 'Inicio') @section('contenido') <h1>P\u00e1gina de inicio</h1> <p>Bienvenido/a {{ $nombre }}</p> @endsection nota : a la directiva @section se le puede pasar un segundo par\u00e1metro con el contenido de esa secci\u00f3n, y en este caso no es necesario cerrarla con @endsection . Esta opci\u00f3n es \u00fatil para contenidos donde no interesen caracteres en blanco o saltos de l\u00ednea innecesarios al principio o al final, como ocurre en el ejemplo anterior con el t\u00edtulo ( title ) de la p\u00e1gina. Del mismo modo, nuestra vista para el listado de libros quedar\u00eda de esta forma: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @extends('plantilla') @section('titulo', 'Listado de libros') @section('contenido') <h1>Listado de libros</h1> <ul> @forelse ($libros as $libro) <li>{{ $libro[\"titulo\"] }} ({{ $libro[\"autor\"] }})</li> @empty <li>No se encontraron libros</li> @endforelse </ul> @endsection realizar ejercicio 3 . Incluir vistas dentro de otras Tambi\u00e9n suele ser habitual definir contenidos parciales (se suelen definir en una subcarpeta partials dentro de resources/views ), e incluirlos en las vistas. Para esto, utilizaremos la directiva @include de Blade. Por ejemplo, vamos a definir un men\u00fa de navegaci\u00f3n. Supongamos que dicho men\u00fa est\u00e1 en el archivo resources/views/partials/nav.blade.php : PHP 1 2 3 4 5 <nav> <a href=\"{{ route('inicio') }}\">Inicio</a> &nbsp;|&nbsp; <a href=\"{{ route('listado_libros') }}\">Listado de libros</a> </nav> Notar que, en este ejemplo, se supone que a cada una de las dos rutas implicadas les hemos asignado los nombres \u201cinicio\u201d y \u201clibros_listado\u201d, respectivamente, empleando el m\u00e9todo name al definir la ruta. De lo contrario, las propiedades href de los dos enlaces deber\u00edan apuntar a / y /listado , respectivamente. Para incluir el men\u00fa en la plantilla anterior, podemos hacer esto (y eliminar\u00edamos el elemento <nav> de la plantilla): PHP 1 2 3 4 5 6 7 8 9 10 11 <html> <head> <title> @yield('titulo') </title> </head> <body> @include('partials.nav') @yield('contenido') </body> </html> Como puede verse, podemos utilizar tanto el punto como la barra para indicar el separador de carpeta en la vista. Estructurar vistas en carpetas Cuando la aplicaci\u00f3n es algo compleja, pueden ser necesarias varias vistas, y tenerlas todas en una misma carpeta puede ser algo dif\u00edcil de gestionar. Es habitual, como iremos viendo en sesiones posteriores, estructurar las vistas de la carpeta resources/views en subcarpetas, de modo que, por ejemplo, cada carpeta se refiera a las vistas de una entidad o modelo de la aplicaci\u00f3n, o a un controlador espec\u00edfico. De momento, en nuestro ejemplo de la biblioteca, vamos a ubicar la vista listado.blade.php en una subcarpeta libros , de modo que en la ruta que renderiza esta vista, ahora deberemos indicar tambi\u00e9n el nombre de la subcarpeta: PHP 1 2 3 4 Route::get('listado', function() { // ... return view('libros.listado', compact('libros')); })->name('listado_libros'); observa : la ruta o path que se indica ser\u00e1 carpeta.vista (separaci\u00f3n mediante un puto . y sin la extensi\u00f3n blade.php la vista). Ahora mismo, en nuestra carpeta resources/views del proyecto de la biblioteca tendremos \u00fanicamente la plantilla base y la p\u00e1gina de inicio (y la vista welcome.blade.php , que de hecho ya podemos borrar si queremos). El resto de vistas las iremos estructurando en subcarpetas. Vistas para p\u00e1ginas de error A lo largo de estas sesiones, algunas acciones que hagamos provocar\u00e1n p\u00e1ginas de error con determinados c\u00f3digos, como por ejemplo 404 para p\u00e1ginas no encontradas. Si queremos definir el aspecto y estructura de estas p\u00e1ginas, basta con crear la vista correspondiente en la carpeta resources/views/errors , por ejemplo, resources/views/errors/404.blade.php para el error 404 (anteponemos el c\u00f3digo de error al sufijo de la vista). PHP 1 2 3 4 5 6 7 8 @extends('plantilla') @section('titulo', 'Error 404') @section('contenido') <h1>Error</h1> <p>Documento no encontrado</p> @endsection estilos y Javascript Ahora que ya tenemos una visi\u00f3n bastante completa de lo que el motor de plantillas Blade puede ofrecernos, llega el momento de terminar de perfilar nuestras vistas. Hasta ahora no hemos hablado nada de estilos CSS, y eso es algo que toda vista que se precie debe incluir. Adem\u00e1s, tambi\u00e9n puede ser necesario en algunos casos incluir alguna librer\u00eda JavaScript en el lado del cliente para ciertos procesamientos. Veremos c\u00f3mo gestiona Laravel estos recursos. Infraestructura para archivos CSS y JavaScript Para poder a\u00f1adir estilos CSS o archivos JavaScript a nuestro proyecto Laravel, el framework proporciona ya unos archivos donde centralizar estas opciones. En primer lugar, debemos tener en cuenta que todas las dependencias de librer\u00edas en la parte del cliente (JavaScript) se centralizan en el archivo package.json , disponible en la ra\u00edz del proyecto. Inicialmente cuenta ya con una serie de dependencias pre-a\u00f1adidas. Algunas de ellas son importantes, como vite (o laravel-mix , dependiendo de la versi\u00f3n de Laravel que tengamos instalada), y otras puede que no las necesitemos y las podamos borrar. Es recomendable instalar las dependencias cuando creamos el proyecto, para tenerlas disponibles, con este comando: Bash 1 npm install Se crear\u00e1 una carpeta node_modules en la ra\u00edz del proyecto con las dependencias instaladas. Esta carpeta es similar a la carpeta vendor , tambi\u00e9n en la ra\u00edz del proyecto, pero esta \u00faltima contiene dependencias PHP (no JavaScript). Ninguna de estas carpetas debe subirse a un repositorio git , ya que ambas pueden reconstruirse con el correspondiente comando de instalaci\u00f3n de npm o de composer , seg\u00fan el caso y, adem\u00e1s, pueden ocupar mucho espacio. Para centralizar los estilos CSS, tenemos el archivo resources/css/app.css , o bien resources/sass/app.scss (dependiendo de la versi\u00f3n de Laravel que usemos), donde podemos definir estilos CSS propios, o incorporar librer\u00edas externas como veremos despu\u00e9s, utilizando o bien CSS plano o bien Sass. Por ejemplo, podemos editar este archivo para a\u00f1adir alg\u00fan estilo propio para el cuerpo del documento: CSS 1 2 3 4 5 6 body { background-color : #CCC ; font-family : Arial ; text-align : justify ; } Por otro lado, tenemos el archivo resources/js/app.js para incluir nuestras propias funciones en JavaScript, o incluso funcionalidades externas (a trav\u00e9s de jQuery, por ejemplo). Generaci\u00f3n autom\u00e1tica de CSS y JavaScript Estos dos archivos anteriores ( resources/css/app.css y resources/js/app.js ) necesitan ser procesados para generar el c\u00f3digo resultante (CSS y JavaScript) que formar\u00e1 parte de la aplicaci\u00f3n, aunando todas las librer\u00edas y funciones que hayamos especificado. Para esto, tenemos dos opciones dependiendo del gestor de frontend que se tenga instalado. Generaci\u00f3n con Laravel mix Hasta las primeras versiones de Laravel 9, se empleaba el gestor laravel-mix como generador de toda la parte de frontend . En este caso, se tiene el archivo webpack.mix.js en la ra\u00edz del proyecto, que emplea la herramienta WebPack para compilar, empaquetar y minificar estos archivos resultado CSS y JavaScript. JavaScript 1 2 3 4 mix . js ( 'resources/js/app.js' , 'public/js' ) . postCss ( 'resources/css/app.css' , 'public/css' , [ // ... ]); Como podemos intuir, desde este archivo webpack.mix.js se tomar\u00e1 todo lo que hay en el archivo resources/js/app.js y se generar\u00e1 un archivo optimizado ubicado en public/js/app.js . De forma similar, se tomar\u00e1n los estilos definidos en resources/sass/app.scss o en resources/css/app.css (dependiendo de la versi\u00f3n de Laravel) y se generar\u00e1 un archivo CSS optimizado en public/css/app.css . Para desencadenar este proceso, Laravel y WebPack se valen de la librer\u00eda laravel-mix , incluida en el archivo package.json . Por eso es importante esta librer\u00eda, y por eso debemos dejarla instalada previamente con el comando npm install que hemos explicado antes. Una vez instalada, para generar los CSS y JavaScript debemos ejecutar este comando desde la ra\u00edz del proyecto: Bash 1 npm run dev Esto generar\u00e1 los archivos public/css/app.css y public/js/app.js , y despu\u00e9s ya podremos a\u00f1adir estos archivos en nuestras vistas, con algo como esto, respectivamente: HTML 1 2 3 4 5 6 < html > < head > < link rel = \"stylesheet\" type = \"text/css\" href = \"/css/app.css\" > < script type = \"text/javascript\" src = \"/js/app.js\" > </ script > ... Generaci\u00f3n con Vite Desde alguna versi\u00f3n intermedia de Laravel 9, el gestor frontend por defecto que se incorpora es vite , junto con un archivo de configuraci\u00f3n en la ra\u00edz del proyecto llamado vite.config.js . Debemos especificar en este archivo las rutas hacia los archivos CSS y JavaScript que queramos incorporar a la aplicaci\u00f3n, aunque vienen por defecto ya incluidos los que hemos mencionado anteriormente: JavaScript 1 2 3 4 5 6 7 8 9 10 // ... export default defineConfig ({ plugins : [ laravel ({ input : [ 'resources/css/app.css' , 'resources/js/app.js' ], refresh : true }), ], }); Si queremos incluir cualquiera de estos archivos en nuestras p\u00e1ginas, podemos emplear la directiva @vite con la URL relativa. Por ejemplo: HTML 1 2 3 4 5 <!doctype html> < head > ... @vite(['resources/css/app.css', 'resources/js/app.js']) </ head > Ejecutando el comando npm run dev pondremos en marcha el servidor Vite , \u00fatil si estamos desarrollando y probando la web. Si ejecutamos npm run build generaremos ya las rutas preparadas para producci\u00f3n. El primer comando, aunque puede resultar \u00fatil, remite a una URL alternativa para el proyecto que no siempre funciona correctamente, as\u00ed que lo m\u00e1s c\u00f3modo es lanzar npm run build y que genere las dependencias adecuadas. Incluir estilos Bootstrap Uno de los frameworks de dise\u00f1o web m\u00e1s utilizados a la hora de elaborar una web es Bootstrap . En este curso no vamos a dar demasiadas nociones sobre \u00e9l, pero s\u00ed utilizaremos algunas pinceladas para que nuestras vistas tengan un aspecto m\u00e1s profesional. Para incluir este framework en Laravel, debemos incluir una librer\u00eda en el servidor llamada ui , que se encarga de incorporar distintas herramientas para dise\u00f1o de interfaces de usuario ( UI , User Interface ). PHP 1 composer require laravel/ui:* nota : la expresi\u00f3n :* al final del comando es para que descargue la \u00faltima versi\u00f3n disponible compatible con el proyecto Laravel actual. Una vez a\u00f1adida la herramienta, la podemos emplear a trav\u00e9s del comando artisan para incorporar Bootstrap al proyecto: Bash 1 php artisan ui bootstrap Esto incorporar\u00e1 Bootstrap al archivo package.json , en la secci\u00f3n de dependencias\u2026 Bash 1 2 3 4 5 \"devDependencies\" : { ... \"bootstrap\" : \"^5.2.3\" , ... } \u2026 y tambi\u00e9n a\u00f1adir\u00e1 un enlace a dicha librer\u00eda en el archivo resources/sass/app.scss , para que podamos generar un archivo CSS optimizado con Bootstrap incluido: CSS 1 2 ... @ import '~bootstrap/scss/bootstrap' ; Si utilizamos Bootstrap, entonces el archivo resources/css/app.css dejar\u00e1 de tener efecto, ya que para poder incorporar los estilos de Bootstrap a nuestro proyecto, se trabaja con Sass a trav\u00e9s de resources/sass/app.scss . Nuestro archivo webpack.mix.js o vite.config.js tambi\u00e9n se habr\u00e1 actualizado en este sentido, y deberemos colocar todos nuestros estilos CSS propios en el archivo app.scss : CSS 1 2 3 4 5 6 7 8 9 ... @ import '~bootstrap/scss/bootstrap' ; body { background-color : #CCC ; font-family : Arial ; text-align : justify ; } En el caso de usar Vite, deberemos actualizar la URL correspondiente al archivo CSS en las cabeceras donde hayamos incluido la directiva @vite , de este modo: HTML 1 2 3 4 5 <!doctype html> < head > ... @vite(['resources/sass/app.scss', 'resources/js/app.js']) </ head > Para finalizar, debemos ejecutar nuevamente las instrucciones: Bash 1 2 npm install npm run build La primera instrucci\u00f3n debe ejecutarse s\u00f3lo una vez, y descargar\u00e1 e instalar\u00e1 Bootstrap en el proyecto (en la subcarpeta node_modules ), y la segunda generar\u00e1 de nuevo los archivos CSS y JavaScript optimizados, incluyendo en ellos la librer\u00eda Bootstrap. Con esto ya tendremos disponibles las clases y estilos de Bootstrap para nuestras vistas. realizar ejercicio 4 . bibliografia Nacho Iborra Baeza .","title":"ud07 Laravel 2 RutasYVistas"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#rutas","text":"Las rutas ( routes ) son un mecanismo que permite a Laravel establecer qu\u00e9 respuesta enviar a una petici\u00f3n que intenta acceder a una determinada URL. Estas rutas se especifican en diferentes archivos dentro de la carpeta routes de nuestro proyecto Laravel. Podr\u00edamos decir que existen dos tipos principales de rutas: Las rutas web (almacenadas en el archivo routes/web.php de la aplicaci\u00f3n), que nos permitir\u00e1n cargar distintas vistas en funci\u00f3n de la URL que indique el cliente. Las rutas API (almacenadas en el archivo routes/api.php ), a trav\u00e9s de las cuales definiremos distintos servicios REST, como veremos tambi\u00e9n m\u00e1s adelante. Nos vamos a centrar durante esta sesi\u00f3n en el primer grupo, por lo que editaremos el contenido del archivo routes/web.php . Estas rutas son las m\u00e1s habituales, y se utilizan para recuperar contenidos t\u00edpicamente en formato HTML. Inicialmente ya existe una ruta predefinida hacia la ra\u00edz del proyecto, que carga la p\u00e1gina de bienvenida al mismo: PHP 1 2 3 4 5 6 7 8 9 <?php use Illuminate\\Support\\Facades\\Route ; // Ruta por defecto para cargar la vista welcome (sin extensi\u00f3n .blade.php) // cuando el usuario introduce simplemente el dominio Route :: get ( '/' , function () { return view ( 'welcome' ); }); Para definir una ruta en Laravel, se hace una llamada a un m\u00e9todo est\u00e1tico de la clase Route (en el ejemplo anterior, al m\u00e9todo Route::get ). Como primer par\u00e1metro, especificaremos la URL de la ruta (la ruta ra\u00edz, en el ejemplo anterior), y como segundo par\u00e1metro, la funci\u00f3n que se va a ejecutar ( callback o closure ) cuando alg\u00fan cliente haga una petici\u00f3n a esa ruta. closure VS controlador : Se puede definir en el segundo par\u00e1metro del m\u00e9todo Route::get un closure o un controlador (veremos este segundo caso m\u00e1s adelante). Por ejemplo: PHP 1 Route::get('/libros', [LibroController::class, 'index']) -> name('libros');","title":"rutas"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#rutas-simples","text":"Las rutas simples tienen un nombre de ruta fijo, y una funci\u00f3n que responde a dicho nombre emitiendo una respuesta. Un ejemplo es la ruta ra\u00edz que viene por defecto en nuestro proyecto. Podr\u00edamos definir otra ruta a continuaci\u00f3n de esa, mediante la cual, si accedemos a la URL http://biblioteca/fecha nos muestre la fecha y hora actuales: PHP 1 2 3 Route::get('fecha', function() { return date(\"d/m/y h:i:s\"); }); Si ponemos en marcha el servidor y accedemos a esa URL (o a http://127.0.0.1:8000/fecha si hemos lanzado la aplicaci\u00f3n con php artisan serve ), podremos ver esa fecha y hora actual. realizar ejercicio 1 .","title":"Rutas simples"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#rutas-con-parametros","text":"Es tambi\u00e9n posible pasar par\u00e1metros en la URL de la ruta. Para ello, incluimos el nombre del par\u00e1metro entre llaves, y lo pasamos tambi\u00e9n a la funci\u00f3n del segundo par\u00e1metro. Por ejemplo, si definimos una ruta para saludar al nombre que nos llega como par\u00e1metro, el c\u00f3digo quedar\u00eda as\u00ed: PHP 1 2 3 Route::get('saludo/{nombre}', function($nombre) { return \"Hola, \" . $nombre; }); En este caso, si el par\u00e1metro es obligatorio y no lo indicamos en la URL, nos redirigir\u00e1 a una p\u00e1gina de error 404 . Para indicar que un par\u00e1metro no es obligatorio, se termina su nombre con un interrogante ? , y tambi\u00e9n conviene darle un valor por defecto en la funci\u00f3n PHP de respuesta. As\u00ed modificar\u00edamos la ruta anterior para que el nombre del usuario sea opcional y, en caso de no ponerlo, se le asigne el nombre \u201cInvitado\u201d: PHP 1 2 3 Route::get('saludo/{nombre?}', function($nombre = \"Invitado\") { return \"Hola, \" . $nombre; });","title":"Rutas con par\u00e1metros"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#validacion-de-parametros","text":"Algunos par\u00e1metros ser\u00e1 preciso que sigan un determinado patr\u00f3n. Por ejemplo, un identificador num\u00e9rico s\u00f3lo contendr\u00e1 d\u00edgitos. Para asegurarnos de eso, podemos emplear el m\u00e9todo where al definir la ruta. A este m\u00e9todo le pasamos dos par\u00e1metros: el nombre del par\u00e1metro a validar, y la expresi\u00f3n regular que tiene que cumplir. En el caso del nombre anterior, si queremos que s\u00f3lo contenga letras (may\u00fasculas o min\u00fasculas), podemos hacer algo as\u00ed: PHP 1 2 3 Route::get('saludo/{nombre?}', function($nombre = \"Invitado\") { return \"Hola, \" . $nombre; }) -> where('nombre', \"[A-Za-z]+\"); En caso de que la ruta no cumpla el patr\u00f3n, se obtendr\u00e1 una p\u00e1gina de error. M\u00e1s adelante se explicar\u00e1 c\u00f3mo podemos personalizar estas p\u00e1ginas de error. realizar ejercicio 2 .","title":"Validaci\u00f3n de par\u00e1metros"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#rutas-con-nombre-o-named-routes","text":"En ocasiones puede ser conveniente asociar un nombre a una ruta. Especialmente, cuando esa ruta va a formar parte de un enlace en alguna p\u00e1gina de nuestro sitio, ya que en un futuro la ruta podr\u00eda cambiar, y de este modo evitamos tener que actualizar los enlaces con el nuevo nombre. Para ello, al definir la ruta, le asociamos con la funci\u00f3n name el nombre que queramos. Por ejemplo: PHP 1 2 3 Route::get('contacto', function() { return \"P\u00e1gina de contacto\"; }) -> name('ruta_contacto'); Ahora, si queremos definir un enlace a esta ruta en cualquier parte, basta con emplear la funci\u00f3n route de Laravel, indicando el nombre que le hemos asignado a esta ruta. Por lo tanto, en lugar de poner esto: PHP 1 echo '<a href=\"/contacto\">Contacto</a>'; Podemos hacer algo como esto otro, tal y como veremos m\u00e1s adelante cuando definamos nuestras vistas: PHP 1 <a href=\"{{ route('ruta_contacto') }}\">Contacto</a> De este modo, ante futuros cambios en las rutas, s\u00f3lo deberemos cambiar la URL en el correspondiente Route::get de routes/web.php .","title":"Rutas con nombre o named routes"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#combinacion-de-elementos-en-rutas","text":"Podemos combinar varias cl\u00e1usulas where en una ruta para validar distintos par\u00e1metros que pueda tener, y tambi\u00e9n enlazar estas llamadas con una a la funci\u00f3n name para nombrar la ruta. Por ejemplo, la siguiente ruta espera recibir un nombre con caracteres, y un id num\u00e9rico, ambos con valores por defecto: PHP 1 2 3 4 5 Route::get('saludo/{nombre?}/{id?}', function($nombre=\"Invitado\", $id=0) { return \"Hola $nombre, tu c\u00f3digo es el $id\"; }) -> where('nombre', \"[A-Za-z]+\") -> where('id', \"[0-9]+\") -> name('saludo'); Si accedemos a cada una de las siguientes URLs, obtendremos cada una de las respuestas indicadas: URL Respuesta /saludo Hola Invitado, tu c\u00f3digo es el 0 /saludo/Nacho Hola Nacho, tu c\u00f3digo es el 0 /saludo/Nacho/3 Hola Nacho, tu c\u00f3digo es el 3 /saludo/3 Error 404 (URL incorrecta) Notar que el \u00faltimo caso es incorrecto. No podemos especificar un id sin haber especificado un nombre delante, porque incumple el patr\u00f3n de la URL. Se puede dejar un par\u00e1metro omitido, siempre y cuando los posteriores tambi\u00e9n lo est\u00e9n.","title":"Combinaci\u00f3n de elementos en rutas"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#otros-metodos-de-route","text":"Adem\u00e1s de utilizar el m\u00e9todo get , desde la clase Route tambi\u00e9n podemos acceder a otros m\u00e9todos est\u00e1ticos \u00fatiles, como Route::post (\u00fatil para recoger datos de formularios, por ejemplo), o tambi\u00e9n Route::put , Route::delete \u2026 Los veremos con m\u00e1s detalle en secciones posteriores.","title":"Otros m\u00e9todos de Route"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#vistas","text":"Hasta ahora las rutas que hemos definido devuelven un texto simple, salvo la que ya estaba creada por defecto en el proyecto, que apuntaba a la p\u00e1gina de inicio. Si quisi\u00e9ramos devolver contenido HTML, una opci\u00f3n (costosa) ser\u00eda devolver dicho contenido generado desde el propio m\u00e9todo de la ruta, a trav\u00e9s de la instrucci\u00f3n return , pero en lugar de hacer esto desde dentro de la propia funci\u00f3n de respuesta, lo m\u00e1s habitual (y recomendable) es generar una vista con el contenido HTML que se quiere enviar al cliente. La forma general de mostrar vistas en Laravel es hacer que las rutas devuelvan ( return ) una determinada vista. Para ello, se puede emplear la funci\u00f3n view de Laravel, indicando el nombre de la vista a generar o mostrar. Por defecto, en la carpeta resources/views tenemos disponible una vista de ejemplo llamada welcome.blade.php . Es la que se utiliza como p\u00e1gina de inicio en la ruta ra\u00edz en routes/web.php : PHP 1 2 3 Route::get('/', function() { return view('welcome'); }); A trav\u00e9s de las plantillas de Laravel vamos a escribir menos c\u00f3digo PHP y vamos a tener nuestros archivos mejor organizados . Blade es el sistema de plantillas que trae Laravel, por eso los archivos de plantillas que guardamos en el directorio de views llevan la extensi\u00f3n blade.php . De esta manera sabemos inmediatamente que se trata de una plantilla de Laravel y que forma parte de una vista que se mostrar\u00e1 en el navegador. nota : no es necesario indicar el path o ruta hacia el archivo de la vista, ni tampoco la extensi\u00f3n, puesto que Laravel asume que por defecto las vistas se encuentran en la carpeta resources/views , con la extensi\u00f3n .blade.php (que hace referencia al motor de plantillas Blade que veremos a continuaci\u00f3n), o simplemente con extensi\u00f3n .php (en el caso de vistas simples que no utilicen Blade). Podemos, por ejemplo, crear una vista sencilla dentro de esta carpeta de vistas (llam\u00e9mosla inicio.blade.php ), con un contenido HTML b\u00e1sico: Text Only 1 2 3 4 5 6 7 8 <html> <head> <title>Inicio</title> </head> <body> <h1>P\u00e1gina de inicio</h1> </body> </html> Y podemos utilizar esta vista como p\u00e1gina de inicio: PHP 1 2 3 Route::get('/', function() { return view('inicio'); });","title":"vistas"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#pasar-valores-a-las-vistas","text":"Es muy habitual pasar cierta informaci\u00f3n a ciertas vistas, como por ejemplo, listados de datos a mostrar, o datos de un elemento en concreto. Por ejemplo, si queremos dar un mensaje de bienvenida a un nombre (supuestamente variable), debemos almacenar el nombre en una variable en la ruta, y pas\u00e1rselo a la vista al cargarla. Esto puede hacerse, por ejemplo, con el m\u00e9todo with tras generar la vista, indicando el nombre con que lo vamos a asociar a la vista, y el valor (variable) asociado a dicho nombre. En nuestro caso quedar\u00eda as\u00ed: PHP 1 2 3 4 Route::get('/', function() { $nombre = \"Nacho\"; return view('inicio')->with('nombre', $nombre); }); Posteriormente, en la vista, deberemos mostrar el valor de esta variable en alg\u00fan lugar del c\u00f3digo HTML. Podemos emplear PHP tradicional para recoger esta variable: Text Only 1 2 3 4 5 6 7 8 9 <html> <head> <title>Inicio</title> </head> <body> <h1>P\u00e1gina de inicio</h1> <p>Bienvenido/a <?php echo $nombre; ?></p> </body> </html> Pero es m\u00e1s habitual y limpio emplear una sintaxis espec\u00edfica de Blade, como veremos a continuaci\u00f3n. Como alternativas al uso de with comentado antes, tambi\u00e9n podemos utilizar un array asociativo (asignando as\u00ed varios nombres a varios valores): PHP 1 return view('inicio')->with(['nombre' => $nombre, ...]); Asimismo, podemos utilizar este mismo array como segundo par\u00e1metro de la funci\u00f3n view , y prescindir as\u00ed de with : PHP 1 return view('inicio', ['nombre' => $nombre, ...]); Y tambi\u00e9n podemos utilizar una funci\u00f3n llamada compact como segundo par\u00e1metro de view . A esta funci\u00f3n le pasamos \u00fanicamente el nombre de la variable que usaremos en la vista y, siempre que la variable asociada se llame igual, establece la asociaci\u00f3n por nosotros: PHP 1 return view('inicio', compact('nombre')); La funci\u00f3n compact admite tantos par\u00e1metros como datos queramos enviar a la vista por separado, cada uno con su nombre asociado. Si simplemente vamos a devolver una vista con poca informaci\u00f3n asociada, o poca l\u00f3gica interna, tambi\u00e9n podemos abreviar el c\u00f3digo anterior llamando directamente a view , en lugar de a get primero, en el archivo routes/web.php , y le pasamos as\u00ed la informaci\u00f3n asociada a la vista: PHP 1 Route::view('/', 'inicio', ['nombre' => 'Nacho']);","title":"Pasar valores a las vistas"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#primeros-pasos-con-el-motor-de-plantillas-blade","text":"Hemos comentado en el apartado anterior que el uso de Blade permite simplificar la sintaxis y la forma de procesar algunas cosas en nuestras vistas. Siempre que creemos el archivo de la vista con la extensi\u00f3n .blade.php , nos permitir\u00e1 autom\u00e1ticamente aprovechar la sintaxis y funcionalidades de Blade en nuestras vistas. Por ejemplo, si queremos mostrar el contenido de la variable nombre que hemos pasado antes a la p\u00e1gina de inicio, en lugar de hacer un rudimentario echo en PHP, podemos emplear una sintaxis de dobles llaves, facilitada por Blade, para mostrar el contenido de esa variable. Con esto la l\u00ednea que mostraba el nombre pasa de ser as\u00ed\u2026 PHP 1 Bienvenido/a <?php echo $nombre ?> \u2026 a ser as\u00ed: PHP 1 Bienvenido/a {{ $nombre }} nota : Cada vez que se renderiza una vista en Laravel, se almacena el contenido PHP generado en storage/framework/views , y s\u00f3lo se vuelve a re-generar ante un cambio en la vista, con lo que volver a llamar a una vista ya renderizada no afecta al rendimiento de la aplicaci\u00f3n. Si echamos un vistazo a la vista generada con PHP plano y con Blade, veremos que hay una sutil diferencia entre ambas, y es que con Blade, en lugar de hacer un simple echo para mostrar el valor de la variable, se utiliza una funci\u00f3n intermedia llamada e , que evita ataques XSS ( Cross Site Scripting ), es decir, que se inyecten scripts de JavaScript con la variable a mostrar. En otras palabras, el c\u00f3digo no se interpreta, y se muestra tal cual. En algunos casos (especialmente cuando generamos contenido HTML desde dentro de la expresi\u00f3n Blade) nos puede interesar que no proteja contra estas inyecciones de c\u00f3digo. En ese caso, se sustituye la segunda llave por una doble exclamaci\u00f3n: PHP 1 Bienvenido/a {!! $nombre !!} Adem\u00e1s de esta sintaxis b\u00e1sica para mostrar datos de variables en un lugar determinado de la vista, existen ciertas directivas en Blade que nos permiten realizar comprobaciones o repeticiones.","title":"Primeros pasos con el motor de plantillas Blade"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#estructuras-de-control-de-flujo-en-blade","text":"Para iterar sobre un conjunto de datos (array), podemos emplear la directiva @foreach , con una sintaxis similar al foreach de PHP, pero sin necesidad de llaves. Basta con finalizar el bucle con la directiva @endforeach , de este modo: PHP 1 2 3 4 5 <ul> @foreach($elementos as $elemento) <li>{{ $elemento }}</li> @endforeach </ul> En el caso de querer realizar alguna comprobaci\u00f3n (por ejemplo, si el array anterior est\u00e1 vac\u00edo, para mostrar un mensaje pertinente), usamos la directiva @if , cerrada por su correspondiente pareja @endif . Opcionalmente, se puede intercalar una directiva @else para el camino alternativo, o tambi\u00e9n @elseif para indicar otra condici\u00f3n. El ejemplo anterior podr\u00eda quedar as\u00ed: PHP 1 2 3 4 5 6 7 8 9 <ul> @if($elementos) @foreach($elementos as $elemento) <li>{{ $elemento }}</li> @endforeach @else <li>No hay elementos que mostrar</li> @endif </ul> Tambi\u00e9n podemos comprobar si una variable est\u00e1 definida. En este caso, reemplazamos la directiva @if por @isset , con su correspondiente cierre @endisset . PHP 1 2 3 4 5 6 7 8 9 <ul> @isset($elementos) @foreach($elementos as $elemento) <li>{{ $elemento }}</li> @endforeach @else <li>No hay elementos que mostrar</li> @endisset </ul> Sin embargo, con cualquiera de estas opciones tenemos un problema: en el primer caso, si la variable $elementos no est\u00e1 definida, mostrar\u00e1 un error de PHP. En el segundo caso, si la variable s\u00ed est\u00e1 definida pero no contiene elementos, no se mostrar\u00e1 nada por pantalla. Una tercera estructura alternativa que agrupa estos dos casos (controlar a la vez que la variable est\u00e9 definida y tenga elementos) es emplear la directiva @forelse en lugar de @foreach . Esta directiva permite una cl\u00e1usula adicional @empty para indicar qu\u00e9 hacer si la colecci\u00f3n no tiene elementos o est\u00e1 sin definir. El ejemplo anterior quedar\u00eda ahora as\u00ed de abreviado: PHP 1 2 3 4 5 6 7 <ul> @forelse($elementos as $elemento) <li>{{ $elemento }}</li> @empty <li>No hay elementos que mostrar</li> @endforelse </ul> En este tipo de iteradores ( @foreach o @forelse ), tenemos disponible un objeto llamado $loop , con una serie de propiedades sobre el bucle que estamos iterando, como por ejemplo: index : posici\u00f3n dentro del array por la que vamos. count : total de elementos. first y last : booleanos que determinan si es el primer o \u00faltimo elemento, respectivamente. otras Podemos ver todas las propiedades disponibles en este objeto llamando a var_dump : PHP 1 2 3 4 5 6 7 <ul> @forelse($elementos as $elemento) <li>{{ $elemento }} {{ var_dump($loop) }} </li> @empty <li>No hay elementos que mostrar</li> @endforelse </ul> Si, por ejemplo, queremos determinar si es el \u00faltimo elemento de la lista, y mostrar un mensaje o estilo especial, podemos hacer algo como esto: PHP 1 2 3 4 5 6 7 8 9 <ul> @forelse($elementos as $elemento) <li>{{ $elemento }} {{ $loop->last ? \"Ultimo elemento\" : \"\" }} </li> @empty <li>No hay elementos que mostrar</li> @endforelse </ul> Existen otros tipos de estructuras iterativas y selectivas en Blade, como @while , @for o @switch , entre otras. Pod\u00e9is consultar sobre su uso en la documentaci\u00f3n oficial de Blade . Vamos a aplicar esto en nuestro ejemplo del proyecto biblioteca . Definiremos una ruta para sacar un listado de libros y, de momento, vamos a crear a mano dicho listado en el propio m\u00e9todo de enrutamiento, y se lo pasaremos a una vista llamada listado.blade.php . Por un lado, la nueva ruta para el listado puede quedar as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 Route::get('/listado', function() { $libros = array( array(\"titulo\" => \"El juego de Ender\", \"autor\" => \"Orson Scott Card\"), array(\"titulo\" => \"La tabla de Flandes\", \"autor\" => \"Arturo P\u00e9rez Reverte\"), array(\"titulo\" => \"La historia interminable\", \"autor\" => \"Michael Ende\"), array(\"titulo\" => \"El Se\u00f1or de los Anillos\", \"autor\" => \"J.R.R. Tolkien\") ); return view('listado', compact('libros')); })->name('listado_libros'); Por su parte, la vista listado.blade.php puede quedar as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <html> <head> <title>Listado de libros</title> </head> <body> <h1>Listado de libros</h1> <ul> @forelse ($libros as $libro) <li>{{ $libro[\"titulo\"] }} ({{ $libro[\"autor\"] }})</li> @empty <li>No se encontraron libros</li> @endforelse </ul> </body> </html>","title":"Estructuras de control de flujo en Blade"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#sobre-los-enlaces-a-otras-rutas","text":"Hemos comentado brevemente en puntos anteriores que, gracias a Blade y a los nombres en las rutas, podemos enlazar una vista con otra de dos formas: de forma tradicional\u2026 PHP 1 echo '<a href=\"/contacto\">Contacto</a>'; \u2026 o bien empleando la funci\u00f3n route seguida del nombre que le hemos dado a la ruta: PHP 1 <a href=\"{{ route('ruta_contacto') }}\">Contacto</a> Por ejemplo, podemos poner un enlace a la vista del listado de libros que hemos creado antes (y que hemos nombrado como listado_libros de este modo en nuestra vista de inicio.blade.php : PHP 1 2 <p>Bienvenido/a {{ $nombre }}</p> <p><a href=\"{{ route('listado_libros') }}\">Listado de libros</a></p>","title":"Sobre los enlaces a otras rutas"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#definir-plantillas-comunes","text":"A la hora de dar homogeneidad a una web, es habitual que la cabecera, el men\u00fa de navegaci\u00f3n o el pie de p\u00e1gina formen parte de una plantilla que se repite en todas las p\u00e1ginas del sitio, de modo que evitamos tener que actualizar todas las p\u00e1ginas ante cualquier posible cambio en estos elementos. Para crear una plantilla en Blade, creamos un archivo normal y corriente (por ejemplo, plantilla.blade.php ), en la carpeta de vistas, con el contenido general de la plantilla. En aquellas zonas del documento donde vamos a permitir contenido variable dependiendo de la vista en s\u00ed, a\u00f1adimos una secci\u00f3n llamada @yield , con un nombre asociado. Nuestra plantilla podr\u00eda ser esta (notar que se permiten varios @yield con diferentes nombres): Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 <html> <head> <title> @yield('titulo') </title> </head> <body> <nav> <!-- ... Men\u00fa de navegaci\u00f3n --> </nav> @yield('contenido') </body> </html> Despu\u00e9s, en cada vista en que queramos utilizar esta plantilla, a\u00f1adimos la directiva @extends de Blade, indicando el nombre de plantilla que vamos a utilizar. Con la directiva @section , seguida del nombre de la secci\u00f3n, definimos el contenido para cada uno de los @yield que se hayan indicado en la plantilla. Finalizaremos cada secci\u00f3n con la directiva @endsection . As\u00ed, para nuestra p\u00e1gina inicial ( inicio.blade.php ), el contenido puede ser ahora \u00e9ste: PHP 1 2 3 4 5 6 7 8 @extends('plantilla') @section('titulo', 'Inicio') @section('contenido') <h1>P\u00e1gina de inicio</h1> <p>Bienvenido/a {{ $nombre }}</p> @endsection nota : a la directiva @section se le puede pasar un segundo par\u00e1metro con el contenido de esa secci\u00f3n, y en este caso no es necesario cerrarla con @endsection . Esta opci\u00f3n es \u00fatil para contenidos donde no interesen caracteres en blanco o saltos de l\u00ednea innecesarios al principio o al final, como ocurre en el ejemplo anterior con el t\u00edtulo ( title ) de la p\u00e1gina. Del mismo modo, nuestra vista para el listado de libros quedar\u00eda de esta forma: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 @extends('plantilla') @section('titulo', 'Listado de libros') @section('contenido') <h1>Listado de libros</h1> <ul> @forelse ($libros as $libro) <li>{{ $libro[\"titulo\"] }} ({{ $libro[\"autor\"] }})</li> @empty <li>No se encontraron libros</li> @endforelse </ul> @endsection realizar ejercicio 3 .","title":"Definir plantillas comunes"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#incluir-vistas-dentro-de-otras","text":"Tambi\u00e9n suele ser habitual definir contenidos parciales (se suelen definir en una subcarpeta partials dentro de resources/views ), e incluirlos en las vistas. Para esto, utilizaremos la directiva @include de Blade. Por ejemplo, vamos a definir un men\u00fa de navegaci\u00f3n. Supongamos que dicho men\u00fa est\u00e1 en el archivo resources/views/partials/nav.blade.php : PHP 1 2 3 4 5 <nav> <a href=\"{{ route('inicio') }}\">Inicio</a> &nbsp;|&nbsp; <a href=\"{{ route('listado_libros') }}\">Listado de libros</a> </nav> Notar que, en este ejemplo, se supone que a cada una de las dos rutas implicadas les hemos asignado los nombres \u201cinicio\u201d y \u201clibros_listado\u201d, respectivamente, empleando el m\u00e9todo name al definir la ruta. De lo contrario, las propiedades href de los dos enlaces deber\u00edan apuntar a / y /listado , respectivamente. Para incluir el men\u00fa en la plantilla anterior, podemos hacer esto (y eliminar\u00edamos el elemento <nav> de la plantilla): PHP 1 2 3 4 5 6 7 8 9 10 11 <html> <head> <title> @yield('titulo') </title> </head> <body> @include('partials.nav') @yield('contenido') </body> </html> Como puede verse, podemos utilizar tanto el punto como la barra para indicar el separador de carpeta en la vista.","title":"Incluir vistas dentro de otras"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#estructurar-vistas-en-carpetas","text":"Cuando la aplicaci\u00f3n es algo compleja, pueden ser necesarias varias vistas, y tenerlas todas en una misma carpeta puede ser algo dif\u00edcil de gestionar. Es habitual, como iremos viendo en sesiones posteriores, estructurar las vistas de la carpeta resources/views en subcarpetas, de modo que, por ejemplo, cada carpeta se refiera a las vistas de una entidad o modelo de la aplicaci\u00f3n, o a un controlador espec\u00edfico. De momento, en nuestro ejemplo de la biblioteca, vamos a ubicar la vista listado.blade.php en una subcarpeta libros , de modo que en la ruta que renderiza esta vista, ahora deberemos indicar tambi\u00e9n el nombre de la subcarpeta: PHP 1 2 3 4 Route::get('listado', function() { // ... return view('libros.listado', compact('libros')); })->name('listado_libros'); observa : la ruta o path que se indica ser\u00e1 carpeta.vista (separaci\u00f3n mediante un puto . y sin la extensi\u00f3n blade.php la vista). Ahora mismo, en nuestra carpeta resources/views del proyecto de la biblioteca tendremos \u00fanicamente la plantilla base y la p\u00e1gina de inicio (y la vista welcome.blade.php , que de hecho ya podemos borrar si queremos). El resto de vistas las iremos estructurando en subcarpetas.","title":"Estructurar vistas en carpetas"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#vistas-para-paginas-de-error","text":"A lo largo de estas sesiones, algunas acciones que hagamos provocar\u00e1n p\u00e1ginas de error con determinados c\u00f3digos, como por ejemplo 404 para p\u00e1ginas no encontradas. Si queremos definir el aspecto y estructura de estas p\u00e1ginas, basta con crear la vista correspondiente en la carpeta resources/views/errors , por ejemplo, resources/views/errors/404.blade.php para el error 404 (anteponemos el c\u00f3digo de error al sufijo de la vista). PHP 1 2 3 4 5 6 7 8 @extends('plantilla') @section('titulo', 'Error 404') @section('contenido') <h1>Error</h1> <p>Documento no encontrado</p> @endsection","title":"Vistas para p\u00e1ginas de error"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#estilos-y-javascript","text":"Ahora que ya tenemos una visi\u00f3n bastante completa de lo que el motor de plantillas Blade puede ofrecernos, llega el momento de terminar de perfilar nuestras vistas. Hasta ahora no hemos hablado nada de estilos CSS, y eso es algo que toda vista que se precie debe incluir. Adem\u00e1s, tambi\u00e9n puede ser necesario en algunos casos incluir alguna librer\u00eda JavaScript en el lado del cliente para ciertos procesamientos. Veremos c\u00f3mo gestiona Laravel estos recursos.","title":"estilos y Javascript"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#infraestructura-para-archivos-css-y-javascript","text":"Para poder a\u00f1adir estilos CSS o archivos JavaScript a nuestro proyecto Laravel, el framework proporciona ya unos archivos donde centralizar estas opciones. En primer lugar, debemos tener en cuenta que todas las dependencias de librer\u00edas en la parte del cliente (JavaScript) se centralizan en el archivo package.json , disponible en la ra\u00edz del proyecto. Inicialmente cuenta ya con una serie de dependencias pre-a\u00f1adidas. Algunas de ellas son importantes, como vite (o laravel-mix , dependiendo de la versi\u00f3n de Laravel que tengamos instalada), y otras puede que no las necesitemos y las podamos borrar. Es recomendable instalar las dependencias cuando creamos el proyecto, para tenerlas disponibles, con este comando: Bash 1 npm install Se crear\u00e1 una carpeta node_modules en la ra\u00edz del proyecto con las dependencias instaladas. Esta carpeta es similar a la carpeta vendor , tambi\u00e9n en la ra\u00edz del proyecto, pero esta \u00faltima contiene dependencias PHP (no JavaScript). Ninguna de estas carpetas debe subirse a un repositorio git , ya que ambas pueden reconstruirse con el correspondiente comando de instalaci\u00f3n de npm o de composer , seg\u00fan el caso y, adem\u00e1s, pueden ocupar mucho espacio. Para centralizar los estilos CSS, tenemos el archivo resources/css/app.css , o bien resources/sass/app.scss (dependiendo de la versi\u00f3n de Laravel que usemos), donde podemos definir estilos CSS propios, o incorporar librer\u00edas externas como veremos despu\u00e9s, utilizando o bien CSS plano o bien Sass. Por ejemplo, podemos editar este archivo para a\u00f1adir alg\u00fan estilo propio para el cuerpo del documento: CSS 1 2 3 4 5 6 body { background-color : #CCC ; font-family : Arial ; text-align : justify ; } Por otro lado, tenemos el archivo resources/js/app.js para incluir nuestras propias funciones en JavaScript, o incluso funcionalidades externas (a trav\u00e9s de jQuery, por ejemplo).","title":"Infraestructura para archivos CSS y JavaScript"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#generacion-automatica-de-css-y-javascript","text":"Estos dos archivos anteriores ( resources/css/app.css y resources/js/app.js ) necesitan ser procesados para generar el c\u00f3digo resultante (CSS y JavaScript) que formar\u00e1 parte de la aplicaci\u00f3n, aunando todas las librer\u00edas y funciones que hayamos especificado. Para esto, tenemos dos opciones dependiendo del gestor de frontend que se tenga instalado.","title":"Generaci\u00f3n autom\u00e1tica de CSS y JavaScript"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#generacion-con-laravel-mix","text":"Hasta las primeras versiones de Laravel 9, se empleaba el gestor laravel-mix como generador de toda la parte de frontend . En este caso, se tiene el archivo webpack.mix.js en la ra\u00edz del proyecto, que emplea la herramienta WebPack para compilar, empaquetar y minificar estos archivos resultado CSS y JavaScript. JavaScript 1 2 3 4 mix . js ( 'resources/js/app.js' , 'public/js' ) . postCss ( 'resources/css/app.css' , 'public/css' , [ // ... ]); Como podemos intuir, desde este archivo webpack.mix.js se tomar\u00e1 todo lo que hay en el archivo resources/js/app.js y se generar\u00e1 un archivo optimizado ubicado en public/js/app.js . De forma similar, se tomar\u00e1n los estilos definidos en resources/sass/app.scss o en resources/css/app.css (dependiendo de la versi\u00f3n de Laravel) y se generar\u00e1 un archivo CSS optimizado en public/css/app.css . Para desencadenar este proceso, Laravel y WebPack se valen de la librer\u00eda laravel-mix , incluida en el archivo package.json . Por eso es importante esta librer\u00eda, y por eso debemos dejarla instalada previamente con el comando npm install que hemos explicado antes. Una vez instalada, para generar los CSS y JavaScript debemos ejecutar este comando desde la ra\u00edz del proyecto: Bash 1 npm run dev Esto generar\u00e1 los archivos public/css/app.css y public/js/app.js , y despu\u00e9s ya podremos a\u00f1adir estos archivos en nuestras vistas, con algo como esto, respectivamente: HTML 1 2 3 4 5 6 < html > < head > < link rel = \"stylesheet\" type = \"text/css\" href = \"/css/app.css\" > < script type = \"text/javascript\" src = \"/js/app.js\" > </ script > ...","title":"Generaci\u00f3n con Laravel mix"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#generacion-con-vite","text":"Desde alguna versi\u00f3n intermedia de Laravel 9, el gestor frontend por defecto que se incorpora es vite , junto con un archivo de configuraci\u00f3n en la ra\u00edz del proyecto llamado vite.config.js . Debemos especificar en este archivo las rutas hacia los archivos CSS y JavaScript que queramos incorporar a la aplicaci\u00f3n, aunque vienen por defecto ya incluidos los que hemos mencionado anteriormente: JavaScript 1 2 3 4 5 6 7 8 9 10 // ... export default defineConfig ({ plugins : [ laravel ({ input : [ 'resources/css/app.css' , 'resources/js/app.js' ], refresh : true }), ], }); Si queremos incluir cualquiera de estos archivos en nuestras p\u00e1ginas, podemos emplear la directiva @vite con la URL relativa. Por ejemplo: HTML 1 2 3 4 5 <!doctype html> < head > ... @vite(['resources/css/app.css', 'resources/js/app.js']) </ head > Ejecutando el comando npm run dev pondremos en marcha el servidor Vite , \u00fatil si estamos desarrollando y probando la web. Si ejecutamos npm run build generaremos ya las rutas preparadas para producci\u00f3n. El primer comando, aunque puede resultar \u00fatil, remite a una URL alternativa para el proyecto que no siempre funciona correctamente, as\u00ed que lo m\u00e1s c\u00f3modo es lanzar npm run build y que genere las dependencias adecuadas.","title":"Generaci\u00f3n con Vite"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#incluir-estilos-bootstrap","text":"Uno de los frameworks de dise\u00f1o web m\u00e1s utilizados a la hora de elaborar una web es Bootstrap . En este curso no vamos a dar demasiadas nociones sobre \u00e9l, pero s\u00ed utilizaremos algunas pinceladas para que nuestras vistas tengan un aspecto m\u00e1s profesional. Para incluir este framework en Laravel, debemos incluir una librer\u00eda en el servidor llamada ui , que se encarga de incorporar distintas herramientas para dise\u00f1o de interfaces de usuario ( UI , User Interface ). PHP 1 composer require laravel/ui:* nota : la expresi\u00f3n :* al final del comando es para que descargue la \u00faltima versi\u00f3n disponible compatible con el proyecto Laravel actual. Una vez a\u00f1adida la herramienta, la podemos emplear a trav\u00e9s del comando artisan para incorporar Bootstrap al proyecto: Bash 1 php artisan ui bootstrap Esto incorporar\u00e1 Bootstrap al archivo package.json , en la secci\u00f3n de dependencias\u2026 Bash 1 2 3 4 5 \"devDependencies\" : { ... \"bootstrap\" : \"^5.2.3\" , ... } \u2026 y tambi\u00e9n a\u00f1adir\u00e1 un enlace a dicha librer\u00eda en el archivo resources/sass/app.scss , para que podamos generar un archivo CSS optimizado con Bootstrap incluido: CSS 1 2 ... @ import '~bootstrap/scss/bootstrap' ; Si utilizamos Bootstrap, entonces el archivo resources/css/app.css dejar\u00e1 de tener efecto, ya que para poder incorporar los estilos de Bootstrap a nuestro proyecto, se trabaja con Sass a trav\u00e9s de resources/sass/app.scss . Nuestro archivo webpack.mix.js o vite.config.js tambi\u00e9n se habr\u00e1 actualizado en este sentido, y deberemos colocar todos nuestros estilos CSS propios en el archivo app.scss : CSS 1 2 3 4 5 6 7 8 9 ... @ import '~bootstrap/scss/bootstrap' ; body { background-color : #CCC ; font-family : Arial ; text-align : justify ; } En el caso de usar Vite, deberemos actualizar la URL correspondiente al archivo CSS en las cabeceras donde hayamos incluido la directiva @vite , de este modo: HTML 1 2 3 4 5 <!doctype html> < head > ... @vite(['resources/sass/app.scss', 'resources/js/app.js']) </ head > Para finalizar, debemos ejecutar nuevamente las instrucciones: Bash 1 2 npm install npm run build La primera instrucci\u00f3n debe ejecutarse s\u00f3lo una vez, y descargar\u00e1 e instalar\u00e1 Bootstrap en el proyecto (en la subcarpeta node_modules ), y la segunda generar\u00e1 de nuevo los archivos CSS y JavaScript optimizados, incluyendo en ellos la librer\u00eda Bootstrap. Con esto ya tendremos disponibles las clases y estilos de Bootstrap para nuestras vistas. realizar ejercicio 4 .","title":"Incluir estilos Bootstrap"},{"location":"ud07/ud07_Laravel_2_RutasYVistas/#bibliografia","text":"Nacho Iborra Baeza .","title":"bibliografia"},{"location":"ud07/ud07_Laravel_2_RutasYVistas_actividades/","text":"unit: unidad did\u00e1ctica 7 title: Laravel - Rutas y Vistas (actividades) language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets licencia : el uso de estos materiales est\u00e1 sujeto a licencia Creative Commons CC BY-NC . material : extra\u00eddo de https://nachoiborraies.github.io/laravel/ ejercicios propuestos ejercicio 1 ejercicio 2 ejercicio 3 Ejercicio 4 bibliografia ejercicios propuestos ejercicio 1 Sobre el proyecto blog del punto Introducci\u00f3n , edita el fichero routes/web.php y a\u00f1ade: a) una nueva ruta a la URL posts . Al acceder a esta ruta ( http://blog/posts ), deberemos ver un mensaje con el texto \u201cListado de posts\u201d. b) una nueva ruta a la URL fecha . Al acceder a esta ruta ( http://blog/fecha ), deberemos ver un mensaje con el d\u00eda y la hora actual. ejercicio 2 Sobre el proyecto blog anterior, vamos a a\u00f1adir estos dos cambios: A\u00f1ade una nueva ruta parametrizada a posts/{id} , de manera que el par\u00e1metro id sea num\u00e9rico (es decir, s\u00f3lo contenga d\u00edgitos del 0 al 9) y obligatorio. Haz que la ruta devuelva el mensaje \u201cFicha del post XXXX\u201d, siendo XXXX el id que haya recibido como par\u00e1metro. Si no se inserta id deber\u00e1 mostrar el id=1. Pon un nombre a las tres rutas que hay definidas hasta ahora: a la p\u00e1gina de inicio ponle el nombre \u201cinicio\u201d, a la del listado la llamaremos \u201cposts_listado\u201d y a la de ficha que acabas de crear, la llamaremos \u201cposts_ficha\u201d. ejercicio 3 Continuamos con el proyecto blog . En este caso vamos a definir una plantilla y una serie de vistas que la utilicen. Comenzaremos definiendo una plantilla llamada plantilla.blade.php en la carpeta de vistas del proyecto ( resources/views ). Define una cabecera con una secci\u00f3n yield para el t\u00edtulo, y otra para el contenido de la p\u00e1gina, como la del ejemplo que hemos visto anteriormente. Define en un archivo aparte en la subcarpeta: PHP 1 partials llamado: PHP 1 nav.blade.php una barra de navegaci\u00f3n que nos permita acceder a estas direcciones de momento: P\u00e1gina de inicio Listado de posts Incluye la barra de navegaci\u00f3n en la plantilla base que has definido antes. A partir de la plantilla base, define otras dos vistas en una subcarpeta posts , llamadas posts/listado.blade.php y posts/ficha.blade.php . Como t\u00edtulo de cada p\u00e1gina pon un breve texto de lo que son (por ejemplo, \u201cListado posts\u201d y \u201cFicha post\u201d), y como contenido de momento deja un encabezado h1 que indique la p\u00e1gina en la que estamos: \u201cListado de posts\u201d o \u201cFicha del post XXXX\u201d, donde XXXX ser\u00e1 el identificador del post que habremos pasado por la URL (y que deber\u00e1s pasar a la vista). Haz que las rutas correspondientes de routes/web.php que ya has definido rendericen estas vistas en lugar de devolver texto plano. Ejercicio 4 Sobre el mismo proyecto blog que venimos desarrollando, incorpora ahora los estilos de Bootstrap siguiendo los pasos vistos en estos apuntes: Instala con composer la librer\u00eda laravel/ui , y util\u00edzala para incorporar Bootstrap al proyecto. Descarga Bootstrap con npm install , y actualiza los archivos CSS y JavaScript con npm run dev . Incorpora los estilos /css/app.css a la plantilla base del proyecto, para que los utilicen todas las vistas que heredan de ella. Edita el archivo partials/nav.blade.php para modificar la barra de navegaci\u00f3n y dejarla con un estilo particular de Bootstrap. Puedes consultar esta p\u00e1gina para tomar ideas de algunos dise\u00f1os que puedes aplicar en la barra de navegaci\u00f3n. Renombra el archivo welcome.blade.php a inicio.blade.php y c\u00e1mbialo para que tambi\u00e9n herede de la plantilla base. A\u00f1ade alg\u00fan texto introductorio como contenido. Puede quedarte m\u00e1s o menos as\u00ed (la barra de navegaci\u00f3n superior puede variar en funci\u00f3n del estilo que hayas querido darle). \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_02.zip . bibliografia Nacho Iborra Baeza .","title":"ud07 Laravel 2 RutasYVistas actividades"},{"location":"ud07/ud07_Laravel_2_RutasYVistas_actividades/#ejercicios-propuestos","text":"","title":"ejercicios propuestos"},{"location":"ud07/ud07_Laravel_2_RutasYVistas_actividades/#ejercicio-1","text":"Sobre el proyecto blog del punto Introducci\u00f3n , edita el fichero routes/web.php y a\u00f1ade: a) una nueva ruta a la URL posts . Al acceder a esta ruta ( http://blog/posts ), deberemos ver un mensaje con el texto \u201cListado de posts\u201d. b) una nueva ruta a la URL fecha . Al acceder a esta ruta ( http://blog/fecha ), deberemos ver un mensaje con el d\u00eda y la hora actual.","title":"ejercicio 1"},{"location":"ud07/ud07_Laravel_2_RutasYVistas_actividades/#ejercicio-2","text":"Sobre el proyecto blog anterior, vamos a a\u00f1adir estos dos cambios: A\u00f1ade una nueva ruta parametrizada a posts/{id} , de manera que el par\u00e1metro id sea num\u00e9rico (es decir, s\u00f3lo contenga d\u00edgitos del 0 al 9) y obligatorio. Haz que la ruta devuelva el mensaje \u201cFicha del post XXXX\u201d, siendo XXXX el id que haya recibido como par\u00e1metro. Si no se inserta id deber\u00e1 mostrar el id=1. Pon un nombre a las tres rutas que hay definidas hasta ahora: a la p\u00e1gina de inicio ponle el nombre \u201cinicio\u201d, a la del listado la llamaremos \u201cposts_listado\u201d y a la de ficha que acabas de crear, la llamaremos \u201cposts_ficha\u201d.","title":"ejercicio 2"},{"location":"ud07/ud07_Laravel_2_RutasYVistas_actividades/#ejercicio-3","text":"Continuamos con el proyecto blog . En este caso vamos a definir una plantilla y una serie de vistas que la utilicen. Comenzaremos definiendo una plantilla llamada plantilla.blade.php en la carpeta de vistas del proyecto ( resources/views ). Define una cabecera con una secci\u00f3n yield para el t\u00edtulo, y otra para el contenido de la p\u00e1gina, como la del ejemplo que hemos visto anteriormente. Define en un archivo aparte en la subcarpeta: PHP 1 partials llamado: PHP 1 nav.blade.php una barra de navegaci\u00f3n que nos permita acceder a estas direcciones de momento: P\u00e1gina de inicio Listado de posts Incluye la barra de navegaci\u00f3n en la plantilla base que has definido antes. A partir de la plantilla base, define otras dos vistas en una subcarpeta posts , llamadas posts/listado.blade.php y posts/ficha.blade.php . Como t\u00edtulo de cada p\u00e1gina pon un breve texto de lo que son (por ejemplo, \u201cListado posts\u201d y \u201cFicha post\u201d), y como contenido de momento deja un encabezado h1 que indique la p\u00e1gina en la que estamos: \u201cListado de posts\u201d o \u201cFicha del post XXXX\u201d, donde XXXX ser\u00e1 el identificador del post que habremos pasado por la URL (y que deber\u00e1s pasar a la vista). Haz que las rutas correspondientes de routes/web.php que ya has definido rendericen estas vistas en lugar de devolver texto plano.","title":"ejercicio 3"},{"location":"ud07/ud07_Laravel_2_RutasYVistas_actividades/#ejercicio-4","text":"Sobre el mismo proyecto blog que venimos desarrollando, incorpora ahora los estilos de Bootstrap siguiendo los pasos vistos en estos apuntes: Instala con composer la librer\u00eda laravel/ui , y util\u00edzala para incorporar Bootstrap al proyecto. Descarga Bootstrap con npm install , y actualiza los archivos CSS y JavaScript con npm run dev . Incorpora los estilos /css/app.css a la plantilla base del proyecto, para que los utilicen todas las vistas que heredan de ella. Edita el archivo partials/nav.blade.php para modificar la barra de navegaci\u00f3n y dejarla con un estilo particular de Bootstrap. Puedes consultar esta p\u00e1gina para tomar ideas de algunos dise\u00f1os que puedes aplicar en la barra de navegaci\u00f3n. Renombra el archivo welcome.blade.php a inicio.blade.php y c\u00e1mbialo para que tambi\u00e9n herede de la plantilla base. A\u00f1ade alg\u00fan texto introductorio como contenido. Puede quedarte m\u00e1s o menos as\u00ed (la barra de navegaci\u00f3n superior puede variar en funci\u00f3n del estilo que hayas querido darle). \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_02.zip .","title":"Ejercicio 4"},{"location":"ud07/ud07_Laravel_2_RutasYVistas_actividades/#bibliografia","text":"Nacho Iborra Baeza .","title":"bibliografia"},{"location":"ud07/ud07_Laravel_3_Controladores/","text":"unit: unidad did\u00e1ctica 7 title: Laravel - Controladores language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets controladores y tipos Controladores de un s\u00f3lo m\u00e9todo (invoke) Controladores de varios m\u00e9todos Controladores de recursos 2.2. Controladores de API 3. Rutas, vistas y controladores 3.1. Aunando todas las rutas de un controlador 3.2. Renombrando las rutas inyecci\u00f3n de dependencias Inyectando la petici\u00f3n del usuario Inyectando la respuesta del servidor Usar la respuesta para hacer redirecciones Los helpers bibliografia El uso de estos materiales est\u00e1 sujeto a una licencia Creative Commons CC BY-NC . Material extra\u00eddo de https://nachoiborraies.github.io/laravel/ controladores y tipos Los controladores permiten estructurar mejor el c\u00f3digo de nuestra aplicaci\u00f3n. Su principal utilidad radica en liberar a los archivos de rutas de tener que ocuparse tambi\u00e9n de gestionar cierta l\u00f3gica com\u00fan de las peticiones, como el acceso a los datos, validaci\u00f3n de formularios, etc. Adem\u00e1s, a medida que la aplicaci\u00f3n crezca, el archivo de rutas puede ser demasiado grande si tiene que almacenar tambi\u00e9n la l\u00f3gica de cada ruta, y el tiempo de procesamiento del archivo tambi\u00e9n crecer\u00e1. Lo mejor es dividir esa l\u00f3gica en controladores. Para definir un controlador en nuestra aplicaci\u00f3n, tenemos que echar mano de nuevo del comando php artisan visto previamente. En concreto, utilizaremos la opci\u00f3n make:controller seguida del nombre que le queramos dar al controlador. T\u00edpicamente, los nombres de controladores terminan con el sufijo Controller , por lo que podemos crear uno de prueba as\u00ed: PHP 1 php artisan make:controller PruebaController Esto generar\u00e1 una clase vac\u00eda con el nombre del controlador. Por defecto, los controladores se guardan en la subcarpeta app/Http/Controllers de nuestro proyecto Laravel. Controladores de un s\u00f3lo m\u00e9todo ( invoke ) El comando anterior admite algunos par\u00e1metros adicionales m\u00e1s. Uno muy \u00fatil es el par\u00e1metro -i , que crea el controlador con un m\u00e9todo llamado __invoke , que se auto ejecuta cuando es llamado desde alg\u00fan proceso de enrutamiento. Por ejemplo, si creamos el controlador as\u00ed: PHP 1 php artisan make:controller PruebaController -i Se crear\u00e1 la clase PruebaController en la carpeta app/Http/Controllers , con un contenido como \u00e9ste: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php namespace App\\Http\\Controllers ; use Illuminate\\Http\\Request ; class PruebaController extends Controller { ... public function __invoke ( Request $request ) { ... } } Dentro del m\u00e9todo __invoke podemos definir la l\u00f3gica de generar u obtener los datos que necesita una vista, y renderizarla. Por ejemplo: PHP 1 2 3 4 5 public function __invoke(Request $request) { $datos = array(...); return view('miVista', compact('datos')); } As\u00ed, en el archivo de rutas, basta con definir la ruta que queramos, y como segundo par\u00e1metro del m\u00e9todo get , indicar el nombre del controlador que se va a disparar para procesar esa ruta. Adicionalmente, tambi\u00e9n le podemos asignar un nombre a la ruta, como ya hemos hecho en ejemplos anteriores. PHP 1 Route::get('prueba', 'PruebaController')->name('prueba'); Alternativamente (y de manera especial desde Laravel 8, donde la anterior forma de definir rutas asociadas a controlador ya no funciona directamente), podemos especificar la clase del controlador, incluyendo con use dicha clase en el archivo de rutas: PHP 1 2 3 use App\\Http\\Controllers\\PruebaController; ... Route::get('prueba', PruebaController::class)->name('prueba'); Controladores de varios m\u00e9todos Los controladores de tipo invoke son \u00fatiles para definir controladores simples, donde s\u00f3lo necesitamos un m\u00e9todo para procesar rutas asociadas a una entidad del programa. Esto no es lo habitual, ya que, por ejemplo, para una misma entidad (como puedan ser los libros de nuestra biblioteca), necesitaremos m\u00e9todos para listarlos, crearlos, borrarlos, etc. En este caso, podemos crear otros tipos de controladores que ofrecen m\u00e1s m\u00e9todos disponibles. Controladores de recursos Si creamos un controlador con la opci\u00f3n -r en lugar de la opci\u00f3n -i utilizada en el ejemplo anterior, crear\u00e1 un controlador de recursos ( resources ), y predefinir\u00e1 en \u00e9l una serie de m\u00e9todos de utilidad para las operaciones principales que se pueden realizar sobre una entidad de nuestra aplicaci\u00f3n: index : muestra un listado de los elementos de esa entidad o recurso create : muestra el formulario para dar de alta nuevos elementos store : almacena en la base de datos el recurso creado con el formulario anterior show : muestra los datos de un recurso espec\u00edfico (a partir de su clave o id ). edit : muestra el formulario para editar un recurso existente update : actualiza en la base de datos el recurso editado con el formulario anterior destroy : elimina un recurso por su identificador. Obviamente, el c\u00f3digo de todos estos m\u00e9todos aparecer\u00e1 vac\u00edo al principio, y los deberemos rellenar con las operaciones correspondientes m\u00e1s adelante. Si queremos utilizar un controlador de este tipo, y llamar a alguno de sus m\u00e9todos desde alguna ruta, ya no basta con poner el nombre del controlador, como hac\u00edamos antes con los de tipo invoke , puesto que ahora hay m\u00e1s de un m\u00e9todo que elegir. Lo que haremos ser\u00e1 poner el nombre del controlador, seguido de una arroba @ y el nombre del m\u00e9todo a invocar. Por ejemplo: PHP 1 Route::get('prueba', 'PruebaController@index')->name('listado_prueba'); Tambi\u00e9n de forma alternativa podemos emplear la propia clase del controlador en la definici\u00f3n de la ruta (recomendado desde Laravel 8). En este caso, definimos un array con la clase del controlador y el m\u00e9todo a llamar ( index en nuestro caso): PHP 1 2 3 4 use App\\Http\\Controllers\\PruebaController; ... Route::get('prueba', [PruebaController::class, 'index']) ->name('listado_prueba'); Vamos a probar esta opci\u00f3n en nuestro proyecto de biblioteca. Crearemos un controlador para gestionar los libros, con este comando: PHP 1 php artisan make:controller -r LibroController De momento varios de los m\u00e9todos generados en el controlador no los vamos a utilizar. Podemos modificar los dos que s\u00ed vamos a usar de momento ( index y show ) y poner en ellos lo que antes ten\u00edamos en el archivo de rutas. As\u00ed nos quedar\u00edan, respectivamente: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public function index() { $libros = array( array(\"titulo\" => \"El juego de Ender\", \"autor\" => \"Orson Scott Card\"), array(\"titulo\" => \"La tabla de Flandes\", \"autor\" => \"Arturo P\u00e9rez Reverte\"), array(\"titulo\" => \"La historia interminable\", \"autor\" => \"Michael Ende\"), array(\"titulo\" => \"El Se\u00f1or de los Anillos\", \"autor\" => \"J.R.R. Tolkien\") ); return view('listado', compact('libros')); } public function show($id) { return \"Mostrando ficha de libro $id\"; } NOTA: el m\u00e9todo show no lo hab\u00edamos implementado en la sesi\u00f3n anterior, pero b\u00e1sicamente lo vamos a utilizar para mostrar la ficha de un libro. De momento mostramos s\u00f3lo el id del libro recibido, como texto plano. Estas dos rutas quedar\u00edan ahora as\u00ed en el archivo routes/web.php (eliminar\u00edamos la vieja ruta de listado de posts): PHP 1 2 Route::get('libros', 'LibroController@index'); Route::get('libros/{id}', 'LibroController@show'); O de forma alternativa (desde Laravel 8): PHP 1 2 3 4 use App\\Http\\Controllers\\LibroController; ... Route::get('libros', [LibroController::class, 'index']); Route::get('libros/{id}', [LibroController::class, 'show']); 2.2. Controladores de API Como alternativa a los controladores de recursos vistos antes, podemos crear los controladores con la opci\u00f3n --api . Crear\u00e1 un controlador con los mismos m\u00e9todos que el de recursos, salvo los m\u00e9todos create y edit , encargados de mostrar los formularios de creaci\u00f3n y edici\u00f3n de recursos, ya que en las APIs estos formularios no son necesarios, como veremos en sesiones posteriores. 3. Rutas, vistas y controladores A medida que el proyecto crece, generaremos un buen n\u00famero de vistas asociadas a controladores, y es necesario estructurar estas vistas de una forma adecuada para poderlas identificar r\u00e1pidamente. Una convenci\u00f3n que podemos seguir es nombrar las vistas a partir del controlador o modelo al que hacen referencia, y a la operaci\u00f3n que realizan. Por ejemplo, si tenemos un controlador llamado PruebaController , se supone que actuar\u00e1 sobre una tabla llamada pruebas (lo veremos m\u00e1s adelante, en la sesi\u00f3n de acceso a datos). En nuestro caso de la biblioteca, podemos almacenar las vistas de los libros de la biblioteca en la subcarpeta resources/views/libros , y definir dentro las vistas asociadas a cada operaci\u00f3n del controlador que tengamos definida. Por ejemplo: index.blade.php show.blade.php \u2026 Paralelamente, cada vez que vayamos a cargar una vista desde alg\u00fan controlador o ruta, haremos referencia a este nombre. As\u00ed, si queremos renderizar la vista show para los libros desde el m\u00e9todo show del controlador de libros, har\u00edamos algo as\u00ed (pas\u00e1ndole como par\u00e1metro el id del libro a buscar, para que lo saque en la vista por ahora): PHP 1 2 3 4 public function show($id) { return view('libros.show', compact('id')); } Del mismo modo, los nombres que asociemos a las rutas deber\u00edan seguir este mismo patr\u00f3n. 3.1. Aunando todas las rutas de un controlador Al final de todo el proceso de implementaci\u00f3n de un controlador (de recursos o de API) tendremos en el archivo de rutas una dedicada a cada m\u00e9todo del controlador (una para index , otra para show , etc.). Estas rutas pueden agruparse en una sola usando el m\u00e9todo resource de la clase Route , en lugar de get , indic\u00e1ndole como par\u00e1metros el nombre base de la ruta, y el controlador que se va a encargar de ella: PHP 1 2 3 use App\\Http\\Controllers\\LibroController; ... Route::resource('libros', LibroController::class); La ruta anterior definir\u00e1 una ruta GET hacia /libros , atendida por el m\u00e9todo index del controlador, otra ruta GET hacia /libros/{id} atendida por el m\u00e9todo show del controlador\u2026 etc. IMPORTANTE : a trav\u00e9s de la ruta Route::resource s\u00f3lo se incluyen los m\u00e9todos est\u00e1ndar de un controlador de recursos ( index , show , create , edit , etc), pero NO los que a\u00f1adamos a mano despu\u00e9s en dicho controlador con otros nombres. Tambi\u00e9n podemos utilizar el m\u00e9todo only para indicar para qu\u00e9 m\u00e9todos queremos rutas: PHP 1 2 3 4 use App\\Http\\Controllers\\LibroController; ... Route::resource('libros', LibroController::class) ->only(['index', 'show']); Desde el lado opuesto, tenemos disponible el m\u00e9todo except para indicar que se generen todas las rutas excepto aquellas para los m\u00e9todos indicados: PHP 1 2 3 4 use App\\Http\\Controllers\\LibroController; ... Route::resource('libros', LibroController::class) ->except(['update', 'edit']); Con los controladores de tipo API tambi\u00e9n podemos generar autom\u00e1ticamente todas las rutas para sus m\u00e9todos, utilizando el m\u00e9todo apiResource de la clase Route , en lugar del m\u00e9todo resource empleado antes: PHP 1 2 3 use App\\Http\\Controllers\\PruebaController; ... Route::apiResource('prueba', PruebaController::class); 3.2. Renombrando las rutas Si generamos rutas autom\u00e1ticas para los m\u00e9todos de un controlador, veremos que para los formularios de crear y editar se define una ruta terminada en /create o en /edit , respectivamente. Esto puede chocar si pretendemos una web hecha en otro idioma. Pero podemos cambiar el nombre que se genera autom\u00e1ticamente para estas rutas, editando el proveedor de servicios AppServiceProvider , ubicado en la carpeta app/Providers . En el m\u00e9todo boot , podemos llamar al m\u00e9todo resourceVerbs de la clase Route y renombrar los verbos utilizados para acceder a las rutas del recurso. Por ejemplo: PHP 1 2 3 4 5 6 7 public function boot() { Route::resourceVerbs([ 'create' => 'crear', 'edit' => 'editar' ]) } NOTA : deberemos incluir con use el espacio de nombres Illuminate\\Support\\Facades\\Route para poder emplear la clase Route en el proveedor de servicios. Para nuestro ejemplo de la biblioteca, podemos devolver un texto plano en los m\u00e9todos create y edit que indiquen que ah\u00ed va un formulario: PHP 1 2 3 4 5 6 7 8 9 public function create() { return \"Formulario de inserci\u00f3n de libros\"; } public function edit() { return \"Formulario de edici\u00f3n de libros\"; } Nuestro archivo de rutas se puede quedar con esta \u00fanica instrucci\u00f3n para todas las rutas de libros, indicando que por ahora s\u00f3lo vamos a gestionar el listado, la ficha y los dos formularios: PHP 1 2 Route::resource('libros', LibroController::class) ->only(['index', 'show', 'create', 'edit']); Ahora ya podemos acceder a estas 4 URLs y ver la respuesta correspondiente: http://biblioteca/libros (llamar\u00e1 a index ) http://biblioteca/libros/3 (llamar\u00e1 a show para el libro 3) http://biblioteca/libros/crear (llamar\u00e1 a create ) http://biblioteca/libros/3/editar (llamar\u00e1 a edit para el libro 3) Notar que la URL aparece en castellano gracias a los cambios en AppServiceProvider , pero los nombres de funciones en los controladores siguen estando en ingl\u00e9s, as\u00ed como en los elementos de la llamada al m\u00e9todo only . Podemos consultar el conjunto de rutas al que est\u00e1 respondiendo nuestra aplicaci\u00f3n en todo momento con este comando: PHP 1 php artisan route:list inyecci\u00f3n de dependencias El concepto de inyecci\u00f3n de dependencias es muy habitual en el uso de frameworks. Consiste en un mecanismo que facilita recursos a los diferentes componentes de la aplicaci\u00f3n, y es algo que ya hemos utilizado, sin saberlo, en los m\u00e9todos que se han generado para los controladores. Inyectando la petici\u00f3n del usuario Cuando definimos un m\u00e9todo en un controlador que necesita procesar una petici\u00f3n, se le pasa como par\u00e1metro un objeto de tipo Request . Autom\u00e1ticamente, Laravel procesa el tipo de dato y obtiene el objeto asociado (en este caso, la petici\u00f3n del cliente). PHP 1 2 3 4 5 6 7 8 class LibroController extends Controller { ... public function store(Request $request) { ... } } Inyectando la respuesta del servidor Al igual que tenemos un objeto Request para obtener datos de la petici\u00f3n, tambi\u00e9n existe un Response para gestionar la respuesta. Laravel proporciona un m\u00e9todo response al que le podemos pasar varios par\u00e1metros: El contenido de la respuesta El c\u00f3digo de estado HTTP de respuesta (si no se especifica, por defecto es 200) Un array con las cabeceras de respuesta (por defecto est\u00e1 vac\u00edo). As\u00ed, si por ejemplo queremos emitir una respuesta determinada con su c\u00f3digo de estado desde un controlador, podemos hacer esto (por ejemplo, para un c\u00f3digo 201): PHP 1 response(\"Mensaje de respuesta\", 201); Las cabeceras pueden especificarse como un array, o enlazando llamadas al m\u00e9todo header (una para cada cabecera): PHP 1 2 3 response(\"Mensaje de respuesta\", 201) ->header('Cabecera1', 'Valor1') ->header('Cabecera2', 'Valor2'); En el caso de querer devolver un objeto como respuesta, podemos emplear el m\u00e9todo json de la respuesta (m\u00e1s adelante veremos que todos los objetos emitidos directamente al cliente se env\u00edan en formato JSON), y as\u00ed podremos adjuntar un c\u00f3digo de estado diferente de 200: PHP 1 2 3 return response()->json(['datos' => datos], 201) ->header('Cabecera1', 'Valor1') ...; Usar la respuesta para hacer redirecciones Existe tambi\u00e9n un m\u00e9todo redirect que podemos emplear para redireccionar a una ruta desde otra, bien especificando la ruta como par\u00e1metro\u2026 PHP 1 redirect('/'); \u2026 o bien indicando una ruta con nombre: PHP 1 redirect()->route('inicio'); Podemos pasar valores a la siguiente redirecci\u00f3n, almacen\u00e1ndolos en sesi\u00f3n con el m\u00e9todo with , aunque estos valores se perder\u00e1n en la siguiente petici\u00f3n (no se quedan almacenados en sesi\u00f3n): PHP 1 2 redirect()->route('inicio') ->with('mensaje', 'Mensaje enviado correctamente'); Para acceder a este mensaje desde la vista afectada, debemos utilizar la funci\u00f3n session : PHP 1 2 3 @if(session()->has('mensaje')) {{ session('mensaje') }} @endif Por \u00faltimo, notar que si hacemos la redirecci\u00f3n desde dentro de un m\u00e9todo de un controlador (por ejemplo, para redigir a una ruta desde otra), deberemos devolver ( return ) el resultado de esa redirecci\u00f3n para que surta efecto: PHP 1 2 3 4 5 6 7 8 9 10 11 12 class LibroController extends Controller { public function index() { ... } public function store(...) { ... return redirect()->route('libros.index'); } Los helpers Para terminar esta introducci\u00f3n a lo que supone la inyecci\u00f3n de dependencias en frameworks de desarrollo, vamos a hacer uso de una herramienta que nos puede ser \u00fatil en algunas situaciones: los helpers . Un helper es b\u00e1sicamente una funci\u00f3n de utilidad que podemos querer utilizar en diversos puntos de nuestra web, y que necesitamos tener localizada y compartida. Por ejemplo, imaginemos que queremos resaltar en nuestro men\u00fa de navegaci\u00f3n la opci\u00f3n que tenemos actualmente visible. Para ello, podemos definir una clase CSS con el estilo que queramos para resaltar (esto lo haremos aparte, en los archivos CSS del proyecto), y despu\u00e9s utilizar esa clase CSS en una condici\u00f3n para cada men\u00fa de navegaci\u00f3n. Por ejemplo, supongamos que la clase CSS para identificar el men\u00fa activo se llama activo . En este caso, para un men\u00fa de varias opciones como \u00e9ste, basta con utilizar el m\u00e9todo routeIs de la petici\u00f3n ( request ) para comprobar si la ruta coincide con cada men\u00fa, y mostrarlo como activo o no, usando un operador ternario de comparaci\u00f3n: PHP 1 2 3 4 5 6 7 8 9 10 11 <nav> <ul> <li class=\"{{ request()->routeIs('inicio') ? 'activo' : '' }}\"> <a href=\"/\">Inicio</a> </li> <li class=\"{{ request()->routeIs('contacto') ? 'activo' : '' }}\"> <a href=\"/contacto\">Contacto</a> </li> ... </ul> </nav> Esta caracter\u00edstica tambi\u00e9n funciona si las rutas tienen par\u00e1metros. Podemos, en cambio, sacar fuera de la vista la l\u00f3gica de establecer un campo como activo o no. Para ello, creamos un archivo de utilidad o helper . Lo podemos llamar helpers.php , y ubicarlo en la misma carpeta app . Dentro, definimos la funci\u00f3n que nos va a devolver si una ruta est\u00e1 activa o no, a partir de su nombre: PHP 1 2 3 4 5 6 <?php function setActivo ( $nombreRuta ) { return request () -> routeIs ( $nombreRuta ) ? 'activo' : '' ; } Y de este modo, nuestra vista simplemente se dedica a llamar a esta funci\u00f3n para cada elemento del men\u00fa: PHP 1 2 3 4 5 6 7 8 9 10 11 <nav> <ul> <li class=\"{{ setActivo('inicio') }}\"> <a href=\"/\">Inicio</a> </li> <li class=\"{{ setActivo('contacto') }}\"> <a href=\"/contacto\">Contacto</a> </li> ... </ul> </nav> En el caso de querer mantener el enlace activo para cualquier subruta a partir de la original (por ejemplo, cuando estamos viendo la ficha de un registro a partir del listado general, podemos utilizar el wildcard de asterisco * ): PHP 1 2 3 <li class=\"{{ setActivo('peliculas.*') }}\"> <a href=\"{{ route('peliculas') }}\">Peliculas</a> </li> Sin embargo, para que Laravel cargue el archivo helpers.php que acabamos de crear, como no es una clase, debemos indicarlo expl\u00edcitamente (Laravel carga autom\u00e1ticamente todas las clases de la carpeta app , pero no archivos sueltos que no sean clases). Para ello, debemos ir al archivo composer.json de la ra\u00edz de nuestro proyecto, a la secci\u00f3n autoload y a\u00f1adir una secci\u00f3n files con un array con los archivos que queramos que se carguen tambi\u00e9n: PHP 1 2 3 4 5 \"autoload\": { \"classmap\": [ ... ], \"psr-4\": { ... }, \"files\": [\"app/helpers.php\"] }, Tras efectuar el cambio, debemos decirle a composer que vuelva a compilar el auto cargador. Desde la carpeta del proyecto, ejecutamos este comando: PHP 1 composer dump-autoload bibliografia Nacho Iborra Baeza .","title":"ud07 Laravel 3 Controladores"},{"location":"ud07/ud07_Laravel_3_Controladores/#controladores-y-tipos","text":"Los controladores permiten estructurar mejor el c\u00f3digo de nuestra aplicaci\u00f3n. Su principal utilidad radica en liberar a los archivos de rutas de tener que ocuparse tambi\u00e9n de gestionar cierta l\u00f3gica com\u00fan de las peticiones, como el acceso a los datos, validaci\u00f3n de formularios, etc. Adem\u00e1s, a medida que la aplicaci\u00f3n crezca, el archivo de rutas puede ser demasiado grande si tiene que almacenar tambi\u00e9n la l\u00f3gica de cada ruta, y el tiempo de procesamiento del archivo tambi\u00e9n crecer\u00e1. Lo mejor es dividir esa l\u00f3gica en controladores. Para definir un controlador en nuestra aplicaci\u00f3n, tenemos que echar mano de nuevo del comando php artisan visto previamente. En concreto, utilizaremos la opci\u00f3n make:controller seguida del nombre que le queramos dar al controlador. T\u00edpicamente, los nombres de controladores terminan con el sufijo Controller , por lo que podemos crear uno de prueba as\u00ed: PHP 1 php artisan make:controller PruebaController Esto generar\u00e1 una clase vac\u00eda con el nombre del controlador. Por defecto, los controladores se guardan en la subcarpeta app/Http/Controllers de nuestro proyecto Laravel.","title":"controladores y tipos"},{"location":"ud07/ud07_Laravel_3_Controladores/#controladores-de-un-solo-metodo-invoke","text":"El comando anterior admite algunos par\u00e1metros adicionales m\u00e1s. Uno muy \u00fatil es el par\u00e1metro -i , que crea el controlador con un m\u00e9todo llamado __invoke , que se auto ejecuta cuando es llamado desde alg\u00fan proceso de enrutamiento. Por ejemplo, si creamos el controlador as\u00ed: PHP 1 php artisan make:controller PruebaController -i Se crear\u00e1 la clase PruebaController en la carpeta app/Http/Controllers , con un contenido como \u00e9ste: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 <?php namespace App\\Http\\Controllers ; use Illuminate\\Http\\Request ; class PruebaController extends Controller { ... public function __invoke ( Request $request ) { ... } } Dentro del m\u00e9todo __invoke podemos definir la l\u00f3gica de generar u obtener los datos que necesita una vista, y renderizarla. Por ejemplo: PHP 1 2 3 4 5 public function __invoke(Request $request) { $datos = array(...); return view('miVista', compact('datos')); } As\u00ed, en el archivo de rutas, basta con definir la ruta que queramos, y como segundo par\u00e1metro del m\u00e9todo get , indicar el nombre del controlador que se va a disparar para procesar esa ruta. Adicionalmente, tambi\u00e9n le podemos asignar un nombre a la ruta, como ya hemos hecho en ejemplos anteriores. PHP 1 Route::get('prueba', 'PruebaController')->name('prueba'); Alternativamente (y de manera especial desde Laravel 8, donde la anterior forma de definir rutas asociadas a controlador ya no funciona directamente), podemos especificar la clase del controlador, incluyendo con use dicha clase en el archivo de rutas: PHP 1 2 3 use App\\Http\\Controllers\\PruebaController; ... Route::get('prueba', PruebaController::class)->name('prueba');","title":"Controladores de un s\u00f3lo m\u00e9todo (invoke)"},{"location":"ud07/ud07_Laravel_3_Controladores/#controladores-de-varios-metodos","text":"Los controladores de tipo invoke son \u00fatiles para definir controladores simples, donde s\u00f3lo necesitamos un m\u00e9todo para procesar rutas asociadas a una entidad del programa. Esto no es lo habitual, ya que, por ejemplo, para una misma entidad (como puedan ser los libros de nuestra biblioteca), necesitaremos m\u00e9todos para listarlos, crearlos, borrarlos, etc. En este caso, podemos crear otros tipos de controladores que ofrecen m\u00e1s m\u00e9todos disponibles.","title":"Controladores de varios m\u00e9todos"},{"location":"ud07/ud07_Laravel_3_Controladores/#controladores-de-recursos","text":"Si creamos un controlador con la opci\u00f3n -r en lugar de la opci\u00f3n -i utilizada en el ejemplo anterior, crear\u00e1 un controlador de recursos ( resources ), y predefinir\u00e1 en \u00e9l una serie de m\u00e9todos de utilidad para las operaciones principales que se pueden realizar sobre una entidad de nuestra aplicaci\u00f3n: index : muestra un listado de los elementos de esa entidad o recurso create : muestra el formulario para dar de alta nuevos elementos store : almacena en la base de datos el recurso creado con el formulario anterior show : muestra los datos de un recurso espec\u00edfico (a partir de su clave o id ). edit : muestra el formulario para editar un recurso existente update : actualiza en la base de datos el recurso editado con el formulario anterior destroy : elimina un recurso por su identificador. Obviamente, el c\u00f3digo de todos estos m\u00e9todos aparecer\u00e1 vac\u00edo al principio, y los deberemos rellenar con las operaciones correspondientes m\u00e1s adelante. Si queremos utilizar un controlador de este tipo, y llamar a alguno de sus m\u00e9todos desde alguna ruta, ya no basta con poner el nombre del controlador, como hac\u00edamos antes con los de tipo invoke , puesto que ahora hay m\u00e1s de un m\u00e9todo que elegir. Lo que haremos ser\u00e1 poner el nombre del controlador, seguido de una arroba @ y el nombre del m\u00e9todo a invocar. Por ejemplo: PHP 1 Route::get('prueba', 'PruebaController@index')->name('listado_prueba'); Tambi\u00e9n de forma alternativa podemos emplear la propia clase del controlador en la definici\u00f3n de la ruta (recomendado desde Laravel 8). En este caso, definimos un array con la clase del controlador y el m\u00e9todo a llamar ( index en nuestro caso): PHP 1 2 3 4 use App\\Http\\Controllers\\PruebaController; ... Route::get('prueba', [PruebaController::class, 'index']) ->name('listado_prueba'); Vamos a probar esta opci\u00f3n en nuestro proyecto de biblioteca. Crearemos un controlador para gestionar los libros, con este comando: PHP 1 php artisan make:controller -r LibroController De momento varios de los m\u00e9todos generados en el controlador no los vamos a utilizar. Podemos modificar los dos que s\u00ed vamos a usar de momento ( index y show ) y poner en ellos lo que antes ten\u00edamos en el archivo de rutas. As\u00ed nos quedar\u00edan, respectivamente: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 public function index() { $libros = array( array(\"titulo\" => \"El juego de Ender\", \"autor\" => \"Orson Scott Card\"), array(\"titulo\" => \"La tabla de Flandes\", \"autor\" => \"Arturo P\u00e9rez Reverte\"), array(\"titulo\" => \"La historia interminable\", \"autor\" => \"Michael Ende\"), array(\"titulo\" => \"El Se\u00f1or de los Anillos\", \"autor\" => \"J.R.R. Tolkien\") ); return view('listado', compact('libros')); } public function show($id) { return \"Mostrando ficha de libro $id\"; } NOTA: el m\u00e9todo show no lo hab\u00edamos implementado en la sesi\u00f3n anterior, pero b\u00e1sicamente lo vamos a utilizar para mostrar la ficha de un libro. De momento mostramos s\u00f3lo el id del libro recibido, como texto plano. Estas dos rutas quedar\u00edan ahora as\u00ed en el archivo routes/web.php (eliminar\u00edamos la vieja ruta de listado de posts): PHP 1 2 Route::get('libros', 'LibroController@index'); Route::get('libros/{id}', 'LibroController@show'); O de forma alternativa (desde Laravel 8): PHP 1 2 3 4 use App\\Http\\Controllers\\LibroController; ... Route::get('libros', [LibroController::class, 'index']); Route::get('libros/{id}', [LibroController::class, 'show']);","title":"Controladores de recursos"},{"location":"ud07/ud07_Laravel_3_Controladores/#22-controladores-de-api","text":"Como alternativa a los controladores de recursos vistos antes, podemos crear los controladores con la opci\u00f3n --api . Crear\u00e1 un controlador con los mismos m\u00e9todos que el de recursos, salvo los m\u00e9todos create y edit , encargados de mostrar los formularios de creaci\u00f3n y edici\u00f3n de recursos, ya que en las APIs estos formularios no son necesarios, como veremos en sesiones posteriores.","title":"2.2. Controladores de API"},{"location":"ud07/ud07_Laravel_3_Controladores/#3-rutas-vistas-y-controladores","text":"A medida que el proyecto crece, generaremos un buen n\u00famero de vistas asociadas a controladores, y es necesario estructurar estas vistas de una forma adecuada para poderlas identificar r\u00e1pidamente. Una convenci\u00f3n que podemos seguir es nombrar las vistas a partir del controlador o modelo al que hacen referencia, y a la operaci\u00f3n que realizan. Por ejemplo, si tenemos un controlador llamado PruebaController , se supone que actuar\u00e1 sobre una tabla llamada pruebas (lo veremos m\u00e1s adelante, en la sesi\u00f3n de acceso a datos). En nuestro caso de la biblioteca, podemos almacenar las vistas de los libros de la biblioteca en la subcarpeta resources/views/libros , y definir dentro las vistas asociadas a cada operaci\u00f3n del controlador que tengamos definida. Por ejemplo: index.blade.php show.blade.php \u2026 Paralelamente, cada vez que vayamos a cargar una vista desde alg\u00fan controlador o ruta, haremos referencia a este nombre. As\u00ed, si queremos renderizar la vista show para los libros desde el m\u00e9todo show del controlador de libros, har\u00edamos algo as\u00ed (pas\u00e1ndole como par\u00e1metro el id del libro a buscar, para que lo saque en la vista por ahora): PHP 1 2 3 4 public function show($id) { return view('libros.show', compact('id')); } Del mismo modo, los nombres que asociemos a las rutas deber\u00edan seguir este mismo patr\u00f3n.","title":"3. Rutas, vistas y controladores"},{"location":"ud07/ud07_Laravel_3_Controladores/#31-aunando-todas-las-rutas-de-un-controlador","text":"Al final de todo el proceso de implementaci\u00f3n de un controlador (de recursos o de API) tendremos en el archivo de rutas una dedicada a cada m\u00e9todo del controlador (una para index , otra para show , etc.). Estas rutas pueden agruparse en una sola usando el m\u00e9todo resource de la clase Route , en lugar de get , indic\u00e1ndole como par\u00e1metros el nombre base de la ruta, y el controlador que se va a encargar de ella: PHP 1 2 3 use App\\Http\\Controllers\\LibroController; ... Route::resource('libros', LibroController::class); La ruta anterior definir\u00e1 una ruta GET hacia /libros , atendida por el m\u00e9todo index del controlador, otra ruta GET hacia /libros/{id} atendida por el m\u00e9todo show del controlador\u2026 etc. IMPORTANTE : a trav\u00e9s de la ruta Route::resource s\u00f3lo se incluyen los m\u00e9todos est\u00e1ndar de un controlador de recursos ( index , show , create , edit , etc), pero NO los que a\u00f1adamos a mano despu\u00e9s en dicho controlador con otros nombres. Tambi\u00e9n podemos utilizar el m\u00e9todo only para indicar para qu\u00e9 m\u00e9todos queremos rutas: PHP 1 2 3 4 use App\\Http\\Controllers\\LibroController; ... Route::resource('libros', LibroController::class) ->only(['index', 'show']); Desde el lado opuesto, tenemos disponible el m\u00e9todo except para indicar que se generen todas las rutas excepto aquellas para los m\u00e9todos indicados: PHP 1 2 3 4 use App\\Http\\Controllers\\LibroController; ... Route::resource('libros', LibroController::class) ->except(['update', 'edit']); Con los controladores de tipo API tambi\u00e9n podemos generar autom\u00e1ticamente todas las rutas para sus m\u00e9todos, utilizando el m\u00e9todo apiResource de la clase Route , en lugar del m\u00e9todo resource empleado antes: PHP 1 2 3 use App\\Http\\Controllers\\PruebaController; ... Route::apiResource('prueba', PruebaController::class);","title":"3.1. Aunando todas las rutas de un controlador"},{"location":"ud07/ud07_Laravel_3_Controladores/#32-renombrando-las-rutas","text":"Si generamos rutas autom\u00e1ticas para los m\u00e9todos de un controlador, veremos que para los formularios de crear y editar se define una ruta terminada en /create o en /edit , respectivamente. Esto puede chocar si pretendemos una web hecha en otro idioma. Pero podemos cambiar el nombre que se genera autom\u00e1ticamente para estas rutas, editando el proveedor de servicios AppServiceProvider , ubicado en la carpeta app/Providers . En el m\u00e9todo boot , podemos llamar al m\u00e9todo resourceVerbs de la clase Route y renombrar los verbos utilizados para acceder a las rutas del recurso. Por ejemplo: PHP 1 2 3 4 5 6 7 public function boot() { Route::resourceVerbs([ 'create' => 'crear', 'edit' => 'editar' ]) } NOTA : deberemos incluir con use el espacio de nombres Illuminate\\Support\\Facades\\Route para poder emplear la clase Route en el proveedor de servicios. Para nuestro ejemplo de la biblioteca, podemos devolver un texto plano en los m\u00e9todos create y edit que indiquen que ah\u00ed va un formulario: PHP 1 2 3 4 5 6 7 8 9 public function create() { return \"Formulario de inserci\u00f3n de libros\"; } public function edit() { return \"Formulario de edici\u00f3n de libros\"; } Nuestro archivo de rutas se puede quedar con esta \u00fanica instrucci\u00f3n para todas las rutas de libros, indicando que por ahora s\u00f3lo vamos a gestionar el listado, la ficha y los dos formularios: PHP 1 2 Route::resource('libros', LibroController::class) ->only(['index', 'show', 'create', 'edit']); Ahora ya podemos acceder a estas 4 URLs y ver la respuesta correspondiente: http://biblioteca/libros (llamar\u00e1 a index ) http://biblioteca/libros/3 (llamar\u00e1 a show para el libro 3) http://biblioteca/libros/crear (llamar\u00e1 a create ) http://biblioteca/libros/3/editar (llamar\u00e1 a edit para el libro 3) Notar que la URL aparece en castellano gracias a los cambios en AppServiceProvider , pero los nombres de funciones en los controladores siguen estando en ingl\u00e9s, as\u00ed como en los elementos de la llamada al m\u00e9todo only . Podemos consultar el conjunto de rutas al que est\u00e1 respondiendo nuestra aplicaci\u00f3n en todo momento con este comando: PHP 1 php artisan route:list","title":"3.2. Renombrando las rutas"},{"location":"ud07/ud07_Laravel_3_Controladores/#inyeccion-de-dependencias","text":"El concepto de inyecci\u00f3n de dependencias es muy habitual en el uso de frameworks. Consiste en un mecanismo que facilita recursos a los diferentes componentes de la aplicaci\u00f3n, y es algo que ya hemos utilizado, sin saberlo, en los m\u00e9todos que se han generado para los controladores.","title":"inyecci\u00f3n de dependencias"},{"location":"ud07/ud07_Laravel_3_Controladores/#inyectando-la-peticion-del-usuario","text":"Cuando definimos un m\u00e9todo en un controlador que necesita procesar una petici\u00f3n, se le pasa como par\u00e1metro un objeto de tipo Request . Autom\u00e1ticamente, Laravel procesa el tipo de dato y obtiene el objeto asociado (en este caso, la petici\u00f3n del cliente). PHP 1 2 3 4 5 6 7 8 class LibroController extends Controller { ... public function store(Request $request) { ... } }","title":"Inyectando la petici\u00f3n del usuario"},{"location":"ud07/ud07_Laravel_3_Controladores/#inyectando-la-respuesta-del-servidor","text":"Al igual que tenemos un objeto Request para obtener datos de la petici\u00f3n, tambi\u00e9n existe un Response para gestionar la respuesta. Laravel proporciona un m\u00e9todo response al que le podemos pasar varios par\u00e1metros: El contenido de la respuesta El c\u00f3digo de estado HTTP de respuesta (si no se especifica, por defecto es 200) Un array con las cabeceras de respuesta (por defecto est\u00e1 vac\u00edo). As\u00ed, si por ejemplo queremos emitir una respuesta determinada con su c\u00f3digo de estado desde un controlador, podemos hacer esto (por ejemplo, para un c\u00f3digo 201): PHP 1 response(\"Mensaje de respuesta\", 201); Las cabeceras pueden especificarse como un array, o enlazando llamadas al m\u00e9todo header (una para cada cabecera): PHP 1 2 3 response(\"Mensaje de respuesta\", 201) ->header('Cabecera1', 'Valor1') ->header('Cabecera2', 'Valor2'); En el caso de querer devolver un objeto como respuesta, podemos emplear el m\u00e9todo json de la respuesta (m\u00e1s adelante veremos que todos los objetos emitidos directamente al cliente se env\u00edan en formato JSON), y as\u00ed podremos adjuntar un c\u00f3digo de estado diferente de 200: PHP 1 2 3 return response()->json(['datos' => datos], 201) ->header('Cabecera1', 'Valor1') ...;","title":"Inyectando la respuesta del servidor"},{"location":"ud07/ud07_Laravel_3_Controladores/#usar-la-respuesta-para-hacer-redirecciones","text":"Existe tambi\u00e9n un m\u00e9todo redirect que podemos emplear para redireccionar a una ruta desde otra, bien especificando la ruta como par\u00e1metro\u2026 PHP 1 redirect('/'); \u2026 o bien indicando una ruta con nombre: PHP 1 redirect()->route('inicio'); Podemos pasar valores a la siguiente redirecci\u00f3n, almacen\u00e1ndolos en sesi\u00f3n con el m\u00e9todo with , aunque estos valores se perder\u00e1n en la siguiente petici\u00f3n (no se quedan almacenados en sesi\u00f3n): PHP 1 2 redirect()->route('inicio') ->with('mensaje', 'Mensaje enviado correctamente'); Para acceder a este mensaje desde la vista afectada, debemos utilizar la funci\u00f3n session : PHP 1 2 3 @if(session()->has('mensaje')) {{ session('mensaje') }} @endif Por \u00faltimo, notar que si hacemos la redirecci\u00f3n desde dentro de un m\u00e9todo de un controlador (por ejemplo, para redigir a una ruta desde otra), deberemos devolver ( return ) el resultado de esa redirecci\u00f3n para que surta efecto: PHP 1 2 3 4 5 6 7 8 9 10 11 12 class LibroController extends Controller { public function index() { ... } public function store(...) { ... return redirect()->route('libros.index'); }","title":"Usar la respuesta para hacer redirecciones"},{"location":"ud07/ud07_Laravel_3_Controladores/#los-helpers","text":"Para terminar esta introducci\u00f3n a lo que supone la inyecci\u00f3n de dependencias en frameworks de desarrollo, vamos a hacer uso de una herramienta que nos puede ser \u00fatil en algunas situaciones: los helpers . Un helper es b\u00e1sicamente una funci\u00f3n de utilidad que podemos querer utilizar en diversos puntos de nuestra web, y que necesitamos tener localizada y compartida. Por ejemplo, imaginemos que queremos resaltar en nuestro men\u00fa de navegaci\u00f3n la opci\u00f3n que tenemos actualmente visible. Para ello, podemos definir una clase CSS con el estilo que queramos para resaltar (esto lo haremos aparte, en los archivos CSS del proyecto), y despu\u00e9s utilizar esa clase CSS en una condici\u00f3n para cada men\u00fa de navegaci\u00f3n. Por ejemplo, supongamos que la clase CSS para identificar el men\u00fa activo se llama activo . En este caso, para un men\u00fa de varias opciones como \u00e9ste, basta con utilizar el m\u00e9todo routeIs de la petici\u00f3n ( request ) para comprobar si la ruta coincide con cada men\u00fa, y mostrarlo como activo o no, usando un operador ternario de comparaci\u00f3n: PHP 1 2 3 4 5 6 7 8 9 10 11 <nav> <ul> <li class=\"{{ request()->routeIs('inicio') ? 'activo' : '' }}\"> <a href=\"/\">Inicio</a> </li> <li class=\"{{ request()->routeIs('contacto') ? 'activo' : '' }}\"> <a href=\"/contacto\">Contacto</a> </li> ... </ul> </nav> Esta caracter\u00edstica tambi\u00e9n funciona si las rutas tienen par\u00e1metros. Podemos, en cambio, sacar fuera de la vista la l\u00f3gica de establecer un campo como activo o no. Para ello, creamos un archivo de utilidad o helper . Lo podemos llamar helpers.php , y ubicarlo en la misma carpeta app . Dentro, definimos la funci\u00f3n que nos va a devolver si una ruta est\u00e1 activa o no, a partir de su nombre: PHP 1 2 3 4 5 6 <?php function setActivo ( $nombreRuta ) { return request () -> routeIs ( $nombreRuta ) ? 'activo' : '' ; } Y de este modo, nuestra vista simplemente se dedica a llamar a esta funci\u00f3n para cada elemento del men\u00fa: PHP 1 2 3 4 5 6 7 8 9 10 11 <nav> <ul> <li class=\"{{ setActivo('inicio') }}\"> <a href=\"/\">Inicio</a> </li> <li class=\"{{ setActivo('contacto') }}\"> <a href=\"/contacto\">Contacto</a> </li> ... </ul> </nav> En el caso de querer mantener el enlace activo para cualquier subruta a partir de la original (por ejemplo, cuando estamos viendo la ficha de un registro a partir del listado general, podemos utilizar el wildcard de asterisco * ): PHP 1 2 3 <li class=\"{{ setActivo('peliculas.*') }}\"> <a href=\"{{ route('peliculas') }}\">Peliculas</a> </li> Sin embargo, para que Laravel cargue el archivo helpers.php que acabamos de crear, como no es una clase, debemos indicarlo expl\u00edcitamente (Laravel carga autom\u00e1ticamente todas las clases de la carpeta app , pero no archivos sueltos que no sean clases). Para ello, debemos ir al archivo composer.json de la ra\u00edz de nuestro proyecto, a la secci\u00f3n autoload y a\u00f1adir una secci\u00f3n files con un array con los archivos que queramos que se carguen tambi\u00e9n: PHP 1 2 3 4 5 \"autoload\": { \"classmap\": [ ... ], \"psr-4\": { ... }, \"files\": [\"app/helpers.php\"] }, Tras efectuar el cambio, debemos decirle a composer que vuelva a compilar el auto cargador. Desde la carpeta del proyecto, ejecutamos este comando: PHP 1 composer dump-autoload","title":"Los helpers"},{"location":"ud07/ud07_Laravel_3_Controladores/#bibliografia","text":"Nacho Iborra Baeza .","title":"bibliografia"},{"location":"ud07/ud07_Laravel_3_Controladores_actividades/","text":"unit: unidad did\u00e1ctica 7 title: Laravel - Controladores (actividades) language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets ejercicios propuestos Ejercicio 1 Ejercicio 2 bibliografia El uso de estos materiales est\u00e1 sujeto a una licencia Creative Commons CC BY-NC . Material extra\u00eddo de https://nachoiborraies.github.io/laravel/ ejercicios propuestos Ejercicio 1 Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Crea un controlador de recursos (opci\u00f3n -r ) llamado PostController , que nos servir\u00e1 para gestionar toda la l\u00f3gica de los posts del blog. Asigna autom\u00e1ticamente con el m\u00e9todo resource cada ruta a su funci\u00f3n correspondiente del controlador, en el archivo routes/web.php . Limita con only las acciones s\u00f3lo a las funciones de listado ( index ), ficha ( show ), creaci\u00f3n ( create ) y edici\u00f3n ( edit ). Utiliza el proveedor de servicios AppServiceProvider para \u201ccastellanizar\u201d las rutas de creaci\u00f3n y edici\u00f3n, como en el ejemplo que hemos visto de libros. Renombra las vistas de listado y ficha de un post a index.blade.php y show.blade.php , dentro de su carpeta posts , y haz que los m\u00e9todos correspondientes del controlador de posts rendericen estas vistas. Para los m\u00e9todos create y edit , simplemente devuelve un texto plano indicando \u201cNuevo post\u201d y \u201cEdici\u00f3n de post\u201d, por ejemplo. Haz los cambios adicionales que sean convenientes (por ejemplo, en el men\u00fa de navegaci\u00f3n) para que los enlaces sigan funcionando, y prueba que las cuatro rutas (listado, ficha, creaci\u00f3n y edici\u00f3n) funcionan adecuadamente. Ejercicio 2 Sobre el proyecto blog anterior, vamos a a\u00f1adir estos cambios: Haz que las funciones de create y edit del controlador de posts, en lugar de mostrar un mensaje de texto plano indicando que ah\u00ed va un formulario, redirijan a la p\u00e1gina de inicio, usando la instrucci\u00f3n redirect . A\u00f1ade un helper al proyecto que defina una funci\u00f3n llamada fechaActual . Recibir\u00e1 como par\u00e1metro un formato de fecha (por ejemplo, \u201cd/m/y\u201d) y sacar\u00e1 la fecha actual en dicho formato. Util\u00edzalo para mostrar la fecha actual en formato \u201cd/m/Y\u201d en la plantilla base, bajo la barra de navegaci\u00f3n, alineada a la derecha. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_03.zip . bibliografia Material extra\u00eddo de Nacho Iborra Baeza .","title":"ud07 Laravel 3 Controladores actividades"},{"location":"ud07/ud07_Laravel_3_Controladores_actividades/#ejercicios-propuestos","text":"","title":"ejercicios propuestos"},{"location":"ud07/ud07_Laravel_3_Controladores_actividades/#ejercicio-1","text":"Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Crea un controlador de recursos (opci\u00f3n -r ) llamado PostController , que nos servir\u00e1 para gestionar toda la l\u00f3gica de los posts del blog. Asigna autom\u00e1ticamente con el m\u00e9todo resource cada ruta a su funci\u00f3n correspondiente del controlador, en el archivo routes/web.php . Limita con only las acciones s\u00f3lo a las funciones de listado ( index ), ficha ( show ), creaci\u00f3n ( create ) y edici\u00f3n ( edit ). Utiliza el proveedor de servicios AppServiceProvider para \u201ccastellanizar\u201d las rutas de creaci\u00f3n y edici\u00f3n, como en el ejemplo que hemos visto de libros. Renombra las vistas de listado y ficha de un post a index.blade.php y show.blade.php , dentro de su carpeta posts , y haz que los m\u00e9todos correspondientes del controlador de posts rendericen estas vistas. Para los m\u00e9todos create y edit , simplemente devuelve un texto plano indicando \u201cNuevo post\u201d y \u201cEdici\u00f3n de post\u201d, por ejemplo. Haz los cambios adicionales que sean convenientes (por ejemplo, en el men\u00fa de navegaci\u00f3n) para que los enlaces sigan funcionando, y prueba que las cuatro rutas (listado, ficha, creaci\u00f3n y edici\u00f3n) funcionan adecuadamente.","title":"Ejercicio 1"},{"location":"ud07/ud07_Laravel_3_Controladores_actividades/#ejercicio-2","text":"Sobre el proyecto blog anterior, vamos a a\u00f1adir estos cambios: Haz que las funciones de create y edit del controlador de posts, en lugar de mostrar un mensaje de texto plano indicando que ah\u00ed va un formulario, redirijan a la p\u00e1gina de inicio, usando la instrucci\u00f3n redirect . A\u00f1ade un helper al proyecto que defina una funci\u00f3n llamada fechaActual . Recibir\u00e1 como par\u00e1metro un formato de fecha (por ejemplo, \u201cd/m/y\u201d) y sacar\u00e1 la fecha actual en dicho formato. Util\u00edzalo para mostrar la fecha actual en formato \u201cd/m/Y\u201d en la plantilla base, bajo la barra de navegaci\u00f3n, alineada a la derecha. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_03.zip .","title":"Ejercicio 2"},{"location":"ud07/ud07_Laravel_3_Controladores_actividades/#bibliografia","text":"Material extra\u00eddo de Nacho Iborra Baeza .","title":"bibliografia"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/","text":"unit: unidad did\u00e1ctica 7 title: Laravel - modelo de datos language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets acceso a la base de datos Par\u00e1metros de conexi\u00f3n a la base de datos Creaci\u00f3n de la base de datos migraciones Estructura de las migraciones Creaci\u00f3n de migraciones Ejecuci\u00f3n y borrado de migraciones Aplicando las migraciones a nuestro ejemplo modelo de datos Crear el modelo Otras opciones de crear modelos Seguir una nomenclatura uniforme Operaciones sobre el modelo. Primeros pasos con Eloquent Realizar b\u00fasquedas Fichas de objetos individuales Inserciones Modificaciones Borrados relaciones entre modelos 1. Relaciones uno a uno o one to one Guardar datos relacionados Relaciones uno a muchos o one to many Aplicando esta relaci\u00f3n en nuestro ejemplo Acceso eficiente a datos relacionados. Eager loading Relaciones muchos a muchos o many to many M\u00e1s informaci\u00f3n seeders y factories seeders a\u00f1adiendo los seeders a la aplicaci\u00f3n lanzar los seeders factories generar factories y asociarlos a su modelo fakers relacionando los modelos query builder y uso de fechas query builder consultas actualizaciones uso de fechas bibliografia El uso de estos materiales est\u00e1 sujeto a una licencia Creative Commons CC BY-NC . Material extra\u00eddo de https://nachoiborraies.github.io/laravel/ acceso a la base de datos Una vez vistas dos de las tres patas en que se sustenta el patr\u00f3n MVC (las vistas y los controladores), en esta secci\u00f3n abordaremos la tercera de ellas: el modelo de datos. Con esto, trataremos algunas cuestiones importantes sobre c\u00f3mo gestiona Laravel el acceso a bases de datos, y qu\u00e9 mecanismos ofrece para sincronizar los datos de nuestra aplicaci\u00f3n con los documentos o registros de una base de datos, as\u00ed como para generar autom\u00e1ticamente la estructura de tablas y campos de la base de datos a partir del modelo de la aplicaci\u00f3n. Par\u00e1metros de conexi\u00f3n a la base de datos Una de las primeras cosas que debemos hacer para configurar el acceso a la base de datos en nuestro proyecto es establecer los par\u00e1metros con los que conectar a dicha base de datos: nombre del servidor, usuario, contrase\u00f1a, etc. Estos par\u00e1metros se definen en el archivo .env para cada entorno de despliegue de la aplicaci\u00f3n (recuerda que este archivo no se sube a Git, por lo que cada entorno tendr\u00e1 el suyo). Dentro de este archivo, debemos modificar las siguientes variables de entorno: DB_CONNECTION : tipo de SGBD a usar DB_HOST : direcci\u00f3n o IP del SGBD ( 127.0.0.1 para conexi\u00f3n local) DB_PORT : puerto por el que el SGBD estar\u00e1 escuchando. Por ejemplo, el puerto por defecto para MySQL es 3306 DB_DATABASE : nombre de la base de datos a la que conectar DB_USERNAME : login del usuario para conectar DB_PASSWORD : password del usuario para conectar En cuanto al primer par\u00e1metro ( DB_CONNECTION ), aqu\u00ed tenemos un listado de los sistemas m\u00e1s habituales, junto con sus puertos por defecto que podemos utilizar en DB_PORT : Id SGBD Nombre SGBD Puerto por defecto mysql MySQL/MariaDB 3306 oracle Oracle 1521 pgsql PostgreSQL 5432 sqlsrv SQL Server 1433 sqlite SQLite - Por ejemplo, para nuestro ejemplo de la biblioteca, el archivo .env del proyecto podr\u00eda quedar as\u00ed, suponiendo el usuario y contrase\u00f1a por defecto que se instala con XAMPP (usuario root y password vac\u00edo). PHP 1 2 3 4 5 6 DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=biblioteca DB_USERNAME=root DB_PASSWORD= En el archivo config/database.php existen unos valores por defecto asociados a cada par\u00e1metro de configuraci\u00f3n del archivo .env , de modo que si no se encuentra el par\u00e1metro, se toma el valor por defecto. Por ejemplo, el SGBD seleccionado si no se especifica ninguno es mysql , a juzgar por esta l\u00ednea del archivo database.php : PHP 1 'default' => env('DB_CONNECTION', 'mysql'), Creaci\u00f3n de la base de datos El \u00fanico paso necesario desde fuera de Laravel para acceder a la base de datos ser\u00e1 crearla. El resto de operaciones (creaci\u00f3n de tablas, campos, claves, relaciones, datos, etc) se podr\u00e1n hacer desde el propio Laravel, como iremos viendo m\u00e1s adelante. La base de datos podemos crearla a trav\u00e9s de alg\u00fan administrador que tengamos disponible (por ejemplo, phpMyAdmin para bases de datos MySQL), o bien por l\u00ednea de comandos, conectando con el SGBD en cuesti\u00f3n y creando la base de datos. Para la m\u00e1quina virtual que estamos utilizando, podemos acceder a phpMyAdmin teniendo XAMPP en marcha (tanto el servidor Apache como el de MySQL) y accediendo a la URL http://localhost/phpmyadmin , normalmente. En nuestro caso, tendremos que crear una base de datos llamada \u201cbiblioteca\u201d, tal y como hemos especificado en la propiedad DB_DATABASE del archivo .env . Vamos a la opci\u00f3n Nueva del panel izquierdo y escribimos el nombre de la nueva base de datos en el formulario que aparecer\u00e1. Pulsando el bot\u00f3n de Crear ya aparecer\u00e1 la nueva base de datos en el listado izquierdo. migraciones Las migraciones son un mecanismo de definici\u00f3n de datos ofrecido por Laravel para, a trav\u00e9s de ciertas clases y opciones de configuraci\u00f3n, generar la estructura completa de una base de datos. A su vez, suponen una especie de control de versiones para una base de datos, y permiten crear y modificar el esquema de la misma f\u00e1cilmente. Estructura de las migraciones Por defecto, Laravel trae unas migraciones predefinidas, que se hallan en la carpeta database/migrations . Cada una tiene un nombre de archivo que comienza por la fecha en que se hizo, seguida de una breve descripci\u00f3n de lo que contiene (creaci\u00f3n de la tabla de usuarios, reseteo de contrase\u00f1as\u2026). Puede que algunas de estas migraciones no nos vayan a ser necesarias, con lo que podemos borrarlas directamente, y puede que otras (en especial la creaci\u00f3n de la tabla de usuarios) s\u00ed nos sirva, pero con otros campos, con lo que deberemos editarla, como veremos a continuaci\u00f3n. Si examinamos el contenido de una migraci\u00f3n, todas deben tener dos m\u00e9todos: up : permite agregar tablas, columnas o \u00edndices a la base de datos down : revierte lo hecho por el m\u00e9todo anterior Si observamos el contenido de un m\u00e9todo up de los que vienen predefinidos para crear una tabla, vemos que se utilizan distintos m\u00e9todos para definir los tipos de datos de cada campo de la tabla, como por ejemplo id() para campos que puedan contener enteros autoincrementales, o string() para campos de tipo texto. Adem\u00e1s, existen otros m\u00e9todos modificadores para agregar propiedades adicionales, como por ejemplo unique() para indicar valores \u00fanicos (claves alternativas), o nullable() para indicar que un campo admite nulos. Aqu\u00ed tenemos un ejemplo de m\u00e9todo up : PHP 1 2 3 4 5 6 7 8 9 10 public function up() { Schema::create('usuarios', function(BluePrint $tabla) { $tabla->id(); $tabla->string('nombre'); $tabla->string('email')->unique(); // ... $tabla->timestamps(); }); } Por defecto, como vemos en los ejemplos que se proporcionan, los esquemas se crean con un id autonum\u00e9rico, y unos timestamps para indicar la fecha de creaci\u00f3n y de modificaci\u00f3n de cada registro, y que Laravel gestiona de forma autom\u00e1tica cuando insertamos o actualizamos contenidos, lo cual resulta muy \u00fatil. Sobre esta base, podemos a\u00f1adir o quitar los campos que queramos. Para ver los tipos disponibles para las columnas de la tabla, podemos visitar la documentaci\u00f3n de Laravel sobre migraciones , en concreto buscaremos el subapartado Available Column Types . Conviene tener presente, por ejemplo, que el tipo string que hemos utilizado en el ejemplo anterior tiene una limitaci\u00f3n de 255 caracteres. Para textos m\u00e1s grandes, se puede emplear el tipo text (20.000 caracteres aproximadamente) o longText . Podemos especificar una clave primaria con el m\u00e9todo primary , al que le podemos pasar o bien el nombre del campo clave, o un array de campos clave, en el caso de que \u00e9sta sea compuesta. Por defecto, los campos de tipo id se auto-establecen como claves primarias. PHP 1 $table->primary(['campo1', 'campo2']); Creaci\u00f3n de migraciones Creamos migraciones con el comando: PHP 1 php artisan make:migration nombre_migracion Por ejemplo: PHP 1 php artisan make:migration crear_tabla_prueba Notar que Laravel ya asigna autom\u00e1ticamente la fecha de la migraci\u00f3n, s\u00f3lo debemos especificar el nombre descriptivo de la misma. Adem\u00e1s, si Laravel detecta la palabra create en el nombre de la migraci\u00f3n, finalizada en table , intuye que es para crear una tabla nueva. En cambio, si detecta la palabra to (entre otras), y al final la palabra table , intuye que se va a alterar o modificar una tabla existente. Esto es gracias a la clase TableGuesser incorporada en Laravel, que detecta ciertos patrones en los nombres de migraciones. La diferencia entre la creaci\u00f3n y la modificaci\u00f3n es que en el m\u00e9todo up de la migraci\u00f3n se utilizar\u00e1 Schema::create o Schema::table sobre la tabla en cuesti\u00f3n, respectivamente. En cualquier caso, tambi\u00e9n podemos especificar un par\u00e1metro adicional en el comando de migraci\u00f3n para indicar si queremos crear o modificar una tabla, y de este modo podemos definir el nombre de la migraci\u00f3n en el idioma que queramos, y sin restricciones de patrones. Estas dos migraciones crean una tabla ( pedidos ) y modifican otra ( usuarios ), respectivamente: PHP 1 2 php artisan make:migration crear_tabla_pedidos --create=pedidos php artisan make:migration nuevo_campo_usuario --table=usuarios En el caso de la segunda migraci\u00f3n, si, por ejemplo, queremos a\u00f1adir una columna con el n\u00famero de tel\u00e9fono de los usuarios, puede quedar as\u00ed (tanto el m\u00e9todo up como el down ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 public function up() { Schema::table('usuarios', function(Blueprint $tabla) { $tabla->string('telefono')->nullable(); }); } public function down() { Schema::table('usuarios', function(Blueprint $tabla) { $tabla->dropColumn('telefono'); }); } Si queremos que el campo en cuesti\u00f3n est\u00e9 en un orden concreto, podemos usar el m\u00e9todo after para indicar detr\u00e1s de qu\u00e9 campo queremos ponerlo (en el m\u00e9todo up ): PHP 1 $tabla->string('telefono')->after('email')->nullable(); Ejecuci\u00f3n y borrado de migraciones Para ejecutar las migraciones (el m\u00e9todo up de cada una), lanzamos el siguiente comando desde la carpeta de nuestro proyecto (habiendo creado la base de datos ya previamente, y modificado las credenciales de acceso en el archivo .env ): PHP 1 2 3 php artisan migrate // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate Adicionalmente a las tablas afectadas, se tendr\u00e1 otra tabla migrations en la base de datos con un hist\u00f3rico de las migraciones realizadas. Para cada una, se almacena su id (autonum\u00e9rico), el nombre de la migraci\u00f3n, y el n\u00famero de proceso por lotes en que se hizo (aquellas que compartan el mismo n\u00famero se hicieron a la vez en el mismo lote). De este modo, aquellas que ya se hayan hecho no se volver\u00e1n a realizar. Para deshacer las migraciones realizadas (ejecutar el m\u00e9todo down de las mismas), ejecutamos: PHP 1 2 3 php artisan migrate:rollback // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback Esto eliminar\u00e1 TODAS las migraciones del \u00faltimo lote existente en la tabla migrations . Si no queremos deshacerlo todo, sino retroceder un n\u00famero determinado de migraciones dentro de ese lote, ejecutamos el comando anterior con un par\u00e1metro --step , indicando el n\u00famero de pasos o migraciones a deshacer (en orden cronol\u00f3gico de m\u00e1s reciente a m\u00e1s antigua): PHP 1 2 3 php artisan migrate:rollback --step=2 // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback --step=2 Si volvemos a hacer la migraci\u00f3n, se restablecer\u00e1n las migraciones deshechas de ese lote. Otro comando tambi\u00e9n muy utilizado es migrate:fresh . Lo que hace es eliminar todas las migraciones realizadas y volverlas a lanzar. Es \u00fatil cuando, estando en desarrollo, a\u00f1adimos campos nuevos a alguna tabla y queremos rehacer las tablas completamente. PHP 1 2 3 php artisan migrate:fresh // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:fresh NOTA : el comando migrate:fresh es DESTRUCTIVO, elimina los contenidos de las tablas, y s\u00f3lo debe utilizarse en entornos de desarrollo, no de producci\u00f3n. Aplicando las migraciones a nuestro ejemplo Vamos a poner en pr\u00e1ctica todo lo visto en este apartado sobre nuestro proyecto biblioteca . Anteriormente ya hemos comentado c\u00f3mo modificar el archivo .env del proyecto para darle los par\u00e1metros de conexi\u00f3n correctos a la base de datos, y c\u00f3mo crear la base de datos \u201cbiblioteca\u201d desde phpMyAdmin . Revisa ese apartado para hacer estos pasos, si no los has hecho ya. A continuaci\u00f3n, vamos a eliminar las migraciones que no nos van a ser necesarias de la carpeta database/migrations . En concreto, borramos todas salvo la de creaci\u00f3n de la tabla de usuarios create_users_table . Despu\u00e9s, editamos la migraci\u00f3n para la tabla de usuarios ( create_users_table ), ya que la utilizaremos en sesiones posteriores. Podemos renombrar el archivo a crear_tabla_usuarios . La clase interna en versiones recientes de Laravel no tiene nombre, se crea simplemente un subtipo de Migration : PHP 1 2 3 4 5 6 // ... return new class extends Migration { // ... } NOTA: en versiones anteriores donde s\u00ed tenga nombre, podemos reemplazar el nombre viejo ( CreateUsersTable ) por CrearTablaUsuarios , por ejemplo. La tabla a la que se alude en los m\u00e9todos up y down tambi\u00e9n la renombramos a usuarios , para dejarlo en nuestro idioma (respetando la fecha de creaci\u00f3n en el nombre del archivo), y despu\u00e9s editamos el m\u00e9todo up para dejarlo as\u00ed: PHP 1 2 3 4 5 6 7 8 9 public function up() { Schema::create('usuarios', function(Blueprint $table) { $table->id(); $table->string('login')->unique(); $table->string('password'); $table->timestamps(); }); } Ahora vamos a crear una nueva migraci\u00f3n para definir la estructura de los libros: PHP 1 2 3 php artisan make:migration crear_tabla_libros --create=libros // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:migration crear_tabla_libros --create=libros Editamos despu\u00e9s el contenido de esta migraci\u00f3n, en concreto el m\u00e9todo up para definir estos campos en los libros: PHP 1 2 3 4 5 6 7 8 9 10 public function up() { Schema::create('libros', function(Blueprint $table) { $table->id(); $table->string('titulo'); $table->string('editorial')->nullable(); $table->float('precio'); $table->timestamps(); }); } Cargamos las migraciones con el comando: PHP 1 2 3 php artisan migrate // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate Tras esto, ya deber\u00edamos ver en nuestra base de datos \u201c biblioteca \u201d las dos tablas creadas ( usuarios y libros ), junto con la tabla migrations que crea Laravel para gestionar las migraciones realizadas. NOTA: si, adem\u00e1s de las tablas anteriores, aparece una tabla de personal_access_tokens (\u00e9sta la crea autom\u00e1ticamente el paquete Sanctum ) incorporada por defecto en Laravel. No nos molesta para lo que vamos a hacer durante el curso, pero si quer\u00e9is quitarla, hay que editar el archivo app\\Providers\\AppServiceProvider.php y a\u00f1adir esta l\u00ednea en el m\u00e9todo register (junto con el correspondiente use para la clase Sanctum ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 // ... use Laravel\\Sanctum\\Sanctum; class AppServiceProvider ... { // ... public function register() { Sanctum::ignoreMigrations(); } // ... } Despu\u00e9s, lanzamos php artisan migrate:fresh para ejecutar desde cero las migraciones, y esa tabla habr\u00e1 desaparecido. modelo de datos Ahora que ya tenemos la estructura de tablas creada en la base de datos, vamos a ver qu\u00e9 mecanismos ofrece Laravel para acceder a estos datos de forma sencilla desde la aplicaci\u00f3n. Veremos c\u00f3mo definir el modelo de datos asociado a cada tabla, y c\u00f3mo manipular estos datos empleando el ORM Eloquent, incorporado con Laravel. Crear el modelo La idea es crear una clase por cada tabla que tengamos en nuestra base de datos, para as\u00ed interactuar con la tabla a trav\u00e9s de dicha clase asociada. Para crear esta clase modelo, utilizamos la opci\u00f3n make:model del comando php artisan . Le pasaremos como par\u00e1metro adicional el nombre de la clase a crear. Por ejemplo, para el caso de nuestra biblioteca, podemos crear as\u00ed el modelo Libro : PHP 1 2 3 php artisan make:model Libro // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:model Libro Por convenci\u00f3n, los modelos se crean con un nombre en singular, empezando por may\u00fascula, y se ubican en la carpeta app\\Models . La estructura b\u00e1sica del modelo es algo as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Libro extends Model { } ?> En nuestro caso, vamos tambi\u00e9n a utilizar el modelo de usuario que ya existe en la carpeta app\\Models , aunque lo renombraremos de User a Usuario : PHP 1 2 3 4 5 6 7 8 9 <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Usuario extends Model { // ... NOTA : hasta Laravel 7, los modelos se generaban autom\u00e1ticamente en la carpeta app , y era necesario moverlos manualmente a una subcarpeta si quer\u00edamos estructurar mejor nuestro c\u00f3digo, actualizando tambi\u00e9n el namespace correspondiente. Desde Laravel 8 la ubicaci\u00f3n en la carpeta app\\Models se realiza por defecto. Autom\u00e1ticamente, se asocia este modelo a una tabla con el mismo nombre, pero en plural y en min\u00fascula, por lo que los modelos anteriores estar\u00edan asociados a unas tablas libros y usuarios en la base de datos, respectivamente. En caso de que no queramos que sea as\u00ed, definimos una propiedad $table en la clase con el nombre que queramos que tenga la tabla asociada. Por ejemplo: PHP 1 2 3 4 class Libro extends Model { protected $table = 'mislibros'; } Otras opciones de crear modelos El comando anterior make:model admite unos par\u00e1metros adicionales, de forma que se puede crear a la vez el modelo y la migraci\u00f3n, y m\u00e1s a\u00fan, el modelo, la migraci\u00f3n y el controlador asociado. Veamos algunos ejemplos: PHP 1 2 3 php artisan make:model Pelicula -m // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:model Pelicula -m El comando anterior crea un modelo Pelicula en la carpeta app\\Models y, adem\u00e1s, crea una migraci\u00f3n llamada create_peliculas_table en la carpeta database/migrations , lista para que editemos el m\u00e9todo up y especifiquemos los campos necesarios. Notar que el nombre de la migraci\u00f3n a\u00f1ade una \u201cs\u201d al nombre de la tabla autom\u00e1ticamente, a partir del modelo en singular. PHP 1 2 3 php artisan make:model Pelicula -mc // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:model Pelicula -mc Este otro comando crea lo mismo que el anterior, y adem\u00e1s, un controlador llamado PeliculaController en la carpeta app\\Http\\Controllers . Dicho controlador est\u00e1 vac\u00edo, para que a\u00f1adamos los m\u00e9todos que consideremos. PHP 1 2 3 php artisan make:model Pelicula -mcr // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:model Pelicula -mcr Esta otra opci\u00f3n crea lo mismo que la anterior, pero el controlador PeliculaController es en este caso un controlador de recursos, por lo que tiene ya incorporados el conjunto de m\u00e9todos propios de este tipo de controladores: index , show , etc. Podemos tambi\u00e9n usar la versi\u00f3n extendida de estos par\u00e1metros. Por ejemplo: PHP 1 2 3 php artisan make:model Pelicula --migration --controller --resource // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:model Pelicula --migration --controller --resource En nuestro caso, como hemos ido creando los controladores y migraciones antes que los modelos, no ser\u00eda necesario dar este paso, pero ahora que ya empezamos a ver c\u00f3mo funciona y se interrelaciona todo, puede resultar \u00fatil emplear este comando para crear de golpe todas las partes implicadas (modelo, migraci\u00f3n y controlador) Seguir una nomenclatura uniforme Recuerda que, de sesiones anteriores, hemos comentado la recomendaci\u00f3n/necesidad de seguir una nomenclatura uniforme en los modelos, controladores y vistas. As\u00ed, para el modelo Libro ya tendr\u00edamos su controlador asociado LibroController , y las vistas se definir\u00edan en la subcarpeta resources/views/libros , con los nombres correspondientes a cada m\u00e9todo del controlador (por ejemplo, index.blade.php , o show.blade.php ). Operaciones sobre el modelo. Primeros pasos con Eloquent Eloquent es el ORM incorporado por defecto en Laravel. Un ORM ( Object Relational Mapping ) es una herramienta que permite establecer una relaci\u00f3n entre los registros de una tabla de la base de datos y los objetos de una clase (de PHP en nuestro caso), de forma que los datos de la base de datos se convierten a objetos PHP y viceversa. Adem\u00e1s, Eloquent implementa el patr\u00f3n Active Record , que a\u00f1ade a las clases m\u00e9todos como save , update , delete \u2026 que permiten interactuar con la base de datos para insertar, modificar o borrar registros asociados a objetos, respectivamente. Realizar b\u00fasquedas Una vez creado el modelo, y aunque est\u00e9 vac\u00edo, ya podemos utilizarlo en los controladores para acceder a los datos. Basta con importar la clase correspondiente (con use ), y utilizar los m\u00e9todos que se heredan de Model . Por ejemplo, el m\u00e9todo get permite obtener los registros de la tabla, convertidos a objetos. As\u00ed es como obtendr\u00edamos todos los libros de la tabla desde un controlador: PHP 1 2 3 4 5 6 7 8 9 10 11 12 // ... use App\\Models\\Libro; // ... class LibroController extends Controller { public function index() { $libros = Libro::get(); return view('libros.index', compact('libros')); } } Lo que obtenemos es un array de objetos, por lo que deberemos acceder a sus propiedades como tales. Por ejemplo, si queremos mostrar los t\u00edtulos de los libros en una vista Blade, har\u00edamos algo como esto: PHP 1 2 3 @forelse($libros as $libro) {{ $libro->titulo }} @endforelse Alternativamente, tambi\u00e9n podemos obtener una consulta filtrada , especificando con el m\u00e9todo where la condici\u00f3n que deben cumplir los registros a obtener. Por ejemplo, as\u00ed obtendr\u00edamos los libros cuyo precio sea inferior a 10 euros: PHP 1 $libros = Libro::where('precio', '<', 10)->get(); De este otro modo obtendr\u00edamos libros con precio inferior a 10 euros y superior a 5 euros, de modo que podemos combinar condiciones: PHP 1 2 $libros = Libro::where('precio', '<', 10) ->where('precio', '>', 5)->get(); Sobre estas consultas base podemos aplicar una serie de a\u00f1adidos. Por ejemplo, podemos querer ordenar los libros por t\u00edtulo, para lo que har\u00edamos esto en el controlador: PHP 1 $libros = Libro::orderBy('titulo')->get(); El m\u00e9todo orderBy admite un segundo par\u00e1metro que indica el sentido de la ordenaci\u00f3n. Por defecto es ASC (ascendente), pero tambi\u00e9n puede ser DESC : PHP 1 $libros = Libro::orderBy('titulo', 'DESC')->get(); Paginaciones de resultados Si queremos paginar los resultados obtenidos debemos, por un lado, cuando obtengamos el listado desde el controlador, indicar con paginate cu\u00e1ntos registros queremos por p\u00e1gina: PHP 1 2 3 4 5 public function index() { $libros = Libro::paginate(5); return view('libros.index', compact('libros')); } Despu\u00e9s, en la vista asociada ( libros.index en el ejemplo anterior), podemos emplear el m\u00e9todo links para que muestre los botones de paginaci\u00f3n en el lugar deseado: PHP 1 2 3 4 5 @forelse($libros as $libro) {{ $libro->titulo }} @endforelse {{ $libros->links() }} Si queremos ordenar el listado, podemos emplear orderBy u orderByDesc , pas\u00e1ndole como par\u00e1metro el nombre del campo por el que ordenar, antes de la paginaci\u00f3n. Podemos, incluso, ordenar por m\u00faltiples criterios concatenados: PHP 1 2 3 4 5 6 7 public function index() { $libros = Libro::orderByAsc('titulo') ->orderByAsc('editorial') ->paginate(5); return view('libros.index', compact('libros')); } Paginaciones desde Laravel 8 En la versi\u00f3n 8 de Laravel se ha cambiado el estilo de los botones de paginaci\u00f3n, empleando el del framework Tailwind CSS. Si queremos seguir utilizando los de Bootstrap, debemos a\u00f1adir una de estas l\u00edneas en el m\u00e9todo boot del provider App\\Providers\\AppServiceProvider , dependiendo de la versi\u00f3n de Bootstrap que queramos usar (por defecto se usar\u00e1 la 5 en la versi\u00f3n actual de los apuntes): PHP 1 2 3 4 // Bootstrap 4 Paginator::useBootstrap(); // Bootstrap 5 Paginator::useBootstrapFive(); Adem\u00e1s, debemos incorporar la cl\u00e1usula use para localizar el elemento Paginator : PHP 1 use Illuminate\\Pagination\\Paginator; Fichas de objetos individuales Una operaci\u00f3n bastante habitual es mostrar una ficha de un objeto a partir de un listado, haciendo clic en el t\u00edtulo o alguna parte visible de ese objeto. Por ejemplo, si queremos ver los datos de un libro a partir de un listado con sus t\u00edtulos, podemos hacer algo como esto en la plantilla Blade: PHP 1 2 3 4 5 6 7 @forelse($libros as $libro) <li> <a href=\"{{ route('libros.show', $libro) }}\"> {{ $libro->titulo }} </a> </li> @endforelse Vemos que hemos utilizado el m\u00e9todo route para indicar la ruta a seguir, con un segundo par\u00e1metro, que en este caso es el objeto concreto de esa fila. Laravel autom\u00e1ticamente lo reemplazar\u00e1 en el enlace por el identificador de dicho objeto. Por su parte, la ruta asociada a este enlace podr\u00eda ser algo as\u00ed (en el archivo de rutas): PHP 1 Route::get('/libros/{id}', [LibroController::class, 'show']) ->name('libros.show'); Aunque tambi\u00e9n podemos haber definido las rutas como un paquete de recursos, y cada una tendr\u00e1 su m\u00e9todo asociado: PHP 1 Route::resource('libros', LibroController::class); Finalmente, el m\u00e9todo show del controlador asociado se encargar\u00e1 de obtener los datos del libro a partir de su id , y generar la vista correspondiente. Para obtener los datos de un objeto a partir de su identificador, podemos emplear el m\u00e9todo find del modelo, pas\u00e1ndole como par\u00e1metro el identificador. As\u00ed, podr\u00edamos generar una vista con los datos como \u00e9sta: PHP 1 2 3 4 5 6 7 8 9 10 11 // ... class LibroController extends Controller { // ... public function show($id) { $libro = Libro::find($id); return view('libros.show', compact('libro')); } } NOTA : si devolvemos ( return ) directamente lo que obtiene el m\u00e9todo find , nos llegar\u00e1 al navegador en formato JSON. De hecho, si devolvemos un array, Laravel lo env\u00eda directamente en formato JSON. Esta caracter\u00edstica la utilizaremos m\u00e1s adelante para definir servicios REST. En el caso de que el objeto no se encuentre (porque, por ejemplo, utilicemos un id equivocado), la vista generada fallar\u00e1. Para evitarlo, en lugar del m\u00e9todo find podemos emplear findOrFail , que, en caso de que no se encuentre el objeto, generar\u00e1 una vista con un error 404, m\u00e1s apropiada. Adem\u00e1s, recuerda que puedes personalizar estas p\u00e1ginas de error definiendo las vistas correspondientes. PHP 1 $libro = Libro::findOrFail($id); En este punto, y a falta de que podamos hacer inserciones m\u00e1s adelante, puedes probar a insertar unos pocos libros de prueba en la base de datos biblioteca desde phpMyAdmin, y probar estas dos rutas que hemos hecho (listado y ficha de libro). Inserciones Las inserciones a trav\u00e9s de Eloquent se pueden realizar creando una instancia del objeto, rellenando sus atributos y llamando al m\u00e9todo save , heredado de la superclase Model . PHP 1 2 3 4 5 $libro = new Libro(); $libro->titulo = \"El juego de Ender\"; $libro->editorial = \"Ediciones B\"; $libro->precio = 8.95; $libro->save(); Como alternativa, tambi\u00e9n se puede utilizar el m\u00e9todo create del modelo, y pasarle todos los datos de la petici\u00f3n, que llegar\u00edan desde un formulario, como veremos m\u00e1s adelante: PHP 1 Libro::create($request->all()); Para que esto \u00faltimo funcione, deben cumplirse dos premisas: Cada campo de la petici\u00f3n debe tener asociado un campo del mismo nombre en el modelo. Debemos definir en el modelo una propiedad llamada $fillable con los nombres de los campos de la petici\u00f3n que nos interesa procesar (el resto se descartan). Esto es obligatorio especificarlo, aunque nos interesen todos los campos, para evitar inserciones masivas malintencionadas (por ejemplo, editando el c\u00f3digo fuente para a\u00f1adir otros campos y modificar datos inesperados). PHP 1 2 3 4 class Libro extends Model { protected $fillable = ['titulo', 'editorial', 'precio']; } Este c\u00f3digo de inserci\u00f3n (o bien campo a campo, o usando el m\u00e9todo all ) se suele poner en el m\u00e9todo store del controlador, para que reciba los datos del formulario de inserci\u00f3n y la haga en la base de datos. Lo terminaremos de ver cuando abordemos el tema de los formularios en Laravel. Modificaciones La modificaci\u00f3n consiste en dos pasos: Encontrar el objeto a modificar (busc\u00e1ndolo por el id con findOrFail , por ejemplo, como se ha explicado antes) Modificar las propiedades que se necesiten, y llamar al m\u00e9todo save del objeto para guardar los cambios. Por ejemplo: PHP 1 2 3 $libroAModificar = Libro::findOrFail($id); $libroAModificar->titulo=\"Otro t\u00edtulo\"; $libroAModificar->save(); Tambi\u00e9n podemos utilizar el m\u00e9todo update enlazado con findOrFail , y pasarle como par\u00e1metro todos los datos de la petici\u00f3n, igual que se ha explicado para la inserci\u00f3n, y siempre y cuando hayamos declarado el atributo $fillable en el modelo para indicar qu\u00e9 campos se aceptan: PHP 1 Libro::findOrFail($id)->update($request->all()); Este c\u00f3digo de modificaci\u00f3n se suele poner en el m\u00e9todo update del controlador, para que reciba los datos del formulario de edici\u00f3n y haga la modificaci\u00f3n correspondiente. Lo terminaremos de ver cuando abordemos el tema de los formularios en Laravel. Borrados Para hacer el borrado, tambi\u00e9n buscamos el objeto a borrar con findOrFail , y luego llamamos a su m\u00e9todo delete : PHP 1 Libro::findOrFail($id)->delete(); Esto lo haremos normalmente en el m\u00e9todo destroy del controlador en cuesti\u00f3n. Despu\u00e9s, podemos redirigir o renderizar alguna vista resultado, como el listado de libros general para comprobar que se ha borrado. PHP 1 2 3 4 5 6 public function destroy($id) { Libro::findOrFail($id)->delete(); $libros = Libro::get(); return view('libros.index', compact('libros')); } Sobre el borrado desde las vistas Lo normal es que el borrado se active haciendo clic en alg\u00fan elemento de una vista. Por ejemplo, haciendo clic en un bot\u00f3n o enlace que ponga \u201cBorrar\u201d. Sin embargo, si implementamos esto as\u00ed: PHP 1 2 3 <a href=\"{{ route('libros.destroy', $libro }}\"> Borrar </a> Si queremos borrar el libro con id 3, se generar\u00e1 una ruta http://biblioteca/libros/3 . Lo podemos comprobar pasando el rat\u00f3n por el enlace y viendo la barra inferior de estado del navegador. Esta ruta, sin embargo, nos va a enviar a la ficha del libro 3, no al borrado, ya que estamos enviando una petici\u00f3n GET, y no una de borrado (DELETE). Para evitar esto, la opci\u00f3n de borrado debe hacerse siempre desde un formulario, donde a trav\u00e9s del helper @method indicamos que es una petici\u00f3n de borrado (DELETE). Con lo que el \u201cenlace\u201d para borrar un libro quedar\u00eda as\u00ed: PHP 1 2 3 4 5 <form action=\"{{ route('libros.destroy', $libro) }}\" method=\"POST\"> @method('DELETE') @csrf <button>Borrar</button> </form> NOTA el helper @csrf lo veremos con m\u00e1s detalle al hablar de formularios, pero se a\u00f1ade a los formularios Laravel para evitar ataques de tipo cross-site , es decir, accesos a una URL de nuestra web desde otras webs. Ejercicios : realizar la primera parte de ejercicios. relaciones entre modelos En esta sesi\u00f3n veremos qu\u00e9 tipos de relaciones se pueden establecer entre los modelos de la aplicaci\u00f3n, y c\u00f3mo se reflejan autom\u00e1ticamente en la base de datos. Para ello, Eloquent permite definir relaciones de varios tipos entre tablas. \u00c9stas se definen a trav\u00e9s de los distintos modelos involucrados en la relaci\u00f3n, como veremos a continuaci\u00f3n. 1. Relaciones uno a uno o one to one Supongamos que tenemos dos modelos Usuario y Telefono , de modo que podemos establecer una relaci\u00f3n uno a uno entre ellos: un usuario tiene un tel\u00e9fono, y un tel\u00e9fono pertenece a un usuario. Para reflejar esta relaci\u00f3n en tablas, una de las dos deber\u00eda tener una referencia a la otra. En este caso, podr\u00edamos tener un campo telefono_id en la tabla de usuarios que indique el tel\u00e9fono que pertenece a dicho usuario, o viceversa (un campo usuario_id en la tabla telefonos que indique a qu\u00e9 usuario pertenece un tel\u00e9fono). Conceptualmente es m\u00e1s correcta la primera opci\u00f3n (el usuario tiene el tel\u00e9fono), as\u00ed que seguiremos ese primer ejemplo. Es importante que el campo nuevo en la tabla usuarios se llame telefono_id , como veremos a continuaci\u00f3n. Para indicar que un usuario tiene un tel\u00e9fono , a\u00f1adimos un nuevo m\u00e9todo en el modelo de Usuario , que se llame igual que el modelo con el que queremos conectar ( telefono , en este caso). Dentro, usaremos el m\u00e9todo hasOne del modelo de usuario para indicar que un objeto de este tipo tiene un objeto del otro modelo (tel\u00e9fono): PHP 1 2 3 4 5 6 7 class Usuario extends Model { public function telefono() { return $this->hasOne(Telefono::class); } } Ahora, si queremos obtener el tel\u00e9fono de un usuario, basta con que hagamos esto: PHP 1 $telefono = Usuario::findOrFail($id)->telefono; Hemos empleado una caracter\u00edstica de Eloquent denominada propiedades din\u00e1micas , por la cual podemos referenciar un m\u00e9todo de relaci\u00f3n como si fuera una propiedad (en lugar de usar telefono() , hemos empleado telefono ). La instrucci\u00f3n anterior obtiene el objeto Telefono asociado con el usuario buscado (a trav\u00e9s del $id del tel\u00e9fono). Para que esta asociaci\u00f3n tenga efecto, es preciso que en la tabla usuarios exista un campo telefono_id y que se corresponda con un campo id de la tabla de telefonos , de modo que Eloquent establece la conexi\u00f3n entre una y otra tabla. Deberemos definir una nueva migraci\u00f3n de modificaci\u00f3n sobre la tabla usuarios para a\u00f1adir ese nuevo campo, o refrescar la migraci\u00f3n original con \u00e9l y borrar los contenidos previos. Si queremos utilizar otros campos distintos en una y otra tabla para conectarlas, debemos indicar dos par\u00e1metros m\u00e1s al llamar a hasOne . Por ejemplo, as\u00ed relacionar\u00edamos las dos tablas anteriores, indicando que la clave ajena de usuarios a telefonos es idTelefono , y que la clave primaria de telefonos a la que se referencia es codigo : PHP 1 return $this->hasOne(Telefono::class, 'idTelefono', 'codigo'); Tambi\u00e9n es posible obtener la relaci\u00f3n inversa , es decir, a partir de un tel\u00e9fono, obtener el usuario al que pertenece. Para ello, a\u00f1adimos un m\u00e9todo usuario en el modelo Telefono y empleamos el m\u00e9todo belongsTo para indicar a qu\u00e9 modelo se asocia: PHP 1 2 3 4 5 6 7 class Telefono extends Model { public function usuario() { return $this->belongsTo(Usuario::class); } } Nuevamente, podemos especificar otros nombres de clave pasando par\u00e1metros adicionales a belongsTo , igual que se hace para hasOne . De este modo, si queremos obtener el usuario a partir del tel\u00e9fono, podemos hacerlo as\u00ed: PHP 1 $usuario = Telefono::findOrFail($idTelefono)->usuario(); Guardar datos relacionados Supongamos que queremos guardar un usuario con su tel\u00e9fono asociado. Podemos simplemente guardar el id del tel\u00e9fono como un campo m\u00e1s del usuario: PHP 1 2 3 4 5 6 7 8 // Buscamos el tel\u00e9fono que queremos asociar // (suponiendo que existe previamente) $telefono = Telefono::findOrFail($idTelefono); $usuario = new Usuario(); $usuario->nombre = \"Pepe\"; $usuario->email = \"pepe@gmail.com\"; $usuario->telefono_id = $telefono->id; $usuario->save(); Pero, adem\u00e1s, podemos vincular ambos objetos en la relaci\u00f3n, usando el m\u00e9todo associate , de este modo: PHP 1 2 3 4 5 6 7 8 // Buscamos el tel\u00e9fono que queremos asociar // (suponiendo que existe previamente) $telefono = Telefono::findOrFail($idTelefono); $usuario = new Usuario(); $usuario->nombre = \"Pepe\"; $usuario->email = \"pepe@gmail.com\"; $usuario->telefono()->associate($telefono); $usuario->save(); Relaciones uno a muchos o one to many Para ilustrar esta relaci\u00f3n veamos otro ejemplo: supongamos que tenemos los modelos Autor y Libro , de modo que un autor puede tener varios libros, y un libro est\u00e1 asociado a un autor. La forma de establecer la relaci\u00f3n entre ambos consistir\u00e1 en a\u00f1adir en la tabla de libros una clave ajena al autor al que pertenece. A la hora de plasmar esta relaci\u00f3n en los modelos, se hace de forma similar al caso anterior, s\u00f3lo que en lugar de utilizar el m\u00e9todo hasOne en la clase Autor usar\u00edamos el m\u00e9todo hasMany : PHP 1 2 3 4 5 6 7 class Autor extends Model { public function libros() { return $this->hasMany(Libro::class); } } Igual que ocurr\u00eda antes, se asume que la tabla de libros tiene una clave primaria id , y que la clave ajena correspondiente hacia la tabla de autores es autor_id . De lo contrario, se pueden especificar otros pasando m\u00e1s par\u00e1metros a hasMany . De este modo obtenemos los libros asociados a un autor: PHP 1 $libros = Autor::findOrFail($id)->libros(); Finalmente, tambi\u00e9n podemos establecer la relaci\u00f3n inversa , y recuperar el autor al que pertenece un determinado libro, definiendo un m\u00e9todo en la clase Libro que emplee belongsTo , como en las relaciones uno a uno: PHP 1 2 3 4 5 6 7 class Libro extends Model { public function autor() { return $this->belongsTo(Autor::class); } } Y obtener, por ejemplo, el nombre del autor a partir del libro: PHP 1 $nombreAutor = Libro::findOrFail($id)->autor->nombre; Aplicando esta relaci\u00f3n en nuestro ejemplo Esta relaci\u00f3n la podemos dejar plasmada en nuestro ejemplo de la biblioteca, definiendo un nuevo modelo Autor con su correspondiente migraci\u00f3n, y relacionando los modelos. Para ello, seguiremos estos pasos: Creamos una nueva migraci\u00f3n de modificaci\u00f3n sobre la tabla de libros , para a\u00f1adir un nuevo campo autor_id . PHP 1 php artisan make:migration nuevo_campo_autor_libros --table=libros PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 class NuevoCampoAutorLibros extends Migration { public function up() { Schema::table('libros', function(Blueprint $table) { $table->integer('autor_id'); }); } public function down() { Schema::table('libros', function(Blueprint $table) { $table->dropColumn('autor_id'); }); } } PHP 1 php artisan migrate Creamos de golpe el modelo, la migraci\u00f3n y el controlador de autores (aunque el controlador no lo vamos a utilizar, al menos por el momento). El modelo Autor debe quedar en la carpeta app\\Models , junto con el de usuarios y el de libros. PHP 1 php artisan make:model Autor -mcr NOTA : en este punto, deber\u00e1s renombrar a mano la migraci\u00f3n, ya que el plural que asignar\u00e1 Laravel por defecto ser\u00e1 autors , y no autores . Recuerda cambiar tanto el nombre del fichero de la migraci\u00f3n, como el nombre de la tabla a la que se referencia en los m\u00e9todos up y down . Editamos la migraci\u00f3n para definir los campos que tendr\u00e1 la nueva tabla de autores, en su m\u00e9todo up : un nombre y un a\u00f1o de nacimiento (opcional): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 return new class extends Migration { public function up() { Schema::create('autores', function(Blueprint $table) { $table->id(); $table->string('nombre'); $table->integer('nacimiento')->nullable(); $table->timestamps(); }); } } php artisan migrate A\u00f1adimos en el modelo Autor que la tabla asociada ser\u00e1 autores (de lo contrario, considera que ser\u00e1 autors . Adem\u00e1s, definimos una relaci\u00f3n de uno a muchos con los libros, a\u00f1adiendo el m\u00e9todo siguiente: PHP 1 2 3 4 5 6 7 8 9 10 class Autor extends Model { protected $table = 'autores'; // ... public function libros() { return $this->hasMany(Libro::class); } } Rec\u00edprocamente, a\u00f1adimos al modelo Libro este otro m\u00e9todo, para poder recuperar un autor a partir de uno de sus libros: PHP 1 2 3 4 5 6 7 8 9 class Libro extends Model { // ... public function autor() { return $this->belongsTo(Autor::class); } } Utilizando phpMyAdmin , creamos a mano un par de autores en la tabla de autores, y los relacionamos con algunos de los libros que haya en la tabla de libros, a\u00f1adiendo tambi\u00e9n a mano el id de cada autor en la clave ajena correspondiente de los libros. Por ejemplo: Para probar c\u00f3mo funcionan las relaciones, vamos primero a crear un nuevo libro asociado al autor 1. Definimos una ruta de prueba en el archivo routes/web.php con este c\u00f3digo (deberemos incorporar con use los modelos de Autor y Libro ): PHP 1 2 3 4 5 6 7 8 9 10 11 Route::get('relacionPrueba', function() { $autor = Autor::findOrFail(1); $libro = new Libro(); $libro->titulo = \"Libro de prueba \" . rand(); $libro->editorial = \"Editorial de prueba\"; $libro->precio = 5; $libro->autor()->associate($autor); $libro->save(); return redirect()->route('libros.index'); }); Ahora, modificamos la vista libros/index.blade.php para que, en el listado, utilice las relaciones entre tablas para mostrar el nombre del autor entre par\u00e9ntesis junto al t\u00edtulo de cada libro: PHP 1 2 3 4 5 6 7 @forelse($libros as $libro) <li><a href=\"{{ route('libros.show', $libro) }}\"> {{ $libro->titulo }} ({{ $libro->autor->nombre }}) </a></li> @empty <li>No se encontraron libros</li> @endforelse Podemos probar las dos cosas accediendo respectivamente a estas dos URLs (suponiendo que el servidor est\u00e1 escuchando en localhost por el puerto 8000): HTML 1 2 http://localhost:8000/relacionPrueba http://localhost:8000/libros Acceso eficiente a datos relacionados. Eager loading En el ejemplo anterior, hemos visto c\u00f3mo, dado un libro, podemos obtener el nombre del autor de este modo en una vista Blade: PHP 1 {{ $libro->autor->nombre }} Sin embargo, este c\u00f3digo provoca una nueva consulta en la base de datos para buscar los datos del autor asociado al libro, con lo que, para un listado de 100 libros, estaremos haciendo 100 consultas adicionales para extraer la informaci\u00f3n de los respectivos autores. Para evitar esta sobrecarga, podemos emplear una t\u00e9cnica llamada eager loading (que en espa\u00f1ol podr\u00edamos traducir como carga apresurada o impaciente ). Consiste en emplear el m\u00e9todo with para indicar qu\u00e9 relaci\u00f3n queremos dejar pre-cargada en el resultado. Por ejemplo, si indicamos algo as\u00ed en la funci\u00f3n index del controlador de libros: PHP 1 2 3 4 5 public function index() { $libros = Libro::with('autor')->get(); return view('libros.index', compact('libros')); } Relaciones muchos a muchos o many to many Estas relaciones son m\u00e1s dif\u00edciles de plasmar, ya que es necesario contar con una tercera tabla que relacione las dos tablas afectadas. Pero vayamos por partes\u2026 Para ilustrar este caso, supongamos los modelos Usuario y Rol , de modo que un usuario puede tener varios roles, y un rol puede ser asignado a varios usuarios. Nuevamente, definimos un m\u00e9todo en el modelo Usuario que utilice el m\u00e9todo belongsToMany para indicar con qu\u00e9 otro modelo se relaciona: PHP 1 2 3 4 5 6 7 class Usuario extends Model { public function roles() { return $this->belongsToMany(Rol::class); } } As\u00ed ya podremos acceder a los roles de un usuario: PHP 1 $roles = Usuario::findOrFail($id)->roles; En este caso, al otro lado de la relaci\u00f3n hacemos lo mismo: definimos un m\u00e9todo en el modelo Rol que indique con belongsToMany que puede pertenecer a varios usuarios: PHP 1 2 3 4 5 6 7 class Rol extends Model { public function usuarios() { return $this->belongsToMany(Usuario::class); } } A efectos de automatizaci\u00f3n, es decir, para que Eloquent establezca los nexos de forma autom\u00e1tica, si queremos establecer una relaci\u00f3n muchos a muchos entre un modelo A y otro B , se asume que existir\u00e1 otra tabla a_b (el orden en que se colocan los nombres de las tablas es alfab\u00e9tico), con los campos a_id y b_id , que relacionen los dos modelos. En nuetro caso, se asumir\u00e1 que existe una tabla rol_usuario con un campo rol_id y otro llamado usuario_id , que enlacen con los correspondientes id de las tablas de usuarios y roles. Si esto no fuera as\u00ed, podemos pasar m\u00e1s par\u00e1metros a belongsToMany para indicarlo. En el caso de las relaciones muchos a muchos, es posible que nos interese acceder a alg\u00fan dato de esa tabla intermedia que los relaciona. En ese caso, hacemos uso del atributo pivot , predefinido, y que apunta a la tabla o modelo intermedio entre los dos relacionados. Por ejemplo, si quisi\u00e9ramos obtener la fecha de creaci\u00f3n de la relaci\u00f3n entre un usuario y un rol, podr\u00edamos hacer esto: PHP 1 2 3 4 5 6 $roles = Usuario::findOrFail($id)->roles; for($roles as $rol) { echo $rol->pivot->created_at; } M\u00e1s informaci\u00f3n Sobre estas relaciones existen algunas variantes, y formas de personalizar las tablas y campos afectados. Se puede consultar m\u00e1s informaci\u00f3n en la documentaci\u00f3n oficial de Eloquent . seeders y factories En las pruebas que hemos hecho hasta ahora, para tener datos con que probar la aplicaci\u00f3n, nos hemos limitado a a\u00f1adirlos a mano desde phpMyAdmin , o bien desde el c\u00f3digo con algunos datos simples como \u201cT\u00edtulo de prueba 1\u201d o cosas similares. Dado que los datos de inicio son necesarios para probar algunas funcionalidades b\u00e1sicas de la aplicaci\u00f3n, como son las b\u00fasquedas y filtrados, y dado que los formularios para dar de alta y gestionar estos datos normalmente no se tienen listos hasta etapas m\u00e1s tard\u00edas, puede resultar conveniente disponer de alg\u00fan mecanismo que genere estos datos de prueba al inicio, sin preocuparnos de tocar la base de datos a mano o alterar el c\u00f3digo de la aplicaci\u00f3n para ello. En este aspecto, los seeders y factories juegan un papel importante. seeders Los seeders son clases especiales que permiten sembrar ( seed ) de contenido una aplicaci\u00f3n. Para crearlos, utilizamos el comando php artisan como sigue: PHP 1 php artisan make:seeder NombreSeeder Esto crear\u00e1 una clase llamada NombreSeeder en la carpeta database/seeds (hasta Laravel 7) o database/seeders (desde Laravel 8). En el m\u00e9todo run de dicha clase podemos crear los elementos que necesitemos a\u00f1adir a la base de datos. Por ejemplo, vamos a crear en nuestro proyecto biblioteca un seeder llamado LibrosSeeder para crear libros, y otro llamado AutoresSeeder para autores: PHP 1 2 php artisan make:seeder LibrosSeeder php artisan make:seeder AutoresSeeder Editamos el m\u00e9todo run del seeder que hemos creado (el de libros, por ejemplo), y definimos este c\u00f3digo para crear un autor con un libro asociado (deberemos incorporar con use los modelos de Autor y Libro previamente): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 public function run() { $autor = new Autor(); $autor->nombre = \"Juan Seeder\"; $autor->nacimiento = 1960; $autor->save(); $libro = new Libro(); $libro->titulo = \"El libro del Seeder\"; $libro->editorial = \"Seeder S.A.\"; $libro->precio = 10; $libro->autor()->associate($autor); $libro->save(); } De forma similar, podr\u00edamos editar el m\u00e9todo run de AutoresSeeder para crear, en este caso, un autor (sin libro asociado, normalmente). PHP 1 2 3 4 5 6 7 public function run() { $autor = new Autor(); $autor->nombre = \"Autor Suelto\"; $autor->nacimiento = 1951; $autor->save(); } a\u00f1adiendo los seeders a la aplicaci\u00f3n Por defecto, los seeders que creamos no forman parte de la aplicaci\u00f3n a\u00fan, en el sentido de que a\u00fan no los podemos ejecutar. Para ello, debemos darlos de alta en el seeder general, llamado DatabaseSeeder , ubicado en la misma carpeta que los seeders que definimos: PHP 1 2 3 4 5 6 7 8 9 class DatabaseSeeder extends Seeder { public function run() { ... $this->call(AutoresSeeder::class); $this->call(LibrosSeeder::class); } } NOTA: es importante el orden en que colocamos los seeders dentro de este m\u00e9todo, como veremos despu\u00e9s, ya que esto indicar\u00e1 en qu\u00e9 orden se crean los datos de prueba en la aplicaci\u00f3n. lanzar los seeders Si queremos ejecutar los seeders para que a\u00f1adan los datos, emplearemos este comando: PHP 1 php artisan db:seed Esto lanzar\u00e1 todos los seeders que tengamos declarados en la clase DatabaseSeeder . Si s\u00f3lo queremos lanzar uno en concreto, podemos hacer lo siguiente: PHP 1 php artisan db:seed --class=LibrosSeeder Tambi\u00e9n puede ser necesario (y a veces conveniente) limpiar la base de datos y llenarla desde cero con los datos de los seeds para empezar a probar la aplicaci\u00f3n. En este caso, el comando es el siguiente: PHP 1 php artisan migrate:fresh --seed factories Los seeders son una herramienta \u00fatil para poblar nuestra aplicaci\u00f3n con datos al inicio. Podemos, por ejemplo, dar de alta una serie de usuarios iniciales con acceso a la aplicaci\u00f3n, para que con ellos se puedan rellenar el resto de datos. Tambi\u00e9n podemos dar de alta una serie de datos predefinidos en ciertas tablas, o datos de prueba que luego poder borrar. Sin embargo, los seeders por s\u00ed solos se quedan algo \u201ccojos\u201d. \u00bfQu\u00e9 tendr\u00edamos que hacer para dar de alta 10 o 20 libros en nuestra base de datos de biblioteca ? Tendr\u00edamos que definir alg\u00fan tipo de bucle en el seeder , y definir datos diferentes (por ejemplo, con identificadores o contadores aleatorios) para cada libro. Para facilitar esta tarea, podemos echar mano de los factories . Los factories son clases que permiten generar datos por lotes. Se crean con el siguiente comando, almacen\u00e1ndose la clase en la carpeta database/factories : PHP 1 php artisan make:factory NombreFactory --model=NombreModelo generar factories y asociarlos a su modelo Si recordamos, cuando creamos los modelos de Autor y Libro la clase se crea con una cl\u00e1usula use que alude al trait HasFactory . PHP 1 2 3 4 5 6 class Libro extends Model { use HasFactory; ... } Un trait b\u00e1sicamente es un conjunto de m\u00e9todos que se puede emplear por cualquier clase que quiera utilizarlos. De este modo, se amortigua en parte la limitaci\u00f3n de s\u00f3lo poder heredar de una clase, y mediante estos traits podemos incorporar la funcionalidad de otras. En este caso, indicamos que el modelo de Libro puede usar los m\u00e9todos de su factory asociado. Por ejemplo, vamos a crear un factory para generar autores y otro para libros, indicando con el par\u00e1metro --model el modelo asociado a cada factory : PHP 1 2 php artisan make:factory AutorFactory --model=Autor php artisan make:factory LibroFactory --model=Libro Esto generar\u00e1 dos clases donde, en una anotaci\u00f3n @extends se especificar\u00e1 el modelo asociado. Por ejemplo, as\u00ed quedar\u00eda el factory de autores: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 namespace Database\\Factories; use Illuminate\\Database\\Eloquent\\Factories\\Factory; /** * @extends Illuminate\\Database\\Eloquent\\Factories\\Factory<\\App\\Models\\Autor> */ class AutorFactory extends Factory { /** * Define the model's default state. * * @return array<string, mixed> */ public function definition() { return [ // ]; } } En Laravel 8, en lugar de la anotaci\u00f3n @extends , la relaci\u00f3n entre el modelo y el factory se daba a trav\u00e9s de un atributo protegido llamado model . Esta opci\u00f3n sigue estando permitida en Laravel 9: PHP 1 2 3 4 5 6 7 8 9 10 11 12 ... class AutorFactory extends Factory { /** * The name of the factory's corresponding model. * * @var string */ protected $model = Autor::class; ... } En cualquiera de los dos casos, el m\u00e9todo definition es el que se va a ejecutar cuando utilicemos el factory , para generar los datos del modelo asociado. Podemos devolver datos manualmente generados (por ejemplo, Autor 1 , Autor 2 , etc): PHP 1 2 3 4 5 6 7 public function definition() { return [ 'nombre' => \"Autor \" . rand(1, 100), 'nacimiento' => rand(1950, 1990) ]; } Para crear autores usando este factory , lo invocamos desde el seeder correspondiente ( AutoresSeeder , en este caso), en su m\u00e9todo run : PHP 1 2 3 4 5 6 7 8 ... class AutoresSeeder extends Seeder { public function run() { return Autor::factory()->count(5)->create(); } } Notar c\u00f3mo acudimos al factory a trav\u00e9s del modelo, con Autor::factory() , gracias al trait HasFactory . Esto generar\u00e1 5 autores con datos distintos y aleatorios. fakers Estaremos de acuerdo en que generar datos del tipo \u201cAutor 1\u201d, \u201cAutor 2\u201d, etc, no queda demasiado \u201creal\u201d en una aplicaci\u00f3n, por mucho que sean datos de prueba. Por ello, Laravel nos proporciona los fakers para generar datos al azar con una apariencia determinada. As\u00ed, podemos generar nombres reales aleatorios, o direcciones de correo electr\u00f3nico, o frases, o textos largos. Para generar estos datos de prueba, Laravel cuenta con una clase llamada Faker , cuyo objeto est\u00e1 autom\u00e1ticamente incorporado en el factory a trav\u00e9s de la propiedad $this->faker . Internamente dispone de m\u00e9todos para generar datos de distintos tipos.Algunos de los m\u00e1s habituales son: name : genera un nombre de persona. Admite como par\u00e1metro opcional \u201cmale\u201d o \u201cfemale\u201d para generar nombres masculinos o femeninos, respectivamente. sentence : genera una frase corta. Admite como par\u00e1metro opcional un n\u00famero, indicando cu\u00e1ntas palabras generar. word : genera una palabra aleatoria. text : genera un texto largo. phoneNumber : genera un n\u00famero de tel\u00e9fono. email : genera un e-mail aleatorio. randomNumber : genera un n\u00famero aleatorio. Como alternativa, tambi\u00e9n se tiene numberBetween , que genera un n\u00famero aleatorio entre un m\u00ednimo y un m\u00e1ximo pasados como par\u00e1metro. \u2026 etc ( aqu\u00ed pod\u00e9is consultar m\u00e1s posibilidades al respecto). Adem\u00e1s, tambi\u00e9n tenemos disponible el m\u00e9todo unique() para asegurarnos de que alguno de los campos que generemos no se repita entre registros. Vamos a generar los datos de autores usando este faker en el m\u00e9todo definition de nuestra AutorFactory : PHP 1 2 3 4 5 6 7 public function definition() { return [ 'nombre' => $this->faker->name, 'nacimiento' => $this->faker->numberBetween(1950, 1990) ]; } Como podemos intuir, generamos un nombre al azar (de hombre o mujer) y un a\u00f1o de nacimiento entre 1950 y 1990. Del mismo modo, completamos la informaci\u00f3n del m\u00e9todo definition para el factory de libros ( LibroFactory ): PHP 1 2 3 4 5 6 7 8 public function definition() { return [ 'titulo' => $this->faker->sentence, 'editorial' => $this->faker->sentence(2), 'precio' => $this->faker->randomFloat(2, 5, 20) ]; } relacionando los modelos Finalmente, en los seeder correspondientes, podemos utilizar estos factory para generar N objetos del modelo asociado. Por ejemplo, para el caso de los autores, generamos 5 autores aleatorios: PHP 1 2 3 4 5 6 7 class AutoresSeeder extends Seeder { public function run() { Autor::factory()->count(5)->create(); } } En el caso de los libros, recorremos los autores y, para cada uno, le generamos 2 libros al azar: PHP 1 2 3 4 5 6 7 8 9 10 11 12 class LibrosSeeder extends Seeder { public function run() { $autores = Autor::all(); $autores->each(function($autor) { Libro::factory()->count(2)->create([ 'autor_id' => $autor->id ]); }); } } Recordemos ahora algo que hemos comentado antes en este mismo documento: es IMPORTANTE el orden en que se declaran los seeders en la clase DatabaseSeeder : si primero colocamos el de libros y luego el de autores, a\u00fan no habr\u00e1 autores con los que generar los libros. Por eso es importante generar primero los autores y as\u00ed, usarlos para recorrerlos y generar los libros. query builder y uso de fechas En este documento veremos un par de cuestiones secundarias que nos han quedado en el tintero. La primera es una forma alternativa de \u201catacar\u201d la base de datos, sin emplear el ORM Eloquent: el query builder . La segunda es c\u00f3mo trabajar c\u00f3modamente con fechas en aplicaciones Laravel. query builder A la hora de obtener datos de la base de datos, en lugar de usar modelos de Eloquent, podemos emplear tambi\u00e9n el query builder , una herramienta incorporada con Laravel que permite realizar operaciones sobre la base de datos sin utilizar un modelo de objetos por detr\u00e1s, y con una sintaxis diferente a SQL. consultas Para utilizar estas consultas, utilizamos el elemento DB . Dicho elemento corresponde al espacio de nombres Illuminate\\Support\\Facades\\DB que deberemos incluir. Internamente, tiene un m\u00e9todo table para especificar la tabla sobre la que se quiere consultar. Una vez referenciada, con el m\u00e9todo get obtenemos todos los registros: PHP 1 2 3 use Illuminate\\Support\\Facades\\DB; //... $personas = DB::table('personas')->get(); A pesar de no estar trabajando con clases, lo que obtenemos aqu\u00ed es un array de objetos, no un array asociativo. En el caso de buscar un registro concreto (por su id , por ejemplo), utilizamos el m\u00e9todo where , pas\u00e1ndole como par\u00e1metros el nombre del campo a comparar, y el valor que debe tener. Despu\u00e9s, enlazamos con el m\u00e9todo first para obtener s\u00f3lo el primer registro de la b\u00fasqueda (de lo contrario, obtendr\u00edamos un array con un resultado, si buscamos por id ): PHP 1 $persona = DB::table('personas')->where('id', $id)->first(); actualizaciones Si lo que queremos hacer es una inserci\u00f3n , empleamos el m\u00e9todo insert de la tabla. En este caso, le pasamos un array asociativo con los nombres de cada campo del nuevo registro, y sus valores: PHP 1 2 3 4 DB::table('personas')->insert([ 'nombre' => 'Juan', 'edad' => 56 ]); En el caso de modificaciones , utilizamos el m\u00e9todo where para filtrar el registro o registros a modificar, y empleamos el m\u00e9todo update con el array de campos a modificar: PHP 1 2 3 4 DB::table('personas')->where('id', $id)->update([ 'nombre' => 'Juan', 'edad' => 56 ]); Para borrados , usamos una estructura similar a la anterior, reemplazando la llamada a update por delete , que no necesita par\u00e1metros: PHP 1 DB::table('personas')->where('id', $id)->delete(); uso de fechas En algunas tablas que hemos visto o creado, se ha usado un tipo timestamp , que b\u00e1sicamente genera un tipo fecha en la tabla correspondiente. Estos campos de tipo tabla son instancias de una librer\u00eda PHP llamada Carbon , muy \u00fatil para trabajar con fechas. As\u00ed que, si tenemos un registro de tipo Persona con un campo created_at de tipo fecha, podemos trabajar con \u00e9l como una fecha Carbon , y, por ejemplo, mostrarla en una vista con un formato espec\u00edfico: PHP 1 2 3 4 <p> Fecha creaci\u00f3n: {{ Carbon\\Carbon::parse($persona->created_at)->format('d/m/Y') }} </p> Adem\u00e1s, para trabajar sobre los campos created_at y updated_at que por defecto se crean en una tabla desde una migraci\u00f3n Laravel, podemos emplear esta librer\u00eda Carbon para darles valor, aunque de esto ya se encarga Eloquent autom\u00e1ticamente, pero por si lo queremos hacer manualmente, aqu\u00ed va un ejemplo: PHP 1 2 3 4 5 6 DB::table('personas')->insert([ 'nombre' => 'Juan', 'edad' => 56, 'created_at' => Carbon::now(), 'updated_at' => Carbon::now() ]); Para poder emplear la clase Carbon , debemos importarla ( use Carbon\\Carbon ), o bien anteponerle siempre el prefijo del namespace Carbon\\Carbon , como en el ejemplo de format anterior. bibliografia Nacho Iborra Baeza .","title":"ud07 Laravel 4 ModeloDeDatos"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#acceso-a-la-base-de-datos","text":"Una vez vistas dos de las tres patas en que se sustenta el patr\u00f3n MVC (las vistas y los controladores), en esta secci\u00f3n abordaremos la tercera de ellas: el modelo de datos. Con esto, trataremos algunas cuestiones importantes sobre c\u00f3mo gestiona Laravel el acceso a bases de datos, y qu\u00e9 mecanismos ofrece para sincronizar los datos de nuestra aplicaci\u00f3n con los documentos o registros de una base de datos, as\u00ed como para generar autom\u00e1ticamente la estructura de tablas y campos de la base de datos a partir del modelo de la aplicaci\u00f3n.","title":"acceso a la base de datos"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#parametros-de-conexion-a-la-base-de-datos","text":"Una de las primeras cosas que debemos hacer para configurar el acceso a la base de datos en nuestro proyecto es establecer los par\u00e1metros con los que conectar a dicha base de datos: nombre del servidor, usuario, contrase\u00f1a, etc. Estos par\u00e1metros se definen en el archivo .env para cada entorno de despliegue de la aplicaci\u00f3n (recuerda que este archivo no se sube a Git, por lo que cada entorno tendr\u00e1 el suyo). Dentro de este archivo, debemos modificar las siguientes variables de entorno: DB_CONNECTION : tipo de SGBD a usar DB_HOST : direcci\u00f3n o IP del SGBD ( 127.0.0.1 para conexi\u00f3n local) DB_PORT : puerto por el que el SGBD estar\u00e1 escuchando. Por ejemplo, el puerto por defecto para MySQL es 3306 DB_DATABASE : nombre de la base de datos a la que conectar DB_USERNAME : login del usuario para conectar DB_PASSWORD : password del usuario para conectar En cuanto al primer par\u00e1metro ( DB_CONNECTION ), aqu\u00ed tenemos un listado de los sistemas m\u00e1s habituales, junto con sus puertos por defecto que podemos utilizar en DB_PORT : Id SGBD Nombre SGBD Puerto por defecto mysql MySQL/MariaDB 3306 oracle Oracle 1521 pgsql PostgreSQL 5432 sqlsrv SQL Server 1433 sqlite SQLite - Por ejemplo, para nuestro ejemplo de la biblioteca, el archivo .env del proyecto podr\u00eda quedar as\u00ed, suponiendo el usuario y contrase\u00f1a por defecto que se instala con XAMPP (usuario root y password vac\u00edo). PHP 1 2 3 4 5 6 DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=biblioteca DB_USERNAME=root DB_PASSWORD= En el archivo config/database.php existen unos valores por defecto asociados a cada par\u00e1metro de configuraci\u00f3n del archivo .env , de modo que si no se encuentra el par\u00e1metro, se toma el valor por defecto. Por ejemplo, el SGBD seleccionado si no se especifica ninguno es mysql , a juzgar por esta l\u00ednea del archivo database.php : PHP 1 'default' => env('DB_CONNECTION', 'mysql'),","title":"Par\u00e1metros de conexi\u00f3n a la base de datos"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#creacion-de-la-base-de-datos","text":"El \u00fanico paso necesario desde fuera de Laravel para acceder a la base de datos ser\u00e1 crearla. El resto de operaciones (creaci\u00f3n de tablas, campos, claves, relaciones, datos, etc) se podr\u00e1n hacer desde el propio Laravel, como iremos viendo m\u00e1s adelante. La base de datos podemos crearla a trav\u00e9s de alg\u00fan administrador que tengamos disponible (por ejemplo, phpMyAdmin para bases de datos MySQL), o bien por l\u00ednea de comandos, conectando con el SGBD en cuesti\u00f3n y creando la base de datos. Para la m\u00e1quina virtual que estamos utilizando, podemos acceder a phpMyAdmin teniendo XAMPP en marcha (tanto el servidor Apache como el de MySQL) y accediendo a la URL http://localhost/phpmyadmin , normalmente. En nuestro caso, tendremos que crear una base de datos llamada \u201cbiblioteca\u201d, tal y como hemos especificado en la propiedad DB_DATABASE del archivo .env . Vamos a la opci\u00f3n Nueva del panel izquierdo y escribimos el nombre de la nueva base de datos en el formulario que aparecer\u00e1. Pulsando el bot\u00f3n de Crear ya aparecer\u00e1 la nueva base de datos en el listado izquierdo.","title":"Creaci\u00f3n de la base de datos"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#migraciones","text":"Las migraciones son un mecanismo de definici\u00f3n de datos ofrecido por Laravel para, a trav\u00e9s de ciertas clases y opciones de configuraci\u00f3n, generar la estructura completa de una base de datos. A su vez, suponen una especie de control de versiones para una base de datos, y permiten crear y modificar el esquema de la misma f\u00e1cilmente.","title":"migraciones"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#estructura-de-las-migraciones","text":"Por defecto, Laravel trae unas migraciones predefinidas, que se hallan en la carpeta database/migrations . Cada una tiene un nombre de archivo que comienza por la fecha en que se hizo, seguida de una breve descripci\u00f3n de lo que contiene (creaci\u00f3n de la tabla de usuarios, reseteo de contrase\u00f1as\u2026). Puede que algunas de estas migraciones no nos vayan a ser necesarias, con lo que podemos borrarlas directamente, y puede que otras (en especial la creaci\u00f3n de la tabla de usuarios) s\u00ed nos sirva, pero con otros campos, con lo que deberemos editarla, como veremos a continuaci\u00f3n. Si examinamos el contenido de una migraci\u00f3n, todas deben tener dos m\u00e9todos: up : permite agregar tablas, columnas o \u00edndices a la base de datos down : revierte lo hecho por el m\u00e9todo anterior Si observamos el contenido de un m\u00e9todo up de los que vienen predefinidos para crear una tabla, vemos que se utilizan distintos m\u00e9todos para definir los tipos de datos de cada campo de la tabla, como por ejemplo id() para campos que puedan contener enteros autoincrementales, o string() para campos de tipo texto. Adem\u00e1s, existen otros m\u00e9todos modificadores para agregar propiedades adicionales, como por ejemplo unique() para indicar valores \u00fanicos (claves alternativas), o nullable() para indicar que un campo admite nulos. Aqu\u00ed tenemos un ejemplo de m\u00e9todo up : PHP 1 2 3 4 5 6 7 8 9 10 public function up() { Schema::create('usuarios', function(BluePrint $tabla) { $tabla->id(); $tabla->string('nombre'); $tabla->string('email')->unique(); // ... $tabla->timestamps(); }); } Por defecto, como vemos en los ejemplos que se proporcionan, los esquemas se crean con un id autonum\u00e9rico, y unos timestamps para indicar la fecha de creaci\u00f3n y de modificaci\u00f3n de cada registro, y que Laravel gestiona de forma autom\u00e1tica cuando insertamos o actualizamos contenidos, lo cual resulta muy \u00fatil. Sobre esta base, podemos a\u00f1adir o quitar los campos que queramos. Para ver los tipos disponibles para las columnas de la tabla, podemos visitar la documentaci\u00f3n de Laravel sobre migraciones , en concreto buscaremos el subapartado Available Column Types . Conviene tener presente, por ejemplo, que el tipo string que hemos utilizado en el ejemplo anterior tiene una limitaci\u00f3n de 255 caracteres. Para textos m\u00e1s grandes, se puede emplear el tipo text (20.000 caracteres aproximadamente) o longText . Podemos especificar una clave primaria con el m\u00e9todo primary , al que le podemos pasar o bien el nombre del campo clave, o un array de campos clave, en el caso de que \u00e9sta sea compuesta. Por defecto, los campos de tipo id se auto-establecen como claves primarias. PHP 1 $table->primary(['campo1', 'campo2']);","title":"Estructura de las migraciones"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#creacion-de-migraciones","text":"Creamos migraciones con el comando: PHP 1 php artisan make:migration nombre_migracion Por ejemplo: PHP 1 php artisan make:migration crear_tabla_prueba Notar que Laravel ya asigna autom\u00e1ticamente la fecha de la migraci\u00f3n, s\u00f3lo debemos especificar el nombre descriptivo de la misma. Adem\u00e1s, si Laravel detecta la palabra create en el nombre de la migraci\u00f3n, finalizada en table , intuye que es para crear una tabla nueva. En cambio, si detecta la palabra to (entre otras), y al final la palabra table , intuye que se va a alterar o modificar una tabla existente. Esto es gracias a la clase TableGuesser incorporada en Laravel, que detecta ciertos patrones en los nombres de migraciones. La diferencia entre la creaci\u00f3n y la modificaci\u00f3n es que en el m\u00e9todo up de la migraci\u00f3n se utilizar\u00e1 Schema::create o Schema::table sobre la tabla en cuesti\u00f3n, respectivamente. En cualquier caso, tambi\u00e9n podemos especificar un par\u00e1metro adicional en el comando de migraci\u00f3n para indicar si queremos crear o modificar una tabla, y de este modo podemos definir el nombre de la migraci\u00f3n en el idioma que queramos, y sin restricciones de patrones. Estas dos migraciones crean una tabla ( pedidos ) y modifican otra ( usuarios ), respectivamente: PHP 1 2 php artisan make:migration crear_tabla_pedidos --create=pedidos php artisan make:migration nuevo_campo_usuario --table=usuarios En el caso de la segunda migraci\u00f3n, si, por ejemplo, queremos a\u00f1adir una columna con el n\u00famero de tel\u00e9fono de los usuarios, puede quedar as\u00ed (tanto el m\u00e9todo up como el down ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 public function up() { Schema::table('usuarios', function(Blueprint $tabla) { $tabla->string('telefono')->nullable(); }); } public function down() { Schema::table('usuarios', function(Blueprint $tabla) { $tabla->dropColumn('telefono'); }); } Si queremos que el campo en cuesti\u00f3n est\u00e9 en un orden concreto, podemos usar el m\u00e9todo after para indicar detr\u00e1s de qu\u00e9 campo queremos ponerlo (en el m\u00e9todo up ): PHP 1 $tabla->string('telefono')->after('email')->nullable();","title":"Creaci\u00f3n de migraciones"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#ejecucion-y-borrado-de-migraciones","text":"Para ejecutar las migraciones (el m\u00e9todo up de cada una), lanzamos el siguiente comando desde la carpeta de nuestro proyecto (habiendo creado la base de datos ya previamente, y modificado las credenciales de acceso en el archivo .env ): PHP 1 2 3 php artisan migrate // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate Adicionalmente a las tablas afectadas, se tendr\u00e1 otra tabla migrations en la base de datos con un hist\u00f3rico de las migraciones realizadas. Para cada una, se almacena su id (autonum\u00e9rico), el nombre de la migraci\u00f3n, y el n\u00famero de proceso por lotes en que se hizo (aquellas que compartan el mismo n\u00famero se hicieron a la vez en el mismo lote). De este modo, aquellas que ya se hayan hecho no se volver\u00e1n a realizar. Para deshacer las migraciones realizadas (ejecutar el m\u00e9todo down de las mismas), ejecutamos: PHP 1 2 3 php artisan migrate:rollback // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback Esto eliminar\u00e1 TODAS las migraciones del \u00faltimo lote existente en la tabla migrations . Si no queremos deshacerlo todo, sino retroceder un n\u00famero determinado de migraciones dentro de ese lote, ejecutamos el comando anterior con un par\u00e1metro --step , indicando el n\u00famero de pasos o migraciones a deshacer (en orden cronol\u00f3gico de m\u00e1s reciente a m\u00e1s antigua): PHP 1 2 3 php artisan migrate:rollback --step=2 // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:rollback --step=2 Si volvemos a hacer la migraci\u00f3n, se restablecer\u00e1n las migraciones deshechas de ese lote. Otro comando tambi\u00e9n muy utilizado es migrate:fresh . Lo que hace es eliminar todas las migraciones realizadas y volverlas a lanzar. Es \u00fatil cuando, estando en desarrollo, a\u00f1adimos campos nuevos a alguna tabla y queremos rehacer las tablas completamente. PHP 1 2 3 php artisan migrate:fresh // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate:fresh NOTA : el comando migrate:fresh es DESTRUCTIVO, elimina los contenidos de las tablas, y s\u00f3lo debe utilizarse en entornos de desarrollo, no de producci\u00f3n.","title":"Ejecuci\u00f3n y borrado de migraciones"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#aplicando-las-migraciones-a-nuestro-ejemplo","text":"Vamos a poner en pr\u00e1ctica todo lo visto en este apartado sobre nuestro proyecto biblioteca . Anteriormente ya hemos comentado c\u00f3mo modificar el archivo .env del proyecto para darle los par\u00e1metros de conexi\u00f3n correctos a la base de datos, y c\u00f3mo crear la base de datos \u201cbiblioteca\u201d desde phpMyAdmin . Revisa ese apartado para hacer estos pasos, si no los has hecho ya. A continuaci\u00f3n, vamos a eliminar las migraciones que no nos van a ser necesarias de la carpeta database/migrations . En concreto, borramos todas salvo la de creaci\u00f3n de la tabla de usuarios create_users_table . Despu\u00e9s, editamos la migraci\u00f3n para la tabla de usuarios ( create_users_table ), ya que la utilizaremos en sesiones posteriores. Podemos renombrar el archivo a crear_tabla_usuarios . La clase interna en versiones recientes de Laravel no tiene nombre, se crea simplemente un subtipo de Migration : PHP 1 2 3 4 5 6 // ... return new class extends Migration { // ... } NOTA: en versiones anteriores donde s\u00ed tenga nombre, podemos reemplazar el nombre viejo ( CreateUsersTable ) por CrearTablaUsuarios , por ejemplo. La tabla a la que se alude en los m\u00e9todos up y down tambi\u00e9n la renombramos a usuarios , para dejarlo en nuestro idioma (respetando la fecha de creaci\u00f3n en el nombre del archivo), y despu\u00e9s editamos el m\u00e9todo up para dejarlo as\u00ed: PHP 1 2 3 4 5 6 7 8 9 public function up() { Schema::create('usuarios', function(Blueprint $table) { $table->id(); $table->string('login')->unique(); $table->string('password'); $table->timestamps(); }); } Ahora vamos a crear una nueva migraci\u00f3n para definir la estructura de los libros: PHP 1 2 3 php artisan make:migration crear_tabla_libros --create=libros // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:migration crear_tabla_libros --create=libros Editamos despu\u00e9s el contenido de esta migraci\u00f3n, en concreto el m\u00e9todo up para definir estos campos en los libros: PHP 1 2 3 4 5 6 7 8 9 10 public function up() { Schema::create('libros', function(Blueprint $table) { $table->id(); $table->string('titulo'); $table->string('editorial')->nullable(); $table->float('precio'); $table->timestamps(); }); } Cargamos las migraciones con el comando: PHP 1 2 3 php artisan migrate // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan migrate Tras esto, ya deber\u00edamos ver en nuestra base de datos \u201c biblioteca \u201d las dos tablas creadas ( usuarios y libros ), junto con la tabla migrations que crea Laravel para gestionar las migraciones realizadas. NOTA: si, adem\u00e1s de las tablas anteriores, aparece una tabla de personal_access_tokens (\u00e9sta la crea autom\u00e1ticamente el paquete Sanctum ) incorporada por defecto en Laravel. No nos molesta para lo que vamos a hacer durante el curso, pero si quer\u00e9is quitarla, hay que editar el archivo app\\Providers\\AppServiceProvider.php y a\u00f1adir esta l\u00ednea en el m\u00e9todo register (junto con el correspondiente use para la clase Sanctum ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 // ... use Laravel\\Sanctum\\Sanctum; class AppServiceProvider ... { // ... public function register() { Sanctum::ignoreMigrations(); } // ... } Despu\u00e9s, lanzamos php artisan migrate:fresh para ejecutar desde cero las migraciones, y esa tabla habr\u00e1 desaparecido.","title":"Aplicando las migraciones a nuestro ejemplo"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#modelo-de-datos","text":"Ahora que ya tenemos la estructura de tablas creada en la base de datos, vamos a ver qu\u00e9 mecanismos ofrece Laravel para acceder a estos datos de forma sencilla desde la aplicaci\u00f3n. Veremos c\u00f3mo definir el modelo de datos asociado a cada tabla, y c\u00f3mo manipular estos datos empleando el ORM Eloquent, incorporado con Laravel.","title":"modelo de datos"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#crear-el-modelo","text":"La idea es crear una clase por cada tabla que tengamos en nuestra base de datos, para as\u00ed interactuar con la tabla a trav\u00e9s de dicha clase asociada. Para crear esta clase modelo, utilizamos la opci\u00f3n make:model del comando php artisan . Le pasaremos como par\u00e1metro adicional el nombre de la clase a crear. Por ejemplo, para el caso de nuestra biblioteca, podemos crear as\u00ed el modelo Libro : PHP 1 2 3 php artisan make:model Libro // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:model Libro Por convenci\u00f3n, los modelos se crean con un nombre en singular, empezando por may\u00fascula, y se ubican en la carpeta app\\Models . La estructura b\u00e1sica del modelo es algo as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Libro extends Model { } ?> En nuestro caso, vamos tambi\u00e9n a utilizar el modelo de usuario que ya existe en la carpeta app\\Models , aunque lo renombraremos de User a Usuario : PHP 1 2 3 4 5 6 7 8 9 <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Usuario extends Model { // ... NOTA : hasta Laravel 7, los modelos se generaban autom\u00e1ticamente en la carpeta app , y era necesario moverlos manualmente a una subcarpeta si quer\u00edamos estructurar mejor nuestro c\u00f3digo, actualizando tambi\u00e9n el namespace correspondiente. Desde Laravel 8 la ubicaci\u00f3n en la carpeta app\\Models se realiza por defecto. Autom\u00e1ticamente, se asocia este modelo a una tabla con el mismo nombre, pero en plural y en min\u00fascula, por lo que los modelos anteriores estar\u00edan asociados a unas tablas libros y usuarios en la base de datos, respectivamente. En caso de que no queramos que sea as\u00ed, definimos una propiedad $table en la clase con el nombre que queramos que tenga la tabla asociada. Por ejemplo: PHP 1 2 3 4 class Libro extends Model { protected $table = 'mislibros'; }","title":"Crear el modelo"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#otras-opciones-de-crear-modelos","text":"El comando anterior make:model admite unos par\u00e1metros adicionales, de forma que se puede crear a la vez el modelo y la migraci\u00f3n, y m\u00e1s a\u00fan, el modelo, la migraci\u00f3n y el controlador asociado. Veamos algunos ejemplos: PHP 1 2 3 php artisan make:model Pelicula -m // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:model Pelicula -m El comando anterior crea un modelo Pelicula en la carpeta app\\Models y, adem\u00e1s, crea una migraci\u00f3n llamada create_peliculas_table en la carpeta database/migrations , lista para que editemos el m\u00e9todo up y especifiquemos los campos necesarios. Notar que el nombre de la migraci\u00f3n a\u00f1ade una \u201cs\u201d al nombre de la tabla autom\u00e1ticamente, a partir del modelo en singular. PHP 1 2 3 php artisan make:model Pelicula -mc // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:model Pelicula -mc Este otro comando crea lo mismo que el anterior, y adem\u00e1s, un controlador llamado PeliculaController en la carpeta app\\Http\\Controllers . Dicho controlador est\u00e1 vac\u00edo, para que a\u00f1adamos los m\u00e9todos que consideremos. PHP 1 2 3 php artisan make:model Pelicula -mcr // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:model Pelicula -mcr Esta otra opci\u00f3n crea lo mismo que la anterior, pero el controlador PeliculaController es en este caso un controlador de recursos, por lo que tiene ya incorporados el conjunto de m\u00e9todos propios de este tipo de controladores: index , show , etc. Podemos tambi\u00e9n usar la versi\u00f3n extendida de estos par\u00e1metros. Por ejemplo: PHP 1 2 3 php artisan make:model Pelicula --migration --controller --resource // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:model Pelicula --migration --controller --resource En nuestro caso, como hemos ido creando los controladores y migraciones antes que los modelos, no ser\u00eda necesario dar este paso, pero ahora que ya empezamos a ver c\u00f3mo funciona y se interrelaciona todo, puede resultar \u00fatil emplear este comando para crear de golpe todas las partes implicadas (modelo, migraci\u00f3n y controlador)","title":"Otras opciones de crear modelos"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#seguir-una-nomenclatura-uniforme","text":"Recuerda que, de sesiones anteriores, hemos comentado la recomendaci\u00f3n/necesidad de seguir una nomenclatura uniforme en los modelos, controladores y vistas. As\u00ed, para el modelo Libro ya tendr\u00edamos su controlador asociado LibroController , y las vistas se definir\u00edan en la subcarpeta resources/views/libros , con los nombres correspondientes a cada m\u00e9todo del controlador (por ejemplo, index.blade.php , o show.blade.php ).","title":"Seguir una nomenclatura uniforme"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#operaciones-sobre-el-modelo-primeros-pasos-con-eloquent","text":"Eloquent es el ORM incorporado por defecto en Laravel. Un ORM ( Object Relational Mapping ) es una herramienta que permite establecer una relaci\u00f3n entre los registros de una tabla de la base de datos y los objetos de una clase (de PHP en nuestro caso), de forma que los datos de la base de datos se convierten a objetos PHP y viceversa. Adem\u00e1s, Eloquent implementa el patr\u00f3n Active Record , que a\u00f1ade a las clases m\u00e9todos como save , update , delete \u2026 que permiten interactuar con la base de datos para insertar, modificar o borrar registros asociados a objetos, respectivamente.","title":"Operaciones sobre el modelo. Primeros pasos con Eloquent"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#realizar-busquedas","text":"Una vez creado el modelo, y aunque est\u00e9 vac\u00edo, ya podemos utilizarlo en los controladores para acceder a los datos. Basta con importar la clase correspondiente (con use ), y utilizar los m\u00e9todos que se heredan de Model . Por ejemplo, el m\u00e9todo get permite obtener los registros de la tabla, convertidos a objetos. As\u00ed es como obtendr\u00edamos todos los libros de la tabla desde un controlador: PHP 1 2 3 4 5 6 7 8 9 10 11 12 // ... use App\\Models\\Libro; // ... class LibroController extends Controller { public function index() { $libros = Libro::get(); return view('libros.index', compact('libros')); } } Lo que obtenemos es un array de objetos, por lo que deberemos acceder a sus propiedades como tales. Por ejemplo, si queremos mostrar los t\u00edtulos de los libros en una vista Blade, har\u00edamos algo como esto: PHP 1 2 3 @forelse($libros as $libro) {{ $libro->titulo }} @endforelse Alternativamente, tambi\u00e9n podemos obtener una consulta filtrada , especificando con el m\u00e9todo where la condici\u00f3n que deben cumplir los registros a obtener. Por ejemplo, as\u00ed obtendr\u00edamos los libros cuyo precio sea inferior a 10 euros: PHP 1 $libros = Libro::where('precio', '<', 10)->get(); De este otro modo obtendr\u00edamos libros con precio inferior a 10 euros y superior a 5 euros, de modo que podemos combinar condiciones: PHP 1 2 $libros = Libro::where('precio', '<', 10) ->where('precio', '>', 5)->get(); Sobre estas consultas base podemos aplicar una serie de a\u00f1adidos. Por ejemplo, podemos querer ordenar los libros por t\u00edtulo, para lo que har\u00edamos esto en el controlador: PHP 1 $libros = Libro::orderBy('titulo')->get(); El m\u00e9todo orderBy admite un segundo par\u00e1metro que indica el sentido de la ordenaci\u00f3n. Por defecto es ASC (ascendente), pero tambi\u00e9n puede ser DESC : PHP 1 $libros = Libro::orderBy('titulo', 'DESC')->get(); Paginaciones de resultados Si queremos paginar los resultados obtenidos debemos, por un lado, cuando obtengamos el listado desde el controlador, indicar con paginate cu\u00e1ntos registros queremos por p\u00e1gina: PHP 1 2 3 4 5 public function index() { $libros = Libro::paginate(5); return view('libros.index', compact('libros')); } Despu\u00e9s, en la vista asociada ( libros.index en el ejemplo anterior), podemos emplear el m\u00e9todo links para que muestre los botones de paginaci\u00f3n en el lugar deseado: PHP 1 2 3 4 5 @forelse($libros as $libro) {{ $libro->titulo }} @endforelse {{ $libros->links() }} Si queremos ordenar el listado, podemos emplear orderBy u orderByDesc , pas\u00e1ndole como par\u00e1metro el nombre del campo por el que ordenar, antes de la paginaci\u00f3n. Podemos, incluso, ordenar por m\u00faltiples criterios concatenados: PHP 1 2 3 4 5 6 7 public function index() { $libros = Libro::orderByAsc('titulo') ->orderByAsc('editorial') ->paginate(5); return view('libros.index', compact('libros')); } Paginaciones desde Laravel 8 En la versi\u00f3n 8 de Laravel se ha cambiado el estilo de los botones de paginaci\u00f3n, empleando el del framework Tailwind CSS. Si queremos seguir utilizando los de Bootstrap, debemos a\u00f1adir una de estas l\u00edneas en el m\u00e9todo boot del provider App\\Providers\\AppServiceProvider , dependiendo de la versi\u00f3n de Bootstrap que queramos usar (por defecto se usar\u00e1 la 5 en la versi\u00f3n actual de los apuntes): PHP 1 2 3 4 // Bootstrap 4 Paginator::useBootstrap(); // Bootstrap 5 Paginator::useBootstrapFive(); Adem\u00e1s, debemos incorporar la cl\u00e1usula use para localizar el elemento Paginator : PHP 1 use Illuminate\\Pagination\\Paginator;","title":"Realizar b\u00fasquedas"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#fichas-de-objetos-individuales","text":"Una operaci\u00f3n bastante habitual es mostrar una ficha de un objeto a partir de un listado, haciendo clic en el t\u00edtulo o alguna parte visible de ese objeto. Por ejemplo, si queremos ver los datos de un libro a partir de un listado con sus t\u00edtulos, podemos hacer algo como esto en la plantilla Blade: PHP 1 2 3 4 5 6 7 @forelse($libros as $libro) <li> <a href=\"{{ route('libros.show', $libro) }}\"> {{ $libro->titulo }} </a> </li> @endforelse Vemos que hemos utilizado el m\u00e9todo route para indicar la ruta a seguir, con un segundo par\u00e1metro, que en este caso es el objeto concreto de esa fila. Laravel autom\u00e1ticamente lo reemplazar\u00e1 en el enlace por el identificador de dicho objeto. Por su parte, la ruta asociada a este enlace podr\u00eda ser algo as\u00ed (en el archivo de rutas): PHP 1 Route::get('/libros/{id}', [LibroController::class, 'show']) ->name('libros.show'); Aunque tambi\u00e9n podemos haber definido las rutas como un paquete de recursos, y cada una tendr\u00e1 su m\u00e9todo asociado: PHP 1 Route::resource('libros', LibroController::class); Finalmente, el m\u00e9todo show del controlador asociado se encargar\u00e1 de obtener los datos del libro a partir de su id , y generar la vista correspondiente. Para obtener los datos de un objeto a partir de su identificador, podemos emplear el m\u00e9todo find del modelo, pas\u00e1ndole como par\u00e1metro el identificador. As\u00ed, podr\u00edamos generar una vista con los datos como \u00e9sta: PHP 1 2 3 4 5 6 7 8 9 10 11 // ... class LibroController extends Controller { // ... public function show($id) { $libro = Libro::find($id); return view('libros.show', compact('libro')); } } NOTA : si devolvemos ( return ) directamente lo que obtiene el m\u00e9todo find , nos llegar\u00e1 al navegador en formato JSON. De hecho, si devolvemos un array, Laravel lo env\u00eda directamente en formato JSON. Esta caracter\u00edstica la utilizaremos m\u00e1s adelante para definir servicios REST. En el caso de que el objeto no se encuentre (porque, por ejemplo, utilicemos un id equivocado), la vista generada fallar\u00e1. Para evitarlo, en lugar del m\u00e9todo find podemos emplear findOrFail , que, en caso de que no se encuentre el objeto, generar\u00e1 una vista con un error 404, m\u00e1s apropiada. Adem\u00e1s, recuerda que puedes personalizar estas p\u00e1ginas de error definiendo las vistas correspondientes. PHP 1 $libro = Libro::findOrFail($id); En este punto, y a falta de que podamos hacer inserciones m\u00e1s adelante, puedes probar a insertar unos pocos libros de prueba en la base de datos biblioteca desde phpMyAdmin, y probar estas dos rutas que hemos hecho (listado y ficha de libro).","title":"Fichas de objetos individuales"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#inserciones","text":"Las inserciones a trav\u00e9s de Eloquent se pueden realizar creando una instancia del objeto, rellenando sus atributos y llamando al m\u00e9todo save , heredado de la superclase Model . PHP 1 2 3 4 5 $libro = new Libro(); $libro->titulo = \"El juego de Ender\"; $libro->editorial = \"Ediciones B\"; $libro->precio = 8.95; $libro->save(); Como alternativa, tambi\u00e9n se puede utilizar el m\u00e9todo create del modelo, y pasarle todos los datos de la petici\u00f3n, que llegar\u00edan desde un formulario, como veremos m\u00e1s adelante: PHP 1 Libro::create($request->all()); Para que esto \u00faltimo funcione, deben cumplirse dos premisas: Cada campo de la petici\u00f3n debe tener asociado un campo del mismo nombre en el modelo. Debemos definir en el modelo una propiedad llamada $fillable con los nombres de los campos de la petici\u00f3n que nos interesa procesar (el resto se descartan). Esto es obligatorio especificarlo, aunque nos interesen todos los campos, para evitar inserciones masivas malintencionadas (por ejemplo, editando el c\u00f3digo fuente para a\u00f1adir otros campos y modificar datos inesperados). PHP 1 2 3 4 class Libro extends Model { protected $fillable = ['titulo', 'editorial', 'precio']; } Este c\u00f3digo de inserci\u00f3n (o bien campo a campo, o usando el m\u00e9todo all ) se suele poner en el m\u00e9todo store del controlador, para que reciba los datos del formulario de inserci\u00f3n y la haga en la base de datos. Lo terminaremos de ver cuando abordemos el tema de los formularios en Laravel.","title":"Inserciones"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#modificaciones","text":"La modificaci\u00f3n consiste en dos pasos: Encontrar el objeto a modificar (busc\u00e1ndolo por el id con findOrFail , por ejemplo, como se ha explicado antes) Modificar las propiedades que se necesiten, y llamar al m\u00e9todo save del objeto para guardar los cambios. Por ejemplo: PHP 1 2 3 $libroAModificar = Libro::findOrFail($id); $libroAModificar->titulo=\"Otro t\u00edtulo\"; $libroAModificar->save(); Tambi\u00e9n podemos utilizar el m\u00e9todo update enlazado con findOrFail , y pasarle como par\u00e1metro todos los datos de la petici\u00f3n, igual que se ha explicado para la inserci\u00f3n, y siempre y cuando hayamos declarado el atributo $fillable en el modelo para indicar qu\u00e9 campos se aceptan: PHP 1 Libro::findOrFail($id)->update($request->all()); Este c\u00f3digo de modificaci\u00f3n se suele poner en el m\u00e9todo update del controlador, para que reciba los datos del formulario de edici\u00f3n y haga la modificaci\u00f3n correspondiente. Lo terminaremos de ver cuando abordemos el tema de los formularios en Laravel.","title":"Modificaciones"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#borrados","text":"Para hacer el borrado, tambi\u00e9n buscamos el objeto a borrar con findOrFail , y luego llamamos a su m\u00e9todo delete : PHP 1 Libro::findOrFail($id)->delete(); Esto lo haremos normalmente en el m\u00e9todo destroy del controlador en cuesti\u00f3n. Despu\u00e9s, podemos redirigir o renderizar alguna vista resultado, como el listado de libros general para comprobar que se ha borrado. PHP 1 2 3 4 5 6 public function destroy($id) { Libro::findOrFail($id)->delete(); $libros = Libro::get(); return view('libros.index', compact('libros')); } Sobre el borrado desde las vistas Lo normal es que el borrado se active haciendo clic en alg\u00fan elemento de una vista. Por ejemplo, haciendo clic en un bot\u00f3n o enlace que ponga \u201cBorrar\u201d. Sin embargo, si implementamos esto as\u00ed: PHP 1 2 3 <a href=\"{{ route('libros.destroy', $libro }}\"> Borrar </a> Si queremos borrar el libro con id 3, se generar\u00e1 una ruta http://biblioteca/libros/3 . Lo podemos comprobar pasando el rat\u00f3n por el enlace y viendo la barra inferior de estado del navegador. Esta ruta, sin embargo, nos va a enviar a la ficha del libro 3, no al borrado, ya que estamos enviando una petici\u00f3n GET, y no una de borrado (DELETE). Para evitar esto, la opci\u00f3n de borrado debe hacerse siempre desde un formulario, donde a trav\u00e9s del helper @method indicamos que es una petici\u00f3n de borrado (DELETE). Con lo que el \u201cenlace\u201d para borrar un libro quedar\u00eda as\u00ed: PHP 1 2 3 4 5 <form action=\"{{ route('libros.destroy', $libro) }}\" method=\"POST\"> @method('DELETE') @csrf <button>Borrar</button> </form> NOTA el helper @csrf lo veremos con m\u00e1s detalle al hablar de formularios, pero se a\u00f1ade a los formularios Laravel para evitar ataques de tipo cross-site , es decir, accesos a una URL de nuestra web desde otras webs. Ejercicios : realizar la primera parte de ejercicios.","title":"Borrados"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#relaciones-entre-modelos","text":"En esta sesi\u00f3n veremos qu\u00e9 tipos de relaciones se pueden establecer entre los modelos de la aplicaci\u00f3n, y c\u00f3mo se reflejan autom\u00e1ticamente en la base de datos. Para ello, Eloquent permite definir relaciones de varios tipos entre tablas. \u00c9stas se definen a trav\u00e9s de los distintos modelos involucrados en la relaci\u00f3n, como veremos a continuaci\u00f3n.","title":"relaciones entre modelos"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#1-relaciones-uno-a-uno-o-one-to-one","text":"Supongamos que tenemos dos modelos Usuario y Telefono , de modo que podemos establecer una relaci\u00f3n uno a uno entre ellos: un usuario tiene un tel\u00e9fono, y un tel\u00e9fono pertenece a un usuario. Para reflejar esta relaci\u00f3n en tablas, una de las dos deber\u00eda tener una referencia a la otra. En este caso, podr\u00edamos tener un campo telefono_id en la tabla de usuarios que indique el tel\u00e9fono que pertenece a dicho usuario, o viceversa (un campo usuario_id en la tabla telefonos que indique a qu\u00e9 usuario pertenece un tel\u00e9fono). Conceptualmente es m\u00e1s correcta la primera opci\u00f3n (el usuario tiene el tel\u00e9fono), as\u00ed que seguiremos ese primer ejemplo. Es importante que el campo nuevo en la tabla usuarios se llame telefono_id , como veremos a continuaci\u00f3n. Para indicar que un usuario tiene un tel\u00e9fono , a\u00f1adimos un nuevo m\u00e9todo en el modelo de Usuario , que se llame igual que el modelo con el que queremos conectar ( telefono , en este caso). Dentro, usaremos el m\u00e9todo hasOne del modelo de usuario para indicar que un objeto de este tipo tiene un objeto del otro modelo (tel\u00e9fono): PHP 1 2 3 4 5 6 7 class Usuario extends Model { public function telefono() { return $this->hasOne(Telefono::class); } } Ahora, si queremos obtener el tel\u00e9fono de un usuario, basta con que hagamos esto: PHP 1 $telefono = Usuario::findOrFail($id)->telefono; Hemos empleado una caracter\u00edstica de Eloquent denominada propiedades din\u00e1micas , por la cual podemos referenciar un m\u00e9todo de relaci\u00f3n como si fuera una propiedad (en lugar de usar telefono() , hemos empleado telefono ). La instrucci\u00f3n anterior obtiene el objeto Telefono asociado con el usuario buscado (a trav\u00e9s del $id del tel\u00e9fono). Para que esta asociaci\u00f3n tenga efecto, es preciso que en la tabla usuarios exista un campo telefono_id y que se corresponda con un campo id de la tabla de telefonos , de modo que Eloquent establece la conexi\u00f3n entre una y otra tabla. Deberemos definir una nueva migraci\u00f3n de modificaci\u00f3n sobre la tabla usuarios para a\u00f1adir ese nuevo campo, o refrescar la migraci\u00f3n original con \u00e9l y borrar los contenidos previos. Si queremos utilizar otros campos distintos en una y otra tabla para conectarlas, debemos indicar dos par\u00e1metros m\u00e1s al llamar a hasOne . Por ejemplo, as\u00ed relacionar\u00edamos las dos tablas anteriores, indicando que la clave ajena de usuarios a telefonos es idTelefono , y que la clave primaria de telefonos a la que se referencia es codigo : PHP 1 return $this->hasOne(Telefono::class, 'idTelefono', 'codigo'); Tambi\u00e9n es posible obtener la relaci\u00f3n inversa , es decir, a partir de un tel\u00e9fono, obtener el usuario al que pertenece. Para ello, a\u00f1adimos un m\u00e9todo usuario en el modelo Telefono y empleamos el m\u00e9todo belongsTo para indicar a qu\u00e9 modelo se asocia: PHP 1 2 3 4 5 6 7 class Telefono extends Model { public function usuario() { return $this->belongsTo(Usuario::class); } } Nuevamente, podemos especificar otros nombres de clave pasando par\u00e1metros adicionales a belongsTo , igual que se hace para hasOne . De este modo, si queremos obtener el usuario a partir del tel\u00e9fono, podemos hacerlo as\u00ed: PHP 1 $usuario = Telefono::findOrFail($idTelefono)->usuario();","title":"1. Relaciones uno a uno o one to one"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#guardar-datos-relacionados","text":"Supongamos que queremos guardar un usuario con su tel\u00e9fono asociado. Podemos simplemente guardar el id del tel\u00e9fono como un campo m\u00e1s del usuario: PHP 1 2 3 4 5 6 7 8 // Buscamos el tel\u00e9fono que queremos asociar // (suponiendo que existe previamente) $telefono = Telefono::findOrFail($idTelefono); $usuario = new Usuario(); $usuario->nombre = \"Pepe\"; $usuario->email = \"pepe@gmail.com\"; $usuario->telefono_id = $telefono->id; $usuario->save(); Pero, adem\u00e1s, podemos vincular ambos objetos en la relaci\u00f3n, usando el m\u00e9todo associate , de este modo: PHP 1 2 3 4 5 6 7 8 // Buscamos el tel\u00e9fono que queremos asociar // (suponiendo que existe previamente) $telefono = Telefono::findOrFail($idTelefono); $usuario = new Usuario(); $usuario->nombre = \"Pepe\"; $usuario->email = \"pepe@gmail.com\"; $usuario->telefono()->associate($telefono); $usuario->save();","title":"Guardar datos relacionados"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#relaciones-uno-a-muchos-o-one-to-many","text":"Para ilustrar esta relaci\u00f3n veamos otro ejemplo: supongamos que tenemos los modelos Autor y Libro , de modo que un autor puede tener varios libros, y un libro est\u00e1 asociado a un autor. La forma de establecer la relaci\u00f3n entre ambos consistir\u00e1 en a\u00f1adir en la tabla de libros una clave ajena al autor al que pertenece. A la hora de plasmar esta relaci\u00f3n en los modelos, se hace de forma similar al caso anterior, s\u00f3lo que en lugar de utilizar el m\u00e9todo hasOne en la clase Autor usar\u00edamos el m\u00e9todo hasMany : PHP 1 2 3 4 5 6 7 class Autor extends Model { public function libros() { return $this->hasMany(Libro::class); } } Igual que ocurr\u00eda antes, se asume que la tabla de libros tiene una clave primaria id , y que la clave ajena correspondiente hacia la tabla de autores es autor_id . De lo contrario, se pueden especificar otros pasando m\u00e1s par\u00e1metros a hasMany . De este modo obtenemos los libros asociados a un autor: PHP 1 $libros = Autor::findOrFail($id)->libros(); Finalmente, tambi\u00e9n podemos establecer la relaci\u00f3n inversa , y recuperar el autor al que pertenece un determinado libro, definiendo un m\u00e9todo en la clase Libro que emplee belongsTo , como en las relaciones uno a uno: PHP 1 2 3 4 5 6 7 class Libro extends Model { public function autor() { return $this->belongsTo(Autor::class); } } Y obtener, por ejemplo, el nombre del autor a partir del libro: PHP 1 $nombreAutor = Libro::findOrFail($id)->autor->nombre;","title":"Relaciones uno a muchos o one to many"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#aplicando-esta-relacion-en-nuestro-ejemplo","text":"Esta relaci\u00f3n la podemos dejar plasmada en nuestro ejemplo de la biblioteca, definiendo un nuevo modelo Autor con su correspondiente migraci\u00f3n, y relacionando los modelos. Para ello, seguiremos estos pasos: Creamos una nueva migraci\u00f3n de modificaci\u00f3n sobre la tabla de libros , para a\u00f1adir un nuevo campo autor_id . PHP 1 php artisan make:migration nuevo_campo_autor_libros --table=libros PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 class NuevoCampoAutorLibros extends Migration { public function up() { Schema::table('libros', function(Blueprint $table) { $table->integer('autor_id'); }); } public function down() { Schema::table('libros', function(Blueprint $table) { $table->dropColumn('autor_id'); }); } } PHP 1 php artisan migrate Creamos de golpe el modelo, la migraci\u00f3n y el controlador de autores (aunque el controlador no lo vamos a utilizar, al menos por el momento). El modelo Autor debe quedar en la carpeta app\\Models , junto con el de usuarios y el de libros. PHP 1 php artisan make:model Autor -mcr NOTA : en este punto, deber\u00e1s renombrar a mano la migraci\u00f3n, ya que el plural que asignar\u00e1 Laravel por defecto ser\u00e1 autors , y no autores . Recuerda cambiar tanto el nombre del fichero de la migraci\u00f3n, como el nombre de la tabla a la que se referencia en los m\u00e9todos up y down . Editamos la migraci\u00f3n para definir los campos que tendr\u00e1 la nueva tabla de autores, en su m\u00e9todo up : un nombre y un a\u00f1o de nacimiento (opcional): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 return new class extends Migration { public function up() { Schema::create('autores', function(Blueprint $table) { $table->id(); $table->string('nombre'); $table->integer('nacimiento')->nullable(); $table->timestamps(); }); } } php artisan migrate A\u00f1adimos en el modelo Autor que la tabla asociada ser\u00e1 autores (de lo contrario, considera que ser\u00e1 autors . Adem\u00e1s, definimos una relaci\u00f3n de uno a muchos con los libros, a\u00f1adiendo el m\u00e9todo siguiente: PHP 1 2 3 4 5 6 7 8 9 10 class Autor extends Model { protected $table = 'autores'; // ... public function libros() { return $this->hasMany(Libro::class); } } Rec\u00edprocamente, a\u00f1adimos al modelo Libro este otro m\u00e9todo, para poder recuperar un autor a partir de uno de sus libros: PHP 1 2 3 4 5 6 7 8 9 class Libro extends Model { // ... public function autor() { return $this->belongsTo(Autor::class); } } Utilizando phpMyAdmin , creamos a mano un par de autores en la tabla de autores, y los relacionamos con algunos de los libros que haya en la tabla de libros, a\u00f1adiendo tambi\u00e9n a mano el id de cada autor en la clave ajena correspondiente de los libros. Por ejemplo: Para probar c\u00f3mo funcionan las relaciones, vamos primero a crear un nuevo libro asociado al autor 1. Definimos una ruta de prueba en el archivo routes/web.php con este c\u00f3digo (deberemos incorporar con use los modelos de Autor y Libro ): PHP 1 2 3 4 5 6 7 8 9 10 11 Route::get('relacionPrueba', function() { $autor = Autor::findOrFail(1); $libro = new Libro(); $libro->titulo = \"Libro de prueba \" . rand(); $libro->editorial = \"Editorial de prueba\"; $libro->precio = 5; $libro->autor()->associate($autor); $libro->save(); return redirect()->route('libros.index'); }); Ahora, modificamos la vista libros/index.blade.php para que, en el listado, utilice las relaciones entre tablas para mostrar el nombre del autor entre par\u00e9ntesis junto al t\u00edtulo de cada libro: PHP 1 2 3 4 5 6 7 @forelse($libros as $libro) <li><a href=\"{{ route('libros.show', $libro) }}\"> {{ $libro->titulo }} ({{ $libro->autor->nombre }}) </a></li> @empty <li>No se encontraron libros</li> @endforelse Podemos probar las dos cosas accediendo respectivamente a estas dos URLs (suponiendo que el servidor est\u00e1 escuchando en localhost por el puerto 8000): HTML 1 2 http://localhost:8000/relacionPrueba http://localhost:8000/libros","title":"Aplicando esta relaci\u00f3n en nuestro ejemplo"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#acceso-eficiente-a-datos-relacionados-eager-loading","text":"En el ejemplo anterior, hemos visto c\u00f3mo, dado un libro, podemos obtener el nombre del autor de este modo en una vista Blade: PHP 1 {{ $libro->autor->nombre }} Sin embargo, este c\u00f3digo provoca una nueva consulta en la base de datos para buscar los datos del autor asociado al libro, con lo que, para un listado de 100 libros, estaremos haciendo 100 consultas adicionales para extraer la informaci\u00f3n de los respectivos autores. Para evitar esta sobrecarga, podemos emplear una t\u00e9cnica llamada eager loading (que en espa\u00f1ol podr\u00edamos traducir como carga apresurada o impaciente ). Consiste en emplear el m\u00e9todo with para indicar qu\u00e9 relaci\u00f3n queremos dejar pre-cargada en el resultado. Por ejemplo, si indicamos algo as\u00ed en la funci\u00f3n index del controlador de libros: PHP 1 2 3 4 5 public function index() { $libros = Libro::with('autor')->get(); return view('libros.index', compact('libros')); }","title":"Acceso eficiente a datos relacionados. Eager loading"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#relaciones-muchos-a-muchos-o-many-to-many","text":"Estas relaciones son m\u00e1s dif\u00edciles de plasmar, ya que es necesario contar con una tercera tabla que relacione las dos tablas afectadas. Pero vayamos por partes\u2026 Para ilustrar este caso, supongamos los modelos Usuario y Rol , de modo que un usuario puede tener varios roles, y un rol puede ser asignado a varios usuarios. Nuevamente, definimos un m\u00e9todo en el modelo Usuario que utilice el m\u00e9todo belongsToMany para indicar con qu\u00e9 otro modelo se relaciona: PHP 1 2 3 4 5 6 7 class Usuario extends Model { public function roles() { return $this->belongsToMany(Rol::class); } } As\u00ed ya podremos acceder a los roles de un usuario: PHP 1 $roles = Usuario::findOrFail($id)->roles; En este caso, al otro lado de la relaci\u00f3n hacemos lo mismo: definimos un m\u00e9todo en el modelo Rol que indique con belongsToMany que puede pertenecer a varios usuarios: PHP 1 2 3 4 5 6 7 class Rol extends Model { public function usuarios() { return $this->belongsToMany(Usuario::class); } } A efectos de automatizaci\u00f3n, es decir, para que Eloquent establezca los nexos de forma autom\u00e1tica, si queremos establecer una relaci\u00f3n muchos a muchos entre un modelo A y otro B , se asume que existir\u00e1 otra tabla a_b (el orden en que se colocan los nombres de las tablas es alfab\u00e9tico), con los campos a_id y b_id , que relacionen los dos modelos. En nuetro caso, se asumir\u00e1 que existe una tabla rol_usuario con un campo rol_id y otro llamado usuario_id , que enlacen con los correspondientes id de las tablas de usuarios y roles. Si esto no fuera as\u00ed, podemos pasar m\u00e1s par\u00e1metros a belongsToMany para indicarlo. En el caso de las relaciones muchos a muchos, es posible que nos interese acceder a alg\u00fan dato de esa tabla intermedia que los relaciona. En ese caso, hacemos uso del atributo pivot , predefinido, y que apunta a la tabla o modelo intermedio entre los dos relacionados. Por ejemplo, si quisi\u00e9ramos obtener la fecha de creaci\u00f3n de la relaci\u00f3n entre un usuario y un rol, podr\u00edamos hacer esto: PHP 1 2 3 4 5 6 $roles = Usuario::findOrFail($id)->roles; for($roles as $rol) { echo $rol->pivot->created_at; }","title":"Relaciones muchos a muchos o many to many"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#mas-informacion","text":"Sobre estas relaciones existen algunas variantes, y formas de personalizar las tablas y campos afectados. Se puede consultar m\u00e1s informaci\u00f3n en la documentaci\u00f3n oficial de Eloquent .","title":"M\u00e1s informaci\u00f3n"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#seeders-y-factories","text":"En las pruebas que hemos hecho hasta ahora, para tener datos con que probar la aplicaci\u00f3n, nos hemos limitado a a\u00f1adirlos a mano desde phpMyAdmin , o bien desde el c\u00f3digo con algunos datos simples como \u201cT\u00edtulo de prueba 1\u201d o cosas similares. Dado que los datos de inicio son necesarios para probar algunas funcionalidades b\u00e1sicas de la aplicaci\u00f3n, como son las b\u00fasquedas y filtrados, y dado que los formularios para dar de alta y gestionar estos datos normalmente no se tienen listos hasta etapas m\u00e1s tard\u00edas, puede resultar conveniente disponer de alg\u00fan mecanismo que genere estos datos de prueba al inicio, sin preocuparnos de tocar la base de datos a mano o alterar el c\u00f3digo de la aplicaci\u00f3n para ello. En este aspecto, los seeders y factories juegan un papel importante.","title":"seeders y factories"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#seeders","text":"Los seeders son clases especiales que permiten sembrar ( seed ) de contenido una aplicaci\u00f3n. Para crearlos, utilizamos el comando php artisan como sigue: PHP 1 php artisan make:seeder NombreSeeder Esto crear\u00e1 una clase llamada NombreSeeder en la carpeta database/seeds (hasta Laravel 7) o database/seeders (desde Laravel 8). En el m\u00e9todo run de dicha clase podemos crear los elementos que necesitemos a\u00f1adir a la base de datos. Por ejemplo, vamos a crear en nuestro proyecto biblioteca un seeder llamado LibrosSeeder para crear libros, y otro llamado AutoresSeeder para autores: PHP 1 2 php artisan make:seeder LibrosSeeder php artisan make:seeder AutoresSeeder Editamos el m\u00e9todo run del seeder que hemos creado (el de libros, por ejemplo), y definimos este c\u00f3digo para crear un autor con un libro asociado (deberemos incorporar con use los modelos de Autor y Libro previamente): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 public function run() { $autor = new Autor(); $autor->nombre = \"Juan Seeder\"; $autor->nacimiento = 1960; $autor->save(); $libro = new Libro(); $libro->titulo = \"El libro del Seeder\"; $libro->editorial = \"Seeder S.A.\"; $libro->precio = 10; $libro->autor()->associate($autor); $libro->save(); } De forma similar, podr\u00edamos editar el m\u00e9todo run de AutoresSeeder para crear, en este caso, un autor (sin libro asociado, normalmente). PHP 1 2 3 4 5 6 7 public function run() { $autor = new Autor(); $autor->nombre = \"Autor Suelto\"; $autor->nacimiento = 1951; $autor->save(); }","title":"seeders"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#anadiendo-los-seeders-a-la-aplicacion","text":"Por defecto, los seeders que creamos no forman parte de la aplicaci\u00f3n a\u00fan, en el sentido de que a\u00fan no los podemos ejecutar. Para ello, debemos darlos de alta en el seeder general, llamado DatabaseSeeder , ubicado en la misma carpeta que los seeders que definimos: PHP 1 2 3 4 5 6 7 8 9 class DatabaseSeeder extends Seeder { public function run() { ... $this->call(AutoresSeeder::class); $this->call(LibrosSeeder::class); } } NOTA: es importante el orden en que colocamos los seeders dentro de este m\u00e9todo, como veremos despu\u00e9s, ya que esto indicar\u00e1 en qu\u00e9 orden se crean los datos de prueba en la aplicaci\u00f3n.","title":"a\u00f1adiendo los seeders a la aplicaci\u00f3n"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#lanzar-los-seeders","text":"Si queremos ejecutar los seeders para que a\u00f1adan los datos, emplearemos este comando: PHP 1 php artisan db:seed Esto lanzar\u00e1 todos los seeders que tengamos declarados en la clase DatabaseSeeder . Si s\u00f3lo queremos lanzar uno en concreto, podemos hacer lo siguiente: PHP 1 php artisan db:seed --class=LibrosSeeder Tambi\u00e9n puede ser necesario (y a veces conveniente) limpiar la base de datos y llenarla desde cero con los datos de los seeds para empezar a probar la aplicaci\u00f3n. En este caso, el comando es el siguiente: PHP 1 php artisan migrate:fresh --seed","title":"lanzar los seeders"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#factories","text":"Los seeders son una herramienta \u00fatil para poblar nuestra aplicaci\u00f3n con datos al inicio. Podemos, por ejemplo, dar de alta una serie de usuarios iniciales con acceso a la aplicaci\u00f3n, para que con ellos se puedan rellenar el resto de datos. Tambi\u00e9n podemos dar de alta una serie de datos predefinidos en ciertas tablas, o datos de prueba que luego poder borrar. Sin embargo, los seeders por s\u00ed solos se quedan algo \u201ccojos\u201d. \u00bfQu\u00e9 tendr\u00edamos que hacer para dar de alta 10 o 20 libros en nuestra base de datos de biblioteca ? Tendr\u00edamos que definir alg\u00fan tipo de bucle en el seeder , y definir datos diferentes (por ejemplo, con identificadores o contadores aleatorios) para cada libro. Para facilitar esta tarea, podemos echar mano de los factories . Los factories son clases que permiten generar datos por lotes. Se crean con el siguiente comando, almacen\u00e1ndose la clase en la carpeta database/factories : PHP 1 php artisan make:factory NombreFactory --model=NombreModelo","title":"factories"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#generar-factories-y-asociarlos-a-su-modelo","text":"Si recordamos, cuando creamos los modelos de Autor y Libro la clase se crea con una cl\u00e1usula use que alude al trait HasFactory . PHP 1 2 3 4 5 6 class Libro extends Model { use HasFactory; ... } Un trait b\u00e1sicamente es un conjunto de m\u00e9todos que se puede emplear por cualquier clase que quiera utilizarlos. De este modo, se amortigua en parte la limitaci\u00f3n de s\u00f3lo poder heredar de una clase, y mediante estos traits podemos incorporar la funcionalidad de otras. En este caso, indicamos que el modelo de Libro puede usar los m\u00e9todos de su factory asociado. Por ejemplo, vamos a crear un factory para generar autores y otro para libros, indicando con el par\u00e1metro --model el modelo asociado a cada factory : PHP 1 2 php artisan make:factory AutorFactory --model=Autor php artisan make:factory LibroFactory --model=Libro Esto generar\u00e1 dos clases donde, en una anotaci\u00f3n @extends se especificar\u00e1 el modelo asociado. Por ejemplo, as\u00ed quedar\u00eda el factory de autores: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 namespace Database\\Factories; use Illuminate\\Database\\Eloquent\\Factories\\Factory; /** * @extends Illuminate\\Database\\Eloquent\\Factories\\Factory<\\App\\Models\\Autor> */ class AutorFactory extends Factory { /** * Define the model's default state. * * @return array<string, mixed> */ public function definition() { return [ // ]; } } En Laravel 8, en lugar de la anotaci\u00f3n @extends , la relaci\u00f3n entre el modelo y el factory se daba a trav\u00e9s de un atributo protegido llamado model . Esta opci\u00f3n sigue estando permitida en Laravel 9: PHP 1 2 3 4 5 6 7 8 9 10 11 12 ... class AutorFactory extends Factory { /** * The name of the factory's corresponding model. * * @var string */ protected $model = Autor::class; ... } En cualquiera de los dos casos, el m\u00e9todo definition es el que se va a ejecutar cuando utilicemos el factory , para generar los datos del modelo asociado. Podemos devolver datos manualmente generados (por ejemplo, Autor 1 , Autor 2 , etc): PHP 1 2 3 4 5 6 7 public function definition() { return [ 'nombre' => \"Autor \" . rand(1, 100), 'nacimiento' => rand(1950, 1990) ]; } Para crear autores usando este factory , lo invocamos desde el seeder correspondiente ( AutoresSeeder , en este caso), en su m\u00e9todo run : PHP 1 2 3 4 5 6 7 8 ... class AutoresSeeder extends Seeder { public function run() { return Autor::factory()->count(5)->create(); } } Notar c\u00f3mo acudimos al factory a trav\u00e9s del modelo, con Autor::factory() , gracias al trait HasFactory . Esto generar\u00e1 5 autores con datos distintos y aleatorios.","title":"generar factories y asociarlos a su modelo"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#fakers","text":"Estaremos de acuerdo en que generar datos del tipo \u201cAutor 1\u201d, \u201cAutor 2\u201d, etc, no queda demasiado \u201creal\u201d en una aplicaci\u00f3n, por mucho que sean datos de prueba. Por ello, Laravel nos proporciona los fakers para generar datos al azar con una apariencia determinada. As\u00ed, podemos generar nombres reales aleatorios, o direcciones de correo electr\u00f3nico, o frases, o textos largos. Para generar estos datos de prueba, Laravel cuenta con una clase llamada Faker , cuyo objeto est\u00e1 autom\u00e1ticamente incorporado en el factory a trav\u00e9s de la propiedad $this->faker . Internamente dispone de m\u00e9todos para generar datos de distintos tipos.Algunos de los m\u00e1s habituales son: name : genera un nombre de persona. Admite como par\u00e1metro opcional \u201cmale\u201d o \u201cfemale\u201d para generar nombres masculinos o femeninos, respectivamente. sentence : genera una frase corta. Admite como par\u00e1metro opcional un n\u00famero, indicando cu\u00e1ntas palabras generar. word : genera una palabra aleatoria. text : genera un texto largo. phoneNumber : genera un n\u00famero de tel\u00e9fono. email : genera un e-mail aleatorio. randomNumber : genera un n\u00famero aleatorio. Como alternativa, tambi\u00e9n se tiene numberBetween , que genera un n\u00famero aleatorio entre un m\u00ednimo y un m\u00e1ximo pasados como par\u00e1metro. \u2026 etc ( aqu\u00ed pod\u00e9is consultar m\u00e1s posibilidades al respecto). Adem\u00e1s, tambi\u00e9n tenemos disponible el m\u00e9todo unique() para asegurarnos de que alguno de los campos que generemos no se repita entre registros. Vamos a generar los datos de autores usando este faker en el m\u00e9todo definition de nuestra AutorFactory : PHP 1 2 3 4 5 6 7 public function definition() { return [ 'nombre' => $this->faker->name, 'nacimiento' => $this->faker->numberBetween(1950, 1990) ]; } Como podemos intuir, generamos un nombre al azar (de hombre o mujer) y un a\u00f1o de nacimiento entre 1950 y 1990. Del mismo modo, completamos la informaci\u00f3n del m\u00e9todo definition para el factory de libros ( LibroFactory ): PHP 1 2 3 4 5 6 7 8 public function definition() { return [ 'titulo' => $this->faker->sentence, 'editorial' => $this->faker->sentence(2), 'precio' => $this->faker->randomFloat(2, 5, 20) ]; }","title":"fakers"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#relacionando-los-modelos","text":"Finalmente, en los seeder correspondientes, podemos utilizar estos factory para generar N objetos del modelo asociado. Por ejemplo, para el caso de los autores, generamos 5 autores aleatorios: PHP 1 2 3 4 5 6 7 class AutoresSeeder extends Seeder { public function run() { Autor::factory()->count(5)->create(); } } En el caso de los libros, recorremos los autores y, para cada uno, le generamos 2 libros al azar: PHP 1 2 3 4 5 6 7 8 9 10 11 12 class LibrosSeeder extends Seeder { public function run() { $autores = Autor::all(); $autores->each(function($autor) { Libro::factory()->count(2)->create([ 'autor_id' => $autor->id ]); }); } } Recordemos ahora algo que hemos comentado antes en este mismo documento: es IMPORTANTE el orden en que se declaran los seeders en la clase DatabaseSeeder : si primero colocamos el de libros y luego el de autores, a\u00fan no habr\u00e1 autores con los que generar los libros. Por eso es importante generar primero los autores y as\u00ed, usarlos para recorrerlos y generar los libros.","title":"relacionando los modelos"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#query-builder-y-uso-de-fechas","text":"En este documento veremos un par de cuestiones secundarias que nos han quedado en el tintero. La primera es una forma alternativa de \u201catacar\u201d la base de datos, sin emplear el ORM Eloquent: el query builder . La segunda es c\u00f3mo trabajar c\u00f3modamente con fechas en aplicaciones Laravel.","title":"query builder y uso de fechas"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#query-builder","text":"A la hora de obtener datos de la base de datos, en lugar de usar modelos de Eloquent, podemos emplear tambi\u00e9n el query builder , una herramienta incorporada con Laravel que permite realizar operaciones sobre la base de datos sin utilizar un modelo de objetos por detr\u00e1s, y con una sintaxis diferente a SQL.","title":"query builder"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#consultas","text":"Para utilizar estas consultas, utilizamos el elemento DB . Dicho elemento corresponde al espacio de nombres Illuminate\\Support\\Facades\\DB que deberemos incluir. Internamente, tiene un m\u00e9todo table para especificar la tabla sobre la que se quiere consultar. Una vez referenciada, con el m\u00e9todo get obtenemos todos los registros: PHP 1 2 3 use Illuminate\\Support\\Facades\\DB; //... $personas = DB::table('personas')->get(); A pesar de no estar trabajando con clases, lo que obtenemos aqu\u00ed es un array de objetos, no un array asociativo. En el caso de buscar un registro concreto (por su id , por ejemplo), utilizamos el m\u00e9todo where , pas\u00e1ndole como par\u00e1metros el nombre del campo a comparar, y el valor que debe tener. Despu\u00e9s, enlazamos con el m\u00e9todo first para obtener s\u00f3lo el primer registro de la b\u00fasqueda (de lo contrario, obtendr\u00edamos un array con un resultado, si buscamos por id ): PHP 1 $persona = DB::table('personas')->where('id', $id)->first();","title":"consultas"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#actualizaciones","text":"Si lo que queremos hacer es una inserci\u00f3n , empleamos el m\u00e9todo insert de la tabla. En este caso, le pasamos un array asociativo con los nombres de cada campo del nuevo registro, y sus valores: PHP 1 2 3 4 DB::table('personas')->insert([ 'nombre' => 'Juan', 'edad' => 56 ]); En el caso de modificaciones , utilizamos el m\u00e9todo where para filtrar el registro o registros a modificar, y empleamos el m\u00e9todo update con el array de campos a modificar: PHP 1 2 3 4 DB::table('personas')->where('id', $id)->update([ 'nombre' => 'Juan', 'edad' => 56 ]); Para borrados , usamos una estructura similar a la anterior, reemplazando la llamada a update por delete , que no necesita par\u00e1metros: PHP 1 DB::table('personas')->where('id', $id)->delete();","title":"actualizaciones"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#uso-de-fechas","text":"En algunas tablas que hemos visto o creado, se ha usado un tipo timestamp , que b\u00e1sicamente genera un tipo fecha en la tabla correspondiente. Estos campos de tipo tabla son instancias de una librer\u00eda PHP llamada Carbon , muy \u00fatil para trabajar con fechas. As\u00ed que, si tenemos un registro de tipo Persona con un campo created_at de tipo fecha, podemos trabajar con \u00e9l como una fecha Carbon , y, por ejemplo, mostrarla en una vista con un formato espec\u00edfico: PHP 1 2 3 4 <p> Fecha creaci\u00f3n: {{ Carbon\\Carbon::parse($persona->created_at)->format('d/m/Y') }} </p> Adem\u00e1s, para trabajar sobre los campos created_at y updated_at que por defecto se crean en una tabla desde una migraci\u00f3n Laravel, podemos emplear esta librer\u00eda Carbon para darles valor, aunque de esto ya se encarga Eloquent autom\u00e1ticamente, pero por si lo queremos hacer manualmente, aqu\u00ed va un ejemplo: PHP 1 2 3 4 5 6 DB::table('personas')->insert([ 'nombre' => 'Juan', 'edad' => 56, 'created_at' => Carbon::now(), 'updated_at' => Carbon::now() ]); Para poder emplear la clase Carbon , debemos importarla ( use Carbon\\Carbon ), o bien anteponerle siempre el prefijo del namespace Carbon\\Carbon , como en el ejemplo de format anterior.","title":"uso de fechas"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos/#bibliografia","text":"Nacho Iborra Baeza .","title":"bibliografia"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos_actividades/","text":"unit: unidad did\u00e1ctica 7 title: Laravel - modelo de datos (actividades) language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets ejercicios propuestos parte I Ejercicio 1 Ejercicio 2 parte II ejercicio 3 ejercicio 4 ejercicio 5 bibliografia El uso de estos materiales est\u00e1 sujeto a una licencia Creative Commons CC BY-NC . Material extra\u00eddo de https://nachoiborraies.github.io/laravel/ ejercicios propuestos parte I Ejercicio 1 Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Crea una base de datos llamada blog en tu servidor de bases de datos a trav\u00e9s de phpMyAdmin . Modifica tambi\u00e9n el archivo .env del proyecto para acceder a dicha base de datos con las credenciales adecuadas, similares a las del ejemplo de la biblioteca (cambiando el nombre de la base de datos). Elimina todas las migraciones existentes, salvo la de create_users_table . Edita esta migraci\u00f3n de la tabla usuarios para dejarla igual que el ejemplo de la biblioteca (\u00fanicamente con los campos login y password , adem\u00e1s del id y los timestamps ). Crea una nueva migraci\u00f3n llamada crear_tabla_posts , que crear\u00e1 una tabla llamada posts con estos campos: Id autonum\u00e9rico T\u00edtulo del post ( string ) Contenido del post ( text ) Timestamps para gestionar autom\u00e1ticamente la fecha de creaci\u00f3n o modificaci\u00f3n del post Lanza las migraciones y comprueba que se crean las tablas correspondientes con los campos asociados en la base de datos. Opcionalmente, puedes desactivar las migraciones de Sanctum en el proyecto Laravel, como se ha explicado al final de este documento , si al crear las migraciones aparece alguna otra tabla no deseada, como la de los personal_access_tokens . Recuerda ejecutar php artisan migrate:fresh de nuevo para borrar el rastro de esas tablas. Ejercicio 2 Continuamos con el proyecto blog anterior. Modifica si no lo has hecho a\u00fan el modelo User que viene por defecto para que se llame Usuario , igual que hemos hecho en el ejemplo de la biblioteca. Crea un nuevo modelo llamado Post para los posts de nuestro blog. Aseg\u00farate de que ambos modelos se ubican en la carpeta App\\Models del proyecto. Despu\u00e9s, modifica los m\u00e9todos del controlador PostController creado en sesiones anteriores, de este modo: El m\u00e9todo index debe obtener todos los posts de la tabla, y mostrar la vista posts.index con ese listado de posts. La vista posts.index , por su parte, recibir\u00e1 el listado de posts y mostrar\u00e1 los t\u00edtulos de cada uno, y un bot\u00f3n Ver para mostrar su ficha ( posts.show ). Debes mostrar el listado de posts ordenado por t\u00edtulo en orden ascendente, y paginado de 5 en 5. El m\u00e9todo show debe obtener el post cuyo id se pasar\u00e1 como par\u00e1metro, y mostrarlo en la vista posts.show . La vista posts.show recibir\u00e1 el objeto con el post a mostrar, y mostraremos el t\u00edtulo, contenido y fecha de creaci\u00f3n del post, con el formato que quieras. El m\u00e9todo destroy eliminar\u00e1 el post cuyo id recibir\u00e1 como par\u00e1metro, y devolver\u00e1 la vista posts.index con el listado actualizado. Para probar este m\u00e9todo, recuerda que debes definir un formulario en una vista (lo puedes hacer para cada post mostrado en la vista posts.index ) que env\u00ede a la ruta posts.destroy usando un m\u00e9todo DELETE , como hemos explicado en un ejemplo anterior. Los m\u00e9todos create , edit , store y update de momento los vamos a dejar sin hacer, hasta que veamos c\u00f3mo gestionar formularios. Para simular la inserci\u00f3n y la modificaci\u00f3n, vamos a crear dos m\u00e9todos adicionales en el controlador, que usaremos de forma temporal: Un m\u00e9todo llamado nuevoPrueba , que cada vez que lo llamemos crear\u00e1 un post con un t\u00edtulo al azar (por ejemplo, \u201cT\u00edtulo X\u201d, siendo X un entero aleatorio), y un contenido al azar (\u201cContenido X\u201d). Puedes emplear la funci\u00f3n rand de PHP para generar estos n\u00fameros aleatorios para t\u00edtulo y contenido. Un m\u00e9todo llamado editarPrueba , que recibir\u00e1 como par\u00e1metro un id y modificar\u00e1 el t\u00edtulo y contenido del post otros generados aleatoriamente, como en el punto anterior. Estos dos m\u00e9todos (especialmente el primero) nos servir\u00e1n para crear una serie de posts de prueba que luego nos servir\u00e1n para probar el listado y la ficha de los posts. En el archivo routes/web.php , recuerda a\u00f1adir dos nuevas rutas temporales de tipo get para probar estas inserciones y modificaciones. La primera puede apuntar a /posts/nuevoPrueba , por ejemplo, y la segunda a /posts/editarPrueba/{id} . Recuerda tambi\u00e9n eliminar o editar la restricci\u00f3n only de las rutas del controlador que estableciste la sesi\u00f3n anterior, para que no s\u00f3lo permita las rutas index , show , create y edit , y adem\u00e1s permita la de destroy (o todas las posibles, si quieres, ya que tarde o temprano las utilizaremos). IMPORTANTE : los m\u00e9todos nuevoPrueba y editarPrueba que has creado en PostController NO son m\u00e9todos est\u00e1ndar de un controlador de recursos, y de ninguna manera estar\u00e1n disponibles a trav\u00e9s de Route::resource en routes/web.php . Por eso debes definir a mano una ruta para cada uno de ellos en ese archivo, a trav\u00e9s de Route::get , y esas rutas deben definirse ANTES de la de recursos ( Route::resource ) porque de lo contrario no se emparejar\u00e1n correctamente. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_04.zip . parte II ejercicio 3 Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Crea una relaci\u00f3n uno a muchos entre el modelo de Usuario y el modelo de Post , ambos ya existentes en la aplicaci\u00f3n, de forma que un post es de un usuario, y un usuario puede tener muchos posts. Deber\u00e1s definir una nueva migraci\u00f3n de modificaci\u00f3n sobre la tabla posts que a\u00f1ada un nuevo campo usuario_id , y establecer a partir de \u00e9l la relaci\u00f3n, como hemos hecho en el ejemplo con autores y libros. Crea desde phpMyAdmin una serie de usuarios de prueba en la tabla usuarios , y asocia algunos de ellos a los posts que haya. Modifica la vista posts/index.blade.php para que, junto al t\u00edtulo de cada post, entre par\u00e9ntesis, aparezca el login del usuario que lo cre\u00f3. ejercicio 4 Continuamos con el proyecto blog anterior. Ahora a\u00f1adiremos lo siguiente: Crea un seeder llamado UsuariosSeeder , con un factory asociado llamado UsuarioFactory (renombra el que viene por defecto UserFactory para aprovecharlo). Crea con esto 3 usuarios de prueba, con logins que sean \u00fanicos y de una sola palabra (usa el faker ), y passwords tambi\u00e9n de una sola palabra, sin encriptar (para poderlos identificar despu\u00e9s, llegado el caso). Crea otro seeder llamado PostsSeeder con un factory asociado llamado PostFactory . En el factory , define con el faker t\u00edtulos aleatorios (frases) y contenidos aleatorios (textos largos). Usa el seeder para crear 3 posts para cada uno de los usuarios existentes. Utiliza la opci\u00f3n php artisan migrate:fresh --seed para borrar todo contenido previo y poblar la base de datos con estos nuevos elementos. Comprueba despu\u00e9s desde la p\u00e1gina del listado de posts, y desde phpMyAdmin , que la informaci\u00f3n que aparece es correcta. ejercicio 5 Opcional A\u00f1ade al proyecto blog un nuevo modelo llamado Comentario , junto con su migraci\u00f3n y controlador asociados. Cada comentario tendr\u00e1 como campo el contenido del comentario, y estar\u00e1 relacionado uno a muchos con el modelo Usuario , de forma que un usuario puede tener muchos comentarios, y cada comentario pertenece a un usuario. Tambi\u00e9n tendr\u00e1 una relaci\u00f3n uno a muchos con el modelo Post , de modo que un comentario pertenece a un post, y un post puede tener muchos comentarios. Por lo tanto, la migraci\u00f3n de los comentarios deber\u00e1 tener como campos adicionales la relaci\u00f3n con el usuario ( usuario_id ) y con el post al que pertenece ( post_id ). Aplica la migraci\u00f3n para reflejar la nueva tabla en la base de datos, y utiliza un seeder y un factory para crear 3 comentarios en cada post, con el usuario que sea. A la hora de aplicar todo esto, borra los contenidos previos de la base de datos ( migrate:fresh --seed ). AYUDA : si quieres elegir un usuario al azar como autor de cada comentario, puedes hacer algo as\u00ed: Text Only 1 Usuario::inRandomOrder()->first(); En este caso, ser\u00eda conveniente que ese usuario aleatorio se a\u00f1ada directamente en el factory del comentario, y no en el seeder , ya que de lo contrario es posible que genere el mismo usuario para todos los comentarios de un post. En la ficha de los posts (vista posts/show.blade.php ), a\u00f1ade el c\u00f3digo necesario para mostrar el login del usuario que ha hecho el post , y el listado de comentarios asociado al post, mostrando para cada uno el login del usuario que lo hizo, y el texto del comentario en s\u00ed. Utiliza tambi\u00e9n la librer\u00eda Carbon para mostrar la fecha de creaci\u00f3n del post (o la de los comentarios, como prefieras) en formato d/m/Y . Aqu\u00ed tienes una captura de pantalla de c\u00f3mo podr\u00eda quedar: \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_07d.zip . bibliografia Nacho Iborra Baeza .","title":"ud07 Laravel 4 ModeloDeDatos actividades"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos_actividades/#ejercicios-propuestos","text":"","title":"ejercicios propuestos"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos_actividades/#parte-i","text":"","title":"parte I"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos_actividades/#ejercicio-1","text":"Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Crea una base de datos llamada blog en tu servidor de bases de datos a trav\u00e9s de phpMyAdmin . Modifica tambi\u00e9n el archivo .env del proyecto para acceder a dicha base de datos con las credenciales adecuadas, similares a las del ejemplo de la biblioteca (cambiando el nombre de la base de datos). Elimina todas las migraciones existentes, salvo la de create_users_table . Edita esta migraci\u00f3n de la tabla usuarios para dejarla igual que el ejemplo de la biblioteca (\u00fanicamente con los campos login y password , adem\u00e1s del id y los timestamps ). Crea una nueva migraci\u00f3n llamada crear_tabla_posts , que crear\u00e1 una tabla llamada posts con estos campos: Id autonum\u00e9rico T\u00edtulo del post ( string ) Contenido del post ( text ) Timestamps para gestionar autom\u00e1ticamente la fecha de creaci\u00f3n o modificaci\u00f3n del post Lanza las migraciones y comprueba que se crean las tablas correspondientes con los campos asociados en la base de datos. Opcionalmente, puedes desactivar las migraciones de Sanctum en el proyecto Laravel, como se ha explicado al final de este documento , si al crear las migraciones aparece alguna otra tabla no deseada, como la de los personal_access_tokens . Recuerda ejecutar php artisan migrate:fresh de nuevo para borrar el rastro de esas tablas.","title":"Ejercicio 1"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos_actividades/#ejercicio-2","text":"Continuamos con el proyecto blog anterior. Modifica si no lo has hecho a\u00fan el modelo User que viene por defecto para que se llame Usuario , igual que hemos hecho en el ejemplo de la biblioteca. Crea un nuevo modelo llamado Post para los posts de nuestro blog. Aseg\u00farate de que ambos modelos se ubican en la carpeta App\\Models del proyecto. Despu\u00e9s, modifica los m\u00e9todos del controlador PostController creado en sesiones anteriores, de este modo: El m\u00e9todo index debe obtener todos los posts de la tabla, y mostrar la vista posts.index con ese listado de posts. La vista posts.index , por su parte, recibir\u00e1 el listado de posts y mostrar\u00e1 los t\u00edtulos de cada uno, y un bot\u00f3n Ver para mostrar su ficha ( posts.show ). Debes mostrar el listado de posts ordenado por t\u00edtulo en orden ascendente, y paginado de 5 en 5. El m\u00e9todo show debe obtener el post cuyo id se pasar\u00e1 como par\u00e1metro, y mostrarlo en la vista posts.show . La vista posts.show recibir\u00e1 el objeto con el post a mostrar, y mostraremos el t\u00edtulo, contenido y fecha de creaci\u00f3n del post, con el formato que quieras. El m\u00e9todo destroy eliminar\u00e1 el post cuyo id recibir\u00e1 como par\u00e1metro, y devolver\u00e1 la vista posts.index con el listado actualizado. Para probar este m\u00e9todo, recuerda que debes definir un formulario en una vista (lo puedes hacer para cada post mostrado en la vista posts.index ) que env\u00ede a la ruta posts.destroy usando un m\u00e9todo DELETE , como hemos explicado en un ejemplo anterior. Los m\u00e9todos create , edit , store y update de momento los vamos a dejar sin hacer, hasta que veamos c\u00f3mo gestionar formularios. Para simular la inserci\u00f3n y la modificaci\u00f3n, vamos a crear dos m\u00e9todos adicionales en el controlador, que usaremos de forma temporal: Un m\u00e9todo llamado nuevoPrueba , que cada vez que lo llamemos crear\u00e1 un post con un t\u00edtulo al azar (por ejemplo, \u201cT\u00edtulo X\u201d, siendo X un entero aleatorio), y un contenido al azar (\u201cContenido X\u201d). Puedes emplear la funci\u00f3n rand de PHP para generar estos n\u00fameros aleatorios para t\u00edtulo y contenido. Un m\u00e9todo llamado editarPrueba , que recibir\u00e1 como par\u00e1metro un id y modificar\u00e1 el t\u00edtulo y contenido del post otros generados aleatoriamente, como en el punto anterior. Estos dos m\u00e9todos (especialmente el primero) nos servir\u00e1n para crear una serie de posts de prueba que luego nos servir\u00e1n para probar el listado y la ficha de los posts. En el archivo routes/web.php , recuerda a\u00f1adir dos nuevas rutas temporales de tipo get para probar estas inserciones y modificaciones. La primera puede apuntar a /posts/nuevoPrueba , por ejemplo, y la segunda a /posts/editarPrueba/{id} . Recuerda tambi\u00e9n eliminar o editar la restricci\u00f3n only de las rutas del controlador que estableciste la sesi\u00f3n anterior, para que no s\u00f3lo permita las rutas index , show , create y edit , y adem\u00e1s permita la de destroy (o todas las posibles, si quieres, ya que tarde o temprano las utilizaremos). IMPORTANTE : los m\u00e9todos nuevoPrueba y editarPrueba que has creado en PostController NO son m\u00e9todos est\u00e1ndar de un controlador de recursos, y de ninguna manera estar\u00e1n disponibles a trav\u00e9s de Route::resource en routes/web.php . Por eso debes definir a mano una ruta para cada uno de ellos en ese archivo, a trav\u00e9s de Route::get , y esas rutas deben definirse ANTES de la de recursos ( Route::resource ) porque de lo contrario no se emparejar\u00e1n correctamente. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_04.zip .","title":"Ejercicio 2"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos_actividades/#parte-ii","text":"","title":"parte II"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos_actividades/#ejercicio-3","text":"Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Crea una relaci\u00f3n uno a muchos entre el modelo de Usuario y el modelo de Post , ambos ya existentes en la aplicaci\u00f3n, de forma que un post es de un usuario, y un usuario puede tener muchos posts. Deber\u00e1s definir una nueva migraci\u00f3n de modificaci\u00f3n sobre la tabla posts que a\u00f1ada un nuevo campo usuario_id , y establecer a partir de \u00e9l la relaci\u00f3n, como hemos hecho en el ejemplo con autores y libros. Crea desde phpMyAdmin una serie de usuarios de prueba en la tabla usuarios , y asocia algunos de ellos a los posts que haya. Modifica la vista posts/index.blade.php para que, junto al t\u00edtulo de cada post, entre par\u00e9ntesis, aparezca el login del usuario que lo cre\u00f3.","title":"ejercicio 3"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos_actividades/#ejercicio-4","text":"Continuamos con el proyecto blog anterior. Ahora a\u00f1adiremos lo siguiente: Crea un seeder llamado UsuariosSeeder , con un factory asociado llamado UsuarioFactory (renombra el que viene por defecto UserFactory para aprovecharlo). Crea con esto 3 usuarios de prueba, con logins que sean \u00fanicos y de una sola palabra (usa el faker ), y passwords tambi\u00e9n de una sola palabra, sin encriptar (para poderlos identificar despu\u00e9s, llegado el caso). Crea otro seeder llamado PostsSeeder con un factory asociado llamado PostFactory . En el factory , define con el faker t\u00edtulos aleatorios (frases) y contenidos aleatorios (textos largos). Usa el seeder para crear 3 posts para cada uno de los usuarios existentes. Utiliza la opci\u00f3n php artisan migrate:fresh --seed para borrar todo contenido previo y poblar la base de datos con estos nuevos elementos. Comprueba despu\u00e9s desde la p\u00e1gina del listado de posts, y desde phpMyAdmin , que la informaci\u00f3n que aparece es correcta.","title":"ejercicio 4"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos_actividades/#ejercicio-5","text":"Opcional A\u00f1ade al proyecto blog un nuevo modelo llamado Comentario , junto con su migraci\u00f3n y controlador asociados. Cada comentario tendr\u00e1 como campo el contenido del comentario, y estar\u00e1 relacionado uno a muchos con el modelo Usuario , de forma que un usuario puede tener muchos comentarios, y cada comentario pertenece a un usuario. Tambi\u00e9n tendr\u00e1 una relaci\u00f3n uno a muchos con el modelo Post , de modo que un comentario pertenece a un post, y un post puede tener muchos comentarios. Por lo tanto, la migraci\u00f3n de los comentarios deber\u00e1 tener como campos adicionales la relaci\u00f3n con el usuario ( usuario_id ) y con el post al que pertenece ( post_id ). Aplica la migraci\u00f3n para reflejar la nueva tabla en la base de datos, y utiliza un seeder y un factory para crear 3 comentarios en cada post, con el usuario que sea. A la hora de aplicar todo esto, borra los contenidos previos de la base de datos ( migrate:fresh --seed ). AYUDA : si quieres elegir un usuario al azar como autor de cada comentario, puedes hacer algo as\u00ed: Text Only 1 Usuario::inRandomOrder()->first(); En este caso, ser\u00eda conveniente que ese usuario aleatorio se a\u00f1ada directamente en el factory del comentario, y no en el seeder , ya que de lo contrario es posible que genere el mismo usuario para todos los comentarios de un post. En la ficha de los posts (vista posts/show.blade.php ), a\u00f1ade el c\u00f3digo necesario para mostrar el login del usuario que ha hecho el post , y el listado de comentarios asociado al post, mostrando para cada uno el login del usuario que lo hizo, y el texto del comentario en s\u00ed. Utiliza tambi\u00e9n la librer\u00eda Carbon para mostrar la fecha de creaci\u00f3n del post (o la de los comentarios, como prefieras) en formato d/m/Y . Aqu\u00ed tienes una captura de pantalla de c\u00f3mo podr\u00eda quedar: \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_07d.zip .","title":"ejercicio 5"},{"location":"ud07/ud07_Laravel_4_ModeloDeDatos_actividades/#bibliografia","text":"Nacho Iborra Baeza .","title":"bibliografia"},{"location":"ud07/ud07_Laravel_anexos/","text":"unit: unidad did\u00e1ctica 7 title: Framework Laravel language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets anexo I - instalaci\u00f3n de Tailwind CSS anexo II - reinstalaci\u00f3n de node referencias anexo I - instalaci\u00f3n de Tailwind CSS Si hemos decidido instalar Tailwind CSS para que nos eche una mano con nuestro css, deberemos de seguir estos pasos: Hay que comprobar la versi\u00f3n de npm y node: Bash 1 2 npm -v node -v Si la versi\u00f3n de nodejs es inferior a la versi\u00f3n 14 (a la hora de crear este documento) antes de seguir habremos de reinstalarlo . Para ello habr\u00e1 que ir al anexo II - reinstalaci\u00f3n de node en este mismo documento. no continuar si la versi\u00f3n de node es inferior a 14 . Si nuestra versi\u00f3n de nodejs es correcta (o hemos procedido a reinstalar node en el punto 2), lo primero ser\u00e1 desinstalar bootstrap: Bash 1 npm uninstall bootstrap Instalaremos en desarrollo estas tres dependencias: Bash 1 npm install -D tailwindcss postcss autoprefixer Generamos ahora el fichero tailwindcss.config.js que aparecer\u00e1 en la ra\u00edz del proyecto: Bash 1 npx tailwindcss init -p Editar el fichero del proyecto Laravel tailwindcss.config.js que se ha generado en el directorio ra\u00edz del proyecto y donde indicaremos d\u00f3nde vamos a utilizarlo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 /** @type {import('tailwindcss').Config} */ export default { content: [ \"./resources/**/*.blade.php\", \"./resources/**/*.js\", \"./resources/**/*.vue\", ], theme: { extend: {}, }, plugins: [], } Ahora, en el fichero /resources/css/ app.css agregar las siguientes l\u00edneas: CSS 1 2 3 @ tailwind base ; @ tailwind components ; @ tailwind utilities ; Desde el terminal (y siempre dentro de nuestro proyecto), vamos a ejecutar: Bash 1 2 3 npm run dev # \u00f3, si no funciona: # npm run dev -- --host En el fichero /resources/views/layouts/ app.blade.php hay que indicarle que va a utilizar el fichero /resources/css/ app.css , para ello hay que a\u00f1adirlo en: Text Only 1 @vite('resources/css/app.css') A partir de ahora, y con este ejemplo, podemos observar que se nos muestra el css: anexo II - reinstalaci\u00f3n de node Para reinstalar nodejs: Desinstalar node por completo: Bash 1 sudo apt-get purge --auto-remove nodejs Eliminar todo resto de node y npm: a. Antes que nadas, debe ejecutar el siguiente comando desde el terminal: Bash 1 sudo rm -rf /usr/local/bin/npm /usr/local/share/man/man1/node* /usr/local/lib/dtrace/node.d ~/.npm ~/.node-gyp /opt/local/bin/node opt/local/include/node /opt/local/lib/node_modules Text Only 1 b. Eliminar los directorios node o node_modules de /usr/local/lib con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/lib/node* Text Only 1 c. Eliminar los directorios node o node_modules de /usr/local/include con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/include/node* Text Only 1 d. Eliminar cualquier archivo de nodo o directorio de /usr/local/bin con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/bin/node Instalar otra vez nvm: a. Instalar NvM (Node Version Manager), desde el directorio de usuario ~ : Bash 1 curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash Text Only 1 b. Actualiza el archivo .bashrc: Bash 1 source .bashrc Text Only 1 c. Confirma que el directorio local est\u00e1 configurado: Bash 1 2 echo $NVM_DIR /home/username/.nvm Instalar node: a. Revisar qu\u00e9 versiones de Node.js est\u00e1n disponibles: Bash 1 nvm ls-remote Text Only 1 b. Instalar la versi\u00f3n que desees (elige la v20.10.0): Bash 1 nvm install v20.10.0 Comprobar que la nueva versi\u00f3n de node es superior a 14: Bash 1 node -v referencias .","title":"ud07 Laravel anexos"},{"location":"ud07/ud07_Laravel_anexos/#anexo-i-instalacion-de-tailwind-css","text":"Si hemos decidido instalar Tailwind CSS para que nos eche una mano con nuestro css, deberemos de seguir estos pasos: Hay que comprobar la versi\u00f3n de npm y node: Bash 1 2 npm -v node -v Si la versi\u00f3n de nodejs es inferior a la versi\u00f3n 14 (a la hora de crear este documento) antes de seguir habremos de reinstalarlo . Para ello habr\u00e1 que ir al anexo II - reinstalaci\u00f3n de node en este mismo documento. no continuar si la versi\u00f3n de node es inferior a 14 . Si nuestra versi\u00f3n de nodejs es correcta (o hemos procedido a reinstalar node en el punto 2), lo primero ser\u00e1 desinstalar bootstrap: Bash 1 npm uninstall bootstrap Instalaremos en desarrollo estas tres dependencias: Bash 1 npm install -D tailwindcss postcss autoprefixer Generamos ahora el fichero tailwindcss.config.js que aparecer\u00e1 en la ra\u00edz del proyecto: Bash 1 npx tailwindcss init -p Editar el fichero del proyecto Laravel tailwindcss.config.js que se ha generado en el directorio ra\u00edz del proyecto y donde indicaremos d\u00f3nde vamos a utilizarlo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 /** @type {import('tailwindcss').Config} */ export default { content: [ \"./resources/**/*.blade.php\", \"./resources/**/*.js\", \"./resources/**/*.vue\", ], theme: { extend: {}, }, plugins: [], } Ahora, en el fichero /resources/css/ app.css agregar las siguientes l\u00edneas: CSS 1 2 3 @ tailwind base ; @ tailwind components ; @ tailwind utilities ; Desde el terminal (y siempre dentro de nuestro proyecto), vamos a ejecutar: Bash 1 2 3 npm run dev # \u00f3, si no funciona: # npm run dev -- --host En el fichero /resources/views/layouts/ app.blade.php hay que indicarle que va a utilizar el fichero /resources/css/ app.css , para ello hay que a\u00f1adirlo en: Text Only 1 @vite('resources/css/app.css') A partir de ahora, y con este ejemplo, podemos observar que se nos muestra el css:","title":"anexo I - instalaci\u00f3n de Tailwind CSS"},{"location":"ud07/ud07_Laravel_anexos/#anexo-ii-reinstalacion-de-node","text":"Para reinstalar nodejs: Desinstalar node por completo: Bash 1 sudo apt-get purge --auto-remove nodejs Eliminar todo resto de node y npm: a. Antes que nadas, debe ejecutar el siguiente comando desde el terminal: Bash 1 sudo rm -rf /usr/local/bin/npm /usr/local/share/man/man1/node* /usr/local/lib/dtrace/node.d ~/.npm ~/.node-gyp /opt/local/bin/node opt/local/include/node /opt/local/lib/node_modules Text Only 1 b. Eliminar los directorios node o node_modules de /usr/local/lib con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/lib/node* Text Only 1 c. Eliminar los directorios node o node_modules de /usr/local/include con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/include/node* Text Only 1 d. Eliminar cualquier archivo de nodo o directorio de /usr/local/bin con la ayuda del siguiente comando: Bash 1 sudo rm -rf /usr/local/bin/node Instalar otra vez nvm: a. Instalar NvM (Node Version Manager), desde el directorio de usuario ~ : Bash 1 curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash Text Only 1 b. Actualiza el archivo .bashrc: Bash 1 source .bashrc Text Only 1 c. Confirma que el directorio local est\u00e1 configurado: Bash 1 2 echo $NVM_DIR /home/username/.nvm Instalar node: a. Revisar qu\u00e9 versiones de Node.js est\u00e1n disponibles: Bash 1 nvm ls-remote Text Only 1 b. Instalar la versi\u00f3n que desees (elige la v20.10.0): Bash 1 nvm install v20.10.0 Comprobar que la nueva versi\u00f3n de node es superior a 14: Bash 1 node -v","title":"anexo II - reinstalaci\u00f3n de node"},{"location":"ud07/ud07_Laravel_anexos/#referencias","text":".","title":"referencias"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion/","text":"unit: unidad did\u00e1ctica 8 title: Laravel - formularios y validaci\u00f3n language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets definici\u00f3n y uso de formularios Creaci\u00f3n y env\u00edo de formularios Actualizaciones y borrados Validaci\u00f3n de formularios Ejemplo de validaci\u00f3n Utilizar form requests para validaciones m\u00e1s complejas Mostrar mensajes de error Recordar valores enviados bibliografia El uso de estos materiales est\u00e1 sujeto a una licencia Creative Commons CC BY-NC . Material extra\u00eddo de https://nachoiborraies.github.io/laravel/ definici\u00f3n y uso de formularios El env\u00edo de formularios en Laravel implica, por un lado, definir un formulario, empleando HTML sencillo junto con algunas opciones ofrecidas por Blade. Por otra parte, debemos recoger los datos enviados por el formulario en alg\u00fan m\u00e9todo de alg\u00fan controlador, y procesarlos adecuadamente. Creaci\u00f3n y env\u00edo de formularios Si definimos un formulario en una vista, se define con los conceptos que ya sabemos de HTML. Como \u00fanico a\u00f1adido, en el campo action del formulario podemos utilizar Blade y la funci\u00f3n route para indicar el nombre de ruta a la que queremos enviar el formulario. Veamos, por ejemplo, c\u00f3mo definir un formulario para dar de alta nuevos libros en nuestro proyecto de biblioteca . Creamos una vista llamada create.blade.php en la subcarpeta resources/views/libros , con un contenido como \u00e9ste: Si definimos un formulario en una vista, se define con los conceptos que ya sabemos de HTML. Como \u00fanico a\u00f1adido, en el campo action del formulario podemos utilizar Blade y la funci\u00f3n route para indicar el nombre de ruta a la que queremos enviar el formulario. Veamos, por ejemplo, c\u00f3mo definir un formulario para dar de alta nuevos libros en nuestro proyecto de biblioteca . Creamos una vista llamada create.blade.php en la subcarpeta resources/views/libros , con un contenido como \u00e9ste: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 @extends('plantilla') @section('titulo', 'Nuevo libro') @section('contenido') <h1>Nuevo libro</h1> <form action=\"{{ route('libros.store') }}\" method=\"POST\"> <div class=\"form-group\"> <label for=\"titulo\">T\u00edtulo:</label> <input type=\"text\" class=\"form-control\" name=\"titulo\" id=\"titulo\"> </div> <div class=\"form-group\"> <label for=\"editorial\">Editorial:</label> <input type=\"text\" class=\"form-control\" name=\"editorial\" id=\"editorial\"> </div> <div class=\"form-group\"> <label for=\"precio\">Precio:</label> <input type=\"text\" class=\"form-control\" name=\"precio\" id=\"precio\"> </div> <div class=\"form-group\"> <label for=\"autor\">Autor:</label> <select class=\"form-control\" name=\"autor\" id=\"autor\"> @foreach ($autores as $autor) <option value=\"{{ $autor->id }}\"> {{ $autor->nombre }} </option> @endforeach </select> </div> <input type=\"submit\" class=\"btn btn-dark btn-block\" name=\"enviar\" value=\"Enviar\" > </form> @endsection Un segundo a\u00f1adido m\u00e1s que tenemos que tener en cuenta es que Laravel por defecto protege de ataques XSS ( Cross Site Scripting ) de suplantaci\u00f3n de identidad, por lo que obtendremos un error de tipo 419 si enviamos un formulario no validado. Para solucionar este problema, basta con utilizar la directiva @csrf en el formulario, que a\u00f1ade un campo oculto con un token de validaci\u00f3n: PHP 1 2 3 4 <form action=\"{{ route('libros.store') }}\" method=\"POST\"> @csrf // ... </form> En cualquier caso, este formulario se enviar\u00e1 a la ruta indicada. Dado que en nuestro proyecto hemos definido un conjunto de recursos como \u00e9ste en routes/web.php , la ruta ya est\u00e1 autom\u00e1ticamente definida como libros.store : PHP 1 Route::resource('libros', LibroController::class); De lo contrario, tendr\u00edamos que a\u00f1adir a mano la ruta correspondiente para recoger el formulario. Adem\u00e1s, debemos redefinir los m\u00e9todos involucrados en el controlador: por un lado, el m\u00e9todo create deber\u00e1 renderizar el formulario anterior. Como necesitamos mostrar el listado de autores para asociar uno al libro, le pasaremos a la vista anterior el listado de autores como par\u00e1metro (recuerda incluir el modelo Autor con use , si no lo has hecho antes): PHP 1 2 3 4 5 public function create() { $autores = Autor::get(); return view('libros.create', compact('autores')); } Por otra parte, el m\u00e9todo store se encargar\u00e1 de recoger los datos de la petici\u00f3n a trav\u00e9s del par\u00e1metro Request de dicho m\u00e9todo. Disponemos de un m\u00e9todo get para acceder a cada campo del formulario a partir de su nombre: PHP 1 2 3 4 5 6 7 8 9 10 11 public function store(Request $request) { $libro = new Libro(); $libro->titulo = $request->get('titulo'); $libro->editorial = $request->get('editorial'); $libro->precio = $request->get('precio'); $libro->autor()->associate(Autor::findOrFail($request->get('autor'))); $libro->save(); return redirect()->route('libros.index'); } Podemos emplear tambi\u00e9n alg\u00fan m\u00e9todo auxiliar de la petici\u00f3n, como has , que comprueba si existe un campo con un nombre determinado: PHP 1 2 3 4 5 6 7 public function store(Request $request) { if($request->has('titulo')) { // ... } } Para poder lanzar esta operaci\u00f3n de inserci\u00f3n, necesitamos alg\u00fan enlace que muestre el formulario. Podemos a\u00f1adir una nueva opci\u00f3n en el men\u00fa superior de navegaci\u00f3n (archivo resources/views/partials/nav.blade.php ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <nav class=\"navbar navbar-expand-lg navbar-dark bg-secondary\"> // ... <div class=\"collapse navbar-collapse\" id=\"navbarNav\"> <ul class=\"navbar-nav\"> ... <li class=\"{{ setActivo('libros.create') }} nav-item\"> <a class=\"nav-link\" href=\"{{ route('libros.create') }}\"> Nuevo libro </a> </li> </ul> </div> </nav> Actualizaciones y borrados Por defecto, el atributo method de un formulario s\u00f3lo admite los valores GET o POST. Si queremos enviar un formulario de actualizaci\u00f3n o borrado, \u00e9ste debe ir asociado a los m\u00e9todos PUT o DELETE, respectivamente. Para esto, podemos emplear dentro del mismo formulario la directiva @method , indicando el nombre del m\u00e9todo que queremos usar: PHP 1 2 3 4 5 <form ...> @csrf @method('PUT') // ... </form> Por ejemplo, para borrar libros en nuestra aplicaci\u00f3n de biblioteca, podr\u00edamos a\u00f1adir un formulario como este en la ficha del libro (vista resources/views/libros/show.blade.php ): PHP 1 2 3 4 5 <form action=\"{{ route('libros.destroy', $libro->id) }}\" method=\"POST\"> @csrf @method('DELETE') <input type=\"submit\" class=\"btn btn-danger\" value=\"Borrar libro\" /> </form> Observa c\u00f3mo le pasamos a la ruta el id del libro a borrar, para que le llegue como par\u00e1metro al m\u00e9todo destroy del controlador. Dentro de este m\u00e9todo, buscamos el libro afectado, lo borramos, y mostramos el listado de libros nuevamente: PHP 1 2 3 4 5 6 public function destroy($id) { $libro = Libro::findOrFail($id); $libro->delete(); return redirect()->route('libros.index'); } Validaci\u00f3n de formularios Adem\u00e1s de aplicar una validaci\u00f3n en el cliente a trav\u00e9s de HTML5, que tambi\u00e9n es recomendable, se deben validar los datos en el servidor. Para hacer esto, el propio objeto request proporciona un m\u00e9todo llamado validate , al que le pasamos un array con las reglas de validaci\u00f3n. Ejemplo de validaci\u00f3n Por ejemplo, as\u00ed comprobar\u00edamos que el t\u00edtulo y la editorial de los libros de nuestra biblioteca se han enviado, y que el t\u00edtulo tiene un tama\u00f1o m\u00ednimo de 3 caracteres. Adem\u00e1s, comprobamos que el precio es un valor num\u00e9rico real positivo. PHP 1 2 3 4 5 6 7 8 9 10 11 12 public function store() { request()->validate( [ 'titulo' => 'required|min:3', 'editorial' => 'required', 'precio' => 'required|numeric|min:0' ] ); // ... c\u00f3digo para procesar el formulario } NOTA : notar que en varios campos se han a\u00f1adido dos o m\u00e1s reglas de validaci\u00f3n enlazadas por una barra vertical. Para el precio, por ejemplo, se comprueba que se ha enviado, que es num\u00e9rico y que es mayor o igual que 0. Pod\u00e9is consultar en la documentaci\u00f3n de Laravel sobre otras reglas de validaci\u00f3n disponibles, especialmente en el apartado de Available Validation Rules . Utilizar form requests para validaciones m\u00e1s complejas Si tenemos que validar unos pocos campos, puede ser adecuado llamar al m\u00e9todo validate desde el propio m\u00e9todo del controlador, pero para formularios m\u00e1s grandes el c\u00f3digo puede crecer demasiado. Una alternativa que ofrece laravel es crear un form request , una clase adicional que contiene la l\u00f3gica de validaci\u00f3n de una petici\u00f3n. Se crean con el comando php artisan , y la opci\u00f3n make:request , seguida del nombre de la clase a crear: PHP 1 php artisan make:request LibroPost Esta clase se almacena por defecto en app/Http/Requests , y contiene un par de m\u00e9todos predefinidos: authorize : devuelve un booleano dependiendo de si el usuario actual est\u00e1 autorizado a enviar la petici\u00f3n o no. Para muchos formularios que no requieran autorizaci\u00f3n previa podemos simplemente devolver true . Ser\u00e1 lo que haremos de momento en este formulario. rules : este es el m\u00e9todo que m\u00e1s nos interesa. Devuelve un array de reglas de validaci\u00f3n como las que ten\u00edamos en el controller, as\u00ed que movemos ese c\u00f3digo aqu\u00ed: PHP 1 2 3 4 5 6 7 8 public function rules() { return [ 'titulo' => 'required|min:3', 'editorial' => 'required', 'precio' => 'required|numeric|min:0' ]; } Ahora, en el m\u00e9todo del controlador simplemente tenemos que inyectar este form request como par\u00e1metro (si observamos la clase que se ha creado, es un subtipo de Request ), y usarlo para validar. La validaci\u00f3n es autom\u00e1tica, es decir, no tenemos que a\u00f1adir m\u00e1s c\u00f3digo al controlador que el objeto inyectado como par\u00e1metro, que se encargar\u00e1 de validar la propia petici\u00f3n que contiene a trav\u00e9s del m\u00e9todo rules . PHP 1 2 3 4 public function store(LibroPost $request) { // si entramos aqu\u00ed, el formulario es v\u00e1lido } Mostrar mensajes de error Si la validaci\u00f3n es correcta, se retornar\u00e1 el dato del final de la funci\u00f3n, pero si falla alg\u00fan campo, se volver\u00e1 a la p\u00e1gina del formulario, con la informaci\u00f3n del error que se haya producido. Podemos acceder desde cualquier lugar de Laravel a la variable $errors con los errores que se hayan producido en una operaci\u00f3n determinada. Esta variable tiene un m\u00e9todo booleano llamado any que comprueba si hay alg\u00fan error, y otro m\u00e9todo llamado all que devuelve el array de errores producidos. Combinando estos dos m\u00e9todos con Blade, podemos mostrar el listado de errores de validaci\u00f3n antes del formulario, de esta forma: PHP 1 2 3 4 5 6 7 8 9 10 11 @if ($errors->any()) <ul> @foreach($errors->all() as $error) <li>{{ $error }}</li> @endforeach </ul> @endif <form ...> @csrf // ... </form> Tambi\u00e9n podemos emplear el m\u00e9todo first del array de errores para obtener el primer error asociado a un campo, y mostrarlo bajo o sobre el campo en cuesti\u00f3n. Por ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <form action=\"{{ route('libros.store') }}\" method=\"POST\"> @csrf <div class=\"form-group\"> <label for=\"titulo\">T\u00edtulo:</label> <input type=\"text\" class=\"form-control\" name=\"titulo\" id=\"titulo\"> @if ($errors->has('titulo')) <div class=\"text-danger\"> {{ $errors->first('titulo') }} </div> @endif </div> // ... Adem\u00e1s, podemos personalizar el mensaje de error a mostrar, redefiniendo en la clase del form request el m\u00e9todo messages . En este m\u00e9todo devolvemos un array con el mensaje a mostrar para cada posible error de validaci\u00f3n. Por ejemplo: PHP 1 2 3 4 5 6 7 public function messages() { return [ 'titulo.required' => 'El t\u00edtulo es obligatorio', // ... ]; } De forma alternativa, si optamos por validar el formulario en el propio controlador, este array de mensajes se pasa como segundo par\u00e1metro en la llamada al m\u00e9todo validate : PHP 1 2 3 4 5 6 7 8 9 10 request()->validate( [ 'titulo' => 'required|min:3', 'editorial' => 'required', 'precio' => 'required|numeric|min:0' ], [ 'titulo.required' => 'El t\u00edtulo es obligatorio', // ... ] ); En definitiva, conseguiremos mostrar mensajes de error para los campos que hayan dado errores al validar: Recordar valores enviados Un problema derivado de la validaci\u00f3n de datos es que, al volver a la p\u00e1gina del formulario tras un error, los campos que ya se han examinado hasta el error, aunque fueran correctos, han perdido el valor que ten\u00edan, y puede resultar engorroso tenerlos que rellenar otra vez. Para mantener su antiguo valor, podemos a\u00f1adir el atributo value en cada campo del formulario, y utilizar con Blade una funci\u00f3n llamada old , que permite acceder al anterior valor de un determinado campo, referenciado por su nombre: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <form action=\"{{ route('libros.store') }}\" method=\"POST\"> @csrf <div class=\"form-group\"> <label for=\"titulo\">T\u00edtulo:</label> <input type=\"text\" class=\"form-control\" name=\"titulo\" id=\"titulo\" value=\"{{ old('titulo') }}\"> @if ($errors->has('titulo')) <div class=\"text-danger\"> {{ $errors->first('titulo') }} </div> @endif </div> // ... En el caso de \u00e1reas de texto, usamos esta expresi\u00f3n dentro del \u00e1rea (es decir, entre la etiqueta de apertura y la de cierre del textarea ): PHP 1 2 3 <textarea name=\"mensaje\" placeholder=\"Mensaje...\"> {{ old('mensaje') }} </textarea> bibliografia Nacho Iborra Baeza .","title":"ud08 Laravel 5 FormulariosYValidacion"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion/#definicion-y-uso-de-formularios","text":"El env\u00edo de formularios en Laravel implica, por un lado, definir un formulario, empleando HTML sencillo junto con algunas opciones ofrecidas por Blade. Por otra parte, debemos recoger los datos enviados por el formulario en alg\u00fan m\u00e9todo de alg\u00fan controlador, y procesarlos adecuadamente.","title":"definici\u00f3n y uso de formularios"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion/#creacion-y-envio-de-formularios","text":"Si definimos un formulario en una vista, se define con los conceptos que ya sabemos de HTML. Como \u00fanico a\u00f1adido, en el campo action del formulario podemos utilizar Blade y la funci\u00f3n route para indicar el nombre de ruta a la que queremos enviar el formulario. Veamos, por ejemplo, c\u00f3mo definir un formulario para dar de alta nuevos libros en nuestro proyecto de biblioteca . Creamos una vista llamada create.blade.php en la subcarpeta resources/views/libros , con un contenido como \u00e9ste: Si definimos un formulario en una vista, se define con los conceptos que ya sabemos de HTML. Como \u00fanico a\u00f1adido, en el campo action del formulario podemos utilizar Blade y la funci\u00f3n route para indicar el nombre de ruta a la que queremos enviar el formulario. Veamos, por ejemplo, c\u00f3mo definir un formulario para dar de alta nuevos libros en nuestro proyecto de biblioteca . Creamos una vista llamada create.blade.php en la subcarpeta resources/views/libros , con un contenido como \u00e9ste: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 @extends('plantilla') @section('titulo', 'Nuevo libro') @section('contenido') <h1>Nuevo libro</h1> <form action=\"{{ route('libros.store') }}\" method=\"POST\"> <div class=\"form-group\"> <label for=\"titulo\">T\u00edtulo:</label> <input type=\"text\" class=\"form-control\" name=\"titulo\" id=\"titulo\"> </div> <div class=\"form-group\"> <label for=\"editorial\">Editorial:</label> <input type=\"text\" class=\"form-control\" name=\"editorial\" id=\"editorial\"> </div> <div class=\"form-group\"> <label for=\"precio\">Precio:</label> <input type=\"text\" class=\"form-control\" name=\"precio\" id=\"precio\"> </div> <div class=\"form-group\"> <label for=\"autor\">Autor:</label> <select class=\"form-control\" name=\"autor\" id=\"autor\"> @foreach ($autores as $autor) <option value=\"{{ $autor->id }}\"> {{ $autor->nombre }} </option> @endforeach </select> </div> <input type=\"submit\" class=\"btn btn-dark btn-block\" name=\"enviar\" value=\"Enviar\" > </form> @endsection Un segundo a\u00f1adido m\u00e1s que tenemos que tener en cuenta es que Laravel por defecto protege de ataques XSS ( Cross Site Scripting ) de suplantaci\u00f3n de identidad, por lo que obtendremos un error de tipo 419 si enviamos un formulario no validado. Para solucionar este problema, basta con utilizar la directiva @csrf en el formulario, que a\u00f1ade un campo oculto con un token de validaci\u00f3n: PHP 1 2 3 4 <form action=\"{{ route('libros.store') }}\" method=\"POST\"> @csrf // ... </form> En cualquier caso, este formulario se enviar\u00e1 a la ruta indicada. Dado que en nuestro proyecto hemos definido un conjunto de recursos como \u00e9ste en routes/web.php , la ruta ya est\u00e1 autom\u00e1ticamente definida como libros.store : PHP 1 Route::resource('libros', LibroController::class); De lo contrario, tendr\u00edamos que a\u00f1adir a mano la ruta correspondiente para recoger el formulario. Adem\u00e1s, debemos redefinir los m\u00e9todos involucrados en el controlador: por un lado, el m\u00e9todo create deber\u00e1 renderizar el formulario anterior. Como necesitamos mostrar el listado de autores para asociar uno al libro, le pasaremos a la vista anterior el listado de autores como par\u00e1metro (recuerda incluir el modelo Autor con use , si no lo has hecho antes): PHP 1 2 3 4 5 public function create() { $autores = Autor::get(); return view('libros.create', compact('autores')); } Por otra parte, el m\u00e9todo store se encargar\u00e1 de recoger los datos de la petici\u00f3n a trav\u00e9s del par\u00e1metro Request de dicho m\u00e9todo. Disponemos de un m\u00e9todo get para acceder a cada campo del formulario a partir de su nombre: PHP 1 2 3 4 5 6 7 8 9 10 11 public function store(Request $request) { $libro = new Libro(); $libro->titulo = $request->get('titulo'); $libro->editorial = $request->get('editorial'); $libro->precio = $request->get('precio'); $libro->autor()->associate(Autor::findOrFail($request->get('autor'))); $libro->save(); return redirect()->route('libros.index'); } Podemos emplear tambi\u00e9n alg\u00fan m\u00e9todo auxiliar de la petici\u00f3n, como has , que comprueba si existe un campo con un nombre determinado: PHP 1 2 3 4 5 6 7 public function store(Request $request) { if($request->has('titulo')) { // ... } } Para poder lanzar esta operaci\u00f3n de inserci\u00f3n, necesitamos alg\u00fan enlace que muestre el formulario. Podemos a\u00f1adir una nueva opci\u00f3n en el men\u00fa superior de navegaci\u00f3n (archivo resources/views/partials/nav.blade.php ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 <nav class=\"navbar navbar-expand-lg navbar-dark bg-secondary\"> // ... <div class=\"collapse navbar-collapse\" id=\"navbarNav\"> <ul class=\"navbar-nav\"> ... <li class=\"{{ setActivo('libros.create') }} nav-item\"> <a class=\"nav-link\" href=\"{{ route('libros.create') }}\"> Nuevo libro </a> </li> </ul> </div> </nav>","title":"Creaci\u00f3n y env\u00edo de formularios"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion/#actualizaciones-y-borrados","text":"Por defecto, el atributo method de un formulario s\u00f3lo admite los valores GET o POST. Si queremos enviar un formulario de actualizaci\u00f3n o borrado, \u00e9ste debe ir asociado a los m\u00e9todos PUT o DELETE, respectivamente. Para esto, podemos emplear dentro del mismo formulario la directiva @method , indicando el nombre del m\u00e9todo que queremos usar: PHP 1 2 3 4 5 <form ...> @csrf @method('PUT') // ... </form> Por ejemplo, para borrar libros en nuestra aplicaci\u00f3n de biblioteca, podr\u00edamos a\u00f1adir un formulario como este en la ficha del libro (vista resources/views/libros/show.blade.php ): PHP 1 2 3 4 5 <form action=\"{{ route('libros.destroy', $libro->id) }}\" method=\"POST\"> @csrf @method('DELETE') <input type=\"submit\" class=\"btn btn-danger\" value=\"Borrar libro\" /> </form> Observa c\u00f3mo le pasamos a la ruta el id del libro a borrar, para que le llegue como par\u00e1metro al m\u00e9todo destroy del controlador. Dentro de este m\u00e9todo, buscamos el libro afectado, lo borramos, y mostramos el listado de libros nuevamente: PHP 1 2 3 4 5 6 public function destroy($id) { $libro = Libro::findOrFail($id); $libro->delete(); return redirect()->route('libros.index'); }","title":"Actualizaciones y borrados"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion/#validacion-de-formularios","text":"Adem\u00e1s de aplicar una validaci\u00f3n en el cliente a trav\u00e9s de HTML5, que tambi\u00e9n es recomendable, se deben validar los datos en el servidor. Para hacer esto, el propio objeto request proporciona un m\u00e9todo llamado validate , al que le pasamos un array con las reglas de validaci\u00f3n.","title":"Validaci\u00f3n de formularios"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion/#ejemplo-de-validacion","text":"Por ejemplo, as\u00ed comprobar\u00edamos que el t\u00edtulo y la editorial de los libros de nuestra biblioteca se han enviado, y que el t\u00edtulo tiene un tama\u00f1o m\u00ednimo de 3 caracteres. Adem\u00e1s, comprobamos que el precio es un valor num\u00e9rico real positivo. PHP 1 2 3 4 5 6 7 8 9 10 11 12 public function store() { request()->validate( [ 'titulo' => 'required|min:3', 'editorial' => 'required', 'precio' => 'required|numeric|min:0' ] ); // ... c\u00f3digo para procesar el formulario } NOTA : notar que en varios campos se han a\u00f1adido dos o m\u00e1s reglas de validaci\u00f3n enlazadas por una barra vertical. Para el precio, por ejemplo, se comprueba que se ha enviado, que es num\u00e9rico y que es mayor o igual que 0. Pod\u00e9is consultar en la documentaci\u00f3n de Laravel sobre otras reglas de validaci\u00f3n disponibles, especialmente en el apartado de Available Validation Rules .","title":"Ejemplo de validaci\u00f3n"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion/#utilizar-form-requests-para-validaciones-mas-complejas","text":"Si tenemos que validar unos pocos campos, puede ser adecuado llamar al m\u00e9todo validate desde el propio m\u00e9todo del controlador, pero para formularios m\u00e1s grandes el c\u00f3digo puede crecer demasiado. Una alternativa que ofrece laravel es crear un form request , una clase adicional que contiene la l\u00f3gica de validaci\u00f3n de una petici\u00f3n. Se crean con el comando php artisan , y la opci\u00f3n make:request , seguida del nombre de la clase a crear: PHP 1 php artisan make:request LibroPost Esta clase se almacena por defecto en app/Http/Requests , y contiene un par de m\u00e9todos predefinidos: authorize : devuelve un booleano dependiendo de si el usuario actual est\u00e1 autorizado a enviar la petici\u00f3n o no. Para muchos formularios que no requieran autorizaci\u00f3n previa podemos simplemente devolver true . Ser\u00e1 lo que haremos de momento en este formulario. rules : este es el m\u00e9todo que m\u00e1s nos interesa. Devuelve un array de reglas de validaci\u00f3n como las que ten\u00edamos en el controller, as\u00ed que movemos ese c\u00f3digo aqu\u00ed: PHP 1 2 3 4 5 6 7 8 public function rules() { return [ 'titulo' => 'required|min:3', 'editorial' => 'required', 'precio' => 'required|numeric|min:0' ]; } Ahora, en el m\u00e9todo del controlador simplemente tenemos que inyectar este form request como par\u00e1metro (si observamos la clase que se ha creado, es un subtipo de Request ), y usarlo para validar. La validaci\u00f3n es autom\u00e1tica, es decir, no tenemos que a\u00f1adir m\u00e1s c\u00f3digo al controlador que el objeto inyectado como par\u00e1metro, que se encargar\u00e1 de validar la propia petici\u00f3n que contiene a trav\u00e9s del m\u00e9todo rules . PHP 1 2 3 4 public function store(LibroPost $request) { // si entramos aqu\u00ed, el formulario es v\u00e1lido }","title":"Utilizar form requests para validaciones m\u00e1s complejas"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion/#mostrar-mensajes-de-error","text":"Si la validaci\u00f3n es correcta, se retornar\u00e1 el dato del final de la funci\u00f3n, pero si falla alg\u00fan campo, se volver\u00e1 a la p\u00e1gina del formulario, con la informaci\u00f3n del error que se haya producido. Podemos acceder desde cualquier lugar de Laravel a la variable $errors con los errores que se hayan producido en una operaci\u00f3n determinada. Esta variable tiene un m\u00e9todo booleano llamado any que comprueba si hay alg\u00fan error, y otro m\u00e9todo llamado all que devuelve el array de errores producidos. Combinando estos dos m\u00e9todos con Blade, podemos mostrar el listado de errores de validaci\u00f3n antes del formulario, de esta forma: PHP 1 2 3 4 5 6 7 8 9 10 11 @if ($errors->any()) <ul> @foreach($errors->all() as $error) <li>{{ $error }}</li> @endforeach </ul> @endif <form ...> @csrf // ... </form> Tambi\u00e9n podemos emplear el m\u00e9todo first del array de errores para obtener el primer error asociado a un campo, y mostrarlo bajo o sobre el campo en cuesti\u00f3n. Por ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <form action=\"{{ route('libros.store') }}\" method=\"POST\"> @csrf <div class=\"form-group\"> <label for=\"titulo\">T\u00edtulo:</label> <input type=\"text\" class=\"form-control\" name=\"titulo\" id=\"titulo\"> @if ($errors->has('titulo')) <div class=\"text-danger\"> {{ $errors->first('titulo') }} </div> @endif </div> // ... Adem\u00e1s, podemos personalizar el mensaje de error a mostrar, redefiniendo en la clase del form request el m\u00e9todo messages . En este m\u00e9todo devolvemos un array con el mensaje a mostrar para cada posible error de validaci\u00f3n. Por ejemplo: PHP 1 2 3 4 5 6 7 public function messages() { return [ 'titulo.required' => 'El t\u00edtulo es obligatorio', // ... ]; } De forma alternativa, si optamos por validar el formulario en el propio controlador, este array de mensajes se pasa como segundo par\u00e1metro en la llamada al m\u00e9todo validate : PHP 1 2 3 4 5 6 7 8 9 10 request()->validate( [ 'titulo' => 'required|min:3', 'editorial' => 'required', 'precio' => 'required|numeric|min:0' ], [ 'titulo.required' => 'El t\u00edtulo es obligatorio', // ... ] ); En definitiva, conseguiremos mostrar mensajes de error para los campos que hayan dado errores al validar:","title":"Mostrar mensajes de error"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion/#recordar-valores-enviados","text":"Un problema derivado de la validaci\u00f3n de datos es que, al volver a la p\u00e1gina del formulario tras un error, los campos que ya se han examinado hasta el error, aunque fueran correctos, han perdido el valor que ten\u00edan, y puede resultar engorroso tenerlos que rellenar otra vez. Para mantener su antiguo valor, podemos a\u00f1adir el atributo value en cada campo del formulario, y utilizar con Blade una funci\u00f3n llamada old , que permite acceder al anterior valor de un determinado campo, referenciado por su nombre: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <form action=\"{{ route('libros.store') }}\" method=\"POST\"> @csrf <div class=\"form-group\"> <label for=\"titulo\">T\u00edtulo:</label> <input type=\"text\" class=\"form-control\" name=\"titulo\" id=\"titulo\" value=\"{{ old('titulo') }}\"> @if ($errors->has('titulo')) <div class=\"text-danger\"> {{ $errors->first('titulo') }} </div> @endif </div> // ... En el caso de \u00e1reas de texto, usamos esta expresi\u00f3n dentro del \u00e1rea (es decir, entre la etiqueta de apertura y la de cierre del textarea ): PHP 1 2 3 <textarea name=\"mensaje\" placeholder=\"Mensaje...\"> {{ old('mensaje') }} </textarea>","title":"Recordar valores enviados"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion/#bibliografia","text":"Nacho Iborra Baeza .","title":"bibliografia"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion_actividades/","text":"unit: unidad did\u00e1ctica 8 title: Laravel - formularios y validaci\u00f3n (actividades) language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets ejercicios ejercicio 1 ejercicio 2 (opcional) ejercicio 3 bibliografia El uso de estos materiales est\u00e1 sujeto a una licencia Creative Commons CC BY-NC . Material extra\u00eddo de https://nachoiborraies.github.io/laravel/ ejercicios ejercicio 1 Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Crea un formulario para dar de alta nuevos posts, en la vista resources/views/posts/create.blade.php . A\u00f1ade un par de campos (un texto corto y un texto largo) para rellenar el t\u00edtulo y el contenido, y como autor o usuario del post de momento deja uno predefinido; por ejemplo, el autor con id = 1, o el primer usuario que encuentres en la base de datos ( Usuario::get()->first() ). M\u00e1s adelante ya lo haremos dependiente del usuario que se haya autenticado. Recuerda definir el m\u00e9todo store en el controlador de posts para dar de alta el post, y redirigir despu\u00e9s al listado principal de posts. Para cargar el formulario, a\u00f1ade una nueva opci\u00f3n en el men\u00fa principal de navegaci\u00f3n. En la ficha de un post, a\u00f1ade un bot\u00f3n con un formulario para borrar el post. Deber\u00e1s definir el c\u00f3digo del m\u00e9todo destroy para eliminar el post y redirigir de nuevo al listado. En el caso de que hayas hecho el ejercicio opcional de la sesi\u00f3n anterior para a\u00f1adir comentarios a los posts, deber\u00e1s previamente eliminar todos los comentarios asociados a ese post, y despu\u00e9s borrar el post. Para filtrar los comentarios de un post y borrarlos, utiliza la cl\u00e1usula where que se explic\u00f3 en la sesi\u00f3n 4: PHP 1 2 Comentario::where('post_id', $id)->delete(); // aqu\u00ed ya borramos el post ejercicio 2 (opcional) Continuamos con el proyecto blog anterior. Ahora a\u00f1adiremos el formulario de edici\u00f3n de un post, tambi\u00e9n desde la vista de la ficha del post. El formulario deber\u00e1 mostrar los datos ya rellenos del post. Dicho formulario se carga a partir del m\u00e9todo edit (que deber\u00e1 renderizar la vista con el formulario de edici\u00f3n, resources/views/posts/edit.blade.php ), y el formulario se enviar\u00e1 al m\u00e9todo update del controlador, pas\u00e1ndole como par\u00e1metro el id del post a modificar. ejercicio 3 Continuamos con el proyecto blog anterior. Crea un form request llamado PostRequest , que valide los datos del post. En concreto, deben cumplirse estos requisitos: El t\u00edtulo del post debe ser obligatorio, y de al menos 5 caracteres de longitud. El contenido del post debe ser obligatorio, y de al menos 50 caracteres de longitud. Define mensajes de error personalizados para cada posible error de validaci\u00f3n, y mu\u00e9stralos junto a cada campo afectado, como en el ejemplo de la biblioteca. Adem\u00e1s, utiliza la funci\u00f3n old para recordar el valor antiguo correcto, en el caso de que un campo pase la validaci\u00f3n pero otro(s) no. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_08a.zip . bibliografia Nacho Iborra Baeza .","title":"ud08 Laravel 5 FormulariosYValidacion actividades"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion_actividades/#ejercicios","text":"","title":"ejercicios"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion_actividades/#ejercicio-1","text":"Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Crea un formulario para dar de alta nuevos posts, en la vista resources/views/posts/create.blade.php . A\u00f1ade un par de campos (un texto corto y un texto largo) para rellenar el t\u00edtulo y el contenido, y como autor o usuario del post de momento deja uno predefinido; por ejemplo, el autor con id = 1, o el primer usuario que encuentres en la base de datos ( Usuario::get()->first() ). M\u00e1s adelante ya lo haremos dependiente del usuario que se haya autenticado. Recuerda definir el m\u00e9todo store en el controlador de posts para dar de alta el post, y redirigir despu\u00e9s al listado principal de posts. Para cargar el formulario, a\u00f1ade una nueva opci\u00f3n en el men\u00fa principal de navegaci\u00f3n. En la ficha de un post, a\u00f1ade un bot\u00f3n con un formulario para borrar el post. Deber\u00e1s definir el c\u00f3digo del m\u00e9todo destroy para eliminar el post y redirigir de nuevo al listado. En el caso de que hayas hecho el ejercicio opcional de la sesi\u00f3n anterior para a\u00f1adir comentarios a los posts, deber\u00e1s previamente eliminar todos los comentarios asociados a ese post, y despu\u00e9s borrar el post. Para filtrar los comentarios de un post y borrarlos, utiliza la cl\u00e1usula where que se explic\u00f3 en la sesi\u00f3n 4: PHP 1 2 Comentario::where('post_id', $id)->delete(); // aqu\u00ed ya borramos el post","title":"ejercicio 1"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion_actividades/#ejercicio-2-opcional","text":"Continuamos con el proyecto blog anterior. Ahora a\u00f1adiremos el formulario de edici\u00f3n de un post, tambi\u00e9n desde la vista de la ficha del post. El formulario deber\u00e1 mostrar los datos ya rellenos del post. Dicho formulario se carga a partir del m\u00e9todo edit (que deber\u00e1 renderizar la vista con el formulario de edici\u00f3n, resources/views/posts/edit.blade.php ), y el formulario se enviar\u00e1 al m\u00e9todo update del controlador, pas\u00e1ndole como par\u00e1metro el id del post a modificar.","title":"ejercicio 2 (opcional)"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion_actividades/#ejercicio-3","text":"Continuamos con el proyecto blog anterior. Crea un form request llamado PostRequest , que valide los datos del post. En concreto, deben cumplirse estos requisitos: El t\u00edtulo del post debe ser obligatorio, y de al menos 5 caracteres de longitud. El contenido del post debe ser obligatorio, y de al menos 50 caracteres de longitud. Define mensajes de error personalizados para cada posible error de validaci\u00f3n, y mu\u00e9stralos junto a cada campo afectado, como en el ejemplo de la biblioteca. Adem\u00e1s, utiliza la funci\u00f3n old para recordar el valor antiguo correcto, en el caso de que un campo pase la validaci\u00f3n pero otro(s) no. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_08a.zip .","title":"ejercicio 3"},{"location":"ud08/ud08_Laravel_5_FormulariosYValidacion_actividades/#bibliografia","text":"Nacho Iborra Baeza .","title":"bibliografia"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/","text":"unit: unidad did\u00e1ctica 8 title: Laravel - servicios REST language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets conceptos de servicios REST Conceptos b\u00e1sicos del protocolo HTTP Los servicios REST El formato JSON creaci\u00f3n de servicios REST 1. Definiendo los controladores de API 2. Estableciendo las rutas 3. Servicios GET 3.1. M\u00e1s sobre el formato JSON y la respuesta 4. Resto de servicios 4.1. Validaci\u00f3n de datos 4.2. Respuestas de error bibliografia El uso de estos materiales est\u00e1 sujeto a una licencia Creative Commons CC BY-NC . Material extra\u00eddo de https://nachoiborraies.github.io/laravel/ conceptos de servicios REST En esta unidad del curso veremos c\u00f3mo emplear Laravel como proveedor de servicios REST. Comenzaremos detallando algunas cuestiones b\u00e1sicas de la arquitectura cliente-servidor y de los servicios REST, para luego pasar a ver c\u00f3mo desarrollarlos y probarlos con Laravel. A estas alturas todos deber\u00edamos tener claro que cualquier aplicaci\u00f3n web se basa en una arquitectura cliente-servidor, donde un servidor queda a la espera de conexiones de clientes, y los clientes se conectan a los servidores para solicitar ciertos recursos. Sobre esta base, veremos unas breves pinceladas de c\u00f3mo funciona el protocolo HTTP, y en qu\u00e9 consisten los servicios REST. Conceptos b\u00e1sicos del protocolo HTTP Las comunicaciones web entre cliente y servidor se realizan mediante el protocolo HTTP (o HTTPS, en el caso de comunicaciones seguras). En ambos casos, cliente y servidor se env\u00edan cierta informaci\u00f3n est\u00e1ndar, en cada mensaje En cuanto a los clientes , env\u00edan al servidor los datos del recurso que solicitan, junto con cierta informaci\u00f3n adicional, como por ejemplo las cabeceras de petici\u00f3n (informaci\u00f3n relativa al tipo de cliente o navegador, contenido que acepta, etc), y par\u00e1metros adicionales llamados normalmente datos del formulario , puesto que suelen contener la informaci\u00f3n de alg\u00fan formulario que se env\u00eda de cliente a servidor. Por lo que respecta a los servidores , aceptan estas peticiones, las procesan y env\u00edan de vuelta algunos datos relevantes, como un c\u00f3digo de estado (indicando si la petici\u00f3n pudo ser atendida satisfactoriamente o no), cabeceras de respuesta (indicando el tipo de contenido enviado, tama\u00f1o, idioma, etc), y el recurso solicitado propiamente dicho, si todo ha ido correctamente. Este es el mecanismo que hemos estado utilizando hasta ahora a trav\u00e9s de los controladores: reciben la petici\u00f3n concreta del cliente, y env\u00edan una respuesta, que por el momento se ha centrado en renderizar un contenido HTML de una vista. En cuanto a los c\u00f3digos de estado de la respuesta, depende del resultado de la operaci\u00f3n que se haya realizado, \u00e9stos se catalogan en cinco grupos: C\u00f3digos 1XX **: representan informaci\u00f3n sobre una petici\u00f3n normalmente incompleta. No son muy habituales, pero se pueden emplear cuando la petici\u00f3n es muy larga, y se env\u00eda antes una cabecera para comprobar si se puede procesar dicha petici\u00f3n. C\u00f3digos 2xx : representan peticiones que se han podido atender satisfactoriamente. El c\u00f3digo m\u00e1s habitual es el 200 , respuesta est\u00e1ndar para las peticiones que son correctas. Existen otras variantes, como el c\u00f3digo 201 , que se env\u00eda cuando se ha insertado o creado un nuevo recurso en el servidor (una inserci\u00f3n en una base de datos, por ejemplo), o el c\u00f3digo 204 , que indica que la petici\u00f3n se ha atendido bien, pero no se ha devuelto nada como respuesta. C\u00f3digos 3xx : son c\u00f3digos de redirecci\u00f3n, que indican que de alg\u00fan modo la petici\u00f3n original se ha redirigido a otro recurso del servidor. Por ejemplo, el c\u00f3digo 301 indica que el recurso solicitado se ha movido permanentemente a otra URL. El c\u00f3digo 304 indica que el recurso solicitado no ha cambiado desde la \u00faltima vez que se solicit\u00f3, por si se quiere recuperar de la cach\u00e9 local en ese caso. C\u00f3digos 4xx : indican un error por parte del cliente. El m\u00e1s t\u00edpico es el error 404 , que indica que estamos solicitando una URL o recurso que no existe. Pero tambi\u00e9n hay otros habituales, como el 401 (cliente no autorizado), o 400 (los datos de la petici\u00f3n no son correctos, por ejemplo, porque los campos del formulario no sean v\u00e1lidos). C\u00f3digos 5xx : indican un error por parte del servidor. Por ejemplo, el error 500 indica un error interno del servidor, o el 504 , que es un error de timeout por tiempo excesivo en emitir la respuesta. Haremos uso de estos c\u00f3digos de estado en nuestros servicios REST para informar al cliente del tipo de error que se haya producido, o del estado en que se ha podido atender su petici\u00f3n. Los servicios REST REST son las siglas de RE *presentational S tate T* ransfer , y designa un estilo de arquitectura de aplicaciones distribuidas basado en HTTP. En un sistema REST, identificamos cada recurso a solicitar con una URI (identificador uniforme de recurso), y definimos un conjunto delimitado de comandos o m\u00e9todos a realizar, que t\u00edpicamente son: GET : para obtener resultados de alg\u00fan tipo (listados completos o filtrados por alguna condici\u00f3n). POST : para realizar inserciones o a\u00f1adir elementos en un conjunto de datos. PUT : para realizar modificaciones o actualizaciones del conjunto de datos. DELETE : para realizar borrados del conjunto de datos. Existen otros tipos de comandos o m\u00e9todos, como por ejemplo PATCH (similar a PUT, pero para cambios parciales), HEAD (para consultar s\u00f3lo el encabezado de la respuesta obtenida), etc. Nos centraremos de momento en los cuatro m\u00e9todos principales anteriores. Por lo tanto, identificando el recurso a solicitar y el comando a aplicarle, el servidor que ofrece esta API REST proporciona una respuesta a esa petici\u00f3n. Esta respuesta t\u00edpicamente viene dada por un mensaje en formato JSON o XML (aunque \u00e9ste \u00faltimo cada vez est\u00e1 m\u00e1s en desuso). Esto permite que las aplicaciones puedan extenderse a distintas plataformas, y acceder a los mismos servicios desde una aplicaci\u00f3n Angular, o una aplicaci\u00f3n de escritorio .NET, o una aplicaci\u00f3n m\u00f3vil en Android, por poner varios ejemplos. ACLARACI\u00d3N : para quienes no conozc\u00e1is la definici\u00f3n de API ( Application Programming Interface ), b\u00e1sicamente es el conjunto de m\u00e9todos o funcionalidades que se ponen a disposici\u00f3n de quienes los quieran utilizar. En este caso, el concepto de API REST hace referencia al conjunto de servicios REST proporcionados por el servidor para los clientes que quieran utilizarlos. Una de las caracter\u00edsticas fundamentales de las API es que son Stateless , lo que quiere decir que las peticiones se hacen y desaparecen, no hay usuarios logueados ni datos que se quedan almacenados. Ejemplos de APIs gratuitas: ChuckNorris IO OMDB PokeAPI - Pokemon RAWg - Videojuegos The Star Wars API Para hacer pruebas con estas APIs podemos implementar el c\u00f3digo para consumirlas o utilizar un cliente especial para el consumo de estos servicios. PostMan Thunder Client ( utilizaremos esta extensi\u00f3n de VS Code para nuestras comprobaciones ). Insomnia Advance REST Client (desde el navegador) El formato JSON JSON son las siglas de JavaScript Object Notation , una sintaxis propia de Javascript para poder representar objetos como cadenas de texto, y poder as\u00ed serializar y enviar informaci\u00f3n de objetos a trav\u00e9s de flujos de datos (archivos de texto, comunicaciones cliente-servidor, etc). Un objeto Javascript se define mediante una serie de propiedades y valores. Por ejemplo, los datos de una persona (como nombre y edad) podr\u00edamos almacenarlos as\u00ed: PHP 1 2 3 4 let persona = { nombre: \"Nacho\", edad: 39 }; Este mismo objeto, convertido a JSON, formar\u00eda una cadena de texto con este contenido: PHP 1 {\"nombre\":\"Nacho\",\"edad\":39} Del mismo modo, si tenemos una colecci\u00f3n (vector) de objetos como \u00e9sta: PHP 1 2 3 4 5 6 let personas = [ { nombre: \"Nacho\", edad: 39}, { nombre: \"Mario\", edad: 4}, { nombre: \"Laura\", edad: 2}, { nombre: \"Nora\", edad: 10} ]; Transformada a JSON sigue la misma sintaxis, pero entre corchetes: PHP 1 2 [{\"nombre\":\"Nacho\",\"edad\":39}, {\"nombre\":\"Mario\",\"edad\":4}, {\"nombre\":\"Laura\",\"edad\":2}, {\"nombre\":\"Nora\",\"edad\":10}] Cuando solicitamos un servicio REST, t\u00edpicamente la respuesta (los datos que nos env\u00eda el servicio) vienen en este formato JSON, de modo que es f\u00e1cilmente serializable y se puede enviar entre cualquier tipo de cliente (m\u00f3vil, web, escritorio) y el servidor. creaci\u00f3n de servicios REST Veamos ahora qu\u00e9 pasos dar para construir una API REST en Laravel que d\u00e9 soporte a las operaciones b\u00e1sicas sobre una o varias entidades: consultas (GET), inserciones (POST), modificaciones (PUT) y borrados (DELETE). Emplearemos para ello los denominados controladores de API, que comentamos brevemente en unidades anteriores, al hablar de controladores, y que proporcionan un conjunto de funciones ya definidas para dar soporte a cada uno de estos comandos. 1. Definiendo los controladores de API Para proporcionar una API REST a los clientes que lo requieran, necesitamos definir un controlador (o controladores) orientados a ofrecer estos servicios REST. Estos controladores en Laravel se denominan de tipo api , como vimos en sesiones previas. Normalmente se definir\u00e1 un controlador API por cada uno de los modelos a los que necesitemos acceder. Vamos a crear uno de prueba para ofrecer una API REST sobre los libros de nuestra aplicaci\u00f3n de biblioteca. Existen diferentes formas de ejecutar el comando de creaci\u00f3n del controlador de API. Aqu\u00ed vamos a mostrar quiz\u00e1 una de las m\u00e1s \u00fatiles: PHP 1 2 3 php artisan make:controller Api/LibroController --api --model=Libro // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:controller Api/LibroController --api --model=Libro \u200b PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 namespace App\\Http\\Controllers\\Api; use App\\Http\\Controllers\\Controller; use App\\Models\\Libro; use Illuminate\\Http\\Request; class LibroController extends Controller { /** * Display a listing of the resource. * * @return \\Illuminate\\Http\\Response */ public function index() { // } /** * Store a newly created resource in storage. * * @param \\Illuminate\\Http\\Request $request * @return \\Illuminate\\Http\\Response */ public function store(Request $request) { // } /** * Display the specified resource. * * @param \\App\\Models\\Libro $libro * @return \\Illuminate\\Http\\Response */ public function show(Libro $libro) { // } /** * Update the specified resource in storage. * * @param \\Illuminate\\Http\\Request $request * @param \\App\\Models\\Libro $libro * @return \\Illuminate\\Http\\Response */ public function update(Request $request, Libro $libro) { // } /** * Remove the specified resource from storage. * * @param \\App\\Models\\Libro $libro * @return \\Illuminate\\Http\\Response */ public function destroy(Libro $libro) { // } } Observemos que se incorpora autom\u00e1ticamente la cl\u00e1usula use para cargar el modelo asociado, que hemos indicado en el par\u00e1metro --model . Adem\u00e1s, los m\u00e9todos show , update y destroy ya vienen con un par\u00e1metro de tipo Libro que facilitar\u00e1 mucho algunas tareas. NOTA : en el caso de versiones anteriores a Laravel 8, hay que tener en cuenta que, por defecto, los modelos se ubican en la carpeta App , por lo que deberemos indicar cualquier subcarpeta donde localizar el modelo cuando creemos el controlador, si es que lo hemos movido a una subcarpeta. Por ejemplo, --model=Models/Libro . Cada una de las funciones del nuevo controlador creado se asocia a uno de los m\u00e9todos REST comentados anteriormente: index se asociar\u00eda con una operaci\u00f3n GET de listado general, para obtener todos los registros (de libros, en este caso) store se asociar\u00eda con una operaci\u00f3n POST, para almacenar los datos que lleguen en la petici\u00f3n (como un nuevo libro, en nuestro caso) show se asociar\u00eda con una operaci\u00f3n GET para obtener el registro asociado a un identificador concreto update se asociar\u00eda con una operaci\u00f3n PUT, para actualizar los datos del registro asociado a un identificador concreto destroy se asociar\u00eda con una operaci\u00f3n DELETE, para eliminar los datos del registro asociado a un identificador concreto 2. Estableciendo las rutas Una vez tenemos el controlador API creado, vamos a definir las rutas asociadas a cada m\u00e9todo del controlador. Si recordamos de sesiones anteriores, pod\u00edamos emplear el m\u00e9todo Route::resource en el archivo routes/web.php para establecer de golpe todas las rutas asociadas a un controlador de recursos. De forma an\u00e1loga, podemos emplear el m\u00e9todo Route::apiResource en el archivo routes/api.php para establecer autom\u00e1ticamente todas las rutas de un controlador de API. A\u00f1adimos esta l\u00ednea en dicho archivo routes/api.php : PHP 1 2 3 use App\\Http\\Controllers\\Api\\LibroController; // ... Route::apiResource('libros', LibroController::class); Las rutas de API (aquellas definidas en el archivo routes/api.php ) por defecto tienen un prefijo api , tal y como se establece en el provider RouteServiceProvider . Por tanto, hemos definido una ruta general api/libros , de forma que todas las subrutas que se deriven de ella llevar\u00e1n a uno u otro m\u00e9todo del controlador de API de libros. Podemos comprobar qu\u00e9 rutas hay activas con este comando: PHP 1 2 3 php artisan route:list // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan route:list Veremos, entre otras, las 5 rutas derivadas del controlador API de libros: PHP 1 2 3 4 5 6 7 8 9 +----------------------------------------------------+ |Method | URI | Name | +----------------------------------------------------+ | GET|HEAD | api/libros | libros.index | | POST | api/libros | libros.store | | GET|HEAD | api/libros/{libro} | libros.show | | PUT|PATCH | api/libros/{libro} | libros.update | | DELETE | api/libros/{libro} | libros.destroy | +----------------------------------------------------+ 3. Servicios GET Vamos a empezar por definir el m\u00e9todo index . En este caso, vamos a obtener el conjunto de libros de la base de datos y devolverlo tal cual: PHP 1 2 3 4 5 public function index() { $libros = Libro::get(); return $libros; } Si accedemos a la ruta api/libros desde el navegador, se activar\u00e1 el m\u00e9todo index que acabamos de implementar, y recibiremos los libros de la base de datos, directamente en formato JSON. NOTA : podemos instalar la extensi\u00f3n JSON formatter para Chrome, y as\u00ed poder ver los datos en formato JSON m\u00e1s organizados y con la sintaxis resaltada, como en la imagen anterior. De una forma similar, podr\u00edamos implementar y probar el m\u00e9todo show , para mostrar los datos de un libro en particular: PHP 1 2 3 4 public function show(Libro $libro) { return $libro; } En este caso, si accedemos a la URI api/libros/1 , obtendremos la informaci\u00f3n del libro con id = 1. Notar que Laravel se encarga autom\u00e1ticamente de buscar el libro por nosotros (hacer la correspondiente operaci\u00f3n find para el id proporcionado). Es lo que se conoce como enlace impl\u00edcito , y es algo que tambi\u00e9n est\u00e1 disponible en los controladores web normales, siempre que los asociemos correctamente con el modelo vinculado. Esto se hace autom\u00e1ticamente si creamos el controlador junto con el modelo, como vimos en la unidad 4, o si usamos el par\u00e1metro --model para asociarlo, como hemos hecho aqu\u00ed. 3.1. M\u00e1s sobre el formato JSON y la respuesta Tras probar los dos servicios anteriores, habr\u00e1s observado que Laravel se encarga de transformar directamente los registros obtenidos a formato JSON cuando los enviamos mediante return , por lo que, en principio, no tenemos por qu\u00e9 preocuparnos de este proceso. Sin embargo, de este modo se escapan algunas cosas a nuestro control. Por ejemplo, y sobre todo, no podemos especificar el c\u00f3digo de estado de la respuesta, que por defecto es 200 si todo ha ido correctamente. Adem\u00e1s, tampoco podemos controlar qu\u00e9 informaci\u00f3n enviar del objeto en cuesti\u00f3n. Si queremos limitar o formatear la informaci\u00f3n a enviar de los objetos que estamos tratando, y que no se env\u00eden todos sus campos sin m\u00e1s, tenemos varias opciones: A\u00f1adir cl\u00e1usulas hidden en los modelos correspondientes, para indicar que esa informaci\u00f3n no debe ser enviada en ning\u00fan caso en ninguna parte de la aplicaci\u00f3n. Es lo que ocurre, por ejemplo, con el campo password del modelo de Usuario : PHP 1 protected $hidden = ['password']; Definir a mano un array con los campos a enviar en el m\u00e9todo del controlador. En el caso de la ficha del libro anterior, si s\u00f3lo queremos enviar el t\u00edtulo y la editorial, podr\u00edamos hacer algo as\u00ed: PHP 1 2 3 4 5 6 7 public function show(Libro $libro) { return [ 'titulo' => $libro->titulo, 'editorial' => $libro->editorial ]; } En el caso de que el paso anterior sea muy costoso (porque el modelo tenga muchos campos, o porque tengamos que hacer lo mismo en varias partes del c\u00f3digo), tambi\u00e9n podemos definir recursos ( resources ), que permiten separar el c\u00f3digo de la informaci\u00f3n a mostrar del propio controlador. Aqu\u00ed pod\u00e9is encontrar informaci\u00f3n al respecto, ya que estos contenidos escapan del alcance de esta sesi\u00f3n. Por otra parte, si queremos a\u00f1adir o modificar m\u00e1s informaci\u00f3n en la respuesta, como el c\u00f3digo de estado, la estructura anterior no nos sirve, ya que siempre se va a enviar un c\u00f3digo 200. Para esto, es conveniente emplear el m\u00e9todo response()->json(...) , que permite especificar como primer par\u00e1metro los datos a enviar, y como segundo par\u00e1metro el c\u00f3digo de estado. Los m\u00e9todos anteriores quedar\u00edan as\u00ed, enviando un c\u00f3digo 200 como respuesta (aunque si se omite el segundo par\u00e1metro, se asume que es 200): PHP 1 2 3 4 5 6 7 8 9 10 public function index() { $libros = Libro::get(); return response()->json($libros, 200);; } // ... public function show(Libro $libro) { return response()->json($libro, 200); } 4. Resto de servicios Veamos ahora c\u00f3mo implementar el resto de servicios (POST, PUT y DELETE). En el caso de la inserci\u00f3n ( POST ), deberemos recibir en la petici\u00f3n los datos del objeto a insertar (un libro, en nuestro ejemplo). Igual que los datos del servidor al cliente se env\u00edan en formato JSON, es de esperar en aplicaciones que siguen la arquitectura REST que los datos del cliente al servidor tambi\u00e9n se env\u00eden en formato JSON. Nuestro m\u00e9todo store , asociado al servicio POST, podr\u00eda quedar de este modo (devolvemos el c\u00f3digo de estado 201, que se utiliza cuando se han insertado elementos nuevos): PHP 1 2 3 4 5 6 7 8 9 10 11 public function store(Request $request) { $libro = new Libro(); $libro->titulo = $request->titulo; $libro->editorial = $request->editorial; $libro->precio = $request->precio; $libro->autor()->associate(Autor::findOrFail($request->autor_id)); $libro->save(); return response()->json($libro, 201); } De forma similar implementar\u00edamos el servicio PUT , a trav\u00e9s del m\u00e9todo update . En este caso devolvemos un c\u00f3digo de estado 200: PHP 1 2 3 4 5 6 7 8 9 10 public function update(Request $request, Libro $libro) { $libro->titulo = $request->titulo; $libro->editorial = $request->editorial; $libro->precio = $request->precio; $libro->autor()->associate(Autor::findOrFail($request->autor_id)); $libro->save(); return response()->json($libro); } Finalmente, para el servicio DELETE , debemos implementar el m\u00e9todo destroy , que podr\u00eda quedar as\u00ed: PHP 1 2 3 4 5 public function destroy(Libro $libro) { $libro->delete(); return response()->json(null, 204); } Notar que devolvemos un c\u00f3digo de estado 204, que indica que no estamos devolviendo contenido (es null ). Por otra parte, es habitual en este tipo de operaciones de borrado devolver en formato JSON el objeto que se ha eliminado, por si acaso se quiere deshacer la operaci\u00f3n en un paso posterior. En este caso, el c\u00f3digo del m\u00e9todo de borrado ser\u00eda as\u00ed: PHP 1 2 3 4 5 public function destroy(Libro $libro) { $libro->delete(); return response()->json($libro); } Como podemos empezar a intuir, probar estos servicios no es tan sencillo como probar servicios de tipo GET, ya que no podemos simplemente teclear una URL en el navegador. Necesitamos un mecanismo para pasarle los datos al servidor en formato JSON, y tambi\u00e9n el m\u00e9todo (POST, PUT o DELETE). Veremos c\u00f3mo en la siguiente secci\u00f3n. 4.1. Validaci\u00f3n de datos A la hora de recibir datos en formato JSON para servicios REST, tambi\u00e9n podemos establecer mecanismos de validaci\u00f3n similares a los vistos para los formularios, a trav\u00e9s de los correspondientes requests . De hecho, en el caso de la biblioteca podemos emplear la clase App\\Http\\Requests\\LibroPost que hicimos en sesiones anteriores, para validar que los datos que llegan tanto a store como a update son correctos. Basta con usar un par\u00e1metro de este tipo en estos m\u00e9todos, en lugar del par\u00e1metro Request que viene por defecto: PHP 1 2 3 4 5 6 7 8 9 public function store(LibroPost $request) { // ... } ... public function update(LibroPost $request, Libro $libro) { // ... } 4.2. Respuestas de error Por otra parte, debemos asegurarnos de que cualquier error que se produzca en la parte de la API devuelva un cotenido en formato JSON, y no una p\u00e1gina web. Por ejemplo, si solicitamos ver la ficha de un libro cuyo id no existe, no deber\u00eda devolvernos una p\u00e1gina de error 404, sino un c\u00f3digo de estado 404 con un mensaje de error en formato JSON. Esto no se cumple por defecto, ya que Laravel est\u00e1 configurado para renderizar una vista con el error producido. Para modificar este comportamiento en versiones anteriores a Laravel 8 , debemos editar el archivo App\\Exceptions\\Handler.php , en concreto su m\u00e9todo render , y hacer algo as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public function render($request, Throwable $exception) { if ($request->is('api*')) { if ($exception instanceof ModelNotFoundException) return response()->json(['error' => 'Elemento no encontrado'], 404); else if ($exception instanceof ValidationException) return response()->json(['error' => 'Datos no v\u00e1lidos'], 400); else if (isset($exception)) return response()->json(['error' => 'Error en la aplicaci\u00f3n: ' . $exception->getMessage()], 500); } // Esta es la \u00fanica instrucci\u00f3n que hay en la versi\u00f3n original return parent::render($request, $exception); } Hemos a\u00f1adido sobre el c\u00f3digo original una cl\u00e1usula if que se centra en las peticiones de tipo api . En este caso, podemos distinguir los distintos tipos de excepciones que se producen. Para nuestro ejemplo distinguimos tres: errores de tipo 404, errores de validaci\u00f3n u otros errores. En todos los casos se devuelve un contenido JSON con el c\u00f3digo de estado y campos adecuados. Si todo es correcto y no hay errores, o si no estamos en rutas api , el comportamiento ser\u00e1 el habitual. En el caso de Laravel 8 y posteriores , el m\u00e9todo a modificar se llama register , dentro de la misma clase App\\Exceptions\\Handler.php . Lo podemos dejar de este modo para hacer algo equivalente a lo anterior: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public function register() { $this->renderable(function (Throwable $exception) { if (request()->is('api*')) { if ($exception instanceof ModelNotFoundException) return response()->json(['error' => 'Recurso no encontrado'], 404); else if ($exception instanceof ValidationException) return response()->json(['error' => 'Datos no v\u00e1lidos'], 400); else if (isset($exception)) return response()->json(['error' => 'Error: ' . $exception->getMessage()], 500); } }); } NOTA : relacionado con el c\u00f3digo anterior, las excepciones que se identifican est\u00e1n en Illuminate\\Database\\Eloquent\\ModelNotFoundException e Illuminate\\Validation\\ValidationException , respectivamente. En algunas versiones de Laravel, la clase base ExceptionHandler realiza algunas conversiones de tipos de excepciones. As\u00ed, por ejemplo, la excepci\u00f3n ModelNotFoundException se convierte a NotFoundHttpException . En este caso, el if anterior que detecta la excepci\u00f3n podr\u00eda no funcionar, ya que el operador instanceof est\u00e1 buscando la excepci\u00f3n equivocada. Una forma algo m\u00e1s completa de detectar si no se encuentra el recurso solicitado ser\u00eda esta (incluimos las cl\u00e1usulas using correspondientes tambi\u00e9n): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 namespace App\\Exceptions; use Illuminate\\Foundation\\Exceptions\\Handler as ExceptionHandler; use Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException; use Illuminate\\Validation\\ValidationException; use Illuminate\\Database\\Eloquent\\ModelNotFoundException; use Throwable; class Handler extends ExceptionHandler { // ... public function register() { $this->renderable(function (Throwable $exception) { if (request()->is('api*')) { if ($exception instanceof ModelNotFoundException || ($exception instanceof NotFoundHttpException && $exception->getPrevious() && $exception->getPrevious() instanceof ModelNotFoundException)) return response()->json(['error' => 'Recurso no encontrado'], 404); else if ($exception instanceof ValidationException) return response()->json(['error' => 'Datos no v\u00e1lidos'], 400); else if (isset($exception)) return response()->json(['error' => 'Error: ' . $exception->getMessage()], 500); } }); } De este modo, detectamos tanto si es una ModelNotFoundException original como si ha sido convertida a NotFoundHttpException . bibliografia Nacho Iborra Baeza .****","title":"ud08 Laravel 6 ServiciosREST"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#conceptos-de-servicios-rest","text":"En esta unidad del curso veremos c\u00f3mo emplear Laravel como proveedor de servicios REST. Comenzaremos detallando algunas cuestiones b\u00e1sicas de la arquitectura cliente-servidor y de los servicios REST, para luego pasar a ver c\u00f3mo desarrollarlos y probarlos con Laravel. A estas alturas todos deber\u00edamos tener claro que cualquier aplicaci\u00f3n web se basa en una arquitectura cliente-servidor, donde un servidor queda a la espera de conexiones de clientes, y los clientes se conectan a los servidores para solicitar ciertos recursos. Sobre esta base, veremos unas breves pinceladas de c\u00f3mo funciona el protocolo HTTP, y en qu\u00e9 consisten los servicios REST.","title":"conceptos de servicios REST"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#conceptos-basicos-del-protocolo-http","text":"Las comunicaciones web entre cliente y servidor se realizan mediante el protocolo HTTP (o HTTPS, en el caso de comunicaciones seguras). En ambos casos, cliente y servidor se env\u00edan cierta informaci\u00f3n est\u00e1ndar, en cada mensaje En cuanto a los clientes , env\u00edan al servidor los datos del recurso que solicitan, junto con cierta informaci\u00f3n adicional, como por ejemplo las cabeceras de petici\u00f3n (informaci\u00f3n relativa al tipo de cliente o navegador, contenido que acepta, etc), y par\u00e1metros adicionales llamados normalmente datos del formulario , puesto que suelen contener la informaci\u00f3n de alg\u00fan formulario que se env\u00eda de cliente a servidor. Por lo que respecta a los servidores , aceptan estas peticiones, las procesan y env\u00edan de vuelta algunos datos relevantes, como un c\u00f3digo de estado (indicando si la petici\u00f3n pudo ser atendida satisfactoriamente o no), cabeceras de respuesta (indicando el tipo de contenido enviado, tama\u00f1o, idioma, etc), y el recurso solicitado propiamente dicho, si todo ha ido correctamente. Este es el mecanismo que hemos estado utilizando hasta ahora a trav\u00e9s de los controladores: reciben la petici\u00f3n concreta del cliente, y env\u00edan una respuesta, que por el momento se ha centrado en renderizar un contenido HTML de una vista. En cuanto a los c\u00f3digos de estado de la respuesta, depende del resultado de la operaci\u00f3n que se haya realizado, \u00e9stos se catalogan en cinco grupos: C\u00f3digos 1XX **: representan informaci\u00f3n sobre una petici\u00f3n normalmente incompleta. No son muy habituales, pero se pueden emplear cuando la petici\u00f3n es muy larga, y se env\u00eda antes una cabecera para comprobar si se puede procesar dicha petici\u00f3n. C\u00f3digos 2xx : representan peticiones que se han podido atender satisfactoriamente. El c\u00f3digo m\u00e1s habitual es el 200 , respuesta est\u00e1ndar para las peticiones que son correctas. Existen otras variantes, como el c\u00f3digo 201 , que se env\u00eda cuando se ha insertado o creado un nuevo recurso en el servidor (una inserci\u00f3n en una base de datos, por ejemplo), o el c\u00f3digo 204 , que indica que la petici\u00f3n se ha atendido bien, pero no se ha devuelto nada como respuesta. C\u00f3digos 3xx : son c\u00f3digos de redirecci\u00f3n, que indican que de alg\u00fan modo la petici\u00f3n original se ha redirigido a otro recurso del servidor. Por ejemplo, el c\u00f3digo 301 indica que el recurso solicitado se ha movido permanentemente a otra URL. El c\u00f3digo 304 indica que el recurso solicitado no ha cambiado desde la \u00faltima vez que se solicit\u00f3, por si se quiere recuperar de la cach\u00e9 local en ese caso. C\u00f3digos 4xx : indican un error por parte del cliente. El m\u00e1s t\u00edpico es el error 404 , que indica que estamos solicitando una URL o recurso que no existe. Pero tambi\u00e9n hay otros habituales, como el 401 (cliente no autorizado), o 400 (los datos de la petici\u00f3n no son correctos, por ejemplo, porque los campos del formulario no sean v\u00e1lidos). C\u00f3digos 5xx : indican un error por parte del servidor. Por ejemplo, el error 500 indica un error interno del servidor, o el 504 , que es un error de timeout por tiempo excesivo en emitir la respuesta. Haremos uso de estos c\u00f3digos de estado en nuestros servicios REST para informar al cliente del tipo de error que se haya producido, o del estado en que se ha podido atender su petici\u00f3n.","title":"Conceptos b\u00e1sicos del protocolo HTTP"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#los-servicios-rest","text":"REST son las siglas de RE *presentational S tate T* ransfer , y designa un estilo de arquitectura de aplicaciones distribuidas basado en HTTP. En un sistema REST, identificamos cada recurso a solicitar con una URI (identificador uniforme de recurso), y definimos un conjunto delimitado de comandos o m\u00e9todos a realizar, que t\u00edpicamente son: GET : para obtener resultados de alg\u00fan tipo (listados completos o filtrados por alguna condici\u00f3n). POST : para realizar inserciones o a\u00f1adir elementos en un conjunto de datos. PUT : para realizar modificaciones o actualizaciones del conjunto de datos. DELETE : para realizar borrados del conjunto de datos. Existen otros tipos de comandos o m\u00e9todos, como por ejemplo PATCH (similar a PUT, pero para cambios parciales), HEAD (para consultar s\u00f3lo el encabezado de la respuesta obtenida), etc. Nos centraremos de momento en los cuatro m\u00e9todos principales anteriores. Por lo tanto, identificando el recurso a solicitar y el comando a aplicarle, el servidor que ofrece esta API REST proporciona una respuesta a esa petici\u00f3n. Esta respuesta t\u00edpicamente viene dada por un mensaje en formato JSON o XML (aunque \u00e9ste \u00faltimo cada vez est\u00e1 m\u00e1s en desuso). Esto permite que las aplicaciones puedan extenderse a distintas plataformas, y acceder a los mismos servicios desde una aplicaci\u00f3n Angular, o una aplicaci\u00f3n de escritorio .NET, o una aplicaci\u00f3n m\u00f3vil en Android, por poner varios ejemplos. ACLARACI\u00d3N : para quienes no conozc\u00e1is la definici\u00f3n de API ( Application Programming Interface ), b\u00e1sicamente es el conjunto de m\u00e9todos o funcionalidades que se ponen a disposici\u00f3n de quienes los quieran utilizar. En este caso, el concepto de API REST hace referencia al conjunto de servicios REST proporcionados por el servidor para los clientes que quieran utilizarlos. Una de las caracter\u00edsticas fundamentales de las API es que son Stateless , lo que quiere decir que las peticiones se hacen y desaparecen, no hay usuarios logueados ni datos que se quedan almacenados. Ejemplos de APIs gratuitas: ChuckNorris IO OMDB PokeAPI - Pokemon RAWg - Videojuegos The Star Wars API Para hacer pruebas con estas APIs podemos implementar el c\u00f3digo para consumirlas o utilizar un cliente especial para el consumo de estos servicios. PostMan Thunder Client ( utilizaremos esta extensi\u00f3n de VS Code para nuestras comprobaciones ). Insomnia Advance REST Client (desde el navegador)","title":"Los servicios REST"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#el-formato-json","text":"JSON son las siglas de JavaScript Object Notation , una sintaxis propia de Javascript para poder representar objetos como cadenas de texto, y poder as\u00ed serializar y enviar informaci\u00f3n de objetos a trav\u00e9s de flujos de datos (archivos de texto, comunicaciones cliente-servidor, etc). Un objeto Javascript se define mediante una serie de propiedades y valores. Por ejemplo, los datos de una persona (como nombre y edad) podr\u00edamos almacenarlos as\u00ed: PHP 1 2 3 4 let persona = { nombre: \"Nacho\", edad: 39 }; Este mismo objeto, convertido a JSON, formar\u00eda una cadena de texto con este contenido: PHP 1 {\"nombre\":\"Nacho\",\"edad\":39} Del mismo modo, si tenemos una colecci\u00f3n (vector) de objetos como \u00e9sta: PHP 1 2 3 4 5 6 let personas = [ { nombre: \"Nacho\", edad: 39}, { nombre: \"Mario\", edad: 4}, { nombre: \"Laura\", edad: 2}, { nombre: \"Nora\", edad: 10} ]; Transformada a JSON sigue la misma sintaxis, pero entre corchetes: PHP 1 2 [{\"nombre\":\"Nacho\",\"edad\":39}, {\"nombre\":\"Mario\",\"edad\":4}, {\"nombre\":\"Laura\",\"edad\":2}, {\"nombre\":\"Nora\",\"edad\":10}] Cuando solicitamos un servicio REST, t\u00edpicamente la respuesta (los datos que nos env\u00eda el servicio) vienen en este formato JSON, de modo que es f\u00e1cilmente serializable y se puede enviar entre cualquier tipo de cliente (m\u00f3vil, web, escritorio) y el servidor.","title":"El formato JSON"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#creacion-de-servicios-rest","text":"Veamos ahora qu\u00e9 pasos dar para construir una API REST en Laravel que d\u00e9 soporte a las operaciones b\u00e1sicas sobre una o varias entidades: consultas (GET), inserciones (POST), modificaciones (PUT) y borrados (DELETE). Emplearemos para ello los denominados controladores de API, que comentamos brevemente en unidades anteriores, al hablar de controladores, y que proporcionan un conjunto de funciones ya definidas para dar soporte a cada uno de estos comandos.","title":"creaci\u00f3n de servicios REST"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#1-definiendo-los-controladores-de-api","text":"Para proporcionar una API REST a los clientes que lo requieran, necesitamos definir un controlador (o controladores) orientados a ofrecer estos servicios REST. Estos controladores en Laravel se denominan de tipo api , como vimos en sesiones previas. Normalmente se definir\u00e1 un controlador API por cada uno de los modelos a los que necesitemos acceder. Vamos a crear uno de prueba para ofrecer una API REST sobre los libros de nuestra aplicaci\u00f3n de biblioteca. Existen diferentes formas de ejecutar el comando de creaci\u00f3n del controlador de API. Aqu\u00ed vamos a mostrar quiz\u00e1 una de las m\u00e1s \u00fatiles: PHP 1 2 3 php artisan make:controller Api/LibroController --api --model=Libro // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan make:controller Api/LibroController --api --model=Libro \u200b PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 namespace App\\Http\\Controllers\\Api; use App\\Http\\Controllers\\Controller; use App\\Models\\Libro; use Illuminate\\Http\\Request; class LibroController extends Controller { /** * Display a listing of the resource. * * @return \\Illuminate\\Http\\Response */ public function index() { // } /** * Store a newly created resource in storage. * * @param \\Illuminate\\Http\\Request $request * @return \\Illuminate\\Http\\Response */ public function store(Request $request) { // } /** * Display the specified resource. * * @param \\App\\Models\\Libro $libro * @return \\Illuminate\\Http\\Response */ public function show(Libro $libro) { // } /** * Update the specified resource in storage. * * @param \\Illuminate\\Http\\Request $request * @param \\App\\Models\\Libro $libro * @return \\Illuminate\\Http\\Response */ public function update(Request $request, Libro $libro) { // } /** * Remove the specified resource from storage. * * @param \\App\\Models\\Libro $libro * @return \\Illuminate\\Http\\Response */ public function destroy(Libro $libro) { // } } Observemos que se incorpora autom\u00e1ticamente la cl\u00e1usula use para cargar el modelo asociado, que hemos indicado en el par\u00e1metro --model . Adem\u00e1s, los m\u00e9todos show , update y destroy ya vienen con un par\u00e1metro de tipo Libro que facilitar\u00e1 mucho algunas tareas. NOTA : en el caso de versiones anteriores a Laravel 8, hay que tener en cuenta que, por defecto, los modelos se ubican en la carpeta App , por lo que deberemos indicar cualquier subcarpeta donde localizar el modelo cuando creemos el controlador, si es que lo hemos movido a una subcarpeta. Por ejemplo, --model=Models/Libro . Cada una de las funciones del nuevo controlador creado se asocia a uno de los m\u00e9todos REST comentados anteriormente: index se asociar\u00eda con una operaci\u00f3n GET de listado general, para obtener todos los registros (de libros, en este caso) store se asociar\u00eda con una operaci\u00f3n POST, para almacenar los datos que lleguen en la petici\u00f3n (como un nuevo libro, en nuestro caso) show se asociar\u00eda con una operaci\u00f3n GET para obtener el registro asociado a un identificador concreto update se asociar\u00eda con una operaci\u00f3n PUT, para actualizar los datos del registro asociado a un identificador concreto destroy se asociar\u00eda con una operaci\u00f3n DELETE, para eliminar los datos del registro asociado a un identificador concreto","title":"1. Definiendo los controladores de API"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#2-estableciendo-las-rutas","text":"Una vez tenemos el controlador API creado, vamos a definir las rutas asociadas a cada m\u00e9todo del controlador. Si recordamos de sesiones anteriores, pod\u00edamos emplear el m\u00e9todo Route::resource en el archivo routes/web.php para establecer de golpe todas las rutas asociadas a un controlador de recursos. De forma an\u00e1loga, podemos emplear el m\u00e9todo Route::apiResource en el archivo routes/api.php para establecer autom\u00e1ticamente todas las rutas de un controlador de API. A\u00f1adimos esta l\u00ednea en dicho archivo routes/api.php : PHP 1 2 3 use App\\Http\\Controllers\\Api\\LibroController; // ... Route::apiResource('libros', LibroController::class); Las rutas de API (aquellas definidas en el archivo routes/api.php ) por defecto tienen un prefijo api , tal y como se establece en el provider RouteServiceProvider . Por tanto, hemos definido una ruta general api/libros , de forma que todas las subrutas que se deriven de ella llevar\u00e1n a uno u otro m\u00e9todo del controlador de API de libros. Podemos comprobar qu\u00e9 rutas hay activas con este comando: PHP 1 2 3 php artisan route:list // \u00f3, si no funciona: // sudo docker-compose exec myapp php artisan route:list Veremos, entre otras, las 5 rutas derivadas del controlador API de libros: PHP 1 2 3 4 5 6 7 8 9 +----------------------------------------------------+ |Method | URI | Name | +----------------------------------------------------+ | GET|HEAD | api/libros | libros.index | | POST | api/libros | libros.store | | GET|HEAD | api/libros/{libro} | libros.show | | PUT|PATCH | api/libros/{libro} | libros.update | | DELETE | api/libros/{libro} | libros.destroy | +----------------------------------------------------+","title":"2. Estableciendo las rutas"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#3-servicios-get","text":"Vamos a empezar por definir el m\u00e9todo index . En este caso, vamos a obtener el conjunto de libros de la base de datos y devolverlo tal cual: PHP 1 2 3 4 5 public function index() { $libros = Libro::get(); return $libros; } Si accedemos a la ruta api/libros desde el navegador, se activar\u00e1 el m\u00e9todo index que acabamos de implementar, y recibiremos los libros de la base de datos, directamente en formato JSON. NOTA : podemos instalar la extensi\u00f3n JSON formatter para Chrome, y as\u00ed poder ver los datos en formato JSON m\u00e1s organizados y con la sintaxis resaltada, como en la imagen anterior. De una forma similar, podr\u00edamos implementar y probar el m\u00e9todo show , para mostrar los datos de un libro en particular: PHP 1 2 3 4 public function show(Libro $libro) { return $libro; } En este caso, si accedemos a la URI api/libros/1 , obtendremos la informaci\u00f3n del libro con id = 1. Notar que Laravel se encarga autom\u00e1ticamente de buscar el libro por nosotros (hacer la correspondiente operaci\u00f3n find para el id proporcionado). Es lo que se conoce como enlace impl\u00edcito , y es algo que tambi\u00e9n est\u00e1 disponible en los controladores web normales, siempre que los asociemos correctamente con el modelo vinculado. Esto se hace autom\u00e1ticamente si creamos el controlador junto con el modelo, como vimos en la unidad 4, o si usamos el par\u00e1metro --model para asociarlo, como hemos hecho aqu\u00ed.","title":"3. Servicios GET"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#31-mas-sobre-el-formato-json-y-la-respuesta","text":"Tras probar los dos servicios anteriores, habr\u00e1s observado que Laravel se encarga de transformar directamente los registros obtenidos a formato JSON cuando los enviamos mediante return , por lo que, en principio, no tenemos por qu\u00e9 preocuparnos de este proceso. Sin embargo, de este modo se escapan algunas cosas a nuestro control. Por ejemplo, y sobre todo, no podemos especificar el c\u00f3digo de estado de la respuesta, que por defecto es 200 si todo ha ido correctamente. Adem\u00e1s, tampoco podemos controlar qu\u00e9 informaci\u00f3n enviar del objeto en cuesti\u00f3n. Si queremos limitar o formatear la informaci\u00f3n a enviar de los objetos que estamos tratando, y que no se env\u00eden todos sus campos sin m\u00e1s, tenemos varias opciones: A\u00f1adir cl\u00e1usulas hidden en los modelos correspondientes, para indicar que esa informaci\u00f3n no debe ser enviada en ning\u00fan caso en ninguna parte de la aplicaci\u00f3n. Es lo que ocurre, por ejemplo, con el campo password del modelo de Usuario : PHP 1 protected $hidden = ['password']; Definir a mano un array con los campos a enviar en el m\u00e9todo del controlador. En el caso de la ficha del libro anterior, si s\u00f3lo queremos enviar el t\u00edtulo y la editorial, podr\u00edamos hacer algo as\u00ed: PHP 1 2 3 4 5 6 7 public function show(Libro $libro) { return [ 'titulo' => $libro->titulo, 'editorial' => $libro->editorial ]; } En el caso de que el paso anterior sea muy costoso (porque el modelo tenga muchos campos, o porque tengamos que hacer lo mismo en varias partes del c\u00f3digo), tambi\u00e9n podemos definir recursos ( resources ), que permiten separar el c\u00f3digo de la informaci\u00f3n a mostrar del propio controlador. Aqu\u00ed pod\u00e9is encontrar informaci\u00f3n al respecto, ya que estos contenidos escapan del alcance de esta sesi\u00f3n. Por otra parte, si queremos a\u00f1adir o modificar m\u00e1s informaci\u00f3n en la respuesta, como el c\u00f3digo de estado, la estructura anterior no nos sirve, ya que siempre se va a enviar un c\u00f3digo 200. Para esto, es conveniente emplear el m\u00e9todo response()->json(...) , que permite especificar como primer par\u00e1metro los datos a enviar, y como segundo par\u00e1metro el c\u00f3digo de estado. Los m\u00e9todos anteriores quedar\u00edan as\u00ed, enviando un c\u00f3digo 200 como respuesta (aunque si se omite el segundo par\u00e1metro, se asume que es 200): PHP 1 2 3 4 5 6 7 8 9 10 public function index() { $libros = Libro::get(); return response()->json($libros, 200);; } // ... public function show(Libro $libro) { return response()->json($libro, 200); }","title":"3.1. M\u00e1s sobre el formato JSON y la respuesta"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#4-resto-de-servicios","text":"Veamos ahora c\u00f3mo implementar el resto de servicios (POST, PUT y DELETE). En el caso de la inserci\u00f3n ( POST ), deberemos recibir en la petici\u00f3n los datos del objeto a insertar (un libro, en nuestro ejemplo). Igual que los datos del servidor al cliente se env\u00edan en formato JSON, es de esperar en aplicaciones que siguen la arquitectura REST que los datos del cliente al servidor tambi\u00e9n se env\u00eden en formato JSON. Nuestro m\u00e9todo store , asociado al servicio POST, podr\u00eda quedar de este modo (devolvemos el c\u00f3digo de estado 201, que se utiliza cuando se han insertado elementos nuevos): PHP 1 2 3 4 5 6 7 8 9 10 11 public function store(Request $request) { $libro = new Libro(); $libro->titulo = $request->titulo; $libro->editorial = $request->editorial; $libro->precio = $request->precio; $libro->autor()->associate(Autor::findOrFail($request->autor_id)); $libro->save(); return response()->json($libro, 201); } De forma similar implementar\u00edamos el servicio PUT , a trav\u00e9s del m\u00e9todo update . En este caso devolvemos un c\u00f3digo de estado 200: PHP 1 2 3 4 5 6 7 8 9 10 public function update(Request $request, Libro $libro) { $libro->titulo = $request->titulo; $libro->editorial = $request->editorial; $libro->precio = $request->precio; $libro->autor()->associate(Autor::findOrFail($request->autor_id)); $libro->save(); return response()->json($libro); } Finalmente, para el servicio DELETE , debemos implementar el m\u00e9todo destroy , que podr\u00eda quedar as\u00ed: PHP 1 2 3 4 5 public function destroy(Libro $libro) { $libro->delete(); return response()->json(null, 204); } Notar que devolvemos un c\u00f3digo de estado 204, que indica que no estamos devolviendo contenido (es null ). Por otra parte, es habitual en este tipo de operaciones de borrado devolver en formato JSON el objeto que se ha eliminado, por si acaso se quiere deshacer la operaci\u00f3n en un paso posterior. En este caso, el c\u00f3digo del m\u00e9todo de borrado ser\u00eda as\u00ed: PHP 1 2 3 4 5 public function destroy(Libro $libro) { $libro->delete(); return response()->json($libro); } Como podemos empezar a intuir, probar estos servicios no es tan sencillo como probar servicios de tipo GET, ya que no podemos simplemente teclear una URL en el navegador. Necesitamos un mecanismo para pasarle los datos al servidor en formato JSON, y tambi\u00e9n el m\u00e9todo (POST, PUT o DELETE). Veremos c\u00f3mo en la siguiente secci\u00f3n.","title":"4. Resto de servicios"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#41-validacion-de-datos","text":"A la hora de recibir datos en formato JSON para servicios REST, tambi\u00e9n podemos establecer mecanismos de validaci\u00f3n similares a los vistos para los formularios, a trav\u00e9s de los correspondientes requests . De hecho, en el caso de la biblioteca podemos emplear la clase App\\Http\\Requests\\LibroPost que hicimos en sesiones anteriores, para validar que los datos que llegan tanto a store como a update son correctos. Basta con usar un par\u00e1metro de este tipo en estos m\u00e9todos, en lugar del par\u00e1metro Request que viene por defecto: PHP 1 2 3 4 5 6 7 8 9 public function store(LibroPost $request) { // ... } ... public function update(LibroPost $request, Libro $libro) { // ... }","title":"4.1. Validaci\u00f3n de datos"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#42-respuestas-de-error","text":"Por otra parte, debemos asegurarnos de que cualquier error que se produzca en la parte de la API devuelva un cotenido en formato JSON, y no una p\u00e1gina web. Por ejemplo, si solicitamos ver la ficha de un libro cuyo id no existe, no deber\u00eda devolvernos una p\u00e1gina de error 404, sino un c\u00f3digo de estado 404 con un mensaje de error en formato JSON. Esto no se cumple por defecto, ya que Laravel est\u00e1 configurado para renderizar una vista con el error producido. Para modificar este comportamiento en versiones anteriores a Laravel 8 , debemos editar el archivo App\\Exceptions\\Handler.php , en concreto su m\u00e9todo render , y hacer algo as\u00ed: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 public function render($request, Throwable $exception) { if ($request->is('api*')) { if ($exception instanceof ModelNotFoundException) return response()->json(['error' => 'Elemento no encontrado'], 404); else if ($exception instanceof ValidationException) return response()->json(['error' => 'Datos no v\u00e1lidos'], 400); else if (isset($exception)) return response()->json(['error' => 'Error en la aplicaci\u00f3n: ' . $exception->getMessage()], 500); } // Esta es la \u00fanica instrucci\u00f3n que hay en la versi\u00f3n original return parent::render($request, $exception); } Hemos a\u00f1adido sobre el c\u00f3digo original una cl\u00e1usula if que se centra en las peticiones de tipo api . En este caso, podemos distinguir los distintos tipos de excepciones que se producen. Para nuestro ejemplo distinguimos tres: errores de tipo 404, errores de validaci\u00f3n u otros errores. En todos los casos se devuelve un contenido JSON con el c\u00f3digo de estado y campos adecuados. Si todo es correcto y no hay errores, o si no estamos en rutas api , el comportamiento ser\u00e1 el habitual. En el caso de Laravel 8 y posteriores , el m\u00e9todo a modificar se llama register , dentro de la misma clase App\\Exceptions\\Handler.php . Lo podemos dejar de este modo para hacer algo equivalente a lo anterior: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 public function register() { $this->renderable(function (Throwable $exception) { if (request()->is('api*')) { if ($exception instanceof ModelNotFoundException) return response()->json(['error' => 'Recurso no encontrado'], 404); else if ($exception instanceof ValidationException) return response()->json(['error' => 'Datos no v\u00e1lidos'], 400); else if (isset($exception)) return response()->json(['error' => 'Error: ' . $exception->getMessage()], 500); } }); } NOTA : relacionado con el c\u00f3digo anterior, las excepciones que se identifican est\u00e1n en Illuminate\\Database\\Eloquent\\ModelNotFoundException e Illuminate\\Validation\\ValidationException , respectivamente. En algunas versiones de Laravel, la clase base ExceptionHandler realiza algunas conversiones de tipos de excepciones. As\u00ed, por ejemplo, la excepci\u00f3n ModelNotFoundException se convierte a NotFoundHttpException . En este caso, el if anterior que detecta la excepci\u00f3n podr\u00eda no funcionar, ya que el operador instanceof est\u00e1 buscando la excepci\u00f3n equivocada. Una forma algo m\u00e1s completa de detectar si no se encuentra el recurso solicitado ser\u00eda esta (incluimos las cl\u00e1usulas using correspondientes tambi\u00e9n): PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 namespace App\\Exceptions; use Illuminate\\Foundation\\Exceptions\\Handler as ExceptionHandler; use Symfony\\Component\\HttpKernel\\Exception\\NotFoundHttpException; use Illuminate\\Validation\\ValidationException; use Illuminate\\Database\\Eloquent\\ModelNotFoundException; use Throwable; class Handler extends ExceptionHandler { // ... public function register() { $this->renderable(function (Throwable $exception) { if (request()->is('api*')) { if ($exception instanceof ModelNotFoundException || ($exception instanceof NotFoundHttpException && $exception->getPrevious() && $exception->getPrevious() instanceof ModelNotFoundException)) return response()->json(['error' => 'Recurso no encontrado'], 404); else if ($exception instanceof ValidationException) return response()->json(['error' => 'Datos no v\u00e1lidos'], 400); else if (isset($exception)) return response()->json(['error' => 'Error: ' . $exception->getMessage()], 500); } }); } De este modo, detectamos tanto si es una ModelNotFoundException original como si ha sido convertida a NotFoundHttpException .","title":"4.2. Respuestas de error"},{"location":"ud08/ud08_Laravel_6_ServiciosREST/#bibliografia","text":"Nacho Iborra Baeza .****","title":"bibliografia"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/","text":"unit: unidad did\u00e1ctica 8 title: Laravel - servicios REST (actividades) language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets ejemplo API Rest en tabla productos crear tabla productos crear controlador ProductoController c\u00f3mo funciona la API REST listar todos los productos listar un producto en concreto introducir producto nuevo actualizar un producto existente eliminar un producto ejercicios propuestos Ejercicio 1 bibliografia El uso de estos materiales est\u00e1 sujeto a una licencia Creative Commons CC BY-NC . Material extra\u00eddo de https://nachoiborraies.github.io/laravel/ ejemplo API Rest en tabla productos crear tabla productos Antes de crear nuestra API en tabla Productos deberemos tener dicha tabla migrada en nuestro sistema. Para ello: Crear migraci\u00f3n para la tabla productos : Recuerda que el nombre de la migraci\u00f3n contiene palabras reservadas para como son create y table . PHP 1 2 3 php artisan make:migration create_productos_table # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan make:migration create_productos_table A\u00f1adir al fichero generado (en la carpeta migrations y en el ejemplo anterior 2024_01_08_102832_create_productos_table.php ) el resto de campos que se requieran en la tabla productos : PHP 1 2 3 4 5 6 7 8 9 10 public function up(): void { Schema::create('productos', function (Blueprint $table) { $table->id(); $table->string('nombre'); $table->text('descripcion'); $table->decimal('precio', 8, 2); $table->timestamps(); }); } Ejecutar migraci\u00f3n: PHP 1 2 3 php artisan migrate # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan migrate Crear un seeder para realizar una carga de datos: Introducimos informaci\u00f3n en esta tabla nueva, creando un fichero en la carpeta database/seeders de nombre ProductoSeeder.php : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <?php namespace Database\\Seeders ; use Illuminate\\Database\\Seeder ; use Illuminate\\Support\\Facades\\DB ; class ProductoSeeder extends Seeder { public function run () { // insertar datos prueba DB :: table ( 'productos' ) -> insert ([ 'nombre' => 'producto prueba 1' , 'descripcion' => 'esta es una descripci\u00f3n para el producto prueba 1' , 'precio' => 19.99 , ]); DB :: table ( 'productos' ) -> insert ([ 'nombre' => 'producto prueba 2' , 'descripcion' => 'esta es una descripci\u00f3n para el producto prueba 2' , 'precio' => 29.99 , ]); } } Ejecutar el seeder : PHP 1 2 3 php artisan db:seed --class=ProductoSeeder # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan db:seed --class=ProductoSeeder crear controlador ProductoController Crear un controlador donde establezcamos los m\u00e9todos que nosotros queramos realizar a la hora de trabajar con los datos. Crear desde consola un controlador para la tabla productos : Bash 1 2 3 php artisan make:controller ProductoController # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan make:controller ProductoController La estructura de este archivo es un poco diferente a los controladores que ya hemos visto anteriormente. Ahora tenemos los siguientes m\u00e9todos creados de manera autom\u00e1tica: index() normalmente para listar (en nuestro caso los chollos). create() para crear plantillas (no lo vamos a usar). store() para guardar los datos que pasemos a la API. update() para actualizar un dato ya existente en la BD. delete() para eliminar un dato ya existente en la BD. Como vamos a conectarnos a un modelo para traer la informaci\u00f3n de dicho modelo a\u00f1adimos mediante use . Tambi\u00e9n creamos la funci\u00f3n index para listar todos los elementos de la tabla (en este caso productos ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace App\\Http\\Controllers ; use Illuminate\\Http\\Request ; use App\\Models\\Producto ; // <-- esta linea class ProductoController extends Controller { public function index (){ return response () -> json ( Producto :: all ()); } } CUIDADO CON EL RETURN porque ahora no estamos devolviendo una vista sino un array de datos en formato JSON. Crear un modelo en la carpeta Models de nombre Producto.php : PHP 1 2 3 4 5 6 7 8 <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Producto extends Model { protected $fillable = [ 'nombre' , 'descripcion' , 'precio' ]; } Ir a fichero web.php (en la carpeta routes ) y colocar nuestras rutas: PHP 1 2 3 4 5 6 7 // cargar el recurso del controlador ProductoController use App\\Http\\Controllers\\ProductoController Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); }); La funci\u00f3n anterior index nos devuelve todos los productos. Pero, qu\u00e9 pasa si queremos un producto en cuesti\u00f3n: En ProductoController.php a\u00f1adimos otra funci\u00f3n (show) en la que se le pasa por par\u00e1materos el id : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace App\\Http\\Controllers ; use Illuminate\\Http\\Request ; use App\\Models\\Producto ; // <-- esta linea class ProductoController extends Controller { public function index (){ return response () -> json ( Producto :: all ()); } public function show ( $id ){ return response () -> json ( Producto :: find ( $id )); } } En web.php a\u00f1adimos otra ruta en nuestro grupo: PHP 1 2 3 4 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); }); Para introducir datos utilizaremos el m\u00e9todo store : a) en ProductoController.php : PHP 1 2 3 4 public function store(Request $request){ $producto = Producto::create($request->all()); return response()->json($producto, 201); } b) en web.php : PHP 1 2 3 4 5 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); }); Para actualizar datos de un producto, utilizaremos el m\u00e9todo update : a) en ProductoController.php : PHP 1 2 3 4 5 6 public function update(Request $request, $id){ $producto = Producto::findOrFail($id); $producto -> update($request->all()); return response()->json($producto, 200); } b) en web.php : PHP 1 2 3 4 5 6 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); Route::put('/{id}',[ProductoController::class, 'update']); }); Y para eliminar un producto, el m\u00e9todo delete : a) en ProductoController.php : PHP 1 2 3 4 5 public function destroy($id){ Producto::findOrFail($id)->delete(); return response()->json(null, 204); } b) en web.php : PHP 1 2 3 4 5 6 7 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); Route::put('/{id}',[ProductoController::class, 'update']); Route::delete('/{id}',[ProductoController::class, 'destroy']); }); c\u00f3mo funciona la API REST Para ello vamos a utilizar un software que es una extensi\u00f3n de Visual Studio Code, de nombre Thunder Client : listar todos los productos listar un producto en concreto introducir producto nuevo Si realizamos una nueva petici\u00f3n (new request) con m\u00e9todo post y pasando (desde body y en json ) un nuevo producto, va a mostrarnos un error . Esto se debe a que Laravel, por sus m\u00e9todos de seguridad, necesita un token llamado csrf . Ya que, ahora mismo, estamos realizando pruebas, vamos a indicarle a Laravel que excluya la URL en cuesti\u00f3n de la verificaci\u00f3n. Para ello accedemos al fichero VerifyCsrfToken.php de la carpeta app\\Http\\Middleware : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php namespace App\\Http\\Middleware ; use Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken as Middleware ; class VerifyCsrfToken extends Middleware { /** * The URIs that should be excluded from CSRF verification. * * @var array<int, string> */ protected $except = [ \"http://0.0.0.0:8000/productos\" , // <-- esta excepci\u00f3n ]; } actualizar un producto existente Recuerda a\u00f1adir al fichero VerifyCsrfToken.php de la carpeta app\\Http\\Middleware la excepci\u00f3n: PHP 1 2 3 4 5 6 7 <?php // [..] protected $except = [ \"http://0.0.0.0:8000/productos\" , \"http://0.0.0.0:8000/productos/3\" , // <-- esta nueva excepci\u00f3n ]; } eliminar un producto ejercicios propuestos Ejercicio 1 Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Crea un controlador de tipo api llamado PostController en la carpeta App\\Http\\Controllers\\Api , asociado al modelo Post que ya tenemos de sesiones previas. Rellena los m\u00e9todos index , show , store , update y destroy para que, respectivamente, hagan lo siguiente: index deber\u00e1 devolver en formato JSON el listado de todos los posts, con un c\u00f3digo 200 show deber\u00e1 devolver la informaci\u00f3n del post que recibe, con un c\u00f3digo 200 store deber\u00e1 insertar un nuevo post con los datos recibidos, con un c\u00f3digo 201, y utilizando el validador de posts que hiciste en la sesi\u00f3n 6. Para el usuario creador del post, p\u00e1sale como par\u00e1metro JSON un usuario cualquiera de la base de datos. update deber\u00e1 modificar los campos del post recibidos, con un c\u00f3digo 200, y empleando tambi\u00e9n el validador de posts que hiciste en la sesi\u00f3n 6. destroy deber\u00e1 eliminar el post recibido, devolviendo null con un c\u00f3digo 204 Crea una colecci\u00f3n en Thunder Client llamada Blog que defina una petici\u00f3n para cada uno de los cinco servicios implementados. Comprueba que funcionan correctamente y exporta la colecci\u00f3n a un archivo. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. A\u00f1ade dentro tambi\u00e9n la colecci\u00f3n Thunder Client para probar los servicios. Renombra el archivo comprimido a blog_08b.zip . bibliografia Nacho Iborra Baeza .****","title":"ud08 Laravel 6 ServiciosREST actividades"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#ejemplo-api-rest-en-tabla-productos","text":"","title":"ejemplo API Rest en tabla productos"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#crear-tabla-productos","text":"Antes de crear nuestra API en tabla Productos deberemos tener dicha tabla migrada en nuestro sistema. Para ello: Crear migraci\u00f3n para la tabla productos : Recuerda que el nombre de la migraci\u00f3n contiene palabras reservadas para como son create y table . PHP 1 2 3 php artisan make:migration create_productos_table # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan make:migration create_productos_table A\u00f1adir al fichero generado (en la carpeta migrations y en el ejemplo anterior 2024_01_08_102832_create_productos_table.php ) el resto de campos que se requieran en la tabla productos : PHP 1 2 3 4 5 6 7 8 9 10 public function up(): void { Schema::create('productos', function (Blueprint $table) { $table->id(); $table->string('nombre'); $table->text('descripcion'); $table->decimal('precio', 8, 2); $table->timestamps(); }); } Ejecutar migraci\u00f3n: PHP 1 2 3 php artisan migrate # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan migrate Crear un seeder para realizar una carga de datos: Introducimos informaci\u00f3n en esta tabla nueva, creando un fichero en la carpeta database/seeders de nombre ProductoSeeder.php : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <?php namespace Database\\Seeders ; use Illuminate\\Database\\Seeder ; use Illuminate\\Support\\Facades\\DB ; class ProductoSeeder extends Seeder { public function run () { // insertar datos prueba DB :: table ( 'productos' ) -> insert ([ 'nombre' => 'producto prueba 1' , 'descripcion' => 'esta es una descripci\u00f3n para el producto prueba 1' , 'precio' => 19.99 , ]); DB :: table ( 'productos' ) -> insert ([ 'nombre' => 'producto prueba 2' , 'descripcion' => 'esta es una descripci\u00f3n para el producto prueba 2' , 'precio' => 29.99 , ]); } } Ejecutar el seeder : PHP 1 2 3 php artisan db:seed --class=ProductoSeeder # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan db:seed --class=ProductoSeeder","title":"crear tabla productos"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#crear-controlador-productocontroller","text":"Crear un controlador donde establezcamos los m\u00e9todos que nosotros queramos realizar a la hora de trabajar con los datos. Crear desde consola un controlador para la tabla productos : Bash 1 2 3 php artisan make:controller ProductoController # \u00f3, si no funciona, probar: # sudo docker-compose exec myapp php artisan make:controller ProductoController La estructura de este archivo es un poco diferente a los controladores que ya hemos visto anteriormente. Ahora tenemos los siguientes m\u00e9todos creados de manera autom\u00e1tica: index() normalmente para listar (en nuestro caso los chollos). create() para crear plantillas (no lo vamos a usar). store() para guardar los datos que pasemos a la API. update() para actualizar un dato ya existente en la BD. delete() para eliminar un dato ya existente en la BD. Como vamos a conectarnos a un modelo para traer la informaci\u00f3n de dicho modelo a\u00f1adimos mediante use . Tambi\u00e9n creamos la funci\u00f3n index para listar todos los elementos de la tabla (en este caso productos ): PHP 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace App\\Http\\Controllers ; use Illuminate\\Http\\Request ; use App\\Models\\Producto ; // <-- esta linea class ProductoController extends Controller { public function index (){ return response () -> json ( Producto :: all ()); } } CUIDADO CON EL RETURN porque ahora no estamos devolviendo una vista sino un array de datos en formato JSON. Crear un modelo en la carpeta Models de nombre Producto.php : PHP 1 2 3 4 5 6 7 8 <?php namespace App\\Models ; use Illuminate\\Database\\Eloquent\\Model ; class Producto extends Model { protected $fillable = [ 'nombre' , 'descripcion' , 'precio' ]; } Ir a fichero web.php (en la carpeta routes ) y colocar nuestras rutas: PHP 1 2 3 4 5 6 7 // cargar el recurso del controlador ProductoController use App\\Http\\Controllers\\ProductoController Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); }); La funci\u00f3n anterior index nos devuelve todos los productos. Pero, qu\u00e9 pasa si queremos un producto en cuesti\u00f3n: En ProductoController.php a\u00f1adimos otra funci\u00f3n (show) en la que se le pasa por par\u00e1materos el id : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace App\\Http\\Controllers ; use Illuminate\\Http\\Request ; use App\\Models\\Producto ; // <-- esta linea class ProductoController extends Controller { public function index (){ return response () -> json ( Producto :: all ()); } public function show ( $id ){ return response () -> json ( Producto :: find ( $id )); } } En web.php a\u00f1adimos otra ruta en nuestro grupo: PHP 1 2 3 4 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); }); Para introducir datos utilizaremos el m\u00e9todo store : a) en ProductoController.php : PHP 1 2 3 4 public function store(Request $request){ $producto = Producto::create($request->all()); return response()->json($producto, 201); } b) en web.php : PHP 1 2 3 4 5 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); }); Para actualizar datos de un producto, utilizaremos el m\u00e9todo update : a) en ProductoController.php : PHP 1 2 3 4 5 6 public function update(Request $request, $id){ $producto = Producto::findOrFail($id); $producto -> update($request->all()); return response()->json($producto, 200); } b) en web.php : PHP 1 2 3 4 5 6 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); Route::put('/{id}',[ProductoController::class, 'update']); }); Y para eliminar un producto, el m\u00e9todo delete : a) en ProductoController.php : PHP 1 2 3 4 5 public function destroy($id){ Producto::findOrFail($id)->delete(); return response()->json(null, 204); } b) en web.php : PHP 1 2 3 4 5 6 7 Route::prefix('productos')->group(function(){ Route::get('/',[ProductoController::class, 'index']); Route::get('/{id}',[ProductoController::class, 'show']); Route::post('/',[ProductoController::class, 'store']); Route::put('/{id}',[ProductoController::class, 'update']); Route::delete('/{id}',[ProductoController::class, 'destroy']); });","title":"crear controlador ProductoController"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#como-funciona-la-api-rest","text":"Para ello vamos a utilizar un software que es una extensi\u00f3n de Visual Studio Code, de nombre Thunder Client :","title":"c\u00f3mo funciona la API REST"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#listar-todos-los-productos","text":"","title":"listar todos los productos"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#listar-un-producto-en-concreto","text":"","title":"listar un producto en concreto"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#introducir-producto-nuevo","text":"Si realizamos una nueva petici\u00f3n (new request) con m\u00e9todo post y pasando (desde body y en json ) un nuevo producto, va a mostrarnos un error . Esto se debe a que Laravel, por sus m\u00e9todos de seguridad, necesita un token llamado csrf . Ya que, ahora mismo, estamos realizando pruebas, vamos a indicarle a Laravel que excluya la URL en cuesti\u00f3n de la verificaci\u00f3n. Para ello accedemos al fichero VerifyCsrfToken.php de la carpeta app\\Http\\Middleware : PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php namespace App\\Http\\Middleware ; use Illuminate\\Foundation\\Http\\Middleware\\VerifyCsrfToken as Middleware ; class VerifyCsrfToken extends Middleware { /** * The URIs that should be excluded from CSRF verification. * * @var array<int, string> */ protected $except = [ \"http://0.0.0.0:8000/productos\" , // <-- esta excepci\u00f3n ]; }","title":"introducir producto nuevo"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#actualizar-un-producto-existente","text":"Recuerda a\u00f1adir al fichero VerifyCsrfToken.php de la carpeta app\\Http\\Middleware la excepci\u00f3n: PHP 1 2 3 4 5 6 7 <?php // [..] protected $except = [ \"http://0.0.0.0:8000/productos\" , \"http://0.0.0.0:8000/productos/3\" , // <-- esta nueva excepci\u00f3n ]; }","title":"actualizar un producto existente"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#eliminar-un-producto","text":"","title":"eliminar un producto"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#ejercicios-propuestos","text":"","title":"ejercicios propuestos"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#ejercicio-1","text":"Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Crea un controlador de tipo api llamado PostController en la carpeta App\\Http\\Controllers\\Api , asociado al modelo Post que ya tenemos de sesiones previas. Rellena los m\u00e9todos index , show , store , update y destroy para que, respectivamente, hagan lo siguiente: index deber\u00e1 devolver en formato JSON el listado de todos los posts, con un c\u00f3digo 200 show deber\u00e1 devolver la informaci\u00f3n del post que recibe, con un c\u00f3digo 200 store deber\u00e1 insertar un nuevo post con los datos recibidos, con un c\u00f3digo 201, y utilizando el validador de posts que hiciste en la sesi\u00f3n 6. Para el usuario creador del post, p\u00e1sale como par\u00e1metro JSON un usuario cualquiera de la base de datos. update deber\u00e1 modificar los campos del post recibidos, con un c\u00f3digo 200, y empleando tambi\u00e9n el validador de posts que hiciste en la sesi\u00f3n 6. destroy deber\u00e1 eliminar el post recibido, devolviendo null con un c\u00f3digo 204 Crea una colecci\u00f3n en Thunder Client llamada Blog que defina una petici\u00f3n para cada uno de los cinco servicios implementados. Comprueba que funcionan correctamente y exporta la colecci\u00f3n a un archivo. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. A\u00f1ade dentro tambi\u00e9n la colecci\u00f3n Thunder Client para probar los servicios. Renombra el archivo comprimido a blog_08b.zip .","title":"Ejercicio 1"},{"location":"ud08/ud08_Laravel_6_ServiciosREST_actividades/#bibliografia","text":"Nacho Iborra Baeza .****","title":"bibliografia"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/","text":"unit: unidad did\u00e1ctica 8 title: Laravel - autenticaci\u00f3n de usuarios language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets autenticaci\u00f3n basada en sesiones 1. Configuraci\u00f3n general de la autenticaci\u00f3n 1.1. El modelo o la tabla de usuarios 2. A\u00f1adir autenticaci\u00f3n a un proyecto 2.1. El formulario de login 2.2. El controlador de login 2.3. Las rutas asociadas 2.3.1. Redirecci\u00f3n en caso de error 2.4. Proteger las rutas de acceso restringido 2.5. Detectar en las vistas al usuario autenticado 2.6. Implementaci\u00f3n del logout 3. Definir roles. Uso de middleware 3.1. Middleware con m\u00e1s de un par\u00e1metro 3.2. Sobre el concepto de middleware 4. M\u00e1s informaci\u00f3n autenticaci\u00f3n basada en tokens 1. Fundamentos de la autenticaci\u00f3n basada en tokens 2. Alternativas para la implementaci\u00f3n de la autenticaci\u00f3n basada en tokens 2.1. Preparando el ejemplo base 3. Autenticaci\u00f3n basada en tokens nativa 3.1. Configuraci\u00f3n b\u00e1sica 3.2. Protecci\u00f3n de rutas 4. Autenticaci\u00f3n basada en tokens usando Laravel Sanctum 4.4.1. Configuraci\u00f3n de Sanctum 4.2. Protecci\u00f3n de rutas 5. Prueba de autenticaci\u00f3n basada en tokens bibliografia El uso de estos materiales est\u00e1 sujeto a una licencia Creative Commons CC BY-NC . Material extra\u00eddo de https://nachoiborraies.github.io/laravel/ autenticaci\u00f3n basada en sesiones En esta sesi\u00f3n veremos c\u00f3mo incluir mecanismos de autenticaci\u00f3n en nuestros proyectos Laravel. Partiremos de la base de un proyecto ya creado (como el ejemplo de la biblioteca que venimos haciendo de sesiones anteriores) e incorporaremos paso a paso los elementos necesarios para autenticar usuarios. 1. Configuraci\u00f3n general de la autenticaci\u00f3n En el archivo config/auth.php se dispone de algunas opciones de configuraci\u00f3n generales de autenticaci\u00f3n. Esta autenticaci\u00f3n en Laravel se apoya en dos elementos: los guards y los providers . Los *guards* son mecanismos que definen c\u00f3mo se van a autenticar los usuarios para cada petici\u00f3n. El mecanismo m\u00e1s habitual es mediante sesiones, donde se guarda la informaci\u00f3n del usuario autenticado en la sesi\u00f3n, aunque por defecto tambi\u00e9n se habilita la autenticaci\u00f3n mediante tokens. Los providers* indican c\u00f3mo se van a obtener los usuarios de la base de datos para comprobar la autenticaci\u00f3n. Las opciones habilitadas por defecto son mediante Eloquent (y el modelo de usuarios que tengamos definido), o mediante query builder*, consultando directamente la tabla correspondiente de usuarios. Deberemos modificar en el archivo la referencia a la tabla donde almacenaremos los usuarios (por defecto se hace referencia a una tabla llamada users ) y/o al modelo asociado (por defecto, la clase User ). As\u00ed que convendr\u00e1 modificar los nombres de estos dos elementos en la secci\u00f3n providers , as\u00ed como la ubicaci\u00f3n ( namespace ) del modelo de usuario, si procede. Por ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 // ... 'providers' => [ 'users' => [ 'driver' => 'eloquent', 'model' => App\\Models\\Usuario::class, ], // 'users' => [ // 'driver' => 'database', // 'table' => 'usuarios', // ], ], Notar que la secci\u00f3n providers dispone de dos proveedores de autenticaci\u00f3n: uno (el que est\u00e1 habilitado) est\u00e1 basado en Eloquent, y hace uso del modelo de usuarios que hayamos definido. El otro (que aparece comentado) no utiliza Eloquent, sino el query builder contra la propia base de datos. Si preferimos esta segunda opci\u00f3n, deberemos comentar la primera y dejar habilitada la segunda. Tambi\u00e9n es posible dejar habilitados m\u00faltiples providers , cada uno con un nombre diferente, y asignarlo a m\u00faltiples guards . 1.1. El modelo o la tabla de usuarios Si elegimos el provider basado en Eloquent, deberemos tener un modelo de usuarios al que acceder. En el caso de nuestra aplicaci\u00f3n de biblioteca (o el ejercicio del blog), disponemos ya de un modelo creado en App\\Models\\Usuario , por lo que el ejemplo anterior nos servir\u00eda para establecer este modelo como el modelo de usuarios por defecto. Si optamos por utilizar el query builder en lugar de Eloquent, deberemos tener una tabla en la base de datos donde est\u00e9n los datos de los usuarios. En nuestro caso, tambi\u00e9n disponemos de esa tabla usuarios , por lo que podr\u00edamos emplear esta otra opci\u00f3n para autenticar usuarios si quisi\u00e9ramos. No obstante, nos valdremos de Eloquent para la autenticaci\u00f3n. En cualquier caso, como veremos a continuaci\u00f3n, ser\u00e1 conveniente que los passwords de los usuarios est\u00e9n encriptados mediante bcrypt , que es el mecanismo de encriptaci\u00f3n por defecto que utiliza Laravel. Vamos a crear un nuevo seeder en nuestra aplicaci\u00f3n de biblioteca para crear un usuario con un login y password predefinidos. Llamamos al seeder UsuariosSeeder : PHP 1 php artisan make:seeder UsuariosSeeder En el m\u00e9todo run del nuevo seeder a\u00f1adiremos un nuevo usuario con login admin y password admin (encriptado usando bcrypt ): PHP 1 2 3 4 5 6 7 public function run() { $usuario = new Usuario(); $usuario->login = 'admin'; $usuario->password = bcrypt('admin'); $usuario->save(); } Finalmente, cargamos este nuevo seeder en la base de datos, o bien con una migraci\u00f3n completa nueva ( php artisan migrate:fresh --seed ), o bien ejecutando s\u00f3lo el seeder con esto: PHP 1 php artisan db:seed --class=UsuariosSeeder 2. A\u00f1adir autenticaci\u00f3n a un proyecto Para a\u00f1adir autenticaci\u00f3n a un proyecto Laravel ya existente que no disponga de estos mecanismos, seguiremos estos pasos: Definiremos un formulario de login. Definiremos un nuevo controlador que se encargue de gestionar el login: tanto de mostrar el formulario cuando el usuario no est\u00e9 autenticado como de validar sus credenciales cuando las env\u00ede. A\u00f1adiremos las rutas pertinentes en el archivo routes/web.php tanto para el formulario de login como para la autenticaci\u00f3n posterior. Protegeremos las rutas que sean de acceso restringido. Opcionalmente, podemos a\u00f1adir tambi\u00e9n una opci\u00f3n de logout . 2.1. El formulario de login Vamos a definir un formulario de login en la vista resources/views/auth/login.blade.php , para que el usuario especifique su login y su password . Tambi\u00e9n dejaremos una zona para mostrar un posible mensaje de error si la autenticaci\u00f3n no ha sido exitosa: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 @extends('plantilla') @section('titulo', 'Login') @section('contenido') <h1>Login</h1> @if (!empty($error)) <div class=\"text-danger\"> {{ $error }} </div> @endif <form action=\"{{ route('login') }}\" method=\"POST\"> @csrf <div class=\"form-group\"> <label for=\"login\">Login:</label> <input type=\"text\" class=\"form-control\" name=\"login\" id=\"login\" /> </div> <div class=\"form-group\"> <label for=\"password\">Password:</label> <input type=\"password\" class=\"form-control\" name=\"password\" id=\"password\" /> </div> <input type=\"submit\" class=\"btn btn-dark btn-block\" name=\"enviar\" value=\"Enviar\" /> </form> @endsection 2.2. El controlador de login Crearemos un nuevo controlador que se encargue de gestionar toda la autenticaci\u00f3n: PHP 1 php artisan make:controller LoginController Dentro, definimos una funci\u00f3n que se encargar\u00e1 de mostrar el formulario anterior: PHP 1 2 3 4 public function loginForm() { return view('auth.login'); } Y a\u00f1adiremos una segunda funci\u00f3n que se encargue de validar las credenciales enviadas por el usuario. Para esto, haremos uso del facade de autenticaci\u00f3n, existente en Illuminate\\Support\\Facades\\Auth . Recuerda de sesiones previas que un facade es b\u00e1sicamente un elemento que proporciona acceso a una serie de m\u00e9todos est\u00e1ticos de utilidad, en este caso para autenticar usuarios. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 namespace App\\Http\\Controllers; use Illuminate\\Http\\Request; use Illuminate\\Support\\Facades\\Auth; class LoginController extends Controller { // ... public function login(Request $request) { $credenciales = $request->only('login', 'password'); if (Auth::attempt($credenciales)) { // Autenticaci\u00f3n exitosa return redirect()->intended(route('libros.index')); } else { $error = 'Usuario incorrecto'; return view('auth.login', compact('error')); } } } El m\u00e9todo attempt acepta una serie de pares clave-valor como primer par\u00e1metro. En este caso, le pasamos un s\u00f3lo par formado por el login (o el e-mail, dependiendo del campo que usemos para autenticar) y el password recibidos en la petici\u00f3n. Esto servir\u00e1 para localizar al usuario por la clave (login), y comprobar si tiene el valor asociado (el password). En el caso de los passwords, Laravel autom\u00e1ticamente los encripta en formato bcrypt , por lo que debemos cerciorarnos de que el password est\u00e1 encriptado en ese formato en la base de datos. Por otra parte, el m\u00e9todo intended trata de enviar al usuario a la ruta a la que intentaba acceder antes de que se le solicitara autenticaci\u00f3n. Le pasamos como par\u00e1metro una ruta por defecto en el caso de que el destino previsto no est\u00e9 disponible. 2.3. Las rutas asociadas Finalmente, debemos definir las rutas tanto para mostrar el formulario (por get ) como para recoger las credenciales y validar al usuario (por post ). PHP 1 2 Route::get('login', [LoginController::class, 'loginForm'])->name('login'); Route::post('login', [LoginController::class, 'login']); 2.3.1. Redirecci\u00f3n en caso de error Cuando se detecta que un usuario no autenticado intenta acceder a una ruta protegida, autom\u00e1ticamente se le redirige a la ruta nombrada como login (como la que hemos definido previamente), donde ver\u00e1 el formulario de acceso. Si queremos cambiar el nombre de la ruta a la que redirigir (en el caso de que no queramos que sea login ), debemos modificar el m\u00e9todo redirectTo en el middleware de autenticaci\u00f3n app/Http/Middleware/Authenticate.php : PHP 1 2 3 4 5 protected function redirectTo($request) { // ... return route('login'); } 2.4. Proteger las rutas de acceso restringido Ahora que ya tenemos definido el mecanismo de login (controlador con m\u00e9todo de autenticaci\u00f3n, formulario de login y ruta asociada), podemos proteger aquellas rutas o enlaces que queramos que sean de acceso restringido. Por ejemplo, podemos hacer que las operaciones de creaci\u00f3n, borrado y edici\u00f3n de libros (funciones create , store , edit , update y destroy ) s\u00f3lo est\u00e9n disponibles para usuarios autenticados. Esto puede hacerse de varias formas. Si tenemos una ruta de recursos ( Route::resource ) en el archivo routes/web.php , entonces la opci\u00f3n m\u00e1s c\u00f3moda es definir un constructor en el controlador asociado (en este caso, LibroController ), y especificar qu\u00e9 funciones queremos proteger, bien con only o con except (en este \u00faltimo caso, se proteger\u00e1n todas las rutas salvo las indicadas en la lista): PHP 1 2 3 4 5 6 7 8 9 class LibroController extends Controller { public function __construct() { $this->middleware('auth', ['only' => ['create', 'store', 'edit', 'update', 'destroy']]); } // ... Si definimos las rutas sueltas, podemos emplear el m\u00e9todo middleware para indicar en cada una si queremos que se aplique el middleware de autenticaci\u00f3n: PHP 1 Route::get('prueba', [PruebaController::class, 'create'])->middleware('auth'); 2.5. Detectar en las vistas al usuario autenticado Puede ser muy necesario detectar en una vista si el usuario se ha autenticado o no, bien para mostrar ciertos controles (por ejemplo, enlaces para crear libros), o para cargar informaci\u00f3n propia del usuario (por ejemplo, posts creados por el usuario que ha entrado en un blog). Por ejemplo, de este modo podemos modificar el men\u00fa de navegaci\u00f3n ( resources/views/partials/nav.blade.php ) para que muestre el enlace de crear nuevo libro s\u00f3lo si el usuario se ha autenticado: PHP 1 2 3 4 5 @if(auth()->check()) <li class=\"{{ setActivo('libros.create') }} nav-item\"> <a class=\"nav-link\" href=\"{{ route('libros.create') }}\">Nuevo libro</a> </li> @endif Podemos emplear el m\u00e9todo auth()->guest() si queremos comprobar si el usuario a\u00fan NO se ha autenticado (por ejemplo, para mostrarle el enlace a login ), y el m\u00e9todo auth()->check() para comprobar si S\u00cd est\u00e1 autenticado (para mostrarle, por ejemplo, las opciones restringidas). De forma an\u00e1loga, el m\u00e9todo auth()->user() obtiene el objeto del usuario autenticado, con lo que podemos acceder a sus atributos: PHP 1 Bienvenido/a {{ auth()->user()->login }} 2.6. Implementaci\u00f3n del logout Para implementar el logout , basta con llamar al m\u00e9todo logout del facade Auth utilizado anteriormente, en el m\u00e9todo que se vaya a encargar de esa tarea. Lo podemos a\u00f1adir en el mismo controlador anterior: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 namespace App\\Http\\Controllers; use Illuminate\\Http\\Request; use Illuminate\\Support\\Facades\\Auth; class LoginController extends Controller { // ... public function logout() { Auth::logout(); // ... renderizar la vista deseada } Tambi\u00e9n har\u00e1 falta definir la ruta asociada en routes/web.php : PHP 1 Route::get('logout', [LoginController::class, 'logout'])->name('logout'); Obviamente, tambi\u00e9n ser\u00e1 necesario a\u00f1adir un enlace para hacer logout en alguna parte. Podemos ponerlo en el men\u00fa de navegaci\u00f3n (archivo resources/views/partials/nav.blade.php , cuando detectemos que el usuario est\u00e1 autenticado): PHP 1 2 3 4 5 6 7 8 @if(auth()->check()) <li class=\"{{ setActivo('libros.create') }} nav-item\"> <a class=\"nav-link\" href=\"{{ route('libros.create') }}\">Nuevo libro</a> </li> <li class=\"nav-item\"> <a class=\"nav-link\" href=\"{{ route('logout') }}\">Logout</a> </li> @endif 3. Definir roles. Uso de middleware Para poder definir roles para los distintos usuarios de nuestra aplicaci\u00f3n, obviamente debemos comenzar por definir un nuevo campo en la tabla de usuarios para almacenar dicho rol. Deberemos crear la migraci\u00f3n correspondiente y lanzarla. Despu\u00e9s, para proteger ciertas rutas en funci\u00f3n de los roles, podemos ocultar el enlace en las vistas con una simple comprobaci\u00f3n. Por ejemplo, asumiendo que el campo de los roles se llama rol : PHP 1 2 3 @if (auth()->user()->rol === 'admin') // mostrar contenido @endif Sin embargo, si accedemos a la URL sin pasar por el enlace, podremos ver el contenido. Debemos nuevamente incorporar el middleware auth al controlador que corresponda (si no lo est\u00e1 ya), para proteger el acceso general para usuarios autenticados. Adem\u00e1s, debemos definir un middleware propio que verifique el rol del usuario logueado. Podemos crearlo con este comando: PHP 1 php artisan make:middleware RolCheck En este caso hemos llamado al middleware RolCheck , pero el nombre puede ser el que queramos. Este middleware se crear\u00e1 en la carpeta App\\Http\\Middleware . Debemos editar su m\u00e9todo handle para verificar que los usuarios son de tipo \u201cadmin\u201d: PHP 1 2 3 4 5 6 7 public function handle($request, Closure $next, $rol) { if (auth()->user()->rol === $rol) return $next($request); else return redirect('/'); } Tras definir el middleware , lo registramos en el archivo App/Http/Kernel.php (en el apartado de routeMiddleware ): PHP 1 2 3 protected $routeMiddleware = [ // ... 'roles' => \\App\\Http\\Middleware\\RolCheck::class Finalmente, lo cargamos en el constructor de nuestro controlador. Podemos incluir con except y only restricciones sobre qu\u00e9 m\u00e9todos del controlador se ver\u00e1n afectados o no por el middleware . PHP 1 2 3 4 public function __construct() { $this->middleware(['auth', 'roles:admin']); } En este ejemplo, hemos mapeado el middleware con el alias roles en el archivo Kernel.php , y lo que hay tras los dos puntos es el par\u00e1metro extra que tiene el m\u00e9todo handle del middleware (el rol a comprobar). 3.1. Middleware con m\u00e1s de un par\u00e1metro En el caso de querer poder definir m\u00e1s de un rol en nuestro m\u00e9todo del middleware , necesitamos definir la funci\u00f3n con un n\u00famero de par\u00e1metros variable, de este modo: PHP 1 2 3 4 5 6 7 public function handle($request, Closure $next, ...$roles) { if (in_array(auth()->user()->rol, $roles)) return $next($request); else return redirect('/'); } Notar que, en este caso, lo que obtenemos en el par\u00e1metro $roles es un array, y debemos comprobar si el rol del usuario es uno de los que hay en el array. Ahora podemos cargar un middleware basado en m\u00faltiples roles, separados por comas, o incluso varios middleware para funciones diferentes, en el constructor. Por ejemplo, este constructor permitir\u00eda listar ( index ) a usuarios con rol editor, y permitir\u00eda ver la ficha ( show ) a editores y administradores. PHP 1 2 3 4 5 public function __construct() { $this->middleware(['auth', 'roles:editor'], ['only' => ['index']]); $this->middleware(['auth', 'roles:editor,admin'], ['only' => ['show']]); } 3.2. Sobre el concepto de middleware Hemos comentado brevemente el concepto de middleware asociado tanto al mecanismo de autenticaci\u00f3n como a la clase \u201cextra\u201d que podemos crear para comprobar roles. En general, un middleware es un fragmento de c\u00f3digo (normalmente una funci\u00f3n) que se ejecuta en medio de un proceso. En este caso, se ejecuta desde que se recibe la petici\u00f3n hasta que se emite la respuesta, y permite alterar ese flujo normal, haciendo ciertas comprobaciones sobre la petici\u00f3n. Por ejemplo, como es el caso, verificar que el usuario tiene los permisos adecuados antes de emitir una respuesta u otra. 4. M\u00e1s informaci\u00f3n Los mecanismos de autenticaci\u00f3n de Laravel son muy variados y flexibles. Aqu\u00ed hemos pretendido ofrecer s\u00f3lo una parte, quiz\u00e1 la m\u00e1s habitual o est\u00e1ndar. Para m\u00e1s informaci\u00f3n, pod\u00e9is consultar la documentaci\u00f3n oficial: Autenticaci\u00f3n con Laravel Uso de middleware autenticaci\u00f3n basada en tokens En una API REST tambi\u00e9n puede ser necesario proteger ciertos servicios, de forma que s\u00f3lo puedan acceder a ellos los usuarios autenticados. Sin embargo, en este caso no tenemos disponible el mecanismo de autenticaci\u00f3n basado en sesiones que vimos antes, ya que la parte cliente que consulta la API REST no tiene por qu\u00e9 estar basada en un navegador. Podr\u00edamos acceder desde una aplicaci\u00f3n de escritorio hecha en Java, por ejemplo, o desde una aplicaci\u00f3n m\u00f3vil, y en estos casos no podr\u00edamos disponer de las sesiones, propias de clientes web o navegadores. En su lugar, emplearemos un mecanismo de autenticaci\u00f3n basado en tokens . 1. Fundamentos de la autenticaci\u00f3n basada en tokens La autenticaci\u00f3n basada en tokens es un mecanismo de validaci\u00f3n de usuarios en aplicaciones cliente-servidor que podr\u00edamos decir que es m\u00e1s universal que la autenticaci\u00f3n basada en sesiones, ya que permite autenticar usuarios provenientes de distintos tipos de clientes. Lo que se hace es lo siguiente: El usuario necesita enviar sus credenciales ( login y password ), de forma similar a como se hace en una aplicaci\u00f3n web normal, aunque esta vez los datos se env\u00edan normalmente en formato JSON. El servidor valida esas credenciales y, si son correctas, genera una cadena de texto llamada token , de una cierta longitud, y que servir\u00e1 para identificar un\u00edvocamente al usuario a partir de ese momento. Dicho token debe ser enviado de vuelta (tambi\u00e9n en formato JSON) al cliente que se valid\u00f3 A partir de este punto, el cliente debe adjuntar el token como parte de la informaci\u00f3n en cada petici\u00f3n que realiza a una zona de acceso restringido, de forma que el servidor pueda consultar el token y comprobar si corresponde con el de alg\u00fan usuario autorizado. Este token normalmente se env\u00eda en una cabecera de la petici\u00f3n llamada Authorization , como veremos despu\u00e9s, y el servidor puede consultar el valor de dicha cabecera para verificar el acceso del cliente. 2. Alternativas para la implementaci\u00f3n de la autenticaci\u00f3n basada en tokens Podemos emplear distintas alternativas para la autenticaci\u00f3n basada en tokens bajo Laravel. Comentaremos en esta sesi\u00f3n dos de ellas. Por un lado, podemos emplear el mecanismo nativo de Laravel para autenticaci\u00f3n basada en tokens. Como ventajas principales, no se necesita instalar ninguna dependencia adicional, y es relativamente sencillo de utilizar. Como inconvenientes, requiere a\u00f1adir un campo m\u00e1s a la tabla de usuarios, para almacenar el token generado para cada usuario, y requiere tambi\u00e9n de una gesti\u00f3n manual del token, aunque es sencilla. Por otro lado podemos valernos de la librer\u00eda Laravel Sanctum , que proporciona mecanismos de autenticaci\u00f3n para APIs y para SPAs ( Single Page Applications , aplicaciones de p\u00e1gina \u00fanica). Entre sus ventajas podemos destacar que es sencilla de integrar en la aplicaci\u00f3n y automatiza algunos aspectos de la gesti\u00f3n de tokens, adem\u00e1s de contar con el soporte oficial de Laravel. Como inconvenientes, es una librer\u00eda m\u00e1s intrusiva que la anterior, ya que requiere crear una tabla adicional donde almacenar los tokens. En los siguientes apartados veremos c\u00f3mo proteger mediante tokens un proyecto sencillo en Laravel empleando cada uno de estos mecanismos. Como ejercicio de este apartado se pide que elij\u00e1is cualquiera de ellos y sig\u00e1is paso a paso el ejemplo para configurar la protecci\u00f3n mediante tokens en \u00e9l. 2.1. Preparando el ejemplo base Partiremos de un mismo proyecto base, que luego adaptaremos en funci\u00f3n del mecanismo de autenticaci\u00f3n elegido. Comenzaremos creando un proyecto llamado pruebaToken , en nuestra carpeta de proyectos: Text Only 1 laravel new pruebaToken Despu\u00e9s, eliminaremos las migraciones que no vamos a utilizar de la carpeta database/migrations : en concreto, eliminaremos los archivos sobre create_password_resets_table y create_failed_jobs_table , y dejaremos el resto. Sobre la migraci\u00f3n de usuarios, editaremos los m\u00e9todos up y down para dejar s\u00f3lo los campos que nos interesen, y renombrar la tabla a usuarios , de este modo: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public function up() { Schema::create('usuarios', function (Blueprint $table) { $table->id(); $table->string('login')->unique; $table->string('password'); $table->timestamps(); }); } ... public function down() { Schema::dropIfExists('usuarios'); } A continuaci\u00f3n, renombramos el modelo App\\Models\\User.php a App\\Models\\Usuario.php , cambiando tambi\u00e9n el nombre de la clase interior: Text Only 1 2 3 class Usuario extends Authenticatable { ... Y hacemos lo mismo con el factory y el seeder correspondiente (modificamos directamente el DatabaseSeeder para no crear un seeder espec\u00edfico, en este caso): Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 namespace Database\\Factories; use Illuminate\\Database\\Eloquent\\Factories\\Factory; /** * @extends \\Illuminate\\Database\\Eloquent\\Factories\\Factory<\\App\\Models\\Usuario> */ class UsuarioFactory extends Factory { /** * Define the model's default state. * * @return array */ public function definition() { return [ 'login' => $this->faker->word, 'password' => bcrypt('1234') ]; } } class DatabaseSeeder extends Seeder { /** * Seed the application's database. * * @return void */ public function run() { \\App\\Models\\Usuario::factory(2)->create(); } } Vamos a modificar tambi\u00e9n el archivo .env del proyecto para acceder a una base de datos llamada pruebaToken , que deberemos crear a trav\u00e9s de phpMyAdmin : Text Only 1 2 3 4 5 6 DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=pruebaToken DB_USERNAME=root DB_PASSWORD= Necesitamos tambi\u00e9n editar el archivo App\\Http\\Middleware\\Authenticate.php para indicar en el m\u00e9todo redirectTo que s\u00f3lo queremos redirigir al formulario de login cuando la petici\u00f3n no espere una respuesta en formato JSON. En caso contrario, no hay que mostrar dicho formulario, sino enviar una respuesta JSON adecuada. De hecho, si la aplicaci\u00f3n s\u00f3lo va a tener servicios REST podr\u00edamos eliminar o dejar comentado el c\u00f3digo de este m\u00e9todo para que no trate de redirigir a ning\u00fan formulario. Text Only 1 2 3 4 5 6 7 8 9 10 11 class Authenticate extends Middleware { protected function redirectTo($request) { /* if (! $request->expectsJson()) { return route('login'); } */ } } Por otra parte, debemos editar el archivo App\\Exceptions\\Handler.php , en concreto su m\u00e9todo register para definir los diferentes errores que pueden producirse y los mensajes que hay que devolver en cada caso: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use Illuminate\\Auth\\AuthenticationException; use Illuminate\\Foundation\\Exceptions\\Handler as ExceptionHandler; use Illuminate\\Database\\Eloquent\\ModelNotFoundException; use Illuminate\\Validation\\ValidationException; use Throwable; class Handler extends ExceptionHandler { ... public function register() { $this->renderable(function (Throwable $exception) { if (request()->is('api*')) { if ($exception instanceof ModelNotFoundException) return response()->json( ['error' => 'Elemento no encontrado'], 404); else if ($exception instanceof AuthenticationException) return response()->json( ['error' => 'Usuario no autenticado'], 401); else if ($exception instanceof ValidationException) return response()->json( ['error' => 'Datos no v\u00e1lidos'], 400); else if (isset($exception)) return response()->json( ['error' => 'Error en la aplicaci\u00f3n (' . get_class($exception) . '):' . $exception->getMessage()], 500); } }); } } Finalmente, vamos a definir un controlador de API con una serie de m\u00e9todos de prueba. No lo vamos a vincular a ning\u00fan modelo, porque generaremos unos datos a mano en cada m\u00e9todo para simplificar el c\u00f3digo. Escribimos este comando: Text Only 1 php artisan make:controller Api/PruebaController --api Rellenamos el c\u00f3digo de los m\u00e9todos del controlador con alguna respuesta sencilla para cada caso: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 class PruebaController extends Controller { public function index() { return response()->json(['mensaje' => 'Accediendo a index']); } public function store(Request $request) { return response()->json(['mensaje' => 'Insertando'], 201); } public function show($id) { return response()->json(['mensaje' => 'Ficha de ' . $id]); } public function update(Request $request, $id) { return response()->json(['mensaje' => 'Actualizando elemento']); } public function destroy($id) { return response()->json(['mensaje' => 'Borrando elemento']); } } Y a\u00f1adimos las rutas correspondientes en el archivo routes/api.php : Text Only 1 Route::apiResource('prueba', PruebaController::class); A partir de este punto, vamos a proteger el acceso a alguno de estos m\u00e9todos. Escoge uno de los siguientes apartados (3 o 4) para definir el mecanismo de autenticaci\u00f3n basado en tokens correspondiente. Tambi\u00e9n puedes intentar hacerlos todos; en este caso, copia y pega otra vez el proyecto Laravel, para trabajar por separado en cada carpeta con un mecanismo diferente. 3. Autenticaci\u00f3n basada en tokens nativa Vamos a emplear en esta secci\u00f3n la autenticaci\u00f3n nativa por tokens que ofrece Laravel. Los pasos a seguir los indicamos a continuaci\u00f3n. 3.1. Configuraci\u00f3n b\u00e1sica En primer lugar, modificamos la migraci\u00f3n de la tabla de usuarios para a\u00f1adir un nuevo campo donde almacenar el token. Dicho campo basta con que tenga 60 caracteres de longitud, y ser\u00e1 necesario tambi\u00e9n que sea \u00fanico para cada usuario: Text Only 1 2 3 4 5 6 7 8 9 10 public function up() { Schema::create('usuarios', function (Blueprint $table) { $table->id(); $table->string('login')->unique; $table->string('password'); $table->string('api_token', 60)->unique()->nullable(); $table->timestamps(); }); } Podemos lanzar ya la migraci\u00f3n para que se cree la tabla y se rellene con los usuarios que hayamos indicado en el seeder . Text Only 1 php artisan migrate:fresh --seed Tambi\u00e9n debemos modificar el archivo config/auth.php para indicar cu\u00e1l es el modelo de usuarios que vamos a utilizar: Text Only 1 2 3 4 5 'providers' => [ 'users' => [ 'driver' => 'eloquent', 'model' => App\\Models\\Usuario::class, ], En este mismo fichero, tambi\u00e9n podemos modificar el guard por defecto, que es web , para que sea api , si nuestra aplicaci\u00f3n no va a tener autenticaci\u00f3n web: Text Only 1 2 3 4 'defaults' => [ 'guard' => 'api', ... ], En la secci\u00f3n de guards , a\u00f1adimos el nuevo guard api , si no est\u00e1 ya definido: Text Only 1 2 3 4 5 6 7 8 9 'guards' => [ 'web' => [ ... ], 'api' => [ 'driver' => 'token', 'provider' => 'users' ] ] 3.2. Protecci\u00f3n de rutas Para proteger las rutas de acceso restringido, primero crearemos un controlador que se encargue de validar las credenciales del usuario: Text Only 1 php artisan make:controller Api/LoginController Definimos un m\u00e9todo login , por ejemplo, que validar\u00e1 las credenciales que le lleguen (login y password). Si son correctas, generar\u00e1 una cadena de texto aleatoria de 60 caracteres y la almacenar\u00e1 en el campo api_token del usuario validado. Tambi\u00e9n devolver\u00e1 dicho token como respuesta en formato JSON. En caso de que haya un error en la autenticaci\u00f3n, enviar\u00e1 de vuelta un mensaje de error, con el c\u00f3digo 401 de acceso no autorizado. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use App\\Http\\Controllers\\Controller; use Illuminate\\Http\\Request; use Illuminate\\Support\\Str; use Illuminate\\Support\\Facades\\Hash; use App\\Models\\Usuario; class LoginController extends Controller { public function login(Request $request) { $usuario = Usuario::where('login', $request->login)->first(); if (!$usuario || !Hash::check($request->password, $usuario->password)) { return response()->json( ['error' => 'Credenciales no v\u00e1lidas'], 401); } else { $usuario->api_token = Str::random(60); $usuario->save(); return response()->json(['token' => $usuario->api_token]); } } } Definimos en el archivo routes/api.php una ruta que redirija a este m\u00e9todo, para cuando el usuario quiera autenticarse (recuerda a\u00f1adir con use la correspondiente clase): Text Only 1 Route::post('login', [LoginController::class, 'login']); Tambi\u00e9n podemos eliminar en este caso la ruta predefinida de este archivo: Text Only 1 2 3 4 // Eliminar esta ruta: Route::middleware('auth:sanctum')->get('/user', function (Request $request) { return $request->user(); }); Para proteger las rutas que necesitemos en los controladores API, las especificamos en el constructor del controlador. Por ejemplo, as\u00ed proteger\u00edamos todas las rutas de nuestro controlador PruebaController , salvo index y show : Text Only 1 2 3 4 5 6 7 8 class PruebaController extends Controller { public function __construct() { $this->middleware('auth:api', ['except' => ['index', 'show']]); } ... Alternativamente, tambi\u00e9n podemos emplear el modificador only en lugar de except para indicar las rutas concretas que queremos proteger. Con esto ya tenemos el mecanismo de autenticaci\u00f3n por token establecido, y las rutas protegidas. Echa un vistazo al apartado 5 para ver c\u00f3mo probarlo todo desde Thunder Client o Postman. 4. Autenticaci\u00f3n basada en tokens usando Laravel Sanctum Como hemos comentado anteriormente, Laravel Sanctum es una librer\u00eda que proporciona mecanismos de autenticaci\u00f3n para SPAs ( Single Page Applications , aplicaciones de p\u00e1gina \u00fanica), y APIs. En nuestro caso, la emplearemos para autenticarnos mediante tokens en nuestras APIs. Los pasos a seguir para la configuraci\u00f3n son los siguientes\u2026 4.4.1. Configuraci\u00f3n de Sanctum En primer lugar, debemos incorporar Laravel Sanctum a nuestro proyecto. En las \u00faltimas versiones de Laravel aparece incorporado por defecto (lo podemos comprobar en el archivo composer.json , en la secci\u00f3n de require ). Si no es as\u00ed, podemos instalarlo escribiendo este comando desde la ra\u00edz del proyecto: Text Only 1 composer require laravel/sanctum Si nos diera alg\u00fan problema de incompatibilidad con la versi\u00f3n de proyecto que tengamos, podemos probar a ejecutar composer require laravel/sanctum:* para solucionarlo, e instalar la \u00faltima versi\u00f3n compatible. Despu\u00e9s, debemos publicar la configuraci\u00f3n de Sanctum y su fichero de migraci\u00f3n, que generar\u00e1 una tabla adicional donde almacenar los tokens. Escribimos el siguiente comando (todo en una l\u00ednea, aunque aqu\u00ed se divide en dos para poderlo ver completo): Text Only 1 2 php artisan vendor:publish --provider=\"Laravel\\Sanctum\\SanctumServiceProvider\" Al finalizar este paso, tendremos la migraci\u00f3n creada y un archivo de configuraci\u00f3n config/sanctum.php disponible, para editar la configuraci\u00f3n por defecto de la librer\u00eda. Por ejemplo, podemos editarlo para especificar el tiempo de vida (TTL) de los tokens. El siguiente ejemplo establece un tiempo de vida de 5 minutos, por ejemplo, aunque en el caso de aplicaciones basadas en tokens es habitual dejar tiempos mucho mayores (o indefinidos, seg\u00fan el caso, dejando esta propiedad a null ): Text Only 1 'expiration' => 5, Despu\u00e9s, debemos lanzar la migraci\u00f3n que se ha creado, junto con las que tengamos pendientes (la de la tabla de usuarios, por ejemplo). Se a\u00f1adir\u00e1 una tabla llamada personal_access_tokens a nuestra base de datos. Text Only 1 php artisan migrate:fresh --seed Finalmente, debemos verificar que el modelo de usuarios ( App\\Models\\Usuario ) incluya el trait HasApiTokens . De este modo se vincula el modelo de usuario con los tokens que se vayan a generar para los mismos. Text Only 1 2 3 4 5 6 7 ... use Laravel\\Sanctum\\HasApiTokens; class Usuario extends Authenticatable { use HasApiTokens, HasFactory, Notifiable; ... 4.2. Protecci\u00f3n de rutas Para proteger las rutas de acceso restringido, primero crearemos un controlador que se encargue de validar las credenciales del usuario: Text Only 1 php artisan make:controller Api/LoginController Definimos un m\u00e9todo login , por ejemplo, que validar\u00e1 las credenciales que le lleguen (login y password). Si son correctas, llamar\u00e1 al m\u00e9todo createToken de Sanctum (incorporado al usuario a trav\u00e9s del trait HasApiTokens ), asoci\u00e1ndolo al login del usuario entrante, y le devolver\u00e1 el token en formato texto plano, como un objeto JSON. En caso de que haya un error en la autenticaci\u00f3n, enviar\u00e1 de vuelta un mensaje de error, con el c\u00f3digo 401 de acceso no autorizado. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use App\\Http\\Controllers\\Controller; use Illuminate\\Http\\Request; use Illuminate\\Support\\Facades\\Hash; use App\\Models\\Usuario; class LoginController extends Controller { public function login(Request $request) { $usuario = Usuario::where('login', $request->login)->first(); if (!$usuario || !Hash::check($request->password, $usuario->password)) { return response()->json( ['error' => 'Credenciales no v\u00e1lidas'], 401); } else { return response()->json(['token' => $usuario->createToken($usuario->login)->plainTextToken]); } } } Definimos en el archivo routes/api.php una ruta que redirija a este m\u00e9todo, para cuando el usuario quiera autenticarse (recuerda a\u00f1adir con use la correspondiente clase): Text Only 1 Route::post('login', [LoginController::class, 'login']); Tambi\u00e9n podemos eliminar en este caso la ruta predefinida de este archivo: Text Only 1 2 3 4 // Eliminar esta ruta: Route::middleware('auth:sanctum')->get('/user', function (Request $request) { return $request->user(); }); Para proteger las rutas que necesitemos en los controladores API, las especificamos en el constructor del controlador. Por ejemplo, as\u00ed proteger\u00edamos todas las rutas de nuestro controlador PruebaController , salvo index y show : Text Only 1 2 3 4 5 6 7 8 class PruebaController extends Controller { public function __construct() { $this->middleware('auth:sanctum', ['except' => ['index', 'show']]); } ... NOTA: observa c\u00f3mo se invoca al middleware auth:sanctum , que es un mecanismo de autenticaci\u00f3n por defecto incorporado en Laravel. Esto hace que no tengamos que tocar la configuraci\u00f3n de config/auth.php para nada en este caso. Al usar Sanctum ya se sabe en qu\u00e9 tabla est\u00e1n los tokens almacenados, y vinculados a qu\u00e9 login . Alternativamente, tambi\u00e9n podemos emplear el modificador only en lugar de except para indicar las rutas concretas que queremos proteger. En el caso de Sanctum, cada vez que validemos un usuario a trav\u00e9s de la ruta de login , se guardar\u00e1 su token (encriptado) en la tabla personal_access_tokens de nuestra base de datos MySQL. Podemos comprobarlo con phpMyAdmin . Echa ahora un vistazo al apartado 5 para ver c\u00f3mo probarlo todo desde Thunder Client o Postman. 5. Prueba de autenticaci\u00f3n basada en tokens Veamos ahora c\u00f3mo probar la autenticaci\u00f3n basada en tokens desde una herramienta como ThunderClient , para lo que veremos c\u00f3mo obtener y enviar el token de acceso desde esta herramienta. Lo primero que deberemos hacer es una petici\u00f3n POST para loguearnos. Recibiremos como respuesta el token que se haya generado: NOTA : en el ejemplo que hemos estado haciendo, los campos a enviar ser\u00edan login y password . Echa un vistazo a phpMyAdmin para ver qu\u00e9 logins se han generado, y el password, siguiendo el ejemplo, deber\u00eda ser 1234. Ahora, s\u00f3lo nos queda adjuntar este token en la cabecera Authorization de las peticiones que lo necesiten. Para ello, vamos a la secci\u00f3n Authorization bajo la URL de la petici\u00f3n, y elegimos que queremos enviar un Bearer token . En el cuadro inferior nos dejar\u00e1 copiar dicho token: bibliografia Nacho Iborra Baeza .","title":"ud08 Laravel 7 AutenticacionDeUsuarios"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#autenticacion-basada-en-sesiones","text":"En esta sesi\u00f3n veremos c\u00f3mo incluir mecanismos de autenticaci\u00f3n en nuestros proyectos Laravel. Partiremos de la base de un proyecto ya creado (como el ejemplo de la biblioteca que venimos haciendo de sesiones anteriores) e incorporaremos paso a paso los elementos necesarios para autenticar usuarios.","title":"autenticaci\u00f3n basada en sesiones"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#1-configuracion-general-de-la-autenticacion","text":"En el archivo config/auth.php se dispone de algunas opciones de configuraci\u00f3n generales de autenticaci\u00f3n. Esta autenticaci\u00f3n en Laravel se apoya en dos elementos: los guards y los providers . Los *guards* son mecanismos que definen c\u00f3mo se van a autenticar los usuarios para cada petici\u00f3n. El mecanismo m\u00e1s habitual es mediante sesiones, donde se guarda la informaci\u00f3n del usuario autenticado en la sesi\u00f3n, aunque por defecto tambi\u00e9n se habilita la autenticaci\u00f3n mediante tokens. Los providers* indican c\u00f3mo se van a obtener los usuarios de la base de datos para comprobar la autenticaci\u00f3n. Las opciones habilitadas por defecto son mediante Eloquent (y el modelo de usuarios que tengamos definido), o mediante query builder*, consultando directamente la tabla correspondiente de usuarios. Deberemos modificar en el archivo la referencia a la tabla donde almacenaremos los usuarios (por defecto se hace referencia a una tabla llamada users ) y/o al modelo asociado (por defecto, la clase User ). As\u00ed que convendr\u00e1 modificar los nombres de estos dos elementos en la secci\u00f3n providers , as\u00ed como la ubicaci\u00f3n ( namespace ) del modelo de usuario, si procede. Por ejemplo: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 // ... 'providers' => [ 'users' => [ 'driver' => 'eloquent', 'model' => App\\Models\\Usuario::class, ], // 'users' => [ // 'driver' => 'database', // 'table' => 'usuarios', // ], ], Notar que la secci\u00f3n providers dispone de dos proveedores de autenticaci\u00f3n: uno (el que est\u00e1 habilitado) est\u00e1 basado en Eloquent, y hace uso del modelo de usuarios que hayamos definido. El otro (que aparece comentado) no utiliza Eloquent, sino el query builder contra la propia base de datos. Si preferimos esta segunda opci\u00f3n, deberemos comentar la primera y dejar habilitada la segunda. Tambi\u00e9n es posible dejar habilitados m\u00faltiples providers , cada uno con un nombre diferente, y asignarlo a m\u00faltiples guards .","title":"1. Configuraci\u00f3n general de la autenticaci\u00f3n"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#11-el-modelo-o-la-tabla-de-usuarios","text":"Si elegimos el provider basado en Eloquent, deberemos tener un modelo de usuarios al que acceder. En el caso de nuestra aplicaci\u00f3n de biblioteca (o el ejercicio del blog), disponemos ya de un modelo creado en App\\Models\\Usuario , por lo que el ejemplo anterior nos servir\u00eda para establecer este modelo como el modelo de usuarios por defecto. Si optamos por utilizar el query builder en lugar de Eloquent, deberemos tener una tabla en la base de datos donde est\u00e9n los datos de los usuarios. En nuestro caso, tambi\u00e9n disponemos de esa tabla usuarios , por lo que podr\u00edamos emplear esta otra opci\u00f3n para autenticar usuarios si quisi\u00e9ramos. No obstante, nos valdremos de Eloquent para la autenticaci\u00f3n. En cualquier caso, como veremos a continuaci\u00f3n, ser\u00e1 conveniente que los passwords de los usuarios est\u00e9n encriptados mediante bcrypt , que es el mecanismo de encriptaci\u00f3n por defecto que utiliza Laravel. Vamos a crear un nuevo seeder en nuestra aplicaci\u00f3n de biblioteca para crear un usuario con un login y password predefinidos. Llamamos al seeder UsuariosSeeder : PHP 1 php artisan make:seeder UsuariosSeeder En el m\u00e9todo run del nuevo seeder a\u00f1adiremos un nuevo usuario con login admin y password admin (encriptado usando bcrypt ): PHP 1 2 3 4 5 6 7 public function run() { $usuario = new Usuario(); $usuario->login = 'admin'; $usuario->password = bcrypt('admin'); $usuario->save(); } Finalmente, cargamos este nuevo seeder en la base de datos, o bien con una migraci\u00f3n completa nueva ( php artisan migrate:fresh --seed ), o bien ejecutando s\u00f3lo el seeder con esto: PHP 1 php artisan db:seed --class=UsuariosSeeder","title":"1.1. El modelo o la tabla de usuarios"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#2-anadir-autenticacion-a-un-proyecto","text":"Para a\u00f1adir autenticaci\u00f3n a un proyecto Laravel ya existente que no disponga de estos mecanismos, seguiremos estos pasos: Definiremos un formulario de login. Definiremos un nuevo controlador que se encargue de gestionar el login: tanto de mostrar el formulario cuando el usuario no est\u00e9 autenticado como de validar sus credenciales cuando las env\u00ede. A\u00f1adiremos las rutas pertinentes en el archivo routes/web.php tanto para el formulario de login como para la autenticaci\u00f3n posterior. Protegeremos las rutas que sean de acceso restringido. Opcionalmente, podemos a\u00f1adir tambi\u00e9n una opci\u00f3n de logout .","title":"2. A\u00f1adir autenticaci\u00f3n a un proyecto"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#21-el-formulario-de-login","text":"Vamos a definir un formulario de login en la vista resources/views/auth/login.blade.php , para que el usuario especifique su login y su password . Tambi\u00e9n dejaremos una zona para mostrar un posible mensaje de error si la autenticaci\u00f3n no ha sido exitosa: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 @extends('plantilla') @section('titulo', 'Login') @section('contenido') <h1>Login</h1> @if (!empty($error)) <div class=\"text-danger\"> {{ $error }} </div> @endif <form action=\"{{ route('login') }}\" method=\"POST\"> @csrf <div class=\"form-group\"> <label for=\"login\">Login:</label> <input type=\"text\" class=\"form-control\" name=\"login\" id=\"login\" /> </div> <div class=\"form-group\"> <label for=\"password\">Password:</label> <input type=\"password\" class=\"form-control\" name=\"password\" id=\"password\" /> </div> <input type=\"submit\" class=\"btn btn-dark btn-block\" name=\"enviar\" value=\"Enviar\" /> </form> @endsection","title":"2.1. El formulario de login"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#22-el-controlador-de-login","text":"Crearemos un nuevo controlador que se encargue de gestionar toda la autenticaci\u00f3n: PHP 1 php artisan make:controller LoginController Dentro, definimos una funci\u00f3n que se encargar\u00e1 de mostrar el formulario anterior: PHP 1 2 3 4 public function loginForm() { return view('auth.login'); } Y a\u00f1adiremos una segunda funci\u00f3n que se encargue de validar las credenciales enviadas por el usuario. Para esto, haremos uso del facade de autenticaci\u00f3n, existente en Illuminate\\Support\\Facades\\Auth . Recuerda de sesiones previas que un facade es b\u00e1sicamente un elemento que proporciona acceso a una serie de m\u00e9todos est\u00e1ticos de utilidad, en este caso para autenticar usuarios. PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 namespace App\\Http\\Controllers; use Illuminate\\Http\\Request; use Illuminate\\Support\\Facades\\Auth; class LoginController extends Controller { // ... public function login(Request $request) { $credenciales = $request->only('login', 'password'); if (Auth::attempt($credenciales)) { // Autenticaci\u00f3n exitosa return redirect()->intended(route('libros.index')); } else { $error = 'Usuario incorrecto'; return view('auth.login', compact('error')); } } } El m\u00e9todo attempt acepta una serie de pares clave-valor como primer par\u00e1metro. En este caso, le pasamos un s\u00f3lo par formado por el login (o el e-mail, dependiendo del campo que usemos para autenticar) y el password recibidos en la petici\u00f3n. Esto servir\u00e1 para localizar al usuario por la clave (login), y comprobar si tiene el valor asociado (el password). En el caso de los passwords, Laravel autom\u00e1ticamente los encripta en formato bcrypt , por lo que debemos cerciorarnos de que el password est\u00e1 encriptado en ese formato en la base de datos. Por otra parte, el m\u00e9todo intended trata de enviar al usuario a la ruta a la que intentaba acceder antes de que se le solicitara autenticaci\u00f3n. Le pasamos como par\u00e1metro una ruta por defecto en el caso de que el destino previsto no est\u00e9 disponible.","title":"2.2. El controlador de login"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#23-las-rutas-asociadas","text":"Finalmente, debemos definir las rutas tanto para mostrar el formulario (por get ) como para recoger las credenciales y validar al usuario (por post ). PHP 1 2 Route::get('login', [LoginController::class, 'loginForm'])->name('login'); Route::post('login', [LoginController::class, 'login']);","title":"2.3. Las rutas asociadas"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#231-redireccion-en-caso-de-error","text":"Cuando se detecta que un usuario no autenticado intenta acceder a una ruta protegida, autom\u00e1ticamente se le redirige a la ruta nombrada como login (como la que hemos definido previamente), donde ver\u00e1 el formulario de acceso. Si queremos cambiar el nombre de la ruta a la que redirigir (en el caso de que no queramos que sea login ), debemos modificar el m\u00e9todo redirectTo en el middleware de autenticaci\u00f3n app/Http/Middleware/Authenticate.php : PHP 1 2 3 4 5 protected function redirectTo($request) { // ... return route('login'); }","title":"2.3.1. Redirecci\u00f3n en caso de error"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#24-proteger-las-rutas-de-acceso-restringido","text":"Ahora que ya tenemos definido el mecanismo de login (controlador con m\u00e9todo de autenticaci\u00f3n, formulario de login y ruta asociada), podemos proteger aquellas rutas o enlaces que queramos que sean de acceso restringido. Por ejemplo, podemos hacer que las operaciones de creaci\u00f3n, borrado y edici\u00f3n de libros (funciones create , store , edit , update y destroy ) s\u00f3lo est\u00e9n disponibles para usuarios autenticados. Esto puede hacerse de varias formas. Si tenemos una ruta de recursos ( Route::resource ) en el archivo routes/web.php , entonces la opci\u00f3n m\u00e1s c\u00f3moda es definir un constructor en el controlador asociado (en este caso, LibroController ), y especificar qu\u00e9 funciones queremos proteger, bien con only o con except (en este \u00faltimo caso, se proteger\u00e1n todas las rutas salvo las indicadas en la lista): PHP 1 2 3 4 5 6 7 8 9 class LibroController extends Controller { public function __construct() { $this->middleware('auth', ['only' => ['create', 'store', 'edit', 'update', 'destroy']]); } // ... Si definimos las rutas sueltas, podemos emplear el m\u00e9todo middleware para indicar en cada una si queremos que se aplique el middleware de autenticaci\u00f3n: PHP 1 Route::get('prueba', [PruebaController::class, 'create'])->middleware('auth');","title":"2.4. Proteger las rutas de acceso restringido"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#25-detectar-en-las-vistas-al-usuario-autenticado","text":"Puede ser muy necesario detectar en una vista si el usuario se ha autenticado o no, bien para mostrar ciertos controles (por ejemplo, enlaces para crear libros), o para cargar informaci\u00f3n propia del usuario (por ejemplo, posts creados por el usuario que ha entrado en un blog). Por ejemplo, de este modo podemos modificar el men\u00fa de navegaci\u00f3n ( resources/views/partials/nav.blade.php ) para que muestre el enlace de crear nuevo libro s\u00f3lo si el usuario se ha autenticado: PHP 1 2 3 4 5 @if(auth()->check()) <li class=\"{{ setActivo('libros.create') }} nav-item\"> <a class=\"nav-link\" href=\"{{ route('libros.create') }}\">Nuevo libro</a> </li> @endif Podemos emplear el m\u00e9todo auth()->guest() si queremos comprobar si el usuario a\u00fan NO se ha autenticado (por ejemplo, para mostrarle el enlace a login ), y el m\u00e9todo auth()->check() para comprobar si S\u00cd est\u00e1 autenticado (para mostrarle, por ejemplo, las opciones restringidas). De forma an\u00e1loga, el m\u00e9todo auth()->user() obtiene el objeto del usuario autenticado, con lo que podemos acceder a sus atributos: PHP 1 Bienvenido/a {{ auth()->user()->login }}","title":"2.5. Detectar en las vistas al usuario autenticado"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#26-implementacion-del-logout","text":"Para implementar el logout , basta con llamar al m\u00e9todo logout del facade Auth utilizado anteriormente, en el m\u00e9todo que se vaya a encargar de esa tarea. Lo podemos a\u00f1adir en el mismo controlador anterior: PHP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 namespace App\\Http\\Controllers; use Illuminate\\Http\\Request; use Illuminate\\Support\\Facades\\Auth; class LoginController extends Controller { // ... public function logout() { Auth::logout(); // ... renderizar la vista deseada } Tambi\u00e9n har\u00e1 falta definir la ruta asociada en routes/web.php : PHP 1 Route::get('logout', [LoginController::class, 'logout'])->name('logout'); Obviamente, tambi\u00e9n ser\u00e1 necesario a\u00f1adir un enlace para hacer logout en alguna parte. Podemos ponerlo en el men\u00fa de navegaci\u00f3n (archivo resources/views/partials/nav.blade.php , cuando detectemos que el usuario est\u00e1 autenticado): PHP 1 2 3 4 5 6 7 8 @if(auth()->check()) <li class=\"{{ setActivo('libros.create') }} nav-item\"> <a class=\"nav-link\" href=\"{{ route('libros.create') }}\">Nuevo libro</a> </li> <li class=\"nav-item\"> <a class=\"nav-link\" href=\"{{ route('logout') }}\">Logout</a> </li> @endif","title":"2.6. Implementaci\u00f3n del logout"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#3-definir-roles-uso-de-middleware","text":"Para poder definir roles para los distintos usuarios de nuestra aplicaci\u00f3n, obviamente debemos comenzar por definir un nuevo campo en la tabla de usuarios para almacenar dicho rol. Deberemos crear la migraci\u00f3n correspondiente y lanzarla. Despu\u00e9s, para proteger ciertas rutas en funci\u00f3n de los roles, podemos ocultar el enlace en las vistas con una simple comprobaci\u00f3n. Por ejemplo, asumiendo que el campo de los roles se llama rol : PHP 1 2 3 @if (auth()->user()->rol === 'admin') // mostrar contenido @endif Sin embargo, si accedemos a la URL sin pasar por el enlace, podremos ver el contenido. Debemos nuevamente incorporar el middleware auth al controlador que corresponda (si no lo est\u00e1 ya), para proteger el acceso general para usuarios autenticados. Adem\u00e1s, debemos definir un middleware propio que verifique el rol del usuario logueado. Podemos crearlo con este comando: PHP 1 php artisan make:middleware RolCheck En este caso hemos llamado al middleware RolCheck , pero el nombre puede ser el que queramos. Este middleware se crear\u00e1 en la carpeta App\\Http\\Middleware . Debemos editar su m\u00e9todo handle para verificar que los usuarios son de tipo \u201cadmin\u201d: PHP 1 2 3 4 5 6 7 public function handle($request, Closure $next, $rol) { if (auth()->user()->rol === $rol) return $next($request); else return redirect('/'); } Tras definir el middleware , lo registramos en el archivo App/Http/Kernel.php (en el apartado de routeMiddleware ): PHP 1 2 3 protected $routeMiddleware = [ // ... 'roles' => \\App\\Http\\Middleware\\RolCheck::class Finalmente, lo cargamos en el constructor de nuestro controlador. Podemos incluir con except y only restricciones sobre qu\u00e9 m\u00e9todos del controlador se ver\u00e1n afectados o no por el middleware . PHP 1 2 3 4 public function __construct() { $this->middleware(['auth', 'roles:admin']); } En este ejemplo, hemos mapeado el middleware con el alias roles en el archivo Kernel.php , y lo que hay tras los dos puntos es el par\u00e1metro extra que tiene el m\u00e9todo handle del middleware (el rol a comprobar).","title":"3. Definir roles. Uso de middleware"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#31-middleware-con-mas-de-un-parametro","text":"En el caso de querer poder definir m\u00e1s de un rol en nuestro m\u00e9todo del middleware , necesitamos definir la funci\u00f3n con un n\u00famero de par\u00e1metros variable, de este modo: PHP 1 2 3 4 5 6 7 public function handle($request, Closure $next, ...$roles) { if (in_array(auth()->user()->rol, $roles)) return $next($request); else return redirect('/'); } Notar que, en este caso, lo que obtenemos en el par\u00e1metro $roles es un array, y debemos comprobar si el rol del usuario es uno de los que hay en el array. Ahora podemos cargar un middleware basado en m\u00faltiples roles, separados por comas, o incluso varios middleware para funciones diferentes, en el constructor. Por ejemplo, este constructor permitir\u00eda listar ( index ) a usuarios con rol editor, y permitir\u00eda ver la ficha ( show ) a editores y administradores. PHP 1 2 3 4 5 public function __construct() { $this->middleware(['auth', 'roles:editor'], ['only' => ['index']]); $this->middleware(['auth', 'roles:editor,admin'], ['only' => ['show']]); }","title":"3.1. Middleware con m\u00e1s de un par\u00e1metro"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#32-sobre-el-concepto-de-middleware","text":"Hemos comentado brevemente el concepto de middleware asociado tanto al mecanismo de autenticaci\u00f3n como a la clase \u201cextra\u201d que podemos crear para comprobar roles. En general, un middleware es un fragmento de c\u00f3digo (normalmente una funci\u00f3n) que se ejecuta en medio de un proceso. En este caso, se ejecuta desde que se recibe la petici\u00f3n hasta que se emite la respuesta, y permite alterar ese flujo normal, haciendo ciertas comprobaciones sobre la petici\u00f3n. Por ejemplo, como es el caso, verificar que el usuario tiene los permisos adecuados antes de emitir una respuesta u otra.","title":"3.2. Sobre el concepto de middleware"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#4-mas-informacion","text":"Los mecanismos de autenticaci\u00f3n de Laravel son muy variados y flexibles. Aqu\u00ed hemos pretendido ofrecer s\u00f3lo una parte, quiz\u00e1 la m\u00e1s habitual o est\u00e1ndar. Para m\u00e1s informaci\u00f3n, pod\u00e9is consultar la documentaci\u00f3n oficial: Autenticaci\u00f3n con Laravel Uso de middleware","title":"4. M\u00e1s informaci\u00f3n"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#autenticacion-basada-en-tokens","text":"En una API REST tambi\u00e9n puede ser necesario proteger ciertos servicios, de forma que s\u00f3lo puedan acceder a ellos los usuarios autenticados. Sin embargo, en este caso no tenemos disponible el mecanismo de autenticaci\u00f3n basado en sesiones que vimos antes, ya que la parte cliente que consulta la API REST no tiene por qu\u00e9 estar basada en un navegador. Podr\u00edamos acceder desde una aplicaci\u00f3n de escritorio hecha en Java, por ejemplo, o desde una aplicaci\u00f3n m\u00f3vil, y en estos casos no podr\u00edamos disponer de las sesiones, propias de clientes web o navegadores. En su lugar, emplearemos un mecanismo de autenticaci\u00f3n basado en tokens .","title":"autenticaci\u00f3n basada en tokens"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#1-fundamentos-de-la-autenticacion-basada-en-tokens","text":"La autenticaci\u00f3n basada en tokens es un mecanismo de validaci\u00f3n de usuarios en aplicaciones cliente-servidor que podr\u00edamos decir que es m\u00e1s universal que la autenticaci\u00f3n basada en sesiones, ya que permite autenticar usuarios provenientes de distintos tipos de clientes. Lo que se hace es lo siguiente: El usuario necesita enviar sus credenciales ( login y password ), de forma similar a como se hace en una aplicaci\u00f3n web normal, aunque esta vez los datos se env\u00edan normalmente en formato JSON. El servidor valida esas credenciales y, si son correctas, genera una cadena de texto llamada token , de una cierta longitud, y que servir\u00e1 para identificar un\u00edvocamente al usuario a partir de ese momento. Dicho token debe ser enviado de vuelta (tambi\u00e9n en formato JSON) al cliente que se valid\u00f3 A partir de este punto, el cliente debe adjuntar el token como parte de la informaci\u00f3n en cada petici\u00f3n que realiza a una zona de acceso restringido, de forma que el servidor pueda consultar el token y comprobar si corresponde con el de alg\u00fan usuario autorizado. Este token normalmente se env\u00eda en una cabecera de la petici\u00f3n llamada Authorization , como veremos despu\u00e9s, y el servidor puede consultar el valor de dicha cabecera para verificar el acceso del cliente.","title":"1. Fundamentos de la autenticaci\u00f3n basada en tokens"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#2-alternativas-para-la-implementacion-de-la-autenticacion-basada-en-tokens","text":"Podemos emplear distintas alternativas para la autenticaci\u00f3n basada en tokens bajo Laravel. Comentaremos en esta sesi\u00f3n dos de ellas. Por un lado, podemos emplear el mecanismo nativo de Laravel para autenticaci\u00f3n basada en tokens. Como ventajas principales, no se necesita instalar ninguna dependencia adicional, y es relativamente sencillo de utilizar. Como inconvenientes, requiere a\u00f1adir un campo m\u00e1s a la tabla de usuarios, para almacenar el token generado para cada usuario, y requiere tambi\u00e9n de una gesti\u00f3n manual del token, aunque es sencilla. Por otro lado podemos valernos de la librer\u00eda Laravel Sanctum , que proporciona mecanismos de autenticaci\u00f3n para APIs y para SPAs ( Single Page Applications , aplicaciones de p\u00e1gina \u00fanica). Entre sus ventajas podemos destacar que es sencilla de integrar en la aplicaci\u00f3n y automatiza algunos aspectos de la gesti\u00f3n de tokens, adem\u00e1s de contar con el soporte oficial de Laravel. Como inconvenientes, es una librer\u00eda m\u00e1s intrusiva que la anterior, ya que requiere crear una tabla adicional donde almacenar los tokens. En los siguientes apartados veremos c\u00f3mo proteger mediante tokens un proyecto sencillo en Laravel empleando cada uno de estos mecanismos. Como ejercicio de este apartado se pide que elij\u00e1is cualquiera de ellos y sig\u00e1is paso a paso el ejemplo para configurar la protecci\u00f3n mediante tokens en \u00e9l.","title":"2. Alternativas para la implementaci\u00f3n de la autenticaci\u00f3n basada en tokens"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#21-preparando-el-ejemplo-base","text":"Partiremos de un mismo proyecto base, que luego adaptaremos en funci\u00f3n del mecanismo de autenticaci\u00f3n elegido. Comenzaremos creando un proyecto llamado pruebaToken , en nuestra carpeta de proyectos: Text Only 1 laravel new pruebaToken Despu\u00e9s, eliminaremos las migraciones que no vamos a utilizar de la carpeta database/migrations : en concreto, eliminaremos los archivos sobre create_password_resets_table y create_failed_jobs_table , y dejaremos el resto. Sobre la migraci\u00f3n de usuarios, editaremos los m\u00e9todos up y down para dejar s\u00f3lo los campos que nos interesen, y renombrar la tabla a usuarios , de este modo: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 public function up() { Schema::create('usuarios', function (Blueprint $table) { $table->id(); $table->string('login')->unique; $table->string('password'); $table->timestamps(); }); } ... public function down() { Schema::dropIfExists('usuarios'); } A continuaci\u00f3n, renombramos el modelo App\\Models\\User.php a App\\Models\\Usuario.php , cambiando tambi\u00e9n el nombre de la clase interior: Text Only 1 2 3 class Usuario extends Authenticatable { ... Y hacemos lo mismo con el factory y el seeder correspondiente (modificamos directamente el DatabaseSeeder para no crear un seeder espec\u00edfico, en este caso): Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 namespace Database\\Factories; use Illuminate\\Database\\Eloquent\\Factories\\Factory; /** * @extends \\Illuminate\\Database\\Eloquent\\Factories\\Factory<\\App\\Models\\Usuario> */ class UsuarioFactory extends Factory { /** * Define the model's default state. * * @return array */ public function definition() { return [ 'login' => $this->faker->word, 'password' => bcrypt('1234') ]; } } class DatabaseSeeder extends Seeder { /** * Seed the application's database. * * @return void */ public function run() { \\App\\Models\\Usuario::factory(2)->create(); } } Vamos a modificar tambi\u00e9n el archivo .env del proyecto para acceder a una base de datos llamada pruebaToken , que deberemos crear a trav\u00e9s de phpMyAdmin : Text Only 1 2 3 4 5 6 DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=pruebaToken DB_USERNAME=root DB_PASSWORD= Necesitamos tambi\u00e9n editar el archivo App\\Http\\Middleware\\Authenticate.php para indicar en el m\u00e9todo redirectTo que s\u00f3lo queremos redirigir al formulario de login cuando la petici\u00f3n no espere una respuesta en formato JSON. En caso contrario, no hay que mostrar dicho formulario, sino enviar una respuesta JSON adecuada. De hecho, si la aplicaci\u00f3n s\u00f3lo va a tener servicios REST podr\u00edamos eliminar o dejar comentado el c\u00f3digo de este m\u00e9todo para que no trate de redirigir a ning\u00fan formulario. Text Only 1 2 3 4 5 6 7 8 9 10 11 class Authenticate extends Middleware { protected function redirectTo($request) { /* if (! $request->expectsJson()) { return route('login'); } */ } } Por otra parte, debemos editar el archivo App\\Exceptions\\Handler.php , en concreto su m\u00e9todo register para definir los diferentes errores que pueden producirse y los mensajes que hay que devolver en cada caso: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 use Illuminate\\Auth\\AuthenticationException; use Illuminate\\Foundation\\Exceptions\\Handler as ExceptionHandler; use Illuminate\\Database\\Eloquent\\ModelNotFoundException; use Illuminate\\Validation\\ValidationException; use Throwable; class Handler extends ExceptionHandler { ... public function register() { $this->renderable(function (Throwable $exception) { if (request()->is('api*')) { if ($exception instanceof ModelNotFoundException) return response()->json( ['error' => 'Elemento no encontrado'], 404); else if ($exception instanceof AuthenticationException) return response()->json( ['error' => 'Usuario no autenticado'], 401); else if ($exception instanceof ValidationException) return response()->json( ['error' => 'Datos no v\u00e1lidos'], 400); else if (isset($exception)) return response()->json( ['error' => 'Error en la aplicaci\u00f3n (' . get_class($exception) . '):' . $exception->getMessage()], 500); } }); } } Finalmente, vamos a definir un controlador de API con una serie de m\u00e9todos de prueba. No lo vamos a vincular a ning\u00fan modelo, porque generaremos unos datos a mano en cada m\u00e9todo para simplificar el c\u00f3digo. Escribimos este comando: Text Only 1 php artisan make:controller Api/PruebaController --api Rellenamos el c\u00f3digo de los m\u00e9todos del controlador con alguna respuesta sencilla para cada caso: Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 class PruebaController extends Controller { public function index() { return response()->json(['mensaje' => 'Accediendo a index']); } public function store(Request $request) { return response()->json(['mensaje' => 'Insertando'], 201); } public function show($id) { return response()->json(['mensaje' => 'Ficha de ' . $id]); } public function update(Request $request, $id) { return response()->json(['mensaje' => 'Actualizando elemento']); } public function destroy($id) { return response()->json(['mensaje' => 'Borrando elemento']); } } Y a\u00f1adimos las rutas correspondientes en el archivo routes/api.php : Text Only 1 Route::apiResource('prueba', PruebaController::class); A partir de este punto, vamos a proteger el acceso a alguno de estos m\u00e9todos. Escoge uno de los siguientes apartados (3 o 4) para definir el mecanismo de autenticaci\u00f3n basado en tokens correspondiente. Tambi\u00e9n puedes intentar hacerlos todos; en este caso, copia y pega otra vez el proyecto Laravel, para trabajar por separado en cada carpeta con un mecanismo diferente.","title":"2.1. Preparando el ejemplo base"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#3-autenticacion-basada-en-tokens-nativa","text":"Vamos a emplear en esta secci\u00f3n la autenticaci\u00f3n nativa por tokens que ofrece Laravel. Los pasos a seguir los indicamos a continuaci\u00f3n.","title":"3. Autenticaci\u00f3n basada en tokens nativa"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#31-configuracion-basica","text":"En primer lugar, modificamos la migraci\u00f3n de la tabla de usuarios para a\u00f1adir un nuevo campo donde almacenar el token. Dicho campo basta con que tenga 60 caracteres de longitud, y ser\u00e1 necesario tambi\u00e9n que sea \u00fanico para cada usuario: Text Only 1 2 3 4 5 6 7 8 9 10 public function up() { Schema::create('usuarios', function (Blueprint $table) { $table->id(); $table->string('login')->unique; $table->string('password'); $table->string('api_token', 60)->unique()->nullable(); $table->timestamps(); }); } Podemos lanzar ya la migraci\u00f3n para que se cree la tabla y se rellene con los usuarios que hayamos indicado en el seeder . Text Only 1 php artisan migrate:fresh --seed Tambi\u00e9n debemos modificar el archivo config/auth.php para indicar cu\u00e1l es el modelo de usuarios que vamos a utilizar: Text Only 1 2 3 4 5 'providers' => [ 'users' => [ 'driver' => 'eloquent', 'model' => App\\Models\\Usuario::class, ], En este mismo fichero, tambi\u00e9n podemos modificar el guard por defecto, que es web , para que sea api , si nuestra aplicaci\u00f3n no va a tener autenticaci\u00f3n web: Text Only 1 2 3 4 'defaults' => [ 'guard' => 'api', ... ], En la secci\u00f3n de guards , a\u00f1adimos el nuevo guard api , si no est\u00e1 ya definido: Text Only 1 2 3 4 5 6 7 8 9 'guards' => [ 'web' => [ ... ], 'api' => [ 'driver' => 'token', 'provider' => 'users' ] ]","title":"3.1. Configuraci\u00f3n b\u00e1sica"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#32-proteccion-de-rutas","text":"Para proteger las rutas de acceso restringido, primero crearemos un controlador que se encargue de validar las credenciales del usuario: Text Only 1 php artisan make:controller Api/LoginController Definimos un m\u00e9todo login , por ejemplo, que validar\u00e1 las credenciales que le lleguen (login y password). Si son correctas, generar\u00e1 una cadena de texto aleatoria de 60 caracteres y la almacenar\u00e1 en el campo api_token del usuario validado. Tambi\u00e9n devolver\u00e1 dicho token como respuesta en formato JSON. En caso de que haya un error en la autenticaci\u00f3n, enviar\u00e1 de vuelta un mensaje de error, con el c\u00f3digo 401 de acceso no autorizado. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use App\\Http\\Controllers\\Controller; use Illuminate\\Http\\Request; use Illuminate\\Support\\Str; use Illuminate\\Support\\Facades\\Hash; use App\\Models\\Usuario; class LoginController extends Controller { public function login(Request $request) { $usuario = Usuario::where('login', $request->login)->first(); if (!$usuario || !Hash::check($request->password, $usuario->password)) { return response()->json( ['error' => 'Credenciales no v\u00e1lidas'], 401); } else { $usuario->api_token = Str::random(60); $usuario->save(); return response()->json(['token' => $usuario->api_token]); } } } Definimos en el archivo routes/api.php una ruta que redirija a este m\u00e9todo, para cuando el usuario quiera autenticarse (recuerda a\u00f1adir con use la correspondiente clase): Text Only 1 Route::post('login', [LoginController::class, 'login']); Tambi\u00e9n podemos eliminar en este caso la ruta predefinida de este archivo: Text Only 1 2 3 4 // Eliminar esta ruta: Route::middleware('auth:sanctum')->get('/user', function (Request $request) { return $request->user(); }); Para proteger las rutas que necesitemos en los controladores API, las especificamos en el constructor del controlador. Por ejemplo, as\u00ed proteger\u00edamos todas las rutas de nuestro controlador PruebaController , salvo index y show : Text Only 1 2 3 4 5 6 7 8 class PruebaController extends Controller { public function __construct() { $this->middleware('auth:api', ['except' => ['index', 'show']]); } ... Alternativamente, tambi\u00e9n podemos emplear el modificador only en lugar de except para indicar las rutas concretas que queremos proteger. Con esto ya tenemos el mecanismo de autenticaci\u00f3n por token establecido, y las rutas protegidas. Echa un vistazo al apartado 5 para ver c\u00f3mo probarlo todo desde Thunder Client o Postman.","title":"3.2. Protecci\u00f3n de rutas"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#4-autenticacion-basada-en-tokens-usando-laravel-sanctum","text":"Como hemos comentado anteriormente, Laravel Sanctum es una librer\u00eda que proporciona mecanismos de autenticaci\u00f3n para SPAs ( Single Page Applications , aplicaciones de p\u00e1gina \u00fanica), y APIs. En nuestro caso, la emplearemos para autenticarnos mediante tokens en nuestras APIs. Los pasos a seguir para la configuraci\u00f3n son los siguientes\u2026","title":"4. Autenticaci\u00f3n basada en tokens usando Laravel Sanctum"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#441-configuracion-de-sanctum","text":"En primer lugar, debemos incorporar Laravel Sanctum a nuestro proyecto. En las \u00faltimas versiones de Laravel aparece incorporado por defecto (lo podemos comprobar en el archivo composer.json , en la secci\u00f3n de require ). Si no es as\u00ed, podemos instalarlo escribiendo este comando desde la ra\u00edz del proyecto: Text Only 1 composer require laravel/sanctum Si nos diera alg\u00fan problema de incompatibilidad con la versi\u00f3n de proyecto que tengamos, podemos probar a ejecutar composer require laravel/sanctum:* para solucionarlo, e instalar la \u00faltima versi\u00f3n compatible. Despu\u00e9s, debemos publicar la configuraci\u00f3n de Sanctum y su fichero de migraci\u00f3n, que generar\u00e1 una tabla adicional donde almacenar los tokens. Escribimos el siguiente comando (todo en una l\u00ednea, aunque aqu\u00ed se divide en dos para poderlo ver completo): Text Only 1 2 php artisan vendor:publish --provider=\"Laravel\\Sanctum\\SanctumServiceProvider\" Al finalizar este paso, tendremos la migraci\u00f3n creada y un archivo de configuraci\u00f3n config/sanctum.php disponible, para editar la configuraci\u00f3n por defecto de la librer\u00eda. Por ejemplo, podemos editarlo para especificar el tiempo de vida (TTL) de los tokens. El siguiente ejemplo establece un tiempo de vida de 5 minutos, por ejemplo, aunque en el caso de aplicaciones basadas en tokens es habitual dejar tiempos mucho mayores (o indefinidos, seg\u00fan el caso, dejando esta propiedad a null ): Text Only 1 'expiration' => 5, Despu\u00e9s, debemos lanzar la migraci\u00f3n que se ha creado, junto con las que tengamos pendientes (la de la tabla de usuarios, por ejemplo). Se a\u00f1adir\u00e1 una tabla llamada personal_access_tokens a nuestra base de datos. Text Only 1 php artisan migrate:fresh --seed Finalmente, debemos verificar que el modelo de usuarios ( App\\Models\\Usuario ) incluya el trait HasApiTokens . De este modo se vincula el modelo de usuario con los tokens que se vayan a generar para los mismos. Text Only 1 2 3 4 5 6 7 ... use Laravel\\Sanctum\\HasApiTokens; class Usuario extends Authenticatable { use HasApiTokens, HasFactory, Notifiable; ...","title":"4.4.1. Configuraci\u00f3n de Sanctum"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#42-proteccion-de-rutas","text":"Para proteger las rutas de acceso restringido, primero crearemos un controlador que se encargue de validar las credenciales del usuario: Text Only 1 php artisan make:controller Api/LoginController Definimos un m\u00e9todo login , por ejemplo, que validar\u00e1 las credenciales que le lleguen (login y password). Si son correctas, llamar\u00e1 al m\u00e9todo createToken de Sanctum (incorporado al usuario a trav\u00e9s del trait HasApiTokens ), asoci\u00e1ndolo al login del usuario entrante, y le devolver\u00e1 el token en formato texto plano, como un objeto JSON. En caso de que haya un error en la autenticaci\u00f3n, enviar\u00e1 de vuelta un mensaje de error, con el c\u00f3digo 401 de acceso no autorizado. Text Only 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 use App\\Http\\Controllers\\Controller; use Illuminate\\Http\\Request; use Illuminate\\Support\\Facades\\Hash; use App\\Models\\Usuario; class LoginController extends Controller { public function login(Request $request) { $usuario = Usuario::where('login', $request->login)->first(); if (!$usuario || !Hash::check($request->password, $usuario->password)) { return response()->json( ['error' => 'Credenciales no v\u00e1lidas'], 401); } else { return response()->json(['token' => $usuario->createToken($usuario->login)->plainTextToken]); } } } Definimos en el archivo routes/api.php una ruta que redirija a este m\u00e9todo, para cuando el usuario quiera autenticarse (recuerda a\u00f1adir con use la correspondiente clase): Text Only 1 Route::post('login', [LoginController::class, 'login']); Tambi\u00e9n podemos eliminar en este caso la ruta predefinida de este archivo: Text Only 1 2 3 4 // Eliminar esta ruta: Route::middleware('auth:sanctum')->get('/user', function (Request $request) { return $request->user(); }); Para proteger las rutas que necesitemos en los controladores API, las especificamos en el constructor del controlador. Por ejemplo, as\u00ed proteger\u00edamos todas las rutas de nuestro controlador PruebaController , salvo index y show : Text Only 1 2 3 4 5 6 7 8 class PruebaController extends Controller { public function __construct() { $this->middleware('auth:sanctum', ['except' => ['index', 'show']]); } ... NOTA: observa c\u00f3mo se invoca al middleware auth:sanctum , que es un mecanismo de autenticaci\u00f3n por defecto incorporado en Laravel. Esto hace que no tengamos que tocar la configuraci\u00f3n de config/auth.php para nada en este caso. Al usar Sanctum ya se sabe en qu\u00e9 tabla est\u00e1n los tokens almacenados, y vinculados a qu\u00e9 login . Alternativamente, tambi\u00e9n podemos emplear el modificador only en lugar de except para indicar las rutas concretas que queremos proteger. En el caso de Sanctum, cada vez que validemos un usuario a trav\u00e9s de la ruta de login , se guardar\u00e1 su token (encriptado) en la tabla personal_access_tokens de nuestra base de datos MySQL. Podemos comprobarlo con phpMyAdmin . Echa ahora un vistazo al apartado 5 para ver c\u00f3mo probarlo todo desde Thunder Client o Postman.","title":"4.2. Protecci\u00f3n de rutas"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#5-prueba-de-autenticacion-basada-en-tokens","text":"Veamos ahora c\u00f3mo probar la autenticaci\u00f3n basada en tokens desde una herramienta como ThunderClient , para lo que veremos c\u00f3mo obtener y enviar el token de acceso desde esta herramienta. Lo primero que deberemos hacer es una petici\u00f3n POST para loguearnos. Recibiremos como respuesta el token que se haya generado: NOTA : en el ejemplo que hemos estado haciendo, los campos a enviar ser\u00edan login y password . Echa un vistazo a phpMyAdmin para ver qu\u00e9 logins se han generado, y el password, siguiendo el ejemplo, deber\u00eda ser 1234. Ahora, s\u00f3lo nos queda adjuntar este token en la cabecera Authorization de las peticiones que lo necesiten. Para ello, vamos a la secci\u00f3n Authorization bajo la URL de la petici\u00f3n, y elegimos que queremos enviar un Bearer token . En el cuadro inferior nos dejar\u00e1 copiar dicho token:","title":"5. Prueba de autenticaci\u00f3n basada en tokens"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios/#bibliografia","text":"Nacho Iborra Baeza .","title":"bibliografia"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios_actividades/","text":"unit: unidad did\u00e1ctica 8 title: Laravel - autenticaci\u00f3n de usuarios (actividades) language: ES author: Arturo Blasco subject: Desarrollo Web en Entorno Servidor keywords: [DWES, 2023, PHP, Laravel] IES: IES Mestre Ram\u00f3n Esteve (Catadau) [iesmre.es] header: ${unit}: ${title} - ${subject} (versi\u00f3n: ${today}) footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount} typora-root-url:${filename}/../ typora-copy-images-to:${filename}/../assets ejercicios propuestos parte I Ejercicio 1 Ejercicio 2 parte II Ejercicio 3 bibliografia El uso de estos materiales est\u00e1 sujeto a una licencia Creative Commons CC BY-NC . Material extra\u00eddo de https://nachoiborraies.github.io/laravel/ ejercicios propuestos parte I Ejercicio 1 Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Modifica el archivo config/auth.php para que el provider acuda al modelo correcto de usuario. Modifica el factory de usuarios para que los passwords se encripten con bcrypt . Para que sea f\u00e1cil de recordar, haz que cada usuario tenga como password su mismo login encriptado. Ejecuta despu\u00e9s php artisan migrate:fresh --seed para actualizar toda la base de datos. Crea un formulario de login junto con un controlador asociado, y las rutas pertinentes para mostrar el formulario o autenticar, como hemos hecho en el ejemplo para la biblioteca. Recuerda llamar \u201clogin\u201d a la ruta que muestra el formulario de login. En el controlador de posts, protege todas las opciones menos las de index y show . A\u00f1ade una opci\u00f3n de Login en el men\u00fa de navegaci\u00f3n superior, que s\u00f3lo est\u00e9 visible si el usuario no se ha autenticado a\u00fan Haz que s\u00f3lo se muestren los enlaces y botones de crear, editar o borrar posts cuando el usuario est\u00e9 autenticado. En ese mismo caso, haz que tambi\u00e9n se muestre una opci\u00f3n de logout en el men\u00fa superior, que deber\u00e1s implementar. Finalmente, a\u00f1ade la funcionalidad de que el usuario autenticado s\u00f3lo puede editar y borrar sus propios posts, pero no los de los dem\u00e1s usuarios. Ejercicio 2 Opcional Continuamos con el proyecto blog anterior. Sigue estos pasos para definir una autenticaci\u00f3n basada en roles: Crea una nueva migraci\u00f3n que modifique la tabla de usuarios para a\u00f1adir un nuevo campo llamado rol , de tipo string . Aseg\u00farate de que la migraci\u00f3n sea de modificaci\u00f3n, y no de creaci\u00f3n de tabla. Despu\u00e9s, ejec\u00fatala para crear el nuevo campo. Haz que alguno de los usuarios de la tabla tenga un rol de admin (ed\u00edtalo a mano desde phpMyAdmin ), y el resto ser\u00e1n de tipo editor . Crea un nuevo middleware llamado RolCheck , con una funci\u00f3n que compruebe si el usuario tiene el rol indicado, como en el ejemplo visto antes en los apuntes. Reg\u00edstralo adecuadamente en el archivo App/Http/Kernel.php , como se ha explicado. Modifica las vistas necesarias para que, si el usuario es de tipo admin pueda ver los botones de edici\u00f3n y borrado de cualquier post, aunque no sean suyos. Modifica los m\u00e9todos edit , update y destroy de PostController para que redirijan a posts.index si el usuario no es administrador, o si no es el propietario del post a editar o borrar. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_07.zip . parte II Ejercicio 3 Como ejercicio para practicar la autenticaci\u00f3n basada en tokens, se pide que sig\u00e1is los pasos indicados en el documento correspondiente , donde se explica c\u00f3mo proteger aplicaciones basadas en servicios REST mediante tokens. En el punto 2 se indica que existen distintas formas de hacerlo, y en los puntos 3 y 4 se detallan dos de ellas. Lo que se pide como ejercicio es que sig\u00e1is los pasos detallados en cualquiera de las dos opciones (3 o 4) para proteger el proyecto de ejemplo que se crea en ese apartado. Deber\u00e9is adjuntar como resultado de este ejercicio el proyecto pruebaToken con el c\u00f3digo completo para proteger mediante tokens las rutas restringidas del controlador PruebaController que habremos definido. Tambi\u00e9n deb\u00e9is adjuntar la colecci\u00f3n de pruebas de Postman que habr\u00e9is empleado para probar la seguridad de la aplicaci\u00f3n. \u00bfQu\u00e9 entregar? Como entrega de esta parte deber\u00e1s comprimir el proyecto pruebaToken finalizado. Elimina tambi\u00e9n la carpeta vendor , y a\u00f1ade dentro del ZIP blog_08c.zip la colecci\u00f3n Postman para probar los servicios. bibliografia Nacho Iborra Baeza .","title":"ud08 Laravel 7 AutenticacionDeUsuarios actividades"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios_actividades/#ejercicios-propuestos","text":"","title":"ejercicios propuestos"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios_actividades/#parte-i","text":"","title":"parte I"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios_actividades/#ejercicio-1","text":"Sobre el proyecto blog de la sesi\u00f3n anterior, vamos a a\u00f1adir estos cambios: Modifica el archivo config/auth.php para que el provider acuda al modelo correcto de usuario. Modifica el factory de usuarios para que los passwords se encripten con bcrypt . Para que sea f\u00e1cil de recordar, haz que cada usuario tenga como password su mismo login encriptado. Ejecuta despu\u00e9s php artisan migrate:fresh --seed para actualizar toda la base de datos. Crea un formulario de login junto con un controlador asociado, y las rutas pertinentes para mostrar el formulario o autenticar, como hemos hecho en el ejemplo para la biblioteca. Recuerda llamar \u201clogin\u201d a la ruta que muestra el formulario de login. En el controlador de posts, protege todas las opciones menos las de index y show . A\u00f1ade una opci\u00f3n de Login en el men\u00fa de navegaci\u00f3n superior, que s\u00f3lo est\u00e9 visible si el usuario no se ha autenticado a\u00fan Haz que s\u00f3lo se muestren los enlaces y botones de crear, editar o borrar posts cuando el usuario est\u00e9 autenticado. En ese mismo caso, haz que tambi\u00e9n se muestre una opci\u00f3n de logout en el men\u00fa superior, que deber\u00e1s implementar. Finalmente, a\u00f1ade la funcionalidad de que el usuario autenticado s\u00f3lo puede editar y borrar sus propios posts, pero no los de los dem\u00e1s usuarios.","title":"Ejercicio 1"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios_actividades/#ejercicio-2","text":"Opcional Continuamos con el proyecto blog anterior. Sigue estos pasos para definir una autenticaci\u00f3n basada en roles: Crea una nueva migraci\u00f3n que modifique la tabla de usuarios para a\u00f1adir un nuevo campo llamado rol , de tipo string . Aseg\u00farate de que la migraci\u00f3n sea de modificaci\u00f3n, y no de creaci\u00f3n de tabla. Despu\u00e9s, ejec\u00fatala para crear el nuevo campo. Haz que alguno de los usuarios de la tabla tenga un rol de admin (ed\u00edtalo a mano desde phpMyAdmin ), y el resto ser\u00e1n de tipo editor . Crea un nuevo middleware llamado RolCheck , con una funci\u00f3n que compruebe si el usuario tiene el rol indicado, como en el ejemplo visto antes en los apuntes. Reg\u00edstralo adecuadamente en el archivo App/Http/Kernel.php , como se ha explicado. Modifica las vistas necesarias para que, si el usuario es de tipo admin pueda ver los botones de edici\u00f3n y borrado de cualquier post, aunque no sean suyos. Modifica los m\u00e9todos edit , update y destroy de PostController para que redirijan a posts.index si el usuario no es administrador, o si no es el propietario del post a editar o borrar. \u00bfQu\u00e9 entregar? Como entrega de esta sesi\u00f3n deber\u00e1s comprimir el proyecto blog con todos los cambios incorporados, y eliminando las carpetas vendor y node_modules como se explic\u00f3 en las sesiones anteriores. Renombra el archivo comprimido a blog_07.zip .","title":"Ejercicio 2"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios_actividades/#parte-ii","text":"","title":"parte II"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios_actividades/#ejercicio-3","text":"Como ejercicio para practicar la autenticaci\u00f3n basada en tokens, se pide que sig\u00e1is los pasos indicados en el documento correspondiente , donde se explica c\u00f3mo proteger aplicaciones basadas en servicios REST mediante tokens. En el punto 2 se indica que existen distintas formas de hacerlo, y en los puntos 3 y 4 se detallan dos de ellas. Lo que se pide como ejercicio es que sig\u00e1is los pasos detallados en cualquiera de las dos opciones (3 o 4) para proteger el proyecto de ejemplo que se crea en ese apartado. Deber\u00e9is adjuntar como resultado de este ejercicio el proyecto pruebaToken con el c\u00f3digo completo para proteger mediante tokens las rutas restringidas del controlador PruebaController que habremos definido. Tambi\u00e9n deb\u00e9is adjuntar la colecci\u00f3n de pruebas de Postman que habr\u00e9is empleado para probar la seguridad de la aplicaci\u00f3n. \u00bfQu\u00e9 entregar? Como entrega de esta parte deber\u00e1s comprimir el proyecto pruebaToken finalizado. Elimina tambi\u00e9n la carpeta vendor , y a\u00f1ade dentro del ZIP blog_08c.zip la colecci\u00f3n Postman para probar los servicios.","title":"Ejercicio 3"},{"location":"ud08/ud08_Laravel_7_AutenticacionDeUsuarios_actividades/#bibliografia","text":"Nacho Iborra Baeza .","title":"bibliografia"}]}