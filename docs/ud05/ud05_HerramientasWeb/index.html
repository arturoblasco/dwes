
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>ud05 HerramientasWeb - Desarrollo Web en Entorno Servidor (DWES)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#duracion-y-criterios-de-evaluacion" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Desarrollo Web en Entorno Servidor (DWES)" class="md-header__button md-logo" aria-label="Desarrollo Web en Entorno Servidor (DWES)" data-md-component="logo">
      
  <img src="../../logo3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Desarrollo Web en Entorno Servidor (DWES)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ud05 HerramientasWeb
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Canvia a mode oscur"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Canvia a mode oscur" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Canvia a mode normal"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canvia a mode normal" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Desarrollo Web en Entorno Servidor (DWES)" class="md-nav__button md-logo" aria-label="Desarrollo Web en Entorno Servidor (DWES)" data-md-component="logo">
      
  <img src="../../logo3.png" alt="logo">

    </a>
    Desarrollo Web en Entorno Servidor (DWES)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 1 Arquitectura Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 2 Lenguaje PHP
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 3 PHP Orientado a Objetos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 4 Programación Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 5 Herramientas Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 6 Acceso a Base de Datos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 7 Framework Laravel
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 8 Laravel avanzado
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<hr />
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><code>unit: unidad didáctica 5
title: Herramientas Web
language: ES
author: Arturo Blasco
subject: Desarrollo Web en Entornos Servidor
keywords: [2023-2024, DWES, PHP]
IES: IES Mestre Ramón Esteve (Catadau) [iesmre.es]
header: ${title} - ${subject} (ver: ${today}) 
footer:${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}/${pageCount}
typora-root-url:${filename}/../
typora-copy-images-to:${filename}/../assets
</code></pre></div></td></tr></table></div>
<hr />
<p><strong>Índice</strong></p>
<div class="toc">
<ul>
<li><a href="#duracion-y-criterios-de-evaluacion">duración y criterios de evaluación</a></li>
<li><a href="#composer">Composer</a><ul>
<li><a href="#instalacion">instalación</a></li>
<li><a href="#primeros-pasos">primeros pasos</a></li>
<li><a href="#actualizar-librerias">actualizar librerías</a></li>
<li><a href="#autoloadphp">autoload.php</a></li>
</ul>
</li>
<li><a href="#monolog">Monolog</a><ul>
<li><a href="#niveles">niveles</a></li>
<li><a href="#hola-monolog">Hola Monolog</a></li>
<li><a href="#funcionamiento">funcionamiento</a></li>
<li><a href="#manejadores">manejadores</a></li>
<li><a href="#canales">canales</a></li>
<li><a href="#procesadores">procesadores</a></li>
<li><a href="#formateadores">formateadores</a></li>
<li><a href="#uso-de-factorias">uso de factorías</a></li>
</ul>
</li>
<li><a href="#documentacion-con-phpdocumentor">Documentación con phpDocumentor</a><ul>
<li><a href="#instalacion-como-binario">instalación como binario</a></li>
<li><a href="#uso-del-docker">uso del Docker</a></li>
<li><a href="#docblock">DocBlock</a></li>
<li><a href="#documentando-el-codigo">documentando el código</a></li>
</ul>
</li>
<li><a href="#web-scraping">Web Scraping</a><ul>
<li><a href="#goutte">Goutte</a></li>
<li><a href="#goutte-con-selectores-css">Goutte con selectores CSS</a></li>
<li><a href="#crawler">Crawler</a></li>
</ul>
</li>
<li><a href="#pruebas-con-phpunit">Pruebas con PHPUnit</a><ul>
<li><a href="#puesta-en-marcha">puesta en marcha</a></li>
<li><a href="#disenando-pruebas">diseñando pruebas</a></li>
<li><a href="#aserciones">aserciones</a></li>
<li><a href="#comparando-la-salida">comparando la salida</a></li>
<li><a href="#proveedores-de-datos">proveedores de datos</a></li>
<li><a href="#probando-excepciones">probando excepciones</a></li>
<li><a href="#cobertura-de-codigo">cobertura de código</a></li>
</ul>
</li>
<li><a href="#referencias">referencias</a></li>
</ul>
</div>
<h1 id="duracion-y-criterios-de-evaluacion">duración y criterios de evaluación</h1>
<p><strong>Duración estimada</strong>: 16 sesiones</p>
<hr />
<p><strong>Resultado de aprendizaje y criterios de evaluación</strong>:</p>
<ol>
<li>Desarrolla aplicaciones Web embebidas en lenguajes de marcas analizando e incorporando funcionalidades según especificaciones.</li>
</ol>
<p>​       g) <em>Se han utilizado herramientas y entornos para facilitar la programación, prueba y depuración del código.</em></p>
<h1 id="composer">Composer</h1>
<p>Herramienta por excelencia en PHP para la gestión de librerías y dependencias, de manera que instala y las actualiza asegurando que todo el equipo de desarrollo tiene el mismo entorno y versiones. Además, ofrece autoloading de nuestro código, de manera que no tengamos que hacerlo nosotros "a mano".</p>
<p>Está escrito en PHP, y podéis consultar toda su documentación en https://getcomposer.org/.</p>
<p>Utiliza <a href="https://packagist.org/">Packagist</a> como repositorio de librerías.</p>
<p>Funcionalmente, es similar a Maven (Java) / npm (JS).</p>
<p><img src="/assets/logo-composer.png" style="zoom:60%;" /></p>
<h2 id="instalacion">instalación</h2>
<p>Si estamos usando XAMPP, hemos de instalar Composer en el propio sistema operativo. Se recomienda seguir las <a href="https://getcomposer.org/doc/00-intro.md">instrucciones oficiales</a> según el sistema operativo a emplear.</p>
<p>En cambio, si usamos Docker, necesitamos modificar la configuración de nuestro contenedor. En nuestro caso, hemos decidido modificar el archivo Dockerfile y añadir el siguiente comando:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>COPY<span class="w"> </span>--from<span class="o">=</span>composer:2.0<span class="w"> </span>/usr/bin/composer<span class="w"> </span>/usr/local/bin/composer<span class="w">  </span>
</code></pre></div></td></tr></table></div>
<p>Para facilitar el trabajo, hemos creado una <a href="http://localhost:51235/UD05_ES/resources/plantilla-APC.zip">plantilla ya preparada</a>.</p>
<p>Es importante que dentro del contenedor comprobemos que tenemos la v2:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>composer<span class="w"> </span>-V
</code></pre></div></td></tr></table></div>
<h2 id="primeros-pasos">primeros pasos</h2>
<p>Cuando creemos un proyecto por primera vez, hemos de inicializar el repositorio. Para ello, ejecutaremos el comando <code>composer init</code> donde:</p>
<ul>
<li>Configuramos el nombre del paquete, descripción, autor (nombre ), tipo de paquete (project), etc...</li>
<li>Definimos las dependencias del proyecto (<code>require</code>) y las de desarrollo (<code>require-dev</code>) de manera interactiva.</li>
<li>En las de desarrollo se indica aquellas que no se instalarán en el entorno de producción, por ejemplo, las librerías de pruebas.</li>
</ul>
<p>Tras su configuración, se creará automáticamente el archivo <code>composer.json</code> con los datos introducidos y descarga las librerías en la carpeta <code>vendor</code>. La instalación de las librerías siempre se realiza de manera local para cada proyecto.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">JSON</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dwes/log&quot;</span><span class="p">,</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Pruebas con Monolog&quot;</span><span class="p">,</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;project&quot;</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="nt">&quot;require&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">      </span><span class="nt">&quot;monolog/monolog&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^2.1&quot;</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">  </span><span class="p">},</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">  </span><span class="nt">&quot;license&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;MIT&quot;</span><span class="p">,</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">  </span><span class="nt">&quot;authors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">      </span><span class="p">{</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Nombre Apellido&quot;</span><span class="p">,</span><span class="w"> </span><span class="c1">// ejemplo: Carmen Llopis</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">        </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;inicialNombre.Apellido@edu.gva.es&quot;</span><span class="w"> </span><span class="c1">// ejemplo: c.llopis@edu.gva.es</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">  </span><span class="p">]</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>A la hora de indicar cada librería introduciremos:</p>
<ul>
<li>el nombre de la librería, compuesta tanto por el creador o "vendor", como por el nombre del proyecto. Ejemplos: <code>monolog/monolog</code> o <code>laravel/installer</code>.</li>
<li>la versión de cada librería. Tenemos diversas opciones para indicarla:</li>
<li>Directamente: 1.4.2</li>
<li>Con comodines: 1.*</li>
<li>A partir de: &gt;= 2.0.3</li>
<li>Sin rotura de cambios: ^1.3.2 // &gt;=1.3.2 &lt;2.0.0</li>
</ul>
<h2 id="actualizar-librerias">actualizar librerías</h2>
<p>Podemos definir las dependencias via el archivo composer.json o mediante comandos con el formato composer require vendor/package:version. Por ejemplo, si queremos añadir phpUnit como librería de desarrollo, haremos:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>composer<span class="w"> </span>require<span class="w"> </span>phpunit/phpunit<span class="w"> </span>–dev
</code></pre></div></td></tr></table></div>
<p>Tras añadir nuevas librerías, hemos de actualizar nuestro proyecto:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>composer<span class="w"> </span>update
</code></pre></div></td></tr></table></div>
<p>Si creamos el archivo <code>composer.json</code> nosotros directamente sin inicializar el repositorio, hemos de instalar las dependencias:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a>composer<span class="w"> </span>install
</code></pre></div></td></tr></table></div>
<p>Al hacer este paso (tanto instalar como actualizar), como ya hemos comentado, se descargan las librerías en dentro de la carpeta <code>vendor</code>. Es muy importante añadir esta carpeta al archivo <code>.gitignore</code> para no subirlas a GitHub.</p>
<p>Además se crea el archivo <code>composer.lock</code>, que almacena la versión exacta que se ha instalado de cada librería (este archivo no se toca).</p>
<h2 id="autoloadphp">autoload.php</h2>
<p>Composer crea de forma automática en <code>vendor/autoload.php</code> el código para incluir de forma automática todas las librerías que tengamos configuradas en <code>composer.json</code>.</p>
<p>Para utilizarlo, en la cabecera de nuestro archivos pondremos:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>    <span class="k">require</span> <span class="s1">&#39;vendor/autoload.php&#39;</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>En nuestro caso, de momento sólo lo podremos en los archivos donde probamos las clases</p>
<p>Si queremos que Composer también se encargue de cargar de forma automática nuestras clases de dominio, dentro del archivo <code>composer.json</code>, definiremos la propiedad <code>autoload</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="x">&quot;autoload&quot;: {</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="x">    &quot;psr-4&quot;: {&quot;Dwes\\&quot;: &quot;app/Dwes&quot;}</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="x">},</span>
</code></pre></div></td></tr></table></div>
<p>Posteriormente, hemos de volver a generar el autoload de Composer mediante la opción <code>dump-autoload</code>(o <code>du</code>):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a>composer<span class="w"> </span>dump-autoload
</code></pre></div></td></tr></table></div>
<h1 id="monolog">Monolog</h1>
<p>Vamos a probar Composer añadiendo la librería de <a href="https://github.com/Seldaek/monolog">Monolog</a> a nuestro proyecto. Se trata de un librería para la gestión de logs de nuestras aplicaciones, soportando diferentes niveles (info, warning, etc...), salidas (ficheros, sockets, BBDD, Web Services, email, etc) y formatos (texto plano, HTML, JSON, etc...).</p>
<p>Para ello, incluiremos la librería en nuestro proyecto con:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a>composer<span class="w"> </span>require<span class="w"> </span>monolog/monolog
</code></pre></div></td></tr></table></div>
<p>Monolog 2 requiere al menos PHP 7.2, cumple con el estandar de logging PSR-3, y es la librería empleada por Laravel y Symfony para la gestión de logs.</p>
<blockquote>
<p><strong>cómo usar un log</strong></p>
<ul>
<li>Seguir las acciones/movimientos de los usuarios</li>
<li>Registrar las transacciones</li>
<li>Rastrear los errores de usuario</li>
<li>Fallos/avisos a nivel de sistema</li>
<li>Interpretar y coleccionar datos para posterior investigación de patrones</li>
</ul>
</blockquote>
<h2 id="niveles">niveles</h2>
<p>A continuación mostramos los diferentes niveles de menos a más restrictivo:</p>
<ul>
<li><em>debug -100</em> : Información detallada con propósitos de debug. No usar en entornos de producción.</li>
<li><em>info - 200</em> : Eventos interesantes como el inicio de sesión de usuarios.</li>
<li><em>notice - 250</em> : Eventos normales pero significativos.</li>
<li><em>warning - 300</em> : Ocurrencias excepcionales que no llegan a ser error.</li>
<li><em>error - 400</em> : Errores de ejecución que permiten continuar con la ejecución de la aplicación pero que deben ser monitorizados.</li>
<li><em>critical - 500</em> : Situaciones importantes donde se generan excepciones no esperadas o no hay disponible un componente.</li>
<li><em>alert - 550</em> : Se deben tomar medidas inmediatamente. Caída completa de la web, base de datos no disponible, etc... Además, se suelen enviar mensajes por email.</li>
<li><em>emergency - 600</em> : Es el error más grave e indica que todo el sistema está inutilizable.</li>
</ul>
<h2 id="hola-monolog">Hola Monolog</h2>
<p>Por ejemplo, en el archivo <code>pruebaLog.php</code> que colocaríamos en el raíz, primero incluimos el <em>autoload</em>, importamos las clases a utilizar para finalmente usar los métodos de Monolog:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>  <span class="k">include</span> <span class="no">__DIR__</span> <span class="o">.</span><span class="s2">&quot;/vendor/autoload.php&quot;</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>  <span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>  <span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>  <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">);</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">);</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de WARNING&quot;</span><span class="p">);</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de ERROR&quot;</span><span class="p">);</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">critical</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de CRITICAL&quot;</span><span class="p">);</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">alert</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de ALERT&quot;</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p>En todos los métodos de registro de mensajes (<code>debug</code>, <code>info</code>, ...), además del propio mensaje, le podemos pasar información como el contenido de alguna variable, usuario de la aplicación, etc.. como segundo parámetro dentro de un array, el cual se conoce como <strong>array de contexto</strong>. Es conveniente hacerlo mediante un array asociativo para facilitar la lectura del log.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span>
<span class="normal"><a href="#__codelineno-11-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$producto</span><span class="p">]);</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;datos&quot;</span> <span class="o">=&gt;</span> <span class="nv">$producto</span><span class="p">]);</span>
</code></pre></div></td></tr></table></div>
<h2 id="funcionamiento">funcionamiento</h2>
<p>Cada instancia <code>Logger</code> tiene un nombre de canal y una pila de manejadores (<em>handler</em>). Cada mensaje que mandamos al log atraviesa la pila de manejadores, y cada uno decide si debe registrar la información, y si se da el caso, finalizar la propagación. Por ejemplo, un <code>StreamHandler</code> en el fondo de la pila que lo escriba todo en disco, y en el tope añade un <code>MailHandler</code> que envíe un mail sólo cuando haya un error.</p>
<h2 id="manejadores">manejadores</h2>
<p>Cada manejador tambien tiene un formateador (<code>Formatter</code>). Si no se indica ninguno, se le asigna uno por defecto. El último manejador insertado será el primero en ejecutarse. Luego se van ejecutando conforme a la pila.</p>
<p>Los manejadores más utilizados son:</p>
<ul>
<li><code>StreamHandler(ruta, nivel)</code></li>
<li><code>RotatingFileHandler(ruta, maxFiles, nivel)</code></li>
<li><code>NativeMailerHandler(para, asunto, desde, nivel)</code></li>
<li><code>FirePHPHandler(nivel)</code></li>
</ul>
<p>Si queremos que los mensajes de la aplicación salgan por el log del servidor, en nuestro caso el archivo <code>error.log</code> de <em>Apache</em> utilizaremos como ruta la salida de error:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>    <span class="c1">// error.log</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>    <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;php://stderr&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>FirePHP</strong></p>
<p>Por ejemplo, mediante FirePHPHandler, podemos utilizar FirePHP, la cual es una herramienta para hacer debug en la consola de Firefox. Tras instalar la extensión en Firefox, habilitar las opciones y configurar el Handler, podemos ver los mensajes coloreados con sus datos:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span>
<span class="normal"><a href="#__codelineno-13-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>     <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiFirePHPLogger&quot;</span><span class="p">);</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>     <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">FirePHPHandler</span><span class="p">(</span><span class="nx">Logger</span><span class="o">::</span><span class="na">INFO</span><span class="p">));</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>     <span class="nv">$datos</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;real&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Bruce Wayne&quot;</span><span class="p">,</span> <span class="s2">&quot;personaje&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Batman&quot;</span><span class="p">];</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>     <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">debug</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>     <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">info</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de INFO&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>     <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Esto es un mensaje de WARNING&quot;</span><span class="p">,</span> <span class="nv">$datos</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p><img alt="" src="/assets/img01-usoFirePHP.png" /></p>
</blockquote>
<h2 id="canales">canales</h2>
<p>Se les asigna al crear el Logger. En grandes aplicaciones, se crea un canal por cada subsistema: ventas, contabilidad, almacén. No es una buena práctica usar el nombre de la clase como canal, esto se hace con un <em>procesador</em>.</p>
<p>Para su uso, es recomiendo asignar el log a una propiedad privada a Logger, y posteriormente, en el constructor de la clase, asignar el canal, manejadores y formato.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiApp&quot;</span><span class="p">);</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">FirePHPHandler</span><span class="p">(</span><span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
</code></pre></div></td></tr></table></div>
<p>Y dentro de los métodos para escribir en el log:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">log</span><span class="o">-&gt;</span><span class="na">warning</span><span class="p">(</span><span class="s2">&quot;Producto no encontrado&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nv">$producto</span><span class="p">]);</span>
</code></pre></div></td></tr></table></div>
<h2 id="procesadores">procesadores</h2>
<p>Los procesadores permiten añadir información a los mensajes. Para ello, se apilan después de cada manejador mediante el método <code>pushProcessor($procesador)</code>.</p>
<p>Algunos procesadores conocidos son <code>IntrospectionProcessor</code> (muestran la linea, fichero, clase y metodo desde el que se invoca el log), <code>WebProcessor</code> (añade la URI, método e IP) o <code>GitProcessor</code> (añade la rama y el commit).</p>
<p><strong>PHP</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span>
<span class="normal"><a href="#__codelineno-16-6">6</a></span>
<span class="normal"><a href="#__codelineno-16-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>  <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">RotatingFileHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushProcessor</span><span class="p">(</span><span class="k">new</span> <span class="nx">IntrospectionProcessor</span><span class="p">());</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;php://stderr&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">WARNING</span><span class="p">));</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>  <span class="c1">// no usa Introspection pq lo hemos apilado después, le asigno otro</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushProcessor</span><span class="p">(</span><span class="k">new</span> <span class="nx">WebProcessor</span><span class="p">());</span>
</code></pre></div></td></tr></table></div>
<p><strong>Consola en formato texto</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="o">[</span><span class="m">2020</span>-11-26T13:35:31.076138+01:00<span class="o">]</span><span class="w"> </span>MiLogger.DEBUG:<span class="w"> </span>Esto<span class="w"> </span>es<span class="w"> </span>un<span class="w"> </span>mensaje<span class="w"> </span>de<span class="w"> </span>DEBUG<span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="o">{</span><span class="s2">&quot;file&quot;</span>:<span class="s2">&quot;C:\\xampp\\htdocs\\log\\procesador.php&quot;</span>,<span class="s2">&quot;line&quot;</span>:12,<span class="s2">&quot;class&quot;</span>:null,<span class="s2">&quot;function&quot;</span>:null<span class="o">}</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="o">[</span><span class="m">2020</span>-11-26T13:35:31.078344+01:00<span class="o">]</span><span class="w"> </span>MiLogger.INFO:<span class="w"> </span>Esto<span class="w"> </span>es<span class="w"> </span>un<span class="w"> </span>mensaje<span class="w"> </span>de<span class="w"> </span>INFO<span class="w"> </span><span class="o">[]</span><span class="w"> </span><span class="o">{</span><span class="s2">&quot;file&quot;</span>:<span class="s2">&quot;C:\\xampp\\htdocs\\log\\procesador.php&quot;</span>,<span class="s2">&quot;line&quot;</span>:13,<span class="s2">&quot;class&quot;</span>:null,<span class="s2">&quot;function&quot;</span>:null<span class="o">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="formateadores">formateadores</h2>
<p>Se asocian a los manejadores con setFormatter. Los formateadores más utilizados son LineFormatter, HtmlFormatter o JsonFormatter.</p>
<p><strong>PHP</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>  <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="s2">&quot;MiLogger&quot;</span><span class="p">);</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>  <span class="nv">$rfh</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RotatingFileHandler</span><span class="p">(</span><span class="s2">&quot;logs/milog.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">);</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>  <span class="nv">$rfh</span><span class="o">-&gt;</span><span class="na">setFormatter</span><span class="p">(</span><span class="k">new</span> <span class="nx">JsonFormatter</span><span class="p">());</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>  <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="nv">$rfh</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<p><strong>Consola en JSON</strong></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="o">{</span><span class="s2">&quot;message&quot;</span>:<span class="s2">&quot;Esto es un mensaje de DEBUG&quot;</span>,<span class="s2">&quot;context&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;level&quot;</span>:100,<span class="s2">&quot;level_name&quot;</span>:<span class="s2">&quot;DEBUG&quot;</span>,<span class="s2">&quot;channel&quot;</span>:<span class="s2">&quot;MiLogger&quot;</span>,<span class="s2">&quot;datetime&quot;</span>:<span class="s2">&quot;2020-11-27T15:36:52.747211+01:00&quot;</span>,<span class="s2">&quot;extra&quot;</span>:<span class="o">{}}</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="o">{</span><span class="s2">&quot;message&quot;</span>:<span class="s2">&quot;Esto es un mensaje de INFO&quot;</span>,<span class="s2">&quot;context&quot;</span>:<span class="o">{}</span>,<span class="s2">&quot;level&quot;</span>:200,<span class="s2">&quot;level_name&quot;</span>:<span class="s2">&quot;INFO&quot;</span>,<span class="s2">&quot;channel&quot;</span>:<span class="s2">&quot;MiLogger&quot;</span>,<span class="s2">&quot;datetime&quot;</span>:<span class="s2">&quot;2020-11-27T15:36:52.747</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>más información</strong></p>
<p>Más información sobre manejadores, formateadores y procesadores en <a href="https://github.com/Seldaek/monolog/blob/main/doc/02-handlers-formatters-processors.md">https://github.com/Seldaek/monolog/blob/master/doc/02-handlers-formatters-processors.md</a></p>
</blockquote>
<h2 id="uso-de-factorias">uso de factorías</h2>
<p>En vez de instanciar un log en cada clase, es conveniente crear una factoría (por ejemplo, siguiendo la idea del patrón de diseño <a href="https://refactoring.guru/es/design-patterns/factory-method">Factory Method</a>).</p>
<p>Para el siguiente ejemplo, vamos a suponer que creamos la factoría en el <code>namespace Dwes\Ejemplos\Util</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>  <span class="k">namespace</span> <span class="nx">Dwes\Ejemplos\Util</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>  <span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>  <span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>  <span class="k">class</span> <span class="nc">LogFactory</span> <span class="p">{</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLogger</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$canal</span> <span class="o">=</span> <span class="s2">&quot;miApp&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">Logger</span> <span class="p">{</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a>      <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="nv">$canal</span><span class="p">);</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a>      <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;logs/miApp.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>      <span class="k">return</span> <span class="nv">$log</span><span class="p">;</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>    <span class="p">}</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a>  <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Si en vez de devolver un <code>Monolog\Logger</code> utilizamos el interfaz de PSR, si en el futuro cambiamos la implementación del log, no tendremos que modificar nuestro codigo. Así pues, la factoría ahora devolverá <code>Psr\Log\LoggerInterface</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>  <span class="k">namespace</span> <span class="nx">Dwes\Ejemplos\Util</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>  <span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>  <span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>  <span class="k">use</span> <span class="nx">Psr\Log\LoggerInterface</span><span class="p">;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>  <span class="k">class</span> <span class="nc">LogFactory</span> <span class="p">{</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLogger</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$canal</span> <span class="o">=</span> <span class="s2">&quot;miApp&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">LoggerInterface</span> <span class="p">{</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>      <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="nv">$canal</span><span class="p">);</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a>      <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;log/miApp.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a>      <span class="k">return</span> <span class="nv">$log</span><span class="p">;</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a>    <span class="p">}</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a>  <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Finalmente, para utilizar la factoría, sólo cambiamos el código que teníamos en el constructor de las clases que usan el log, quedando algo asi:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>  <span class="k">namespace</span> <span class="nx">Dwes\Ejemplos\Util</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>  <span class="k">use</span> <span class="nx">Monolog\Handler\StreamHandler</span><span class="p">;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>  <span class="k">use</span> <span class="nx">Monolog\Logger</span><span class="p">;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>  <span class="k">use</span> <span class="nx">Psr\Log\LoggerInterface</span><span class="p">;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a>  <span class="k">class</span> <span class="nc">LogFactory</span> <span class="p">{</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a>    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">getLogger</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$canal</span> <span class="o">=</span> <span class="s2">&quot;miApp&quot;</span><span class="p">)</span> <span class="o">:</span> <span class="nx">LoggerInterface</span> <span class="p">{</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>      <span class="nv">$log</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Logger</span><span class="p">(</span><span class="nv">$canal</span><span class="p">);</span>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a>      <span class="nv">$log</span><span class="o">-&gt;</span><span class="na">pushHandler</span><span class="p">(</span><span class="k">new</span> <span class="nx">StreamHandler</span><span class="p">(</span><span class="s2">&quot;log/miApp.log&quot;</span><span class="p">,</span> <span class="nx">Logger</span><span class="o">::</span><span class="na">DEBUG</span><span class="p">));</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a>      <span class="k">return</span> <span class="nv">$log</span><span class="p">;</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a>    <span class="p">}</span>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a>  <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h1 id="documentacion-con-phpdocumentor">Documentación con phpDocumentor</h1>
<p><a href="https://www.phpdoc.org/">phpDocumentor</a> es la herramienta de facto para documentar el código PHP. Es similar en propósito y funcionamiento a <em>Javadoc</em>.</p>
<p>Así pues, es un herramienta que facilita la documentación del código PHP, creando un sitio web con el API de la aplicación.</p>
<p>Se basa en el uso de anotaciones sobre los docblocks. Para ponerlo en marcha, en nuestro caso nos decantaremos por utilizar la imagen que ya existe de Docker.</p>
<h2 id="instalacion-como-binario">instalación como binario</h2>
<p>Otra opción es seguir los pasos que recomienda la <a href="https://www.phpdoc.org/">documentación oficial</a> para instalarlo como un ejecutable, que son descargar el archivo <code>phpDocumentor.phar</code> y darles permisos de ejecución:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span>
<span class="normal"><a href="#__codelineno-23-2">2</a></span>
<span class="normal"><a href="#__codelineno-23-3">3</a></span>
<span class="normal"><a href="#__codelineno-23-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a>wget<span class="w"> </span>https://phpdoc.org/phpDocumentor.phar
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>phpDocumentor.phar
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>mv<span class="w"> </span>phpDocumentor.phar<span class="w"> </span>/usr/local/bin/phpdoc
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>phpdoc<span class="w"> </span>--version
</code></pre></div></td></tr></table></div>
<p>Una vez instalado, desde el raíz del proyecto, suponiendo que tenemos nuestro código dentro de <code>app</code> y que queremos la documentación dentro de <code>docs/api</code> ejecutamos:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a>phpdoc<span class="w"> </span>-d<span class="w"> </span>./app<span class="w"> </span>-t<span class="w"> </span>docs/api
</code></pre></div></td></tr></table></div>
<h2 id="uso-del-docker">uso del Docker</h2>
<p>En el caso de usar Docker, usaremos el siguiente comando para ejecutarlo (crea el contenedor, ejecuta el comando que le pidamos, y automáticamente lo borra):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Docker</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>:/data<span class="w"> </span>phpdoc/phpdoc:3
</code></pre></div></td></tr></table></div>
<p>A dicho comando, le adjuntaremos los diferentes parámetros que admite phpDocumentor, por ejemplo:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># Muestra la versión</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>:/data<span class="w"> </span>phpdoc/phpdoc:3<span class="w"> </span>--version
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="c1"># Mediante -d se indica el origen a parsear</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="c1"># Mediante -t se indica el destino donde generar la documentación</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span><span class="s2">&quot;</span>:/data<span class="w"> </span>phpdoc/phpdoc:3<span class="w"> </span>-d<span class="w"> </span>./src/app<span class="w"> </span>-t<span class="w"> </span>./docs/api
</code></pre></div></td></tr></table></div>
<h2 id="docblock">DocBlock</h2>
<p>Un docblock es el bloque de código que se coloca encima de un recurso. Su formato es:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>  <span class="cm">/*</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="cm">   * *Sumario*, una sola línea</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="cm">   *</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="cm">   * *Descripción* que puede utilizar varias líneas</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="cm">   * y que ofrece detalles del elemento o referencias</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="cm">   * para ampliar la información</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="cm">   *</span>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="cm">   * @param string $miArgumento con una *descripción* del argumento</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="cm">   * que puede usar varias líneas.</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="cm">   *</span>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="cm">   * @return void</span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="cm">   */</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a>  <span class="k">function</span> <span class="nf">miFuncion</span><span class="p">(</span><span class="nx">tipo</span> <span class="nv">$miArgumento</span><span class="p">)</span>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a>  <span class="p">{</span>
<a id="__codelineno-27-16" name="__codelineno-27-16"></a>  <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="documentando-el-codigo">documentando el código</h2>
<p>En todos los elementos, ademas del sumario y/o descripción, pondremos:</p>
<ul>
<li>En las clases:</li>
<li><code>@author</code> nombre</li>
<li><code>@package</code> ruta del namespace</li>
<li>En las propiedades:</li>
<li><code>@var</code> tipo descripción</li>
<li>En los métodos:</li>
<li><code>@param</code> tipo $nombre descripción</li>
<li><code>@throws</code> ClaseException descripción</li>
<li><code>@return</code> tipo descripción</li>
</ul>
<p>Veámoslo con un ejemplo. Supongamos que tenemos una clase que representa un cliente:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-28-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-28-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-28-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-28-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-28-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-28-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-28-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-28-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-28-10">10</a></span>
<span class="normal"><a href="#__codelineno-28-11">11</a></span>
<span class="normal"><a href="#__codelineno-28-12">12</a></span>
<span class="normal"><a href="#__codelineno-28-13">13</a></span>
<span class="normal"><a href="#__codelineno-28-14">14</a></span>
<span class="normal"><a href="#__codelineno-28-15">15</a></span>
<span class="normal"><a href="#__codelineno-28-16">16</a></span>
<span class="normal"><a href="#__codelineno-28-17">17</a></span>
<span class="normal"><a href="#__codelineno-28-18">18</a></span>
<span class="normal"><a href="#__codelineno-28-19">19</a></span>
<span class="normal"><a href="#__codelineno-28-20">20</a></span>
<span class="normal"><a href="#__codelineno-28-21">21</a></span>
<span class="normal"><a href="#__codelineno-28-22">22</a></span>
<span class="normal"><a href="#__codelineno-28-23">23</a></span>
<span class="normal"><a href="#__codelineno-28-24">24</a></span>
<span class="normal"><a href="#__codelineno-28-25">25</a></span>
<span class="normal"><a href="#__codelineno-28-26">26</a></span>
<span class="normal"><a href="#__codelineno-28-27">27</a></span>
<span class="normal"><a href="#__codelineno-28-28">28</a></span>
<span class="normal"><a href="#__codelineno-28-29">29</a></span>
<span class="normal"><a href="#__codelineno-28-30">30</a></span>
<span class="normal"><a href="#__codelineno-28-31">31</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a>  <span class="cm">/*</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="cm">   * Clase que representa un cliente</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="cm">   *</span>
<a id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="cm">   * El cliente se encarga de almacenar los soportes que tiene alquilado,</span>
<a id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="cm">   * de manera que podemos alquilar y devolver productos mediante las operaciones</span>
<a id="__codelineno-28-7" name="__codelineno-28-7"></a><span class="cm">   * homónimas.</span>
<a id="__codelineno-28-8" name="__codelineno-28-8"></a><span class="cm">   *</span>
<a id="__codelineno-28-9" name="__codelineno-28-9"></a><span class="cm">   * @package Dwes\Videoclub\Model</span>
<a id="__codelineno-28-10" name="__codelineno-28-10"></a><span class="cm">   * @author Aitor Medrano &lt;a.medrano@edu.gva.es&gt;</span>
<a id="__codelineno-28-11" name="__codelineno-28-11"></a><span class="cm">   */</span>
<a id="__codelineno-28-12" name="__codelineno-28-12"></a>  <span class="k">class</span> <span class="nc">Cliente</span> <span class="p">{</span>
<a id="__codelineno-28-13" name="__codelineno-28-13"></a>
<a id="__codelineno-28-14" name="__codelineno-28-14"></a>    <span class="k">public</span> <span class="nx">string</span> <span class="nv">$nombre</span><span class="p">;</span>
<a id="__codelineno-28-15" name="__codelineno-28-15"></a>    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$numero</span><span class="p">;</span>
<a id="__codelineno-28-16" name="__codelineno-28-16"></a>
<a id="__codelineno-28-17" name="__codelineno-28-17"></a>    <span class="cm">/*</span>
<a id="__codelineno-28-18" name="__codelineno-28-18"></a><span class="cm">     * Colección de soportes alquilados</span>
<a id="__codelineno-28-19" name="__codelineno-28-19"></a><span class="cm">     * @var array&lt;Soporte&gt;</span>
<a id="__codelineno-28-20" name="__codelineno-28-20"></a><span class="cm">     */</span>
<a id="__codelineno-28-21" name="__codelineno-28-21"></a>    <span class="k">private</span> <span class="nv">$soportesAlquilados</span><span class="p">[];</span>
<a id="__codelineno-28-22" name="__codelineno-28-22"></a>
<a id="__codelineno-28-23" name="__codelineno-28-23"></a>
<a id="__codelineno-28-24" name="__codelineno-28-24"></a>    <span class="cm">/*</span>
<a id="__codelineno-28-25" name="__codelineno-28-25"></a><span class="cm">     * Comprueba si el soporte recibido ya lo tiene alquilado el cliente</span>
<a id="__codelineno-28-26" name="__codelineno-28-26"></a><span class="cm">     * @param Soporte $soporte Soporte a comprobar</span>
<a id="__codelineno-28-27" name="__codelineno-28-27"></a><span class="cm">     * @return bool true si lo tiene alquilado</span>
<a id="__codelineno-28-28" name="__codelineno-28-28"></a><span class="cm">     */</span>
<a id="__codelineno-28-29" name="__codelineno-28-29"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">tieneAlquilado</span><span class="p">(</span><span class="nx">Soporte</span> <span class="nv">$soporte</span><span class="p">)</span> <span class="o">:</span> <span class="nx">bool</span> <span class="p">{</span>
<a id="__codelineno-28-30" name="__codelineno-28-30"></a>      <span class="c1">// ...</span>
<a id="__codelineno-28-31" name="__codelineno-28-31"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Si generamos la documentación y abrimos con un navegador el archivo <code>docs/api/index.html</code> podremos navegar hasta la clase <code>Cliente</code>:</p>
<p><img src="/assets/img02_phpdoc.png" style="zoom: 67%;" /></p>
<h1 id="web-scraping">Web Scraping</h1>
<p>Consiste en navegar a una página web y extraer información automáticamente, a partir del código HTML generado, y organizar la información pública disponible en Internet.</p>
<p>Esta práctica requiere el uso de una librería que facilite la descarga de la información deseada imitando la interacción de un navegador web. Este "robot" puede acceder a varias páginas simultáneamente.</p>
<blockquote>
<p><strong>es legal?</strong></p>
<p>Si el sitio web indica que tiene el contenido protegido por derechos de autor o en las normas de acceso via usuario/contraseña nos avisa de su prohibición, estaríamos incurriendo en un delito. Es recomendable estudiar el archivo <code>robots.txt</code> que se encuentra en el raíz de cada sitio web. Más información en el artículo <a href="https://ichi.pro/es/el-manual-completo-para-el-web-scraping-legal-y-etico-en-2021-69178542830388">El manual completo para el web scraping legal y ético en 2021</a>.</p>
</blockquote>
<h2 id="goutte">Goutte</h2>
<p><a href="https://github.com/FriendsOfPHP/Goutte">Goutte</a> es un sencillo cliente HTTP para PHP creado específicamente para hacer web scraping. Lo desarrolló el mismo autor del framework Symfony y ofrece un API sencilla para extraer datos de las respuestas HTML/XML de los sitios web.</p>
<p><strong>Datos</strong>: Revisar https://godofredo.ninja/web-scraping-con-php-utilizando-goutte/</p>
<p>Los componentes principales que abstrae Goutte sobre Symfony son:</p>
<ul>
<li><code>BrowserKit</code> : simula el comportamiento de un navegador web.</li>
<li><code>CssSelector</code> : traduce consultas CSS en consultas XPath.</li>
<li><code>DomCrawler</code> : facilita el uso del DOM y XPath.</li>
</ul>
<p>Para poder utilizar Goutte en nuestro proyecto, ejecutaremos el siguiente comando en el terminal:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a>composer<span class="w"> </span>require<span class="w"> </span>fabpot/goutte
</code></pre></div></td></tr></table></div>
<h2 id="goutte-con-selectores-css">Goutte con selectores CSS</h2>
<p>A continuación vamos a hacer un ejemplo muy sencillo utilizando los selectores CSS, extrayendo información de la web <code>https://books.toscrape.com/</code>, la cual es una página para pruebas que no rechazará nuestras peticiones.</p>
<p>Tras crear un cliente con Goutte, hemos de realizar un petición a una URL. Con la respuesta obtenida, podemos utilizar el método <code>filter</code> para indicarle la ruta CSS que queremos recorrer e iterar sobre los resultados mediante una función anónima. Una vez estamos dentro de un determinado nodo, el método <code>text()</code> nos devolverá el contenido del propio nodo.</p>
<p>En concreto, vamos a meter en un array asociativo el título y el precio de todos los libros de la categoría <em>Classics</em>.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span>
<span class="normal"><a href="#__codelineno-30-18">18</a></span>
<span class="normal"><a href="#__codelineno-30-19">19</a></span>
<span class="normal"><a href="#__codelineno-30-20">20</a></span>
<span class="normal"><a href="#__codelineno-30-21">21</a></span>
<span class="normal"><a href="#__codelineno-30-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a>  <span class="k">require</span> <span class="s1">&#39;../vendor/autoload.php&#39;</span><span class="p">;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a>  <span class="nv">$httpClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Goutte\Client</span><span class="p">();</span>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a>  <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$httpClient</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://books.toscrape.com/catalogue/category/books/classics_6/index.html&#39;</span><span class="p">);</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a>  <span class="c1">// colocamos los precios en un array</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a>  <span class="nv">$precios</span> <span class="o">=</span> <span class="p">[];</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a>  <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;.row li article div.product_price p.price_color&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>     <span class="c1">// le pasamos $precios por referencia para poder editarla dentro del closure</span>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a>     <span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$precios</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a>        <span class="nv">$precios</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
<a id="__codelineno-30-12" name="__codelineno-30-12"></a>     <span class="p">}</span>
<a id="__codelineno-30-13" name="__codelineno-30-13"></a>  <span class="p">);</span>
<a id="__codelineno-30-14" name="__codelineno-30-14"></a>
<a id="__codelineno-30-15" name="__codelineno-30-15"></a>  <span class="c1">// colocamos el nombre y el precio en un array asociativo</span>
<a id="__codelineno-30-16" name="__codelineno-30-16"></a>  <span class="nv">$contadorPrecios</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-30-17" name="__codelineno-30-17"></a>  <span class="nv">$libros</span> <span class="o">=</span> <span class="p">[];</span>
<a id="__codelineno-30-18" name="__codelineno-30-18"></a>  <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;.row li article h3 a&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span>
<a id="__codelineno-30-19" name="__codelineno-30-19"></a>     <span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$precios</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$contadorPrecios</span><span class="p">,</span> <span class="o">&amp;</span><span class="nv">$libros</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-30-20" name="__codelineno-30-20"></a>        <span class="nv">$libros</span><span class="p">[</span><span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">()]</span> <span class="o">=</span> <span class="nv">$precios</span><span class="p">[</span><span class="nv">$contadorPrecios</span><span class="p">];</span>
<a id="__codelineno-30-21" name="__codelineno-30-21"></a>        <span class="nv">$contadorPrecios</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-30-22" name="__codelineno-30-22"></a>     <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="crawler">Crawler</h2>
<p>Un caso muy común es obtener la información de una página que tiene los resultados paginados, de manera que vayamos recorriendo los enlaces y accediendo a cada uno de los resultados.</p>
<p>En este caso vamos a coger todos los precios de los libros de fantasía, y vamos a sumarlos:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-31-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-31-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-31-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-31-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-31-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-31-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-31-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-31-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-31-10">10</a></span>
<span class="normal"><a href="#__codelineno-31-11">11</a></span>
<span class="normal"><a href="#__codelineno-31-12">12</a></span>
<span class="normal"><a href="#__codelineno-31-13">13</a></span>
<span class="normal"><a href="#__codelineno-31-14">14</a></span>
<span class="normal"><a href="#__codelineno-31-15">15</a></span>
<span class="normal"><a href="#__codelineno-31-16">16</a></span>
<span class="normal"><a href="#__codelineno-31-17">17</a></span>
<span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span>
<span class="normal"><a href="#__codelineno-31-22">22</a></span>
<span class="normal"><a href="#__codelineno-31-23">23</a></span>
<span class="normal"><a href="#__codelineno-31-24">24</a></span>
<span class="normal"><a href="#__codelineno-31-25">25</a></span>
<span class="normal"><a href="#__codelineno-31-26">26</a></span>
<span class="normal"><a href="#__codelineno-31-27">27</a></span>
<span class="normal"><a href="#__codelineno-31-28">28</a></span>
<span class="normal"><a href="#__codelineno-31-29">29</a></span>
<span class="normal"><a href="#__codelineno-31-30">30</a></span>
<span class="normal"><a href="#__codelineno-31-31">31</a></span>
<span class="normal"><a href="#__codelineno-31-32">32</a></span>
<span class="normal"><a href="#__codelineno-31-33">33</a></span>
<span class="normal"><a href="#__codelineno-31-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a>  <span class="k">require</span> <span class="s1">&#39;../vendor/autoload.php&#39;</span><span class="p">;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>  <span class="k">use</span> <span class="nx">Goutte\Client</span><span class="p">;</span>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a>  <span class="k">use</span> <span class="nx">Symfony\Component\HttpClient\HttpClient</span><span class="p">;</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a>  <span class="nv">$client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Client</span><span class="p">(</span><span class="nx">HttpClient</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;timeout&#39;</span> <span class="o">=&gt;</span> <span class="mi">60</span><span class="p">]));</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a>  <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="s1">&#39;https://books.toscrape.com/catalogue/category/books/fantasy_19/index.html&#39;</span><span class="p">);</span>
<a id="__codelineno-31-9" name="__codelineno-31-9"></a>
<a id="__codelineno-31-10" name="__codelineno-31-10"></a>  <span class="nv">$salir</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<a id="__codelineno-31-11" name="__codelineno-31-11"></a>
<a id="__codelineno-31-12" name="__codelineno-31-12"></a>  <span class="nv">$precios</span> <span class="o">=</span> <span class="p">[];</span>
<a id="__codelineno-31-13" name="__codelineno-31-13"></a>  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nv">$salir</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-31-14" name="__codelineno-31-14"></a>      <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="s1">&#39;.row li article div.product_price p.price_color&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span>
<a id="__codelineno-31-15" name="__codelineno-31-15"></a>        <span class="k">function</span> <span class="p">(</span><span class="nv">$node</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="o">&amp;</span><span class="nv">$precios</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-31-16" name="__codelineno-31-16"></a>            <span class="nv">$texto</span> <span class="o">=</span> <span class="nv">$node</span><span class="o">-&gt;</span><span class="na">text</span><span class="p">();</span>
<a id="__codelineno-31-17" name="__codelineno-31-17"></a>            <span class="nv">$cantidad</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$texto</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">// Le quitamos las libras ¿2 posiciones?</span>
<a id="__codelineno-31-18" name="__codelineno-31-18"></a>            <span class="nv">$precios</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">floatval</span><span class="p">(</span><span class="nv">$cantidad</span><span class="p">);</span>
<a id="__codelineno-31-19" name="__codelineno-31-19"></a>        <span class="p">}</span>
<a id="__codelineno-31-20" name="__codelineno-31-20"></a>      <span class="p">);</span>
<a id="__codelineno-31-21" name="__codelineno-31-21"></a>
<a id="__codelineno-31-22" name="__codelineno-31-22"></a>      <span class="nv">$enlace</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">);</span>
<a id="__codelineno-31-23" name="__codelineno-31-23"></a>      <span class="k">if</span> <span class="p">(</span><span class="nv">$enlace</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-31-24" name="__codelineno-31-24"></a>          <span class="c1">// el enlace next existe</span>
<a id="__codelineno-31-25" name="__codelineno-31-25"></a>          <span class="nv">$sigPag</span> <span class="o">=</span> <span class="nv">$crawler</span><span class="o">-&gt;</span><span class="na">selectLink</span><span class="p">(</span><span class="s1">&#39;next&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">();</span>
<a id="__codelineno-31-26" name="__codelineno-31-26"></a>          <span class="nv">$crawler</span> <span class="o">=</span> <span class="nv">$client</span><span class="o">-&gt;</span><span class="na">click</span><span class="p">(</span><span class="nv">$sigPag</span><span class="p">);</span> <span class="c1">// hacemos click</span>
<a id="__codelineno-31-27" name="__codelineno-31-27"></a>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-31-28" name="__codelineno-31-28"></a>          <span class="c1">// ya no hay enlace next</span>
<a id="__codelineno-31-29" name="__codelineno-31-29"></a>          <span class="nv">$salir</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
<a id="__codelineno-31-30" name="__codelineno-31-30"></a>      <span class="p">}</span>
<a id="__codelineno-31-31" name="__codelineno-31-31"></a>  <span class="p">}</span>
<a id="__codelineno-31-32" name="__codelineno-31-32"></a>
<a id="__codelineno-31-33" name="__codelineno-31-33"></a>  <span class="nv">$precioTotal</span> <span class="o">=</span> <span class="nb">array_sum</span><span class="p">(</span><span class="nv">$precios</span><span class="p">);</span>
<a id="__codelineno-31-34" name="__codelineno-31-34"></a>  <span class="k">echo</span> <span class="nv">$precioTotal</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h1 id="pruebas-con-phpunit">Pruebas con PHPUnit</h1>
<p>El curso pasado, dentro del módulo de Entornos de Desarrollo, estudiamos la importancia de la realización de pruebas, así como las pruebas unitarias mediante <a href="https://junit.org/junit5/">JUnit</a>.</p>
<p>A día de hoy es de gran importancia seguir una buena metodología de pruebas, siendo el desarrollo dirigido por las pruebas (Test Driven Development / TDD) uno de los enfoques más empleados, el cual consiste en:</p>
<ol>
<li>
<p>Escribir el test, y como no hay código implementado, la prueba falle (rojo).</p>
</li>
<li>
<p>Escribir el código de aplicación para que la prueba funcione (verde).</p>
</li>
<li>
<p>Refactorizar el código de la aplicación con la ayuda de la prueba para comprobar que no rompemos nada (refactor).</p>
</li>
</ol>
<p><img src="/assets/img03_tdd.png" style="zoom:50%;" /></p>
<p>En el caso de PHP, la herramienta que se utiliza es PHPUnit (https://phpunit.de/), que como su nombre indica, está basada en JUnit. La versión actual es la 9.0</p>
<p>Se recomienda consultar su documentación en https://phpunit.readthedocs.io/es/latest/index.html.</p>
<h2 id="puesta-en-marcha">puesta en marcha</h2>
<p>Vamos a colocar todas las pruebas en una carpeta tests en el raíz de nuestro proyecto.</p>
<p>En el archivo composer.json, añadimos:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1">1</a></span>
<span class="normal"><a href="#__codelineno-32-2">2</a></span>
<span class="normal"><a href="#__codelineno-32-3">3</a></span>
<span class="normal"><a href="#__codelineno-32-4">4</a></span>
<span class="normal"><a href="#__codelineno-32-5">5</a></span>
<span class="normal"><a href="#__codelineno-32-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="x">&quot;require-dev&quot;: {</span>
<a id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="x">    &quot;phpunit/phpunit&quot;: &quot;^9&quot;</span>
<a id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="x">},</span>
<a id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="x">&quot;scripts&quot;: {</span>
<a id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="x">    &quot;test&quot;: &quot;phpunit --testdox --colors tests&quot;</span>
<a id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Si quisiéramos añadir la librería desde un comando del terminal, también podríamos ejecutar: </p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="x">composer require --dev phpunit/phpunit ^9</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>librerías de desarrollo</strong></p>
<p>Las librerías que se colocan en <code>require-dev</code> son las de desarrollo y <em>testing</em>, de manera que no se instalarán en un entorno de producción.</p>
</blockquote>
<p>Como hemos creado un script, podemos lanzar las pruebas mediante:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a>composer test
</code></pre></div></td></tr></table></div>
<p>Vasmos a realizar nuestra primera prueba:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span>
<span class="normal"><a href="#__codelineno-35-16">16</a></span>
<span class="normal"><a href="#__codelineno-35-17">17</a></span>
<span class="normal"><a href="#__codelineno-35-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a>  <span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a>  <span class="k">class</span> <span class="nc">PilaTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a>  <span class="p">{</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a>     <span class="k">public</span> <span class="k">function</span> <span class="nf">testPushAndPop</span><span class="p">()</span>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a>     <span class="p">{</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a>        <span class="nv">$pila</span> <span class="o">=</span> <span class="p">[];</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a>        <span class="nb">array_push</span><span class="p">(</span><span class="nv">$pila</span><span class="p">,</span> <span class="s1">&#39;batman&#39;</span><span class="p">);</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;batman&#39;</span><span class="p">,</span> <span class="nv">$pila</span><span class="p">[</span><span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a>
<a id="__codelineno-35-15" name="__codelineno-35-15"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="s1">&#39;batman&#39;</span><span class="p">,</span> <span class="nb">array_pop</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
<a id="__codelineno-35-16" name="__codelineno-35-16"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$pila</span><span class="p">));</span>
<a id="__codelineno-35-17" name="__codelineno-35-17"></a>     <span class="p">}</span>
<a id="__codelineno-35-18" name="__codelineno-35-18"></a>  <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Tenemos diferentes formas de ejecutar una prueba:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-1">1</a></span>
<span class="normal"><a href="#__codelineno-36-2">2</a></span>
<span class="normal"><a href="#__codelineno-36-3">3</a></span>
<span class="normal"><a href="#__codelineno-36-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1"></a>./vendor/bin/phpunit<span class="w"> </span>tests/PilaTest.php
<a id="__codelineno-36-2" name="__codelineno-36-2"></a>./vendor/bin/phpunit<span class="w"> </span>tests
<a id="__codelineno-36-3" name="__codelineno-36-3"></a>./vendor/bin/phpunit<span class="w"> </span>--testdox<span class="w"> </span>tests
<a id="__codelineno-36-4" name="__codelineno-36-4"></a>./vendor/bin/phpunit<span class="w"> </span>--testdox<span class="w"> </span>--colors<span class="w"> </span>tests
</code></pre></div></td></tr></table></div>
<h2 id="disenando-pruebas">diseñando pruebas</h2>
<p>Tal como hemos visto en el ejemplo, la clase de prueba debe heredar de <code>TestCase</code>, y el nombre de la clase debe acabar en <code>Test,</code> de ahí que hayamos llamado la clase de prueba como <code>PilaTest</code>.</p>
<p>Una prueba implica un método de prueba (público) por cada funcionalidad a probar. Cada un de los métodos se les asocia un caso de prueba.</p>
<p>Los métodos deben nombrarse con el prefijo <code>test</code>, por ejemplo, <code>testPushAndPop</code>. Es muy importante que el nombre sea muy claro y descriptivo del propósito de la prueba. (<em>camelCase</em>).</p>
<p>En los casos de prueba prepararemos varias aserciones para toda la casuística: rangos de valores, tipos de datos, excepciones, etc...</p>
<h2 id="aserciones">aserciones</h2>
<p>Las aserciones permiten comprobar el resultado de los métodos que queremos probar. Las aserciones esperan que el predicado siempre sea verdadero.</p>
<p>PHPUnit ofrece las siguiente aserciones:</p>
<ul>
<li><code>assertTrue</code> / <code>assertFalse</code>: Comprueba que la condición dada sea evaluada como <em>true</em> / <em>false</em>.</li>
<li><code>assertEquals</code> / <code>assertSame</code>: Comprueba que dos variables sean iguales.</li>
<li><code>assertNotEquals</code> / <code>assertNotSame</code>: Comprueba que dos variables NO sean iguales.</li>
<li><code>Same</code> → comprueba los tipos. Si no coinciden los tipos y los valores, la aserción fallará.</li>
<li><code>Equals</code> → sin comprobación estricta.</li>
<li><code>assertArrayHasKey</code> / <code>assertArrayNotHasKey</code>: Comprueba que un array posea un key determinado / o NO lo posea</li>
<li><code>assertArraySubset</code>: Comprueba que un array posea otro array como subset del mismo</li>
<li><code>assertAttributeContains</code> / <code>assertAttributeNotContains</code>: Comprueba que un atributo de una clase contenga una variable determinada / o NO contenga una variable determinada</li>
<li><code>assertAttributeEquals</code>: Comprueba que un atributo de una clase sea igual a una variable determinada.</li>
</ul>
<h2 id="comparando-la-salida">comparando la salida</h2>
<p>Si los métodos a probar generan contenido mediante <code>echo</code> o una instrucción similar, disponemos de las siguiente expectativas:</p>
<ul>
<li><code>expectOutputString(salidaEsperada)</code></li>
<li><code>expectOutputRegex(expresionRegularEsperada)</code></li>
</ul>
<p>Las expectativas difieren de las aserciones que informan del resultado que se espera antes de invocar al método. Tras definir la expectativa, se invoca al método que realiza el <code>echo</code> / <code>print</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-37-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-37-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-37-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-37-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-37-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-37-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-37-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-37-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-37-10">10</a></span>
<span class="normal"><a href="#__codelineno-37-11">11</a></span>
<span class="normal"><a href="#__codelineno-37-12">12</a></span>
<span class="normal"><a href="#__codelineno-37-13">13</a></span>
<span class="normal"><a href="#__codelineno-37-14">14</a></span>
<span class="normal"><a href="#__codelineno-37-15">15</a></span>
<span class="normal"><a href="#__codelineno-37-16">16</a></span>
<span class="normal"><a href="#__codelineno-37-17">17</a></span>
<span class="normal"><a href="#__codelineno-37-18">18</a></span>
<span class="normal"><a href="#__codelineno-37-19">19</a></span>
<span class="normal"><a href="#__codelineno-37-20">20</a></span>
<span class="normal"><a href="#__codelineno-37-21">21</a></span>
<span class="normal"><a href="#__codelineno-37-22">22</a></span>
<span class="normal"><a href="#__codelineno-37-23">23</a></span>
<span class="normal"><a href="#__codelineno-37-24">24</a></span>
<span class="normal"><a href="#__codelineno-37-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-37-2" name="__codelineno-37-2"></a>  <span class="k">namespace</span> <span class="nx">Dwes\Videoclub\Model</span><span class="p">;</span>
<a id="__codelineno-37-3" name="__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4"></a>  <span class="k">use</span> <span class="nx">PHPUnit\Framework\TestCase</span><span class="p">;</span>
<a id="__codelineno-37-5" name="__codelineno-37-5"></a>  <span class="k">use</span> <span class="nx">Dwes\Videoclub\Model\CintaVideo</span><span class="p">;</span>
<a id="__codelineno-37-6" name="__codelineno-37-6"></a>
<a id="__codelineno-37-7" name="__codelineno-37-7"></a>  <span class="k">class</span> <span class="nc">CintaVideoTest</span> <span class="k">extends</span> <span class="nx">TestCase</span> <span class="p">{</span>
<a id="__codelineno-37-8" name="__codelineno-37-8"></a>      <span class="k">public</span> <span class="k">function</span> <span class="nf">testConstructor</span><span class="p">()</span>
<a id="__codelineno-37-9" name="__codelineno-37-9"></a>      <span class="p">{</span>
<a id="__codelineno-37-10" name="__codelineno-37-10"></a>         <span class="nv">$cinta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">);</span>
<a id="__codelineno-37-11" name="__codelineno-37-11"></a>         <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span> <span class="nv">$cinta</span><span class="o">-&gt;</span><span class="na">getNumero</span><span class="p">(),</span> <span class="mi">23</span><span class="p">);</span>
<a id="__codelineno-37-12" name="__codelineno-37-12"></a>      <span class="p">}</span>
<a id="__codelineno-37-13" name="__codelineno-37-13"></a>
<a id="__codelineno-37-14" name="__codelineno-37-14"></a>      <span class="k">public</span> <span class="k">function</span> <span class="nf">testMuestraResumen</span><span class="p">()</span>
<a id="__codelineno-37-15" name="__codelineno-37-15"></a>      <span class="p">{</span>
<a id="__codelineno-37-16" name="__codelineno-37-16"></a>         <span class="nv">$cinta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">);</span>
<a id="__codelineno-37-17" name="__codelineno-37-17"></a>         <span class="nv">$resultado</span> <span class="o">=</span> <span class="s2">&quot;&lt;br&gt;Película en VHS:&quot;</span><span class="p">;</span>
<a id="__codelineno-37-18" name="__codelineno-37-18"></a>         <span class="nv">$resultado</span> <span class="o">.=</span> <span class="s2">&quot;&lt;br&gt;Los cazafantasmas&lt;br&gt;3.5 (IVA no incluido)&quot;</span><span class="p">;</span>
<a id="__codelineno-37-19" name="__codelineno-37-19"></a>         <span class="nv">$resultado</span> <span class="o">.=</span> <span class="s2">&quot;&lt;br&gt;Duración: 107 minutos&quot;</span><span class="p">;</span>
<a id="__codelineno-37-20" name="__codelineno-37-20"></a>         <span class="c1">// definimos la expectativa</span>
<a id="__codelineno-37-21" name="__codelineno-37-21"></a>         <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="nv">$resultado</span><span class="p">);</span>
<a id="__codelineno-37-22" name="__codelineno-37-22"></a>         <span class="c1">// invocamos al método que hará echo</span>
<a id="__codelineno-37-23" name="__codelineno-37-23"></a>         <span class="nv">$cinta</span><span class="o">-&gt;</span><span class="na">muestraResumen</span><span class="p">();</span>
<a id="__codelineno-37-24" name="__codelineno-37-24"></a>      <span class="p">}</span>
<a id="__codelineno-37-25" name="__codelineno-37-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="proveedores-de-datos">proveedores de datos</h2>
<p>Cuando tenemos pruebas que solo cambian respecto a los datos de entrada y de salida, es útil utilizar proveedores de datos.</p>
<p>Se declaran en el docblock mediante <code>@dataProvider nombreMetodo</code>, donde se indica el nombre de un método público que devuelve un array de arrays, donde cada elemento es un caso de prueba.</p>
<p>La clase de prueba recibe como parámetros los datos a probar y el resultado de la prueba como último parámetro.</p>
<p>El siguiente ejemplo comprueba con diferentes datos el funcionamiento de <code>muestraResumen</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-38-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-38-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-38-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-38-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-38-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-38-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-38-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-38-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-38-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-38-10">10</a></span>
<span class="normal"><a href="#__codelineno-38-11">11</a></span>
<span class="normal"><a href="#__codelineno-38-12">12</a></span>
<span class="normal"><a href="#__codelineno-38-13">13</a></span>
<span class="normal"><a href="#__codelineno-38-14">14</a></span>
<span class="normal"><a href="#__codelineno-38-15">15</a></span>
<span class="normal"><a href="#__codelineno-38-16">16</a></span>
<span class="normal"><a href="#__codelineno-38-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-38-2" name="__codelineno-38-2"></a>  <span class="cm">/*</span>
<a id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="cm">   * @dataProvider cintasProvider</span>
<a id="__codelineno-38-4" name="__codelineno-38-4"></a><span class="cm">   */</span>
<a id="__codelineno-38-5" name="__codelineno-38-5"></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">testMuestraResumenConProvider</span><span class="p">(</span><span class="nv">$titulo</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nv">$precio</span><span class="p">,</span> <span class="nv">$duracion</span><span class="p">,</span> <span class="nv">$esperado</span><span class="p">)</span>
<a id="__codelineno-38-6" name="__codelineno-38-6"></a>  <span class="p">{</span>
<a id="__codelineno-38-7" name="__codelineno-38-7"></a>     <span class="nv">$cinta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="nv">$titulo</span><span class="p">,</span> <span class="nv">$id</span><span class="p">,</span> <span class="nv">$precio</span><span class="p">,</span> <span class="nv">$duracion</span><span class="p">);</span>
<a id="__codelineno-38-8" name="__codelineno-38-8"></a>     <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectOutputString</span><span class="p">(</span><span class="nv">$esperado</span><span class="p">);</span>
<a id="__codelineno-38-9" name="__codelineno-38-9"></a>     <span class="nv">$cinta</span><span class="o">-&gt;</span><span class="na">muestraResumen</span><span class="p">();</span>
<a id="__codelineno-38-10" name="__codelineno-38-10"></a>  <span class="p">}</span>
<a id="__codelineno-38-11" name="__codelineno-38-11"></a>
<a id="__codelineno-38-12" name="__codelineno-38-12"></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">cintasProvider</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-38-13" name="__codelineno-38-13"></a>     <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-38-14" name="__codelineno-38-14"></a>        <span class="s2">&quot;cazafantasmas&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="s2">&quot;&lt;br&gt;VHS:&lt;br&gt;Los cazafantasmas&lt;br&gt;3.5 €(IVA no incluido)&lt;br&gt;Duración: 107 min&quot;</span><span class="p">],</span>
<a id="__codelineno-38-15" name="__codelineno-38-15"></a>        <span class="s2">&quot;superman&quot;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">&quot;Superman&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">188</span><span class="p">,</span> <span class="s2">&quot;&lt;br&gt;VHS:&lt;br&gt;Superman&lt;br&gt;3 € (IVA no incluido)&lt;br&gt;Duración: 188 min&quot;</span><span class="p">],</span>
<a id="__codelineno-38-16" name="__codelineno-38-16"></a>     <span class="p">];</span>
<a id="__codelineno-38-17" name="__codelineno-38-17"></a>  <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="probando-excepciones">probando excepciones</h2>
<p>Las pruebas además de comprobar que las clases funcionan como se espera, han de cubrir todos los casos posibles. Así pues, debemos poder hacer pruebas que esperen que se lance una excepción (y que el mensaje contenga cierta información):</p>
<p>Para ello, se utilizan las siguiente expectativas:</p>
<ul>
<li><code>expectException(Excepcion::class)</code></li>
<li><code>expectExceptionCode(codigoExcepcion)</code></li>
<li><code>expectExceptionMessage(mensaje)</code></li>
</ul>
<p>Del mismo modo que antes, primero se pone la expectativa, y luego se provoca que se lance la excepción:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span>
<span class="normal"><a href="#__codelineno-39-12">12</a></span>
<span class="normal"><a href="#__codelineno-39-13">13</a></span>
<span class="normal"><a href="#__codelineno-39-14">14</a></span>
<span class="normal"><a href="#__codelineno-39-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-39-2" name="__codelineno-39-2"></a>  <span class="k">public</span> <span class="k">function</span> <span class="nf">testAlquilarCupoLleno</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-39-3" name="__codelineno-39-3"></a>     <span class="nv">$soporte1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CintaVideo</span><span class="p">(</span><span class="s2">&quot;Los cazafantasmas&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">107</span><span class="p">);</span> 
<a id="__codelineno-39-4" name="__codelineno-39-4"></a>     <span class="nv">$soporte2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Juego</span><span class="p">(</span><span class="s2">&quot;The Last of Us Part II&quot;</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mf">49.99</span><span class="p">,</span> <span class="s2">&quot;PS4&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-39-5" name="__codelineno-39-5"></a>     <span class="nv">$soporte3</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dvd</span><span class="p">(</span><span class="s2">&quot;Origen&quot;</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;es,en,fr&quot;</span><span class="p">,</span> <span class="s2">&quot;16:9&quot;</span><span class="p">);</span> 
<a id="__codelineno-39-6" name="__codelineno-39-6"></a>     <span class="nv">$soporte4</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Dvd</span><span class="p">(</span><span class="s2">&quot;El Imperio Contraataca&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;es,en&quot;</span><span class="p">,</span><span class="s2">&quot;16:9&quot;</span><span class="p">);</span> 
<a id="__codelineno-39-7" name="__codelineno-39-7"></a>
<a id="__codelineno-39-8" name="__codelineno-39-8"></a>     <span class="nv">$cliente1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Cliente</span><span class="p">(</span><span class="s2">&quot;Bruce Wayne&quot;</span><span class="p">,</span> <span class="mi">23</span><span class="p">);</span> 
<a id="__codelineno-39-9" name="__codelineno-39-9"></a>     <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte1</span><span class="p">);</span> 
<a id="__codelineno-39-10" name="__codelineno-39-10"></a>     <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte2</span><span class="p">);</span> 
<a id="__codelineno-39-11" name="__codelineno-39-11"></a>     <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte3</span><span class="p">);</span> 
<a id="__codelineno-39-12" name="__codelineno-39-12"></a>
<a id="__codelineno-39-13" name="__codelineno-39-13"></a>     <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">expectException</span><span class="p">(</span><span class="nx">CupoSuperadoException</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-39-14" name="__codelineno-39-14"></a>     <span class="nv">$cliente1</span><span class="o">-&gt;</span><span class="na">alquilar</span><span class="p">(</span><span class="nv">$soporte4</span><span class="p">);</span> 
<a id="__codelineno-39-15" name="__codelineno-39-15"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="cobertura-de-codigo">cobertura de código</h2>
<p>La cobertura de pruebas indica la cantidad de código que las pruebas cubren, siendo recomendable que cubran entre el 95 y el 100%.</p>
<p>Una de las métricas asociadas a los informes de cobertura es el CRAP (Análisis y Predicciones sobre el Riesgo en Cambios), el cual mide la cantidad de esfuerzo, dolor y tiempo requerido para mantener una porción de código. Esta métrica debe mantenerse con un valor inferior a 5.</p>
<blockquote>
<p><strong>requisito xdebug</strong></p>
<p>Aunque ya viene instalado dentro de PHPUnit, para que funcione la cobertura del código, es necesario que el código PHP se ejecute con XDEBUG, y e indicarle a Apache que así es (colocando en el archivo de configuración <code>php.ini</code> la directiva <code>xdebug.mode=coverage</code>).</p>
</blockquote>
<p>Añadimos en <code>composer.json</code> un nuevo script:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1"></a>&quot;coverage&quot;: &quot;phpunit --coverage-html coverage --coverage-filter app tests&quot;
</code></pre></div></td></tr></table></div>
<p>Y posteriormente ejecutamos</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1"></a>composer coverage
</code></pre></div></td></tr></table></div>
<p>Por ejemplo, si accedemos a la clase <code>CintaVideo</code> con la prueba que habíamos realizado anteriormente, podemos observar la cobertura que tiene al 100% y que su CRAP es 2.</p>
<p><img src="/assets/img04_coverage.png" style="zoom:67%;" /></p>
<blockquote>
<p><strong>temas pendientes</strong></p>
<p><strong>-</strong> Dependencia entre casos de prueba con el atributo <code>@depends</code></p>
<p><strong>-</strong> Completamente configurable mediante el archivo <code>phpxml.xml</code>: https://phpunit.readthedocs.io/es/latest/configuration.html</p>
<p><strong>-</strong> Preparando las pruebas con <code>setUpBeforeClass()</code> y <code>tearDownAfterClass()</code></p>
<p><strong>-</strong> Objetos y pruebas <code>Mock (dobles)</code> con <code>createMock()</code></p>
</blockquote>
<h1 id="referencias">referencias</h1>
<ul>
<li><a href="https://desarrolloweb.com/manuales/tutorial-composer.html">Tutorial de Composer</a></li>
<li><a href="https://www.freecodecamp.org/news/web-scraping-with-php-crawl-web-pages/">Web Scraping with PHP – How to Crawl Web Pages Using Open Source Tools</a></li>
<li><a href="https://zetcode.com/php/monolog/">PHP Monolog</a></li>
<li><a href="https://medium.com/@emilianozublena/unit-testing-con-phpunit-parte-1-148c6d73e822">Unit Testing con PHPUnit — Parte 1,</a> de Emiliano Zublena.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer", "navigation.top"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>