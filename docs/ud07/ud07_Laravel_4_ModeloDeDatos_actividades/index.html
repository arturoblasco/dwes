<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>ud07 Laravel 4 ModeloDeDatos actividades - Desarrollo Web en Entorno Servidor (DWES)</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/color-brewer.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Desarrollo Web en Entorno Servidor (DWES)</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Inicio</a>
                            </li>
                            <li class="navitem">
                                <a href="../../ud01/ud0101/" class="nav-link">UD 1 Arquitectura Web</a>
                            </li>
                            <li class="navitem">
                                <a href="../../default/" class="nav-link">UD 2 Lenguaje PHP</a>
                            </li>
                            <li class="navitem">
                                <a href="../../default/" class="nav-link">UD 3 PHP Orientado a Objetos</a>
                            </li>
                            <li class="navitem">
                                <a href="../../default/" class="nav-link">UD 4 Programación Web</a>
                            </li>
                            <li class="navitem">
                                <a href="../../default/" class="nav-link">UD 5 Herramientas Web</a>
                            </li>
                            <li class="navitem">
                                <a href="../../default/" class="nav-link">UD 6 Acceso a Base de Datos</a>
                            </li>
                            <li class="navitem">
                                <a href="../../default/" class="nav-link">UD 7 Framework Laravel</a>
                            </li>
                            <li class="navitem">
                                <a href="../../default/" class="nav-link">UD 8 Laravel avanzado</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#ejercicios-propuestos" class="nav-link">ejercicios propuestos</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#parte-i" class="nav-link">parte I</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#ejercicio-2" class="nav-link">Ejercicio 2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#parte-ii" class="nav-link">parte II</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#bibliografia" class="nav-link">bibliografia</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<hr />
<p>unit: unidad didáctica 7
   title: Laravel - modelo de datos (actividades)
   language: ES
   author: Arturo Blasco
   subject: Desarrollo Web en Entorno Servidor
   keywords: [DWES, 2023, PHP, Laravel]
   IES: IES Mestre Ramón Esteve (Catadau) [iesmre.es]
   header: ${unit}: ${title} - ${subject} (versión: ${today})
   footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount}
   typora-root-url:${filename}/../
   typora-copy-images-to:${filename}/../assets</p>
<hr />
<div class="toc">
<ul>
<li><a href="#ejercicios-propuestos">ejercicios propuestos</a><ul>
<li><a href="#parte-i">parte I</a><ul>
<li><a href="#ejercicio-1">Ejercicio 1</a></li>
</ul>
</li>
<li><a href="#ejercicio-2">Ejercicio 2</a></li>
<li><a href="#parte-ii">parte II</a><ul>
<li><a href="#ejercicio-3">ejercicio 3</a></li>
<li><a href="#ejercicio-4">ejercicio 4</a></li>
<li><a href="#ejercicio-5">ejercicio 5</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bibliografia">bibliografia</a></li>
</ul>
</div>
<blockquote>
<p>El uso de estos materiales está sujeto a una licencia Creative Commons <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC</a>.</p>
<p>Material extraído de https://nachoiborraies.github.io/laravel/</p>
</blockquote>
<h1 id="ejercicios-propuestos">ejercicios propuestos</h1>
<h2 id="parte-i">parte I</h2>
<h3 id="ejercicio-1">Ejercicio 1</h3>
<p>Sobre el proyecto <strong>blog</strong> de la sesión anterior, vamos a añadir estos cambios:</p>
<ul>
<li>Crea una base de datos llamada <code>blog</code> en tu servidor de bases de datos a través de <em>phpMyAdmin</em>. Modifica también el archivo <code>.env</code> del proyecto para acceder a dicha base de datos con las credenciales adecuadas, similares a las del ejemplo de la biblioteca (cambiando el nombre de la base de datos).</li>
<li>Elimina todas las migraciones existentes, salvo la de <em>create_users_table</em>. Edita esta migración de la tabla usuarios para dejarla igual que el ejemplo de la biblioteca (únicamente con los campos <em>login</em> y <em>password</em>, además del <em>id</em> y los <em>timestamps</em>).</li>
<li>Crea una nueva migración llamada <code>crear_tabla_posts</code>, que creará una tabla llamada <code>posts</code> con estos campos:</li>
<li>Id autonumérico</li>
<li>Título del post (<code>string</code>)</li>
<li>Contenido del post (<code>text</code>)</li>
<li><em>Timestamps</em> para gestionar automáticamente la fecha de creación o modificación del post</li>
<li>Lanza las migraciones y comprueba que se crean las tablas correspondientes con los campos asociados en la base de datos.</li>
<li>Opcionalmente, puedes desactivar las migraciones de Sanctum en el proyecto Laravel, como se ha explicado al final de <a href="https://nachoiborraies.github.io/laravel/md/es/04b">este documento</a>, si al crear las migraciones aparece alguna otra tabla no deseada, como la de los <em>personal_access_tokens</em>. Recuerda ejecutar <code>php artisan migrate:fresh</code> de nuevo para borrar el rastro de esas tablas.</li>
</ul>
<h2 id="ejercicio-2">Ejercicio 2</h2>
<p>Continuamos con el proyecto <strong>blog</strong> anterior. Modifica si no lo has hecho aún el modelo <code>User</code> que viene por defecto para que se llame <code>Usuario</code>, igual que hemos hecho en el ejemplo de la biblioteca. Crea un nuevo modelo llamado <code>Post</code> para los posts de nuestro blog. Asegúrate de que ambos modelos se ubican en la carpeta <code>App\Models</code> del proyecto.</p>
<p>Después, modifica los métodos del controlador <code>PostController</code> creado en sesiones anteriores, de este modo:</p>
<ul>
<li>El método <code>index</code> debe obtener todos los posts de la tabla, y mostrar la vista <code>posts.index</code> con ese listado de posts.</li>
<li>La vista <code>posts.index</code>, por su parte, recibirá el listado de posts y mostrará los títulos de cada uno, y un botón <code>Ver</code> para mostrar su ficha (<code>posts.show</code>).</li>
<li>Debes mostrar el listado de posts ordenado por <em>título</em> en orden ascendente, y paginado de 5 en 5.</li>
<li>El método <code>show</code> debe obtener el post cuyo <code>id</code> se pasará como parámetro, y mostrarlo en la vista <code>posts.show</code> .</li>
<li>La vista <code>posts.show</code> recibirá el objeto con el post a mostrar, y mostraremos el título, contenido y fecha de creación del post, con el formato que quieras.</li>
<li>El método <code>destroy</code> eliminará el post cuyo <em>id</em> recibirá como parámetro, y devolverá la vista <code>posts.index</code> con el listado actualizado. Para probar este método, recuerda que debes definir un formulario en una vista (lo puedes hacer para cada post mostrado en la vista <code>posts.index</code>) que envíe a la ruta <code>posts.destroy</code> usando un método <em>DELETE</em>, como hemos explicado en un ejemplo anterior.</li>
<li>Los métodos <code>create</code>, <code>edit</code>, <code>store</code> y <code>update</code> de momento los vamos a dejar sin hacer, hasta que veamos cómo gestionar formularios.</li>
<li>Para simular la inserción y la modificación, vamos a crear dos métodos adicionales en el controlador, que usaremos de forma temporal:</li>
<li>Un método llamado <code>nuevoPrueba</code>, que cada vez que lo llamemos creará un post con un título al azar (por ejemplo, “Título X”, siendo X un entero aleatorio), y un contenido al azar (“Contenido X”). Puedes emplear la función <a href="https://www.php.net/manual/es/function.rand.php">rand</a> de PHP para generar estos números aleatorios para título y contenido.</li>
<li>Un método llamado <code>editarPrueba</code>, que recibirá como parámetro un <em>id</em> y modificará el título y contenido del post otros generados aleatoriamente, como en el punto anterior.</li>
<li>Estos dos métodos (especialmente el primero) nos servirán para crear una serie de posts de prueba que luego nos servirán para probar el listado y la ficha de los posts.</li>
<li>En el archivo <code>routes/web.php</code>, recuerda añadir dos nuevas rutas temporales de tipo <code>get</code> para probar estas inserciones y modificaciones. La primera puede apuntar a <code>/posts/nuevoPrueba</code>, por ejemplo, y la segunda a <code>/posts/editarPrueba/{id}</code>. Recuerda también eliminar o editar la restricción <code>only</code> de las rutas del controlador que estableciste la sesión anterior, para que no sólo permita las rutas <em>index</em>, <em>show</em>, <em>create</em> y <em>edit</em>, y además permita la de <em>destroy</em> (o todas las posibles, si quieres, ya que tarde o temprano las utilizaremos).</li>
</ul>
<blockquote>
<p><strong>IMPORTANTE</strong>: los métodos <code>nuevoPrueba</code> y <code>editarPrueba</code> que has creado en <code>PostController</code> NO son métodos estándar de un controlador de recursos, y de ninguna manera estarán disponibles a través de <code>Route::resource</code> en <code>routes/web.php</code>. Por eso debes definir a mano una ruta para cada uno de ellos en ese archivo, a través de <code>Route::get</code>, y esas rutas deben definirse ANTES de la de recursos (<code>Route::resource</code>) porque de lo contrario no se emparejarán correctamente.</p>
</blockquote>
<p><strong>¿Qué entregar?</strong></p>
<p>Como entrega de esta sesión deberás comprimir el proyecto <strong>blog</strong> con todos los cambios incorporados, y eliminando las carpetas <code>vendor</code> y <code>node_modules</code> como se explicó en las sesiones anteriores. Renombra el archivo comprimido a <code>blog_04.zip</code>.</p>
<h2 id="parte-ii">parte II</h2>
<h3 id="ejercicio-3">ejercicio 3</h3>
<p>Sobre el proyecto <strong>blog</strong> de la sesión anterior, vamos a añadir estos cambios:</p>
<ul>
<li>Crea una relación <em>uno a muchos</em> entre el modelo de <code>Usuario</code> y el modelo de <code>Post</code>, ambos ya existentes en la aplicación, de forma que un post es de un usuario, y un usuario puede tener muchos posts. Deberás definir una nueva migración de modificación sobre la tabla <em>posts</em> que añada un nuevo campo <code>usuario_id</code>, y establecer a partir de él la relación, como hemos hecho en el ejemplo con autores y libros.</li>
<li>Crea desde <em>phpMyAdmin</em> una serie de usuarios de prueba en la tabla <em>usuarios</em>, y asocia algunos de ellos a los posts que haya.</li>
<li>Modifica la vista <code>posts/index.blade.php</code> para que, junto al título de cada post, entre paréntesis, aparezca el login del usuario que lo creó.</li>
</ul>
<h3 id="ejercicio-4">ejercicio 4</h3>
<p>Continuamos con el proyecto <strong>blog</strong> anterior. Ahora añadiremos lo siguiente:</p>
<ul>
<li>Crea un <em>seeder</em> llamado <code>UsuariosSeeder</code>, con un factory asociado llamado <code>UsuarioFactory</code> (renombra el que viene por defecto <code>UserFactory</code> para aprovecharlo). Crea con esto 3 usuarios de prueba, con <em>logins</em> que sean únicos y de una sola palabra (usa el <em>faker</em>), y passwords también de una sola palabra, sin encriptar (para poderlos identificar después, llegado el caso).</li>
<li>Crea otro <em>seeder</em> llamado <code>PostsSeeder</code> con un factory asociado llamado <code>PostFactory</code>. En el <em>factory</em>, define con el <em>faker</em> títulos aleatorios (frases) y contenidos aleatorios (textos largos). Usa el <em>seeder</em> para crear 3 posts para cada uno de los usuarios existentes.</li>
</ul>
<p>Utiliza la opción <code>php artisan migrate:fresh --seed</code> para borrar todo contenido previo y poblar la base de datos con estos nuevos elementos. Comprueba después desde la página del listado de posts, y desde <em>phpMyAdmin</em>, que la información que aparece es correcta.</p>
<h3 id="ejercicio-5">ejercicio 5</h3>
<p><strong>Opcional</strong></p>
<p>Añade al proyecto <strong>blog</strong> un nuevo modelo llamado <code>Comentario</code>, junto con su migración y controlador asociados. Cada comentario tendrá como campo el contenido del comentario, y estará relacionado <em>uno a muchos</em> con el modelo <code>Usuario</code>, de forma que un usuario puede tener muchos comentarios, y cada comentario pertenece a un usuario. También tendrá una relación <em>uno a muchos</em> con el modelo <code>Post</code>, de modo que un comentario pertenece a un post, y un post puede tener muchos comentarios. Por lo tanto, la migración de los comentarios deberá tener como campos adicionales la relación con el usuario (<code>usuario_id</code>) y con el post al que pertenece (<code>post_id</code>).</p>
<p>Aplica la migración para reflejar la nueva tabla en la base de datos, y utiliza un <em>seeder</em> y un <em>factory</em> para crear 3 comentarios en cada post, con el usuario que sea. A la hora de aplicar todo esto, borra los contenidos previos de la base de datos (<code>migrate:fresh --seed</code>).</p>
<blockquote>
<p><strong>AYUDA</strong>: si quieres elegir un usuario al azar como autor de cada comentario, puedes hacer algo así:</p>
</blockquote>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>Usuario::inRandomOrder()-&gt;first();
</code></pre></div></td></tr></table></div>
<blockquote>
<p>En este caso, sería conveniente que ese usuario aleatorio se añada directamente en el <em>factory</em> del comentario, y no en el <em>seeder</em>, ya que de lo contrario es posible que genere el mismo usuario para todos los comentarios de un post.</p>
</blockquote>
<p>En la ficha de los posts (vista <code>posts/show.blade.php</code>), añade el código necesario para mostrar el <em>login</em> del usuario que ha hecho el <em>post</em>, y el listado de comentarios asociado al post, mostrando para cada uno el <em>login</em> del usuario que lo hizo, y el texto del comentario en sí. Utiliza también la librería <em>Carbon</em> para mostrar la fecha de creación del post (o la de los comentarios, como prefieras) en formato <em>d/m/Y</em>.</p>
<p>Aquí tienes una captura de pantalla de cómo podría quedar:</p>
<p><img alt="" src="./assets/ud07_4_listado_posts_comentarios.png" /></p>
<blockquote>
<p><strong>¿Qué entregar?</strong></p>
<p>Como entrega de esta sesión deberás comprimir el proyecto <strong>blog</strong> con todos los cambios incorporados, y eliminando las carpetas <code>vendor</code> y <code>node_modules</code> como se explicó en las sesiones anteriores. Renombra el archivo comprimido a <code>blog_07d.zip</code>.</p>
</blockquote>
<h1 id="bibliografia">bibliografia</h1>
<ul>
<li><a href="https://nachoiborraies.github.io/laravel/">Nacho Iborra Baeza</a>.</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../../js/jquery-3.6.0.min.js"></script>
        <script src="../../js/bootstrap.min.js"></script>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js"></script>
        <script src="../../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
