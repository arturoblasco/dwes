
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>ud06 AccesoADatos - Desarrollo Web en Entorno Servidor (DWES)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#duracion-y-criterios-de-evaluacion" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Desarrollo Web en Entorno Servidor (DWES)" class="md-header__button md-logo" aria-label="Desarrollo Web en Entorno Servidor (DWES)" data-md-component="logo">
      
  <img src="../../logo3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Desarrollo Web en Entorno Servidor (DWES)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ud06 AccesoADatos
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Canvia a mode oscur"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Canvia a mode oscur" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Canvia a mode normal"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canvia a mode normal" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Desarrollo Web en Entorno Servidor (DWES)" class="md-nav__button md-logo" aria-label="Desarrollo Web en Entorno Servidor (DWES)" data-md-component="logo">
      
  <img src="../../logo3.png" alt="logo">

    </a>
    Desarrollo Web en Entorno Servidor (DWES)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 1 Arquitectura Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 2 Lenguaje PHP
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 3 PHP Orientado a Objetos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 4 Programaci√≥n Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 5 Herramientas Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 6 Acceso a Base de Datos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 7 Framework Laravel
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 8 Laravel avanzado
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<hr />
<p>unit: unidad did√°ctica 6
   title: Acceso a datos
   language: ES
   author: Arturo Blasco
   subject: Desarrollo Web en Entorno Servidor
   keywords: [DWES, 2023, PHP]
   IES: IES Mestre Ram√≥n Esteve (Catadau) [iesmre.es]
   header: ${unit}: ${title} - ${subject} (versi√≥n: ${today})
   footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount}
   typora-root-url:${filename}/../
   typora-copy-images-to:${filename}/../assets</p>
<hr />
<div class="toc">
<ul>
<li><a href="#duracion-y-criterios-de-evaluacion">duraci√≥n y criterios de evaluaci√≥n</a></li>
<li><a href="#instalacion">instalaci√≥n</a></li>
<li><a href="#estructura-de-una-base-de-datos">estructura de una base de datos</a></li>
<li><a href="#chollosevero">CholloSevero</a></li>
<li><a href="#sql">SQL</a></li>
<li><a href="#phpmyadmin">phpMyAdmin</a><ul>
<li><a href="#creando-una-base-de-datos-dentro-de-phpmyadmin">Creando una base de datos dentro de phpMyAdmin</a></li>
<li><a href="#opciones-en-phpmyadmin">opciones en phpMyAdmin</a></li>
</ul>
</li>
<li><a href="#mysqli">MySQLi</a><ul>
<li><a href="#recuperando-datos-de-una-bd">recuperando datos de una BD</a></li>
</ul>
</li>
<li><a href="#php-data-objects-pdo">PHP Data Objects :: PDO</a><ul>
<li><a href="#fichero-de-configuracion-de-la-bd">fichero de configuraci√≥n de la BD</a></li>
<li><a href="#sentencias-preparadas">sentencias preparadas</a></li>
<li><a href="#ejemplo-parametros">ejemplo par√°metros</a></li>
<li><a href="#ejemplo-bindparam">ejemplo bindParam</a></li>
<li><a href="#bindvalue-vs-bindparam">bindValue VS bindParam</a></li>
<li><a href="#insertando-registros">insertando registros</a></li>
<li><a href="#consultando-registros">consultando registros</a></li>
<li><a href="#consultas-con-modelos">consultas con modelos</a></li>
<li><a href="#consultas-con-like">consultas con LIKE</a></li>
</ul>
</li>
<li><a href="#login-password">login &amp; password</a></li>
<li><a href="#acceso-a-ficheros">acceso a ficheros</a><ul>
<li><a href="#modos-de-apertura-de-ficheros">modos de apertura de ficheros</a></li>
<li><a href="#operaciones-con-archivos">operaciones con archivos</a></li>
<li><a href="#informacion-de-un-fichero">informaci√≥n de un fichero</a></li>
<li><a href="#archivos-pdf">archivos PDF</a></li>
</ul>
</li>
<li><a href="#referencias">referencias</a></li>
</ul>
</div>
<h1 id="duracion-y-criterios-de-evaluacion">duraci√≥n y criterios de evaluaci√≥n</h1>
<p>En esta unidad vamos a aprender a acceder a datos que se encuentran en un servidor; recuperando, editando y creando dichos datos a trav√©s de una base de datos.</p>
<p>A trav√©s de las distintas capas o niveles, de las cuales 2 de ellas ya conocemos (<em>Apache</em>, <em>PHP</em>) y <em>MySQL</em> la que vamos a estudiar en este tema.</p>
<p><strong>Duraci√≥n estimada</strong>: 12 sesiones</p>
<hr />
<p><strong>Resultado de aprendizaje y criterios de evaluaci√≥n</strong>:</p>
<p>RA6. Desarrolla aplicaciones de acceso a almacenes de datos, aplicando medidas para mantener la seguridad y la integridad de la informaci√≥n.</p>
<p><em>a) Se han analizado las tecnolog√≠as que permiten el acceso mediante programaci√≥n a la informaci√≥n disponible en almacenes de datos.</em></p>
<p><em>b) Se han creado aplicaciones que establezcan conexiones con bases de datos.</em> </p>
<p><em>c) Se ha recuperado informaci√≥n almacenada en bases de datos.</em> </p>
<p><em>d) Se ha publicado en aplicaciones web la informaci√≥n recuperada.</em> </p>
<p><em>e) Se han utilizado conjuntos de datos para almacenar la informaci√≥n.</em> </p>
<p><em>f) Se han creado aplicaciones web que permitan la actualizaci√≥n y la eliminaci√≥n de informaci√≥n disponible en una base de datos.</em> </p>
<p><em>g) Se han probado y documentado las aplicaciones web.</em></p>
<h1 id="instalacion">instalaci√≥n</h1>
<p><strong>XAMPP</strong>: simplemente nos descargar√≠amos el programa y lo activar√≠amos. Para descargar XAMPP <a href="https://www.apachefriends.org/es/download.html">pulsa aqu√≠</a>.</p>
<p><strong>Docker</strong>: utilizando el software de contenedores nos descargaremos la <strong>imagen docker de esta unidad did√°ctica del curso</strong> y lanzamos:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</code></pre></div></td></tr></table></div>
<p>Si todo ha salido bien y el contenedor est√° en marcha, podremos visitar la p√°gina de <em>phpMyAdmin</em> de la siguiente manera:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>http://localhost:8000
</code></pre></div></td></tr></table></div>
<p><img src="/assets/img01_06-bbdd-phpMyAdmin-login.png" style="zoom:40%;" /></p>
<p>Para acceder debemos utilizar las siguientes credenciales que vienen configuradas en el archivo <code>docker-compose.yml</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a>usuario:<span class="w"> </span>root
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>contrase√±a:<span class="w"> </span><span class="m">1234</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>Recuerda</strong></p>
<p>Podemos utilizar tambi√©n el docker <em>Portainer</em> para gestionar (lanzar, parar, acceder) a los contenedores generados en la imagen anterior.</p>
</blockquote>
<h1 id="estructura-de-una-base-de-datos">estructura de una base de datos</h1>
<p>Echando un vistazo al m√≥dulo de primer curso <em>Bases de Datos</em> sabemos que una base de datos tiene muchos campos con sus nombres y valores; pero adem√°s sabemos que la base de datos debe tener un nombre. Por tanto, tendr√≠amos la siguiente estructura para una base de datos:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>NombreBaseDeDatos
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="p">|</span>__Tabla-#1
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="p">|</span><span class="w">         </span><span class="p">|</span>__DatosTabla-#1
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="p">|</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="p">|</span>__Tabla-#2
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="p">|</span><span class="w">         </span><span class="p">|</span>__DatosTabla-#2
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="p">|</span><span class="w">    </span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="p">|</span>__Tabla-#3
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">    </span><span class="p">|</span><span class="w">         </span><span class="p">|</span>__DatosTabla-#3
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">    </span><span class="o">[</span>...<span class="o">]</span>
</code></pre></div></td></tr></table></div>
<p>Ve√°moslo en un ejemplo real:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Bash</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a>Ryanair
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="p">|</span>__pasajero
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="p">|</span><span class="w">     </span><span class="p">|</span>__id<span class="o">[</span>*<span class="o">]</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="p">|</span><span class="w">     </span><span class="p">|</span>__nombre
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">    </span><span class="p">|</span><span class="w">     </span><span class="p">|</span>__apellidos
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">    </span><span class="p">|</span><span class="w">     </span><span class="p">|</span>__edad
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">    </span><span class="p">|</span><span class="w">     </span><span class="p">|</span>__id_vuelo<span class="o">[</span>^<span class="o">]</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">    </span><span class="p">|</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">    </span><span class="p">|</span>__vuelo
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">    </span><span class="p">|</span><span class="w">     </span><span class="p">|</span>__id<span class="o">[</span>*<span class="o">]</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">    </span><span class="p">|</span><span class="w">     </span><span class="p">|</span>__n_plazas
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">    </span><span class="p">|</span><span class="w">     </span><span class="p">|</span>__disponible
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">    </span><span class="p">|</span><span class="w">     </span><span class="p">|</span>__id_pais<span class="o">[</span>^<span class="o">]</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">    </span><span class="p">|</span>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">    </span><span class="p">|</span>__pais
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="w">          </span><span class="p">|</span>__id<span class="o">[</span>*<span class="o">]</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="w">          </span><span class="p">|</span>__nombre
</code></pre></div></td></tr></table></div>
<p>[<em>] </em>Clave primaria<em>     [^] </em>Clave For√°nea*</p>
<p><img src="/assets/img02_06-bbdd-estructura.png" style="zoom: 50%;" /></p>
<h1 id="chollosevero">CholloSevero</h1>
<p>A lo largo de esta unidad vamos a trabajar con una base de datos que iremos confeccionando conforme avancemos; donde almacenaremos la informaci√≥n relacionada con ofertas que publiquen los usuarios y los listaremos en funci√≥n de varios filtros, nuevos, m√°s votados, m√°s vistos, m√°s comentados entre otros, al m√°s puro estilo <a href="https://www.chollometro.com/">Chollometro</a>.</p>
<p><img alt="" src="/assets/img03_06-chollometro.gif" /></p>
<h1 id="sql">SQL</h1>
<p>Utilizaremos el lenguaje de consulta estructurada (<em>Structured Query Language</em>) SQL para realizar las consultas a nuestras bases de datos y para mostrar el contenido en las distintas interfaces web que creemos a lo largo de la unidad. Si quieres saber m√°s detalles visita <a href="https://es.wikipedia.org/wiki/SQL">Wiki SQL</a>.</p>
<p>Ejemplo de una sentencia SQL donde seleccionamos todas las filas y columnas de nuestra tabla llamada <code>pais</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">pais</span>
</code></pre></div></td></tr></table></div>
<p>Estas sentencias pueden invocarse desde la consola de comandos mediante el int√©rprete <code>mysql*</code>(previamente instalado en el sistema) o a trav√©s de la herramienta <code>phpMyAdmin</code>.</p>
<p>Las sentencias SQL tambi√©n las podemos usar dentro de nuestro c√≥digo php; de tal manera que cuando se cargue nuestra interfaz web, lance una sentecia SQL para mostrar los datos que queramos.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span>
<span class="normal"><a href="#__codelineno-6-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>    <span class="c1">// Listado de clientes, ordenados por DNI de manera ASCendente</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>    <span class="nv">$clientesOrdenadosPorDNI</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM `pasajero` ORDER BY `dni` ASC&quot;</span><span class="p">;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="cp">?&gt;</span>
</code></pre></div></td></tr></table></div>
<h1 id="phpmyadmin">phpMyAdmin</h1>
<p><img src="/assets/img04_06-bbdd-phpMyAdmin-logo.png" alt="phpMyAdmin" style="zoom:22%; float:right;" />Este software funciona bajo Apache y PHP y es una interfaz web para gestionar las bases de datos que tengamos disponibles en nuestro servidor local. Muchos <em>hostings</em> ofrecen esta herramienta por defecto para poder gestionar las BBDD que tengamos configuradas bajo nuestra cuenta.</p>
<h2 id="creando-una-base-de-datos-dentro-de-phpmyadmin">Creando una base de datos dentro de phpMyAdmin</h2>
<ol>
<li>
<p>Para crear una nueva base de datos debemos entrar en phpMyAdmin como <strong>usuario root</strong> y pinchar en la opci√≥n <strong><em>Nueva</em></strong> del men√∫ de la izquierda.</p>
</li>
<li>
<p>En la nueva ventana de creaci√≥n pondremos un <strong>nombre</strong> a nuestra bd.</p>
</li>
<li>
<p>Tambi√©n estableceremos el <strong>cotejamiento</strong> <code>utf8m4_unicode_ci</code> para que nuestra bd soporte todo tipo de caracteres (como los asi√°ticos e incluso emojis :smile:).</p>
</li>
<li>
<p>Le damos al bot√≥n de <strong>Crear</strong> para crear la bd y comenzar a creaer las distintas tablas que vayamos a introducir en ella.</p>
</li>
</ol>
<p><img src="/assets/img05_06-bbdd-phpMyAdmin.gif" style="zoom:35%;" /></p>
<p>El sistema generar√° el c√≥digo SQL para crear todo lo que le hemos puesto y crear√° la base de datos con las tablas que le hayamos insertado.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">SQL</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">persona</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">INT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="n">AUTO_INCREMENT</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">nombre</span><span class="o">`</span><span class="w"> </span><span class="n">TINYTEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">apellidos</span><span class="o">`</span><span class="w"> </span><span class="nb">TEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">telefono</span><span class="o">`</span><span class="w"> </span><span class="n">TINYTEXT</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">))</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InnoDB</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h2 id="opciones-en-phpmyadmin">opciones en phpMyAdmin</h2>
<p>Cuando seleccionamos una base de datos de la lista, el sistema nos muestra varias pesta√±as con las cuales interactuar con la base de datos en cuesti√≥n:</p>
<ul>
<li>
<p><code>Estructura</code> : podemos ver las distintas tablas que consolidan nuestra base de datos.</p>
</li>
<li>
<p><code>SQL</code> : si queremos inyectar c√≥digo SQL para que el sistema lo interprete.</p>
</li>
<li>
<p><code>Buscar</code> : para buscar por t√©rminos, en nuestra base de datos, aplicando distintos filtros de b√∫squeda.</p>
</li>
<li>
<p><code>Generar consulta</code> : parecido a SQL pero de forma gr√°fica, sin tener que saber nada del lenguaje.</p>
</li>
<li>
<p><code>Exportar</code> e <code>importar</code> : como su nombre indica, para hacer cualquiera de las 2 operaciones sobre la base de datos.</p>
</li>
<li>
<p><code>Operaciones</code> : distintas opciones avanzadas para realizar en nuestra base de datos, de la cual destacaremos la opci√≥n <strong>Cotejamiento</strong> donde podremos cambiar el cotejamiento de nuestra tabla .</p>
</li>
</ul>
<blockquote>
<p><strong>OJO CON √âSTO </strong>porque podemos eliminar datos sin querer, ya que al cambiar el cotejamiento podemos suprimir caracteres no soportados por el nuevo cotejamiento.</p>
</blockquote>
<p>No vamos a profundizar en el resto de opciones, pero, en la pesta√±a <strong>M√°s</strong>, existe la opci√≥n <strong>Dise√±ador</strong> para poder editar las relaciones entre tablas de una manera gr√°fica (pinchando y arrastrando) que veremos m√°s adelante.</p>
<h1 id="mysqli">MySQLi</h1>
<p>PHP hace uso de esta extensi√≥n mejorada para poder comunicarse con las bases de datos, ya sean MySQL (4.1 o superior) o MariaDB.</p>
<p>Cualquier consulta que queramos hacer a una base de datos necesitaremos hacer uso de la extensi√≥n <code>mysqli()</code>.</p>
<p>Veamos c√≥mo conectarnos con una base de datos a trav√©s del c√≥digo PHP:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a>    <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí pruebas.php ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a>    <span class="c1">// &quot;SERVIDOR&quot;, &quot;USUARIO&quot;, &quot;CONTRASE√ëA&quot;, &quot;BASE DE DATOS&quot;</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="s2">&quot;d939ebf6a741&quot;</span><span class="p">,</span><span class="s2">&quot;tuUsuario&quot;</span><span class="p">,</span><span class="s2">&quot;tuContrase√±a&quot;</span><span class="p">,</span><span class="s2">&quot;tuBaseDeDatos&quot;</span><span class="p">);</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>    <span class="c1">// COMPROBAMOS LA CONEXI√ìN</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a>    <span class="k">if</span><span class="p">(</span><span class="nx">mysqli_connect_errno</span><span class="p">())</span> <span class="p">{</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a>       <span class="k">echo</span> <span class="s2">&quot;Failed to connect to MySQL: &quot;</span> <span class="o">.</span> <span class="nx">mysqli_connect_error</span><span class="p">();</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>       <span class="k">exit</span><span class="p">();</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a>    <span class="p">}</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>    <span class="k">echo</span> <span class="s2">&quot;&lt;h1&gt;Bienvenid@ a MySQL !!&lt;/h1&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="cp">?&gt;</span>
</code></pre></div></td></tr></table></div>
<ul>
<li><code>servidor</code>: el servidor donde se encuentra la base de datos que queremos usar suele ser <strong>localhost</strong>, pero en nuestro caso, al utilizar Docker ser√° el nombre de la imagen <strong>mysql:8.0</strong> que aparece al dejar el rat√≥n encima en el Visual Studio Code.</li>
</ul>
<p><img src="/assets/img06_06-mysql-servidor-docker.gif" style="zoom:50%;" /></p>
<ul>
<li><code>usuarioDB</code>: el usuario de la base de datos.</li>
<li><code>passwordDB</code>: la contrase√±a para ese usuario de la base de datos.</li>
<li><code>baseDeDatos</code>: nombre de la base de datos que queramos usar.</li>
</ul>
<p>Si todo ha salido bien habr√©is visto un mensaje diciendo <strong>Bienvenid@ a MySQL !!</strong></p>
<h2 id="recuperando-datos-de-una-bd">recuperando datos de una BD</h2>
<p>Ahora que ya sabemos c√≥mo conectarnos a una base de datos alojada en nuestro servidor, lo que necesitamos saber es c√≥mo recuperar datos almacenados en la base de datos.</p>
<p>Durante la instalaci√≥n de la imagen de Docker, se ha creado una tabla llamada <strong>Pruebas</strong> que contiene varios registros de distintas personas.</p>
<p>Vamos a recuperar esos datos para ver de qu√© forma se hace con PHP.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span>
<span class="normal"><a href="#__codelineno-9-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>   <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí pruebas.php ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>   <span class="nv">$conexion</span> <span class="o">=</span> <span class="nb">mysqli_connect</span><span class="p">(</span><span class="s2">&quot;d939ebf6a741&quot;</span><span class="p">,</span> <span class="s2">&quot;usuario&quot;</span><span class="p">,</span> <span class="s2">&quot;1234&quot;</span><span class="p">,</span> <span class="s2">&quot;pruebadb&quot;</span><span class="p">);</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a>   <span class="c1">// COMPROBAMOS LA CONEXI√ìN</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>   <span class="k">if</span> <span class="p">(</span><span class="nx">mysqli_connect_errno</span><span class="p">())</span> <span class="p">{</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a>       <span class="k">echo</span> <span class="s2">&quot;Failed to connect to MySQL: &quot;</span> <span class="o">.</span> <span class="nx">mysqli_connect_error</span><span class="p">();</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>       <span class="k">exit</span><span class="p">();</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>   <span class="p">}</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>   <span class="c1">// CONSULTA A LA BASE DE DATOS</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a>   <span class="nv">$consulta</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM `productos`&quot;</span><span class="p">;</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>   <span class="nv">$listaproductos</span> <span class="o">=</span> <span class="nx">mysqli_query</span><span class="p">(</span><span class="nv">$conexion</span><span class="p">,</span> <span class="nv">$consulta</span><span class="p">);</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a>   <span class="c1">// COMPROBAMOS SI EL SERVIDOR NOS HA DEVUELTO RESULTADOS</span>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a>   <span class="k">if</span><span class="p">(</span><span class="nv">$listaproductos</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a>       <span class="c1">// RECORREMOS CADA RESULTADO QUE NOS DEVUELVE EL SERVIDOR</span>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a>       <span class="k">foreach</span> <span class="p">(</span><span class="nv">$listaproductos</span> <span class="k">as</span> <span class="nv">$elemento</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-9-20" name="__codelineno-9-20"></a>            <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$elemento[id]</span><span class="s2"> - </span>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="s2">                  </span><span class="si">$elemento[descripcion]</span><span class="s2"> - </span>
<a id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="s2">                  </span><span class="si">$elemento[stock]</span>
<a id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="s2">                   &lt;br&gt;</span>
<a id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="s2">            &quot;</span><span class="p">;</span>
<a id="__codelineno-9-25" name="__codelineno-9-25"></a>       <span class="p">}</span>
<a id="__codelineno-9-26" name="__codelineno-9-26"></a>   <span class="p">}</span>
<a id="__codelineno-9-27" name="__codelineno-9-27"></a><span class="cp">?&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Si todo ha salido bien, por pantalla ver√°s el siguiente listado:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a>‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí http://localhost/pruebas.php ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>1 leche 25
<a id="__codelineno-10-4" name="__codelineno-10-4"></a>2 pan 12
<a id="__codelineno-10-5" name="__codelineno-10-5"></a>3 galletas 5
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>4 gominolas 120
<a id="__codelineno-10-7" name="__codelineno-10-7"></a>5 monster 2
<a id="__codelineno-10-8" name="__codelineno-10-8"></a>6 kit kat 17
<a id="__codelineno-10-9" name="__codelineno-10-9"></a>7 patatas fritas 7
<a id="__codelineno-10-10" name="__codelineno-10-10"></a>8 donetes 5
</code></pre></div></td></tr></table></div>
<h1 id="php-data-objects-pdo">PHP Data Objects :: PDO</h1>
<p>De la misma manera que hemos visto con mysqli, PHP Data Objects (o <code>PDO</code>) es un driver de PHP que se utiliza para trabajar bajo una interfaz de objetos con la base de datos. A d√≠a de hoy, es lo que m√°s se utiliza para manejar informaci√≥n desde una base de datos, ya sea relacional o no relacional.</p>
<p>De igual manera que pasaba con los objetos en PHP nativos, en la interfaz de MySQL el momento de la conexi√≥n es distinta:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span>
<span class="normal"><a href="#__codelineno-11-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>   <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="s1">&#39;mysql:host=localhost; dbname=pruebadb&#39;</span><span class="p">,</span> <span class="s1">&#39;usuario&#39;</span><span class="p">,</span> <span class="s1">&#39;1234&#39;</span><span class="p">);</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>en docker</strong></p>
<p>Recordar cambiar <em>localhost</em> por ID del contenedor <em>mysql:8.0</em>.</p>
</blockquote>
<p>Adem√°s, con PDO podemos usar las excepciones con <code>try</code>/<code>catch</code> para gestionar los errores que se produzcan en nuestra aplicaci√≥n. Para ello, como hac√≠amos antes, debemos encapsular el c√≥digo entre bloques try / catch:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>   <span class="c1">// dsn (Nombre del Origen de Datos, DSN)</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>   <span class="nv">$dsn</span> <span class="o">=</span> <span class="s1">&#39;mysql:dbname=pruebadb; host=127.0.0.1&#39;</span><span class="p">;</span> <span class="c1">// 127.0.01 -&gt; ID contenedor mysql:8.0</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>   <span class="nv">$usuario</span> <span class="o">=</span> <span class="s1">&#39;usuario&#39;</span><span class="p">;</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>   <span class="nv">$contrasenya</span> <span class="o">=</span> <span class="s1">&#39;1234&#39;</span><span class="p">;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>   <span class="k">try</span> <span class="p">{</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>        <span class="nv">$mbd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$dsn</span><span class="p">,</span> <span class="nv">$usuario</span><span class="p">,</span> <span class="nv">$contrasenya</span><span class="p">);</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a>        <span class="nv">$mbd</span><span class="o">-&gt;</span><span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>   <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>        <span class="k">echo</span> <span class="s1">&#39;Fallo en la conexi√≥n: &#39;</span> <span class="o">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>   <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Los pasos a seguir han sigo:</p>
<p>1¬∫ ) Creamos la conexi√≥n con la base de datos a trav√©s del constructor PDO pas√°ndole la informaci√≥n de la base de datos. </p>
<p>2¬∫ ) Establecemos los par√°metros para manejar las excepciones, en este caso hemos utilizado:</p>
<ul>
<li>
<p><code>PDO::ATTR_ERRMODE</code> indic√°ndole a PHP que queremos un reporte de errores.</p>
</li>
<li>
<p><code>PDO::ERRMODE_EXCEPTION</code> con este atributo obligamos a que lance excepciones, adem√°s de ser la opci√≥n m√°s humana y legible que hay a la hora de controlar errores.</p>
</li>
</ul>
<p>3¬™ ) Cualquier error que se lance a trav√©s de PDO, el sistema lanzar√° una <strong>PDOException</strong>.</p>
<h2 id="fichero-de-configuracion-de-la-bd">fichero de configuraci√≥n de la BD</h2>
<p>De la misma manera que creamos nuestro archivo de funciones <code>funciones-php</code> y albergamos todas las funciones que se usan de manera global en la aplicaci√≥n, podemos establecer un archivo de constantes donde definamos los par√°metros de conexi√≥n con la base de datos.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a>    <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí conexion.php ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a>    <span class="k">const</span> <span class="no">DSN</span> <span class="o">=</span> <span class="s2">&quot;mysql:host=localhost; dbname=pruebadb&quot;</span><span class="p">;</span> <span class="c1">// localhost -&gt; ID contenedor mysql:8.0</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a>    <span class="k">const</span> <span class="no">USUARIO</span> <span class="o">=</span> <span class="s2">&quot;usuario&quot;</span><span class="p">;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a>    <span class="k">const</span> <span class="no">PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;1234&quot;</span><span class="p">;</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a>    <span class="cm">/* ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="cm">     * ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí NO SUBAS ESTE ARCHIVO A git ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="cm">     * ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí */</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>OJO</strong>  Este archivo contiene informaci√≥n <strong>muy sensible</strong> as√≠ que no es recomendable que subas este archivo a git.</p>
</blockquote>
<h2 id="sentencias-preparadas">sentencias preparadas</h2>
<p>Se trata de sentencias que se establecen como si fueran plantillas de la SQL que vamos a lanzar, aceptando par√°metros que son establecidos a posteriori de la declaraci√≥n de la sentencia preparada.</p>
<p>Las sentencias preparadas evitan la <strong>injecci√≥n de SQL</strong> (SQL Injection) y mejoran el rendimiento de nuestras aplicaci√≥nes o p√°ginas web.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO productos VALUES (?, ?, ?)&quot;</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>Cada interrogante es un par√°metro que estableceremos despu√©s unas cuantas l√≠neas m√°s abajo.</p>
<p>Una vez tenemos la plantilla de nuestra consulta, debemos seguir con la preparaci√≥n junto con 3 m√©todos m√°s de PHP para su completa ejecuci√≥n:</p>
<p>1¬∫ ) <code>prepare</code>: prepara la sentencia antes de ser ejecutada.</p>
<p>2¬∫ ) <code>bind</code>: el tipo de uni√≥n (<em>bind</em>) de dato. Puede ser mediante  <code>?</code>  o  <code>:parametro</code> .</p>
<p>3¬∫ ) <code>execute</code>: se ejecuta la consulta uniendo la plantilla con las variables o par√°metros que hemos establecido.</p>
<h2 id="ejemplo-parametros">ejemplo par√°metros</h2>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a>    <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí Borrando con par√°metros ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a>    <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a>    <span class="k">try</span> <span class="p">{</span> 
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>        <span class="nv">$cantidad</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cantidad&quot;</span><span class="p">];</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a>        <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a>        <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM productos WHERE stock = ?&quot;</span><span class="p">;</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a>        <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a>        <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span><span class="nv">$cantidad</span><span class="p">]);</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>        <span class="nv">$cantidadAfectada</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">rowCount</span><span class="p">();</span>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a>        <span class="k">echo</span> <span class="nv">$cantidadAfectada</span> <span class="o">.</span> <span class="s2">&quot; fila(s) afectada(s).&quot;</span><span class="p">;</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a>        <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a>    <span class="p">}</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h2 id="ejemplo-bindparam">ejemplo bindParam</h2>
<p>Muy parecido a utilizar par√°metros pero esta vez la variable est√° dentro de la sentencia SQL, en este caso la hemos llamado <code>:cant</code></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span>
<span class="normal"><a href="#__codelineno-16-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a>    <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>    <span class="nv">$conexion</span><span class="o">=</span><span class="k">null</span><span class="p">;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>    <span class="k">try</span> <span class="p">{</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a>        <span class="nv">$cantidad</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;cantidad&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a>        <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a>        <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a>        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM productos WHERE stock = :cant&quot;</span><span class="p">;</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a>        <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a>        <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:cant&quot;</span><span class="p">,</span> <span class="nv">$cantidad</span><span class="p">);</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a>        <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a>        <span class="nv">$cantidadAfectada</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">rowCount</span><span class="p">();</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a>        <span class="k">echo</span> <span class="nv">$cantidadAfectada</span> <span class="o">.</span> <span class="s2">&quot; fila(s) afectada(s).&quot;</span><span class="p">;</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a>    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a>        <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a>    <span class="p">}</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h2 id="bindvalue-vs-bindparam">bindValue VS bindParam</h2>
<p>Utilizaremos <code>bindValue()</code> cuando tengamos que insertar datos s√≥lo una vez. En cambio, deberemos usar <code>bindParam()</code> cuando tengamos que pasar datos m√∫ltiples, como por ejemplo, un array.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a>   <span class="c1">// ‚ñí‚ñí‚ñí FALTA CONEXI√ìN A BD ‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a>   <span class="c1">// se asignan nombre a los parametros</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>   <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;DELETE FROM productos WHERE stock = :cant&quot;</span><span class="p">;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a>   <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a>  <span class="c1">// bindValue enlaza por VALOR</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>  <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a>  <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindValue</span><span class="p">(</span><span class="s2">&quot;:cant&quot;</span><span class="p">,</span> <span class="nv">$cantidad</span><span class="p">);</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a>  <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a>  <span class="c1">// se eliminan con cant = 0</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a>  <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>  <span class="c1">// bindParam enlaza por REFERENCIA</span>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a>  <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a>  <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:cant&quot;</span><span class="p">,</span> <span class="nv">$cantidad</span><span class="p">);</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a>  <span class="nv">$cantidad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a>  <span class="c1">// se eliminan con cant = 1</span>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a>  <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
</code></pre></div></td></tr></table></div>
<p>Para m√°s informaci√≥n y uso de las variables PDO <a href="https://www.php.net/manual/es/pdo.constants.php">consulta el manual de PHP</a>.</p>
<h2 id="insertando-registros">insertando registros</h2>
<p>A la hora de insertar registros en una base de datos, debemos tener en cuenta que en la tabla puede haber valores autoincrementados. Para salvaguardar esto, lo que debemos hacer es dejar vac√≠o ese campo autoincrementado; pero a la hora de hacer la conexi√≥n, debemos recuperarlo con el m√©todo <code>lastInsertId()</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-18-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-18-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-18-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-18-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-18-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-18-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-18-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-18-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-18-10">10</a></span>
<span class="normal"><a href="#__codelineno-18-11">11</a></span>
<span class="normal"><a href="#__codelineno-18-12">12</a></span>
<span class="normal"><a href="#__codelineno-18-13">13</a></span>
<span class="normal"><a href="#__codelineno-18-14">14</a></span>
<span class="normal"><a href="#__codelineno-18-15">15</a></span>
<span class="normal"><a href="#__codelineno-18-16">16</a></span>
<span class="normal"><a href="#__codelineno-18-17">17</a></span>
<span class="normal"><a href="#__codelineno-18-18">18</a></span>
<span class="normal"><a href="#__codelineno-18-19">19</a></span>
<span class="normal"><a href="#__codelineno-18-20">20</a></span>
<span class="normal"><a href="#__codelineno-18-21">21</a></span>
<span class="normal"><a href="#__codelineno-18-22">22</a></span>
<span class="normal"><a href="#__codelineno-18-23">23</a></span>
<span class="normal"><a href="#__codelineno-18-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a>  <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>  <span class="k">try</span><span class="p">{</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a>    <span class="nv">$descripcion</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;descripcion&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="s2">&quot;PRODUCTO X&quot;</span><span class="p">;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a>    <span class="nv">$stock</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">&quot;stock&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<a id="__codelineno-18-11" name="__codelineno-18-11"></a>    <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-18-12" name="__codelineno-18-12"></a>
<a id="__codelineno-18-13" name="__codelineno-18-13"></a>    <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;insert into productos (descripcion, stock) values (:desc, :stock)&quot;</span><span class="p">;</span>
<a id="__codelineno-18-14" name="__codelineno-18-14"></a>
<a id="__codelineno-18-15" name="__codelineno-18-15"></a>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-18-16" name="__codelineno-18-16"></a>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:desc&quot;</span><span class="p">,</span> <span class="nv">$descripcion</span><span class="p">);</span>
<a id="__codelineno-18-17" name="__codelineno-18-17"></a>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">bindParam</span><span class="p">(</span><span class="s2">&quot;:stock&quot;</span><span class="p">,</span> <span class="nv">$stock</span><span class="p">);</span>
<a id="__codelineno-18-18" name="__codelineno-18-18"></a>
<a id="__codelineno-18-19" name="__codelineno-18-19"></a>    <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<a id="__codelineno-18-20" name="__codelineno-18-20"></a>    <span class="nv">$idGenerado</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">lastInsertId</span><span class="p">();</span>
<a id="__codelineno-18-21" name="__codelineno-18-21"></a>
<a id="__codelineno-18-22" name="__codelineno-18-22"></a>  <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
<a id="__codelineno-18-23" name="__codelineno-18-23"></a>    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-18-24" name="__codelineno-18-24"></a>  <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="consultando-registros">consultando registros</h2>
<p>A la hora de recuperar los resultados de una consulta, bastar√° con invocar al m√©todo <code>PDOStatement::fetch</code> para listar las filas generadas por la consulta.</p>
<p>Pero debemos elegir el tipo de dato que queremos recibir entre los 3 que hay disponibles:</p>
<ul>
<li><code>PDO::FETCH_ASSOC</code> : array indexado cuyos keys son el nombre de las columnas.</li>
<li><code>PDO::FETCH_NUM</code> : array indexado cuyos keys son n√∫meros.</li>
<li><code>PDO::FETCH_BOTH</code> : valor por defecto. Devuelve un array indexado cuyos keys son tanto el nombre de las columnas como n√∫meros.</li>
</ul>
<p><img src="/assets/img07_06-pdo-listado-fetch.png" style="zoom: 40%;" /></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span>
<span class="normal"><a href="#__codelineno-19-22">22</a></span>
<span class="normal"><a href="#__codelineno-19-23">23</a></span>
<span class="normal"><a href="#__codelineno-19-24">24</a></span>
<span class="normal"><a href="#__codelineno-19-25">25</a></span>
<span class="normal"><a href="#__codelineno-19-26">26</a></span>
<span class="normal"><a href="#__codelineno-19-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a>  <span class="c1">//  ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí consulta con array asociativo.php ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>  <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a>  <span class="k">try</span><span class="p">{</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a>    <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;select * from productos&quot;</span><span class="p">;</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a>    <span class="k">while</span><span class="p">(</span><span class="nv">$fila</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">()){</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a>      <span class="k">echo</span> <span class="s2">&quot;Id:&quot;</span> <span class="o">.</span> <span class="nv">$fila</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a>      <span class="k">echo</span> <span class="s2">&quot;Descripci√≥n:&quot;</span> <span class="o">.</span> <span class="nv">$fila</span><span class="p">[</span><span class="s2">&quot;descripcion&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a>      <span class="k">echo</span> <span class="s2">&quot;Stock:&quot;</span> <span class="o">.</span> <span class="nv">$fila</span><span class="p">[</span><span class="s2">&quot;stock&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a>    <span class="p">}</span>
<a id="__codelineno-19-22" name="__codelineno-19-22"></a>
<a id="__codelineno-19-23" name="__codelineno-19-23"></a>  <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-19-24" name="__codelineno-19-24"></a>    <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-19-25" name="__codelineno-19-25"></a>  <span class="p">}</span>
<a id="__codelineno-19-26" name="__codelineno-19-26"></a>
<a id="__codelineno-19-27" name="__codelineno-19-27"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>Recuperando datos con una <strong>matriz</strong> como resultado de nuestra consulta:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span>
<span class="normal"><a href="#__codelineno-20-27">27</a></span>
<span class="normal"><a href="#__codelineno-20-28">28</a></span>
<span class="normal"><a href="#__codelineno-20-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí consulta con array asociativo ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a>  <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a>  <span class="k">try</span><span class="p">{</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>    <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a>    <span class="nv">$sql</span><span class="o">=</span><span class="s2">&quot;SELECT * FROM productos&quot;</span><span class="p">;</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a>    <span class="c1">// recuperado en la matriz $productos</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a>    <span class="nv">$productos</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetchAll</span><span class="p">();</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a>    <span class="k">foreach</span><span class="p">(</span><span class="nv">$productos</span> <span class="k">as</span> <span class="nv">$elemento</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a>      <span class="k">echo</span><span class="s2">&quot;Id:&quot;</span> <span class="o">.</span> <span class="nv">$elemento</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a>      <span class="k">echo</span><span class="s2">&quot;Descripci√≥n:&quot;</span> <span class="o">.</span> <span class="nv">$elemento</span><span class="p">[</span><span class="s2">&quot;descripcion&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a>      <span class="k">echo</span><span class="s2">&quot;Stock:&quot;</span> <span class="o">.</span> <span class="nv">$elemento</span><span class="p">[</span><span class="s2">&quot;stock&quot;</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&lt;br /&gt;&quot;</span><span class="p">;</span>        
<a id="__codelineno-20-23" name="__codelineno-20-23"></a>    <span class="p">}</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a>  <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a>      <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-20-27" name="__codelineno-20-27"></a>  <span class="p">}</span>
<a id="__codelineno-20-28" name="__codelineno-20-28"></a>
<a id="__codelineno-20-29" name="__codelineno-20-29"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>Pero si lo que queremos es leer datos con forma de objeto utilizando <code>PDO::FETCH_OBJ</code>, debemos crear un objeto con propiedades p√∫blicas con el mismo nombre que las columnas de la tabla que vayamos a consultar.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span>
<span class="normal"><a href="#__codelineno-21-21">21</a></span>
<span class="normal"><a href="#__codelineno-21-22">22</a></span>
<span class="normal"><a href="#__codelineno-21-23">23</a></span>
<span class="normal"><a href="#__codelineno-21-24">24</a></span>
<span class="normal"><a href="#__codelineno-21-25">25</a></span>
<span class="normal"><a href="#__codelineno-21-26">26</a></span>
<span class="normal"><a href="#__codelineno-21-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí consulta con formato de objeto ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a>  <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a>  <span class="k">try</span><span class="p">{</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a>    <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM productos&quot;</span><span class="p">;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_OBJ</span><span class="p">);</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a>    <span class="k">while</span><span class="p">(</span><span class="nv">$p</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a>        <span class="k">echo</span><span class="s2">&quot;Id:&quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">id</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a>        <span class="k">echo</span><span class="s2">&quot;Descripci√≥n:&quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">descripcion</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a>        <span class="k">echo</span><span class="s2">&quot;Stock:&quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">stock</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-21-21" name="__codelineno-21-21"></a>    <span class="p">}</span>
<a id="__codelineno-21-22" name="__codelineno-21-22"></a>
<a id="__codelineno-21-23" name="__codelineno-21-23"></a>  <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-21-24" name="__codelineno-21-24"></a>    <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-21-25" name="__codelineno-21-25"></a>  <span class="p">}</span>
<a id="__codelineno-21-26" name="__codelineno-21-26"></a>
<a id="__codelineno-21-27" name="__codelineno-21-27"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h2 id="consultas-con-modelos">consultas con modelos</h2>
<p>Llevamos tiempo creando clases en PHP y las consultas tambi√©n admiten este tipo de datos mediante el uso de <code>PDO::FETCH_CLASS</code>.</p>
<p>Si usamos este m√©todo, debemos tener en cuenta que los nombres de los atributos privados deben coincidir con los nombres de las columnas de la tabla que vayamos a manejar.</p>
<p>As√≠ pues, si por lo que sea cambiamos la estructura de la tabla <strong>DEBEMOS CAMBIAR</strong> nuestra clase para que todo siga funcionando.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-22-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-22-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-22-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-22-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-22-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-22-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-22-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-22-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-22-10">10</a></span>
<span class="normal"><a href="#__codelineno-22-11">11</a></span>
<span class="normal"><a href="#__codelineno-22-12">12</a></span>
<span class="normal"><a href="#__codelineno-22-13">13</a></span>
<span class="normal"><a href="#__codelineno-22-14">14</a></span>
<span class="normal"><a href="#__codelineno-22-15">15</a></span>
<span class="normal"><a href="#__codelineno-22-16">16</a></span>
<span class="normal"><a href="#__codelineno-22-17">17</a></span>
<span class="normal"><a href="#__codelineno-22-18">18</a></span>
<span class="normal"><a href="#__codelineno-22-19">19</a></span>
<span class="normal"><a href="#__codelineno-22-20">20</a></span>
<span class="normal"><a href="#__codelineno-22-21">21</a></span>
<span class="normal"><a href="#__codelineno-22-22">22</a></span>
<span class="normal"><a href="#__codelineno-22-23">23</a></span>
<span class="normal"><a href="#__codelineno-22-24">24</a></span>
<span class="normal"><a href="#__codelineno-22-25">25</a></span>
<span class="normal"><a href="#__codelineno-22-26">26</a></span>
<span class="normal"><a href="#__codelineno-22-27">27</a></span>
<span class="normal"><a href="#__codelineno-22-28">28</a></span>
<span class="normal"><a href="#__codelineno-22-29">29</a></span>
<span class="normal"><a href="#__codelineno-22-30">30</a></span>
<span class="normal"><a href="#__codelineno-22-31">31</a></span>
<span class="normal"><a href="#__codelineno-22-32">32</a></span>
<span class="normal"><a href="#__codelineno-22-33">33</a></span>
<span class="normal"><a href="#__codelineno-22-34">34</a></span>
<span class="normal"><a href="#__codelineno-22-35">35</a></span>
<span class="normal"><a href="#__codelineno-22-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-22-2" name="__codelineno-22-2"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí clase Producto ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-22-3" name="__codelineno-22-3"></a>  <span class="k">class</span> <span class="nc">Producto</span> <span class="p">{</span>
<a id="__codelineno-22-4" name="__codelineno-22-4"></a>    <span class="k">private</span> <span class="nx">int</span> <span class="nv">$id</span><span class="p">;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5"></a>    <span class="k">private</span> <span class="nx">string</span> <span class="nv">$descripcion</span><span class="p">;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6"></a>    <span class="k">private</span> <span class="o">?</span> <span class="nx">int</span> <span class="nv">$stock</span><span class="p">;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7"></a>
<a id="__codelineno-22-8" name="__codelineno-22-8"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
<a id="__codelineno-22-9" name="__codelineno-22-9"></a>      <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">id</span><span class="p">;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10"></a>    <span class="p">}</span>
<a id="__codelineno-22-11" name="__codelineno-22-11"></a>
<a id="__codelineno-22-12" name="__codelineno-22-12"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescripcion</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
<a id="__codelineno-22-13" name="__codelineno-22-13"></a>      <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">descripcion</span><span class="p">;</span>
<a id="__codelineno-22-14" name="__codelineno-22-14"></a>    <span class="p">}</span>
<a id="__codelineno-22-15" name="__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getStock</span><span class="p">()</span> <span class="o">:</span> <span class="o">?</span><span class="nx">int</span> <span class="p">{</span>
<a id="__codelineno-22-17" name="__codelineno-22-17"></a>      <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">stock</span><span class="p">;</span>
<a id="__codelineno-22-18" name="__codelineno-22-18"></a>    <span class="p">}</span>
<a id="__codelineno-22-19" name="__codelineno-22-19"></a>  <span class="p">}</span>
<a id="__codelineno-22-20" name="__codelineno-22-20"></a><span class="cp">?&gt;</span>
<a id="__codelineno-22-21" name="__codelineno-22-21"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-22-22" name="__codelineno-22-22"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí Consultando a trav√©s de la clase Producto ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-22-23" name="__codelineno-22-23"></a>  <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM productos&quot;</span><span class="p">;</span>
<a id="__codelineno-22-24" name="__codelineno-22-24"></a>  <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-22-25" name="__codelineno-22-25"></a>
<a id="__codelineno-22-26" name="__codelineno-22-26"></a>  <span class="c1">// Aqu√≠ &#39;Tienda&#39; es el nombre de nuestra clase</span>
<a id="__codelineno-22-27" name="__codelineno-22-27"></a>  <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span><span class="p">,</span> <span class="s2">&quot;Producto&quot;</span><span class="p">);</span>
<a id="__codelineno-22-28" name="__codelineno-22-28"></a>  <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<a id="__codelineno-22-29" name="__codelineno-22-29"></a>
<a id="__codelineno-22-30" name="__codelineno-22-30"></a>  <span class="k">while</span><span class="p">(</span><span class="nv">$p</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
<a id="__codelineno-22-31" name="__codelineno-22-31"></a>    <span class="k">echo</span> <span class="s2">&quot;Id: &quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">getId</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-22-32" name="__codelineno-22-32"></a>    <span class="k">echo</span> <span class="s2">&quot;Descripcion: &quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">getDescripcion</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-22-33" name="__codelineno-22-33"></a>    <span class="k">echo</span> <span class="s2">&quot;Stock: &quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">getStock</span><span class="p">()</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-22-34" name="__codelineno-22-34"></a>
<a id="__codelineno-22-35" name="__codelineno-22-35"></a>    <span class="c1">//var_dump($p);</span>
<a id="__codelineno-22-36" name="__codelineno-22-36"></a>  <span class="p">}</span>
</code></pre></div></td></tr></table></div>
<p>Pero ¬øqu√© pasa si nuestras clases tienen constructor? pues que debemos indicarle, al m√©todo FECTH, que rellene las propiedades despu√©s de llamar al constructor y para ello hacemos uso de <code>PDO::FETCH_PROPS_LATE</code>.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span>
<span class="normal"><a href="#__codelineno-23-20">20</a></span>
<span class="normal"><a href="#__codelineno-23-21">21</a></span>
<span class="normal"><a href="#__codelineno-23-22">22</a></span>
<span class="normal"><a href="#__codelineno-23-23">23</a></span>
<span class="normal"><a href="#__codelineno-23-24">24</a></span>
<span class="normal"><a href="#__codelineno-23-25">25</a></span>
<span class="normal"><a href="#__codelineno-23-26">26</a></span>
<span class="normal"><a href="#__codelineno-23-27">27</a></span>
<span class="normal"><a href="#__codelineno-23-28">28</a></span>
<span class="normal"><a href="#__codelineno-23-29">29</a></span>
<span class="normal"><a href="#__codelineno-23-30">30</a></span>
<span class="normal"><a href="#__codelineno-23-31">31</a></span>
<span class="normal"><a href="#__codelineno-23-32">32</a></span>
<span class="normal"><a href="#__codelineno-23-33">33</a></span>
<span class="normal"><a href="#__codelineno-23-34">34</a></span>
<span class="normal"><a href="#__codelineno-23-35">35</a></span>
<span class="normal"><a href="#__codelineno-23-36">36</a></span>
<span class="normal"><a href="#__codelineno-23-37">37</a></span>
<span class="normal"><a href="#__codelineno-23-38">38</a></span>
<span class="normal"><a href="#__codelineno-23-39">39</a></span>
<span class="normal"><a href="#__codelineno-23-40">40</a></span>
<span class="normal"><a href="#__codelineno-23-41">41</a></span>
<span class="normal"><a href="#__codelineno-23-42">42</a></span>
<span class="normal"><a href="#__codelineno-23-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-23-2" name="__codelineno-23-2"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí clase Producto ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-23-3" name="__codelineno-23-3"></a>  <span class="k">class</span> <span class="nc">Producto</span> <span class="p">{</span>
<a id="__codelineno-23-4" name="__codelineno-23-4"></a>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span> <span class="p">(</span><span class="k">public</span> <span class="nx">int</span> <span class="nv">$id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
<a id="__codelineno-23-5" name="__codelineno-23-5"></a>                          <span class="k">public</span> <span class="nx">string</span> <span class="nv">$descripcion</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> 
<a id="__codelineno-23-6" name="__codelineno-23-6"></a>                          <span class="k">public</span> <span class="nx">int</span> <span class="nv">$stock</span><span class="o">=</span><span class="mi">1</span> <span class="p">){</span>  <span class="p">}</span>
<a id="__codelineno-23-7" name="__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
<a id="__codelineno-23-9" name="__codelineno-23-9"></a>       <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">id</span><span class="p">;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10"></a>    <span class="p">}</span>
<a id="__codelineno-23-11" name="__codelineno-23-11"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescripcion</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
<a id="__codelineno-23-12" name="__codelineno-23-12"></a>       <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">descripcion</span><span class="p">;</span>
<a id="__codelineno-23-13" name="__codelineno-23-13"></a>    <span class="p">}</span>
<a id="__codelineno-23-14" name="__codelineno-23-14"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">getStock</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
<a id="__codelineno-23-15" name="__codelineno-23-15"></a>       <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">stock</span><span class="p">;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16"></a>    <span class="p">}</span>
<a id="__codelineno-23-17" name="__codelineno-23-17"></a>  <span class="p">}</span>
<a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="cp">?&gt;</span><span class="x">   </span>
<a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-23-20" name="__codelineno-23-20"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí consulta con array asociativo.php ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-23-21" name="__codelineno-23-21"></a>  <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<a id="__codelineno-23-22" name="__codelineno-23-22"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<a id="__codelineno-23-23" name="__codelineno-23-23"></a>  <span class="k">try</span><span class="p">{</span>
<a id="__codelineno-23-24" name="__codelineno-23-24"></a>     <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<a id="__codelineno-23-25" name="__codelineno-23-25"></a>     <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-23-26" name="__codelineno-23-26"></a>     <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM productos&quot;</span><span class="p">;</span>
<a id="__codelineno-23-27" name="__codelineno-23-27"></a>
<a id="__codelineno-23-28" name="__codelineno-23-28"></a>     <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-23-29" name="__codelineno-23-29"></a>     <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span><span class="o">|</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_PROPS_LATE</span><span class="p">,</span> <span class="s2">&quot;Producto&quot;</span><span class="p">);</span>
<a id="__codelineno-23-30" name="__codelineno-23-30"></a>
<a id="__codelineno-23-31" name="__codelineno-23-31"></a>     <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">();</span>
<a id="__codelineno-23-32" name="__codelineno-23-32"></a>
<a id="__codelineno-23-33" name="__codelineno-23-33"></a>     <span class="c1">//$productos = $sentencia -&gt; fetchAll();</span>
<a id="__codelineno-23-34" name="__codelineno-23-34"></a>     <span class="k">while</span><span class="p">(</span><span class="nv">$p</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
<a id="__codelineno-23-35" name="__codelineno-23-35"></a>        <span class="k">echo</span><span class="s2">&quot;Id:&quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">id</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-23-36" name="__codelineno-23-36"></a>        <span class="k">echo</span><span class="s2">&quot;Descripci√≥n:&quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">descripcion</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-23-37" name="__codelineno-23-37"></a>        <span class="k">echo</span><span class="s2">&quot;Stock:&quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">stock</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-23-38" name="__codelineno-23-38"></a>     <span class="p">}</span>
<a id="__codelineno-23-39" name="__codelineno-23-39"></a>  <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-23-40" name="__codelineno-23-40"></a>     <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-23-41" name="__codelineno-23-41"></a>  <span class="p">}</span>
<a id="__codelineno-23-42" name="__codelineno-23-42"></a>
<a id="__codelineno-23-43" name="__codelineno-23-43"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h2 id="consultas-con-like">consultas con LIKE</h2>
<p>Para utilizar el comod√≠n LIKE u otros comodines, debemos asociarlo al dato y NUNCA en la propia consulta.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span>
<span class="normal"><a href="#__codelineno-24-11">11</a></span>
<span class="normal"><a href="#__codelineno-24-12">12</a></span>
<span class="normal"><a href="#__codelineno-24-13">13</a></span>
<span class="normal"><a href="#__codelineno-24-14">14</a></span>
<span class="normal"><a href="#__codelineno-24-15">15</a></span>
<span class="normal"><a href="#__codelineno-24-16">16</a></span>
<span class="normal"><a href="#__codelineno-24-17">17</a></span>
<span class="normal"><a href="#__codelineno-24-18">18</a></span>
<span class="normal"><a href="#__codelineno-24-19">19</a></span>
<span class="normal"><a href="#__codelineno-24-20">20</a></span>
<span class="normal"><a href="#__codelineno-24-21">21</a></span>
<span class="normal"><a href="#__codelineno-24-22">22</a></span>
<span class="normal"><a href="#__codelineno-24-23">23</a></span>
<span class="normal"><a href="#__codelineno-24-24">24</a></span>
<span class="normal"><a href="#__codelineno-24-25">25</a></span>
<span class="normal"><a href="#__codelineno-24-26">26</a></span>
<span class="normal"><a href="#__codelineno-24-27">27</a></span>
<span class="normal"><a href="#__codelineno-24-28">28</a></span>
<span class="normal"><a href="#__codelineno-24-29">29</a></span>
<span class="normal"><a href="#__codelineno-24-30">30</a></span>
<span class="normal"><a href="#__codelineno-24-31">31</a></span>
<span class="normal"><a href="#__codelineno-24-32">32</a></span>
<span class="normal"><a href="#__codelineno-24-33">33</a></span>
<span class="normal"><a href="#__codelineno-24-34">34</a></span>
<span class="normal"><a href="#__codelineno-24-35">35</a></span>
<span class="normal"><a href="#__codelineno-24-36">36</a></span>
<span class="normal"><a href="#__codelineno-24-37">37</a></span>
<span class="normal"><a href="#__codelineno-24-38">38</a></span>
<span class="normal"><a href="#__codelineno-24-39">39</a></span>
<span class="normal"><a href="#__codelineno-24-40">40</a></span>
<span class="normal"><a href="#__codelineno-24-41">41</a></span>
<span class="normal"><a href="#__codelineno-24-42">42</a></span>
<span class="normal"><a href="#__codelineno-24-43">43</a></span>
<span class="normal"><a href="#__codelineno-24-44">44</a></span>
<span class="normal"><a href="#__codelineno-24-45">45</a></span>
<span class="normal"><a href="#__codelineno-24-46">46</a></span>
<span class="normal"><a href="#__codelineno-24-47">47</a></span>
<span class="normal"><a href="#__codelineno-24-48">48</a></span>
<span class="normal"><a href="#__codelineno-24-49">49</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí clase Producto ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>  <span class="k">class</span> <span class="nc">Producto</span> <span class="p">{</span>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a>     <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span> <span class="p">(</span><span class="k">public</span> <span class="nx">int</span> <span class="nv">$id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
<a id="__codelineno-24-5" name="__codelineno-24-5"></a>                         <span class="k">public</span> <span class="nx">string</span> <span class="nv">$descripcion</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> 
<a id="__codelineno-24-6" name="__codelineno-24-6"></a>                         <span class="k">public</span> <span class="nx">int</span> <span class="nv">$stock</span><span class="o">=</span><span class="mi">1</span> <span class="p">){</span>  <span class="p">}</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8"></a>     <span class="k">public</span> <span class="k">function</span> <span class="nf">getId</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
<a id="__codelineno-24-9" name="__codelineno-24-9"></a>         <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">id</span><span class="p">;</span>
<a id="__codelineno-24-10" name="__codelineno-24-10"></a>     <span class="p">}</span>
<a id="__codelineno-24-11" name="__codelineno-24-11"></a>     <span class="k">public</span> <span class="k">function</span> <span class="nf">getDescripcion</span><span class="p">()</span> <span class="o">:</span> <span class="nx">string</span> <span class="p">{</span>
<a id="__codelineno-24-12" name="__codelineno-24-12"></a>         <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">descripcion</span><span class="p">;</span>
<a id="__codelineno-24-13" name="__codelineno-24-13"></a>     <span class="p">}</span>
<a id="__codelineno-24-14" name="__codelineno-24-14"></a>     <span class="k">public</span> <span class="k">function</span> <span class="nf">getStock</span><span class="p">()</span> <span class="o">:</span> <span class="nx">int</span> <span class="p">{</span>
<a id="__codelineno-24-15" name="__codelineno-24-15"></a>         <span class="k">return</span> <span class="nv">$this</span> <span class="o">-&gt;</span> <span class="na">stock</span><span class="p">;</span>
<a id="__codelineno-24-16" name="__codelineno-24-16"></a>     <span class="p">}</span>
<a id="__codelineno-24-17" name="__codelineno-24-17"></a>  <span class="p">}</span>
<a id="__codelineno-24-18" name="__codelineno-24-18"></a><span class="cp">?&gt;</span>
<a id="__codelineno-24-19" name="__codelineno-24-19"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-24-20" name="__codelineno-24-20"></a>  <span class="nv">$busqueda1</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;cadenaDescripcion&quot;</span><span class="p">];</span>
<a id="__codelineno-24-21" name="__codelineno-24-21"></a>  <span class="nv">$busqueda2</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;numStock&quot;</span><span class="p">];</span>
<a id="__codelineno-24-22" name="__codelineno-24-22"></a>
<a id="__codelineno-24-23" name="__codelineno-24-23"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí Utilizando comodines :: LIKE ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-24-24" name="__codelineno-24-24"></a>  <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<a id="__codelineno-24-25" name="__codelineno-24-25"></a>
<a id="__codelineno-24-26" name="__codelineno-24-26"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<a id="__codelineno-24-27" name="__codelineno-24-27"></a>  <span class="k">try</span><span class="p">{</span>
<a id="__codelineno-24-28" name="__codelineno-24-28"></a>     <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<a id="__codelineno-24-29" name="__codelineno-24-29"></a>     <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-24-30" name="__codelineno-24-30"></a>     <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM productos where descripcion like :desc and stock = :stk&quot;</span><span class="p">;</span>
<a id="__codelineno-24-31" name="__codelineno-24-31"></a>
<a id="__codelineno-24-32" name="__codelineno-24-32"></a>     <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-24-33" name="__codelineno-24-33"></a>     <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">setFetchMode</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_CLASS</span> <span class="o">|</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_PROPS_LATE</span><span class="p">,</span> <span class="nx">Producto</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-24-34" name="__codelineno-24-34"></a>
<a id="__codelineno-24-35" name="__codelineno-24-35"></a>     <span class="nv">$cadBuscar1</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">.</span> <span class="nv">$busqueda</span> <span class="o">.</span> <span class="s2">&quot;%&quot;</span><span class="p">;</span>
<a id="__codelineno-24-36" name="__codelineno-24-36"></a>
<a id="__codelineno-24-37" name="__codelineno-24-37"></a>     <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span><span class="s2">&quot;desc&quot;</span> <span class="o">=&gt;</span> <span class="nv">$cadBuscar1</span><span class="p">,</span><span class="s2">&quot;stk&quot;</span> <span class="o">=&gt;</span> <span class="nv">$cadBuscar2</span><span class="p">]);</span>
<a id="__codelineno-24-38" name="__codelineno-24-38"></a>
<a id="__codelineno-24-39" name="__codelineno-24-39"></a>     <span class="k">while</span><span class="p">(</span><span class="nv">$p</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">())</span> <span class="p">{</span>
<a id="__codelineno-24-40" name="__codelineno-24-40"></a>         <span class="k">echo</span><span class="s2">&quot;Id:&quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">id</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-24-41" name="__codelineno-24-41"></a>         <span class="k">echo</span><span class="s2">&quot;Descripci√≥n:&quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">descripcion</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-24-42" name="__codelineno-24-42"></a>         <span class="k">echo</span><span class="s2">&quot;Stock:&quot;</span> <span class="o">.</span> <span class="nv">$p</span> <span class="o">-&gt;</span> <span class="na">stock</span> <span class="o">.</span> <span class="s2">&quot;&lt;br /&gt;&lt;br /&gt;&quot;</span><span class="p">;</span>
<a id="__codelineno-24-43" name="__codelineno-24-43"></a>     <span class="p">}</span>        
<a id="__codelineno-24-44" name="__codelineno-24-44"></a>
<a id="__codelineno-24-45" name="__codelineno-24-45"></a>  <span class="p">}</span><span class="k">catch</span><span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-24-46" name="__codelineno-24-46"></a>     <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-24-47" name="__codelineno-24-47"></a>  <span class="p">}</span>
<a id="__codelineno-24-48" name="__codelineno-24-48"></a>
<a id="__codelineno-24-49" name="__codelineno-24-49"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<p>Ten√©is una lista de ejemplos muy completa en la <a href="https://phpdelusions.net/pdo/objects">documentaci√≥n oficial</a>.</p>
<h1 id="login-password">login &amp; password</h1>
<p><img alt="" src="/assets/img08_06-login-password.gif" /></p>
<p>Para manejar un sistema completo de login y password con contrase√±as cifradas, necesitamos un m√©todo que cifre esos strings que el usuario introduce como contrase√±a; tanto en el formulario de registro como en el del login, ya que al codificar una contrase√±a, despu√©s tenemos que decodificarla para comprobar que ambas contras√±eas (la que instroduce el usuario en el login y la que tenemos en la base de datos) coincidan.</p>
<p>Necesitamos pues:</p>
<p>1¬∫ ) <code>password_hash()</code> para almacenar la contrase√±a en la base de datos a la hora de hacer el INSERT.</p>
<ul>
<li><code>PASSWORD_DEFAULT</code> almacenamos la contrase√±a usando el m√©todo de encriptaci√≥n <em>bcrypt</em>.</li>
<li><code>PASSWORD_BCRYPT</code> almacenamos la contrase√±a usando el algoritmo CRYPT_BLOWFISH compatible con crypt().</li>
</ul>
<p>2¬∫ ) <code>password_verify()</code> para verificar el usuario y la contrase√±a.</p>
<p>Ejemplo:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">HTML</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span>
<span class="normal"><a href="#__codelineno-25-2">2</a></span>
<span class="normal"><a href="#__codelineno-25-3">3</a></span>
<span class="normal"><a href="#__codelineno-25-4">4</a></span>
<span class="normal"><a href="#__codelineno-25-5">5</a></span>
<span class="normal"><a href="#__codelineno-25-6">6</a></span>
<span class="normal"><a href="#__codelineno-25-7">7</a></span>
<span class="normal"><a href="#__codelineno-25-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;loginCrear.php&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-25-2" name="__codelineno-25-2"></a>    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;usuario&quot;</span><span class="p">&gt;</span>usuario: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<a id="__codelineno-25-3" name="__codelineno-25-3"></a>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;usuario&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4"></a>    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">&gt;</span>password: <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5"></a>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;password&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;password&quot;</span><span class="p">&gt;</span> 
<a id="__codelineno-25-6" name="__codelineno-25-6"></a>
<a id="__codelineno-25-7" name="__codelineno-25-7"></a>    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;enviar&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;enviar&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span>
<span class="normal"><a href="#__codelineno-26-20">20</a></span>
<span class="normal"><a href="#__codelineno-26-21">21</a></span>
<span class="normal"><a href="#__codelineno-26-22">22</a></span>
<span class="normal"><a href="#__codelineno-26-23">23</a></span>
<span class="normal"><a href="#__codelineno-26-24">24</a></span>
<span class="normal"><a href="#__codelineno-26-25">25</a></span>
<span class="normal"><a href="#__codelineno-26-26">26</a></span>
<span class="normal"><a href="#__codelineno-26-27">27</a></span>
<span class="normal"><a href="#__codelineno-26-28">28</a></span>
<span class="normal"><a href="#__codelineno-26-29">29</a></span>
<span class="normal"><a href="#__codelineno-26-30">30</a></span>
<span class="normal"><a href="#__codelineno-26-31">31</a></span>
<span class="normal"><a href="#__codelineno-26-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí loginCrear.php ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a>  <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a>  <span class="k">try</span><span class="p">{</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a>    <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a>    <span class="nv">$usu</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;usuario&quot;</span><span class="p">];</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a>    <span class="nv">$pas</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;password&quot;</span><span class="p">];</span>    
<a id="__codelineno-26-12" name="__codelineno-26-12"></a>    <span class="nv">$fechaActual</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s2">&quot;Y-m-d H:i:s&quot;</span><span class="p">);</span> 
<a id="__codelineno-26-13" name="__codelineno-26-13"></a>    <span class="nv">$cre</span> <span class="o">=</span> <span class="nv">$fechaActual</span><span class="p">;</span> 
<a id="__codelineno-26-14" name="__codelineno-26-14"></a>    <span class="nv">$acc</span> <span class="o">=</span> <span class="nv">$fechaActual</span><span class="p">;</span>  
<a id="__codelineno-26-15" name="__codelineno-26-15"></a>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO usuarios (usuario, password, created, access) </span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="s2">                                      VALUES (:usu, :pas, :cre, :acc)&quot;</span><span class="p">;</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a>    <span class="nv">$isOk</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a>            <span class="s2">&quot;usu&quot;</span> <span class="o">=&gt;</span> <span class="nv">$usu</span><span class="p">,</span>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a>            <span class="s2">&quot;pas&quot;</span> <span class="o">=&gt;</span> <span class="nb">password_hash</span><span class="p">(</span><span class="nv">$pas</span><span class="p">,</span><span class="nx">PASSWORD_DEFAULT</span><span class="p">),</span>
<a id="__codelineno-26-23" name="__codelineno-26-23"></a>            <span class="s2">&quot;cre&quot;</span> <span class="o">=&gt;</span> <span class="nv">$cre</span><span class="p">,</span>
<a id="__codelineno-26-24" name="__codelineno-26-24"></a>            <span class="s2">&quot;acc&quot;</span> <span class="o">=&gt;</span> <span class="nv">$acc</span>
<a id="__codelineno-26-25" name="__codelineno-26-25"></a>            <span class="p">]);</span>
<a id="__codelineno-26-26" name="__codelineno-26-26"></a>    <span class="c1">//$idGenerado = $conexion -&gt; lastInsertId();</span>
<a id="__codelineno-26-27" name="__codelineno-26-27"></a>
<a id="__codelineno-26-28" name="__codelineno-26-28"></a>  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-26-29" name="__codelineno-26-29"></a>    <span class="k">echo</span> <span class="nv">$e</span> <span class="o">-&gt;</span> <span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-26-30" name="__codelineno-26-30"></a>  <span class="p">}</span>
<a id="__codelineno-26-31" name="__codelineno-26-31"></a>
<a id="__codelineno-26-32" name="__codelineno-26-32"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>  
</code></pre></div></td></tr></table></div>
<p>Ahora que tenemos el usuario codificado y guardado en la base de datos, vamos a recuperarlo para poder loguearlo correctamente.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span>
<span class="normal"><a href="#__codelineno-27-17">17</a></span>
<span class="normal"><a href="#__codelineno-27-18">18</a></span>
<span class="normal"><a href="#__codelineno-27-19">19</a></span>
<span class="normal"><a href="#__codelineno-27-20">20</a></span>
<span class="normal"><a href="#__codelineno-27-21">21</a></span>
<span class="normal"><a href="#__codelineno-27-22">22</a></span>
<span class="normal"><a href="#__codelineno-27-23">23</a></span>
<span class="normal"><a href="#__codelineno-27-24">24</a></span>
<span class="normal"><a href="#__codelineno-27-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-27-2" name="__codelineno-27-2"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí Recuperando usuario y password en BD ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-27-3" name="__codelineno-27-3"></a>  <span class="k">include</span> <span class="s2">&quot;config/database.inc.php&quot;</span><span class="p">;</span>
<a id="__codelineno-27-4" name="__codelineno-27-4"></a>  <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5"></a>  <span class="k">try</span><span class="p">{</span>
<a id="__codelineno-27-6" name="__codelineno-27-6"></a>    <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nx">DSN</span><span class="p">,</span> <span class="nx">USUARIO</span><span class="p">,</span> <span class="nx">PASSWORD</span><span class="p">);</span>
<a id="__codelineno-27-7" name="__codelineno-27-7"></a>    <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">setAttribute</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">ATTR_ERRMODE</span><span class="p">,</span> <span class="nx">PDO</span><span class="o">::</span><span class="na">ERRMODE_EXCEPTION</span><span class="p">);</span>
<a id="__codelineno-27-8" name="__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9"></a>    <span class="nv">$usu</span> <span class="o">=</span> <span class="nv">$_POST</span><span class="p">[</span><span class="s2">&quot;usuario&quot;</span><span class="p">]</span> <span class="o">??</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-27-10" name="__codelineno-27-10"></a>    <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">&quot;select * from usuarios where usuario = ?&quot;</span><span class="p">;</span>
<a id="__codelineno-27-11" name="__codelineno-27-11"></a>
<a id="__codelineno-27-12" name="__codelineno-27-12"></a>    <span class="nv">$sentencia</span> <span class="o">=</span> <span class="nv">$conexion</span> <span class="o">-&gt;</span> <span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
<a id="__codelineno-27-13" name="__codelineno-27-13"></a>    <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">execute</span><span class="p">([</span><span class="nv">$usu</span><span class="p">]);</span>
<a id="__codelineno-27-14" name="__codelineno-27-14"></a>
<a id="__codelineno-27-15" name="__codelineno-27-15"></a>    <span class="nv">$usuario</span> <span class="o">=</span> <span class="nv">$sentencia</span> <span class="o">-&gt;</span> <span class="na">fetch</span><span class="p">();</span>
<a id="__codelineno-27-16" name="__codelineno-27-16"></a>
<a id="__codelineno-27-17" name="__codelineno-27-17"></a>    <span class="k">if</span><span class="p">(</span><span class="nv">$usuario</span> <span class="o">&amp;&amp;</span> <span class="nb">password_verify</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span> <span class="nv">$usuario</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]))</span> <span class="p">{</span>
<a id="__codelineno-27-18" name="__codelineno-27-18"></a>        <span class="k">echo</span><span class="s2">&quot;OK!&quot;</span><span class="p">;</span>
<a id="__codelineno-27-19" name="__codelineno-27-19"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a id="__codelineno-27-20" name="__codelineno-27-20"></a>        <span class="k">echo</span><span class="s2">&quot;KO&quot;</span><span class="p">;</span>
<a id="__codelineno-27-21" name="__codelineno-27-21"></a>    <span class="p">}</span>
<a id="__codelineno-27-22" name="__codelineno-27-22"></a>  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">PDOException</span> <span class="nv">$e</span><span class="p">){</span>
<a id="__codelineno-27-23" name="__codelineno-27-23"></a>    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<a id="__codelineno-27-24" name="__codelineno-27-24"></a> <span class="p">}</span>
<a id="__codelineno-27-25" name="__codelineno-27-25"></a> <span class="nv">$conexion</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</code></pre></div></td></tr></table></div>
<h1 id="acceso-a-ficheros">acceso a ficheros</h1>
<p>Gracias a la funcion <code>fopen()</code> desde PHP podemos abrir archivos que se encuentren en nuestros servidor o una URL.</p>
<p>A esta funci√≥n hay que pasarle 2 par√°metros; el <strong>nombre del archivo</strong> que queremos abrir <strong>y</strong> el <strong>modo</strong> en el que se abrir√°:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="x">$fp = fopen(&quot;miarchivo.txt&quot;, &quot;r&quot;);</span>
</code></pre></div></td></tr></table></div>
<p>Muchas veces no podemos abrir el archivo porque √©ste no se encuentra o no tenemos acceso a √©l; por eso es recomendable comprobar que podemos hacerlo:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="x">if (!$fp = fopen(&quot;miarchivo.txt&quot;, &quot;r&quot;)){</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="x">    echo &quot;No se ha podido abrir el archivo&quot;;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="modos-de-apertura-de-ficheros">modos de apertura de ficheros</h2>
<ul>
<li><code>r</code> : Modo lectura. Puntero al principio del archivo.</li>
<li><code>r+</code> : Apertura para lectura y escritura. Puntero al principio del archivo.</li>
<li><code>w</code> : Apertura para escritura. Puntero al principio del archivo y lo sobreescribe. Si no existe se intenta crear.</li>
<li><code>w+</code> : Apertura para lectura y escritura. Puntero al principio del archivo y lo sobreescribe. Si no existe se intenta crear.</li>
<li><code>a</code> : Apertura para escritura. Puntero al final del archivo. Si no existe se intenta crear.</li>
<li><code>a+</code> : Apertura para lectura y escritura. Puntero al final del archivo. Si no existe se intenta crear.</li>
<li><code>x</code> : Creaci√≥n y apertura para s√≥lo escritura. Puntero al principio del archivo. Si el archivo ya existe dar√° error E_WARNING. Si no existe se intenta crear.</li>
<li><code>x+</code> : Creaci√≥n y apertura para lectura y escritura. Mismo comportamiento que x.</li>
<li><code>c</code> : Apertura para escritura. Si no existe se crea. Si existe no se sobreescribe ni da ning√∫n error. Puntero al principio del archivo.</li>
<li><code>c+</code> : Apertura para lectura y escritura. Mismo comportamiento que C.</li>
<li><code>b</code> : Cuando se trabaja con archivos binarios como jpg, pdf, png y dem√°s. Se suele colocar al final del modo, es decir rb, r+b, x+b, wb...</li>
</ul>
<h2 id="operaciones-con-archivos">operaciones con archivos</h2>
<p>Para poder <strong>leer</strong> un archivo necesitamos usar la funci√≥n <code>fread()</code> de PHP:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="x">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí Abriendo un archivo y leyendo su contenido ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="x">$file = &quot;miarchivo.txt&quot;;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="x">$fp = fopen($file, &quot;r&quot;);</span>
<a id="__codelineno-30-4" name="__codelineno-30-4"></a>
<a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="x">// $contents guardar√° el contenido</span>
<a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="x">// filesize() nos devuelve el tama√±o del archivo en cuesti√≥n</span>
<a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="x">$contents = fread($fp, filesize($file));</span>
<a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="x">print $contents;</span>
<a id="__codelineno-30-9" name="__codelineno-30-9"></a>
<a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="x">// Cerramos la conexi√≥n con el archivo</span>
<a id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="x">fclose($fp)</span>
</code></pre></div></td></tr></table></div>
<p>Si lo que queremos es <strong>escribir</strong> en un archivo, deberemos hacer uso de la funci√≥n<code>fwrite()</code> :</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-1">1</a></span>
<span class="normal"><a href="#__codelineno-31-2">2</a></span>
<span class="normal"><a href="#__codelineno-31-3">3</a></span>
<span class="normal"><a href="#__codelineno-31-4">4</a></span>
<span class="normal"><a href="#__codelineno-31-5">5</a></span>
<span class="normal"><a href="#__codelineno-31-6">6</a></span>
<span class="normal"><a href="#__codelineno-31-7">7</a></span>
<span class="normal"><a href="#__codelineno-31-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="x">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí Escribiendo en un archivo ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="x">$file = &quot;miarchivo.txt&quot;;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="x">$texto = &quot;Hola qu√© tal&quot;;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="x">$fp = fopen($file, &quot;w&quot;);</span>
<a id="__codelineno-31-6" name="__codelineno-31-6"></a>
<a id="__codelineno-31-7" name="__codelineno-31-7"></a><span class="x">fwrite($fp, $texto);</span>
<a id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="x">fclose($fp);</span>
</code></pre></div></td></tr></table></div>
<h2 id="informacion-de-un-fichero">informaci√≥n de un fichero</h2>
<p>Con PHP y su m√©todo <code>stat()</code> podemos obtener informaci√≥n sobre los archivos que le indiquemos. Este m√©todo devuelve hasta un total de 12 elementos con informaci√≥n acerca de nuestro archivo.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Text Only</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-32-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-32-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-32-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-32-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-32-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-32-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-32-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-32-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-32-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-32-10">10</a></span>
<span class="normal"><a href="#__codelineno-32-11">11</a></span>
<span class="normal"><a href="#__codelineno-32-12">12</a></span>
<span class="normal"><a href="#__codelineno-32-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1"></a>0   dev         n√∫mero de dispositivo
<a id="__codelineno-32-2" name="__codelineno-32-2"></a>1   ino         n√∫mero de i-nodo
<a id="__codelineno-32-3" name="__codelineno-32-3"></a>2   mode        modo de protecci√≥n del i-nodo
<a id="__codelineno-32-4" name="__codelineno-32-4"></a>3   nlink       n√∫mero de enlaces
<a id="__codelineno-32-5" name="__codelineno-32-5"></a>4   uid         ID de usuario del propietario
<a id="__codelineno-32-6" name="__codelineno-32-6"></a>5   gid         ID de grupo del propietario
<a id="__codelineno-32-7" name="__codelineno-32-7"></a>6   rdev        tipo de dispositivo, si es un dispositivo i-nodo
<a id="__codelineno-32-8" name="__codelineno-32-8"></a>7   size        tama√±o en bytes
<a id="__codelineno-32-9" name="__codelineno-32-9"></a>8   atime       momento del √∫ltimo acceso (tiempo Unix)
<a id="__codelineno-32-10" name="__codelineno-32-10"></a>9   mtime       momento de la √∫ltima modificaci√≥n (tiempo Unix)
<a id="__codelineno-32-11" name="__codelineno-32-11"></a>10  ctime       momento de la √∫ltima modificaci√≥n del i-nodo (tiempo Unix)
<a id="__codelineno-32-12" name="__codelineno-32-12"></a>11  blksize     tama√±o del bloque E/S del sistema de ficheros
<a id="__codelineno-32-13" name="__codelineno-32-13"></a>12  blocks      n√∫mero de bloques de 512 bytes asignados
</code></pre></div></td></tr></table></div>
<p>Unos ejemplos...</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-33-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-33-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-33-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-33-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-33-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-33-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-33-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-33-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-33-10">10</a></span>
<span class="normal"><a href="#__codelineno-33-11">11</a></span>
<span class="normal"><a href="#__codelineno-33-12">12</a></span>
<span class="normal"><a href="#__codelineno-33-13">13</a></span>
<span class="normal"><a href="#__codelineno-33-14">14</a></span>
<span class="normal"><a href="#__codelineno-33-15">15</a></span>
<span class="normal"><a href="#__codelineno-33-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-33-2" name="__codelineno-33-2"></a>  <span class="c1">// ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí Informaci√≥n del archivo ‚ñí‚ñí‚ñí‚ñí‚ñí‚ñí</span>
<a id="__codelineno-33-3" name="__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4"></a>  <span class="nv">$file</span> <span class="o">=</span> <span class="s2">&quot;miarchivo.txt&quot;</span><span class="p">;</span>
<a id="__codelineno-33-5" name="__codelineno-33-5"></a>  <span class="nv">$texto</span> <span class="o">=</span> <span class="s2">&quot;Todos somos muy ignorantes, lo que ocurre es que no todos ignoramos las mismas cosas.&quot;</span><span class="p">;</span>
<a id="__codelineno-33-6" name="__codelineno-33-6"></a>
<a id="__codelineno-33-7" name="__codelineno-33-7"></a>  <span class="nv">$fp</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">);</span>
<a id="__codelineno-33-8" name="__codelineno-33-8"></a>  <span class="nb">fwrite</span><span class="p">(</span><span class="nv">$fp</span><span class="p">,</span> <span class="nv">$texto</span><span class="p">);</span>
<a id="__codelineno-33-9" name="__codelineno-33-9"></a>
<a id="__codelineno-33-10" name="__codelineno-33-10"></a>  <span class="nv">$datos</span> <span class="o">=</span> <span class="nb">stat</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
<a id="__codelineno-33-11" name="__codelineno-33-11"></a>
<a id="__codelineno-33-12" name="__codelineno-33-12"></a>  <span class="k">echo</span> <span class="nv">$datos</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// N√∫mero de enlaces, 1</span>
<a id="__codelineno-33-13" name="__codelineno-33-13"></a>  <span class="k">echo</span> <span class="nv">$datos</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// Tama√±o en bytes, 85</span>
<a id="__codelineno-33-14" name="__codelineno-33-14"></a>  <span class="k">echo</span> <span class="nv">$datos</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// Momento de √∫ltimo acceso, 1444138104</span>
<a id="__codelineno-33-15" name="__codelineno-33-15"></a>  <span class="k">echo</span> <span class="nv">$datos</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">.</span> <span class="s2">&quot;&lt;br&gt;&quot;</span><span class="p">;</span> <span class="c1">// Momento de √∫ltima modificaci√≥n, 1444138251</span>
<a id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="cp">?&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Echa un vistazo a <a href="https://www.php.net/manual/es/book.dir.php">las funciones de directorios</a> que tiene PHP, es muy interesante.</p>
<h2 id="archivos-pdf">archivos PDF</h2>
<p><img src="/assets/img09_06-pdf.png" alt="logo PDF" style="zoom:22%; float:right;" />Con PHP podemos manejar todo tipo de archivos como ya hemos visto pero, ¬øqu√© pasa si queremos generar ficheros PDF con datos sacados de una base de datos?</p>
<p>Gracias a una clase escrita en PHP, podemos generar archivos PDF sin necesidad de instalar librer√≠as adicionales en nuestro servidor.</p>
<p>Para ello, como tenemos composer dentro de nuestra imagen de Docker, usaremos <strong>composer</strong> para instalar esta dependencia.</p>
<p>Acu√©rdate que debemos haber hecho <code>composer init</code> para empezar un proyecto con composer, de lo contrario no podr√°s a√±adir ning√∫n paquete.</p>
<p>Veamos un ejemplo de <code>Hello World</code> convertido a PDF:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-34-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-34-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-34-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-34-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-34-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-34-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-34-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-34-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-34-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-34-10">10</a></span>
<span class="normal"><a href="#__codelineno-34-11">11</a></span>
<span class="normal"><a href="#__codelineno-34-12">12</a></span>
<span class="normal"><a href="#__codelineno-34-13">13</a></span>
<span class="normal"><a href="#__codelineno-34-14">14</a></span>
<span class="normal"><a href="#__codelineno-34-15">15</a></span>
<span class="normal"><a href="#__codelineno-34-16">16</a></span>
<span class="normal"><a href="#__codelineno-34-17">17</a></span>
<span class="normal"><a href="#__codelineno-34-18">18</a></span>
<span class="normal"><a href="#__codelineno-34-19">19</a></span>
<span class="normal"><a href="#__codelineno-34-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-34-2" name="__codelineno-34-2"></a>    <span class="nb">ob_end_clean</span><span class="p">();</span>
<a id="__codelineno-34-3" name="__codelineno-34-3"></a>    <span class="k">require</span><span class="p">(</span><span class="s1">&#39;fpdf/fpdf.php&#39;</span><span class="p">);</span>
<a id="__codelineno-34-4" name="__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5"></a>    <span class="c1">// Instanciamos la clase</span>
<a id="__codelineno-34-6" name="__codelineno-34-6"></a>    <span class="c1">// P = Portrait | mm = unidades en mil√≠metros | A4 = formato</span>
<a id="__codelineno-34-7" name="__codelineno-34-7"></a>    <span class="nv">$pdf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FPDF</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="s1">&#39;mm&#39;</span><span class="p">,</span><span class="s1">&#39;A4&#39;</span><span class="p">);</span>
<a id="__codelineno-34-8" name="__codelineno-34-8"></a>
<a id="__codelineno-34-9" name="__codelineno-34-9"></a>    <span class="c1">// A√±adimos una p√°gina</span>
<a id="__codelineno-34-10" name="__codelineno-34-10"></a>    <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">AddPage</span><span class="p">();</span>
<a id="__codelineno-34-11" name="__codelineno-34-11"></a>
<a id="__codelineno-34-12" name="__codelineno-34-12"></a>    <span class="c1">// Establecemos la fuente y el tama√±o de letra</span>
<a id="__codelineno-34-13" name="__codelineno-34-13"></a>    <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">SetFont</span><span class="p">(</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
<a id="__codelineno-34-14" name="__codelineno-34-14"></a>
<a id="__codelineno-34-15" name="__codelineno-34-15"></a>    <span class="c1">// Imprimimos una celda con el texto que nosotros queramos</span>
<a id="__codelineno-34-16" name="__codelineno-34-16"></a>    <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">Cell</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;Hello World!&#39;</span><span class="p">);</span>
<a id="__codelineno-34-17" name="__codelineno-34-17"></a>
<a id="__codelineno-34-18" name="__codelineno-34-18"></a>    <span class="c1">// Terminamos el PDF</span>
<a id="__codelineno-34-19" name="__codelineno-34-19"></a>    <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">Output</span><span class="p">();</span>
<a id="__codelineno-34-20" name="__codelineno-34-20"></a><span class="cp">?&gt;</span>
</code></pre></div></td></tr></table></div>
<p>Hay muchos ejemplos y tutoriales, as√≠ como documentaci√≥n de la clase FPDF en la p√°gina oficial. </p>
<p>Visita <a href="http://www.fpdf.org/">la secci√≥n de tutoriales y el manual</a> para sacar mayor partido a esta clase.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span>
<span class="normal"><a href="#__codelineno-35-16">16</a></span>
<span class="normal"><a href="#__codelineno-35-17">17</a></span>
<span class="normal"><a href="#__codelineno-35-18">18</a></span>
<span class="normal"><a href="#__codelineno-35-19">19</a></span>
<span class="normal"><a href="#__codelineno-35-20">20</a></span>
<span class="normal"><a href="#__codelineno-35-21">21</a></span>
<span class="normal"><a href="#__codelineno-35-22">22</a></span>
<span class="normal"><a href="#__codelineno-35-23">23</a></span>
<span class="normal"><a href="#__codelineno-35-24">24</a></span>
<span class="normal"><a href="#__codelineno-35-25">25</a></span>
<span class="normal"><a href="#__codelineno-35-26">26</a></span>
<span class="normal"><a href="#__codelineno-35-27">27</a></span>
<span class="normal"><a href="#__codelineno-35-28">28</a></span>
<span class="normal"><a href="#__codelineno-35-29">29</a></span>
<span class="normal"><a href="#__codelineno-35-30">30</a></span>
<span class="normal"><a href="#__codelineno-35-31">31</a></span>
<span class="normal"><a href="#__codelineno-35-32">32</a></span>
<span class="normal"><a href="#__codelineno-35-33">33</a></span>
<span class="normal"><a href="#__codelineno-35-34">34</a></span>
<span class="normal"><a href="#__codelineno-35-35">35</a></span>
<span class="normal"><a href="#__codelineno-35-36">36</a></span>
<span class="normal"><a href="#__codelineno-35-37">37</a></span>
<span class="normal"><a href="#__codelineno-35-38">38</a></span>
<span class="normal"><a href="#__codelineno-35-39">39</a></span>
<span class="normal"><a href="#__codelineno-35-40">40</a></span>
<span class="normal"><a href="#__codelineno-35-41">41</a></span>
<span class="normal"><a href="#__codelineno-35-42">42</a></span>
<span class="normal"><a href="#__codelineno-35-43">43</a></span>
<span class="normal"><a href="#__codelineno-35-44">44</a></span>
<span class="normal"><a href="#__codelineno-35-45">45</a></span>
<span class="normal"><a href="#__codelineno-35-46">46</a></span>
<span class="normal"><a href="#__codelineno-35-47">47</a></span>
<span class="normal"><a href="#__codelineno-35-48">48</a></span>
<span class="normal"><a href="#__codelineno-35-49">49</a></span>
<span class="normal"><a href="#__codelineno-35-50">50</a></span>
<span class="normal"><a href="#__codelineno-35-51">51</a></span>
<span class="normal"><a href="#__codelineno-35-52">52</a></span>
<span class="normal"><a href="#__codelineno-35-53">53</a></span>
<span class="normal"><a href="#__codelineno-35-54">54</a></span>
<span class="normal"><a href="#__codelineno-35-55">55</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-35-2" name="__codelineno-35-2"></a>
<a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="k">require</span><span class="p">(</span><span class="s1">&#39;fpdf/fpdf.php&#39;</span><span class="p">);</span>
<a id="__codelineno-35-4" name="__codelineno-35-4"></a>
<a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="k">class</span> <span class="nc">PDF</span> <span class="k">extends</span> <span class="nx">FPDF</span> <span class="p">{</span>
<a id="__codelineno-35-6" name="__codelineno-35-6"></a>
<a id="__codelineno-35-7" name="__codelineno-35-7"></a>    <span class="c1">// Cabecera</span>
<a id="__codelineno-35-8" name="__codelineno-35-8"></a>    <span class="k">function</span> <span class="nf">Header</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-35-9" name="__codelineno-35-9"></a>
<a id="__codelineno-35-10" name="__codelineno-35-10"></a>        <span class="c1">// A√±adimos un logotipo</span>
<a id="__codelineno-35-11" name="__codelineno-35-11"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Image</span><span class="p">(</span><span class="s1">&#39;logo.png&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">33</span><span class="p">);</span>
<a id="__codelineno-35-12" name="__codelineno-35-12"></a>
<a id="__codelineno-35-13" name="__codelineno-35-13"></a>        <span class="c1">// establecemos la fuente y el tama√±o</span>
<a id="__codelineno-35-14" name="__codelineno-35-14"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">SetFont</span><span class="p">(</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">);</span>
<a id="__codelineno-35-15" name="__codelineno-35-15"></a>
<a id="__codelineno-35-16" name="__codelineno-35-16"></a>        <span class="c1">// Movemos el contenido un poco a la derecha</span>
<a id="__codelineno-35-17" name="__codelineno-35-17"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Cell</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
<a id="__codelineno-35-18" name="__codelineno-35-18"></a>
<a id="__codelineno-35-19" name="__codelineno-35-19"></a>        <span class="c1">// Pintamos la celda</span>
<a id="__codelineno-35-20" name="__codelineno-35-20"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Cell</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;Cabecera&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">);</span>
<a id="__codelineno-35-21" name="__codelineno-35-21"></a>
<a id="__codelineno-35-22" name="__codelineno-35-22"></a>        <span class="c1">// Pasamos a la siguiente l√≠nea</span>
<a id="__codelineno-35-23" name="__codelineno-35-23"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Ln</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
<a id="__codelineno-35-24" name="__codelineno-35-24"></a>    <span class="p">}</span>
<a id="__codelineno-35-25" name="__codelineno-35-25"></a>
<a id="__codelineno-35-26" name="__codelineno-35-26"></a>    <span class="c1">// Pie de p√°gina</span>
<a id="__codelineno-35-27" name="__codelineno-35-27"></a>    <span class="k">function</span> <span class="nf">Footer</span><span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-35-28" name="__codelineno-35-28"></a>
<a id="__codelineno-35-29" name="__codelineno-35-29"></a>        <span class="c1">// Nos posicionamos a 1.5 cm  desde abajo del todo de la p√°gina</span>
<a id="__codelineno-35-30" name="__codelineno-35-30"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">SetY</span><span class="p">(</span><span class="o">-</span><span class="mi">15</span><span class="p">);</span>
<a id="__codelineno-35-31" name="__codelineno-35-31"></a>
<a id="__codelineno-35-32" name="__codelineno-35-32"></a>        <span class="c1">// Arial italic 8</span>
<a id="__codelineno-35-33" name="__codelineno-35-33"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">SetFont</span><span class="p">(</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="mi">8</span><span class="p">);</span>
<a id="__codelineno-35-34" name="__codelineno-35-34"></a>
<a id="__codelineno-35-35" name="__codelineno-35-35"></a>        <span class="c1">// N√∫mero de p√°gina</span>
<a id="__codelineno-35-36" name="__codelineno-35-36"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;P√°gina &#39;</span> <span class="o">.</span> 
<a id="__codelineno-35-37" name="__codelineno-35-37"></a>            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">PageNo</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;/{nb}&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">);</span>
<a id="__codelineno-35-38" name="__codelineno-35-38"></a>    <span class="p">}</span>
<a id="__codelineno-35-39" name="__codelineno-35-39"></a><span class="p">}</span>
<a id="__codelineno-35-40" name="__codelineno-35-40"></a>
<a id="__codelineno-35-41" name="__codelineno-35-41"></a><span class="c1">// Instanciamos la clase</span>
<a id="__codelineno-35-42" name="__codelineno-35-42"></a><span class="nv">$pdf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDF</span><span class="p">();</span>
<a id="__codelineno-35-43" name="__codelineno-35-43"></a>
<a id="__codelineno-35-44" name="__codelineno-35-44"></a><span class="c1">// Definimos un alias para la numeraci√≥n de p√°ginas</span>
<a id="__codelineno-35-45" name="__codelineno-35-45"></a><span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">AliasNbPages</span><span class="p">();</span>
<a id="__codelineno-35-46" name="__codelineno-35-46"></a>
<a id="__codelineno-35-47" name="__codelineno-35-47"></a><span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">AddPage</span><span class="p">();</span>
<a id="__codelineno-35-48" name="__codelineno-35-48"></a><span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">SetFont</span><span class="p">(</span><span class="s1">&#39;Times&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="mi">14</span><span class="p">);</span>
<a id="__codelineno-35-49" name="__codelineno-35-49"></a>
<a id="__codelineno-35-50" name="__codelineno-35-50"></a><span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
<a id="__codelineno-35-51" name="__codelineno-35-51"></a>    <span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">Cell</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;N√∫mero de l√≠nea &#39;</span> 
<a id="__codelineno-35-52" name="__codelineno-35-52"></a>            <span class="o">.</span> <span class="nv">$i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-35-53" name="__codelineno-35-53"></a><span class="nv">$pdf</span><span class="o">-&gt;</span><span class="na">Output</span><span class="p">();</span>
<a id="__codelineno-35-54" name="__codelineno-35-54"></a>
<a id="__codelineno-35-55" name="__codelineno-35-55"></a><span class="cp">?&gt;</span>
</code></pre></div></td></tr></table></div>
<p><img alt="" src="/assets/img09_06-pdf-output.gif" /></p>
<h1 id="referencias">referencias</h1>
<ul>
<li><a href="https://desarrolloweb.com/manuales/tutorial-composer.html">Tutorial de Composer</a></li>
<li><a href="https://www.freecodecamp.org/news/web-scraping-with-php-crawl-web-pages/">Web Scraping with PHP ‚Äì How to Crawl Web Pages Using Open Source Tools</a></li>
<li><a href="https://zetcode.com/php/monolog/">PHP Monolog</a></li>
<li><a href="https://medium.com/@emilianozublena/unit-testing-con-phpunit-parte-1-148c6d73e822">Unit Testing con PHPUnit ‚Äî Parte 1,</a> de Emiliano Zublena.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer", "navigation.top"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>