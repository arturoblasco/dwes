
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ud1202/">
      
      
        <link rel="next" href="../ud12ac/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>12.3 Autenticación basada en tokens - Desarrollo Web en Entorno Servidor (DWES)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#autenticacion-basada-en-tokens" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Desarrollo Web en Entorno Servidor (DWES)" class="md-header__button md-logo" aria-label="Desarrollo Web en Entorno Servidor (DWES)" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Desarrollo Web en Entorno Servidor (DWES)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              12.3 Autenticación basada en tokens
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Canvia a mode oscur"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Canvia a mode oscur" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Canvia a mode normal"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canvia a mode normal" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Desarrollo Web en Entorno Servidor (DWES)" class="md-nav__button md-logo" aria-label="Desarrollo Web en Entorno Servidor (DWES)" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    Desarrollo Web en Entorno Servidor (DWES)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bloc I - PHP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Bloc I - PHP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 1 Arquitectura Web
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            UD 1 Arquitectura Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.1 Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0102/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2 Cliente/servidor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0103/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3 Arquitectura de 3 capas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0104/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.4 MVC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0105/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.5 Decisiones de diseño
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0106/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.6 Herramientas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0107/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.7 Puesta en marcha
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0108/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.8 Manual Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud01de/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descargas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud01ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud01re/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referencias
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 2 Lenguaje PHP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            UD 2 Lenguaje PHP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud0201/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1 Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud0202/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.2 PHP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud0203/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.3 Operadores
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud0204/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.4 Arrays
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud0205/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.5 Funciones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud0206/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.6 Funciones predefinidas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud0207/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.7 Expresiones regulares
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud02ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud02re/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referencias
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 3 PHP OO
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            UD 3 PHP OO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0301/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.1 Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0302/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.2 Clases y objetos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0303/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.3 Encapsulación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0304/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.4 Constructor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0305/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.5 Clases estáticas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0306/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.6 Introspección
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0307/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.7 Herencia
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0308/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.8 Clases abstractas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0309/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.9 Clases final
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0310/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.10 Interfaces
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0311/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.11 Métodos encadenados
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0312/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.12 Métodos mágicos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0313/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.13 Espacio de nombres
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0314/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.14 Gestión de errores
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0315/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.15 Excepciones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud0316/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.16 SPL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud03ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud03/ud03re/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referencias
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 4 Programación Web
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            UD 4 Programación Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud04/ud0401/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.1 Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud04/ud0402/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.2 Variable de servidor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud04/ud0403/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.3 Formularios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud04/ud0404/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.4 Cabeceras de respuesta
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud04/ud0405/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.5 Gestión de estado
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud04/ud0406/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.6 Autenticación de usuarios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud04/ud04ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud04/ud04re/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referencias
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 5 Acceso a Base de Datos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            UD 5 Acceso a Base de Datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud0501/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.1 Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud0502/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.2 Instalación
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud0503/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.3 Estructura de BD
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud0504/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.4 Chollometro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud0505/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.5 SQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud0506/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.6 phpMyAdmin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud0507/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.7 MySQLi
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud0508/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.8 PHP Data Objects-PDO
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud0509/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.9 login & password
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud0510/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.10 Acceso a ficheros
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud05ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud05/ud05re/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referencias
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bloc II - Laravel
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Bloc II - Laravel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 6 Herramientas Web
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            UD 6 Herramientas Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud06/ud0601/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.1 Introducción
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud06/ud0602/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.2 Composer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud06/ud0603/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.3 Monolog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud06/ud0604/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.4 Documentación con phpDocumentor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud06/ud0605/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.5 Web Scraping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud06/ud0606/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.6 Pruebas con phpUnit
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud06/ud06ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud06/ud06re/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referencias
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 7 Framework
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            UD 7 Framework
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud07/ud0701/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.1 Introducció
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud07/ud0702/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.2 Frameworks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud07/ud0703/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.3 Programari necessari
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud07/ud0704/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.4 Primeres passes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud07/ud0705/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.5 Rutes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud07/ud0706/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.6 Vistes amb Blade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud07/ud0707/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.7 Estils i Javascript
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud07/ud07ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activitats
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 8 Controladors
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            UD 8 Controladors
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud08/ud0801/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.1 Introducció
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud08/ud0802/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.2 Controladors i tipus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud08/ud0803/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.3 Injecció i dependències
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud08/ud08ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activitats
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 9 Model de dades
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            UD 9 Model de dades
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud09/ud0901/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.1 Introducció
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud09/ud0902/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.2 Accés a base de dades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud09/ud0903/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.3 Migracions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud09/ud0904/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.4 Model de dades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud09/ud0905/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.5 Relacions entre models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud09/ud0906/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.6 Seeders i factories
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud09/ud0907/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.7 Query Builder i ús de dades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud09/ud09ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activitats
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 10 Formularis i validacions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            UD 10 Formularis i validacions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud10/ud1001/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10.1 Introducció
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud10/ud1002/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10.2 Definició de formularis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud10/ud1003/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    10.3 Validació de dades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud10/ud10ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activitats
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 11 Serveis REST
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            UD 11 Serveis REST
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud11/ud1101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11.1 Introducció
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud11/ud1102/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11.2 Concepte de servei REST
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud11/ud1103/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    11.3 Creació de serveis REST
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud11/ud11ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activitats
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 12 Autenticació d'usuaris
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            UD 12 Autenticació d'usuaris
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ud1201/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12.1 Introducció
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ud1202/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    12.2 Autenticación basada en sesiones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    12.3 Autenticación basada en tokens
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    12.3 Autenticación basada en tokens
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fundamentos-de-la-autenticacion-basada-en-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Fundamentos de la autenticación basada en tokens
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternativas-para-la-implementacion-de-la-autenticacion-basada-en-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Alternativas para la implementación de la autenticación basada en tokens
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Alternativas para la implementación de la autenticación basada en tokens">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparando-el-ejemplo-base" class="md-nav__link">
    <span class="md-ellipsis">
      Preparando el ejemplo base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autenticacion-basada-en-tokens-nativa" class="md-nav__link">
    <span class="md-ellipsis">
      Autenticación basada en tokens nativa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Autenticación basada en tokens nativa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracion-basica" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración básica
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proteccion-de-rutas" class="md-nav__link">
    <span class="md-ellipsis">
      Protección de rutas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autenticacion-basada-en-tokens-usando-laravel-sanctum" class="md-nav__link">
    <span class="md-ellipsis">
      Autenticación basada en tokens usando Laravel Sanctum
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Autenticación basada en tokens usando Laravel Sanctum">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracion-de-sanctum" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración de Sanctum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proteccion-de-rutas_1" class="md-nav__link">
    <span class="md-ellipsis">
      Protección de rutas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prueba-de-autenticacion-basada-en-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Prueba de autenticación basada en tokens
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ud12ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activitats
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bloc2re/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referències
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fundamentos-de-la-autenticacion-basada-en-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Fundamentos de la autenticación basada en tokens
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#alternativas-para-la-implementacion-de-la-autenticacion-basada-en-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Alternativas para la implementación de la autenticación basada en tokens
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Alternativas para la implementación de la autenticación basada en tokens">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preparando-el-ejemplo-base" class="md-nav__link">
    <span class="md-ellipsis">
      Preparando el ejemplo base
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autenticacion-basada-en-tokens-nativa" class="md-nav__link">
    <span class="md-ellipsis">
      Autenticación basada en tokens nativa
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Autenticación basada en tokens nativa">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracion-basica" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración básica
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proteccion-de-rutas" class="md-nav__link">
    <span class="md-ellipsis">
      Protección de rutas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autenticacion-basada-en-tokens-usando-laravel-sanctum" class="md-nav__link">
    <span class="md-ellipsis">
      Autenticación basada en tokens usando Laravel Sanctum
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Autenticación basada en tokens usando Laravel Sanctum">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuracion-de-sanctum" class="md-nav__link">
    <span class="md-ellipsis">
      Configuración de Sanctum
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proteccion-de-rutas_1" class="md-nav__link">
    <span class="md-ellipsis">
      Protección de rutas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prueba-de-autenticacion-basada-en-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      Prueba de autenticación basada en tokens
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="autenticacion-basada-en-tokens">Autenticación basada en tokens</h1>
<p>En una API REST también puede ser necesario proteger ciertos servicios, de forma que sólo puedan acceder a ellos los usuarios autenticados. Sin embargo, en este caso no tenemos disponible el mecanismo de autenticación basado en sesiones que vimos antes, ya que la parte cliente que consulta la API REST no tiene por qué estar basada en un navegador. Podríamos acceder desde una aplicación de escritorio hecha en Java, por ejemplo, o desde una aplicación móvil, y en estos casos no podríamos disponer de las sesiones, propias de clientes web o navegadores. En su lugar, emplearemos un mecanismo de autenticación basado en <strong>tokens</strong>.</p>
<h2 id="fundamentos-de-la-autenticacion-basada-en-tokens">Fundamentos de la autenticación basada en tokens</h2>
<p>La autenticación basada en tokens es un mecanismo de validación de usuarios en aplicaciones cliente-servidor que podríamos decir que es más universal que la autenticación basada en sesiones, ya que permite autenticar usuarios provenientes de distintos tipos de clientes. Lo que se hace es lo siguiente:</p>
<ul>
<li>El usuario necesita enviar sus credenciales (<em>login</em> y <em>password</em>), de forma similar a como se hace en una aplicación web normal, aunque esta vez los datos se envían normalmente en formato JSON.</li>
<li>El servidor valida esas credenciales y, si son correctas, genera una cadena de texto llamada <em>token</em>, de una cierta longitud, y que servirá para identificar unívocamente al usuario a partir de ese momento. Dicho <em>token</em> debe ser enviado de vuelta (también en formato JSON) al cliente que se validó</li>
<li>A partir de este punto, el cliente debe adjuntar el <em>token</em> como parte de la información en cada petición que realiza a una zona de acceso restringido, de forma que el servidor pueda consultar el token y comprobar si corresponde con el de algún usuario autorizado. Este token normalmente se envía en una cabecera de la petición llamada <em>Authorization</em>, como veremos después, y el servidor puede consultar el valor de dicha cabecera para verificar el acceso del cliente.</li>
</ul>
<h2 id="alternativas-para-la-implementacion-de-la-autenticacion-basada-en-tokens">Alternativas para la implementación de la autenticación basada en tokens</h2>
<p>Podemos emplear distintas alternativas para la autenticación basada en tokens bajo Laravel. Comentaremos en esta sesión dos de ellas.</p>
<ul>
<li>Por un lado, podemos emplear el mecanismo nativo de Laravel para autenticación basada en tokens. Como ventajas principales, no se necesita instalar ninguna dependencia adicional, y es relativamente sencillo de utilizar. Como inconvenientes, requiere añadir un campo más a la tabla de usuarios, para almacenar el token generado para cada usuario, y requiere también de una gestión manual del token, aunque es sencilla.</li>
<li>Por otro lado podemos valernos de la librería <a href="https://laravel.com/docs/8.x/sanctum" target="_blank">Laravel Sanctum</a>, que proporciona mecanismos de autenticación para APIs y para SPAs (<em>Single Page Applications</em>, aplicaciones de página única). Entre sus ventajas podemos destacar que es sencilla de integrar en la aplicación y automatiza algunos aspectos de la gestión de tokens, además de contar con el soporte oficial de Laravel. Como inconvenientes, es una librería más intrusiva que la anterior, ya que requiere crear una tabla adicional donde almacenar los tokens.</li>
</ul>
<p>En los siguientes apartados veremos cómo proteger mediante tokens un proyecto sencillo en Laravel empleando cada uno de estos mecanismos. Como ejercicio de este apartado se pide que elijáis cualquiera de ellos y sigáis paso a paso el ejemplo para configurar la protección mediante tokens en él.</p>
<h3 id="preparando-el-ejemplo-base">Preparando el ejemplo base</h3>
<p>Partiremos de un mismo proyecto base, que luego adaptaremos en función del mecanismo de autenticación elegido. Comenzaremos creando un proyecto llamado <code>pruebaToken</code>, en nuestra carpeta de proyectos:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="x">laravel new pruebaToken</span>
</code></pre></div></td></tr></table></div>
<p>Después, eliminaremos las migraciones que no vamos a utilizar de la carpeta <code>database/migrations</code>: en concreto, eliminaremos los archivos sobre <em>create_password_resets_table</em> y <em>create_failed_jobs_table</em>, y dejaremos el resto. Sobre la migración de usuarios, editaremos los métodos <code>up</code> y <code>down</code> para dejar sólo los campos que nos interesen, y renombrar la tabla a <em>usuarios</em>, de este modo:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="x">public function up()</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="x">{</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="x">    Schema::create(&#39;usuarios&#39;, function (Blueprint $table) {</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="x">        $table-&gt;id();</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="x">        $table-&gt;string(&#39;login&#39;)-&gt;unique;</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="x">        $table-&gt;string(&#39;password&#39;);</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="x">        $table-&gt;timestamps();</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="x">    });</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="x">}</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="x">...</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="x">public function down()</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="x">{</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="x">    Schema::dropIfExists(&#39;usuarios&#39;);</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>A continuación, renombramos el modelo <code>App\Models\User.php</code> a <code>App\Models\Usuario.php</code>, cambiando también el nombre de la clase interior:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="x">class Usuario extends Authenticatable</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="x">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="x">    ...</span>
</code></pre></div></td></tr></table></div>
<p>Y hacemos lo mismo con el <em>factory</em> y el <em>seeder</em> correspondiente (modificamos directamente el <code>DatabaseSeeder</code> para no crear un <em>seeder</em> específico, en este caso):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span>
<span class="normal"><a href="#__codelineno-3-31">31</a></span>
<span class="normal"><a href="#__codelineno-3-32">32</a></span>
<span class="normal"><a href="#__codelineno-3-33">33</a></span>
<span class="normal"><a href="#__codelineno-3-34">34</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="x">namespace Database\Factories;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="x">use Illuminate\Database\Eloquent\Factories\Factory;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="x">/**</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="x"> * @extends \Illuminate\Database\Eloquent\Factories\Factory&lt;\App\Models\Usuario&gt;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="x"> */ </span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="x">class UsuarioFactory extends Factory</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="x">{</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="x">    /**</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="x">     * Define the model&#39;s default state.</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="x">     *</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="x">     * @return array</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="x">     */</span>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="x">    public function definition()</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="x">    {</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="x">        return [</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="x">            &#39;login&#39; =&gt; $this-&gt;faker-&gt;word,</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="x">            &#39;password&#39; =&gt; bcrypt(&#39;1234&#39;)</span>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="x">        ];</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="x">    }</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="x">}</span>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="x">class DatabaseSeeder extends Seeder</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="x">{</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="x">    /**</span>
<a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="x">     * Seed the application&#39;s database.</span>
<a id="__codelineno-3-27" name="__codelineno-3-27"></a><span class="x">     *</span>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a><span class="x">     * @return void</span>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="x">     */</span>
<a id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="x">    public function run()</span>
<a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="x">    {</span>
<a id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="x">         \App\Models\Usuario::factory(2)-&gt;create();</span>
<a id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="x">    }</span>
<a id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Vamos a modificar también el archivo <code>.env</code> del proyecto para acceder a una base de datos llamada <code>pruebaToken</code>, que deberemos crear a través de <em>phpMyAdmin</em>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="x">DB_CONNECTION=mysql</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="x">DB_HOST=127.0.0.1</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="x">DB_PORT=3306</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="x">DB_DATABASE=pruebaToken</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="x">DB_USERNAME=root</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="x">DB_PASSWORD=</span>
</code></pre></div></td></tr></table></div>
<p>Necesitamos también editar el archivo <code>App\Http\Middleware\Authenticate.php</code> para indicar en el método <code>redirectTo</code> que sólo queremos redirigir al formulario de login cuando la petición no espere una respuesta en formato JSON. En caso contrario, no hay que mostrar dicho formulario, sino enviar una respuesta JSON adecuada. De hecho, si la aplicación sólo va a tener servicios REST podríamos eliminar o dejar comentado el código de este método para que no trate de redirigir a ningún formulario.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="x">class Authenticate extends Middleware</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="x">{</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="x">    protected function redirectTo($request)</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="x">    {</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="x">        /*</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="x">        if (! $request-&gt;expectsJson()) {</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="x">            return route(&#39;login&#39;);</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="x">        }</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="x">        */</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="x">    }</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Por otra parte, debemos editar el archivo <code>App\Exceptions\Handler.php</code>, en concreto su método <code>register</code> para definir los diferentes errores que pueden producirse y los mensajes que hay que devolver en cada caso:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="x">use Illuminate\Auth\AuthenticationException;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="x">use Illuminate\Foundation\Exceptions\Handler as ExceptionHandler;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="x">use Illuminate\Database\Eloquent\ModelNotFoundException;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="x">use Illuminate\Validation\ValidationException;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="x">use Throwable;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="x">class Handler extends ExceptionHandler</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="x">{</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="x">    ...</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="x">    public function register()</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="x">    {</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="x">        $this-&gt;renderable(function (Throwable $exception) {</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="x">            if (request()-&gt;is(&#39;api*&#39;))</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="x">            {</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="x">                if ($exception instanceof ModelNotFoundException)</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="x">                    return response()-&gt;json(</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="x">                        [&#39;error&#39; =&gt; &#39;Elemento no encontrado&#39;], 404);</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="x">                else if ($exception instanceof AuthenticationException)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="x">                    return response()-&gt;json(</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="x">                        [&#39;error&#39; =&gt; &#39;Usuario no autenticado&#39;], 401);</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="x">                else if ($exception instanceof ValidationException)</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="x">                    return response()-&gt;json(</span>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="x">                        [&#39;error&#39; =&gt; &#39;Datos no válidos&#39;], 400);</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="x">                else if (isset($exception))</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="x">                    return response()-&gt;json(</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="x">                        [&#39;error&#39; =&gt; &#39;Error en la aplicación (&#39; .</span>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="x">                        get_class($exception) . &#39;):&#39; . </span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="x">                        $exception-&gt;getMessage()], 500);</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="x">            }</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="x">        });</span>
<a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="x">    }</span>
<a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Finalmente, vamos a definir un controlador de API con una serie de métodos de prueba. No lo vamos a vincular a ningún modelo, porque generaremos unos datos a mano en cada método para simplificar el código. Escribimos este comando:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="x">php artisan make:controller Api/PruebaController --api</span>
</code></pre></div></td></tr></table></div>
<p>Rellenamos el código de los métodos del controlador con alguna respuesta sencilla para cada caso:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="x">class PruebaController extends Controller</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="x">{</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="x">    public function index()</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="x">    {</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="x">        return response()-&gt;json([&#39;mensaje&#39; =&gt; &#39;Accediendo a index&#39;]);</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="x">    }</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="x">    public function store(Request $request)</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="x">    {</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="x">        return response()-&gt;json([&#39;mensaje&#39; =&gt; &#39;Insertando&#39;], 201);</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="x">    }</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="x">    public function show($id)</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="x">    {</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="x">        return response()-&gt;json([&#39;mensaje&#39; =&gt; &#39;Ficha de &#39; . $id]);</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="x">    }</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="x">    public function update(Request $request, $id)</span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="x">    {</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="x">        return response()-&gt;json([&#39;mensaje&#39; =&gt; &#39;Actualizando elemento&#39;]);</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="x">    }</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="x">    public function destroy($id)</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="x">    {</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="x">        return response()-&gt;json([&#39;mensaje&#39; =&gt; &#39;Borrando elemento&#39;]);</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="x">    }</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Y añadimos las rutas correspondientes en el archivo <code>routes/api.php</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="x">Route::apiResource(&#39;prueba&#39;, PruebaController::class);</span>
</code></pre></div></td></tr></table></div>
<p>A partir de este punto, vamos a proteger el acceso a alguno de estos métodos. Escoge uno de los siguientes apartados (3 o 4) para definir el mecanismo de autenticación basado en tokens correspondiente. También puedes intentar hacerlos todos; en este caso, copia y pega otra vez el proyecto Laravel, para trabajar por separado en cada carpeta con un mecanismo diferente.</p>
<h2 id="autenticacion-basada-en-tokens-nativa">Autenticación basada en tokens nativa</h2>
<p>Vamos a emplear en esta sección la autenticación nativa por tokens que ofrece Laravel. Los pasos a seguir los indicamos a continuación.</p>
<h3 id="configuracion-basica">Configuración básica</h3>
<p>En primer lugar, modificamos la migración de la tabla de usuarios para añadir un nuevo campo donde almacenar el token. Dicho campo basta con que tenga 60 caracteres de longitud, y será necesario también que sea único para cada usuario:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="x">public function up()</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="x">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="x">    Schema::create(&#39;usuarios&#39;, function (Blueprint $table) {</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="x">        $table-&gt;id();</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="x">        $table-&gt;string(&#39;login&#39;)-&gt;unique;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="x">        $table-&gt;string(&#39;password&#39;);</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="x">        $table-&gt;string(&#39;api_token&#39;, 60)-&gt;unique()-&gt;nullable();</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="x">        $table-&gt;timestamps();</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="x">    });</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Podemos lanzar ya la migración para que se cree la tabla y se rellene con los usuarios que hayamos indicado en el <em>seeder</em>.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="x">php artisan migrate:fresh --seed</span>
</code></pre></div></td></tr></table></div>
<p>También debemos modificar el archivo <code>config/auth.php</code> para indicar cuál es el modelo de usuarios que vamos a utilizar:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="x">&#39;providers&#39; =&gt; [</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="x">    &#39;users&#39; =&gt; [</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="x">        &#39;driver&#39; =&gt; &#39;eloquent&#39;,</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="x">        &#39;model&#39; =&gt; App\Models\Usuario::class,</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="x">    ],</span>
</code></pre></div></td></tr></table></div>
<p>En este mismo fichero, también podemos modificar el <em>guard</em> por defecto, que es <em>web</em>, para que sea <em>api</em>, si nuestra aplicación no va a tener autenticación web:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="x">&#39;defaults&#39; =&gt; [</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="x">    &#39;guard&#39; =&gt; &#39;api&#39;,</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="x">    ...</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="x">],</span>
</code></pre></div></td></tr></table></div>
<p>En la sección de <code>guards</code>, añadimos el nuevo <em>guard</em> <code>api</code>, si no está ya definido:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span>
<span class="normal"><a href="#__codelineno-14-8">8</a></span>
<span class="normal"><a href="#__codelineno-14-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="x">&#39;guards&#39; =&gt; [</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="x">    &#39;web&#39; =&gt; [</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="x">        ... </span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="x">    ],</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="x">    &#39;api&#39; =&gt; [</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="x">        &#39;driver&#39; =&gt; &#39;token&#39;,</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="x">        &#39;provider&#39; =&gt; &#39;users&#39;</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="x">    ]</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="x">]</span>
</code></pre></div></td></tr></table></div>
<h3 id="proteccion-de-rutas">Protección de rutas</h3>
<p>Para proteger las rutas de acceso restringido, primero crearemos un controlador que se encargue de validar las credenciales del usuario:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="x">php artisan make:controller Api/LoginController</span>
</code></pre></div></td></tr></table></div>
<p>Definimos un método <code>login</code>, por ejemplo, que validará las credenciales que le lleguen (login y password). Si son correctas, generará una cadena de texto aleatoria de 60 caracteres y la almacenará en el campo <code>api_token</code> del usuario validado. También devolverá dicho token como respuesta en formato JSON. En caso de que haya un error en la autenticación, enviará de vuelta un mensaje de error, con el código 401 de acceso no autorizado.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="x">use App\Http\Controllers\Controller;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="x">use Illuminate\Http\Request;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="x">use Illuminate\Support\Str;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="x">use Illuminate\Support\Facades\Hash;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="x">use App\Models\Usuario;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="x">class LoginController extends Controller</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a><span class="x">{</span>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="x">    public function login(Request $request)</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="x">    {</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="x">        $usuario = Usuario::where(&#39;login&#39;, $request-&gt;login)-&gt;first();</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="x">        if (!$usuario || </span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a><span class="x">            !Hash::check($request-&gt;password, $usuario-&gt;password))</span>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="x">        {</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a><span class="x">            return response()-&gt;json(</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a><span class="x">                [&#39;error&#39; =&gt; &#39;Credenciales no válidas&#39;], 401);</span>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a><span class="x">        }</span>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="x">        else</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a><span class="x">        {</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a><span class="x">            $usuario-&gt;api_token = Str::random(60);</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a><span class="x">            $usuario-&gt;save();</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a><span class="x">            return response()-&gt;json([&#39;token&#39; =&gt; $usuario-&gt;api_token]);</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a><span class="x">        }</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a><span class="x">    }</span>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Definimos en el archivo <code>routes/api.php</code> una ruta que redirija a este método, para cuando el usuario quiera autenticarse (recuerda añadir con <code>use</code> la correspondiente clase):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="x">Route::post(&#39;login&#39;, [LoginController::class, &#39;login&#39;]);</span>
</code></pre></div></td></tr></table></div>
<p>También podemos eliminar en este caso la ruta predefinida de este archivo:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="x">// Eliminar esta ruta:</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="x">Route::middleware(&#39;auth:sanctum&#39;)-&gt;get(&#39;/user&#39;, function (Request $request) {</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="x">    return $request-&gt;user();</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="x">});</span>
</code></pre></div></td></tr></table></div>
<p>Para proteger las rutas que necesitemos en los controladores API, las especificamos en el constructor del controlador. Por ejemplo, así protegeríamos todas las rutas de nuestro controlador <code>PruebaController</code>, salvo <code>index</code> y <code>show</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1">1</a></span>
<span class="normal"><a href="#__codelineno-19-2">2</a></span>
<span class="normal"><a href="#__codelineno-19-3">3</a></span>
<span class="normal"><a href="#__codelineno-19-4">4</a></span>
<span class="normal"><a href="#__codelineno-19-5">5</a></span>
<span class="normal"><a href="#__codelineno-19-6">6</a></span>
<span class="normal"><a href="#__codelineno-19-7">7</a></span>
<span class="normal"><a href="#__codelineno-19-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="x">class PruebaController extends Controller</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="x">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="x">    public function __construct()</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="x">    {</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="x">        $this-&gt;middleware(&#39;auth:api&#39;,</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="x">            [&#39;except&#39; =&gt; [&#39;index&#39;, &#39;show&#39;]]);</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="x">    }</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="x">    ...</span>
</code></pre></div></td></tr></table></div>
<p>Alternativamente, también podemos emplear el modificador <code>only</code> en lugar de <code>except</code> para indicar las rutas concretas que queremos proteger.</p>
<p>Con esto ya tenemos el mecanismo de autenticación por token establecido, y las rutas protegidas. Echa un vistazo al <a href="https://nachoiborraies.github.io/laravel/md/es/07b#5-prueba-de-autenticación-basada-en-tokens">apartado 5</a> para ver cómo probarlo todo desde <em>Thunder Client</em> o Postman.</p>
<h2 id="autenticacion-basada-en-tokens-usando-laravel-sanctum">Autenticación basada en tokens usando Laravel Sanctum</h2>
<p>Como hemos comentado anteriormente, Laravel Sanctum es una librería que proporciona mecanismos de autenticación para SPAs (<em>Single Page Applications</em>, aplicaciones de página única), y APIs. En nuestro caso, la emplearemos para autenticarnos mediante tokens en nuestras APIs. Los pasos a seguir para la configuración son los siguientes…</p>
<h3 id="configuracion-de-sanctum">Configuración de Sanctum</h3>
<p>En primer lugar, debemos incorporar Laravel Sanctum a nuestro proyecto. <strong>En las últimas versiones de Laravel aparece incorporado por defecto</strong> (lo podemos comprobar en el archivo <code>composer.json</code>, en la sección de <em>require</em>). Si no es así, podemos instalarlo escribiendo este comando desde la raíz del proyecto:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="x">composer require laravel/sanctum</span>
</code></pre></div></td></tr></table></div>
<p>Si nos diera algún problema de incompatibilidad con la versión de proyecto que tengamos, podemos probar a ejecutar <code>composer require laravel/sanctum:*</code> para solucionarlo, e instalar la última versión compatible.</p>
<p>Después, debemos publicar la configuración de Sanctum y su fichero de migración, que generará una tabla adicional donde almacenar los tokens. Escribimos el siguiente comando (todo en una línea, aunque aquí se divide en dos para poderlo ver completo):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="x">php artisan vendor:publish </span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="x">--provider=&quot;Laravel\Sanctum\SanctumServiceProvider&quot;</span>
</code></pre></div></td></tr></table></div>
<p>Al finalizar este paso, tendremos la migración creada y un archivo de configuración <code>config/sanctum.php</code> disponible, para editar la configuración por defecto de la librería. Por ejemplo, podemos editarlo para especificar el tiempo de vida (TTL) de los tokens. El siguiente ejemplo establece un tiempo de vida de 5 minutos, por ejemplo, aunque en el caso de aplicaciones basadas en tokens es habitual dejar tiempos mucho mayores (o indefinidos, según el caso, dejando esta propiedad a <code>null</code>):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-22-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="x">&#39;expiration&#39; =&gt; 5,</span>
</code></pre></div></td></tr></table></div>
<p>Después, debemos lanzar la migración que se ha creado, junto con las que tengamos pendientes (la de la tabla de usuarios, por ejemplo). Se añadirá una tabla llamada <em>personal_access_tokens</em> a nuestra base de datos.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="x">php artisan migrate:fresh --seed</span>
</code></pre></div></td></tr></table></div>
<p>Finalmente, debemos verificar que el modelo de usuarios (<code>App\Models\Usuario</code>) incluya el <em>trait</em> <code>HasApiTokens</code>. De este modo se vincula el modelo de usuario con los tokens que se vayan a generar para los mismos.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1">1</a></span>
<span class="normal"><a href="#__codelineno-24-2">2</a></span>
<span class="normal"><a href="#__codelineno-24-3">3</a></span>
<span class="normal"><a href="#__codelineno-24-4">4</a></span>
<span class="normal"><a href="#__codelineno-24-5">5</a></span>
<span class="normal"><a href="#__codelineno-24-6">6</a></span>
<span class="normal"><a href="#__codelineno-24-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="x">...</span>
<a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="x">use Laravel\Sanctum\HasApiTokens;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="x">class Usuario extends Authenticatable</span>
<a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="x">{</span>
<a id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="x">    use HasApiTokens, HasFactory, Notifiable;</span>
<a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="x">    ...</span>
</code></pre></div></td></tr></table></div>
<h3 id="proteccion-de-rutas_1">Protección de rutas</h3>
<p>Para proteger las rutas de acceso restringido, primero crearemos un controlador que se encargue de validar las credenciales del usuario:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-25-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="x">php artisan make:controller Api/LoginController</span>
</code></pre></div></td></tr></table></div>
<p>Definimos un método <code>login</code>, por ejemplo, que validará las credenciales que le lleguen (login y password). Si son correctas, llamará al método <code>createToken</code> de Sanctum (incorporado al usuario a través del <em>trait</em> <code>HasApiTokens</code>), asociándolo al login del usuario entrante, y le devolverá el token en formato texto plano, como un objeto JSON. En caso de que haya un error en la autenticación, enviará de vuelta un mensaje de error, con el código 401 de acceso no autorizado.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-26-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-26-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-26-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-26-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-26-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-26-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-26-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-26-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-26-10">10</a></span>
<span class="normal"><a href="#__codelineno-26-11">11</a></span>
<span class="normal"><a href="#__codelineno-26-12">12</a></span>
<span class="normal"><a href="#__codelineno-26-13">13</a></span>
<span class="normal"><a href="#__codelineno-26-14">14</a></span>
<span class="normal"><a href="#__codelineno-26-15">15</a></span>
<span class="normal"><a href="#__codelineno-26-16">16</a></span>
<span class="normal"><a href="#__codelineno-26-17">17</a></span>
<span class="normal"><a href="#__codelineno-26-18">18</a></span>
<span class="normal"><a href="#__codelineno-26-19">19</a></span>
<span class="normal"><a href="#__codelineno-26-20">20</a></span>
<span class="normal"><a href="#__codelineno-26-21">21</a></span>
<span class="normal"><a href="#__codelineno-26-22">22</a></span>
<span class="normal"><a href="#__codelineno-26-23">23</a></span>
<span class="normal"><a href="#__codelineno-26-24">24</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="x">use App\Http\Controllers\Controller;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="x">use Illuminate\Http\Request;</span>
<a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="x">use Illuminate\Support\Facades\Hash;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="x">use App\Models\Usuario;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5"></a>
<a id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="x">class LoginController extends Controller</span>
<a id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="x">{</span>
<a id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="x">    public function login(Request $request)</span>
<a id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="x">    {</span>
<a id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="x">        $usuario = Usuario::where(&#39;login&#39;, $request-&gt;login)-&gt;first();</span>
<a id="__codelineno-26-11" name="__codelineno-26-11"></a>
<a id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="x">        if (!$usuario || </span>
<a id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="x">            !Hash::check($request-&gt;password, $usuario-&gt;password))</span>
<a id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="x">        {</span>
<a id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="x">            return response()-&gt;json(</span>
<a id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="x">                [&#39;error&#39; =&gt; &#39;Credenciales no válidas&#39;], 401);</span>
<a id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="x">        }</span>
<a id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="x">        else</span>
<a id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="x">        {</span>
<a id="__codelineno-26-20" name="__codelineno-26-20"></a><span class="x">            return response()-&gt;json([&#39;token&#39; =&gt;</span>
<a id="__codelineno-26-21" name="__codelineno-26-21"></a><span class="x">                $usuario-&gt;createToken($usuario-&gt;login)-&gt;plainTextToken]);</span>
<a id="__codelineno-26-22" name="__codelineno-26-22"></a><span class="x">        }</span>
<a id="__codelineno-26-23" name="__codelineno-26-23"></a><span class="x">    }</span>
<a id="__codelineno-26-24" name="__codelineno-26-24"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Definimos en el archivo <code>routes/api.php</code> una ruta que redirija a este método, para cuando el usuario quiera autenticarse (recuerda añadir con <code>use</code> la correspondiente clase):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="x">Route::post(&#39;login&#39;, [LoginController::class, &#39;login&#39;]);</span>
</code></pre></div></td></tr></table></div>
<p>También podemos eliminar en este caso la ruta predefinida de este archivo:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-28-1">1</a></span>
<span class="normal"><a href="#__codelineno-28-2">2</a></span>
<span class="normal"><a href="#__codelineno-28-3">3</a></span>
<span class="normal"><a href="#__codelineno-28-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="x">// Eliminar esta ruta:</span>
<a id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="x">Route::middleware(&#39;auth:sanctum&#39;)-&gt;get(&#39;/user&#39;, function (Request $request) {</span>
<a id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="x">    return $request-&gt;user();</span>
<a id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="x">});</span>
</code></pre></div></td></tr></table></div>
<p>Para proteger las rutas que necesitemos en los controladores API, las especificamos en el constructor del controlador. Por ejemplo, así protegeríamos todas las rutas de nuestro controlador <code>PruebaController</code>, salvo <code>index</code> y <code>show</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1">1</a></span>
<span class="normal"><a href="#__codelineno-29-2">2</a></span>
<span class="normal"><a href="#__codelineno-29-3">3</a></span>
<span class="normal"><a href="#__codelineno-29-4">4</a></span>
<span class="normal"><a href="#__codelineno-29-5">5</a></span>
<span class="normal"><a href="#__codelineno-29-6">6</a></span>
<span class="normal"><a href="#__codelineno-29-7">7</a></span>
<span class="normal"><a href="#__codelineno-29-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="x">class PruebaController extends Controller</span>
<a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="x">{</span>
<a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="x">    public function __construct()</span>
<a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="x">    {</span>
<a id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="x">        $this-&gt;middleware(&#39;auth:sanctum&#39;,</span>
<a id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="x">            [&#39;except&#39; =&gt; [&#39;index&#39;, &#39;show&#39;]]);</span>
<a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="x">    }</span>
<a id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="x">    ...</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title"> </p>
<p>Oserva cómo se invoca al middleware <code>auth:sanctum</code>, que es un mecanismo de autenticación por defecto incorporado en Laravel. Esto hace que no tengamos que tocar la configuración de <code>config/auth.php</code> para nada en este caso. Al usar <em>Sanctum</em> ya se sabe en qué tabla están los <em>tokens</em> almacenados, y vinculados a qué <em>login</em>.</p>
</div>
<p>Alternativamente, también podemos emplear el modificador <code>only</code> en lugar de <code>except</code> para indicar las rutas concretas que queremos proteger.</p>
<p>En el caso de Sanctum, cada vez que validemos un usuario a través de la ruta de <em>login</em>, se guardará su <em>token</em> (encriptado) en la tabla <em>personal_access_tokens</em> de nuestra base de datos MySQL. Podemos comprobarlo con <em>phpMyAdmin</em>.</p>
<p>Echa ahora un vistazo al <a href="https://nachoiborraies.github.io/laravel/md/es/07b#5-prueba-de-autenticación-basada-en-tokens">apartado 5</a> para ver cómo probarlo todo desde <em>Thunder Client</em> o Postman.</p>
<h2 id="prueba-de-autenticacion-basada-en-tokens">Prueba de autenticación basada en tokens</h2>
<p>Veamos ahora cómo probar la autenticación basada en tokens desde una herramienta como <em>ThunderClient</em>, para lo que veremos cómo obtener y enviar el token de acceso desde esta herramienta. Lo primero que deberemos hacer es una petición POST para loguearnos. Recibiremos como respuesta el <em>token</em> que se haya generado:</p>
<div style="text-align: center;"><img src="../../img/ud12/peticion_token01.png" alt="peticion token" style="max-width: 100%;" /></div>

<div class="admonition note">
<p class="admonition-title"> </p>
<p>En el ejemplo que hemos estado haciendo, los campos a enviar serían <em>login</em> y <em>password</em>. Echa un vistazo a <em>phpMyAdmin</em> para ver qué <em>logins</em> se han generado, y el password, siguiendo el ejemplo, debería ser 1234.</p>
</div>
<p>Ahora, sólo nos queda adjuntar este token en la cabecera <em>Authorization</em> de las peticiones que lo necesiten. Para ello, vamos a la sección <em>Authorization</em> bajo la URL de la petición, y elegimos que queremos enviar un <em>Bearer token</em>. En el cuadro inferior nos dejará copiar dicho token:</p>
<div style="text-align: center;"><img src="../../img/ud12/peticion_token02.png" alt="peticion token" style="max-width: 100%;" /></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../ud1202/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 12.2 Autenticación basada en sesiones">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                12.2 Autenticación basada en sesiones
              </div>
            </div>
          </a>
        
        
          
          <a href="../ud12ac/" class="md-footer__link md-footer__link--next" aria-label="Next: Activitats">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Activitats
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
<!--     Made with -->IES
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      <!--Material for MkDocs-->
      Mestre Ramon Esteve
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer", "navigation.top"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>