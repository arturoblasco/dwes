
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>ud08 Laravel 6 ServiciosREST - Desarrollo Web en Entorno Servidor (DWES)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#conceptos-de-servicios-rest" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Desarrollo Web en Entorno Servidor (DWES)" class="md-header__button md-logo" aria-label="Desarrollo Web en Entorno Servidor (DWES)" data-md-component="logo">
      
  <img src="../../logo3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Desarrollo Web en Entorno Servidor (DWES)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ud08 Laravel 6 ServiciosREST
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Canvia a mode oscur"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Canvia a mode oscur" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Canvia a mode normal"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Canvia a mode normal" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Desarrollo Web en Entorno Servidor (DWES)" class="md-nav__button md-logo" aria-label="Desarrollo Web en Entorno Servidor (DWES)" data-md-component="logo">
      
  <img src="../../logo3.png" alt="logo">

    </a>
    Desarrollo Web en Entorno Servidor (DWES)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Inicio
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 1 Arquitectura Web
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            UD 1 Arquitectura Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.1 Introducci√≥n
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0102/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.2 Cliente/servidor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0103/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.3 Arquitectura de 3 capas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0104/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.4 MVC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0105/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.5 Decisiones de dise√±o
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0106/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.6 Herramientas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0107/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.7 Puesta en marcha
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0108/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1.8 Manual Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud01de/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Descargas
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud01ac/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud01/ud0109/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referencias
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    UD 2 Lenguaje PHP
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            UD 2 Lenguaje PHP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud0201.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud02ac.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Actividades
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ud02/ud0201.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Referencias
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 3 PHP Orientado a Objetos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 4 Programaci√≥n Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 5 Herramientas Web
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 6 Acceso a Base de Datos
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 7 Framework Laravel
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    UD 8 Laravel avanzado
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#conceptos-basicos-del-protocolo-http" class="md-nav__link">
    <span class="md-ellipsis">
      Conceptos b√°sicos del protocolo HTTP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#los-servicios-rest" class="md-nav__link">
    <span class="md-ellipsis">
      Los servicios REST
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#el-formato-json" class="md-nav__link">
    <span class="md-ellipsis">
      El formato JSON
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<hr />
<p>unit: unidad did√°ctica 8
   title: Laravel - servicios REST
   language: ES
   author: Arturo Blasco
   subject: Desarrollo Web en Entorno Servidor
   keywords: [DWES, 2023, PHP, Laravel]
   IES: IES Mestre Ram√≥n Esteve (Catadau) [iesmre.es]
   header: ${unit}: ${title} - ${subject} (versi√≥n: ${today})
   footer: ${currentFileName}.pdf - ${author} - ${IES} - ${pageNo}|${pageCount}
   typora-root-url:${filename}/../
   typora-copy-images-to:${filename}/../assets</p>
<hr />
<div class="toc">
<ul>
<li><a href="#conceptos-de-servicios-rest">conceptos de servicios REST</a><ul>
<li><a href="#conceptos-basicos-del-protocolo-http">Conceptos b√°sicos del protocolo HTTP</a></li>
<li><a href="#los-servicios-rest">Los servicios REST</a></li>
<li><a href="#el-formato-json">El formato JSON</a></li>
</ul>
</li>
<li><a href="#creacion-de-servicios-rest">creaci√≥n de servicios REST</a><ul>
<li><a href="#1-definiendo-los-controladores-de-api">1. Definiendo los controladores de API</a></li>
<li><a href="#2-estableciendo-las-rutas">2. Estableciendo las rutas</a></li>
<li><a href="#3-servicios-get">3. Servicios GET</a><ul>
<li><a href="#31-mas-sobre-el-formato-json-y-la-respuesta">3.1. M√°s sobre el formato JSON y la respuesta</a></li>
</ul>
</li>
<li><a href="#4-resto-de-servicios">4. Resto de servicios</a><ul>
<li><a href="#41-validacion-de-datos">4.1. Validaci√≥n de datos</a></li>
<li><a href="#42-respuestas-de-error">4.2. Respuestas de error</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#bibliografia">bibliografia</a></li>
</ul>
</div>
<blockquote>
<p>El uso de estos materiales est√° sujeto a una licencia Creative Commons <a href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC</a>.</p>
<p>Material extra√≠do de https://nachoiborraies.github.io/laravel/</p>
</blockquote>
<h1 id="conceptos-de-servicios-rest">conceptos de servicios REST</h1>
<p><img src="/assets/ud07_apirestful_000.png" alt="phpMyAdmin" style="zoom:70%; float:right;" />En esta unidad del curso veremos c√≥mo emplear Laravel como proveedor de servicios REST. Comenzaremos detallando algunas cuestiones b√°sicas de la arquitectura cliente-servidor y de los servicios REST, para luego pasar a ver c√≥mo desarrollarlos y probarlos con Laravel.</p>
<p>A estas alturas todos deber√≠amos tener claro que cualquier aplicaci√≥n web se basa en una arquitectura cliente-servidor, donde un servidor queda a la espera de conexiones de clientes, y los clientes se conectan a los servidores para solicitar ciertos recursos. Sobre esta base, veremos unas breves pinceladas de c√≥mo funciona el protocolo HTTP, y en qu√© consisten los servicios REST.</p>
<h2 id="conceptos-basicos-del-protocolo-http">Conceptos b√°sicos del protocolo HTTP</h2>
<p>Las comunicaciones web entre cliente y servidor se realizan mediante el protocolo <strong>HTTP</strong> (o HTTPS, en el caso de comunicaciones seguras). En ambos casos, cliente y servidor se env√≠an cierta informaci√≥n est√°ndar, en cada mensaje</p>
<p>En cuanto a los <strong>clientes</strong>, env√≠an al servidor los datos del recurso que solicitan, junto con cierta informaci√≥n adicional, como por ejemplo las cabeceras de petici√≥n (informaci√≥n relativa al tipo de cliente o navegador, contenido que acepta, etc), y par√°metros adicionales llamados normalmente <em>datos del formulario</em>, puesto que suelen contener la informaci√≥n de alg√∫n formulario que se env√≠a de cliente a servidor.</p>
<p>Por lo que respecta a los <strong>servidores</strong>, aceptan estas peticiones, las procesan y env√≠an de vuelta algunos datos relevantes, como un c√≥digo de estado (indicando si la petici√≥n pudo ser atendida satisfactoriamente o no), cabeceras de respuesta (indicando el tipo de contenido enviado, tama√±o, idioma, etc), y el recurso solicitado propiamente dicho, si todo ha ido correctamente.</p>
<p>Este es el mecanismo que hemos estado utilizando hasta ahora a trav√©s de los controladores: reciben la petici√≥n concreta del cliente, y env√≠an una respuesta, que por el momento se ha centrado en renderizar un contenido HTML de una vista.</p>
<p>En cuanto a los <strong>c√≥digos de estado</strong> de la respuesta, depende del resultado de la operaci√≥n que se haya realizado, √©stos se catalogan en cinco grupos:</p>
<ul>
<li><em>C√≥digos </em><em>1XX</em>**: representan informaci√≥n sobre una petici√≥n normalmente incompleta. No son muy habituales, pero se pueden emplear cuando la petici√≥n es muy larga, y se env√≠a antes una cabecera para comprobar si se puede procesar dicha petici√≥n.</li>
<li><em>C√≥digos </em><em>2xx</em><em><em>: representan peticiones que se han podido atender satisfactoriamente. El c√≥digo m√°s habitual es el </em>200</em>, respuesta est√°ndar para las peticiones que son correctas. Existen otras variantes, como el c√≥digo <em>201</em>, que se env√≠a cuando se ha insertado o creado un nuevo recurso en el servidor (una inserci√≥n en una base de datos, por ejemplo), o el c√≥digo <em>204</em>, que indica que la petici√≥n se ha atendido bien, pero no se ha devuelto nada como respuesta.</li>
<li><em>C√≥digos </em><em>3xx</em><em><em>: son c√≥digos de redirecci√≥n, que indican que de alg√∫n modo la petici√≥n original se ha redirigido a otro recurso del servidor. Por ejemplo, el c√≥digo </em>301</em> indica que el recurso solicitado se ha movido permanentemente a otra URL. El c√≥digo <em>304</em> indica que el recurso solicitado no ha cambiado desde la √∫ltima vez que se solicit√≥, por si se quiere recuperar de la cach√© local en ese caso.</li>
<li><em>C√≥digos </em><em>4xx</em><em><em>: indican un error por parte del cliente. El m√°s t√≠pico es el error </em>404</em>, que indica que estamos solicitando una URL o recurso que no existe. Pero tambi√©n hay otros habituales, como el <em>401</em> (cliente no autorizado), o <em>400</em> (los datos de la petici√≥n no son correctos, por ejemplo, porque los campos del formulario no sean v√°lidos).</li>
<li><em>C√≥digos </em><em>5xx</em><em><em>: indican un error por parte del servidor. Por ejemplo, el error </em>500</em> indica un error interno del servidor, o el <em>504</em>, que es un error de <em>timeout</em> por tiempo excesivo en emitir la respuesta.</li>
</ul>
<p>Haremos uso de estos c√≥digos de estado en nuestros servicios REST para informar al cliente del tipo de error que se haya producido, o del estado en que se ha podido atender su petici√≥n.</p>
<h2 id="los-servicios-rest">Los servicios REST</h2>
<p>REST son las siglas de <strong><em>RE</em>*presentational </strong>S<strong>tate </strong>T*<em>ransfer</em>, y designa un estilo de arquitectura de aplicaciones distribuidas basado en HTTP. En un sistema REST, identificamos cada recurso a solicitar con una URI (identificador uniforme de recurso), y definimos un conjunto delimitado de comandos o m√©todos a realizar, que t√≠picamente son:</p>
<ul>
<li><strong>GET</strong>: para obtener resultados de alg√∫n tipo (listados completos o filtrados por alguna condici√≥n).</li>
<li><strong>POST</strong>: para realizar inserciones o a√±adir elementos en un conjunto de datos.</li>
<li><strong>PUT</strong>: para realizar modificaciones o actualizaciones del conjunto de datos.</li>
<li><strong>DELETE</strong>: para realizar borrados del conjunto de datos.</li>
<li>Existen otros tipos de comandos o m√©todos, como por ejemplo <strong>PATCH</strong> (similar a PUT, pero para cambios parciales), <strong>HEAD</strong> (para consultar s√≥lo el encabezado de la respuesta obtenida), etc. </li>
</ul>
<p>Nos centraremos de momento en los cuatro m√©todos principales anteriores.</p>
<p>Por lo tanto, identificando el recurso a solicitar y el comando a aplicarle, el servidor que ofrece esta API REST proporciona una respuesta a esa petici√≥n. Esta respuesta t√≠picamente viene dada por un mensaje en formato <strong>JSON</strong> o XML (aunque √©ste √∫ltimo cada vez est√° m√°s en desuso). Esto permite que las aplicaciones puedan extenderse a distintas plataformas, y acceder a los mismos servicios desde una aplicaci√≥n Angular, o una aplicaci√≥n de escritorio .NET, o una aplicaci√≥n m√≥vil en Android, por poner varios ejemplos.</p>
<blockquote>
<p><strong>ACLARACI√ìN</strong>: para quienes no conozc√°is la definici√≥n de API (<em>Application Programming Interface</em>), b√°sicamente es el conjunto de m√©todos o funcionalidades que se ponen a disposici√≥n de quienes los quieran utilizar. En este caso, el concepto de API REST hace referencia al conjunto de servicios REST proporcionados por el servidor para los clientes que quieran utilizarlos.</p>
<p>Una de las caracter√≠sticas fundamentales de las API es que son <strong><em>Stateless</em></strong>, lo que quiere decir que las peticiones se hacen y desaparecen, no hay usuarios logueados ni datos que se quedan almacenados.</p>
<p>Ejemplos de APIs gratuitas:</p>
<ul>
<li><a href="https://api.chucknorris.io/#!">ChuckNorris IO</a></li>
<li><a href="https://www.omdbapi.com/">OMDB</a></li>
<li><a href="https://pokeapi.co/">PokeAPI - Pokemon</a></li>
<li><a href="https://rawg.io/">RAWg - Videojuegos</a></li>
<li><a href="https://swapi.dev/">The Star Wars API</a></li>
</ul>
<p>Para hacer pruebas con estas APIs podemos implementar el c√≥digo para consumirlas o utilizar un cliente especial para el consumo de estos servicios.</p>
<ul>
<li><a href="https://www.postman.com/">PostMan</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=rangav.vscode-thunder-client">Thunder Client</a> (<em>utilizaremos esta extensi√≥n de VS Code para nuestras comprobaciones</em>).</li>
<li><a href="https://insomnia.rest/download">Insomnia</a></li>
<li><a href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo?hl=es">Advance REST Client (desde el navegador)</a>
</li>
</ul>
</blockquote>
<h2 id="el-formato-json">El formato JSON</h2>
<p>JSON son las siglas de <em>JavaScript Object Notation</em>, una sintaxis propia de Javascript para poder representar objetos como cadenas de texto, y poder as√≠ serializar y enviar informaci√≥n de objetos a trav√©s de flujos de datos (archivos de texto, comunicaciones cliente-servidor, etc).</p>
<p>Un objeto Javascript se define mediante una serie de propiedades y valores. Por ejemplo, los datos de una persona (como nombre y edad) podr√≠amos almacenarlos as√≠:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="x">let persona = {</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="x">    nombre: &quot;Nacho&quot;,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="x">    edad: 39</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="x">};</span>
</code></pre></div></td></tr></table></div>
<p>Este mismo objeto, convertido a JSON, formar√≠a una cadena de texto con este contenido:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="x">{&quot;nombre&quot;:&quot;Nacho&quot;,&quot;edad&quot;:39}</span>
</code></pre></div></td></tr></table></div>
<p>Del mismo modo, si tenemos una colecci√≥n (vector) de objetos como √©sta:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="x">let personas = [</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="x">    { nombre: &quot;Nacho&quot;, edad: 39},</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="x">    { nombre: &quot;Mario&quot;, edad: 4},</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="x">    { nombre: &quot;Laura&quot;, edad: 2},</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="x">    { nombre: &quot;Nora&quot;, edad: 10}</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="x">];</span>
</code></pre></div></td></tr></table></div>
<p>Transformada a JSON sigue la misma sintaxis, pero entre corchetes:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="x">[{&quot;nombre&quot;:&quot;Nacho&quot;,&quot;edad&quot;:39}, {&quot;nombre&quot;:&quot;Mario&quot;,&quot;edad&quot;:4},  </span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="x"> {&quot;nombre&quot;:&quot;Laura&quot;,&quot;edad&quot;:2}, {&quot;nombre&quot;:&quot;Nora&quot;,&quot;edad&quot;:10}]</span>
</code></pre></div></td></tr></table></div>
<p>Cuando solicitamos un servicio REST, t√≠picamente la respuesta (los datos que nos env√≠a el servicio) vienen en este formato JSON, de modo que es f√°cilmente serializable y se puede enviar entre cualquier tipo de cliente (m√≥vil, web, escritorio) y el servidor.</p>
<h1 id="creacion-de-servicios-rest">creaci√≥n de servicios REST</h1>
<p>Veamos ahora qu√© pasos dar para construir una API REST en Laravel que d√© soporte a las operaciones b√°sicas sobre una o varias entidades: consultas (GET), inserciones (POST), modificaciones (PUT) y borrados (DELETE). Emplearemos para ello los denominados controladores de API, que comentamos brevemente en unidades anteriores, al hablar de controladores, y que proporcionan un conjunto de funciones ya definidas para dar soporte a cada uno de estos comandos.</p>
<h2 id="1-definiendo-los-controladores-de-api">1. Definiendo los controladores de API</h2>
<p>Para proporcionar una API REST a los clientes que lo requieran, necesitamos definir un controlador (o controladores) orientados a ofrecer estos servicios REST. Estos controladores en Laravel se denominan de tipo <em>api</em>, como vimos en sesiones previas. Normalmente se definir√° un controlador API por cada uno de los modelos a los que necesitemos acceder. Vamos a crear uno de prueba para ofrecer una API REST sobre los libros de nuestra aplicaci√≥n de biblioteca.</p>
<p>Existen diferentes formas de ejecutar el comando de creaci√≥n del controlador de API. Aqu√≠ vamos a mostrar quiz√° una de las m√°s √∫tiles:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="x">php artisan make:controller Api/LibroController --api --model=Libro</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="x">// √≥, si no funciona:</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="x">// sudo docker-compose exec myapp php artisan make:controller Api/LibroController --api --model=Libro</span>
</code></pre></div></td></tr></table></div>
<p>‚Äã   </p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span>
<span class="normal"><a href="#__codelineno-5-31">31</a></span>
<span class="normal"><a href="#__codelineno-5-32">32</a></span>
<span class="normal"><a href="#__codelineno-5-33">33</a></span>
<span class="normal"><a href="#__codelineno-5-34">34</a></span>
<span class="normal"><a href="#__codelineno-5-35">35</a></span>
<span class="normal"><a href="#__codelineno-5-36">36</a></span>
<span class="normal"><a href="#__codelineno-5-37">37</a></span>
<span class="normal"><a href="#__codelineno-5-38">38</a></span>
<span class="normal"><a href="#__codelineno-5-39">39</a></span>
<span class="normal"><a href="#__codelineno-5-40">40</a></span>
<span class="normal"><a href="#__codelineno-5-41">41</a></span>
<span class="normal"><a href="#__codelineno-5-42">42</a></span>
<span class="normal"><a href="#__codelineno-5-43">43</a></span>
<span class="normal"><a href="#__codelineno-5-44">44</a></span>
<span class="normal"><a href="#__codelineno-5-45">45</a></span>
<span class="normal"><a href="#__codelineno-5-46">46</a></span>
<span class="normal"><a href="#__codelineno-5-47">47</a></span>
<span class="normal"><a href="#__codelineno-5-48">48</a></span>
<span class="normal"><a href="#__codelineno-5-49">49</a></span>
<span class="normal"><a href="#__codelineno-5-50">50</a></span>
<span class="normal"><a href="#__codelineno-5-51">51</a></span>
<span class="normal"><a href="#__codelineno-5-52">52</a></span>
<span class="normal"><a href="#__codelineno-5-53">53</a></span>
<span class="normal"><a href="#__codelineno-5-54">54</a></span>
<span class="normal"><a href="#__codelineno-5-55">55</a></span>
<span class="normal"><a href="#__codelineno-5-56">56</a></span>
<span class="normal"><a href="#__codelineno-5-57">57</a></span>
<span class="normal"><a href="#__codelineno-5-58">58</a></span>
<span class="normal"><a href="#__codelineno-5-59">59</a></span>
<span class="normal"><a href="#__codelineno-5-60">60</a></span>
<span class="normal"><a href="#__codelineno-5-61">61</a></span>
<span class="normal"><a href="#__codelineno-5-62">62</a></span>
<span class="normal"><a href="#__codelineno-5-63">63</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="x">namespace App\Http\Controllers\Api;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="x">use App\Http\Controllers\Controller;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="x">use App\Models\Libro;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="x">use Illuminate\Http\Request;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="x">class LibroController extends Controller</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="x">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="x">  /**</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="x">   * Display a listing of the resource.</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="x">   *</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="x">   * @return \Illuminate\Http\Response</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="x">   */</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="x">  public function index()</span>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="x">  {</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="x">    //</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="x">  }</span>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="x">  /**</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="x">   * Store a newly created resource in storage.</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="x">   *</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="x">   * @param  \Illuminate\Http\Request  $request</span>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="x">   * @return \Illuminate\Http\Response</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="x">   */</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="x">  public function store(Request $request)</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="x">  {</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="x">    //</span>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="x">  }</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="x">  /**</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="x">   * Display the specified resource.</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="x">   *</span>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="x">   * @param  \App\Models\Libro  $libro</span>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="x">   * @return \Illuminate\Http\Response</span>
<a id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="x">   */</span>
<a id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="x">  public function show(Libro $libro)</span>
<a id="__codelineno-5-37" name="__codelineno-5-37"></a><span class="x">  {</span>
<a id="__codelineno-5-38" name="__codelineno-5-38"></a><span class="x">    //</span>
<a id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="x">  }</span>
<a id="__codelineno-5-40" name="__codelineno-5-40"></a>
<a id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="x">  /**</span>
<a id="__codelineno-5-42" name="__codelineno-5-42"></a><span class="x">   * Update the specified resource in storage.</span>
<a id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="x">   *</span>
<a id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="x">   * @param  \Illuminate\Http\Request  $request</span>
<a id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="x">   * @param  \App\Models\Libro  $libro</span>
<a id="__codelineno-5-46" name="__codelineno-5-46"></a><span class="x">   * @return \Illuminate\Http\Response</span>
<a id="__codelineno-5-47" name="__codelineno-5-47"></a><span class="x">   */</span>
<a id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="x">  public function update(Request $request, Libro $libro)</span>
<a id="__codelineno-5-49" name="__codelineno-5-49"></a><span class="x">  {</span>
<a id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="x">    //</span>
<a id="__codelineno-5-51" name="__codelineno-5-51"></a><span class="x">  }</span>
<a id="__codelineno-5-52" name="__codelineno-5-52"></a>
<a id="__codelineno-5-53" name="__codelineno-5-53"></a><span class="x">  /**</span>
<a id="__codelineno-5-54" name="__codelineno-5-54"></a><span class="x">   * Remove the specified resource from storage.</span>
<a id="__codelineno-5-55" name="__codelineno-5-55"></a><span class="x">   *</span>
<a id="__codelineno-5-56" name="__codelineno-5-56"></a><span class="x">   * @param  \App\Models\Libro  $libro</span>
<a id="__codelineno-5-57" name="__codelineno-5-57"></a><span class="x">   * @return \Illuminate\Http\Response</span>
<a id="__codelineno-5-58" name="__codelineno-5-58"></a><span class="x">   */</span>
<a id="__codelineno-5-59" name="__codelineno-5-59"></a><span class="x">  public function destroy(Libro $libro)</span>
<a id="__codelineno-5-60" name="__codelineno-5-60"></a><span class="x">  {</span>
<a id="__codelineno-5-61" name="__codelineno-5-61"></a><span class="x">    //</span>
<a id="__codelineno-5-62" name="__codelineno-5-62"></a><span class="x">  }</span>
<a id="__codelineno-5-63" name="__codelineno-5-63"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Observemos que se incorpora autom√°ticamente la cl√°usula <code>use</code> para cargar el modelo asociado, que hemos indicado en el par√°metro <code>--model</code>. Adem√°s, los m√©todos <code>show</code>, <code>update</code> y <code>destroy</code> ya vienen con un par√°metro de tipo <code>Libro</code> que facilitar√° mucho algunas tareas.</p>
<blockquote>
<p><strong>NOTA</strong>: en el caso de versiones anteriores a Laravel 8, hay que tener en cuenta que, por defecto, los modelos se ubican en la carpeta <code>App</code>, por lo que deberemos indicar cualquier subcarpeta donde localizar el modelo cuando creemos el controlador, si es que lo hemos movido a una subcarpeta. Por ejemplo, <code>--model=Models/Libro</code>.</p>
</blockquote>
<p>Cada una de las funciones del nuevo controlador creado se asocia a uno de los m√©todos REST comentados anteriormente:</p>
<ul>
<li><code>index</code> se asociar√≠a con una operaci√≥n GET de listado general, para obtener todos los registros (de libros, en este caso)</li>
<li><code>store</code> se asociar√≠a con una operaci√≥n POST, para almacenar los datos que lleguen en la petici√≥n (como un nuevo libro, en nuestro caso)</li>
<li><code>show</code> se asociar√≠a con una operaci√≥n GET para obtener el registro asociado a un identificador concreto</li>
<li><code>update</code> se asociar√≠a con una operaci√≥n PUT, para actualizar los datos del registro asociado a un identificador concreto</li>
<li><code>destroy</code> se asociar√≠a con una operaci√≥n DELETE, para eliminar los datos del registro asociado a un identificador concreto</li>
</ul>
<h2 id="2-estableciendo-las-rutas">2. Estableciendo las rutas</h2>
<p>Una vez tenemos el controlador API creado, vamos a definir las rutas asociadas a cada m√©todo del controlador. Si recordamos de sesiones anteriores, pod√≠amos emplear el m√©todo <code>Route::resource</code> en el archivo <code>routes/web.php</code> para establecer de golpe todas las rutas asociadas a un controlador de recursos. De forma an√°loga, podemos emplear el m√©todo <code>Route::apiResource</code> en el archivo <code>routes/api.php</code> para establecer autom√°ticamente todas las rutas de un controlador de API. A√±adimos esta l√≠nea en dicho archivo <code>routes/api.php</code>:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span>
<span class="normal"><a href="#__codelineno-6-2">2</a></span>
<span class="normal"><a href="#__codelineno-6-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="x">use App\Http\Controllers\Api\LibroController;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="x">// ...</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="x">Route::apiResource(&#39;libros&#39;, LibroController::class);</span>
</code></pre></div></td></tr></table></div>
<p>Las rutas de API (aquellas definidas en el archivo <code>routes/api.php</code>) por defecto tienen un prefijo <code>api</code>, tal y como se establece en el <em>provider</em> <code>RouteServiceProvider</code>. Por tanto, hemos definido una ruta general <code>api/libros</code>, de forma que todas las subrutas que se deriven de ella llevar√°n a uno u otro m√©todo del controlador de API de libros.</p>
<p>Podemos comprobar <strong>qu√© rutas hay activas</strong> con este comando:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span>
<span class="normal"><a href="#__codelineno-7-2">2</a></span>
<span class="normal"><a href="#__codelineno-7-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="x">php artisan route:list</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="x">// √≥, si no funciona:</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="x">// sudo docker-compose exec myapp php artisan route:list</span>
</code></pre></div></td></tr></table></div>
<p>Veremos, entre otras, las 5 rutas derivadas del controlador API de libros:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span>
<span class="normal"><a href="#__codelineno-8-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="x">+----------------------------------------------------+</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="x">|Method     | URI                   | Name           |</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="x">+----------------------------------------------------+</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="x">| GET|HEAD  | api/libros            | libros.index   |</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="x">| POST      | api/libros            | libros.store   |</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="x">| GET|HEAD  | api/libros/{libro}    | libros.show    |</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="x">| PUT|PATCH | api/libros/{libro}    | libros.update  |</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="x">| DELETE    | api/libros/{libro}    | libros.destroy |</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="x">+----------------------------------------------------+</span>
</code></pre></div></td></tr></table></div>
<h2 id="3-servicios-get">3. Servicios GET</h2>
<p>Vamos a empezar por definir el m√©todo <code>index</code>. En este caso, vamos a obtener el conjunto de libros de la base de datos y devolverlo tal cual:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1">1</a></span>
<span class="normal"><a href="#__codelineno-9-2">2</a></span>
<span class="normal"><a href="#__codelineno-9-3">3</a></span>
<span class="normal"><a href="#__codelineno-9-4">4</a></span>
<span class="normal"><a href="#__codelineno-9-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="x">public function index()</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="x">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="x">  $libros = Libro::get();</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="x">  return $libros;</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Si accedemos a la ruta <code>api/libros</code> desde el navegador, se activar√° el m√©todo <code>index</code> que acabamos de implementar, y recibiremos los libros de la base de datos, directamente en formato JSON.</p>
<p><img src="./assets/ud07_6_get_json.png" alt="img" style="zoom: 60%;" /></p>
<blockquote>
<p><strong>NOTA</strong>: podemos instalar la extensi√≥n <a href="https://chrome.google.com/webstore/detail/json-formatter/bcjindcccaagfpapjjmafapmmgkkhgoa?hl=es">JSON formatter</a> para Chrome, y as√≠ poder ver los datos en formato JSON m√°s organizados y con la sintaxis resaltada, como en la imagen anterior.</p>
</blockquote>
<p>De una forma similar, podr√≠amos implementar y probar el m√©todo <code>show</code>, para mostrar los datos de un libro en particular:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="x">public function show(Libro $libro)</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="x">{</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="x">  return $libro;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>En este caso, si accedemos a la URI <code>api/libros/1</code>, obtendremos la informaci√≥n del libro con <em>id</em> = 1. Notar que Laravel se encarga autom√°ticamente de buscar el libro por nosotros (hacer la correspondiente operaci√≥n <code>find</code> para el <em>id</em> proporcionado). Es lo que se conoce como <em>enlace impl√≠cito</em>, y es algo que tambi√©n est√° disponible en los controladores web normales, siempre que los asociemos correctamente con el modelo vinculado. Esto se hace autom√°ticamente si creamos el controlador junto con el modelo, como vimos en la unidad 4, o si usamos el par√°metro <code>--model</code> para asociarlo, como hemos hecho aqu√≠.</p>
<h3 id="31-mas-sobre-el-formato-json-y-la-respuesta">3.1. M√°s sobre el formato JSON y la respuesta</h3>
<p>Tras probar los dos servicios anteriores, habr√°s observado que Laravel se encarga de transformar directamente los registros obtenidos a formato JSON cuando los enviamos mediante <code>return</code>, por lo que, en principio, no tenemos por qu√© preocuparnos de este proceso. Sin embargo, de este modo se escapan algunas cosas a nuestro control. Por ejemplo, y sobre todo, no podemos especificar el c√≥digo de estado de la respuesta, que por defecto es 200 si todo ha ido correctamente. Adem√°s, tampoco podemos controlar qu√© informaci√≥n enviar del objeto en cuesti√≥n.</p>
<p>Si queremos limitar o formatear la informaci√≥n a enviar de los objetos que estamos tratando, y que no se env√≠en todos sus campos sin m√°s, tenemos varias opciones:</p>
<ul>
<li>A√±adir cl√°usulas <code>hidden</code> en los modelos correspondientes, para indicar que esa informaci√≥n no debe ser enviada en ning√∫n caso en ninguna parte de la aplicaci√≥n. Es lo que ocurre, por ejemplo, con el campo <em>password</em> del modelo de <code>Usuario</code>:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="x">protected $hidden = [&#39;password&#39;];</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>Definir a mano un array con los campos a enviar en el m√©todo del controlador. En el caso de la ficha del libro anterior, si s√≥lo queremos enviar el t√≠tulo y la editorial, podr√≠amos hacer algo as√≠:</li>
</ul>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="x">public function show(Libro $libro)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="x">{</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="x">  return [</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="x">     &#39;titulo&#39;    =&gt; $libro-&gt;titulo,</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="x">     &#39;editorial&#39; =&gt; $libro-&gt;editorial</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="x">  ];</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<ul>
<li>En el caso de que el paso anterior sea muy costoso (porque el modelo tenga muchos campos, o porque tengamos que hacer lo mismo en varias partes del c√≥digo), tambi√©n podemos definir recursos (<em>resources</em>), que permiten separar el c√≥digo de la informaci√≥n a mostrar del propio controlador. <a href="https://laravel.com/docs/eloquent-resources">Aqu√≠</a> pod√©is encontrar informaci√≥n al respecto, ya que estos contenidos escapan del alcance de esta sesi√≥n.</li>
</ul>
<p>Por otra parte, si queremos a√±adir o modificar m√°s informaci√≥n en la respuesta, como el c√≥digo de estado, la estructura anterior no nos sirve, ya que siempre se va a enviar un c√≥digo 200. Para esto, es conveniente emplear el m√©todo <code>response()-&gt;json(...)</code>, que permite especificar como primer par√°metro los datos a enviar, y como segundo par√°metro el c√≥digo de estado. Los m√©todos anteriores quedar√≠an as√≠, enviando un c√≥digo 200 como respuesta (aunque si se omite el segundo par√°metro, se asume que es 200):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="x">public function index()</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="x">{</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="x">  $libros = Libro::get();</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="x">  return response()-&gt;json($libros, 200);;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="x">}</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="x">// ...</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="x">public function show(Libro $libro)</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="x">{</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="x">  return response()-&gt;json($libro, 200);</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<h2 id="4-resto-de-servicios">4. Resto de servicios</h2>
<p>Veamos ahora c√≥mo implementar el resto de servicios (POST, PUT y DELETE). En el caso de la inserci√≥n (<strong>POST</strong>), deberemos recibir en la petici√≥n los datos del objeto a insertar (un libro, en nuestro ejemplo). Igual que los datos del servidor al cliente se env√≠an en formato JSON, es de esperar en aplicaciones que siguen la arquitectura REST que los datos del cliente al servidor tambi√©n se env√≠en en formato JSON.</p>
<p>Nuestro m√©todo <code>store</code>, asociado al servicio POST, podr√≠a quedar de este modo (devolvemos el c√≥digo de estado 201, que se utiliza cuando se han insertado elementos nuevos):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="x">public function store(Request $request)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="x">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="x">  $libro = new Libro();</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="x">  $libro-&gt;titulo = $request-&gt;titulo;</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="x">  $libro-&gt;editorial = $request-&gt;editorial;</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="x">  $libro-&gt;precio = $request-&gt;precio;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="x">  $libro-&gt;autor()-&gt;associate(Autor::findOrFail($request-&gt;autor_id));</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="x">  $libro-&gt;save();</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="x">  return response()-&gt;json($libro, 201);</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>De forma similar implementar√≠amos el servicio <strong>PUT</strong>, a trav√©s del m√©todo <code>update</code>. En este caso devolvemos un c√≥digo de estado 200:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="x">public function update(Request $request, Libro $libro)</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="x">{</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="x">  $libro-&gt;titulo = $request-&gt;titulo;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="x">  $libro-&gt;editorial = $request-&gt;editorial;</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="x">  $libro-&gt;precio = $request-&gt;precio;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="x">  $libro-&gt;autor()-&gt;associate(Autor::findOrFail($request-&gt;autor_id));</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="x">  $libro-&gt;save();</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="x">  return response()-&gt;json($libro);</span>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Finalmente, para el servicio <strong>DELETE</strong>, debemos implementar el m√©todo <code>destroy</code>, que podr√≠a quedar as√≠:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="x">public function destroy(Libro $libro)</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="x">{</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="x">  $libro-&gt;delete();</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="x">  return response()-&gt;json(null, 204);</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Notar que devolvemos un c√≥digo de estado 204, que indica que no estamos devolviendo contenido (es <em>null</em>). Por otra parte, es habitual en este tipo de operaciones de borrado devolver en formato JSON el objeto que se ha eliminado, por si acaso se quiere deshacer la operaci√≥n en un paso posterior. En este caso, el c√≥digo del m√©todo de borrado ser√≠a as√≠:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="x">public function destroy(Libro $libro)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="x">{</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="x">  $libro-&gt;delete();</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="x">  return response()-&gt;json($libro);</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Como podemos empezar a intuir, probar estos servicios no es tan sencillo como probar servicios de tipo GET, ya que no podemos simplemente teclear una URL en el navegador. Necesitamos un mecanismo para pasarle los datos al servidor en formato JSON, y tambi√©n el m√©todo (POST, PUT o DELETE). Veremos c√≥mo en la siguiente secci√≥n.</p>
<h3 id="41-validacion-de-datos">4.1. Validaci√≥n de datos</h3>
<p>A la hora de recibir datos en formato JSON para servicios REST, tambi√©n podemos establecer mecanismos de <strong>validaci√≥n</strong> similares a los vistos para los formularios, a trav√©s de los correspondientes <em>requests</em>. De hecho, en el caso de la biblioteca podemos emplear la clase <code>App\Http\Requests\LibroPost</code> que hicimos en sesiones anteriores, para validar que los datos que llegan tanto a <code>store</code> como a <code>update</code> son correctos. Basta con usar un par√°metro de este tipo en estos m√©todos, en lugar del par√°metro <code>Request</code> que viene por defecto:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span>
<span class="normal"><a href="#__codelineno-18-6">6</a></span>
<span class="normal"><a href="#__codelineno-18-7">7</a></span>
<span class="normal"><a href="#__codelineno-18-8">8</a></span>
<span class="normal"><a href="#__codelineno-18-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="x">public function store(LibroPost $request)</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="x">{</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="x">  // ...</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="x">}</span>
<a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="x">...</span>
<a id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="x">public function update(LibroPost $request, Libro $libro)</span>
<a id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="x">{</span>
<a id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="x">  // ...</span>
<a id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<h3 id="42-respuestas-de-error">4.2. Respuestas de error</h3>
<p>Por otra parte, debemos asegurarnos de que cualquier error que se produzca en la parte de la API devuelva un cotenido en formato JSON, y no una p√°gina web. Por ejemplo, si solicitamos ver la ficha de un libro cuyo <em>id</em> no existe, no deber√≠a devolvernos una p√°gina de error 404, sino un c√≥digo de estado 404 con un mensaje de error en formato JSON.</p>
<p>Esto no se cumple por defecto, ya que Laravel est√° configurado para renderizar una vista con el error producido. Para modificar este comportamiento en <strong>versiones anteriores a Laravel 8</strong>, debemos editar el archivo <code>App\Exceptions\Handler.php</code>, en concreto su m√©todo <code>render</code>, y hacer algo as√≠:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="x">public function render($request, Throwable $exception)</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="x">{</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="x">  if ($request-&gt;is(&#39;api*&#39;))</span>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="x">  {</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="x">    if ($exception instanceof ModelNotFoundException)</span>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="x">      return response()-&gt;json([&#39;error&#39; =&gt; &#39;Elemento no encontrado&#39;], 404);</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="x">    else if ($exception instanceof ValidationException)</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="x">      return response()-&gt;json([&#39;error&#39; =&gt; &#39;Datos no v√°lidos&#39;], 400);</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="x">    else if (isset($exception))</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="x">      return response()-&gt;json([&#39;error&#39; =&gt; &#39;Error en la aplicaci√≥n: &#39; . </span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="x">                $exception-&gt;getMessage()], 500);</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="x">  }</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="x">  // Esta es la √∫nica instrucci√≥n que hay en la versi√≥n original</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="x">  return parent::render($request, $exception);</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<p>Hemos a√±adido sobre el c√≥digo original una cl√°usula <code>if</code> que se centra en las peticiones de tipo <code>api</code>. En este caso, podemos distinguir los distintos tipos de excepciones que se producen. Para nuestro ejemplo distinguimos tres: errores de tipo 404, errores de validaci√≥n u otros errores. En todos los casos se devuelve un contenido JSON con el c√≥digo de estado y campos adecuados. Si todo es correcto y no hay errores, o si no estamos en rutas <em>api</em>, el comportamiento ser√° el habitual.</p>
<p>En el caso de <strong>Laravel 8 y posteriores</strong>, el m√©todo a modificar se llama <code>register</code>, dentro de la misma clase <code>App\Exceptions\Handler.php</code>. Lo podemos dejar de este modo para hacer algo equivalente a lo anterior:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="x">public function register()</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="x">{</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="x">  $this-&gt;renderable(function (Throwable $exception) {</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="x">     if (request()-&gt;is(&#39;api*&#39;))</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="x">     {</span>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="x">        if ($exception instanceof ModelNotFoundException)</span>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="x">            return response()-&gt;json([&#39;error&#39; =&gt; &#39;Recurso no encontrado&#39;], 404);</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="x">        else if ($exception instanceof ValidationException)</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="x">            return response()-&gt;json([&#39;error&#39; =&gt; &#39;Datos no v√°lidos&#39;], 400);</span>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="x">        else if (isset($exception))</span>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="x">            return response()-&gt;json([&#39;error&#39; =&gt; &#39;Error: &#39; . </span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="x">                    $exception-&gt;getMessage()], 500);</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="x">     }</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="x">  });</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="x">}</span>
</code></pre></div></td></tr></table></div>
<blockquote>
<p><strong>NOTA</strong>: relacionado con el c√≥digo anterior, las excepciones que se identifican est√°n en <code>Illuminate\Database\Eloquent\ModelNotFoundException</code> e <code>Illuminate\Validation\ValidationException</code>, respectivamente.</p>
</blockquote>
<p>En algunas versiones de Laravel, la clase base <code>ExceptionHandler</code> realiza algunas conversiones de tipos de excepciones. As√≠, por ejemplo, la excepci√≥n <code>ModelNotFoundException</code> se convierte a <code>NotFoundHttpException</code>. En este caso, el <code>if</code> anterior que detecta la excepci√≥n podr√≠a no funcionar, ya que el operador <code>instanceof</code> est√° buscando la excepci√≥n equivocada. Una forma algo m√°s completa de detectar si no se encuentra el recurso solicitado ser√≠a esta (incluimos las cl√°usulas <code>using</code> correspondientes tambi√©n):</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">PHP</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-21-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-21-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-21-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-21-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-21-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-21-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-21-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-21-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-21-10">10</a></span>
<span class="normal"><a href="#__codelineno-21-11">11</a></span>
<span class="normal"><a href="#__codelineno-21-12">12</a></span>
<span class="normal"><a href="#__codelineno-21-13">13</a></span>
<span class="normal"><a href="#__codelineno-21-14">14</a></span>
<span class="normal"><a href="#__codelineno-21-15">15</a></span>
<span class="normal"><a href="#__codelineno-21-16">16</a></span>
<span class="normal"><a href="#__codelineno-21-17">17</a></span>
<span class="normal"><a href="#__codelineno-21-18">18</a></span>
<span class="normal"><a href="#__codelineno-21-19">19</a></span>
<span class="normal"><a href="#__codelineno-21-20">20</a></span>
<span class="normal"><a href="#__codelineno-21-21">21</a></span>
<span class="normal"><a href="#__codelineno-21-22">22</a></span>
<span class="normal"><a href="#__codelineno-21-23">23</a></span>
<span class="normal"><a href="#__codelineno-21-24">24</a></span>
<span class="normal"><a href="#__codelineno-21-25">25</a></span>
<span class="normal"><a href="#__codelineno-21-26">26</a></span>
<span class="normal"><a href="#__codelineno-21-27">27</a></span>
<span class="normal"><a href="#__codelineno-21-28">28</a></span>
<span class="normal"><a href="#__codelineno-21-29">29</a></span>
<span class="normal"><a href="#__codelineno-21-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="x">namespace App\Exceptions;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="x">use Illuminate\Foundation\Exceptions\Handler as ExceptionHandler;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="x">use Symfony\Component\HttpKernel\Exception\NotFoundHttpException;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="x">use Illuminate\Validation\ValidationException;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="x">use Illuminate\Database\Eloquent\ModelNotFoundException;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="x">use Throwable;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="x">class Handler extends ExceptionHandler</span>
<a id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="x">{</span>
<a id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="x">  // ...</span>
<a id="__codelineno-21-12" name="__codelineno-21-12"></a>
<a id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="x">  public function register()</span>
<a id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="x">  {</span>
<a id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="x">    $this-&gt;renderable(function (Throwable $exception) {</span>
<a id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="x">       if (request()-&gt;is(&#39;api*&#39;))</span>
<a id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="x">       {</span>
<a id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="x">          if ($exception instanceof ModelNotFoundException ||</span>
<a id="__codelineno-21-19" name="__codelineno-21-19"></a><span class="x">             ($exception instanceof NotFoundHttpException &amp;&amp; </span>
<a id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="x">               $exception-&gt;getPrevious() &amp;&amp;</span>
<a id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="x">               $exception-&gt;getPrevious() instanceof ModelNotFoundException))</span>
<a id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="x">            return response()-&gt;json([&#39;error&#39; =&gt; &#39;Recurso no encontrado&#39;], 404);</span>
<a id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="x">          else if ($exception instanceof ValidationException)</span>
<a id="__codelineno-21-24" name="__codelineno-21-24"></a><span class="x">            return response()-&gt;json([&#39;error&#39; =&gt; &#39;Datos no v√°lidos&#39;], 400);</span>
<a id="__codelineno-21-25" name="__codelineno-21-25"></a><span class="x">          else if (isset($exception))</span>
<a id="__codelineno-21-26" name="__codelineno-21-26"></a><span class="x">            return response()-&gt;json([&#39;error&#39; =&gt; &#39;Error: &#39; .</span>
<a id="__codelineno-21-27" name="__codelineno-21-27"></a><span class="x">                        $exception-&gt;getMessage()], 500);</span>
<a id="__codelineno-21-28" name="__codelineno-21-28"></a><span class="x">       }</span>
<a id="__codelineno-21-29" name="__codelineno-21-29"></a><span class="x">    });</span>
<a id="__codelineno-21-30" name="__codelineno-21-30"></a><span class="x">  }</span>
</code></pre></div></td></tr></table></div>
<p>De este modo, detectamos tanto si es una <code>ModelNotFoundException</code> original como si ha sido convertida a <code>NotFoundHttpException</code>.</p>
<h1 id="bibliografia">bibliografia</h1>
<ul>
<li><a href="https://nachoiborraies.github.io/laravel/">Nacho Iborra Baeza</a>.****</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer", "navigation.top"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
    
  </body>
</html>